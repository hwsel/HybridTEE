cscope 15 $HOME/devel/optee_new/optee_examples/darknetp               0001360458
	@host/examples/art.c

1 
	~"d¬kÃt.h
"

3 
	~<sys/time.h
>

5 
	$demo_¬t
(*
cfgfe
, *
weightfe
, 
ÿm_šdex
)

7 #ifdeà
OPENCV


8 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

9 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

11 
	`¤ªd
(2222222);

13 * 
ÿp
 = 
	`İ’_video_¡»am
(0, 
ÿm_šdex
, 0,0,0);

15 *
wšdow
 = "ArtJudgementBot9000!!!";

16 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

17 
i
;

18 
idx
[] = {37, 401, 434};

19 
n
 = (
idx
)/(idx[0]);

22 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

23 
image
 
š_s
 = 
	`»size_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

25 *
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
š_s
.
d©a
);

27 
	`´štf
("\033[2J");

28 
	`´štf
("\033[1;1H");

30 
scÜe
 = 0;

31 
i
 = 0; i < 
n
; ++i){

32 
s
 = 
p
[
idx
[
i
]];

33 ià(
s
 > 
scÜe
) score = s;

35 
scÜe
 = score;

36 
	`´štf
("I APPRECIATE THIS ARTWORK: %10.7f%%\n", 
scÜe
*100);

37 
	`´štf
("[");

38 
uµ”
 = 30;

39 
i
 = 0; i < 
uµ”
; ++i){

40 
	`´štf
("%c", ((
i
+.5è< 
scÜe
*
uµ”
) ? 219 : ' ');

42 
	`´štf
("]\n");

44 
	`show_image
(
š
, 
wšdow
, 1);

45 
	`ä“_image
(
š_s
);

46 
	`ä“_image
(
š
);

49 
	}
}

52 
	$run_¬t
(
¬gc
, **
¬gv
)

54 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

55 *
cfg
 = 
¬gv
[2];

56 *
weights
 = 
¬gv
[3];

57 
	`demo_¬t
(
cfg
, 
weights
, 
ÿm_šdex
);

58 
	}
}

	@host/examples/captcha.c

1 
	~"d¬kÃt.h
"

3 
	$fix_d©a_ÿ±cha
(
d©a
 
d
, 
mask
)

5 
m©rix
 
Ïb–s
 = 
d
.
y
;

6 
i
, 
j
;

7 
i
 = 0; i < 
d
.
y
.
rows
; ++i){

8 
j
 = 0; j < 
d
.
y
.
cŞs
; j += 2){

9 ià(
mask
){

10 if(!
Ïb–s
.
v®s
[
i
][
j
]){

11 
Ïb–s
.
v®s
[
i
][
j
] = 
SECRET_NUM
;

12 
Ïb–s
.
v®s
[
i
][
j
+1] = 
SECRET_NUM
;

13 }if(
Ïb–s
.
v®s
[
i
][
j
+1]){

14 
Ïb–s
.
v®s
[
i
][
j
] = 0;

17 ià(
Ïb–s
.
v®s
[
i
][
j
]) {

18 
Ïb–s
.
v®s
[
i
][
j
+1] = 0;

20 
Ïb–s
.
v®s
[
i
][
j
+1] = 1;

25 
	}
}

27 
	$Œaš_ÿ±cha
(*
cfgfe
, *
weightfe
)

29 
	`¤ªd
(
	`time
(0));

30 
avg_loss
 = -1;

31 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

32 
	`´štf
("%s\n", 
ba£
);

33 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

34 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

35 
imgs
 = 1024;

36 
i
 = *
Ãt
->
£’
/
imgs
;

37 
sŞved
 = 1;

38 
li¡
 *
¶i¡
;

39 **
Ïb–s
 = 
	`g‘_Ïb–s
("/data/captcha/reimgs.labels.list");

40 ià(
sŞved
){

41 
¶i¡
 = 
	`g‘_·ths
("/data/captcha/reimgs.solved.list");

43 
¶i¡
 = 
	`g‘_·ths
("/data/captcha/reimgs.raw.list");

45 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

46 
	`´štf
("%d\n", 
¶i¡
->
size
);

47 
şock_t
 
time
;

48 
±h»ad_t
 
lßd_th»ad
;

49 
d©a
 
Œaš
;

50 
d©a
 
bufãr
;

52 
lßd_¬gs
 
¬gs
 = {0};

53 
¬gs
.
w
 = 
Ãt
->w;

54 
¬gs
.
h
 = 
Ãt
->h;

55 
¬gs
.
·ths
 =…aths;

56 
¬gs
.
şas£s
 = 26;

57 
¬gs
.
n
 = 
imgs
;

58 
¬gs
.
m
 = 
¶i¡
->
size
;

59 
¬gs
.
Ïb–s
 =†abels;

60 
¬gs
.
d
 = &
bufãr
;

61 
¬gs
.
ty³
 = 
CLASSIFICATION_DATA
;

63 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

65 ++
i
;

66 
time
=
	`şock
();

67 
	`±h»ad_još
(
lßd_th»ad
, 0);

68 
Œaš
 = 
bufãr
;

69 
	`fix_d©a_ÿ±cha
(
Œaš
, 
sŞved
);

77 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

78 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

79 
time
=
	`şock
();

80 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

81 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

82 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

83 
	`´štf
("%d: %f, %àavg, %là£cÚds, %ld images\n", 
i
, 
loss
, 
avg_loss
, 
	`£c
(
	`şock
()-
time
), *
Ãt
->
£’
);

84 
	`ä“_d©a
(
Œaš
);

85 if(
i
%100==0){

86 
buff
[256];

87 
	`¥rštf
(
buff
, "/home/pj»dd›/imag’‘_backup/%s_%d.weights",
ba£
, 
i
);

88 
	`§ve_weights
(
Ãt
, 
buff
);

91 
	}
}

93 
	$‹¡_ÿ±cha
(*
cfgfe
, *
weightfe
, *
f’ame
)

95 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

96 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

97 
	`¤ªd
(2222222);

98 
i
 = 0;

99 **
Çmes
 = 
	`g‘_Ïb–s
("/data/captcha/reimgs.labels.list");

100 
buff
[256];

101 *
šput
 = 
buff
;

102 
šdexes
[26];

104 if(
f’ame
){

105 
	`¡ºıy
(
šput
, 
f’ame
, 256);

109 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

110 if(!
šput
) ;

111 
	`¡¹ok
(
šput
, "\n");

113 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 
Ãt
->
w
,‚‘->
h
);

114 *
X
 = 
im
.
d©a
;

115 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

116 
	`tİ_´ediùiÚs
(
Ãt
, 26, 
šdexes
);

118 
i
 = 0; i < 26; ++i){

119 
šdex
 = 
šdexes
[
i
];

120 if(
i
 !ğ0è
	`´štf
(", ");

121 
	`´štf
("% %f", 
Çmes
[
šdex
], 
´ediùiÚs
[index]);

123 
	`´štf
("\n");

124 
	`fæush
(
¡dout
);

125 
	`ä“_image
(
im
);

126 ià(
f’ame
) ;

128 
	}
}

130 
	$v®id_ÿ±cha
(*
cfgfe
, *
weightfe
, *
f’ame
)

132 **
Ïb–s
 = 
	`g‘_Ïb–s
("/data/captcha/reimgs.labels.list");

133 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

134 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("/data/captcha/reimgs.fg.list");

135 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

136 
N
 = 
¶i¡
->
size
;

137 
ouuts
 = 
Ãt
->outputs;

139 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

140 
	`¤ªd
(2222222);

141 
i
, 
j
;

142 
i
 = 0; i < 
N
; ++i){

143 ià(
i
%100 =ğ0è
	`årštf
(
¡d”r
, "%d\n", i);

144 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 
Ãt
->
w
,‚‘->
h
);

145 *
X
 = 
im
.
d©a
;

146 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

148 
Œuth
 = -1;

149 
j
 = 0; j < 13; ++j){

150 ià(
	`¡r¡r
(
·ths
[
i
], 
Ïb–s
[
j
])è
Œuth
 = j;

152 ià(
Œuth
 == -1){

153 
	`årštf
(
¡d”r
, "bad: %s\n", 
·ths
[
i
]);

156 
	`´štf
("%d, ", 
Œuth
);

157 
j
 = 0; j < 
ouuts
; ++j){

158 ià(
j
 !ğ0è
	`´štf
(", ");

159 
	`´štf
("%f", 
´ediùiÚs
[
j
]);

161 
	`´štf
("\n");

162 
	`fæush
(
¡dout
);

163 
	`ä“_image
(
im
);

164 ià(
f’ame
) ;

166 
	}
}

335 
	$run_ÿ±cha
(
¬gc
, **
¬gv
)

337 if(
¬gc
 < 4){

338 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

342 *
cfg
 = 
¬gv
[3];

343 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

344 *
f’ame
 = (
¬gc
 > 5è? 
¬gv
[5]: 0;

345 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_ÿ±cha
(
cfg
, 
weights
);

346 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_ÿ±cha
(
cfg
, 
weights
, 
f’ame
);

347 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id_ÿ±cha
(
cfg
, 
weights
, 
f’ame
);

352 
	}
}

	@host/examples/cifar.c

1 
	~"d¬kÃt.h
"

3 
	$Œaš_ciçr
(*
cfgfe
, *
weightfe
)

5 
	`¤ªd
(
	`time
(0));

6 
avg_loss
 = -1;

7 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

8 
	`´štf
("%s\n", 
ba£
);

9 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

10 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

12 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

13 
şas£s
 = 10;

14 
N
 = 50000;

16 **
Ïb–s
 = 
	`g‘_Ïb–s
("data/cifar/labels.txt");

17 
•och
 = (*
Ãt
->
£’
)/
N
;

18 
d©a
 
Œaš
 = 
	`lßd_®l_ciçr10
();

19 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

20 
şock_t
 
time
=
	`şock
();

22 
loss
 = 
	`Œaš_ÃtwÜk_sgd
(
Ãt
, 
Œaš
, 1);

23 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

24 
avg_loss
 =‡vg_loss*.95 + 
loss
*.05;

25 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`£c
(
	`şock
()-
time
), *net->seen);

26 if(*
Ãt
->
£’
/
N
 > 
•och
){

27 
•och
 = *
Ãt
->
£’
/
N
;

28 
buff
[256];

29 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

30 
	`§ve_weights
(
Ãt
, 
buff
);

32 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%100 == 0){

33 
buff
[256];

34 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

35 
	`§ve_weights
(
Ãt
, 
buff
);

38 
buff
[256];

39 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

40 
	`§ve_weights
(
Ãt
, 
buff
);

42 
	`ä“_ÃtwÜk
(
Ãt
);

43 
	`ä“_±rs
((**)
Ïb–s
, 
şas£s
);

44 
	`ä“
(
ba£
);

45 
	`ä“_d©a
(
Œaš
);

46 
	}
}

48 
	$Œaš_ciçr_di¡l
(*
cfgfe
, *
weightfe
)

50 
	`¤ªd
(
	`time
(0));

51 
avg_loss
 = -1;

52 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

53 
	`´štf
("%s\n", 
ba£
);

54 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

55 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

57 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

58 
şas£s
 = 10;

59 
N
 = 50000;

61 **
Ïb–s
 = 
	`g‘_Ïb–s
("data/cifar/labels.txt");

62 
•och
 = (*
Ãt
->
£’
)/
N
;

64 
d©a
 
Œaš
 = 
	`lßd_®l_ciçr10
();

65 
m©rix
 
soá
 = 
	`csv_to_m©rix
("results/ensemble.csv");

67 
weight
 = .9;

68 
	`sÿË_m©rix
(
soá
, 
weight
);

69 
	`sÿË_m©rix
(
Œaš
.
y
, 1. - 
weight
);

70 
	`m©rix_add_m©rix
(
soá
, 
Œaš
.
y
);

72 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

73 
şock_t
 
time
=
	`şock
();

75 
loss
 = 
	`Œaš_ÃtwÜk_sgd
(
Ãt
, 
Œaš
, 1);

76 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

77 
avg_loss
 =‡vg_loss*.95 + 
loss
*.05;

78 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`£c
(
	`şock
()-
time
), *net->seen);

79 if(*
Ãt
->
£’
/
N
 > 
•och
){

80 
•och
 = *
Ãt
->
£’
/
N
;

81 
buff
[256];

82 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

83 
	`§ve_weights
(
Ãt
, 
buff
);

85 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%100 == 0){

86 
buff
[256];

87 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

88 
	`§ve_weights
(
Ãt
, 
buff
);

91 
buff
[256];

92 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

93 
	`§ve_weights
(
Ãt
, 
buff
);

95 
	`ä“_ÃtwÜk
(
Ãt
);

96 
	`ä“_±rs
((**)
Ïb–s
, 
şas£s
);

97 
	`ä“
(
ba£
);

98 
	`ä“_d©a
(
Œaš
);

99 
	}
}

101 
	$‹¡_ciçr_muÉi
(*
f’ame
, *
weightfe
)

103 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

104 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

105 
	`¤ªd
(
	`time
(0));

107 
avg_acc
 = 0;

108 
d©a
 
‹¡
 = 
	`lßd_ciçr10_d©a
("data/cifar/cifar-10-batches-bin/test_batch.bin");

110 
i
;

111 
i
 = 0; i < 
‹¡
.
X
.
rows
; ++i){

112 
image
 
im
 = 
	`æßt_to_image
(32, 32, 3, 
‹¡
.
X
.
v®s
[
i
]);

114 
´ed
[10] = {0};

116 *
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
im
.
d©a
);

117 
	`axpy_ıu
(10, 1, 
p
, 1, 
´ed
, 1);

118 
	`æ_image
(
im
);

119 
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
im
.
d©a
);

120 
	`axpy_ıu
(10, 1, 
p
, 1, 
´ed
, 1);

122 
šdex
 = 
	`max_šdex
(
´ed
, 10);

123 
şass
 = 
	`max_šdex
(
‹¡
.
y
.
v®s
[
i
], 10);

124 if(
šdex
 =ğ
şass
è
avg_acc
 += 1;

125 
	`ä“_image
(
im
);

126 
	`´štf
("%4d: %.2f%%\n", 
i
, 100.*
avg_acc
/(i+1));

128 
	}
}

130 
	$‹¡_ciçr
(*
f’ame
, *
weightfe
)

132 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

133 
	`¤ªd
(
	`time
(0));

135 
şock_t
 
time
;

136 
avg_acc
 = 0;

137 
avg_tİ5
 = 0;

138 
d©a
 
‹¡
 = 
	`lßd_ciçr10_d©a
("data/cifar/cifar-10-batches-bin/test_batch.bin");

140 
time
=
	`şock
();

142 *
acc
 = 
	`ÃtwÜk_accu¿c›s
(
Ãt
, 
‹¡
, 2);

143 
avg_acc
 +ğ
acc
[0];

144 
avg_tİ5
 +ğ
acc
[1];

145 
	`´štf
("tİ1: %f, %là£cÚds, %d images\n", 
avg_acc
, 
	`£c
(
	`şock
()-
time
), 
‹¡
.
X
.
rows
);

146 
	`ä“_d©a
(
‹¡
);

147 
	}
}

149 
	$exŒaù_ciçr
()

151 *
Ïb–s
[] = {"airplane","automobile","bird","cat","deer","dog","frog","horse","ship","truck"};

152 
i
;

153 
d©a
 
Œaš
 = 
	`lßd_®l_ciçr10
();

154 
d©a
 
‹¡
 = 
	`lßd_ciçr10_d©a
("data/cifar/cifar-10-batches-bin/test_batch.bin");

155 
i
 = 0; i < 
Œaš
.
X
.
rows
; ++i){

156 
image
 
im
 = 
	`æßt_to_image
(32, 32, 3, 
Œaš
.
X
.
v®s
[
i
]);

157 
şass
 = 
	`max_šdex
(
Œaš
.
y
.
v®s
[
i
], 10);

158 
buff
[256];

159 
	`¥rštf
(
buff
, "d©a/ciçr/Œaš/%d_%s",
i
,
Ïb–s
[
şass
]);

160 
	`§ve_image_İtiÚs
(
im
, 
buff
, 
PNG
, 0);

162 
i
 = 0; i < 
‹¡
.
X
.
rows
; ++i){

163 
image
 
im
 = 
	`æßt_to_image
(32, 32, 3, 
‹¡
.
X
.
v®s
[
i
]);

164 
şass
 = 
	`max_šdex
(
‹¡
.
y
.
v®s
[
i
], 10);

165 
buff
[256];

166 
	`¥rštf
(
buff
, "d©a/ciçr/‹¡/%d_%s",
i
,
Ïb–s
[
şass
]);

167 
	`§ve_image_İtiÚs
(
im
, 
buff
, 
PNG
, 0);

169 
	}
}

171 
	$‹¡_ciçr_csv
(*
f’ame
, *
weightfe
)

173 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

174 
	`¤ªd
(
	`time
(0));

176 
d©a
 
‹¡
 = 
	`lßd_ciçr10_d©a
("data/cifar/cifar-10-batches-bin/test_batch.bin");

178 
m©rix
 
´ed
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
‹¡
);

180 
i
;

181 
i
 = 0; i < 
‹¡
.
X
.
rows
; ++i){

182 
image
 
im
 = 
	`æßt_to_image
(32, 32, 3, 
‹¡
.
X
.
v®s
[
i
]);

183 
	`æ_image
(
im
);

185 
m©rix
 
´ed2
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
‹¡
);

186 
	`sÿË_m©rix
(
´ed
, .5);

187 
	`sÿË_m©rix
(
´ed2
, .5);

188 
	`m©rix_add_m©rix
(
´ed2
, 
´ed
);

190 
	`m©rix_to_csv
(
´ed
);

191 
	`årštf
(
¡d”r
, "Accu¿cy: %f\n", 
	`m©rix_tİk_accu¿cy
(
‹¡
.
y
, 
´ed
, 1));

192 
	`ä“_d©a
(
‹¡
);

193 
	}
}

195 
	$‹¡_ciçr_csvŒaš
(*
cfg
, *
weights
)

197 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

198 
	`¤ªd
(
	`time
(0));

200 
d©a
 
‹¡
 = 
	`lßd_®l_ciçr10
();

202 
m©rix
 
´ed
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
‹¡
);

204 
i
;

205 
i
 = 0; i < 
‹¡
.
X
.
rows
; ++i){

206 
image
 
im
 = 
	`æßt_to_image
(32, 32, 3, 
‹¡
.
X
.
v®s
[
i
]);

207 
	`æ_image
(
im
);

209 
m©rix
 
´ed2
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
‹¡
);

210 
	`sÿË_m©rix
(
´ed
, .5);

211 
	`sÿË_m©rix
(
´ed2
, .5);

212 
	`m©rix_add_m©rix
(
´ed2
, 
´ed
);

214 
	`m©rix_to_csv
(
´ed
);

215 
	`årštf
(
¡d”r
, "Accu¿cy: %f\n", 
	`m©rix_tİk_accu¿cy
(
‹¡
.
y
, 
´ed
, 1));

216 
	`ä“_d©a
(
‹¡
);

217 
	}
}

219 
	$ev®_ciçr_csv
()

221 
d©a
 
‹¡
 = 
	`lßd_ciçr10_d©a
("data/cifar/cifar-10-batches-bin/test_batch.bin");

223 
m©rix
 
´ed
 = 
	`csv_to_m©rix
("results/combined.csv");

224 
	`årštf
(
¡d”r
, "%d %d\n", 
´ed
.
rows
,…»d.
cŞs
);

226 
	`årštf
(
¡d”r
, "Accu¿cy: %f\n", 
	`m©rix_tİk_accu¿cy
(
‹¡
.
y
, 
´ed
, 1));

227 
	`ä“_d©a
(
‹¡
);

228 
	`ä“_m©rix
(
´ed
);

229 
	}
}

232 
	$run_ciçr
(
¬gc
, **
¬gv
)

234 if(
¬gc
 < 4){

235 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

239 *
cfg
 = 
¬gv
[3];

240 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

241 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_ciçr
(
cfg
, 
weights
);

242 if(0==
	`¡rcmp
(
¬gv
[2], "exŒaù")è
	`exŒaù_ciçr
();

243 if(0==
	`¡rcmp
(
¬gv
[2], "di¡l")è
	`Œaš_ciçr_di¡l
(
cfg
, 
weights
);

244 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_ciçr
(
cfg
, 
weights
);

245 if(0==
	`¡rcmp
(
¬gv
[2], "muÉi")è
	`‹¡_ciçr_muÉi
(
cfg
, 
weights
);

246 if(0==
	`¡rcmp
(
¬gv
[2], "csv")è
	`‹¡_ciçr_csv
(
cfg
, 
weights
);

247 if(0==
	`¡rcmp
(
¬gv
[2], "csvŒaš")è
	`‹¡_ciçr_csvŒaš
(
cfg
, 
weights
);

248 if(0==
	`¡rcmp
(
¬gv
[2], "ev®")è
	`ev®_ciçr_csv
();

249 
	}
}

	@host/examples/classifier.c

1 
	~"d¬kÃt.h
"

2 
	~"maš.h
"

3 
	~"·r£r.h
"

4 
	~"sock‘_­i.h
"

6 
	~<sys/time.h
>

7 
	~<as£¹.h
>

8 
	~<sys/»sourû.h
>

9 
	~<uni¡d.h
>

10 
	~<¡dio.h
>

11 
	~<sys/ty³s.h
>

12 
	~<sys/¡©.h
>

13 
	~<¡dlib.h
>

14 
	~<¡ršg.h
>

16 
·r£_Ï¡_Ïy”
(*
fesize
);

18 
Ïy”
 
	g¦
;

20 
	$g‘MemÜy
(
FILE
 *
ouut_fe
) {

23 
bufãr
[1024] = "";

24 
vmsize
, 
vmrss
, 
vmd©a
, 
vm¡k
, 
vmexe
, 
vmlib
;

25 
FILE
* 
fe
 = 
	`fİ’
("/proc/self/status", "r");

28 if(
fe
){

29 
	`fsÿnf
(
fe
, " %1023s", 
bufãr
) == 1) {

30 ià(
	`¡rcmp
(
bufãr
, "VmSize:") == 0) {

31 
	`fsÿnf
(
fe
, " %d", &
vmsize
);

32 
	`´štf
("vmsize:%ld; ", 
vmsize
);

33 
	`årštf
(
ouut_fe
, "vmsize:%ld; ", 
vmsize
);

35 ià(
	`¡rcmp
(
bufãr
, "VmRSS:") == 0) {

36 
	`fsÿnf
(
fe
, " %d", &
vmrss
);

37 
	`´štf
("vmrss:%ld; ", 
vmrss
);

38 
	`årštf
(
ouut_fe
, "vmrss:%ld; ", 
vmrss
);

40 ià(
	`¡rcmp
(
bufãr
, "VmData:") == 0) {

41 
	`fsÿnf
(
fe
, " %d", &
vmd©a
);

42 
	`´štf
("vmd©a:%ld; ", 
vmd©a
);

43 
	`årštf
(
ouut_fe
, "vmd©a:%ld; ", 
vmd©a
);

45 ià(
	`¡rcmp
(
bufãr
, "VmStk:") == 0) {

46 
	`fsÿnf
(
fe
, " %d", &
vm¡k
);

47 
	`´štf
("vm¡k:%ld; ", 
vm¡k
);

48 
	`årštf
(
ouut_fe
, "vm¡k:%ld; ", 
vm¡k
);

50 ià(
	`¡rcmp
(
bufãr
, "VmExe:") == 0) {

51 
	`fsÿnf
(
fe
, " %d", &
vmexe
);

52 
	`´štf
("vmexe:%ld; ", 
vmexe
);

53 
	`årštf
(
ouut_fe
, "vmexe:%ld; ", 
vmexe
);

55 ià(
	`¡rcmp
(
bufãr
, "VmLib:") == 0) {

56 
	`fsÿnf
(
fe
, " %d", &
vmlib
);

57 
	`´štf
("vmlib:%ld\n", 
vmlib
);

58 
	`årštf
(
ouut_fe
, "vmlib:%ld\n", 
vmlib
);

62 
	`´štf
("memory status file‚ot found");

65 
	`fşo£
(
fe
);

66 
	}
}

69 *
	$g‘_»g»ssiÚ_v®ues
(**
Ïb–s
, 
n
)

71 *
v
 = 
	`ÿÎoc
(
n
, ());

72 
i
;

73 
i
 = 0; i < 
n
; ++i){

74 *
p
 = 
	`¡rchr
(
Ïb–s
[
i
], ' ');

75 *
p
 = 0;

76 
v
[
i
] = 
	`©of
(
p
+1);

78  
v
;

79 
	}
}

81 
	$Œaš_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
gpus
, 
ngpus
, 
ş—r
)

83 
i
;

85 
avg_loss
 = -1;

86 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

87 
	`´štf
("%s\n", 
ba£
);

88 
	`´štf
("%d\n", 
ngpus
);

89 
ÃtwÜk
 **
Ãts
 = 
	`ÿÎoc
(
ngpus
, (network*));

91 
	`¤ªd
(
	`time
(0));

92 
£ed
 = 
	`¿nd
();

93 
i
 = 0; i < 
ngpus
; ++i){

94 
	`¤ªd
(
£ed
);

95 #ifdeà
GPU


96 
	`cuda_£t_deviû
(
gpus
[
i
]);

98 
Ãts
[
i
] = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

99 
Ãts
[
i
]->
Ë¬nšg_¿‹
 *ğ
ngpus
;

101 
	`¤ªd
(
	`time
(0));

102 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

104 
imgs
 = 
Ãt
->
b©ch
 *‚‘->
subdivisiÚs
 * 
ngpus
;

106 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

107 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

109 *
backup_dœeùÜy
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "backup", "/backup/");

110 
g
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "tag", 0);

111 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

112 *
Œaš_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "train", "data/train.list");

113 *
Œ“
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "tree", 0);

114 ià(
Œ“
è
Ãt
->
h›¿rchy
 = 
	`»ad_Œ“
(tree);

115 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

117 **
Ïb–s
 = 0;

118 if(!
g
){

119 
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

121 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_li¡
);

122 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

123 
	`´štf
("%d\n", 
¶i¡
->
size
);

124 
N
 = 
¶i¡
->
size
;

125 
time
;

127 
lßd_¬gs
 
¬gs
 = {0};

128 
¬gs
.
w
 = 
Ãt
->w;

129 
¬gs
.
h
 = 
Ãt
->h;

130 
¬gs
.
th»ads
 = 32;

131 
¬gs
.
h›¿rchy
 = 
Ãt
->hierarchy;

133 
¬gs
.
mš
 = 
Ãt
->
mš_¿tio
*Ãt->
w
;

134 
¬gs
.
max
 = 
Ãt
->
max_¿tio
*Ãt->
w
;

135 
	`´štf
("%d %d\n", 
¬gs
.
mš
,‡rgs.
max
);

136 
¬gs
.
ªgË
 = 
Ãt
->angle;

137 
¬gs
.
a¥eù
 = 
Ãt
->aspect;

138 
¬gs
.
exposu»
 = 
Ãt
->exposure;

139 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

140 
¬gs
.
hue
 = 
Ãt
->hue;

141 
¬gs
.
size
 = 
Ãt
->
w
;

143 
¬gs
.
·ths
 =…aths;

144 
¬gs
.
şas£s
 = classes;

145 
¬gs
.
n
 = 
imgs
;

146 
¬gs
.
m
 = 
N
;

147 
¬gs
.
Ïb–s
 =†abels;

148 ià(
g
){

149 
¬gs
.
ty³
 = 
TAG_DATA
;

151 
¬gs
.
ty³
 = 
CLASSIFICATION_DATA
;

154 
d©a
 
Œaš
;

155 
d©a
 
bufãr
;

156 
±h»ad_t
 
lßd_th»ad
;

157 
¬gs
.
d
 = &
bufãr
;

158 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

160 
couÁ
 = 0;

161 
•och
 = (*
Ãt
->
£’
)/
N
;

164 
¡©
 
¡
 = {0};

165 ià(
	`¡©
("/medŸ/»suÉs", &
¡
) == -1) {

166 
	`mkdœ
("/media/results", 0700);

169 
d–im
[] = "/.";

170 *
±r
 = 
	`¡¹ok
(
cfgfe
, 
d–im
);

171 
±r
 = 
	`¡¹ok
(
NULL
, 
d–im
);

173 *
ouut_dœ
[80];

174 
	`¡rıy
(
ouut_dœ
, "/media/results/train_");

175 
	`¡rÿt
(
ouut_dœ
, 
±r
);

178 
	`¡rÿt
(
ouut_dœ
, ".txt");

180 
	`´štf
("ouuˆfe: %s\n", 
ouut_dœ
);

182 
FILE
 *
ouut_fe
 = 
	`fİ’
(
ouut_dœ
, "w");

185 
	`´štf
("cu¼’t_b©ch=%d \n", 
	`g‘_cu¼’t_b©ch
(
Ãt
));

186 if(
	`g‘_cu¼’t_b©ch
(
Ãt
è>ğÃt->
max_b©ches
){

187 
Ãt
->
max_b©ches
 = 
	`g‘_cu¼’t_b©ch
(net) +‚et->max_batches;

190 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

191 if(
Ãt
->
¿ndom
 && 
couÁ
++%40 == 0){

192 
	`´štf
("Resizing\n");

193 
dim
 = (
	`¿nd
() % 11 + 4) * 32;

196 
	`´štf
("%d\n", 
dim
);

197 
¬gs
.
w
 = 
dim
;

198 
¬gs
.
h
 = 
dim
;

199 
¬gs
.
size
 = 
dim
;

200 
¬gs
.
mš
 = 
Ãt
->
mš_¿tio
*
dim
;

201 
¬gs
.
max
 = 
Ãt
->
max_¿tio
*
dim
;

202 
	`´štf
("%d %d\n", 
¬gs
.
mš
,‡rgs.
max
);

204 
	`±h»ad_još
(
lßd_th»ad
, 0);

205 
Œaš
 = 
bufãr
;

206 
	`ä“_d©a
(
Œaš
);

207 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

209 
i
 = 0; i < 
ngpus
; ++i){

210 
	`»size_ÃtwÜk
(
Ãts
[
i
], 
dim
, dim);

212 
Ãt
 = 
Ãts
[0];

215 
ru§ge
 
u§ge
;

216 
timev®
 
¡¬tu
, 
’du
, 
¡¬ts
, 
’ds
;

218 
	`g‘ru§ge
(
RUSAGE_SELF
, &
u§ge
);

219 
¡¬tu
 = 
u§ge
.
ru_utime
;

220 
¡¬ts
 = 
u§ge
.
ru_¡ime
;

222 
time
 = 
	`wh©_time_is_™_now
();

224 
	`±h»ad_još
(
lßd_th»ad
, 0);

225 
Œaš
 = 
bufãr
;

226 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

228 
	`´štf
("Lßded: %là£cÚds\n", 
	`wh©_time_is_™_now
()-
time
);

229 
time
 = 
	`wh©_time_is_™_now
();

231 
loss
 = 0;

232 #ifdeà
GPU


233 if(
ngpus
 == 1){

234 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

236 
loss
 = 
	`Œaš_ÃtwÜks
(
Ãts
, 
ngpus
, 
Œaš
, 4);

239 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

241 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

242 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

243 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`wh©_time_is_™_now
()-
time
, *net->seen);

244 
	`årštf
(
ouut_fe
, "%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`wh©_time_is_™_now
()-
time
, *net->seen);

247 
	`g‘ru§ge
(
RUSAGE_SELF
, &
u§ge
);

248 
’du
 = 
u§ge
.
ru_utime
;

249 
’ds
 = 
u§ge
.
ru_¡ime
;

250 
	`´štf
("u£¸CPU s¹: %lu.%06u;ƒnd: %lu.%06u\n", 
¡¬tu
.
tv_£c
, s¹u.
tv_u£c
, 
’du
.tv_sec,ƒndu.tv_usec);

251 
	`´štf
("k”ÃÈCPU s¹: %lu.%06u;ƒnd: %lu.%06u\n", 
¡¬ts
.
tv_£c
, s¹s.
tv_u£c
, 
’ds
.tv_sec,ƒnds.tv_usec);

252 
	`´štf
("Max: %ld koby‹s\n", 
u§ge
.
ru_maxrss
);

253 
	`årštf
(
ouut_fe
, "u£¸CPU s¹: %lu.%06u;ƒnd: %lu.%06u\n", 
¡¬tu
.
tv_£c
, s¹u.
tv_u£c
, 
’du
.tv_sec,ƒndu.tv_usec);

254 
	`årštf
(
ouut_fe
, "k”ÃÈCPU s¹: %lu.%06u;ƒnd: %lu.%06u\n", 
¡¬ts
.
tv_£c
, s¹s.
tv_u£c
, 
’ds
.tv_sec,ƒnds.tv_usec);

255 
	`årštf
(
ouut_fe
, "Max: %ld koby‹s\n", 
u§ge
.
ru_maxrss
);

256 
	`g‘MemÜy
(
ouut_fe
);

259 
	`ä“_d©a
(
Œaš
);

260 if(*
Ãt
->
£’
/
N
 > 
•och
){

261 
•och
 = *
Ãt
->
£’
/
N
;

262 
buff
[256];

263 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

264 
	`§ve_weights
(
Ãt
, 
buff
);

266 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%1000 == 0){

267 
buff
[256];

268 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

269 
	`§ve_weights
(
Ãt
, 
buff
);

272 
	`fşo£
(
ouut_fe
);

274 
buff
[256];

275 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

276 
	`§ve_weights
(
Ãt
, 
buff
);

277 
	`±h»ad_još
(
lßd_th»ad
, 0);

279 
	`ä“_ÃtwÜk
(
Ãt
);

280 if(
Ïb–s
è
	`ä“_±rs
((**îab–s, 
şas£s
);

281 
	`ä“_±rs
((**)
·ths
, 
¶i¡
->
size
);

282 
	`ä“_li¡
(
¶i¡
);

283 
	`ä“
(
ba£
);

284 
	}
}

286 
	$v®id©e_şassif›r_üİ
(*
d©acfg
, *
f’ame
, *
weightfe
)

288 
i
 = 0;

289 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

290 
	`¤ªd
(
	`time
(0));

292 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

294 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

295 *
v®id_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

296 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

297 
tİk
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

299 **
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

300 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_li¡
);

302 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

303 
m
 = 
¶i¡
->
size
;

304 
	`ä“_li¡
(
¶i¡
);

306 
şock_t
 
time
;

307 
avg_acc
 = 0;

308 
avg_tİk
 = 0;

309 
¥l™s
 = 
m
/1000;

310 
num
 = (
i
+1)*
m
/
¥l™s
 - i*m/splits;

312 
d©a
 
v®
, 
bufãr
;

314 
lßd_¬gs
 
¬gs
 = {0};

315 
¬gs
.
w
 = 
Ãt
->w;

316 
¬gs
.
h
 = 
Ãt
->h;

318 
¬gs
.
·ths
 =…aths;

319 
¬gs
.
şas£s
 = classes;

320 
¬gs
.
n
 = 
num
;

321 
¬gs
.
m
 = 0;

322 
¬gs
.
Ïb–s
 =†abels;

323 
¬gs
.
d
 = &
bufãr
;

324 
¬gs
.
ty³
 = 
OLD_CLASSIFICATION_DATA
;

326 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

327 
i
 = 1; i <ğ
¥l™s
; ++i){

328 
time
=
	`şock
();

330 
	`±h»ad_još
(
lßd_th»ad
, 0);

331 
v®
 = 
bufãr
;

333 
num
 = (
i
+1)*
m
/
¥l™s
 - i*m/splits;

334 **
·¹
 = 
·ths
+(
i
*
m
/
¥l™s
);

335 if(
i
 !ğ
¥l™s
){

336 
¬gs
.
·ths
 = 
·¹
;

337 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

339 
	`´štf
("Lßded: %d image š %là£cÚds\n", 
v®
.
X
.
rows
, 
	`£c
(
	`şock
()-
time
));

341 
time
=
	`şock
();

342 *
acc
 = 
	`ÃtwÜk_accu¿c›s
(
Ãt
, 
v®
, 
tİk
);

343 
avg_acc
 +ğ
acc
[0];

344 
avg_tİk
 +ğ
acc
[1];

345 
	`´štf
("%d:İ 1: %f,İ %d: %f, %là£cÚds, %d images\n", 
i
, 
avg_acc
/i, 
tİk
, 
avg_tİk
/i, 
	`£c
(
	`şock
()-
time
), 
v®
.
X
.
rows
);

346 
	`ä“_d©a
(
v®
);

348 
	}
}

350 
	$v®id©e_şassif›r_10
(*
d©acfg
, *
f’ame
, *
weightfe
)

352 
i
, 
j
;

353 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

354 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

355 
	`¤ªd
(
	`time
(0));

357 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

359 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

360 *
v®id_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

361 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

362 
tİk
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

364 **
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

365 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_li¡
);

367 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

368 
m
 = 
¶i¡
->
size
;

369 
	`ä“_li¡
(
¶i¡
);

371 
avg_acc
 = 0;

372 
avg_tİk
 = 0;

373 *
šdexes
 = 
	`ÿÎoc
(
tİk
, ());

375 
i
 = 0; i < 
m
; ++i){

376 
şass
 = -1;

377 *
·th
 = 
·ths
[
i
];

378 
j
 = 0; j < 
şas£s
; ++j){

379 if(
	`¡r¡r
(
·th
, 
Ïb–s
[
j
])){

380 
şass
 = 
j
;

384 
w
 = 
Ãt
->w;

385 
h
 = 
Ãt
->h;

386 
shiá
 = 32;

387 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 
w
+
shiá
, 
h
+shift);

388 
image
 
images
[10];

389 
images
[0] = 
	`üİ_image
(
im
, -
shiá
, -shiá, 
w
, 
h
);

390 
images
[1] = 
	`üİ_image
(
im
, 
shiá
, -shiá, 
w
, 
h
);

391 
images
[2] = 
	`üİ_image
(
im
, 0, 0, 
w
, 
h
);

392 
images
[3] = 
	`üİ_image
(
im
, -
shiá
, shiá, 
w
, 
h
);

393 
images
[4] = 
	`üİ_image
(
im
, 
shiá
, shiá, 
w
, 
h
);

394 
	`æ_image
(
im
);

395 
images
[5] = 
	`üİ_image
(
im
, -
shiá
, -shiá, 
w
, 
h
);

396 
images
[6] = 
	`üİ_image
(
im
, 
shiá
, -shiá, 
w
, 
h
);

397 
images
[7] = 
	`üİ_image
(
im
, 0, 0, 
w
, 
h
);

398 
images
[8] = 
	`üİ_image
(
im
, -
shiá
, shiá, 
w
, 
h
);

399 
images
[9] = 
	`üİ_image
(
im
, 
shiá
, shiá, 
w
, 
h
);

400 *
´ed
 = 
	`ÿÎoc
(
şas£s
, ());

401 
j
 = 0; j < 10; ++j){

402 *
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
images
[
j
].
d©a
);

403 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
p
,‚‘->
ouuts
,‚et->hierarchy, 1, 1);

404 
	`axpy_ıu
(
şas£s
, 1, 
p
, 1, 
´ed
, 1);

405 
	`ä“_image
(
images
[
j
]);

407 
	`ä“_image
(
im
);

408 
	`tİ_k
(
´ed
, 
şas£s
, 
tİk
, 
šdexes
);

409 
	`ä“
(
´ed
);

410 if(
šdexes
[0] =ğ
şass
è
avg_acc
 += 1;

411 
j
 = 0; j < 
tİk
; ++j){

412 if(
šdexes
[
j
] =ğ
şass
è
avg_tİk
 += 1;

415 
	`´štf
("%d:İ 1: %f,İ %d: %f\n", 
i
, 
avg_acc
/(i+1), 
tİk
, 
avg_tİk
/(i+1));

417 
	}
}

419 
	$v®id©e_şassif›r_fuÎ
(*
d©acfg
, *
f’ame
, *
weightfe
)

421 
i
, 
j
;

422 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

423 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

424 
	`¤ªd
(
	`time
(0));

426 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

428 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

429 *
v®id_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

430 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

431 
tİk
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

433 **
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

434 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_li¡
);

436 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

437 
m
 = 
¶i¡
->
size
;

438 
	`ä“_li¡
(
¶i¡
);

440 
avg_acc
 = 0;

441 
avg_tİk
 = 0;

442 *
šdexes
 = 
	`ÿÎoc
(
tİk
, ());

444 
size
 = 
Ãt
->
w
;

445 
i
 = 0; i < 
m
; ++i){

446 
şass
 = -1;

447 *
·th
 = 
·ths
[
i
];

448 
j
 = 0; j < 
şas£s
; ++j){

449 if(
	`¡r¡r
(
·th
, 
Ïb–s
[
j
])){

450 
şass
 = 
j
;

454 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

455 
image
 
»sized
 = 
	`»size_mš
(
im
, 
size
);

456 
	`»size_ÃtwÜk
(
Ãt
, 
»sized
.
w
,„esized.
h
);

460 *
´ed
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
»sized
.
d©a
);

461 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
´ed
,‚‘->
ouuts
,‚et->hierarchy, 1, 1);

463 
	`ä“_image
(
im
);

464 
	`ä“_image
(
»sized
);

465 
	`tİ_k
(
´ed
, 
şas£s
, 
tİk
, 
šdexes
);

467 if(
šdexes
[0] =ğ
şass
è
avg_acc
 += 1;

468 
j
 = 0; j < 
tİk
; ++j){

469 if(
šdexes
[
j
] =ğ
şass
è
avg_tİk
 += 1;

472 
	`´štf
("%d:İ 1: %f,İ %d: %f\n", 
i
, 
avg_acc
/(i+1), 
tİk
, 
avg_tİk
/(i+1));

474 
	}
}

477 
	$v®id©e_şassif›r_sšgË
(*
d©acfg
, *
f’ame
, *
weightfe
)

479 
i
, 
j
;

480 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

481 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

482 
	`¤ªd
(
	`time
(0));

484 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

486 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

487 *
Ëaf_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "leaves", 0);

488 if(
Ëaf_li¡
è
	`chªge_Ëaves
(
Ãt
->
h›¿rchy
,†eaf_list);

489 *
v®id_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

490 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

491 
tİk
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

493 **
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

494 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_li¡
);

496 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

497 
m
 = 
¶i¡
->
size
;

498 
	`ä“_li¡
(
¶i¡
);

500 
avg_acc
 = 0;

501 
avg_tİk
 = 0;

502 *
šdexes
 = 
	`ÿÎoc
(
tİk
, ());

504 
i
 = 0; i < 
m
; ++i){

505 
şass
 = -1;

506 *
·th
 = 
·ths
[
i
];

507 
j
 = 0; j < 
şas£s
; ++j){

508 if(
	`¡r¡r
(
·th
, 
Ïb–s
[
j
])){

509 
şass
 = 
j
;

513 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

514 
image
 
üİ
 = 
	`ûÁ”_üİ_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

519 *
´ed
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
üİ
.
d©a
);

520 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
´ed
,‚‘->
ouuts
,‚et->hierarchy, 1, 1);

522 
	`ä“_image
(
im
);

523 
	`ä“_image
(
üİ
);

524 
	`tİ_k
(
´ed
, 
şas£s
, 
tİk
, 
šdexes
);

526 if(
šdexes
[0] =ğ
şass
è
avg_acc
 += 1;

527 
j
 = 0; j < 
tİk
; ++j){

528 if(
šdexes
[
j
] =ğ
şass
è
avg_tİk
 += 1;

531 
	`´štf
("%s, %d, %f, %f, \n", 
·ths
[
i
], 
şass
, 
´ed
[0],…red[1]);

532 
	`´štf
("%d:İ 1: %f,İ %d: %f\n", 
i
, 
avg_acc
/(i+1), 
tİk
, 
avg_tİk
/(i+1));

534 
	}
}

536 
	$v®id©e_şassif›r_muÉi
(*
d©acfg
, *
cfg
, *
weights
)

538 
i
, 
j
;

539 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

540 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

541 
	`¤ªd
(
	`time
(0));

543 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

545 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

546 *
v®id_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

547 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

548 
tİk
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

550 **
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

551 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_li¡
);

553 
sÿËs
[] = {224, 256, 288, 320};

554 
nsÿËs
 = (
sÿËs
)/(scales[0]);

556 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

557 
m
 = 
¶i¡
->
size
;

558 
	`ä“_li¡
(
¶i¡
);

560 
avg_acc
 = 0;

561 
avg_tİk
 = 0;

562 *
šdexes
 = 
	`ÿÎoc
(
tİk
, ());

564 
i
 = 0; i < 
m
; ++i){

565 
şass
 = -1;

566 *
·th
 = 
·ths
[
i
];

567 
j
 = 0; j < 
şas£s
; ++j){

568 if(
	`¡r¡r
(
·th
, 
Ïb–s
[
j
])){

569 
şass
 = 
j
;

573 *
´ed
 = 
	`ÿÎoc
(
şas£s
, ());

574 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

575 
j
 = 0; j < 
nsÿËs
; ++j){

576 
image
 
r
 = 
	`»size_max
(
im
, 
sÿËs
[
j
]);

577 
	`»size_ÃtwÜk
(
Ãt
, 
r
.
w
,„.
h
);

578 *
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
r
.
d©a
);

579 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
p
,‚‘->
ouuts
,‚et->hierarchy, 1 , 1);

580 
	`axpy_ıu
(
şas£s
, 1, 
p
, 1, 
´ed
, 1);

581 
	`æ_image
(
r
);

582 
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
r
.
d©a
);

583 
	`axpy_ıu
(
şas£s
, 1, 
p
, 1, 
´ed
, 1);

584 if(
r
.
d©a
 !ğ
im
.d©aè
	`ä“_image
(r);

586 
	`ä“_image
(
im
);

587 
	`tİ_k
(
´ed
, 
şas£s
, 
tİk
, 
šdexes
);

588 
	`ä“
(
´ed
);

589 if(
šdexes
[0] =ğ
şass
è
avg_acc
 += 1;

590 
j
 = 0; j < 
tİk
; ++j){

591 if(
šdexes
[
j
] =ğ
şass
è
avg_tİk
 += 1;

594 
	`´štf
("%d:İ 1: %f,İ %d: %f\n", 
i
, 
avg_acc
/(i+1), 
tİk
, 
avg_tİk
/(i+1));

596 
	}
}

598 
	$Œy_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
f’ame
, 
Ïy”_num
)

600 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

601 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

602 
	`¤ªd
(2222222);

604 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

606 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", 0);

607 if(!
Çme_li¡
èÇme_li¡ = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

608 
tİ
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

610 
i
 = 0;

611 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

612 
şock_t
 
time
;

613 *
šdexes
 = 
	`ÿÎoc
(
tİ
, ());

614 
buff
[256];

615 *
šput
 = 
buff
;

617 if(
f’ame
){

618 
	`¡ºıy
(
šput
, 
f’ame
, 256);

620 
	`´štf
("Enter Image Path: ");

621 
	`fæush
(
¡dout
);

622 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

623 if(!
šput
) ;

624 
	`¡¹ok
(
šput
, "\n");

626 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

627 
image
 
r
 = 
	`»size_mš
(
Üig
, 256);

628 
image
 
im
 = 
	`üİ_image
(
r
, (r.
w
 - 224 - 1)/2 + 1, (r.
h
 - 224 - 1)/2 + 1, 224, 224);

629 
m—n
[] = {0.48263312050943, 0.45230225481413, 0.40099074308742};

630 
¡d
[] = {0.22590347483426, 0.22120921437787, 0.22103996251583};

631 
v¬
[3];

632 
v¬
[0] = 
¡d
[0]*std[0];

633 
v¬
[1] = 
¡d
[1]*std[1];

634 
v¬
[2] = 
¡d
[2]*std[2];

636 
	`nÜm®ize_ıu
(
im
.
d©a
, 
m—n
, 
v¬
, 1, 3, im.
w
*im.
h
);

638 *
X
 = 
im
.
d©a
;

639 
time
=
	`şock
();

640 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

642 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
Ïy”_num
];

643 
i
 = 0; i < 
l
.
c
; ++i){

644 if(
l
.
rŞlšg_m—n
è
	`´štf
("%à%à%f\n",†.rŞlšg_m—n[
i
],†.
rŞlšg_v¬Ÿnû
[i],†.
sÿËs
[i]);

646 #ifdeà
GPU


647 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
ouuts
);

649 
i
 = 0; i < 
l
.
ouuts
; ++i){

650 
	`´štf
("%f\n", 
l
.
ouut
[
i
]);

665 
	`tİ_´ediùiÚs
(
Ãt
, 
tİ
, 
šdexes
);

666 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

667 
i
 = 0; i < 
tİ
; ++i){

668 
šdex
 = 
šdexes
[
i
];

669 
	`´štf
("%s: %f\n", 
Çmes
[
šdex
], 
´ediùiÚs
[index]);

671 
	`ä“_image
(
im
);

672 ià(
f’ame
) ;

674 
	}
}

676 
	$·r£_Ï¡_Ïy”
(*
fesize
)

682 
šputs
;

683 
b©ch
 = 1;

684 
FILE
 *
å
 = 
	`fİ’
(
fesize
, "r");

685 
	`fsÿnf
(
å
, "%d", &
šputs
);

687 if(
šputs
 <= 0)

689 
	`´štf
("Error„eading value from file\n");

693 
šputs
 /= ();

694 
šputs
 /ğ
b©ch
;

695 
	`mem£t
((*)&
¦
, 0, (
Ïy”
));

696 
¦
.
šputs
 = inputs;

697 
¦
.
ouuts
 = 
šputs
;

699 
¦
.
groups
 = 1;

700 
¦
.
b©ch
 = batch;

702 
¦
.
‹m³¿tu»
 = 1;

705 
¦
.
w
 = 0;

706 
¦
.
h
 = 0;

707 
¦
.
c
 = 0;

708 
¦
.
¥©Ÿl
 = 0;

709 
¦
.
nŞoss
 = 0;

711 
	`make_soámax_Ïy”_CA
(
¦
.
b©ch
, sl.
šputs
, sl.
groups
, sl.
‹m³¿tu»
, sl.
w
, sl.
h
, sl.
c
, sl.
¥©Ÿl
, sl.
nŞoss
);

713 
	}
}

715 
	$´ediù_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
f’ame
, 
tİ
)

717 
şock_t
 
time
;

718 
time
=
	`şock
();

719 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

720 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

722 
	`¤ªd
(2222222);

724 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

726 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", 0);

727 if(!
Çme_li¡
èÇme_li¡ = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", "data/labels.list");

728 if(
tİ
 =ğ0ètİ = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

730 
i
 = 0;

731 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

733 *
šdexes
 = 
	`ÿÎoc
(
tİ
, ());

734 
buff
[256];

735 *
šput
 = 
buff
;

737 if(
f’ame
){

738 
	`¡ºıy
(
šput
, 
f’ame
, 256);

740 
	`´štf
("Enter Image Path: ");

741 
	`fæush
(
¡dout
);

742 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

743 if(!
šput
) ;

744 
	`¡¹ok
(
šput
, "\n");

746 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

747 
image
 
r
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

753 *
X
 = 
r
.
d©a
;

755 
Ãt_g_bufãr
 = (
ušt8_t
 *)
	`ÿÎoc
(1,16);

756 
time
=
	`şock
();

757 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 1];

758 
	`´štf
("\n Run forward…ropagation.....\n");

759 *
·¹Ÿl_»suÉs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

760 
	`´štf
("Done....\n");

762 
tÙ®_size
 = 
l
.
ouuts
 *†.
b©ch
;

764 
	`´štf
("\ÀTÙ® sizğ%d\n",
tÙ®_size
*());

786 
ouut_fe
[100];

787 
ouut_g
[80];

788 
	`¡rıy
(
ouut_fe
, "data/darknet/partial_outputs_trustzone.data");

789 
	`årštf
(
¡d”r
, "Savšg…¬tŸÈouut tØ%s\n", 
ouut_fe
);

790 
	`¡rıy
(
ouut_g
, "data/darknet/tag_trustzone.data");

791 
	`årštf
(
¡d”r
, "Savšg g’”©ed GCMagØ%s\n", 
ouut_g
);

792 
FILE
 *
å
 = 
	`fİ’
(
ouut_fe
, "wb");

793 
FILE
 *
å_1
 = 
	`fİ’
(
ouut_g
, "wb");

794 if(!
å
è
	`fe_”rÜ
(
ouut_fe
);

795 if(!
å_1
è
	`fe_”rÜ
(
ouut_g
);

797 
	`fwr™e
(
·¹Ÿl_»suÉs
, (), 
tÙ®_size
, 
å
);

798 
	`fwr™e
(
Ãt_g_bufãr
, 1, 16, 
å_1
);

800 
	`ä“
(
Ãt_ouut_back
);

802 
	`mem£t
(
Ãt_g_bufãr
, 0, 16);

804 if(
r
.
d©a
 !ğ
im
.d©aè
	`ä“_image
(r);

805 
	`ä“_image
(
im
);

806 
	`fşo£
(
å
);

807 
	`fşo£
(
å_1
);

810 
	`´štf
("\nSending…artial„esultso SGX\n");

811 
¡©us
 = 0;

834 
¡©us
 = 
	`Sock‘_Cl›Á
(
ouut_fe
, 
ouut_g
, 5000, 0);

835 if(
¡©us
 != 0)

837 
	`´štf
("\nFile sending failed...\n");

838 
	`ex™
(1);

840 
	`´štf
("Done.....\n");

842 
	`årštf
(
¡d”r
, "Lay” ´oûs£d iÀ%à£cÚds.\n", 
	`£c
(
	`şock
()-
time
));

845 
	`´štf
("\nWait for…artial„esults from SGX\n");

846 
¡©us
 = 
	`Sock‘_S”v”
("d©a/d¬kÃt/·¹Ÿl_ouuts_sgx.d©a", "d©a/d¬kÃt/fesize.txt", "d©a/d¬kÃt/g_sgx.d©a", "d©a/d¬kÃt/g_size.txt", &
time
, 5000, 0);

847 if(
¡©us
 != 0)

849 
	`´štf
("\nFile„eceiving failed...\n");

850 
	`ex™
(1);

852 
	`´štf
("Done....\n");

856 *
fesize
 = "data/darknet/filesize.txt";

857 *
g_bufãr
 = "data/darknet/tag_sgx.data";

859 *
·¹_»suÉ
 = "data/darknet/partial_outputs_sgx.data";

862 
FILE
 *
å1
 = 
	`fİ’
(
g_bufãr
, "rb");

863 if(!
å1
è
	`fe_”rÜ
(
g_bufãr
);

864 
	`ä—d
(
Ãt_g_bufãr
, 1, 16, 
å1
);

866 
	`´štf
("Createhe softmax†ayer\n");

867 
¡©us
 = 
	`·r£_Ï¡_Ïy”
(
fesize
);

869 if(
¡©us
 != 0)

871 
	`´štf
("\nSoftmax†ayer creation failed...\n");

872 
	`ex™
(1);

875 
	`´štf
("\nPredict final„esults from…artial outputs\n");

876 
	`´štf
("Run softmax†ayer for…rediction\n");

877 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù_soámax
(
·¹_»suÉ
);

880 
	`tİ_k
(
´ediùiÚs
, 
¦
.
ouuts
, 
tİ
, 
šdexes
);

882 
	`årštf
(
¡d”r
, "\nLay” ´oûs£d iÀ%à£cÚds.\n", 
	`£c
(
	`şock
()-
time
));

887 
	`´štf
("\n\n\nFinal…rediction is : \n");

888 
i
 = 0; i < 
tİ
; ++i){

889 
šdex
 = 
šdexes
[
i
];

892 
	`´štf
("%5.2f%%: %s\n", 
´ediùiÚs
[
šdex
]*100, 
Çmes
[index]);

894 
	`´štf
("\n\n");

896 
	`ä“
(
Ãt_g_bufãr
);

898 ià(
f’ame
) ;

900 
	}
}

903 
	$Ïb–_şassif›r
(*
d©acfg
, *
f’ame
, *
weightfe
)

905 
i
;

906 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

907 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

908 
	`¤ªd
(
	`time
(0));

910 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

912 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", "data/labels.list");

913 *
‹¡_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "test", "data/train.list");

914 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

916 **
Ïb–s
 = 
	`g‘_Ïb–s
(
Ïb–_li¡
);

917 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
‹¡_li¡
);

919 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

920 
m
 = 
¶i¡
->
size
;

921 
	`ä“_li¡
(
¶i¡
);

923 
i
 = 0; i < 
m
; ++i){

924 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

925 
image
 
»sized
 = 
	`»size_mš
(
im
, 
Ãt
->
w
);

926 
image
 
üİ
 = 
	`üİ_image
(
»sized
, (»sized.
w
 - 
Ãt
->w)/2, (»sized.
h
 -‚et->h)/2,‚et->w,‚et->h);

927 *
´ed
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
üİ
.
d©a
);

929 if(
»sized
.
d©a
 !ğ
im
.d©aè
	`ä“_image
(resized);

930 
	`ä“_image
(
im
);

931 
	`ä“_image
(
üİ
);

932 
šd
 = 
	`max_šdex
(
´ed
, 
şas£s
);

934 
	`´štf
("%s\n", 
Ïb–s
[
šd
]);

936 
	}
}

938 
	$csv_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
)

940 
i
,
j
;

941 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

942 
	`¤ªd
(
	`time
(0));

944 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

946 *
‹¡_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "test", "data/test.list");

947 
tİ
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

949 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
‹¡_li¡
);

951 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

952 
m
 = 
¶i¡
->
size
;

953 
	`ä“_li¡
(
¶i¡
);

954 *
šdexes
 = 
	`ÿÎoc
(
tİ
, ());

956 
i
 = 0; i < 
m
; ++i){

957 
time
 = 
	`wh©_time_is_™_now
();

958 *
·th
 = 
·ths
[
i
];

959 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·th
, 0, 0);

960 
image
 
r
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

961 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
r
.
d©a
);

962 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
´ediùiÚs
,‚‘->
ouuts
,‚et->hierarchy, 1, 1);

963 
	`tİ_k
(
´ediùiÚs
, 
Ãt
->
ouuts
, 
tİ
, 
šdexes
);

965 
	`´štf
("%s", 
·th
);

966 
j
 = 0; j < 
tİ
; ++j){

967 
	`´štf
("\t%d", 
šdexes
[
j
]);

969 
	`´štf
("\n");

971 
	`ä“_image
(
im
);

972 
	`ä“_image
(
r
);

974 
	`årštf
(
¡d”r
, "%là£cÚds, %d images, %dÙ®\n", 
	`wh©_time_is_™_now
(è- 
time
, 
i
+1, 
m
);

976 
	}
}

978 
	$‹¡_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, 
rg‘_Ïy”
)

980 
cu¼
 = 0;

981 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

982 
	`¤ªd
(
	`time
(0));

984 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

986 *
‹¡_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "test", "data/test.list");

987 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

989 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
‹¡_li¡
);

991 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

992 
m
 = 
¶i¡
->
size
;

993 
	`ä“_li¡
(
¶i¡
);

995 
şock_t
 
time
;

997 
d©a
 
v®
, 
bufãr
;

999 
lßd_¬gs
 
¬gs
 = {0};

1000 
¬gs
.
w
 = 
Ãt
->w;

1001 
¬gs
.
h
 = 
Ãt
->h;

1002 
¬gs
.
·ths
 =…aths;

1003 
¬gs
.
şas£s
 = classes;

1004 
¬gs
.
n
 = 
Ãt
->
b©ch
;

1005 
¬gs
.
m
 = 0;

1006 
¬gs
.
Ïb–s
 = 0;

1007 
¬gs
.
d
 = &
bufãr
;

1008 
¬gs
.
ty³
 = 
OLD_CLASSIFICATION_DATA
;

1010 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

1011 
cu¼
 = 
Ãt
->
b©ch
; cu¼ < 
m
; curr +=‚et->batch){

1012 
time
=
	`şock
();

1014 
	`±h»ad_još
(
lßd_th»ad
, 0);

1015 
v®
 = 
bufãr
;

1017 if(
cu¼
 < 
m
){

1018 
¬gs
.
·ths
 =…©h + 
cu¼
;

1019 ià(
cu¼
 + 
Ãt
->
b©ch
 > 
m
è
¬gs
.
n
 = m - curr;

1020 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

1022 
	`årštf
(
¡d”r
, "Lßded: %d image š %là£cÚds\n", 
v®
.
X
.
rows
, 
	`£c
(
	`şock
()-
time
));

1024 
time
=
	`şock
();

1025 
m©rix
 
´ed
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
v®
);

1027 
i
, 
j
;

1028 ià(
rg‘_Ïy”
 >= 0){

1032 
i
 = 0; i < 
´ed
.
rows
; ++i){

1033 
	`´štf
("%s", 
·ths
[
cu¼
-
Ãt
->
b©ch
+
i
]);

1034 
j
 = 0; j < 
´ed
.
cŞs
; ++j){

1035 
	`´štf
("\t%g", 
´ed
.
v®s
[
i
][
j
]);

1037 
	`´štf
("\n");

1040 
	`ä“_m©rix
(
´ed
);

1042 
	`årštf
(
¡d”r
, "%là£cÚds, %d images, %dÙ®\n", 
	`£c
(
	`şock
()-
time
), 
v®
.
X
.
rows
, 
cu¼
);

1043 
	`ä“_d©a
(
v®
);

1045 
	}
}

1047 
	$fe_ouut_şassif›r
(*
d©acfg
, *
f’ame
, *
weightfe
, *
li¡fe
)

1049 
i
,
j
;

1050 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

1051 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

1052 
	`¤ªd
(
	`time
(0));

1054 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

1057 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

1059 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
li¡fe
);

1061 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

1062 
m
 = 
¶i¡
->
size
;

1063 
	`ä“_li¡
(
¶i¡
);

1065 
i
 = 0; i < 
m
; ++i){

1066 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

1067 
image
 
»sized
 = 
	`»size_mš
(
im
, 
Ãt
->
w
);

1068 
image
 
üİ
 = 
	`üİ_image
(
»sized
, (»sized.
w
 - 
Ãt
->w)/2, (»sized.
h
 -‚et->h)/2,‚et->w,‚et->h);

1070 *
´ed
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
üİ
.
d©a
);

1071 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
´ed
,‚‘->
ouuts
,‚et->hierarchy, 0, 1);

1073 if(
»sized
.
d©a
 !ğ
im
.d©aè
	`ä“_image
(resized);

1074 
	`ä“_image
(
im
);

1075 
	`ä“_image
(
üİ
);

1077 
	`´štf
("%s", 
·ths
[
i
]);

1078 
j
 = 0; j < 
şas£s
; ++j){

1079 
	`´štf
("\t%g", 
´ed
[
j
]);

1081 
	`´štf
("\n");

1083 
	}
}

1086 
	$th»©_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, 
ÿm_šdex
, cÚ¡ *
f’ame
)

1088 #ifdeà
OPENCV


1089 
th»©
 = 0;

1090 
rŞl
 = .2;

1092 
	`´štf
("Classifier Demo\n");

1093 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

1094 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

1095 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

1097 
	`¤ªd
(2222222);

1098 * 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 
ÿm_šdex
, 0,0,0);

1100 
tİ
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

1102 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", 0);

1103 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

1105 *
šdexes
 = 
	`ÿÎoc
(
tİ
, ());

1107 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

1110 
ås
 = 0;

1111 
i
;

1113 
couÁ
 = 0;

1116 ++
couÁ
;

1117 
timev®
 
tv®_befÜe
, 
tv®_aá”
, 
tv®_»suÉ
;

1118 
	`g‘timeofday
(&
tv®_befÜe
, 
NULL
);

1120 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

1121 if(!
š
.
d©a
) ;

1122 
image
 
š_s
 = 
	`»size_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

1124 
image
 
out
 = 
š
;

1125 
x1
 = 
out
.
w
 / 20;

1126 
y1
 = 
out
.
h
 / 20;

1127 
x2
 = 2*
x1
;

1128 
y2
 = 
out
.
h
 - out.h/20;

1130 
bÜd”
 = .01*
out
.
h
;

1131 
h
 = 
y2
 - 
y1
 - 2*
bÜd”
;

1132 
w
 = 
x2
 - 
x1
 - 2*
bÜd”
;

1134 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
š_s
.
d©a
);

1135 
cu¼_th»©
 = 0;

1137 
cu¼_th»©
 = 
´ediùiÚs
[0] * 0 +

1138 
´ediùiÚs
[1] * .6 +

1139 
´ediùiÚs
[2];

1141 
cu¼_th»©
 = 
´ediùiÚs
[218] +

1142 
´ediùiÚs
[539] +

1143 
´ediùiÚs
[540] +

1144 
´ediùiÚs
[368] +

1145 
´ediùiÚs
[369] +

1146 
´ediùiÚs
[370];

1148 
th»©
 = 
rŞl
 * 
cu¼_th»©
 + (1-roll) *hreat;

1150 
	`d¿w_box_width
(
out
, 
x2
 + 
bÜd”
, 
y1
 + .02*
h
, x2 + .5 * 
w
, y1 + .02*h + border, border, 0,0,0);

1151 if(
th»©
 > .97) {

1152 
	`d¿w_box_width
(
out
, 
x2
 + .5 * 
w
 + 
bÜd”
,

1153 
y1
 + .02*
h
 - 2*
bÜd”
,

1154 
x2
 + .5 * 
w
 + 6*
bÜd”
,

1155 
y1
 + .02*
h
 + 3*
bÜd”
, 3*border, 1,0,0);

1157 
	`d¿w_box_width
(
out
, 
x2
 + .5 * 
w
 + 
bÜd”
,

1158 
y1
 + .02*
h
 - 2*
bÜd”
,

1159 
x2
 + .5 * 
w
 + 6*
bÜd”
,

1160 
y1
 + .02*
h
 + 3*
bÜd”
, .5*border, 0,0,0);

1161 
	`d¿w_box_width
(
out
, 
x2
 + 
bÜd”
, 
y1
 + .42*
h
, x2 + .5 * 
w
, y1 + .42*h + border, border, 0,0,0);

1162 if(
th»©
 > .57) {

1163 
	`d¿w_box_width
(
out
, 
x2
 + .5 * 
w
 + 
bÜd”
,

1164 
y1
 + .42*
h
 - 2*
bÜd”
,

1165 
x2
 + .5 * 
w
 + 6*
bÜd”
,

1166 
y1
 + .42*
h
 + 3*
bÜd”
, 3*border, 1,1,0);

1168 
	`d¿w_box_width
(
out
, 
x2
 + .5 * 
w
 + 
bÜd”
,

1169 
y1
 + .42*
h
 - 2*
bÜd”
,

1170 
x2
 + .5 * 
w
 + 6*
bÜd”
,

1171 
y1
 + .42*
h
 + 3*
bÜd”
, .5*border, 0,0,0);

1173 
	`d¿w_box_width
(
out
, 
x1
, 
y1
, 
x2
, 
y2
, 
bÜd”
, 0,0,0);

1174 
i
 = 0; i < 
th»©
 * 
h
 ; ++i){

1175 
¿tio
 = (è
i
 / 
h
;

1176 
r
 = (
¿tio
 < .5) ? (2*(ratio)) : 1;

1177 
g
 = (
¿tio
 < .5) ? 1 : 1 - 2*(ratio - .5);

1178 
	`d¿w_box_width
(
out
, 
x1
 + 
bÜd”
, 
y2
 - bÜd” - 
i
, 
x2
 - bÜd”, y2 - bÜd” - i, 1, 
r
, 
g
, 0);

1180 
	`tİ_´ediùiÚs
(
Ãt
, 
tİ
, 
šdexes
);

1181 
buff
[256];

1182 
	`¥rštf
(
buff
, "/home/pj»dd›/tmp/th»©_%06d", 
couÁ
);

1185 
	`´štf
("\033[2J");

1186 
	`´štf
("\033[1;1H");

1187 
	`´štf
("\nFPS:%.0f\n",
ås
);

1189 
i
 = 0; i < 
tİ
; ++i){

1190 
šdex
 = 
šdexes
[
i
];

1191 
	`´štf
("%.1f%%: %s\n", 
´ediùiÚs
[
šdex
]*100, 
Çmes
[index]);

1195 
	`show_image
(
out
, "Threat", 10);

1197 
	`ä“_image
(
š_s
);

1198 
	`ä“_image
(
š
);

1200 
	`g‘timeofday
(&
tv®_aá”
, 
NULL
);

1201 
	`tim”sub
(&
tv®_aá”
, &
tv®_befÜe
, &
tv®_»suÉ
);

1202 
cu¼
 = 1000000.f/(()
tv®_»suÉ
.
tv_u£c
);

1203 
ås
 = .9*å + .1*
cu¼
;

1206 
	}
}

1209 
	$gun_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, 
ÿm_šdex
, cÚ¡ *
f’ame
)

1211 #ifdeà
OPENCV


1212 
bad_ÿts
[] = {218, 539, 540, 1213, 1501, 1742, 1911, 2415, 4348, 19223, 368, 369, 370, 1133, 1200, 1306, 2122, 2301, 2537, 2823, 3179, 3596, 3639, 4489, 5107, 5140, 5289, 6240, 6631, 6762, 7048, 7171, 7969, 7984, 7989, 8824, 8927, 9915, 10270, 10448, 13401, 15205, 18358, 18894, 18895, 19249, 19697};

1214 
	`´štf
("Classifier Demo\n");

1215 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

1216 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

1217 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

1219 
	`¤ªd
(2222222);

1220 * 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 
ÿm_šdex
, 0,0,0);

1222 
tİ
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

1224 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", 0);

1225 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

1227 *
šdexes
 = 
	`ÿÎoc
(
tİ
, ());

1229 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

1230 
ås
 = 0;

1231 
i
;

1234 
timev®
 
tv®_befÜe
, 
tv®_aá”
, 
tv®_»suÉ
;

1235 
	`g‘timeofday
(&
tv®_befÜe
, 
NULL
);

1237 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

1238 
image
 
š_s
 = 
	`»size_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

1240 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
š_s
.
d©a
);

1241 
	`tİ_´ediùiÚs
(
Ãt
, 
tİ
, 
šdexes
);

1243 
	`´štf
("\033[2J");

1244 
	`´štf
("\033[1;1H");

1246 
th»©
 = 0;

1247 
i
 = 0; i < (
bad_ÿts
)/(bad_cats[0]); ++i){

1248 
šdex
 = 
bad_ÿts
[
i
];

1249 if(
´ediùiÚs
[
šdex
] > .01){

1250 
	`´štf
("Threat Detected!\n");

1251 
th»©
 = 1;

1255 if(!
th»©
è
	`´štf
("Scanning...\n");

1256 
i
 = 0; i < (
bad_ÿts
)/(bad_cats[0]); ++i){

1257 
šdex
 = 
bad_ÿts
[
i
];

1258 if(
´ediùiÚs
[
šdex
] > .01){

1259 
	`´štf
("%s\n", 
Çmes
[
šdex
]);

1263 
	`show_image
(
š
, "Threat Detection", 10);

1264 
	`ä“_image
(
š_s
);

1265 
	`ä“_image
(
š
);

1267 
	`g‘timeofday
(&
tv®_aá”
, 
NULL
);

1268 
	`tim”sub
(&
tv®_aá”
, &
tv®_befÜe
, &
tv®_»suÉ
);

1269 
cu¼
 = 1000000.f/(()
tv®_»suÉ
.
tv_u£c
);

1270 
ås
 = .9*å + .1*
cu¼
;

1273 
	}
}

1275 
	$demo_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, 
ÿm_šdex
, cÚ¡ *
f’ame
)

1277 #ifdeà
OPENCV


1278 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

1279 
image
 **
®phab‘
 = 
	`lßd_®phab‘
();

1280 
	`´štf
("Classifier Demo\n");

1281 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

1282 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

1283 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

1285 
	`¤ªd
(2222222);

1287 
w
 = 1280;

1288 
h
 = 720;

1289 * 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 
ÿm_šdex
, 
w
, 
h
, 0);

1291 
tİ
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "top", 1);

1293 *
Ïb–_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", 0);

1294 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "Çmes", 
Ïb–_li¡
);

1295 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

1297 *
šdexes
 = 
	`ÿÎoc
(
tİ
, ());

1299 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

1300 
ås
 = 0;

1301 
i
;

1304 
timev®
 
tv®_befÜe
, 
tv®_aá”
, 
tv®_»suÉ
;

1305 
	`g‘timeofday
(&
tv®_befÜe
, 
NULL
);

1307 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

1309 
image
 
š_s
 = 
	`Ë‰”box_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

1311 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
š_s
.
d©a
);

1312 if(
Ãt
->
h›¿rchy
è
	`h›¿rchy_´ediùiÚs
(
´ediùiÚs
,‚‘->
ouuts
,‚et->hierarchy, 1, 1);

1313 
	`tİ_´ediùiÚs
(
Ãt
, 
tİ
, 
šdexes
);

1315 
	`´štf
("\033[2J");

1316 
	`´štf
("\033[1;1H");

1317 
	`´štf
("\nFPS:%.0f\n",
ås
);

1319 
lh
 = 
š
.
h
*.03;

1320 
tİh
 = 3*
lh
;

1322 
rgb
[3] = {1,1,1};

1323 
i
 = 0; i < 
tİ
; ++i){

1324 
	`´štf
("%d\n", 
tİh
);

1325 
šdex
 = 
šdexes
[
i
];

1326 
	`´štf
("%.1f%%: %s\n", 
´ediùiÚs
[
šdex
]*100, 
Çmes
[index]);

1328 
buff
[1024];

1329 
	`¥rštf
(
buff
, "%3.1f%%: %s\n", 
´ediùiÚs
[
šdex
]*100, 
Çmes
[index]);

1330 
image
 
Ïb–
 = 
	`g‘_Ïb–
(
®phab‘
, 
buff
, 
lh
);

1331 
	`d¿w_Ïb–
(
š
, 
tİh
, 
lh
, 
Ïb–
, 
rgb
);

1332 
tİh
 +ğ2*
lh
;

1333 
	`ä“_image
(
Ïb–
);

1336 
	`show_image
(
š
, 
ba£
, 10);

1337 
	`ä“_image
(
š_s
);

1338 
	`ä“_image
(
š
);

1340 
	`g‘timeofday
(&
tv®_aá”
, 
NULL
);

1341 
	`tim”sub
(&
tv®_aá”
, &
tv®_befÜe
, &
tv®_»suÉ
);

1342 
cu¼
 = 1000000.f/(()
tv®_»suÉ
.
tv_u£c
);

1343 
ås
 = .9*å + .1*
cu¼
;

1346 
	}
}

1349 
	$run_şassif›r
(
¬gc
, **
¬gv
)

1351 if(
¬gc
 < 4){

1352 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

1356 *
gpu_li¡
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-gpus", 0);

1357 
ngpus
;

1358 *
gpus
 = 
	`»ad_ši¡
(
gpu_li¡
, &
ngpus
, 
gpu_šdex
);

1361 
µ
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-pp", 5);

1362 
·¹™iÚ_pošt
 = 
µ
 - 1;

1363 
dp
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-dp", -1);

1364 
glob®_dp
 = 
dp
;

1365 
gµ
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-gpp", 1);

1366 
glob®_·¹™iÚ
 = 
gµ
;

1368 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

1369 
tİ
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-t", 0);

1370 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

1371 *
d©a
 = 
¬gv
[3];

1372 *
cfg
 = 
¬gv
[4];

1373 *
weights
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

1374 *
f’ame
 = (
¬gc
 > 6è? 
¬gv
[6]: 0;

1375 *
Ïy”_s
 = (
¬gc
 > 7è? 
¬gv
[7]: 0;

1376 
Ïy”
 = 
Ïy”_s
 ? 
	`©oi
(layer_s) : -1;

1377 if(0==
	`¡rcmp
(
¬gv
[2], "predict")) {

1378 
¡©e
 = 'p';

1379 
	`´ediù_şassif›r
(
d©a
, 
cfg
, 
weights
, 
f’ame
, 
tİ
);

1381 if(0==
	`¡rcmp
(
¬gv
[2], "fout")è
	`fe_ouut_şassif›r
(
d©a
, 
cfg
, 
weights
, 
f’ame
);

1382 if(0==
	`¡rcmp
(
¬gv
[2], "Œy")è
	`Œy_şassif›r
(
d©a
, 
cfg
, 
weights
, 
f’ame
, 
	`©oi
(
Ïy”_s
));

1383 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_şassif›r
(
d©a
, 
cfg
, 
weights
, 
gpus
, 
ngpus
, 
ş—r
);

1384 if(0==
	`¡rcmp
(
¬gv
[2], "demo")è
	`demo_şassif›r
(
d©a
, 
cfg
, 
weights
, 
ÿm_šdex
, 
f’ame
);

1385 if(0==
	`¡rcmp
(
¬gv
[2], "gun")è
	`gun_şassif›r
(
d©a
, 
cfg
, 
weights
, 
ÿm_šdex
, 
f’ame
);

1386 if(0==
	`¡rcmp
(
¬gv
[2], "th»©")è
	`th»©_şassif›r
(
d©a
, 
cfg
, 
weights
, 
ÿm_šdex
, 
f’ame
);

1387 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_şassif›r
(
d©a
, 
cfg
, 
weights
, 
Ïy”
);

1388 if(0==
	`¡rcmp
(
¬gv
[2], "csv")è
	`csv_şassif›r
(
d©a
, 
cfg
, 
weights
);

1389 if(0==
	`¡rcmp
(
¬gv
[2], "Ïb–")è
	`Ïb–_şassif›r
(
d©a
, 
cfg
, 
weights
);

1390 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id©e_şassif›r_sšgË
(
d©a
, 
cfg
, 
weights
);

1391 if(0==
	`¡rcmp
(
¬gv
[2], "v®idmuÉi")è
	`v®id©e_şassif›r_muÉi
(
d©a
, 
cfg
, 
weights
);

1392 if(0==
	`¡rcmp
(
¬gv
[2], "v®id10")è
	`v®id©e_şassif›r_10
(
d©a
, 
cfg
, 
weights
);

1393 if(0==
	`¡rcmp
(
¬gv
[2], "v®idüİ")è
	`v®id©e_şassif›r_üİ
(
d©a
, 
cfg
, 
weights
);

1394 if(0==
	`¡rcmp
(
¬gv
[2], "v®idfuÎ")è
	`v®id©e_şassif›r_fuÎ
(
d©a
, 
cfg
, 
weights
);

1395 
	}
}

	@host/examples/coco.c

1 
	~"d¬kÃt.h
"

3 
	~<¡dio.h
>

5 *
	gcoco_şas£s
[] = {"person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic†ight","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis„acket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted…lant","bed","diningable","toilet","tv","laptop","mouse","remote","keyboard","cell…hone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"};

7 
	gcoco_ids
[] = {1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24,25,27,28,31,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,67,70,72,73,74,75,76,77,78,79,80,81,82,84,85,86,87,88,89,90};

9 
	$Œaš_coco
(*
cfgfe
, *
weightfe
)

13 *
Œaš_images
 = "data/coco.trainval.txt";

15 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

16 
	`¤ªd
(
	`time
(0));

17 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

18 
	`´štf
("%s\n", 
ba£
);

19 
avg_loss
 = -1;

20 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

21 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

22 
imgs
 = 
Ãt
->
b©ch
*Ãt->
subdivisiÚs
;

23 
i
 = *
Ãt
->
£’
/
imgs
;

24 
d©a
 
Œaš
, 
bufãr
;

27 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 1];

29 
side
 = 
l
.side;

30 
şas£s
 = 
l
.classes;

31 
j™‹r
 = 
l
.jitter;

33 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

35 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

37 
lßd_¬gs
 
¬gs
 = {0};

38 
¬gs
.
w
 = 
Ãt
->w;

39 
¬gs
.
h
 = 
Ãt
->h;

40 
¬gs
.
·ths
 =…aths;

41 
¬gs
.
n
 = 
imgs
;

42 
¬gs
.
m
 = 
¶i¡
->
size
;

43 
¬gs
.
şas£s
 = classes;

44 
¬gs
.
j™‹r
 = jitter;

45 
¬gs
.
num_boxes
 = 
side
;

46 
¬gs
.
d
 = &
bufãr
;

47 
¬gs
.
ty³
 = 
REGION_DATA
;

49 
¬gs
.
ªgË
 = 
Ãt
->angle;

50 
¬gs
.
exposu»
 = 
Ãt
->exposure;

51 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

52 
¬gs
.
hue
 = 
Ãt
->hue;

54 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

55 
şock_t
 
time
;

57 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
){

58 
i
 += 1;

59 
time
=
	`şock
();

60 
	`±h»ad_još
(
lßd_th»ad
, 0);

61 
Œaš
 = 
bufãr
;

62 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

64 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

74 
time
=
	`şock
();

75 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

76 ià(
avg_loss
 < 0èavg_los ğ
loss
;

77 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

79 
	`´štf
("%d: %f, %àavg, %à¿‹, %là£cÚds, %d images\n", 
i
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
(
Ãt
), 
	`£c
(
	`şock
()-
time
), i*
imgs
);

80 if(
i
%1000==0 || (i < 1000 && i%100 == 0)){

81 
buff
[256];

82 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

83 
	`§ve_weights
(
Ãt
, 
buff
);

85 if(
i
%100==0){

86 
buff
[256];

87 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

88 
	`§ve_weights
(
Ãt
, 
buff
);

90 
	`ä“_d©a
(
Œaš
);

92 
buff
[256];

93 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

94 
	`§ve_weights
(
Ãt
, 
buff
);

95 
	}
}

97 
	$´št_cocos
(
FILE
 *
å
, 
image_id
, 
d‘eùiÚ
 *
d‘s
, 
num_boxes
, 
şas£s
, 
w
, 
h
)

99 
i
, 
j
;

100 
i
 = 0; i < 
num_boxes
; ++i){

101 
xmš
 = 
d‘s
[
i
].
bbox
.
x
 - d‘s[i].bbox.
w
/2.;

102 
xmax
 = 
d‘s
[
i
].
bbox
.
x
 + d‘s[i].bbox.
w
/2.;

103 
ymš
 = 
d‘s
[
i
].
bbox
.
y
 - d‘s[i].bbox.
h
/2.;

104 
ymax
 = 
d‘s
[
i
].
bbox
.
y
 + d‘s[i].bbox.
h
/2.;

106 ià(
xmš
 < 0) xmin = 0;

107 ià(
ymš
 < 0) ymin = 0;

108 ià(
xmax
 > 
w
) xmax = w;

109 ià(
ymax
 > 
h
) ymax = h;

111 
bx
 = 
xmš
;

112 
by
 = 
ymš
;

113 
bw
 = 
xmax
 - 
xmš
;

114 
bh
 = 
ymax
 - 
ymš
;

116 
j
 = 0; j < 
şas£s
; ++j){

117 ià(
d‘s
[
i
].
´ob
[
j
]è
	`årštf
(
å
, "{\"image_id\":%d, \"ÿ‹gÜy_id\":%d, \"bbox\":[%f, %f, %f, %f], \"scÜe\":%f},\n", 
image_id
, 
coco_ids
[j], 
bx
, 
by
, 
bw
, 
bh
, dets[i].prob[j]);

120 
	}
}

122 
	$g‘_coco_image_id
(*
f’ame
)

124 *
p
 = 
	`¡¼chr
(
f’ame
, '_');

125  
	`©oi
(
p
+1);

126 
	}
}

128 
	$v®id©e_coco
(*
cfg
, *
weights
)

130 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

131 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

132 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

133 
	`¤ªd
(
	`time
(0));

135 *
ba£
 = "results/";

136 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("data/coco_val_5k.list");

139 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

141 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

142 
şas£s
 = 
l
.classes;

144 
buff
[1024];

145 
	`¢´štf
(
buff
, 1024, "%s/coco_»suÉs.jsÚ", 
ba£
);

146 
FILE
 *
å
 = 
	`fİ’
(
buff
, "w");

147 
	`årštf
(
å
, "[\n");

149 
m
 = 
¶i¡
->
size
;

150 
i
=0;

151 
t
;

153 
th»sh
 = .01;

154 
nms
 = 1;

155 
iou_th»sh
 = .5;

157 
Áh»ads
 = 8;

158 
image
 *
v®
 = 
	`ÿÎoc
(
Áh»ads
, (image));

159 
image
 *
v®_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

160 
image
 *
buf
 = 
	`ÿÎoc
(
Áh»ads
, (image));

161 
image
 *
buf_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

162 
±h»ad_t
 *
thr
 = 
	`ÿÎoc
(
Áh»ads
, (pthread_t));

164 
lßd_¬gs
 
¬gs
 = {0};

165 
¬gs
.
w
 = 
Ãt
->w;

166 
¬gs
.
h
 = 
Ãt
->h;

167 
¬gs
.
ty³
 = 
IMAGE_DATA
;

169 
t
 = 0; < 
Áh»ads
; ++t){

170 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

171 
¬gs
.
im
 = &
buf
[
t
];

172 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

173 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

175 
time_t
 
¡¬t
 = 
	`time
(0);

176 
i
 = 
Áh»ads
; i < 
m
+nthreads; i +=‚threads){

177 
	`årštf
(
¡d”r
, "%d\n", 
i
);

178 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

179 
	`±h»ad_još
(
thr
[
t
], 0);

180 
v®
[
t
] = 
buf
[t];

181 
v®_»sized
[
t
] = 
buf_»sized
[t];

183 
t
 = 0; < 
Áh»ads
 && 
i
+ˆ< 
m
; ++t){

184 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

185 
¬gs
.
im
 = &
buf
[
t
];

186 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

187 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

189 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

190 *
·th
 = 
·ths
[
i
+
t
-
Áh»ads
];

191 
image_id
 = 
	`g‘_coco_image_id
(
·th
);

192 *
X
 = 
v®_»sized
[
t
].
d©a
;

193 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

194 
w
 = 
v®
[
t
].w;

195 
h
 = 
v®
[
t
].h;

196 
nboxes
 = 0;

197 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
w
, 
h
, 
th»sh
, 0, 0, 0, &
nboxes
);

198 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
l
.
side
*l.side*l.
n
, 
şas£s
, 
iou_th»sh
);

199 
	`´št_cocos
(
å
, 
image_id
, 
d‘s
, 
l
.
side
*l.side*l.
n
, 
şas£s
, 
w
, 
h
);

200 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

201 
	`ä“_image
(
v®
[
t
]);

202 
	`ä“_image
(
v®_»sized
[
t
]);

205 
	`f£ek
(
å
, -2, 
SEEK_CUR
);

206 
	`årštf
(
å
, "\n]\n");

207 
	`fşo£
(
å
);

209 
	`årštf
(
¡d”r
, "TÙ® D‘eùiÚ Time: %àSecÚds\n", ()(
	`time
(0è- 
¡¬t
));

210 
	}
}

212 
	$v®id©e_coco_»ÿÎ
(*
cfgfe
, *
weightfe
)

214 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

215 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

216 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

217 
	`¤ªd
(
	`time
(0));

219 *
ba£
 = "results/comp4_det_test_";

220 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("/home/pjreddie/data/voc/test/2007_test.txt");

221 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

223 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

224 
şas£s
 = 
l
.classes;

225 
side
 = 
l
.side;

227 
j
, 
k
;

228 
FILE
 **
ås
 = 
	`ÿÎoc
(
şas£s
, (FILE *));

229 
j
 = 0; j < 
şas£s
; ++j){

230 
buff
[1024];

231 
	`¢´štf
(
buff
, 1024, "%s%s.txt", 
ba£
, 
coco_şas£s
[
j
]);

232 
ås
[
j
] = 
	`fİ’
(
buff
, "w");

235 
m
 = 
¶i¡
->
size
;

236 
i
=0;

238 
th»sh
 = .001;

239 
nms
 = 0;

240 
iou_th»sh
 = .5;

242 
tÙ®
 = 0;

243 
cÜ»ù
 = 0;

244 
´İo§ls
 = 0;

245 
avg_iou
 = 0;

247 
i
 = 0; i < 
m
; ++i){

248 *
·th
 = 
·ths
[
i
];

249 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
·th
, 0, 0);

250 
image
 
sized
 = 
	`»size_image
(
Üig
, 
Ãt
->
w
,‚‘->
h
);

251 *
id
 = 
	`ba£cfg
(
·th
);

252 
	`ÃtwÜk_´ediù
(
Ãt
, 
sized
.
d©a
);

254 
nboxes
 = 0;

255 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
Üig
.
w
, orig.
h
, 
th»sh
, 0, 0, 1, &
nboxes
);

256 ià(
nms
è
	`do_nms_obj
(
d‘s
, 
side
*side*
l
.
n
, 1,‚ms);

258 
Ïb–·th
[4096];

259 
	`fšd_»¶aû
(
·th
, "images", "Ïb–s", 
Ïb–·th
);

260 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

261 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

262 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

264 
num_Ïb–s
 = 0;

265 
box_Ïb–
 *
Œuth
 = 
	`»ad_boxes
(
Ïb–·th
, &
num_Ïb–s
);

266 
k
 = 0; k < 
side
*side*
l
.
n
; ++k){

267 if(
d‘s
[
k
].
objeùÃss
 > 
th»sh
){

268 ++
´İo§ls
;

271 
j
 = 0; j < 
num_Ïb–s
; ++j) {

272 ++
tÙ®
;

273 
box
 
t
 = {
Œuth
[
j
].
x
,ruth[j].
y
,ruth[j].
w
,ruth[j].
h
};

274 
be¡_iou
 = 0;

275 
k
 = 0; k < 
side
*side*
l
.
n
; ++k){

276 
iou
 = 
	`box_iou
(
d‘s
[
k
].
bbox
, 
t
);

277 if(
d‘s
[
k
].
objeùÃss
 > 
th»sh
 && 
iou
 > 
be¡_iou
){

278 
be¡_iou
 = 
iou
;

281 
avg_iou
 +ğ
be¡_iou
;

282 if(
be¡_iou
 > 
iou_th»sh
){

283 ++
cÜ»ù
;

286 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

287 
	`årštf
(
¡d”r
, "%5d %5d %5d\tRPs/Img: %.2f\tIOU: %.2f%%\tReÿÎ:%.2f%%\n", 
i
, 
cÜ»ù
, 
tÙ®
, ()
´İo§ls
/(i+1), 
avg_iou
*100/total, 100.*correct/total);

288 
	`ä“
(
id
);

289 
	`ä“_image
(
Üig
);

290 
	`ä“_image
(
sized
);

292 
	}
}

294 
	$‹¡_coco
(*
cfgfe
, *
weightfe
, *
f’ame
, 
th»sh
)

296 
image
 **
®phab‘
 = 
	`lßd_®phab‘
();

297 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

298 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

299 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

300 
	`¤ªd
(2222222);

301 
nms
 = .4;

302 
şock_t
 
time
;

303 
buff
[256];

304 *
šput
 = 
buff
;

306 if(
f’ame
){

307 
	`¡ºıy
(
šput
, 
f’ame
, 256);

309 
	`´štf
("Enter Image Path: ");

310 
	`fæush
(
¡dout
);

311 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

312 if(!
šput
) ;

313 
	`¡¹ok
(
šput
, "\n");

315 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
,0,0);

316 
image
 
sized
 = 
	`»size_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

317 *
X
 = 
sized
.
d©a
;

318 
time
=
	`şock
();

319 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

320 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

322 
nboxes
 = 0;

323 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 1, 1, 
th»sh
, 0, 0, 0, &
nboxes
);

324 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
l
.
side
*l.side*l.
n
,†.
şas£s
,‚ms);

326 
	`d¿w_d‘eùiÚs
(
im
, 
d‘s
, 
l
.
side
*l.side*l.
n
, 
th»sh
, 
coco_şas£s
, 
®phab‘
, 80);

327 
	`§ve_image
(
im
, "prediction");

328 
	`show_image
(
im
, "predictions", 0);

329 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

330 
	`ä“_image
(
im
);

331 
	`ä“_image
(
sized
);

332 ià(
f’ame
) ;

334 
	}
}

336 
	$run_coco
(
¬gc
, **
¬gv
)

338 *
´efix
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-prefix", 0);

339 
th»sh
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-thresh", .2);

340 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

341 
äame_sk
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-s", 0);

343 if(
¬gc
 < 4){

344 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

348 *
cfg
 = 
¬gv
[3];

349 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

350 *
f’ame
 = (
¬gc
 > 5è? 
¬gv
[5]: 0;

351 
avg
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-avg", 1);

352 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_coco
(
cfg
, 
weights
, 
f’ame
, 
th»sh
);

353 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_coco
(
cfg
, 
weights
);

354 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id©e_coco
(
cfg
, 
weights
);

355 if(0==
	`¡rcmp
(
¬gv
[2], "»ÿÎ")è
	`v®id©e_coco_»ÿÎ
(
cfg
, 
weights
);

356 if(0==
	`¡rcmp
(
¬gv
[2], "demo")è
	`demo
(
cfg
, 
weights
, 
th»sh
, 
ÿm_šdex
, 
f’ame
, 
coco_şas£s
, 80, 
äame_sk
, 
´efix
, 
avg
, .5, 0,0,0,0);

357 
	}
}

	@host/examples/darknet.c

1 
	~"d¬kÃt.h
"

3 
	~<time.h
>

4 
	~<¡dlib.h
>

5 
	~<¡dio.h
>

8 
´ediù_şassif›r
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
f’ame
, 
tİ
);

9 
‹¡_d‘eùÜ
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
f’ame
, 
th»sh
, 
h›r_th»sh
, *
outfe
, 
fuÎsü“n
);

10 
run_yŞo
(
¬gc
, **
¬gv
);

11 
run_d‘eùÜ
(
¬gc
, **
¬gv
);

12 
run_coco
(
¬gc
, **
¬gv
);

13 
run_nightm¬e
(
¬gc
, **
¬gv
);

14 
run_şassif›r
(
¬gc
, **
¬gv
);

15 
run_»g»ssÜ
(
¬gc
, **
¬gv
);

16 
run_£gm’‹r
(
¬gc
, **
¬gv
);

17 
run_i£gm’‹r
(
¬gc
, **
¬gv
);

18 
run_ch¬_ºn
(
¬gc
, **
¬gv
);

19 
run_g
(
¬gc
, **
¬gv
);

20 
run_ciçr
(
¬gc
, **
¬gv
);

21 
run_go
(
¬gc
, **
¬gv
);

22 
run_¬t
(
¬gc
, **
¬gv
);

23 
run_su³r
(
¬gc
, **
¬gv
);

24 
run_lsd
(
¬gc
, **
¬gv
);

26 
	$av”age
(
¬gc
, *
¬gv
[])

28 *
cfgfe
 = 
¬gv
[2];

29 *
outfe
 = 
¬gv
[3];

30 
gpu_šdex
 = -1;

31 
ÃtwÜk
 *
Ãt
 = 
	`·r£_ÃtwÜk_cfg
(
cfgfe
);

32 
ÃtwÜk
 *
sum
 = 
	`·r£_ÃtwÜk_cfg
(
cfgfe
);

34 *
weightfe
 = 
¬gv
[4];

35 
	`lßd_weights
(
sum
, 
weightfe
);

37 
i
, 
j
;

38 
n
 = 
¬gc
 - 5;

39 
i
 = 0; i < 
n
; ++i){

40 
weightfe
 = 
¬gv
[
i
+5];

41 
	`lßd_weights
(
Ãt
, 
weightfe
);

42 
j
 = 0; j < 
Ãt
->
n
; ++j){

43 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
j
];

44 
Ïy”
 
out
 = 
sum
->
Ïy”s
[
j
];

45 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

46 
num
 = 
l
.
n
*l.
c
*l.
size
*l.size;

47 
	`axpy_ıu
(
l
.
n
, 1,†.
bŸ£s
, 1, 
out
.biases, 1);

48 
	`axpy_ıu
(
num
, 1, 
l
.
weights
, 1, 
out
.weights, 1);

49 if(
l
.
b©ch_nÜm®ize
){

50 
	`axpy_ıu
(
l
.
n
, 1,†.
sÿËs
, 1, 
out
.scales, 1);

51 
	`axpy_ıu
(
l
.
n
, 1,†.
rŞlšg_m—n
, 1, 
out
.rolling_mean, 1);

52 
	`axpy_ıu
(
l
.
n
, 1,†.
rŞlšg_v¬Ÿnû
, 1, 
out
.rolling_variance, 1);

55 if(
l
.
ty³
 =ğ
CONNECTED
){

56 
	`axpy_ıu
(
l
.
ouuts
, 1,†.
bŸ£s
, 1, 
out
.biases, 1);

57 
	`axpy_ıu
(
l
.
ouuts
*l.
šputs
, 1,†.
weights
, 1, 
out
.weights, 1);

61 
n
 =‚+1;

62 
j
 = 0; j < 
Ãt
->
n
; ++j){

63 
Ïy”
 
l
 = 
sum
->
Ïy”s
[
j
];

64 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

65 
num
 = 
l
.
n
*l.
c
*l.
size
*l.size;

66 
	`sÿl_ıu
(
l
.
n
, 1./n,†.
bŸ£s
, 1);

67 
	`sÿl_ıu
(
num
, 1./
n
, 
l
.
weights
, 1);

68 if(
l
.
b©ch_nÜm®ize
){

69 
	`sÿl_ıu
(
l
.
n
, 1./n,†.
sÿËs
, 1);

70 
	`sÿl_ıu
(
l
.
n
, 1./n,†.
rŞlšg_m—n
, 1);

71 
	`sÿl_ıu
(
l
.
n
, 1./n,†.
rŞlšg_v¬Ÿnû
, 1);

74 if(
l
.
ty³
 =ğ
CONNECTED
){

75 
	`sÿl_ıu
(
l
.
ouuts
, 1./
n
,†.
bŸ£s
, 1);

76 
	`sÿl_ıu
(
l
.
ouuts
*l.
šputs
, 1./
n
,†.
weights
, 1);

79 
	`§ve_weights
(
sum
, 
outfe
);

80 
	}
}

82 
	$numİs
(
ÃtwÜk
 *
Ãt
)

84 
i
;

85 
İs
 = 0;

86 
i
 = 0; i < 
Ãt
->
n
; ++i){

87 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

88 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

89 
İs
 +ğ2È* 
l
.
n
 *†.
size
*l.size*l.
c
/l.
groups
 *†.
out_h
*l.
out_w
;

90 } if(
l
.
ty³
 =ğ
CONNECTED
){

91 
İs
 +ğ2È* 
l
.
šputs
 *†.
ouuts
;

92 } ià(
l
.
ty³
 =ğ
RNN
){

93 
İs
 +ğ2È* 
l
.
šput_Ïy”
->
šputs
 *†.šput_Ïy”->
ouuts
;

94 
İs
 +ğ2È* 
l
.
£lf_Ïy”
->
šputs
 *†.£lf_Ïy”->
ouuts
;

95 
İs
 +ğ2È* 
l
.
ouut_Ïy”
->
šputs
 *†.ouut_Ïy”->
ouuts
;

96 } ià(
l
.
ty³
 =ğ
GRU
){

97 
İs
 +ğ2È* 
l
.
uz
->
šputs
 *†.uz->
ouuts
;

98 
İs
 +ğ2È* 
l
.
uh
->
šputs
 *†.uh->
ouuts
;

99 
İs
 +ğ2È* 
l
.
ur
->
šputs
 *†.ur->
ouuts
;

100 
İs
 +ğ2È* 
l
.
wz
->
šputs
 *†.wz->
ouuts
;

101 
İs
 +ğ2È* 
l
.
wh
->
šputs
 *†.wh->
ouuts
;

102 
İs
 +ğ2È* 
l
.
wr
->
šputs
 *†.wr->
ouuts
;

103 } ià(
l
.
ty³
 =ğ
LSTM
){

104 
İs
 +ğ2È* 
l
.
uf
->
šputs
 *†.uf->
ouuts
;

105 
İs
 +ğ2È* 
l
.
ui
->
šputs
 *†.ui->
ouuts
;

106 
İs
 +ğ2È* 
l
.
ug
->
šputs
 *†.ug->
ouuts
;

107 
İs
 +ğ2È* 
l
.
uo
->
šputs
 *†.uo->
ouuts
;

108 
İs
 +ğ2È* 
l
.
wf
->
šputs
 *†.wf->
ouuts
;

109 
İs
 +ğ2È* 
l
.
wi
->
šputs
 *†.wi->
ouuts
;

110 
İs
 +ğ2È* 
l
.
wg
->
šputs
 *†.wg->
ouuts
;

111 
İs
 +ğ2È* 
l
.
wo
->
šputs
 *†.wo->
ouuts
;

114  
İs
;

115 
	}
}

117 
	$¥“d
(*
cfgfe
, 
tics
)

119 ià(
tics
 == 0)ics = 1000;

120 
ÃtwÜk
 *
Ãt
 = 
	`·r£_ÃtwÜk_cfg
(
cfgfe
);

121 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

122 
i
;

123 
time
=
	`wh©_time_is_™_now
();

124 
image
 
im
 = 
	`make_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
*Ãt->
b©ch
);

125 
i
 = 0; i < 
tics
; ++i){

126 
	`ÃtwÜk_´ediù
(
Ãt
, 
im
.
d©a
);

128 
t
 = 
	`wh©_time_is_™_now
(è- 
time
;

129 
İs
 = 
	`numİs
(
Ãt
);

130 
	`´štf
("\n%dƒv®s, %àSecÚds\n", 
tics
, 
t
);

131 
	`´štf
("Flßtšg PošˆO³¿tiÚs: %.2àBn\n", ()
İs
/1000000000.);

132 
	`´štf
("FLOPS: %.2àBn\n", ()
İs
/1000000000.*
tics
/
t
);

133 
	`´štf
("S³ed: %à£c/ev®\n", 
t
/
tics
);

134 
	`´štf
("S³ed: %àHz\n", 
tics
/
t
);

135 
	}
}

137 
	$İ”©iÚs
(*
cfgfe
)

139 
gpu_šdex
 = -1;

140 
ÃtwÜk
 *
Ãt
 = 
	`·r£_ÃtwÜk_cfg
(
cfgfe
);

141 
İs
 = 
	`numİs
(
Ãt
);

142 
	`´štf
("Flßtšg PošˆO³¿tiÚs: %ld\n", 
İs
);

143 
	`´štf
("Flßtšg PošˆO³¿tiÚs: %.2àBn\n", ()
İs
/1000000000.);

144 
	}
}

146 
	$Úeoff
(*
cfgfe
, *
weightfe
, *
outfe
)

148 
gpu_šdex
 = -1;

149 
ÃtwÜk
 *
Ãt
 = 
	`·r£_ÃtwÜk_cfg
(
cfgfe
);

150 
Şdn
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].n;

151 
c
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].c;

152 
	`sÿl_ıu
(
Şdn
*
c
, .1, 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].
weights
, 1);

153 
	`sÿl_ıu
(
Şdn
, 0, 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].
bŸ£s
, 1);

154 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].n = 11921;

155 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].
bŸ£s
 += 5;

156 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].
weights
 +ğ5*
c
;

157 if(
weightfe
){

158 
	`lßd_weights
(
Ãt
, 
weightfe
);

160 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].
bŸ£s
 -= 5;

161 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].
weights
 -ğ5*
c
;

162 
Ãt
->
Ïy”s
[Ãt->
n
 - 2].Àğ
Şdn
;

163 
	`´štf
("%d\n", 
Şdn
);

164 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 2];

165 
	`cİy_ıu
(
l
.
n
/3,†.
bŸ£s
, 1,†.biases +†.n/3, 1);

166 
	`cİy_ıu
(
l
.
n
/3,†.
bŸ£s
, 1,†.biases + 2*l.n/3, 1);

167 
	`cİy_ıu
(
l
.
n
/3*l.
c
,†.
weights
, 1,†.weights +†.n/3*l.c, 1);

168 
	`cİy_ıu
(
l
.
n
/3*l.
c
,†.
weights
, 1,†.weights + 2*l.n/3*l.c, 1);

169 *
Ãt
->
£’
 = 0;

170 
	`§ve_weights
(
Ãt
, 
outfe
);

171 
	}
}

173 
	$Úeoff2
(*
cfgfe
, *
weightfe
, *
outfe
, 
l
)

175 
gpu_šdex
 = -1;

176 
ÃtwÜk
 *
Ãt
 = 
	`·r£_ÃtwÜk_cfg
(
cfgfe
);

177 if(
weightfe
){

178 
	`lßd_weights_u±o
(
Ãt
, 
weightfe
, 0,‚‘->
n
);

179 
	`lßd_weights_u±o
(
Ãt
, 
weightfe
, 
l
,‚‘->
n
);

181 *
Ãt
->
£’
 = 0;

182 
	`§ve_weights_u±o
(
Ãt
, 
outfe
,‚‘->
n
);

183 
	}
}

185 
	$·¹Ÿl
(*
cfgfe
, *
weightfe
, *
outfe
, 
max
)

187 
gpu_šdex
 = -1;

188 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 1);

189 
	`§ve_weights_u±o
(
Ãt
, 
outfe
, 
max
);

190 
	}
}

192 
	$´št_weights
(*
cfgfe
, *
weightfe
, 
n
)

194 
gpu_šdex
 = -1;

195 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 1);

196 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
n
];

197 
i
, 
j
;

199 
i
 = 0; i < 
l
.
n
; ++i){

201 
j
 = 0; j < 
l
.
size
*l.size*l.
c
; ++j){

203 
	`´štf
("%g ", 
l
.
weights
[
i
*l.
size
*l.size*l.
c
 + 
j
]);

205 
	`´štf
("\n");

209 
	}
}

211 
	$»sÿË_Ãt
(*
cfgfe
, *
weightfe
, *
outfe
)

213 
gpu_šdex
 = -1;

214 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

215 
i
;

216 
i
 = 0; i < 
Ãt
->
n
; ++i){

217 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

218 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

219 
	`»sÿË_weights
(
l
, 2, -.5);

223 
	`§ve_weights
(
Ãt
, 
outfe
);

224 
	}
}

226 
	$rgbgr_Ãt
(*
cfgfe
, *
weightfe
, *
outfe
)

228 
gpu_šdex
 = -1;

229 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

230 
i
;

231 
i
 = 0; i < 
Ãt
->
n
; ++i){

232 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

233 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

234 
	`rgbgr_weights
(
l
);

238 
	`§ve_weights
(
Ãt
, 
outfe
);

239 
	}
}

241 
	$»£t_nÜm®ize_Ãt
(*
cfgfe
, *
weightfe
, *
outfe
)

243 
gpu_šdex
 = -1;

244 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

245 
i
;

246 
i
 = 0; i < 
Ãt
->
n
; ++i) {

247 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

248 ià(
l
.
ty³
 =ğ
CONVOLUTIONAL
 &&†.
b©ch_nÜm®ize
) {

249 
	`d’Üm®ize_cÚvŞutiÚ®_Ïy”
(
l
);

251 ià(
l
.
ty³
 =ğ
CONNECTED
 &&†.
b©ch_nÜm®ize
) {

252 
	`d’Üm®ize_cÚÃùed_Ïy”
(
l
);

254 ià(
l
.
ty³
 =ğ
GRU
 &&†.
b©ch_nÜm®ize
) {

255 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
šput_z_Ïy”
);

256 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
šput_r_Ïy”
);

257 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
šput_h_Ïy”
);

258 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
¡©e_z_Ïy”
);

259 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
¡©e_r_Ïy”
);

260 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
¡©e_h_Ïy”
);

263 
	`§ve_weights
(
Ãt
, 
outfe
);

264 
	}
}

266 
Ïy”
 
	$nÜm®ize_Ïy”
(
Ïy”
 
l
, 
n
)

268 
j
;

269 
l
.
b©ch_nÜm®ize
=1;

270 
l
.
sÿËs
 = 
	`ÿÎoc
(
n
, ());

271 
j
 = 0; j < 
n
; ++j){

272 
l
.
sÿËs
[
j
] = 1;

274 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
n
, ());

275 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
n
, ());

276  
l
;

277 
	}
}

279 
	$nÜm®ize_Ãt
(*
cfgfe
, *
weightfe
, *
outfe
)

281 
gpu_šdex
 = -1;

282 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

283 
i
;

284 
i
 = 0; i < 
Ãt
->
n
; ++i){

285 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

286 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 && !l.
b©ch_nÜm®ize
){

287 
Ãt
->
Ïy”s
[
i
] = 
	`nÜm®ize_Ïy”
(
l
,†.
n
);

289 ià(
l
.
ty³
 =ğ
CONNECTED
 && !l.
b©ch_nÜm®ize
) {

290 
Ãt
->
Ïy”s
[
i
] = 
	`nÜm®ize_Ïy”
(
l
,†.
ouuts
);

292 ià(
l
.
ty³
 =ğ
GRU
 &&†.
b©ch_nÜm®ize
) {

293 *
l
.
šput_z_Ïy”
 = 
	`nÜm®ize_Ïy”
(*l.šput_z_Ïy”,†.šput_z_Ïy”->
ouuts
);

294 *
l
.
šput_r_Ïy”
 = 
	`nÜm®ize_Ïy”
(*l.šput_r_Ïy”,†.šput_r_Ïy”->
ouuts
);

295 *
l
.
šput_h_Ïy”
 = 
	`nÜm®ize_Ïy”
(*l.šput_h_Ïy”,†.šput_h_Ïy”->
ouuts
);

296 *
l
.
¡©e_z_Ïy”
 = 
	`nÜm®ize_Ïy”
(*l.¡©e_z_Ïy”,†.¡©e_z_Ïy”->
ouuts
);

297 *
l
.
¡©e_r_Ïy”
 = 
	`nÜm®ize_Ïy”
(*l.¡©e_r_Ïy”,†.¡©e_r_Ïy”->
ouuts
);

298 *
l
.
¡©e_h_Ïy”
 = 
	`nÜm®ize_Ïy”
(*l.¡©e_h_Ïy”,†.¡©e_h_Ïy”->
ouuts
);

299 
Ãt
->
Ïy”s
[
i
].
b©ch_nÜm®ize
=1;

302 
	`§ve_weights
(
Ãt
, 
outfe
);

303 
	}
}

305 
	$¡©i¡ics_Ãt
(*
cfgfe
, *
weightfe
)

307 
gpu_šdex
 = -1;

308 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

309 
i
;

310 
i
 = 0; i < 
Ãt
->
n
; ++i) {

311 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

312 ià(
l
.
ty³
 =ğ
CONNECTED
 &&†.
b©ch_nÜm®ize
) {

313 
	`´štf
("CÚÃùed Lay” %d\n", 
i
);

314 
	`¡©i¡ics_cÚÃùed_Ïy”
(
l
);

316 ià(
l
.
ty³
 =ğ
GRU
 &&†.
b©ch_nÜm®ize
) {

317 
	`´štf
("GRU Lay” %d\n", 
i
);

318 
	`´štf
("Input Z\n");

319 
	`¡©i¡ics_cÚÃùed_Ïy”
(*
l
.
šput_z_Ïy”
);

320 
	`´štf
("Input R\n");

321 
	`¡©i¡ics_cÚÃùed_Ïy”
(*
l
.
šput_r_Ïy”
);

322 
	`´štf
("Input H\n");

323 
	`¡©i¡ics_cÚÃùed_Ïy”
(*
l
.
šput_h_Ïy”
);

324 
	`´štf
("State Z\n");

325 
	`¡©i¡ics_cÚÃùed_Ïy”
(*
l
.
¡©e_z_Ïy”
);

326 
	`´štf
("State R\n");

327 
	`¡©i¡ics_cÚÃùed_Ïy”
(*
l
.
¡©e_r_Ïy”
);

328 
	`´štf
("State H\n");

329 
	`¡©i¡ics_cÚÃùed_Ïy”
(*
l
.
¡©e_h_Ïy”
);

331 
	`´štf
("\n");

333 
	}
}

335 
	$d’Üm®ize_Ãt
(*
cfgfe
, *
weightfe
, *
outfe
)

337 
gpu_šdex
 = -1;

338 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

339 
i
;

340 
i
 = 0; i < 
Ãt
->
n
; ++i) {

341 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

342 ià((
l
.
ty³
 =ğ
DECONVOLUTIONAL
 ||†.ty³ =ğ
CONVOLUTIONAL
è&&†.
b©ch_nÜm®ize
) {

343 
	`d’Üm®ize_cÚvŞutiÚ®_Ïy”
(
l
);

344 
Ãt
->
Ïy”s
[
i
].
b©ch_nÜm®ize
=0;

346 ià(
l
.
ty³
 =ğ
CONNECTED
 &&†.
b©ch_nÜm®ize
) {

347 
	`d’Üm®ize_cÚÃùed_Ïy”
(
l
);

348 
Ãt
->
Ïy”s
[
i
].
b©ch_nÜm®ize
=0;

350 ià(
l
.
ty³
 =ğ
GRU
 &&†.
b©ch_nÜm®ize
) {

351 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
šput_z_Ïy”
);

352 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
šput_r_Ïy”
);

353 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
šput_h_Ïy”
);

354 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
¡©e_z_Ïy”
);

355 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
¡©e_r_Ïy”
);

356 
	`d’Üm®ize_cÚÃùed_Ïy”
(*
l
.
¡©e_h_Ïy”
);

357 
l
.
šput_z_Ïy”
->
b©ch_nÜm®ize
 = 0;

358 
l
.
šput_r_Ïy”
->
b©ch_nÜm®ize
 = 0;

359 
l
.
šput_h_Ïy”
->
b©ch_nÜm®ize
 = 0;

360 
l
.
¡©e_z_Ïy”
->
b©ch_nÜm®ize
 = 0;

361 
l
.
¡©e_r_Ïy”
->
b©ch_nÜm®ize
 = 0;

362 
l
.
¡©e_h_Ïy”
->
b©ch_nÜm®ize
 = 0;

363 
Ãt
->
Ïy”s
[
i
].
b©ch_nÜm®ize
=0;

366 
	`§ve_weights
(
Ãt
, 
outfe
);

367 
	}
}

369 
	$mkimg
(*
cfgfe
, *
weightfe
, 
h
, 
w
, 
num
, *
´efix
)

371 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

372 
image
 *
ims
 = 
	`g‘_weights
(
Ãt
->
Ïy”s
[0]);

373 
n
 = 
Ãt
->
Ïy”s
[0].n;

374 
z
;

375 
z
 = 0; z < 
num
; ++z){

376 
image
 
im
 = 
	`make_image
(
h
, 
w
, 3);

377 
	`fl_image
(
im
, .5);

378 
i
;

379 
i
 = 0; i < 100; ++i){

380 
image
 
r
 = 
	`cİy_image
(
ims
[
	`¿nd
()%
n
]);

381 
	`rÙ©e_image_cw
(
r
, 
	`¿nd
()%4);

382 
	`¿ndom_di¡Üt_image
(
r
, 1, 1.5, 1.5);

383 
dx
 = 
	`¿nd
()%(
w
-
r
.w);

384 
dy
 = 
	`¿nd
()%(
h
-
r
.h);

385 
	`gho¡_image
(
r
, 
im
, 
dx
, 
dy
);

386 
	`ä“_image
(
r
);

388 
buff
[256];

389 
	`¥rštf
(
buff
, "%s/g’_%d", 
´efix
, 
z
);

390 
	`§ve_image
(
im
, 
buff
);

391 
	`ä“_image
(
im
);

393 
	}
}

395 
	$visu®ize
(*
cfgfe
, *
weightfe
)

397 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

398 
	`visu®ize_ÃtwÜk
(
Ãt
);

399 
	}
}

401 
	$d¬kÃt_maš
(
¬gc
, **
¬gv
)

406 if(
¬gc
 < 2){

407 
	`årštf
(
¡d”r
, "u§ge: % <funùiÚ>\n", 
¬gv
[0]);

410 
gpu_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-i", 0);

411 if(
	`fšd_¬g
(
¬gc
, 
¬gv
, "-nogpu")) {

412 
gpu_šdex
 = -1;

415 #iâdeà
GPU


416 
gpu_šdex
 = -1;

418 if(
gpu_šdex
 >= 0){

419 
	`cuda_£t_deviû
(
gpu_šdex
);

423 ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "average")){

424 
	`av”age
(
¬gc
, 
¬gv
);

425 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "yolo")){

426 
	`run_yŞo
(
¬gc
, 
¬gv
);

427 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "super")){

428 
	`run_su³r
(
¬gc
, 
¬gv
);

429 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "lsd")){

430 
	`run_lsd
(
¬gc
, 
¬gv
);

431 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "detector")){

432 
	`run_d‘eùÜ
(
¬gc
, 
¬gv
);

433 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "detect")){

434 
th»sh
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-thresh", .5);

435 *
f’ame
 = (
¬gc
 > 4è? 
¬gv
[4]: 0;

436 *
outfe
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-out", 0);

437 
fuÎsü“n
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-fullscreen");

438 
	`‹¡_d‘eùÜ
("cfg/coco.d©a", 
¬gv
[2],‡rgv[3], 
f’ame
, 
th»sh
, .5, 
outfe
, 
fuÎsü“n
);

439 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "cifar")){

440 
	`run_ciçr
(
¬gc
, 
¬gv
);

441 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "go")){

442 
	`run_go
(
¬gc
, 
¬gv
);

443 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "rnn")){

444 
	`run_ch¬_ºn
(
¬gc
, 
¬gv
);

445 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "coco")){

446 
	`run_coco
(
¬gc
, 
¬gv
);

447 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "classify")){

448 
	`´ediù_şassif›r
("cfg/imag’‘1k.d©a", 
¬gv
[2],‡rgv[3],‡rgv[4], 5);

449 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "classifier")){

450 
	`run_şassif›r
(
¬gc
, 
¬gv
);

451 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "regressor")){

452 
	`run_»g»ssÜ
(
¬gc
, 
¬gv
);

453 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "isegmenter")){

454 
	`run_i£gm’‹r
(
¬gc
, 
¬gv
);

455 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "segmenter")){

456 
	`run_£gm’‹r
(
¬gc
, 
¬gv
);

457 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "art")){

458 
	`run_¬t
(
¬gc
, 
¬gv
);

459 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "tag")){

460 
	`run_g
(
¬gc
, 
¬gv
);

461 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "3d")){

462 
	`compos™e_3d
(
¬gv
[2],‡rgv[3],‡rgv[4], (
¬gc
 > 5è? 
	`©of
(argv[5]) : 0);

463 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "test")){

464 
	`‹¡_»size
(
¬gv
[2]);

465 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "nightmare")){

466 
	`run_nightm¬e
(
¬gc
, 
¬gv
);

467 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "rgbgr")){

468 
	`rgbgr_Ãt
(
¬gv
[2],‡rgv[3],‡rgv[4]);

469 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "reset")){

470 
	`»£t_nÜm®ize_Ãt
(
¬gv
[2],‡rgv[3],‡rgv[4]);

471 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "denormalize")){

472 
	`d’Üm®ize_Ãt
(
¬gv
[2],‡rgv[3],‡rgv[4]);

473 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "statistics")){

474 
	`¡©i¡ics_Ãt
(
¬gv
[2],‡rgv[3]);

475 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "normalize")){

476 
	`nÜm®ize_Ãt
(
¬gv
[2],‡rgv[3],‡rgv[4]);

477 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "rescale")){

478 
	`»sÿË_Ãt
(
¬gv
[2],‡rgv[3],‡rgv[4]);

479 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "ops")){

480 
	`İ”©iÚs
(
¬gv
[2]);

481 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "speed")){

482 
	`¥“d
(
¬gv
[2], (
¬gc
 > 3 &&‡rgv[3]è? 
	`©oi
(argv[3]) : 0);

483 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "oneoff")){

484 
	`Úeoff
(
¬gv
[2],‡rgv[3],‡rgv[4]);

485 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "oneoff2")){

486 
	`Úeoff2
(
¬gv
[2],‡rgv[3],‡rgv[4], 
	`©oi
(argv[5]));

487 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "print")){

488 
	`´št_weights
(
¬gv
[2],‡rgv[3], 
	`©oi
(argv[4]));

489 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "partial")){

490 
	`·¹Ÿl
(
¬gv
[2],‡rgv[3],‡rgv[4], 
	`©oi
(argv[5]));

491 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "average")){

492 
	`av”age
(
¬gc
, 
¬gv
);

493 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "visualize")){

494 
	`visu®ize
(
¬gv
[2], (
¬gc
 > 3) ?‡rgv[3] : 0);

495 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "mkimg")){

496 
	`mkimg
(
¬gv
[2],‡rgv[3], 
	`©oi
(argv[4]),‡toi(argv[5]),‡toi(argv[6]),‡rgv[7]);

497 } ià(0 =ğ
	`¡rcmp
(
¬gv
[1], "imtest")){

498 
	`‹¡_»size
(
¬gv
[2]);

500 
	`årštf
(
¡d”r
, "NÙ‡ÀİtiÚ: %s\n", 
¬gv
[1]);

503 
	}
}

	@host/examples/detector.c

1 
	~"d¬kÃt.h
"

3 
	gcoco_ids
[] = {1,2,3,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24,25,27,28,31,32,33,34,35,36,37,38,39,40,41,42,43,44,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,67,70,72,73,74,75,76,77,78,79,80,81,82,84,85,86,87,88,89,90};

6 
	$Œaš_d‘eùÜ
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
gpus
, 
ngpus
, 
ş—r
)

8 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

9 *
Œaš_images
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "train", "data/train.list");

10 *
backup_dœeùÜy
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "backup", "/backup/");

12 
	`¤ªd
(
	`time
(0));

13 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

14 
	`´štf
("%s\n", 
ba£
);

15 
avg_loss
 = -1;

16 
ÃtwÜk
 **
Ãts
 = 
	`ÿÎoc
(
ngpus
, (network));

18 
	`¤ªd
(
	`time
(0));

19 
£ed
 = 
	`¿nd
();

20 
i
;

21 
i
 = 0; i < 
ngpus
; ++i){

22 
	`¤ªd
(
£ed
);

23 #ifdeà
GPU


24 
	`cuda_£t_deviû
(
gpus
[
i
]);

26 
Ãts
[
i
] = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

27 
Ãts
[
i
]->
Ë¬nšg_¿‹
 *ğ
ngpus
;

29 
	`¤ªd
(
	`time
(0));

30 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

32 
imgs
 = 
Ãt
->
b©ch
 *‚‘->
subdivisiÚs
 * 
ngpus
;

33 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

34 
d©a
 
Œaš
, 
bufãr
;

36 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 1];

38 
şas£s
 = 
l
.classes;

39 
j™‹r
 = 
l
.jitter;

41 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

43 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

45 
lßd_¬gs
 
¬gs
 = 
	`g‘_ba£_¬gs
(
Ãt
);

46 
¬gs
.
coÜds
 = 
l
.coords;

47 
¬gs
.
·ths
 =…aths;

48 
¬gs
.
n
 = 
imgs
;

49 
¬gs
.
m
 = 
¶i¡
->
size
;

50 
¬gs
.
şas£s
 = classes;

51 
¬gs
.
j™‹r
 = jitter;

52 
¬gs
.
num_boxes
 = 
l
.
max_boxes
;

53 
¬gs
.
d
 = &
bufãr
;

54 
¬gs
.
ty³
 = 
DETECTION_DATA
;

56 
¬gs
.
th»ads
 = 64;

58 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

59 
time
;

60 
couÁ
 = 0;

62 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
){

63 if(
l
.
¿ndom
 && 
couÁ
++%10 == 0){

64 
	`´štf
("Resizing\n");

65 
dim
 = (
	`¿nd
() % 10 + 10) * 32;

66 ià(
	`g‘_cu¼’t_b©ch
(
Ãt
)+200 >‚‘->
max_b©ches
è
dim
 = 608;

68 
	`´štf
("%d\n", 
dim
);

69 
¬gs
.
w
 = 
dim
;

70 
¬gs
.
h
 = 
dim
;

72 
	`±h»ad_još
(
lßd_th»ad
, 0);

73 
Œaš
 = 
bufãr
;

74 
	`ä“_d©a
(
Œaš
);

75 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

77 #´agm¨
omp
 
·¿Î–
 

78 
i
 = 0; i < 
ngpus
; ++i){

79 
	`»size_ÃtwÜk
(
Ãts
[
i
], 
dim
, dim);

81 
Ãt
 = 
Ãts
[0];

83 
time
=
	`wh©_time_is_™_now
();

84 
	`±h»ad_još
(
lßd_th»ad
, 0);

85 
Œaš
 = 
bufãr
;

86 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

112 
	`´štf
("Lßded: %là£cÚds\n", 
	`wh©_time_is_™_now
()-
time
);

114 
time
=
	`wh©_time_is_™_now
();

115 
loss
 = 0;

116 #ifdeà
GPU


117 if(
ngpus
 == 1){

118 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

120 
loss
 = 
	`Œaš_ÃtwÜks
(
Ãts
, 
ngpus
, 
Œaš
, 4);

123 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

125 ià(
avg_loss
 < 0èavg_los ğ
loss
;

126 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

128 
i
 = 
	`g‘_cu¼’t_b©ch
(
Ãt
);

129 
	`´štf
("%ld: %f, %àavg, %à¿‹, %là£cÚds, %d images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`wh©_time_is_™_now
()-
time
, 
i
*
imgs
);

130 if(
i
%100==0){

131 #ifdeà
GPU


132 if(
ngpus
 !ğ1è
	`sync_Ãts
(
Ãts
,‚gpus, 0);

134 
buff
[256];

135 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

136 
	`§ve_weights
(
Ãt
, 
buff
);

138 if(
i
%10000==0 || (i < 1000 && i%100 == 0)){

139 #ifdeà
GPU


140 if(
ngpus
 !ğ1è
	`sync_Ãts
(
Ãts
,‚gpus, 0);

142 
buff
[256];

143 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

144 
	`§ve_weights
(
Ãt
, 
buff
);

146 
	`ä“_d©a
(
Œaš
);

148 #ifdeà
GPU


149 if(
ngpus
 !ğ1è
	`sync_Ãts
(
Ãts
,‚gpus, 0);

151 
buff
[256];

152 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

153 
	`§ve_weights
(
Ãt
, 
buff
);

154 
	}
}

157 
	$g‘_coco_image_id
(*
f’ame
)

159 *
p
 = 
	`¡¼chr
(
f’ame
, '/');

160 *
c
 = 
	`¡¼chr
(
f’ame
, '_');

161 if(
c
è
p
 = c;

162  
	`©oi
(
p
+1);

163 
	}
}

165 
	$´št_cocos
(
FILE
 *
å
, *
image_·th
, 
d‘eùiÚ
 *
d‘s
, 
num_boxes
, 
şas£s
, 
w
, 
h
)

167 
i
, 
j
;

168 
image_id
 = 
	`g‘_coco_image_id
(
image_·th
);

169 
i
 = 0; i < 
num_boxes
; ++i){

170 
xmš
 = 
d‘s
[
i
].
bbox
.
x
 - d‘s[i].bbox.
w
/2.;

171 
xmax
 = 
d‘s
[
i
].
bbox
.
x
 + d‘s[i].bbox.
w
/2.;

172 
ymš
 = 
d‘s
[
i
].
bbox
.
y
 - d‘s[i].bbox.
h
/2.;

173 
ymax
 = 
d‘s
[
i
].
bbox
.
y
 + d‘s[i].bbox.
h
/2.;

175 ià(
xmš
 < 0) xmin = 0;

176 ià(
ymš
 < 0) ymin = 0;

177 ià(
xmax
 > 
w
) xmax = w;

178 ià(
ymax
 > 
h
) ymax = h;

180 
bx
 = 
xmš
;

181 
by
 = 
ymš
;

182 
bw
 = 
xmax
 - 
xmš
;

183 
bh
 = 
ymax
 - 
ymš
;

185 
j
 = 0; j < 
şas£s
; ++j){

186 ià(
d‘s
[
i
].
´ob
[
j
]è
	`årštf
(
å
, "{\"image_id\":%d, \"ÿ‹gÜy_id\":%d, \"bbox\":[%f, %f, %f, %f], \"scÜe\":%f},\n", 
image_id
, 
coco_ids
[j], 
bx
, 
by
, 
bw
, 
bh
, dets[i].prob[j]);

189 
	}
}

191 
	$´št_d‘eùÜ_d‘eùiÚs
(
FILE
 **
ås
, *
id
, 
d‘eùiÚ
 *
d‘s
, 
tÙ®
, 
şas£s
, 
w
, 
h
)

193 
i
, 
j
;

194 
i
 = 0; i < 
tÙ®
; ++i){

195 
xmš
 = 
d‘s
[
i
].
bbox
.
x
 - d‘s[i].bbox.
w
/2. + 1;

196 
xmax
 = 
d‘s
[
i
].
bbox
.
x
 + d‘s[i].bbox.
w
/2. + 1;

197 
ymš
 = 
d‘s
[
i
].
bbox
.
y
 - d‘s[i].bbox.
h
/2. + 1;

198 
ymax
 = 
d‘s
[
i
].
bbox
.
y
 + d‘s[i].bbox.
h
/2. + 1;

200 ià(
xmš
 < 1) xmin = 1;

201 ià(
ymš
 < 1) ymin = 1;

202 ià(
xmax
 > 
w
) xmax = w;

203 ià(
ymax
 > 
h
) ymax = h;

205 
j
 = 0; j < 
şas£s
; ++j){

206 ià(
d‘s
[
i
].
´ob
[
j
]è
	`årštf
(
ås
[j], "% %à%à%à%à%f\n", 
id
, dets[i].prob[j],

207 
xmš
, 
ymš
, 
xmax
, 
ymax
);

210 
	}
}

212 
	$´št_imag’‘_d‘eùiÚs
(
FILE
 *
å
, 
id
, 
d‘eùiÚ
 *
d‘s
, 
tÙ®
, 
şas£s
, 
w
, 
h
)

214 
i
, 
j
;

215 
i
 = 0; i < 
tÙ®
; ++i){

216 
xmš
 = 
d‘s
[
i
].
bbox
.
x
 - d‘s[i].bbox.
w
/2.;

217 
xmax
 = 
d‘s
[
i
].
bbox
.
x
 + d‘s[i].bbox.
w
/2.;

218 
ymš
 = 
d‘s
[
i
].
bbox
.
y
 - d‘s[i].bbox.
h
/2.;

219 
ymax
 = 
d‘s
[
i
].
bbox
.
y
 + d‘s[i].bbox.
h
/2.;

221 ià(
xmš
 < 0) xmin = 0;

222 ià(
ymš
 < 0) ymin = 0;

223 ià(
xmax
 > 
w
) xmax = w;

224 ià(
ymax
 > 
h
) ymax = h;

226 
j
 = 0; j < 
şas£s
; ++j){

227 
şass
 = 
j
;

228 ià(
d‘s
[
i
].
´ob
[
şass
]è
	`årštf
(
å
, "%d %d %à%à%à%à%f\n", 
id
, 
j
+1, dets[i].prob[class],

229 
xmš
, 
ymš
, 
xmax
, 
ymax
);

232 
	}
}

234 
	$v®id©e_d‘eùÜ_æ
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
outfe
)

236 
j
;

237 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

238 *
v®id_images
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

239 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", "data/names.list");

240 *
´efix
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "results", "results");

241 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

242 *
m­f
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "map", 0);

243 *
m­
 = 0;

244 ià(
m­f
è
m­
 = 
	`»ad_m­
(mapf);

246 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

247 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 2);

248 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

249 
	`¤ªd
(
	`time
(0));

251 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_images
);

252 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

254 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

255 
şas£s
 = 
l
.classes;

257 
buff
[1024];

258 *
ty³
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "eval", "voc");

259 
FILE
 *
å
 = 0;

260 
FILE
 **
ås
 = 0;

261 
coco
 = 0;

262 
imag’‘
 = 0;

263 if(0==
	`¡rcmp
(
ty³
, "coco")){

264 if(!
outfe
) outfile = "coco_results";

265 
	`¢´štf
(
buff
, 1024, "%s/%s.jsÚ", 
´efix
, 
outfe
);

266 
å
 = 
	`fİ’
(
buff
, "w");

267 
	`årštf
(
å
, "[\n");

268 
coco
 = 1;

269 } if(0==
	`¡rcmp
(
ty³
, "imagenet")){

270 if(!
outfe
) outfile = "imagenet-detection";

271 
	`¢´štf
(
buff
, 1024, "%s/%s.txt", 
´efix
, 
outfe
);

272 
å
 = 
	`fİ’
(
buff
, "w");

273 
imag’‘
 = 1;

274 
şas£s
 = 200;

276 if(!
outfe
) outfile = "comp4_det_test_";

277 
ås
 = 
	`ÿÎoc
(
şas£s
, (
FILE
 *));

278 
j
 = 0; j < 
şas£s
; ++j){

279 
	`¢´štf
(
buff
, 1024, "%s/%s%s.txt", 
´efix
, 
outfe
, 
Çmes
[
j
]);

280 
ås
[
j
] = 
	`fİ’
(
buff
, "w");

284 
m
 = 
¶i¡
->
size
;

285 
i
=0;

286 
t
;

288 
th»sh
 = .005;

289 
nms
 = .45;

291 
Áh»ads
 = 4;

292 
image
 *
v®
 = 
	`ÿÎoc
(
Áh»ads
, (image));

293 
image
 *
v®_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

294 
image
 *
buf
 = 
	`ÿÎoc
(
Áh»ads
, (image));

295 
image
 *
buf_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

296 
±h»ad_t
 *
thr
 = 
	`ÿÎoc
(
Áh»ads
, (pthread_t));

298 
image
 
šput
 = 
	`make_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
*2);

300 
lßd_¬gs
 
¬gs
 = {0};

301 
¬gs
.
w
 = 
Ãt
->w;

302 
¬gs
.
h
 = 
Ãt
->h;

304 
¬gs
.
ty³
 = 
LETTERBOX_DATA
;

306 
t
 = 0; < 
Áh»ads
; ++t){

307 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

308 
¬gs
.
im
 = &
buf
[
t
];

309 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

310 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

312 
¡¬t
 = 
	`wh©_time_is_™_now
();

313 
i
 = 
Áh»ads
; i < 
m
+nthreads; i +=‚threads){

314 
	`årštf
(
¡d”r
, "%d\n", 
i
);

315 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

316 
	`±h»ad_još
(
thr
[
t
], 0);

317 
v®
[
t
] = 
buf
[t];

318 
v®_»sized
[
t
] = 
buf_»sized
[t];

320 
t
 = 0; < 
Áh»ads
 && 
i
+ˆ< 
m
; ++t){

321 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

322 
¬gs
.
im
 = &
buf
[
t
];

323 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

324 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

326 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

327 *
·th
 = 
·ths
[
i
+
t
-
Áh»ads
];

328 *
id
 = 
	`ba£cfg
(
·th
);

329 
	`cİy_ıu
(
Ãt
->
w
*Ãt->
h
*Ãt->
c
, 
v®_»sized
[
t
].
d©a
, 1, 
šput
.data, 1);

330 
	`æ_image
(
v®_»sized
[
t
]);

331 
	`cİy_ıu
(
Ãt
->
w
*Ãt->
h
*Ãt->
c
, 
v®_»sized
[
t
].
d©a
, 1, 
šput
.data +‚et->w*net->h*net->c, 1);

333 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
.
d©a
);

334 
w
 = 
v®
[
t
].w;

335 
h
 = 
v®
[
t
].h;

336 
num
 = 0;

337 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
w
, 
h
, 
th»sh
, .5, 
m­
, 0, &
num
);

338 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
num
, 
şas£s
,‚ms);

339 ià(
coco
){

340 
	`´št_cocos
(
å
, 
·th
, 
d‘s
, 
num
, 
şas£s
, 
w
, 
h
);

341 } ià(
imag’‘
){

342 
	`´št_imag’‘_d‘eùiÚs
(
å
, 
i
+
t
-
Áh»ads
+1, 
d‘s
, 
num
, 
şas£s
, 
w
, 
h
);

344 
	`´št_d‘eùÜ_d‘eùiÚs
(
ås
, 
id
, 
d‘s
, 
num
, 
şas£s
, 
w
, 
h
);

346 
	`ä“_d‘eùiÚs
(
d‘s
, 
num
);

347 
	`ä“
(
id
);

348 
	`ä“_image
(
v®
[
t
]);

349 
	`ä“_image
(
v®_»sized
[
t
]);

352 
j
 = 0; j < 
şas£s
; ++j){

353 if(
ås
è
	`fşo£
(ås[
j
]);

355 if(
coco
){

356 
	`f£ek
(
å
, -2, 
SEEK_CUR
);

357 
	`årštf
(
å
, "\n]\n");

358 
	`fşo£
(
å
);

360 
	`årštf
(
¡d”r
, "TÙ® D‘eùiÚ Time: %àSecÚds\n", 
	`wh©_time_is_™_now
(è- 
¡¬t
);

361 
	}
}

364 
	$v®id©e_d‘eùÜ
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
outfe
)

366 
j
;

367 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

368 *
v®id_images
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "valid", "data/train.list");

369 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", "data/names.list");

370 *
´efix
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "results", "results");

371 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

372 *
m­f
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "map", 0);

373 *
m­
 = 0;

374 ià(
m­f
è
m­
 = 
	`»ad_m­
(mapf);

376 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

377 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

378 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

379 
	`¤ªd
(
	`time
(0));

381 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
v®id_images
);

382 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

384 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

385 
şas£s
 = 
l
.classes;

387 
buff
[1024];

388 *
ty³
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "eval", "voc");

389 
FILE
 *
å
 = 0;

390 
FILE
 **
ås
 = 0;

391 
coco
 = 0;

392 
imag’‘
 = 0;

393 if(0==
	`¡rcmp
(
ty³
, "coco")){

394 if(!
outfe
) outfile = "coco_results";

395 
	`¢´štf
(
buff
, 1024, "%s/%s.jsÚ", 
´efix
, 
outfe
);

396 
å
 = 
	`fİ’
(
buff
, "w");

397 
	`årštf
(
å
, "[\n");

398 
coco
 = 1;

399 } if(0==
	`¡rcmp
(
ty³
, "imagenet")){

400 if(!
outfe
) outfile = "imagenet-detection";

401 
	`¢´štf
(
buff
, 1024, "%s/%s.txt", 
´efix
, 
outfe
);

402 
å
 = 
	`fİ’
(
buff
, "w");

403 
imag’‘
 = 1;

404 
şas£s
 = 200;

406 if(!
outfe
) outfile = "comp4_det_test_";

407 
ås
 = 
	`ÿÎoc
(
şas£s
, (
FILE
 *));

408 
j
 = 0; j < 
şas£s
; ++j){

409 
	`¢´štf
(
buff
, 1024, "%s/%s%s.txt", 
´efix
, 
outfe
, 
Çmes
[
j
]);

410 
ås
[
j
] = 
	`fİ’
(
buff
, "w");

415 
m
 = 
¶i¡
->
size
;

416 
i
=0;

417 
t
;

419 
th»sh
 = .005;

420 
nms
 = .45;

422 
Áh»ads
 = 4;

423 
image
 *
v®
 = 
	`ÿÎoc
(
Áh»ads
, (image));

424 
image
 *
v®_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

425 
image
 *
buf
 = 
	`ÿÎoc
(
Áh»ads
, (image));

426 
image
 *
buf_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

427 
±h»ad_t
 *
thr
 = 
	`ÿÎoc
(
Áh»ads
, (pthread_t));

429 
lßd_¬gs
 
¬gs
 = {0};

430 
¬gs
.
w
 = 
Ãt
->w;

431 
¬gs
.
h
 = 
Ãt
->h;

433 
¬gs
.
ty³
 = 
LETTERBOX_DATA
;

435 
t
 = 0; < 
Áh»ads
; ++t){

436 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

437 
¬gs
.
im
 = &
buf
[
t
];

438 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

439 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

441 
¡¬t
 = 
	`wh©_time_is_™_now
();

442 
i
 = 
Áh»ads
; i < 
m
+nthreads; i +=‚threads){

443 
	`årštf
(
¡d”r
, "%d\n", 
i
);

444 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

445 
	`±h»ad_još
(
thr
[
t
], 0);

446 
v®
[
t
] = 
buf
[t];

447 
v®_»sized
[
t
] = 
buf_»sized
[t];

449 
t
 = 0; < 
Áh»ads
 && 
i
+ˆ< 
m
; ++t){

450 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

451 
¬gs
.
im
 = &
buf
[
t
];

452 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

453 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

455 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

456 *
·th
 = 
·ths
[
i
+
t
-
Áh»ads
];

457 *
id
 = 
	`ba£cfg
(
·th
);

458 *
X
 = 
v®_»sized
[
t
].
d©a
;

459 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

460 
w
 = 
v®
[
t
].w;

461 
h
 = 
v®
[
t
].h;

462 
nboxes
 = 0;

463 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
w
, 
h
, 
th»sh
, .5, 
m­
, 0, &
nboxes
);

464 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
nboxes
, 
şas£s
,‚ms);

465 ià(
coco
){

466 
	`´št_cocos
(
å
, 
·th
, 
d‘s
, 
nboxes
, 
şas£s
, 
w
, 
h
);

467 } ià(
imag’‘
){

468 
	`´št_imag’‘_d‘eùiÚs
(
å
, 
i
+
t
-
Áh»ads
+1, 
d‘s
, 
nboxes
, 
şas£s
, 
w
, 
h
);

470 
	`´št_d‘eùÜ_d‘eùiÚs
(
ås
, 
id
, 
d‘s
, 
nboxes
, 
şas£s
, 
w
, 
h
);

472 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

473 
	`ä“
(
id
);

474 
	`ä“_image
(
v®
[
t
]);

475 
	`ä“_image
(
v®_»sized
[
t
]);

478 
j
 = 0; j < 
şas£s
; ++j){

479 if(
ås
è
	`fşo£
(ås[
j
]);

481 if(
coco
){

482 
	`f£ek
(
å
, -2, 
SEEK_CUR
);

483 
	`årštf
(
å
, "\n]\n");

484 
	`fşo£
(
å
);

486 
	`årštf
(
¡d”r
, "TÙ® D‘eùiÚ Time: %àSecÚds\n", 
	`wh©_time_is_™_now
(è- 
¡¬t
);

487 
	}
}

489 
	$v®id©e_d‘eùÜ_»ÿÎ
(*
cfgfe
, *
weightfe
)

491 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

492 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

493 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

494 
	`¤ªd
(
	`time
(0));

496 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("data/coco_val_5k.list");

497 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

499 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

501 
j
, 
k
;

503 
m
 = 
¶i¡
->
size
;

504 
i
=0;

506 
th»sh
 = .001;

507 
iou_th»sh
 = .5;

508 
nms
 = .4;

510 
tÙ®
 = 0;

511 
cÜ»ù
 = 0;

512 
´İo§ls
 = 0;

513 
avg_iou
 = 0;

515 
i
 = 0; i < 
m
; ++i){

516 *
·th
 = 
·ths
[
i
];

517 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
·th
, 0, 0);

518 
image
 
sized
 = 
	`»size_image
(
Üig
, 
Ãt
->
w
,‚‘->
h
);

519 *
id
 = 
	`ba£cfg
(
·th
);

520 
	`ÃtwÜk_´ediù
(
Ãt
, 
sized
.
d©a
);

521 
nboxes
 = 0;

522 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
sized
.
w
, sized.
h
, 
th»sh
, .5, 0, 1, &
nboxes
);

523 ià(
nms
è
	`do_nms_obj
(
d‘s
, 
nboxes
, 1,‚ms);

525 
Ïb–·th
[4096];

526 
	`fšd_»¶aû
(
·th
, "images", "Ïb–s", 
Ïb–·th
);

527 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

528 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

529 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

531 
num_Ïb–s
 = 0;

532 
box_Ïb–
 *
Œuth
 = 
	`»ad_boxes
(
Ïb–·th
, &
num_Ïb–s
);

533 
k
 = 0; k < 
nboxes
; ++k){

534 if(
d‘s
[
k
].
objeùÃss
 > 
th»sh
){

535 ++
´İo§ls
;

538 
j
 = 0; j < 
num_Ïb–s
; ++j) {

539 ++
tÙ®
;

540 
box
 
t
 = {
Œuth
[
j
].
x
,ruth[j].
y
,ruth[j].
w
,ruth[j].
h
};

541 
be¡_iou
 = 0;

542 
k
 = 0; k < 
l
.
w
*l.
h
*l.
n
; ++k){

543 
iou
 = 
	`box_iou
(
d‘s
[
k
].
bbox
, 
t
);

544 if(
d‘s
[
k
].
objeùÃss
 > 
th»sh
 && 
iou
 > 
be¡_iou
){

545 
be¡_iou
 = 
iou
;

548 
avg_iou
 +ğ
be¡_iou
;

549 if(
be¡_iou
 > 
iou_th»sh
){

550 ++
cÜ»ù
;

554 
	`årštf
(
¡d”r
, "%5d %5d %5d\tRPs/Img: %.2f\tIOU: %.2f%%\tReÿÎ:%.2f%%\n", 
i
, 
cÜ»ù
, 
tÙ®
, ()
´İo§ls
/(i+1), 
avg_iou
*100/total, 100.*correct/total);

555 
	`ä“
(
id
);

556 
	`ä“_image
(
Üig
);

557 
	`ä“_image
(
sized
);

559 
	}
}

562 
	$‹¡_d‘eùÜ
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
f’ame
, 
th»sh
, 
h›r_th»sh
, *
outfe
, 
fuÎsü“n
)

564 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

565 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", "data/names.list");

566 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

568 
image
 **
®phab‘
 = 
	`lßd_®phab‘
();

569 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

570 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

571 
	`¤ªd
(2222222);

572 
time
;

573 
buff
[256];

574 *
šput
 = 
buff
;

575 
nms
=.45;

577 if(
f’ame
){

578 
	`¡ºıy
(
šput
, 
f’ame
, 256);

580 
	`´štf
("Enter Image Path: ");

581 
	`fæush
(
¡dout
);

582 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

583 if(!
šput
) ;

584 
	`¡¹ok
(
šput
, "\n");

586 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
,0,0);

587 
image
 
sized
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

592 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

595 *
X
 = 
sized
.
d©a
;

596 
time
=
	`wh©_time_is_™_now
();

597 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

598 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`wh©_time_is_™_now
()-
time
);

599 
nboxes
 = 0;

600 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
im
.
w
, im.
h
, 
th»sh
, 
h›r_th»sh
, 0, 1, &
nboxes
);

603 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
nboxes
, 
l
.
şas£s
,‚ms);

604 
	`d¿w_d‘eùiÚs
(
im
, 
d‘s
, 
nboxes
, 
th»sh
, 
Çmes
, 
®phab‘
, 
l
.
şas£s
);

605 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

606 if(
outfe
){

607 
	`§ve_image
(
im
, 
outfe
);

610 
	`§ve_image
(
im
, "predictions");

611 #ifdeà
OPENCV


612 
	`make_wšdow
("predictions", 512, 512, 0);

613 
	`show_image
(
im
, "predictions", 0);

617 
	`ä“_image
(
im
);

618 
	`ä“_image
(
sized
);

619 ià(
f’ame
) ;

621 
	}
}

789 
	$run_d‘eùÜ
(
¬gc
, **
¬gv
)

791 *
´efix
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-prefix", 0);

792 
th»sh
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-thresh", .5);

793 
h›r_th»sh
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-hier", .5);

794 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

795 
äame_sk
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-s", 0);

796 
avg
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-avg", 3);

797 if(
¬gc
 < 4){

798 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

801 *
gpu_li¡
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-gpus", 0);

802 *
outfe
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-out", 0);

803 *
gpus
 = 0;

804 
gpu
 = 0;

805 
ngpus
 = 0;

806 if(
gpu_li¡
){

807 
	`´štf
("%s\n", 
gpu_li¡
);

808 
Ën
 = 
	`¡¾’
(
gpu_li¡
);

809 
ngpus
 = 1;

810 
i
;

811 
i
 = 0; i < 
Ën
; ++i){

812 ià(
gpu_li¡
[
i
] =ğ','è++
ngpus
;

814 
gpus
 = 
	`ÿÎoc
(
ngpus
, ());

815 
i
 = 0; i < 
ngpus
; ++i){

816 
gpus
[
i
] = 
	`©oi
(
gpu_li¡
);

817 
gpu_li¡
 = 
	`¡rchr
(gpu_list, ',')+1;

820 
gpu
 = 
gpu_šdex
;

821 
gpus
 = &
gpu
;

822 
ngpus
 = 1;

825 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

826 
fuÎsü“n
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-fullscreen");

827 
width
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-w", 0);

828 
height
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-h", 0);

829 
ås
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-fps", 0);

832 *
d©acfg
 = 
¬gv
[3];

833 *
cfg
 = 
¬gv
[4];

834 *
weights
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

835 *
f’ame
 = (
¬gc
 > 6è? 
¬gv
[6]: 0;

836 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_d‘eùÜ
(
d©acfg
, 
cfg
, 
weights
, 
f’ame
, 
th»sh
, 
h›r_th»sh
, 
outfe
, 
fuÎsü“n
);

837 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_d‘eùÜ
(
d©acfg
, 
cfg
, 
weights
, 
gpus
, 
ngpus
, 
ş—r
);

838 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id©e_d‘eùÜ
(
d©acfg
, 
cfg
, 
weights
, 
outfe
);

839 if(0==
	`¡rcmp
(
¬gv
[2], "v®id2")è
	`v®id©e_d‘eùÜ_æ
(
d©acfg
, 
cfg
, 
weights
, 
outfe
);

840 if(0==
	`¡rcmp
(
¬gv
[2], "»ÿÎ")è
	`v®id©e_d‘eùÜ_»ÿÎ
(
cfg
, 
weights
);

841 if(0==
	`¡rcmp
(
¬gv
[2], "demo")) {

842 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

843 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 20);

844 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", "data/names.list");

845 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

846 
	`demo
(
cfg
, 
weights
, 
th»sh
, 
ÿm_šdex
, 
f’ame
, 
Çmes
, 
şas£s
, 
äame_sk
, 
´efix
, 
avg
, 
h›r_th»sh
, 
width
, 
height
, 
ås
, 
fuÎsü“n
);

850 
	}
}

	@host/examples/go.c

1 
	~"d¬kÃt.h
"

3 
	~<as£¹.h
>

4 
	~<m©h.h
>

5 
	~<uni¡d.h
>

7 
	gšv”‹d
 = 1;

8 
	gnoi
 = 1;

9 cÚ¡ 
	gnšd
 = 10;

10 
Ëg®_go
(*
b
, *
ko
, 
p
, 
r
, 
c
);

11 
check_ko
(*
x
, *
ko
);

14 **
	md©a
;

15 
	mn
;

16 } 
	tmoves
;

18 *
	$fg‘go
(
FILE
 *
å
)

20 if(
	`ãof
(
å
))  0;

21 
size_t
 
size
 = 96;

22 *
lše
 = 
	`m®loc
(
size
*());

23 if(
size
 !ğ
	`ä—d
(
lše
, (), size, 
å
)){

24 
	`ä“
(
lše
);

28  
lše
;

29 
	}
}

31 
moves
 
	$lßd_go_moves
(*
f’ame
)

33 
moves
 
m
;

34 
m
.
n
 = 128;

35 
m
.
d©a
 = 
	`ÿÎoc
(128, (*));

36 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "rb");

37 
couÁ
 = 0;

38 *
lše
 = 0;

39 (
lše
 = 
	`fg‘go
(
å
))) {

40 ià(
couÁ
 >ğ
m
.
n
) {

41 
m
.
n
 *= 2;

42 
m
.
d©a
 = 
	`»®loc
(m.d©a, m.
n
*(*));

44 
m
.
d©a
[
couÁ
] = 
lše
;

45 ++
couÁ
;

47 
	`´štf
("%d\n", 
couÁ
);

48 
m
.
n
 = 
couÁ
;

49 
m
.
d©a
 = 
	`»®loc
(m.d©a, 
couÁ
*(*));

50  
m
;

51 
	}
}

53 
	$¡ršg_to_bßrd
(*
s
, *
bßrd
)

55 
i
, 
j
;

56 
	`mem£t
(
bßrd
, 0, 2*19*19*());

57 
couÁ
 = 0;

58 
i
 = 0; i < 91; ++i){

59 
c
 = 
s
[
i
];

60 
j
 = 0; j < 4; ++j){

61 
me
 = (
c
 >> (2*
j
)) & 1;

62 
you
 = (
c
 >> (2*
j
 + 1)) & 1;

63 ià(
me
è
bßrd
[
couÁ
] = 1;

64 ià(
you
è
bßrd
[
couÁ
 + 19*19] = 1;

65 ++
couÁ
;

66 if(
couÁ
 >= 19*19) ;

69 
	}
}

71 
	$bßrd_to_¡ršg
(*
s
, *
bßrd
)

73 
i
, 
j
;

74 
	`mem£t
(
s
, 0, (19*19/4+1)*());

75 
couÁ
 = 0;

76 
i
 = 0; i < 91; ++i){

77 
j
 = 0; j < 4; ++j){

78 
me
 = (
bßrd
[
couÁ
] == 1);

79 
you
 = (
bßrd
[
couÁ
 + 19*19] == 1);

80 ià(
me
è
s
[
i
] = s[i] | (1<<(2*
j
));

81 ià(
you
è
s
[
i
] = s[i] | (1<<(2*
j
 + 1));

82 ++
couÁ
;

83 if(
couÁ
 >= 19*19) ;

86 
	}
}

88 
	$occup›d
(*
b
, 
i
)

90 ià(
b
[
i
])  1;

91 ià(
b
[
i
+19*19])  -1;

93 
	}
}

95 
d©a
 
	$¿ndom_go_moves
(
moves
 
m
, 
n
)

97 
d©a
 
d
 = {0};

98 
d
.
X
 = 
	`make_m©rix
(
n
, 19*19*3);

99 
d
.
y
 = 
	`make_m©rix
(
n
, 19*19+2);

100 
i
, 
j
;

101 
i
 = 0; i < 
n
; ++i){

102 *
bßrd
 = 
d
.
X
.
v®s
[
i
];

103 *
Ïb–
 = 
d
.
y
.
v®s
[
i
];

104 *
b
 = 
m
.
d©a
[
	`¿nd
()%m.
n
];

105 
¶ay”
 = 
b
[0] - '0';

106 
»suÉ
 = 
b
[1] - '0';

107 
row
 = 
b
[2];

108 
cŞ
 = 
b
[3];

109 
	`¡ršg_to_bßrd
(
b
+4, 
bßrd
);

110 if(
¶ay”
 > 0è
j
 = 0; j < 19*19; ++jè
bßrd
[19*19*2 + j] = 1;

111 
Ïb–
[19*19+1] = (
¶ay”
==
»suÉ
);

112 if(
row
 >ğ19 || 
cŞ
 >= 19){

113 
Ïb–
[19*19] = 1;

115 
Ïb–
[
cŞ
 + 19*
row
] = 1;

116 if(
	`occup›d
(
bßrd
, 
cŞ
 + 19*
row
)è
	`´štf
("hey\n");

119 
æ
 = 
	`¿nd
()%2;

120 
rÙ©e
 = 
	`¿nd
()%4;

121 
image
 
š
 = 
	`æßt_to_image
(19, 19, 3, 
bßrd
);

122 
image
 
out
 = 
	`æßt_to_image
(19, 19, 1, 
Ïb–
);

123 if(
æ
){

124 
	`æ_image
(
š
);

125 
	`æ_image
(
out
);

127 
	`rÙ©e_image_cw
(
š
, 
rÙ©e
);

128 
	`rÙ©e_image_cw
(
out
, 
rÙ©e
);

130  
d
;

131 
	}
}

134 
	$Œaš_go
(*
cfgfe
, *
weightfe
, *
f’ame
, *
gpus
, 
ngpus
, 
ş—r
)

136 
i
;

137 
avg_loss
 = -1;

138 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

139 
	`´štf
("%s\n", 
ba£
);

140 
	`´štf
("%d\n", 
ngpus
);

141 
ÃtwÜk
 **
Ãts
 = 
	`ÿÎoc
(
ngpus
, (network*));

143 
	`¤ªd
(
	`time
(0));

144 
£ed
 = 
	`¿nd
();

145 
i
 = 0; i < 
ngpus
; ++i){

146 
	`¤ªd
(
£ed
);

147 #ifdeà
GPU


148 
	`cuda_£t_deviû
(
gpus
[
i
]);

150 
Ãts
[
i
] = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

151 
Ãts
[
i
]->
Ë¬nšg_¿‹
 *ğ
ngpus
;

153 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

154 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

156 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

158 
buff
[256];

159 
moves
 
m
 = 
	`lßd_go_moves
(
f’ame
);

162 
N
 = 
m
.
n
;

163 
	`´štf
("Moves: %d\n", 
N
);

164 
•och
 = (*
Ãt
->
£’
)/
N
;

165 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

166 
time
=
	`wh©_time_is_™_now
();

168 
d©a
 
Œaš
 = 
	`¿ndom_go_moves
(
m
, 
Ãt
->
b©ch
*Ãt->
subdivisiÚs
*
ngpus
);

169 
	`´štf
("Lßded: %là£cÚds\n", 
	`wh©_time_is_™_now
(è- 
time
);

170 
time
=
	`wh©_time_is_™_now
();

172 
loss
 = 0;

173 #ifdeà
GPU


174 if(
ngpus
 == 1){

175 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

177 
loss
 = 
	`Œaš_ÃtwÜks
(
Ãts
, 
ngpus
, 
Œaš
, 10);

180 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

182 
	`ä“_d©a
(
Œaš
);

184 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

185 
avg_loss
 =‡vg_loss*.95 + 
loss
*.05;

186 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`wh©_time_is_™_now
()-
time
, *net->seen);

187 if(*
Ãt
->
£’
/
N
 > 
•och
){

188 
•och
 = *
Ãt
->
£’
/
N
;

189 
buff
[256];

190 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
,
ba£
, 
•och
);

191 
	`§ve_weights
(
Ãt
, 
buff
);

194 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%1000 == 0){

195 
buff
[256];

196 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

197 
	`§ve_weights
(
Ãt
, 
buff
);

199 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%10000 == 0){

200 
buff
[256];

201 
	`¥rštf
(
buff
, "%s/%s_%ld.backup",
backup_dœeùÜy
,
ba£
,
	`g‘_cu¼’t_b©ch
(
Ãt
));

202 
	`§ve_weights
(
Ãt
, 
buff
);

205 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

206 
	`§ve_weights
(
Ãt
, 
buff
);

208 
	`ä“_ÃtwÜk
(
Ãt
);

209 
	`ä“
(
ba£
);

210 
	}
}

212 
	$´İag©e_lib”ty
(*
bßrd
, *
lib
, *
vis™ed
, 
row
, 
cŞ
, 
side
)

214 ià(
row
 < 0 ||„ow > 18 || 
cŞ
 < 0 || col > 18) ;

215 
šdex
 = 
row
*19 + 
cŞ
;

216 ià(
	`occup›d
(
bßrd
,
šdex
è!ğ
side
) ;

217 ià(
vis™ed
[
šdex
]) ;

218 
vis™ed
[
šdex
] = 1;

219 
lib
[
šdex
] += 1;

220 
	`´İag©e_lib”ty
(
bßrd
, 
lib
, 
vis™ed
, 
row
+1, 
cŞ
, 
side
);

221 
	`´İag©e_lib”ty
(
bßrd
, 
lib
, 
vis™ed
, 
row
-1, 
cŞ
, 
side
);

222 
	`´İag©e_lib”ty
(
bßrd
, 
lib
, 
vis™ed
, 
row
, 
cŞ
+1, 
side
);

223 
	`´İag©e_lib”ty
(
bßrd
, 
lib
, 
vis™ed
, 
row
, 
cŞ
-1, 
side
);

224 
	}
}

227 *
	$ÿlcuÏ‹_lib”t›s
(*
bßrd
)

229 *
lib
 = 
	`ÿÎoc
(19*19, ());

230 
vis™ed
[19*19];

231 
i
, 
j
;

232 
j
 = 0; j < 19; ++j){

233 
i
 = 0; i < 19; ++i){

234 
	`mem£t
(
vis™ed
, 0, 19*19*());

235 
šdex
 = 
j
*19 + 
i
;

236 if(!
	`occup›d
(
bßrd
,
šdex
)){

237 ià((
i
 > 0è&& 
	`occup›d
(
bßrd
,
šdex
 - 1)è
	`´İag©e_lib”ty
(bßrd, 
lib
, 
vis™ed
, 
j
, i-1, occupied(board,index-1));

238 ià((
i
 < 18è&& 
	`occup›d
(
bßrd
,
šdex
 + 1)è
	`´İag©e_lib”ty
(bßrd, 
lib
, 
vis™ed
, 
j
, i+1, occupied(board,index+1));

239 ià((
j
 > 0è&& 
	`occup›d
(
bßrd
,
šdex
 - 19)è
	`´İag©e_lib”ty
(bßrd, 
lib
, 
vis™ed
, j-1, 
i
, occupied(board,index-19));

240 ià((
j
 < 18è&& 
	`occup›d
(
bßrd
,
šdex
 + 19)è
	`´İag©e_lib”ty
(bßrd, 
lib
, 
vis™ed
, j+1, 
i
, occupied(board,index+19));

244  
lib
;

245 
	}
}

247 
	$´št_bßrd
(
FILE
 *
¡»am
, *
bßrd
, 
¶ay”
, *
šdexes
)

249 
i
,
j
,
n
;

250 
	`årštf
(
¡»am
, " ");

251 
i
 = 0; i < 19; ++i){

252 
	`årštf
(
¡»am
, "%ø", 'A' + 
i
 + 1*(˜> 7 && 
noi
));

254 
	`årštf
(
¡»am
, "\n");

255 
j
 = 0; j < 19; ++j){

256 
	`årštf
(
¡»am
, "%2d", (
šv”‹d
è? 19-
j
 : j+1);

257 
i
 = 0; i < 19; ++i){

258 
šdex
 = 
j
*19 + 
i
;

259 if(
šdexes
){

260 
found
 = 0;

261 
n
 = 0;‚ < 
nšd
; ++n){

262 if(
šdex
 =ğ
šdexes
[
n
]){

263 
found
 = 1;

271 
	`årštf
(
¡»am
, " %d", 
n
+1);

274 if(
found
) ;

278 ià(
	`occup›d
(
bßrd
, 
šdex
è=ğ
¶ay”
è
	`årštf
(
¡»am
, " X");

279 ià(
	`occup›d
(
bßrd
, 
šdex
è==-
¶ay”
è
	`årštf
(
¡»am
, " O");

280 
	`årštf
(
¡»am
, " .");

282 
	`årštf
(
¡»am
, "\n");

284 
	}
}

286 
	$æ_bßrd
(*
bßrd
)

288 
i
;

289 
i
 = 0; i < 19*19; ++i){

290 
sw­
 = 
bßrd
[
i
];

291 
bßrd
[
i
] = board[i+19*19];

292 
bßrd
[
i
+19*19] = 
sw­
;

293 
bßrd
[
i
+19*19*2] = 1-board[i+19*19*2];

295 
	}
}

297 
	$´ediù_move2
(
ÃtwÜk
 *
Ãt
, *
bßrd
, *
move
, 
muÉi
)

299 *
ouut
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
bßrd
);

300 
	`cİy_ıu
(19*19+1, 
ouut
, 1, 
move
, 1);

301 
»suÉ
 = 
ouut
[19*19 + 1];

302 
i
;

303 if(
muÉi
){

304 
image
 
bim
 = 
	`æßt_to_image
(19, 19, 3, 
bßrd
);

305 
i
 = 1; i < 8; ++i){

306 
	`rÙ©e_image_cw
(
bim
, 
i
);

307 if(
i
 >ğ4è
	`æ_image
(
bim
);

309 *
ouut
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
bßrd
);

310 
image
 
oim
 = 
	`æßt_to_image
(19, 19, 1, 
ouut
);

311 
»suÉ
 +ğ
ouut
[19*19 + 1];

313 if(
i
 >ğ4è
	`æ_image
(
oim
);

314 
	`rÙ©e_image_cw
(
oim
, -
i
);

316 
	`axpy_ıu
(19*19+1, 1, 
ouut
, 1, 
move
, 1);

318 if(
i
 >ğ4è
	`æ_image
(
bim
);

319 
	`rÙ©e_image_cw
(
bim
, -
i
);

321 
»suÉ
 =„esult/8;

322 
	`sÿl_ıu
(19*19+1, 1./8., 
move
, 1);

324 
i
 = 0; i < 19*19; ++i){

325 if(
bßrd
[
i
] || bßrd[i+19*19]è
move
[i] = 0;

327  
»suÉ
;

328 
	}
}

330 
	$»move_cÚÃùed
(*
b
, *
lib
, 
p
, 
r
, 
c
)

332 ià(
r
 < 0 ||„ >ğ19 || 
c
 < 0 || c >= 19) ;

333 ià(
	`occup›d
(
b
, 
r
*19 + 
c
è!ğ
p
) ;

334 ià(
lib
[
r
*19 + 
c
] != 1) ;

335 
b
[
r
*19 + 
c
] = 0;

336 
b
[19*19 + 
r
*19 + 
c
] = 0;

337 
	`»move_cÚÃùed
(
b
, 
lib
, 
p
, 
r
+1, 
c
);

338 
	`»move_cÚÃùed
(
b
, 
lib
, 
p
, 
r
-1, 
c
);

339 
	`»move_cÚÃùed
(
b
, 
lib
, 
p
, 
r
, 
c
+1);

340 
	`»move_cÚÃùed
(
b
, 
lib
, 
p
, 
r
, 
c
-1);

341 
	}
}

344 
	$move_go
(*
b
, 
p
, 
r
, 
c
)

346 *
l
 = 
	`ÿlcuÏ‹_lib”t›s
(
b
);

347 if(
p
 > 0è
b
[
r
*19 + 
c
] = 1;

348 
b
[19*19 + 
r
*19 + 
c
] = 1;

349 
	`»move_cÚÃùed
(
b
, 
l
, -
p
, 
r
+1, 
c
);

350 
	`»move_cÚÃùed
(
b
, 
l
, -
p
, 
r
-1, 
c
);

351 
	`»move_cÚÃùed
(
b
, 
l
, -
p
, 
r
, 
c
+1);

352 
	`»move_cÚÃùed
(
b
, 
l
, -
p
, 
r
, 
c
-1);

353 
	`ä“
(
l
);

354 
	}
}

356 
	$com·»_bßrd
(*
a
, *
b
)

358 if(
	`memcmp
(
a
, 
b
, 19*19*3*()) == 0)  1;

360 
	}
}

362 
	smùs_Œ“
{

363 *
	mbßrd
;

364 
mùs_Œ“
 **
	mchd»n
;

365 *
	m´iÜ
;

366 *
	mvis™_couÁ
;

367 *
	mv®ue
;

368 *
	mm—n
;

369 *
	m´ob
;

370 
	mtÙ®_couÁ
;

371 
	m»suÉ
;

372 
	mdÚe
;

373 
	m·ss
;

374 } 
	tmùs_Œ“
;

376 
	$ä“_mùs
(
mùs_Œ“
 *
roÙ
)

378 if(!
roÙ
) ;

379 
i
;

380 
	`ä“
(
roÙ
->
bßrd
);

381 
i
 = 0; i < 19*19+1; ++i){

382 if(
roÙ
->
chd»n
[
i
]è
	`ä“_mùs
(root->children[i]);

384 
	`ä“
(
roÙ
->
chd»n
);

385 
	`ä“
(
roÙ
->
´iÜ
);

386 
	`ä“
(
roÙ
->
vis™_couÁ
);

387 
	`ä“
(
roÙ
->
v®ue
);

388 
	`ä“
(
roÙ
->
m—n
);

389 
	`ä“
(
roÙ
->
´ob
);

390 
	`ä“
(
roÙ
);

391 
	}
}

393 *
	$ÃtwÜk_´ediù_rÙ©iÚs
(
ÃtwÜk
 *
Ãt
, *
Ãxt
)

395 
n
 = 
Ãt
->
b©ch
;

396 *
š
 = 
	`ÿÎoc
(19*19*3*
n
, ());

397 
image
 
im
 = 
	`æßt_to_image
(19, 19, 3, 
Ãxt
);

398 
i
,
j
;

399 *
šds
 = 
	`¿ndom_šdex_Üd”
(0, 8);

400 
j
 = 0; j < 
n
; ++j){

401 
i
 = 
šds
[
j
];

402 
	`rÙ©e_image_cw
(
im
, 
i
);

403 if(
i
 >ğ4è
	`æ_image
(
im
);

404 
	`memıy
(
š
 + 19*19*3*
j
, 
im
.
d©a
, 19*19*3*());

405 if(
i
 >ğ4è
	`æ_image
(
im
);

406 
	`rÙ©e_image_cw
(
im
, -
i
);

408 *
´ed
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
š
);

409 
j
 = 0; j < 
n
; ++j){

410 
i
 = 
šds
[
j
];

411 
image
 
im
 = 
	`æßt_to_image
(19, 19, 1, 
´ed
 + 
j
*(19*19 + 2));

412 if(
i
 >ğ4è
	`æ_image
(
im
);

413 
	`rÙ©e_image_cw
(
im
, -
i
);

414 if(
j
 > 0){

415 
	`axpy_ıu
(19*19+2, 1, 
im
.
d©a
, 1, 
´ed
, 1);

418 
	`ä“
(
š
);

419 
	`ä“
(
šds
);

420 
	`sÿl_ıu
(19*19+2, 1./
n
, 
´ed
, 1);

421  
´ed
;

422 
	}
}

424 
mùs_Œ“
 *
	$ex·nd
(*
Ãxt
, *
ko
, 
ÃtwÜk
 *
Ãt
)

426 
mùs_Œ“
 *
roÙ
 = 
	`ÿÎoc
(1, (mcts_tree));

427 
roÙ
->
bßrd
 = 
Ãxt
;

428 
roÙ
->
chd»n
 = 
	`ÿÎoc
(19*19+1, (
mùs_Œ“
*));

429 
roÙ
->
´iÜ
 = 
	`ÿÎoc
(19*19 + 1, ());

430 
roÙ
->
´ob
 = 
	`ÿÎoc
(19*19 + 1, ());

431 
roÙ
->
m—n
 = 
	`ÿÎoc
(19*19 + 1, ());

432 
roÙ
->
v®ue
 = 
	`ÿÎoc
(19*19 + 1, ());

433 
roÙ
->
vis™_couÁ
 = 
	`ÿÎoc
(19*19 + 1, ());

434 
roÙ
->
tÙ®_couÁ
 = 1;

435 
i
;

436 *
´ed
 = 
	`ÃtwÜk_´ediù_rÙ©iÚs
(
Ãt
, 
Ãxt
);

437 
	`cİy_ıu
(19*19+1, 
´ed
, 1, 
roÙ
->
´iÜ
, 1);

438 
v®
 = 2*
´ed
[19*19 + 1] - 1;

439 
roÙ
->
»suÉ
 = 
v®
;

440 
i
 = 0; i < 19*19+1; ++i) {

441 
roÙ
->
vis™_couÁ
[
i
] = 0;

442 
roÙ
->
v®ue
[
i
] = 0;

443 
roÙ
->
m—n
[
i
] = 
v®
;

444 if(
i
 < 19*19 && 
	`occup›d
(
Ãxt
, i)){

445 
roÙ
->
v®ue
[
i
] = -1;

446 
roÙ
->
m—n
[
i
] = -1;

447 
roÙ
->
´iÜ
[
i
] = 0;

451  
roÙ
;

452 
	}
}

454 *
	$cİy_bßrd
(*
bßrd
)

456 *
Ãxt
 = 
	`ÿÎoc
(19*19*3, ());

457 
	`cİy_ıu
(19*19*3, 
bßrd
, 1, 
Ãxt
, 1);

458  
Ãxt
;

459 
	}
}

461 
	$£Ëù_mùs
(
mùs_Œ“
 *
roÙ
, 
ÃtwÜk
 *
Ãt
, *
´ev
, 
ıuù
)

463 if(
roÙ
->
dÚe
è -roÙ->
»suÉ
;

464 
i
;

465 
max
 = -1000;

466 
max_i
 = 0;

467 
i
 = 0; i < 19*19+1; ++i){

468 
roÙ
->
´ob
[
i
] =„oÙ->
m—n
[i] + 
ıuù
*roÙ->
´iÜ
[i] * 
	`sq¹
ÔoÙ->
tÙ®_couÁ
è/ (1. +„oÙ->
vis™_couÁ
[i]);

469 if(
roÙ
->
´ob
[
i
] > 
max
){

470 
max
 = 
roÙ
->
´ob
[
i
];

471 
max_i
 = 
i
;

474 
v®
;

475 
i
 = 
max_i
;

476 
roÙ
->
vis™_couÁ
[
i
]++;

477 
roÙ
->
tÙ®_couÁ
++;

478 ià(
roÙ
->
chd»n
[
i
]) {

479 
v®
 = 
	`£Ëù_mùs
(
roÙ
->
chd»n
[
i
], 
Ãt
,„oÙ->
bßrd
, 
ıuù
);

481 if(
max_i
 < 19*19 && !
	`Ëg®_go
(
roÙ
->
bßrd
, 
´ev
, 1, max_i/19, max_i%19)) {

482 
roÙ
->
m—n
[
i
] = -1;

483 
roÙ
->
v®ue
[
i
] = -1;

484 
roÙ
->
´iÜ
[
i
] = 0;

485 --
roÙ
->
tÙ®_couÁ
;

486  
	`£Ëù_mùs
(
roÙ
, 
Ãt
, 
´ev
, 
ıuù
);

490 *
Ãxt
 = 
	`cİy_bßrd
(
roÙ
->
bßrd
);

491 ià(
max_i
 < 19*19) {

492 
	`move_go
(
Ãxt
, 1, 
max_i
 / 19, max_i % 19);

494 
	`æ_bßrd
(
Ãxt
);

495 
roÙ
->
chd»n
[
i
] = 
	`ex·nd
(
Ãxt
,„oÙ->
bßrd
, 
Ãt
);

496 
v®
 = -
roÙ
->
chd»n
[
i
]->
»suÉ
;

497 if(
max_i
 == 19*19){

498 
roÙ
->
chd»n
[
i
]->
·ss
 = 1;

499 ià(
roÙ
->
·ss
){

500 
roÙ
->
chd»n
[
i
]->
dÚe
 = 1;

505 
roÙ
->
v®ue
[
i
] +ğ
v®
;

506 
roÙ
->
m—n
[
i
] =„oÙ->
v®ue
[i]/roÙ->
vis™_couÁ
[i];

507  -
v®
;

508 
	}
}

510 
mùs_Œ“
 *
	$run_mùs
(
mùs_Œ“
 *
Œ“
, 
ÃtwÜk
 *
Ãt
, *
bßrd
, *
ko
, 
¶ay”
, 
n
, 
ıuù
, 
£cs
)

512 
i
;

513 
t
 = 
	`wh©_time_is_™_now
();

514 if(
¶ay”
 < 0è
	`æ_bßrd
(
bßrd
);

515 if(!
Œ“
èŒ“ = 
	`ex·nd
(
	`cİy_bßrd
(
bßrd
), 
ko
, 
Ãt
);

516 
	`as£¹
(
	`com·»_bßrd
(
Œ“
->
bßrd
, board));

517 
i
 = 0; i < 
n
; ++i){

518 ià(
£cs
 > 0 && (
	`wh©_time_is_™_now
(è- 
t
) > secs) ;

519 
max_i
 = 
	`max_št_šdex
(
Œ“
->
vis™_couÁ
, 19*19+1);

520 ià(
Œ“
->
vis™_couÁ
[
max_i
] >ğ
n
) ;

521 
	`£Ëù_mùs
(
Œ“
, 
Ãt
, 
ko
, 
ıuù
);

523 if(
¶ay”
 < 0è
	`æ_bßrd
(
bßrd
);

525  
Œ“
;

526 
	}
}

528 
mùs_Œ“
 *
	$move_mùs
(
mùs_Œ“
 *
Œ“
, 
šdex
)

530 if(
šdex
 < 0 || index > 19*19 || !
Œ“
 || !Œ“->
chd»n
[index]) {

531 
	`ä“_mùs
(
Œ“
);

532 
Œ“
 = 0;

534 
mùs_Œ“
 *
sw­
 = 
Œ“
;

535 
Œ“
 =»e->
chd»n
[
šdex
];

536 
sw­
->
chd»n
[
šdex
] = 0;

537 
	`ä“_mùs
(
sw­
);

539  
Œ“
;

540 
	}
}

543 
	mv®ue
;

544 
	mmùs
;

545 
	mrow
;

546 
	mcŞ
;

547 } 
	tmove
;

549 
move
 
	$pick_move
(
mùs_Œ“
 *
Œ“
, 
‹mp
, 
¶ay”
)

551 
i
;

552 
´obs
[19*19+1] = {0};

553 
move
 
m
 = {0};

554 
sum
 = 0;

561 
i
 = 0; i < 19*19+1; ++i){

562 
sum
 +ğ
	`pow
(
Œ“
->
vis™_couÁ
[
i
], 1./
‹mp
);

564 
i
 = 0; i < 19*19+1; ++i){

565 
´obs
[
i
] = 
	`pow
(
Œ“
->
vis™_couÁ
[i], 1./
‹mp
è/ 
sum
;

568 
šdex
 = 
	`§m¶e_¬¿y
(
´obs
, 19*19+1);

569 
m
.
row
 = 
šdex
 / 19;

570 
m
.
cŞ
 = 
šdex
 % 19;

571 
m
.
v®ue
 = (
Œ“
->
»suÉ
+1.)/2.;

572 
m
.
mùs
 = (
Œ“
->
m—n
[
šdex
]+1.)/2.;

574 
šdexes
[
nšd
];

575 
	`tİ_k
(
´obs
, 19*19+1, 
nšd
, 
šdexes
);

576 
	`´št_bßrd
(
¡d”r
, 
Œ“
->
bßrd
, 
¶ay”
, 
šdexes
);

578 
	`årštf
(
¡d”r
, "%d %d, ResuÉ: %f, PriÜ: %f, Prob: %f, M—ÀV®ue: %f, Chd ResuÉ: %f, Vis™ed: %d\n", 
šdex
/19, index%19, 
Œ“
->
»suÉ
,»e->
´iÜ
[šdex], 
´obs
[šdex],»e->
m—n
[šdex], (Œ“->
chd»n
[šdex])?Œ“->chd»n[šdex]->»suÉ:0,»e->
vis™_couÁ
[index]);

579 
šd
 = 
	`max_šdex
(
´obs
, 19*19+1);

580 
	`årštf
(
¡d”r
, "%d %d, ResuÉ: %f, PriÜ: %f, Prob: %f, M—ÀV®ue: %f, Chd ResuÉ: %f, Vis™ed: %d\n", 
šd
/19, ind%19, 
Œ“
->
»suÉ
,»e->
´iÜ
[šd], 
´obs
[šd],»e->
m—n
[šd], (Œ“->
chd»n
[šd])?Œ“->chd»n[šd]->»suÉ:0,»e->
vis™_couÁ
[ind]);

581 
šd
 = 
	`max_šdex
(
Œ“
->
´iÜ
, 19*19+1);

582 
	`årštf
(
¡d”r
, "%d %d, ResuÉ: %f, PriÜ: %f, Prob: %f, M—ÀV®ue: %f, Chd ResuÉ: %f, Vis™ed: %d\n", 
šd
/19, ind%19, 
Œ“
->
»suÉ
,»e->
´iÜ
[šd], 
´obs
[šd],»e->
m—n
[šd], (Œ“->
chd»n
[šd])?Œ“->chd»n[šd]->»suÉ:0,»e->
vis™_couÁ
[ind]);

583  
m
;

584 
	}
}

614 
	$makes_§ã_go
(*
b
, *
lib
, 
p
, 
r
, 
c
){

615 ià(
r
 < 0 ||„ >ğ19 || 
c
 < 0 || c >= 19)  0;

616 ià(
	`occup›d
(
b
,
r
*19 + 
c
è=ğ-
p
){

617 ià(
lib
[
r
*19 + 
c
] > 1)  0;

620 ià(!
	`occup›d
(
b
,
r
*19 + 
c
))  1;

621 ià(
lib
[
r
*19 + 
c
] > 1)  1;

623 
	}
}

625 
	$suicide_go
(*
b
, 
p
, 
r
, 
c
)

627 *
l
 = 
	`ÿlcuÏ‹_lib”t›s
(
b
);

628 
§ã
 = 0;

629 
§ã
 = saã || 
	`makes_§ã_go
(
b
, 
l
, 
p
, 
r
+1, 
c
);

630 
§ã
 = saã || 
	`makes_§ã_go
(
b
, 
l
, 
p
, 
r
-1, 
c
);

631 
§ã
 = saã || 
	`makes_§ã_go
(
b
, 
l
, 
p
, 
r
, 
c
+1);

632 
§ã
 = saã || 
	`makes_§ã_go
(
b
, 
l
, 
p
, 
r
, 
c
-1);

633 
	`ä“
(
l
);

634  !
§ã
;

635 
	}
}

637 
	$check_ko
(*
x
, *
ko
)

639 if(!
ko
)  0;

640 
cu¼
[19*19*3];

641 
	`cİy_ıu
(19*19*3, 
x
, 1, 
cu¼
, 1);

642 if(
cu¼
[19*19*2] !ğ
ko
[19*19*2]è
	`æ_bßrd
(curr);

643 if(
	`com·»_bßrd
(
cu¼
, 
ko
))  1;

645 
	}
}

647 
	$Ëg®_go
(*
b
, *
ko
, 
p
, 
r
, 
c
)

649 ià(
	`occup›d
(
b
, 
r
*19+
c
))  0;

650 
cu¼
[19*19*3];

651 
	`cİy_ıu
(19*19*3, 
b
, 1, 
cu¼
, 1);

652 
	`move_go
(
cu¼
, 
p
, 
r
, 
c
);

653 if(
	`check_ko
(
cu¼
, 
ko
))  0;

654 if(
	`suicide_go
(
b
, 
p
, 
r
, 
c
))  0;

656 
	}
}

733 
	$v®id_go
(*
cfgfe
, *
weightfe
, 
muÉi
, *
f’ame
)

735 
	`¤ªd
(
	`time
(0));

736 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

737 
	`´štf
("%s\n", 
ba£
);

738 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

739 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

740 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

742 *
bßrd
 = 
	`ÿÎoc
(19*19*3, ());

743 *
move
 = 
	`ÿÎoc
(19*19+2, ());

745 
moves
 
m
 = 
	`lßd_go_moves
(
f’ame
);

747 
N
 = 
m
.
n
;

748 
i
,
j
;

749 
cÜ»ù
 = 0;

750 
i
 = 0; i <
N
; ++i) {

751 *
b
 = 
m
.
d©a
[
i
];

752 
¶ay”
 = 
b
[0] - '0';

754 
row
 = 
b
[2];

755 
cŞ
 = 
b
[3];

756 
Œuth
 = 
cŞ
 + 19*
row
;

757 
	`¡ršg_to_bßrd
(
b
+4, 
bßrd
);

758 if(
¶ay”
 > 0è
j
 = 0; j < 19*19; ++jè
bßrd
[19*19*2 + j] = 1;

759 
	`´ediù_move2
(
Ãt
, 
bßrd
, 
move
, 
muÉi
);

760 
šdex
 = 
	`max_šdex
(
move
, 19*19+1);

761 if(
šdex
 =ğ
Œuth
è++
cÜ»ù
;

762 
	`´štf
("%d Accu¿cy %f\n", 
i
, (è
cÜ»ù
/(i+1));

764 
	}
}

766 
	$´št_game
(*
bßrd
, 
FILE
 *
å
)

768 
i
, 
j
;

769 
couÁ
 = 3;

770 
	`årštf
(
å
, "komi 6.5\n");

771 
	`årštf
(
å
, "boardsize 19\n");

772 
	`årštf
(
å
, "clear_board\n");

773 
j
 = 0; j < 19; ++j){

774 
i
 = 0; i < 19; ++i){

775 if(
	`occup›d
(
bßrd
,
j
*19 + 
i
è=ğ1è
	`årštf
(
å
, "play black %c%d\n", 'A'+i+(i>=8), 19-j);

776 if(
	`occup›d
(
bßrd
,
j
*19 + 
i
è=ğ-1è
	`årštf
(
å
, "play white %c%d\n", 'A'+i+(i>=8), 19-j);

777 if(
	`occup›d
(
bßrd
,
j
*19 + 
i
)è++
couÁ
;

780  
couÁ
;

781 
	}
}

784 
	$¡dš_»ady
()

786 
fd_£t
 
»adfds
;

787 
	`FD_ZERO
(&
»adfds
);

789 
timev®
 
timeout
;

790 
timeout
.
tv_£c
 = 0;

791 
timeout
.
tv_u£c
 = 0;

792 
	`FD_SET
(
STDIN_FILENO
, &
»adfds
);

794 ià(
	`£Ëù
(1, &
»adfds
, 
NULL
, NULL, &
timeout
)){

798 
	}
}

800 
mùs_Œ“
 *
	$pÚd”
(
mùs_Œ“
 *
Œ“
, 
ÃtwÜk
 *
Ãt
, *
b
, *
ko
, 
¶ay”
, 
ıuù
)

802 
t
 = 
	`wh©_time_is_™_now
();

803 
couÁ
 = 0;

804 ià(
Œ“
è
couÁ
 =»e->
tÙ®_couÁ
;

805 !
	`¡dš_»ady
()){

806 ià(
	`wh©_time_is_™_now
(è- 
t
 > 120) ;

807 
Œ“
 = 
	`run_mùs
Ñ»e, 
Ãt
, 
b
, 
ko
, 
¶ay”
, 100000, 
ıuù
, .1);

809 
	`årštf
(
¡d”r
, "PÚd”ed %d moves...\n", 
Œ“
->
tÙ®_couÁ
 - 
couÁ
);

810  
Œ“
;

811 
	}
}

813 
	$’gše_go
(*
f’ame
, *
weightfe
, 
mùs_™”s
, 
£cs
, 
‹mp
, 
ıuù
, 
ªÚ
, 
»sign
)

815 
mùs_Œ“
 *
roÙ
 = 0;

816 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

817 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

818 
	`¤ªd
(
	`time
(0));

819 *
bßrd
 = 
	`ÿÎoc
(19*19*3, ());

820 
	`æ_bßrd
(
bßrd
);

821 *
Úe
 = 
	`ÿÎoc
(19*19*3, ());

822 *
two
 = 
	`ÿÎoc
(19*19*3, ());

823 
pÚd”_¶ay”
 = 0;

824 
·s£d
 = 0;

825 
move_num
 = 0;

826 
maš_time
 = 0;

827 
byo_yomi_time
 = 0;

828 
byo_yomi_¡Úes
 = 0;

829 
bÏck_time_Ëá
 = 0;

830 
bÏck_¡Úes_Ëá
 = 0;

831 
wh™e_time_Ëá
 = 0;

832 
wh™e_¡Úes_Ëá
 = 0;

833 
Üig_time
 = 
£cs
;

834 
Şd_pÚd”
 = 0;

836 if(
pÚd”_¶ay”
){

837 
roÙ
 = 
	`pÚd”
ÔoÙ, 
Ãt
, 
bßrd
, 
two
, 
pÚd”_¶ay”
, 
ıuù
);

839 
Şd_pÚd”
 = 
pÚd”_¶ay”
;

840 
pÚd”_¶ay”
 = 0;

841 
buff
[256];

842 
id
 = 0;

843 
has_id
 = (
	`sÿnf
("%d", &
id
) == 1);

844 
	`sÿnf
("%s", 
buff
);

845 ià(
	`ãof
(
¡dš
)) ;

846 
	`årštf
(
¡d”r
, "%s\n", 
buff
);

847 
ids
[256];

848 
	`¥rštf
(
ids
, "%d", 
id
);

850 ià(!
has_id
è
ids
[0] = 0;

851 ià(!
	`¡rcmp
(
buff
, "protocol_version")){

852 
	`´štf
("=% 2\n\n", 
ids
);

853 } ià(!
	`¡rcmp
(
buff
, "name")){

854 if(
ªÚ
){

855 
	`´štf
("=% ThFoŞ!\n\n", 
ids
);

857 
	`´štf
("=% D¬kGo\n\n", 
ids
);

859 } ià(!
	`¡rcmp
(
buff
, "time_settings")){

860 
pÚd”_¶ay”
 = 
Şd_pÚd”
;

861 
	`sÿnf
("%d %d %d", &
maš_time
, &
byo_yomi_time
, &
byo_yomi_¡Úes
);

862 
	`´štf
("=% \n\n", 
ids
);

863 } ià(!
	`¡rcmp
(
buff
, "time_left")){

864 
pÚd”_¶ay”
 = 
Şd_pÚd”
;

865 
cŞÜ
[256];

866 
time
 = 0, 
¡Úes
 = 0;

867 
	`sÿnf
("% %d %d", 
cŞÜ
, &
time
, &
¡Úes
);

868 ià(
cŞÜ
[0] == 'b' || color[0] == 'B'){

869 
bÏck_time_Ëá
 = 
time
;

870 
bÏck_¡Úes_Ëá
 = 
¡Úes
;

872 
wh™e_time_Ëá
 = 
time
;

873 
wh™e_¡Úes_Ëá
 = 
¡Úes
;

875 
	`´štf
("=% \n\n", 
ids
);

876 } ià(!
	`¡rcmp
(
buff
, "version")){

877 if(
ªÚ
){

878 
	`´štf
("=% :-DDDD\n\n", 
ids
);

880 
	`´štf
("=% 1.0. WªˆmÜD¬kGo? You cª fšd mÚ OGS, uÆim™ed games,‚Øwa™šg! h‰ps://Úlše-go.com/u£r/v›w/434218\n\n", 
ids
);

882 } ià(!
	`¡rcmp
(
buff
, "known_command")){

883 
comm
[256];

884 
	`sÿnf
("%s", 
comm
);

885 
known
 = (!
	`¡rcmp
(
comm
, "protocol_version") ||

886 !
	`¡rcmp
(
comm
, "name") ||

887 !
	`¡rcmp
(
comm
, "version") ||

888 !
	`¡rcmp
(
comm
, "known_command") ||

889 !
	`¡rcmp
(
comm
, "list_commands") ||

890 !
	`¡rcmp
(
comm
, "quit") ||

891 !
	`¡rcmp
(
comm
, "boardsize") ||

892 !
	`¡rcmp
(
comm
, "clear_board") ||

893 !
	`¡rcmp
(
comm
, "komi") ||

894 !
	`¡rcmp
(
comm
, "final_status_list") ||

895 !
	`¡rcmp
(
comm
, "play") ||

896 !
	`¡rcmp
(
comm
, "genmove_white") ||

897 !
	`¡rcmp
(
comm
, "genmove_black") ||

898 !
	`¡rcmp
(
comm
, "fixed_handicap") ||

899 !
	`¡rcmp
(
comm
, "genmove"));

900 if(
known
è
	`´štf
("=% Œue\n\n", 
ids
);

901 
	`´štf
("=% çl£\n\n", 
ids
);

902 } ià(!
	`¡rcmp
(
buff
, "list_commands")){

903 
	`´štf
("=% ´ÙocŞ_v”siÚ\nshowbßrd\Âame\nv”siÚ\nknown_commªd\Æi¡_commªds\nqu™\nbßrdsize\nş—r_bßrd\nkomi\ÅÏy\ng’move_bÏck\ng’move_wh™e\ng’move\nfš®_¡©us_li¡\nfixed_hªdiÿp\n\n", 
ids
);

904 } ià(!
	`¡rcmp
(
buff
, "quit")){

906 } ià(!
	`¡rcmp
(
buff
, "boardsize")){

907 
bßrdsize
 = 0;

908 
	`sÿnf
("%d", &
bßrdsize
);

910 if(
bßrdsize
 != 19){

911 
	`´štf
("?% uÇcû±abË size\n\n", 
ids
);

913 
roÙ
 = 
	`move_mùs
(root, -1);

914 
	`mem£t
(
bßrd
, 0, 3*19*19*());

915 
	`æ_bßrd
(
bßrd
);

916 
move_num
 = 0;

917 
	`´štf
("=% \n\n", 
ids
);

919 } ià(!
	`¡rcmp
(
buff
, "fixed_handicap")){

920 
hªdiÿp
 = 0;

921 
	`sÿnf
("%d", &
hªdiÿp
);

922 
šdexes
[] = {72, 288, 300, 60, 180, 174, 186, 66, 294};

923 
i
;

924 
i
 = 0; i < 
hªdiÿp
; ++i){

925 
bßrd
[
šdexes
[
i
]] = 1;

926 ++
move_num
;

928 
roÙ
 = 
	`move_mùs
(root, -1);

929 } ià(!
	`¡rcmp
(
buff
, "clear_board")){

930 
·s£d
 = 0;

931 
	`mem£t
(
bßrd
, 0, 3*19*19*());

932 
	`æ_bßrd
(
bßrd
);

933 
move_num
 = 0;

934 
roÙ
 = 
	`move_mùs
(root, -1);

935 
	`´štf
("=% \n\n", 
ids
);

936 } ià(!
	`¡rcmp
(
buff
, "komi")){

937 
komi
 = 0;

938 
	`sÿnf
("%f", &
komi
);

939 
	`´štf
("=% \n\n", 
ids
);

940 } ià(!
	`¡rcmp
(
buff
, "showboard")){

941 
	`´štf
("=% \n", 
ids
);

942 
	`´št_bßrd
(
¡dout
, 
bßrd
, 1, 0);

943 
	`´štf
("\n");

944 } ià(!
	`¡rcmp
(
buff
, "play") || !strcmp(buff, "black") || !strcmp(buff, "white")){

945 ++
move_num
;

946 
cŞÜ
[256];

947 if(!
	`¡rcmp
(
buff
, "play"))

949 
	`sÿnf
("% ", 
cŞÜ
);

951 
	`sÿnf
(" ");

952 
cŞÜ
[0] = 
buff
[0];

954 
c
;

955 
r
;

956 
couÁ
 = 
	`sÿnf
("%c%d", &
c
, &
r
);

957 
¶ay”
 = (
cŞÜ
[0] == 'b' || color[0] == 'B') ? 1 : -1;

958 if((
c
 =ğ'p' || c =ğ'P'è&& 
couÁ
 < 2) {

959 
·s£d
 = 1;

960 
	`´štf
("=% \n\n", 
ids
);

961 *
lše
 = 
	`fg‘l
(
¡dš
);

962 
	`ä“
(
lše
);

963 
	`fæush
(
¡dout
);

964 
	`fæush
(
¡d”r
);

965 
roÙ
 = 
	`move_mùs
(root, 19*19);

968 
·s£d
 = 0;

970 if(
c
 >= 'A' && c <= 'Z') c = c - 'A';

971 if(
c
 >= 'a' && c <= 'z') c = c - 'a';

972 if(
c
 >= 8) --c;

973 
r
 = 19 -„;

974 
	`årštf
(
¡d”r
, "move: %d %d\n", 
r
, 
c
);

976 *
sw­
 = 
two
;

977 
two
 = 
Úe
;

978 
Úe
 = 
sw­
;

979 
	`move_go
(
bßrd
, 
¶ay”
, 
r
, 
c
);

980 
	`cİy_ıu
(19*19*3, 
bßrd
, 1, 
Úe
, 1);

981 if(
roÙ
è
	`årštf
(
¡d”r
, "PriÜ: %f\n",„oÙ->
´iÜ
[
r
*19 + 
c
]);

982 if(
roÙ
è
	`årštf
(
¡d”r
, "M—n: %f\n",„oÙ->
m—n
[
r
*19 + 
c
]);

983 if(
roÙ
è
	`årštf
(
¡d”r
, "ResuÉ: %f\n",„oÙ->
»suÉ
);

984 
roÙ
 = 
	`move_mùs
ÔoÙ, 
r
*19 + 
c
);

985 if(
roÙ
è
	`årštf
(
¡d”r
, "Vis™ed: %d\n",„oÙ->
tÙ®_couÁ
);

986 
	`årštf
(
¡d”r
, "NOT VISITED\n");

988 
	`´štf
("=% \n\n", 
ids
);

990 } ià(!
	`¡rcmp
(
buff
, "genmove") || !strcmp(buff, "genmove_black") || !strcmp(buff, "genmove_white")){

991 ++
move_num
;

992 
¶ay”
 = 0;

993 if(!
	`¡rcmp
(
buff
, "genmove")){

994 
cŞÜ
[256];

995 
	`sÿnf
("%s", 
cŞÜ
);

996 
¶ay”
 = (
cŞÜ
[0] == 'b' || color[0] == 'B') ? 1 : -1;

997 } ià(!
	`¡rcmp
(
buff
, "genmove_black")){

998 
¶ay”
 = 1;

1000 
¶ay”
 = -1;

1002 if(
¶ay”
 > 0){

1003 if(
bÏck_time_Ëá
 <ğ30è
£cs
 = 2.5;

1004 
£cs
 = 
Üig_time
;

1006 if(
wh™e_time_Ëá
 <ğ30è
£cs
 = 2.5;

1007 
£cs
 = 
Üig_time
;

1009 
pÚd”_¶ay”
 = -
¶ay”
;

1012 
t
 = 
	`wh©_time_is_™_now
();

1013 
roÙ
 = 
	`run_mùs
ÔoÙ, 
Ãt
, 
bßrd
, 
two
, 
¶ay”
, 
mùs_™”s
, 
ıuù
, 
£cs
);

1014 
	`årštf
(
¡d”r
, "%àSecÚds\n", 
	`wh©_time_is_™_now
(è- 
t
);

1015 
move
 
m
 = 
	`pick_move
(
roÙ
, 
‹mp
, 
¶ay”
);

1016 
roÙ
 = 
	`move_mùs
ÔoÙ, 
m
.
row
*19 + m.
cŞ
);

1019 if(
move_num
 > 
»sign
 && 
m
.
v®ue
 < .1 && m.
mùs
 < .1){

1020 
	`´štf
("=% »sign\n\n", 
ids
);

1021 } if(
m
.
row
 == 19){

1022 
	`´štf
("=% ·ss\n\n", 
ids
);

1023 
·s£d
 = 0;

1025 
row
 = 
m
.row;

1026 
cŞ
 = 
m
.col;

1028 *
sw­
 = 
two
;

1029 
two
 = 
Úe
;

1030 
Úe
 = 
sw­
;

1032 
	`move_go
(
bßrd
, 
¶ay”
, 
row
, 
cŞ
);

1033 
	`cİy_ıu
(19*19*3, 
bßrd
, 1, 
Úe
, 1);

1034 
row
 = 19 -„ow;

1035 ià(
cŞ
 >= 8) ++col;

1036 
	`´štf
("=% %c%d\n\n", 
ids
, 'A' + 
cŞ
, 
row
);

1039 } ià(!
	`¡rcmp
(
buff
, "p")){

1041 } ià(!
	`¡rcmp
(
buff
, "final_status_list")){

1042 
ty³
[256];

1043 
	`sÿnf
("%s", 
ty³
);

1044 
	`årštf
(
¡d”r
, "final_status\n");

1045 *
lše
 = 
	`fg‘l
(
¡dš
);

1046 
	`ä“
(
lše
);

1047 if(
ty³
[0] == 'd' ||ype[0] == 'D'){

1048 
i
;

1049 
FILE
 *
f
 = 
	`fİ’
("game.txt", "w");

1050 
couÁ
 = 
	`´št_game
(
bßrd
, 
f
);

1051 
	`årštf
(
f
, "% fš®_¡©us_li¡ d—d\n", 
ids
);

1052 
	`fşo£
(
f
);

1053 
FILE
 *
p
 = 
	`pİ’
("./gnugo --mode gtp < game.txt", "r");

1054 
i
 = 0; i < 
couÁ
; ++i){

1055 
	`ä“
(
	`fg‘l
(
p
));

1056 
	`ä“
(
	`fg‘l
(
p
));

1058 *
l
 = 0;

1059 (
l
 = 
	`fg‘l
(
p
))){

1060 
	`´štf
("%s\n", 
l
);

1061 
	`ä“
(
l
);

1064 
	`´štf
("?% unknowÀcommªd\n\n", 
ids
);

1066 } ià(!
	`¡rcmp
(
buff
, "kgs-genmove_cleanup")){

1067 
ty³
[256];

1068 
	`sÿnf
("%s", 
ty³
);

1069 
	`årštf
(
¡d”r
, "kgs-genmove_cleanup\n");

1070 *
lše
 = 
	`fg‘l
(
¡dš
);

1071 
	`ä“
(
lše
);

1072 
i
;

1073 
FILE
 *
f
 = 
	`fİ’
("game.txt", "w");

1074 
couÁ
 = 
	`´št_game
(
bßrd
, 
f
);

1075 
	`årštf
(
f
, "% kgs-g’move_ş—nu°%s\n", 
ids
, 
ty³
);

1076 
	`fşo£
(
f
);

1077 
FILE
 *
p
 = 
	`pİ’
("./gnugo --mode gtp < game.txt", "r");

1078 
i
 = 0; i < 
couÁ
; ++i){

1079 
	`ä“
(
	`fg‘l
(
p
));

1080 
	`ä“
(
	`fg‘l
(
p
));

1082 *
l
 = 0;

1083 (
l
 = 
	`fg‘l
(
p
))){

1084 
	`´štf
("%s\n", 
l
);

1085 
	`ä“
(
l
);

1088 *
lše
 = 
	`fg‘l
(
¡dš
);

1089 
	`ä“
(
lše
);

1090 
	`´štf
("?% unknowÀcommªd\n\n", 
ids
);

1092 
	`fæush
(
¡dout
);

1093 
	`fæush
(
¡d”r
);

1095 
	`´štf
("%d %d %d\n",
·s£d
, 
bÏck_¡Úes_Ëá
, 
wh™e_¡Úes_Ëá
);

1096 
	}
}

1098 
	$‹¡_go
(*
cfg
, *
weights
, 
muÉi
)

1100 
i
;

1101 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

1102 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

1103 
	`¤ªd
(
	`time
(0));

1104 *
bßrd
 = 
	`ÿÎoc
(19*19*3, ());

1105 
	`æ_bßrd
(
bßrd
);

1106 *
move
 = 
	`ÿÎoc
(19*19+1, ());

1107 
cŞÜ
 = 1;

1109 
»suÉ
 = 
	`´ediù_move2
(
Ãt
, 
bßrd
, 
move
, 
muÉi
);

1110 
	`´štf
("%.2f%% Wš Chªû\n", (
»suÉ
+1)/2*100);

1112 
šdexes
[
nšd
];

1113 
row
, 
cŞ
;

1114 
	`tİ_k
(
move
, 19*19+1, 
nšd
, 
šdexes
);

1115 
	`´št_bßrd
(
¡d”r
, 
bßrd
, 
cŞÜ
, 
šdexes
);

1116 
i
 = 0; i < 
nšd
; ++i){

1117 
šdex
 = 
šdexes
[
i
];

1118 
row
 = 
šdex
 / 19;

1119 
cŞ
 = 
šdex
 % 19;

1120 if(
row
 == 19){

1121 
	`´štf
("%d: Pass, %.2f%%\n", 
i
+1, 
move
[
šdex
]*100);

1123 
	`´štf
("%d: %ø%d, %.2f%%\n", 
i
+1, 
cŞ
 + 'A' + 1*(cŞ > 7 && 
noi
), (
šv”‹d
)?19 - 
row
 :„ow+1, 
move
[
šdex
]*100);

1128 if(
cŞÜ
 =ğ1è
	`´štf
("X Enter move: ");

1129 
	`´štf
("O Enter move: ");

1131 
c
;

1132 *
lše
 = 
	`fg‘l
(
¡dš
);

1133 
picked
 = 1;

1134 
dnum
 = 
	`ssÿnf
(
lše
, "%d", &
picked
);

1135 
úum
 = 
	`ssÿnf
(
lše
, "%c", &
c
);

1136 ià(
	`¡¾’
(
lše
è=ğ0 || 
dnum
) {

1137 --
picked
;

1138 ià(
picked
 < 
nšd
){

1139 
šdex
 = 
šdexes
[
picked
];

1140 
row
 = 
šdex
 / 19;

1141 
cŞ
 = 
šdex
 % 19;

1142 if(
row
 < 19){

1143 
	`move_go
(
bßrd
, 1, 
row
, 
cŞ
);

1146 } ià(
úum
){

1147 ià(
c
 <= 'T' && c >= 'A'){

1148 
num
 = 
	`ssÿnf
(
lše
, "%ø%d", &
c
, &
row
);

1149 
row
 = (
šv”‹d
)?19 -„ow :„ow-1;

1150 
cŞ
 = 
c
 - 'A';

1151 ià(
cŞ
 > 7 && 
noi
) col -= 1;

1152 ià(
num
 =ğ2è
	`move_go
(
bßrd
, 1, 
row
, 
cŞ
);

1153 } ià(
c
 == 'p') {

1155 } if(
c
=='b' || c == 'w'){

1156 
g
;

1157 
num
 = 
	`ssÿnf
(
lše
, "%ø%ø%d", &
g
, &
c
, &
row
);

1158 
row
 = (
šv”‹d
)?19 -„ow :„ow-1;

1159 
cŞ
 = 
c
 - 'A';

1160 ià(
cŞ
 > 7 && 
noi
) col -= 1;

1161 ià(
num
 == 3) {

1162 
mc
 = (
g
 == 'b') ? 1 : -1;

1163 ià(
mc
 =ğ
cŞÜ
) {

1164 
bßrd
[
row
*19 + 
cŞ
] = 1;

1166 
bßrd
[19*19 + 
row
*19 + 
cŞ
] = 1;

1169 } if(
c
 == 'c'){

1170 
g
;

1171 
num
 = 
	`ssÿnf
(
lše
, "%ø%ø%d", &
g
, &
c
, &
row
);

1172 
row
 = (
šv”‹d
)?19 -„ow :„ow-1;

1173 
cŞ
 = 
c
 - 'A';

1174 ià(
cŞ
 > 7 && 
noi
) col -= 1;

1175 ià(
num
 == 3) {

1176 
bßrd
[
row
*19 + 
cŞ
] = 0;

1177 
bßrd
[19*19 + 
row
*19 + 
cŞ
] = 0;

1181 
	`ä“
(
lše
);

1182 
	`æ_bßrd
(
bßrd
);

1183 
cŞÜ
 = -color;

1185 
	}
}

1187 
	$scÜe_game
(*
bßrd
)

1189 
i
;

1190 
FILE
 *
f
 = 
	`fİ’
("game.txt", "w");

1191 
couÁ
 = 
	`´št_game
(
bßrd
, 
f
);

1192 
	`årštf
(
f
, "final_score\n");

1193 
	`fşo£
(
f
);

1194 
FILE
 *
p
 = 
	`pİ’
("./gnugo --mode gtp < game.txt", "r");

1195 
i
 = 0; i < 
couÁ
; ++i){

1196 
	`ä“
(
	`fg‘l
(
p
));

1197 
	`ä“
(
	`fg‘l
(
p
));

1199 *
l
 = 0;

1200 
scÜe
 = 0;

1201 
¶ay”
 = 0;

1202 (
l
 = 
	`fg‘l
(
p
))){

1203 
	`årštf
(
¡d”r
, "%  \t", 
l
);

1204 
n
 = 
	`ssÿnf
(
l
, "ğ%c+%f", &
¶ay”
, &
scÜe
);

1205 
	`ä“
(
l
);

1206 ià(
n
 == 2) ;

1208 if(
¶ay”
 =ğ'W'è
scÜe
 = -score;

1209 
	`pşo£
(
p
);

1210  
scÜe
;

1211 
	}
}

1213 
	$£lf_go
(*
f’ame
, *
weightfe
, *
f2
, *
w2
, 
muÉi
)

1215 
mùs_Œ“
 *
Œ“1
 = 0;

1216 
mùs_Œ“
 *
Œ“2
 = 0;

1217 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
f’ame
, 
weightfe
, 0);

1220 
ÃtwÜk
 *
Ãt2
;

1221 ià(
f2
) {

1222 
Ãt2
 = 
	`·r£_ÃtwÜk_cfg
(
f2
);

1223 if(
w2
){

1224 
	`lßd_weights
(
Ãt2
, 
w2
);

1227 
Ãt2
 = 
	`ÿÎoc
(1, (
ÃtwÜk
));

1228 *
Ãt2
 = *
Ãt
;

1230 
	`¤ªd
(
	`time
(0));

1231 
bßrds
[600][93];

1232 
couÁ
 = 0;

1235 *
bßrd
 = 
	`ÿÎoc
(19*19*3, ());

1236 
	`æ_bßrd
(
bßrd
);

1237 *
Úe
 = 
	`ÿÎoc
(19*19*3, ());

1238 *
two
 = 
	`ÿÎoc
(19*19*3, ());

1239 
dÚe
 = 0;

1240 
¶ay”
 = 1;

1241 
p1
 = 0;

1242 
p2
 = 0;

1243 
tÙ®
 = 0;

1244 
‹mp
 = .1;

1245 
mùs_™”s
 = 500;

1246 
ıuù
 = 5;

1248 ià(
dÚe
){

1249 
Œ“1
 = 
	`move_mùs
(tree1, -1);

1250 
Œ“2
 = 
	`move_mùs
(tree2, -1);

1251 
scÜe
 = 
	`scÜe_game
(
bßrd
);

1252 if((
scÜe
 > 0è=ğ(
tÙ®
%2==0)è++
p1
;

1253 ++
p2
;

1254 ++
tÙ®
;

1255 
	`årštf
(
¡d”r
, "TÙ®: %d, PÏy” 1: %f, PÏy” 2: %f\n", 
tÙ®
, ()
p1
/tÙ®, ()
p2
/total);

1256 
	`¦“p
(1);

1267 
	`mem£t
(
bßrd
, 0, 3*19*19*());

1268 
	`æ_bßrd
(
bßrd
);

1269 
¶ay”
 = 1;

1270 
dÚe
 = 0;

1271 
couÁ
 = 0;

1272 
	`fæush
(
¡dout
);

1273 
	`fæush
(
¡d”r
);

1278 ià((
tÙ®
%2==0è=ğ(
¶ay”
==1)){

1280 
ıuù
 = 5;

1283 
ıuù
 = 1;

1285 
ÃtwÜk
 *
u£
 = ((
tÙ®
%2==0è=ğ(
¶ay”
==1)è? 
Ãt
 : 
Ãt2
;

1286 
mùs_Œ“
 *
t
 = ((
tÙ®
%2==0è=ğ(
¶ay”
==1)è? 
Œ“1
 : 
Œ“2
;

1287 
t
 = 
	`run_mùs
Ñ, 
u£
, 
bßrd
, 
two
, 
¶ay”
, 
mùs_™”s
, 
ıuù
, 0);

1288 
move
 
m
 = 
	`pick_move
(
t
, 
‹mp
, 
¶ay”
);

1289 if(((
tÙ®
%2==0è=ğ(
¶ay”
==1))è
Œ“1
 = 
t
;

1290 
Œ“2
 = 
t
;

1292 
Œ“1
 = 
	`move_mùs
Ñ»e1, 
m
.
row
*19 + m.
cŞ
);

1293 
Œ“2
 = 
	`move_mùs
Ñ»e2, 
m
.
row
*19 + m.
cŞ
);

1295 if(
m
.
row
 == 19){

1296 
dÚe
 = 1;

1299 
row
 = 
m
.row;

1300 
cŞ
 = 
m
.col;

1302 *
sw­
 = 
two
;

1303 
two
 = 
Úe
;

1304 
Úe
 = 
sw­
;

1306 if(
¶ay”
 < 0è
	`æ_bßrd
(
bßrd
);

1307 
bßrds
[
couÁ
][0] = 
row
;

1308 
bßrds
[
couÁ
][1] = 
cŞ
;

1309 
	`bßrd_to_¡ršg
(
bßrds
[
couÁ
] + 2, 
bßrd
);

1310 if(
¶ay”
 < 0è
	`æ_bßrd
(
bßrd
);

1311 ++
couÁ
;

1313 
	`move_go
(
bßrd
, 
¶ay”
, 
row
, 
cŞ
);

1314 
	`cİy_ıu
(19*19*3, 
bßrd
, 1, 
Úe
, 1);

1316 
¶ay”
 = -player;

1318 
	}
}

1320 
	$run_go
(
¬gc
, **
¬gv
)

1323 if(
¬gc
 < 4){

1324 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

1328 *
gpu_li¡
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-gpus", 0);

1329 *
gpus
 = 0;

1330 
gpu
 = 0;

1331 
ngpus
 = 0;

1332 if(
gpu_li¡
){

1333 
	`´štf
("%s\n", 
gpu_li¡
);

1334 
Ën
 = 
	`¡¾’
(
gpu_li¡
);

1335 
ngpus
 = 1;

1336 
i
;

1337 
i
 = 0; i < 
Ën
; ++i){

1338 ià(
gpu_li¡
[
i
] =ğ','è++
ngpus
;

1340 
gpus
 = 
	`ÿÎoc
(
ngpus
, ());

1341 
i
 = 0; i < 
ngpus
; ++i){

1342 
gpus
[
i
] = 
	`©oi
(
gpu_li¡
);

1343 
gpu_li¡
 = 
	`¡rchr
(gpu_list, ',')+1;

1346 
gpu
 = 
gpu_šdex
;

1347 
gpus
 = &
gpu
;

1348 
ngpus
 = 1;

1350 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

1352 *
cfg
 = 
¬gv
[3];

1353 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

1354 *
c2
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

1355 *
w2
 = (
¬gc
 > 6è? 
¬gv
[6] : 0;

1356 
muÉi
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-multi");

1357 
ªÚ
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-anon");

1358 
™”s
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-iters", 500);

1359 
»sign
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-resign", 175);

1360 
ıuù
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-cpuct", 5);

1361 
‹mp
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-temp", .1);

1362 
time
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-time", 0);

1363 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_go
(
cfg
, 
weights
, 
c2
, 
gpus
, 
ngpus
, 
ş—r
);

1364 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id_go
(
cfg
, 
weights
, 
muÉi
, 
c2
);

1365 if(0==
	`¡rcmp
(
¬gv
[2], "£lf")è
	`£lf_go
(
cfg
, 
weights
, 
c2
, 
w2
, 
muÉi
);

1366 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_go
(
cfg
, 
weights
, 
muÉi
);

1367 if(0==
	`¡rcmp
(
¬gv
[2], "’gše")è
	`’gše_go
(
cfg
, 
weights
, 
™”s
, 
time
, 
‹mp
, 
ıuù
, 
ªÚ
, 
»sign
);

1368 
	}
}

	@host/examples/instance-segmenter.c

1 
	~"d¬kÃt.h
"

2 
	~<sys/time.h
>

3 
	~<as£¹.h
>

5 
nÜm®ize_image2
(
image
 
p
);

6 
	$Œaš_i£gm’‹r
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
gpus
, 
ngpus
, 
ş—r
, 
di¥Ïy
)

8 
i
;

10 
avg_loss
 = -1;

11 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

12 
	`´štf
("%s\n", 
ba£
);

13 
	`´štf
("%d\n", 
ngpus
);

14 
ÃtwÜk
 **
Ãts
 = 
	`ÿÎoc
(
ngpus
, (network*));

16 
	`¤ªd
(
	`time
(0));

17 
£ed
 = 
	`¿nd
();

18 
i
 = 0; i < 
ngpus
; ++i){

19 
	`¤ªd
(
£ed
);

20 #ifdeà
GPU


21 
	`cuda_£t_deviû
(
gpus
[
i
]);

23 
Ãts
[
i
] = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

24 
Ãts
[
i
]->
Ë¬nšg_¿‹
 *ğ
ngpus
;

26 
	`¤ªd
(
	`time
(0));

27 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

28 
image
 
´ed
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

30 
image
 
embed
 = 
´ed
;

31 
embed
.
c
 = 3;

32 
embed
.
d©a
 +ğembed.
w
*embed.
h
*80;

34 
div
 = 
Ãt
->
w
/
´ed
.w;

35 
	`as£¹
(
´ed
.
w
 * 
div
 =ğ
Ãt
->w);

36 
	`as£¹
(
´ed
.
h
 * 
div
 =ğ
Ãt
->h);

38 
imgs
 = 
Ãt
->
b©ch
 *‚‘->
subdivisiÚs
 * 
ngpus
;

40 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

41 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

43 *
backup_dœeùÜy
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "backup", "/backup/");

44 *
Œaš_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "train", "data/train.list");

46 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_li¡
);

47 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

48 
	`´štf
("%d\n", 
¶i¡
->
size
);

49 
N
 = 
¶i¡
->
size
;

51 
lßd_¬gs
 
¬gs
 = {0};

52 
¬gs
.
w
 = 
Ãt
->w;

53 
¬gs
.
h
 = 
Ãt
->h;

54 
¬gs
.
th»ads
 = 32;

55 
¬gs
.
sÿË
 = 
div
;

56 
¬gs
.
num_boxes
 = 90;

58 
¬gs
.
mš
 = 
Ãt
->
mš_üİ
;

59 
¬gs
.
max
 = 
Ãt
->
max_üİ
;

60 
¬gs
.
ªgË
 = 
Ãt
->angle;

61 
¬gs
.
a¥eù
 = 
Ãt
->aspect;

62 
¬gs
.
exposu»
 = 
Ãt
->exposure;

63 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

64 
¬gs
.
hue
 = 
Ãt
->hue;

65 
¬gs
.
size
 = 
Ãt
->
w
;

66 
¬gs
.
şas£s
 = 80;

68 
¬gs
.
·ths
 =…aths;

69 
¬gs
.
n
 = 
imgs
;

70 
¬gs
.
m
 = 
N
;

71 
¬gs
.
ty³
 = 
ISEG_DATA
;

73 
d©a
 
Œaš
;

74 
d©a
 
bufãr
;

75 
±h»ad_t
 
lßd_th»ad
;

76 
¬gs
.
d
 = &
bufãr
;

77 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

79 
•och
 = (*
Ãt
->
£’
)/
N
;

80 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

81 
time
 = 
	`wh©_time_is_™_now
();

83 
	`±h»ad_još
(
lßd_th»ad
, 0);

84 
Œaš
 = 
bufãr
;

85 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

87 
	`´štf
("Lßded: %là£cÚds\n", 
	`wh©_time_is_™_now
()-
time
);

88 
time
 = 
	`wh©_time_is_™_now
();

90 
loss
 = 0;

91 #ifdeà
GPU


92 if(
ngpus
 == 1){

93 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

95 
loss
 = 
	`Œaš_ÃtwÜks
(
Ãts
, 
ngpus
, 
Œaš
, 4);

98 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

100 if(
di¥Ïy
){

101 
image
 
Œ
 = 
	`æßt_to_image
(
Ãt
->
w
/
div
,‚‘->
h
/div, 80, 
Œaš
.
y
.
v®s
[Ãt->
b©ch
*Ò‘->
subdivisiÚs
-1)]);

102 
image
 
im
 = 
	`æßt_to_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
, 
Œaš
.
X
.
v®s
[Ãt->
b©ch
*Ò‘->
subdivisiÚs
-1)]);

103 
´ed
.
c
 = 80;

104 
image
 
mask
 = 
	`mask_to_rgb
(
Œ
);

105 
image
 
´mask
 = 
	`mask_to_rgb
(
´ed
);

106 
image
 
ecİy
 = 
	`cİy_image
(
embed
);

107 
	`nÜm®ize_image2
(
ecİy
);

108 
	`show_image
(
ecİy
, "embed", 1);

109 
	`ä“_image
(
ecİy
);

111 
	`show_image
(
im
, "input", 1);

112 
	`show_image
(
´mask
, "pred", 1);

113 
	`show_image
(
mask
, "truth", 100);

114 
	`ä“_image
(
mask
);

115 
	`ä“_image
(
´mask
);

117 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

118 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

119 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`wh©_time_is_™_now
()-
time
, *net->seen);

120 
	`ä“_d©a
(
Œaš
);

121 if(*
Ãt
->
£’
/
N
 > 
•och
){

122 
•och
 = *
Ãt
->
£’
/
N
;

123 
buff
[256];

124 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

125 
	`§ve_weights
(
Ãt
, 
buff
);

127 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%100 == 0){

128 
buff
[256];

129 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

130 
	`§ve_weights
(
Ãt
, 
buff
);

133 
buff
[256];

134 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

135 
	`§ve_weights
(
Ãt
, 
buff
);

137 
	`ä“_ÃtwÜk
(
Ãt
);

138 
	`ä“_±rs
((**)
·ths
, 
¶i¡
->
size
);

139 
	`ä“_li¡
(
¶i¡
);

140 
	`ä“
(
ba£
);

141 
	}
}

143 
	$´ediù_i£gm’‹r
(*
d©afe
, *
cfg
, *
weights
, *
f’ame
)

145 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

146 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

147 
	`¤ªd
(2222222);

149 
şock_t
 
time
;

150 
buff
[256];

151 *
šput
 = 
buff
;

153 if(
f’ame
){

154 
	`¡ºıy
(
šput
, 
f’ame
, 256);

156 
	`´štf
("Enter Image Path: ");

157 
	`fæush
(
¡dout
);

158 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

159 if(!
šput
) ;

160 
	`¡¹ok
(
šput
, "\n");

162 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

163 
image
 
sized
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

165 *
X
 = 
sized
.
d©a
;

166 
time
=
	`şock
();

167 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

168 
image
 
´ed
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

169 
image
 
´mask
 = 
	`mask_to_rgb
(
´ed
);

170 
	`´štf
("P»diùed: %f\n", 
´ediùiÚs
[0]);

171 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

172 
	`show_image
(
sized
, "orig", 1);

173 
	`show_image
(
´mask
, "pred", 0);

174 
	`ä“_image
(
im
);

175 
	`ä“_image
(
sized
);

176 
	`ä“_image
(
´mask
);

177 ià(
f’ame
) ;

179 
	}
}

182 
	$demo_i£gm’‹r
(*
d©acfg
, *
cfg
, *
weights
, 
ÿm_šdex
, cÚ¡ *
f’ame
)

184 #ifdeà
OPENCV


185 
	`´štf
("Classifier Demo\n");

186 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

187 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

189 
	`¤ªd
(2222222);

190 * 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 
ÿm_šdex
, 0,0,0);

192 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

193 
ås
 = 0;

196 
timev®
 
tv®_befÜe
, 
tv®_aá”
, 
tv®_»suÉ
;

197 
	`g‘timeofday
(&
tv®_befÜe
, 
NULL
);

199 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

200 
image
 
š_s
 = 
	`Ë‰”box_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

202 
	`ÃtwÜk_´ediù
(
Ãt
, 
š_s
.
d©a
);

204 
	`´štf
("\033[2J");

205 
	`´štf
("\033[1;1H");

206 
	`´štf
("\nFPS:%.0f\n",
ås
);

208 
image
 
´ed
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

209 
image
 
´mask
 = 
	`mask_to_rgb
(
´ed
);

210 
	`show_image
(
´mask
, "Segmenter", 10);

212 
	`ä“_image
(
š_s
);

213 
	`ä“_image
(
š
);

214 
	`ä“_image
(
´mask
);

216 
	`g‘timeofday
(&
tv®_aá”
, 
NULL
);

217 
	`tim”sub
(&
tv®_aá”
, &
tv®_befÜe
, &
tv®_»suÉ
);

218 
cu¼
 = 1000000.f/(()
tv®_»suÉ
.
tv_u£c
);

219 
ås
 = .9*å + .1*
cu¼
;

222 
	}
}

225 
	$run_i£gm’‹r
(
¬gc
, **
¬gv
)

227 if(
¬gc
 < 4){

228 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

232 *
gpu_li¡
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-gpus", 0);

233 *
gpus
 = 0;

234 
gpu
 = 0;

235 
ngpus
 = 0;

236 if(
gpu_li¡
){

237 
	`´štf
("%s\n", 
gpu_li¡
);

238 
Ën
 = 
	`¡¾’
(
gpu_li¡
);

239 
ngpus
 = 1;

240 
i
;

241 
i
 = 0; i < 
Ën
; ++i){

242 ià(
gpu_li¡
[
i
] =ğ','è++
ngpus
;

244 
gpus
 = 
	`ÿÎoc
(
ngpus
, ());

245 
i
 = 0; i < 
ngpus
; ++i){

246 
gpus
[
i
] = 
	`©oi
(
gpu_li¡
);

247 
gpu_li¡
 = 
	`¡rchr
(gpu_list, ',')+1;

250 
gpu
 = 
gpu_šdex
;

251 
gpus
 = &
gpu
;

252 
ngpus
 = 1;

255 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

256 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

257 
di¥Ïy
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-display");

258 *
d©a
 = 
¬gv
[3];

259 *
cfg
 = 
¬gv
[4];

260 *
weights
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

261 *
f’ame
 = (
¬gc
 > 6è? 
¬gv
[6]: 0;

262 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`´ediù_i£gm’‹r
(
d©a
, 
cfg
, 
weights
, 
f’ame
);

263 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_i£gm’‹r
(
d©a
, 
cfg
, 
weights
, 
gpus
, 
ngpus
, 
ş—r
, 
di¥Ïy
);

264 if(0==
	`¡rcmp
(
¬gv
[2], "demo")è
	`demo_i£gm’‹r
(
d©a
, 
cfg
, 
weights
, 
ÿm_šdex
, 
f’ame
);

265 
	}
}

	@host/examples/lsd.c

1 
	~<m©h.h
>

2 
	~"d¬kÃt.h
"

387 
	$¦”p
(*
¡¬t
, *
’d
, 
s
, 
n
, *
out
)

389 
omega
 = 
	`acos
(
	`dÙ_ıu
(
n
, 
¡¬t
, 1, 
’d
, 1));

390 
so
 = 
	`sš
(
omega
);

391 
	`fl_ıu
(
n
, 0, 
out
, 1);

392 
	`axpy_ıu
(
n
, 
	`sš
((1-
s
)*
omega
)/
so
, 
¡¬t
, 1, 
out
, 1);

393 
	`axpy_ıu
(
n
, 
	`sš
(
s
*
omega
)/
so
, 
’d
, 1, 
out
, 1);

395 
mag
 = 
	`mag_¬¿y
(
out
, 
n
);

396 
	`sÿË_¬¿y
(
out
, 
n
, 1./
mag
);

397 
	}
}

399 
image
 
	$¿ndom_un™_veùÜ_image
(
w
, 
h
, 
c
)

401 
image
 
im
 = 
	`make_image
(
w
, 
h
, 
c
);

402 
i
;

403 
i
 = 0; i < 
im
.
w
*im.
h
*im.
c
; ++i){

404 
im
.
d©a
[
i
] = 
	`¿nd_nÜm®
();

406 
mag
 = 
	`mag_¬¿y
(
im
.
d©a
, im.
w
*im.
h
*im.
c
);

407 
	`sÿË_¬¿y
(
im
.
d©a
, im.
w
*im.
h
*im.
c
, 1./
mag
);

408  
im
;

409 
	}
}

411 
	$š‹r_dcgª
(*
cfgfe
, *
weightfe
)

413 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

414 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

415 
	`¤ªd
(2222222);

417 
şock_t
 
time
;

418 
buff
[256];

419 *
šput
 = 
buff
;

420 
i
, 
imÏy”
 = 0;

422 
i
 = 0; i < 
Ãt
->
n
; ++i) {

423 ià(
Ãt
->
Ïy”s
[
i
].
out_c
 == 3) {

424 
imÏy”
 = 
i
;

425 
	`´štf
("%d\n", 
i
);

429 
image
 
¡¬t
 = 
	`¿ndom_un™_veùÜ_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
);

430 
image
 
’d
 = 
	`¿ndom_un™_veùÜ_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
);

431 
image
 
im
 = 
	`make_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
);

432 
image
 
Üig
 = 
	`cİy_image
(
¡¬t
);

434 
c
 = 0;

435 
couÁ
 = 0;

436 
max_couÁ
 = 15;

438 ++
c
;

440 if(
couÁ
 =ğ
max_couÁ
){

441 
couÁ
 = 0;

442 
	`ä“_image
(
¡¬t
);

443 
¡¬t
 = 
’d
;

444 
’d
 = 
	`¿ndom_un™_veùÜ_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
);

445 if(
c
 > 300){

446 
’d
 = 
Üig
;

448 if(
c
>300 + 
max_couÁ
) ;

450 ++
couÁ
;

452 
	`¦”p
(
¡¬t
.
d©a
, 
’d
.d©a, ()
couÁ
 / 
max_couÁ
, 
im
.
w
*im.
h
*im.
c
, im.data);

454 *
X
 = 
im
.
d©a
;

455 
time
=
	`şock
();

456 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

457 
image
 
out
 = 
	`g‘_ÃtwÜk_image_Ïy”
(
Ãt
, 
imÏy”
);

459 
	`nÜm®ize_image
(
out
);

460 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

462 
	`¥rštf
(
buff
, "out%05d", 
c
);

463 
	`§ve_image
(
out
, "out");

464 
	`§ve_image
(
out
, 
buff
);

465 
	`show_image
(
out
, "out", 0);

467 
	}
}

469 
	$‹¡_dcgª
(*
cfgfe
, *
weightfe
)

471 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

472 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

473 
	`¤ªd
(2222222);

475 
şock_t
 
time
;

476 
buff
[256];

477 *
šput
 = 
buff
;

478 
imÏy”
 = 0;

480 
imÏy”
 = 
Ãt
->
n
-1;

483 
image
 
im
 = 
	`make_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
);

484 
i
;

485 
i
 = 0; i < 
im
.
w
*im.
h
*im.
c
; ++i){

486 
im
.
d©a
[
i
] = 
	`¿nd_nÜm®
();

491 *
X
 = 
im
.
d©a
;

492 
time
=
	`şock
();

493 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

494 
image
 
out
 = 
	`g‘_ÃtwÜk_image_Ïy”
(
Ãt
, 
imÏy”
);

496 
	`nÜm®ize_image
(
out
);

497 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

498 
	`§ve_image
(
out
, "out");

499 
	`show_image
(
out
, "out", 0);

501 
	`ä“_image
(
im
);

503 
	}
}

505 
	$£t_ÃtwÜk_®pha_b‘a
(
ÃtwÜk
 *
Ãt
, 
®pha
, 
b‘a
)

507 
i
;

508 
i
 = 0; i < 
Ãt
->
n
; ++i){

509 if(
Ãt
->
Ïy”s
[
i
].
ty³
 =ğ
SHORTCUT
){

510 
Ãt
->
Ïy”s
[
i
].
®pha
 =‡lpha;

511 
Ãt
->
Ïy”s
[
i
].
b‘a
 = beta;

514 
	}
}

516 
	$Œaš_´og
(*
cfg
, *
weight
, *
acfg
, *
aweight
, 
ş—r
, 
di¥Ïy
, *
Œaš_images
, 
maxb©ch
)

518 #ifdeà
GPU


519 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

520 
	`¤ªd
(
	`time
(0));

521 *
ba£
 = 
	`ba£cfg
(
cfg
);

522 *
aba£
 = 
	`ba£cfg
(
acfg
);

523 
	`´štf
("%s\n", 
ba£
);

524 
ÃtwÜk
 *
gÃt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weight
, 
ş—r
);

525 
ÃtwÜk
 *
ª‘
 = 
	`lßd_ÃtwÜk
(
acfg
, 
aweight
, 
ş—r
);

527 
i
, 
j
, 
k
;

528 
Ïy”
 
imÏy”
 = 
gÃt
->
Ïy”s
[gÃt->
n
-1];

530 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
gÃt
->
Ë¬nšg_¿‹
, gÃt->
mom’tum
, gÃt->
deÿy
);

531 
imgs
 = 
gÃt
->
b©ch
*gÃt->
subdivisiÚs
;

532 
i
 = *
gÃt
->
£’
/
imgs
;

533 
d©a
 
Œaš
, 
bufãr
;

536 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

537 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

539 
lßd_¬gs
 
¬gs
ğ
	`g‘_ba£_¬gs
(
ª‘
);

540 
¬gs
.
·ths
 =…aths;

541 
¬gs
.
n
 = 
imgs
;

542 
¬gs
.
m
 = 
¶i¡
->
size
;

543 
¬gs
.
d
 = &
bufãr
;

544 
¬gs
.
ty³
 = 
CLASSIFICATION_DATA
;

545 
¬gs
.
th»ads
=16;

546 
¬gs
.
şas£s
 = 1;

547 *
ls
[2] = {"imagenet", "zzzzzzzz"};

548 
¬gs
.
Ïb–s
 = 
ls
;

550 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

551 
şock_t
 
time
;

553 
gÃt
->
Œaš
 = 1;

554 
ª‘
->
Œaš
 = 1;

556 
x_size
 = 
gÃt
->
šputs
*gÃt->
b©ch
;

557 
y_size
 = 
gÃt
->
Œuths
*gÃt->
b©ch
;

558 *
im”rÜ
 = 
	`cuda_make_¬¿y
(0, 
y_size
);

560 
®oss_avg
 = -1;

562 ià(
maxb©ch
 =ğ0èmaxb©ch = 
gÃt
->
max_b©ches
;

563 
	`g‘_cu¼’t_b©ch
(
gÃt
è< 
maxb©ch
) {

565 
cb
 = 
	`g‘_cu¼’t_b©ch
(
gÃt
);

566 
®pha
 = (è
cb
 / (
maxb©ch
/2);

567 if(
®pha
 > 1)‡lpha = 1;

568 
b‘a
 = 1 - 
®pha
;

569 
	`´štf
("%à%f\n", 
®pha
, 
b‘a
);

570 
	`£t_ÃtwÜk_®pha_b‘a
(
gÃt
, 
®pha
, 
b‘a
);

571 
	`£t_ÃtwÜk_®pha_b‘a
(
ª‘
, 
b‘a
, 
®pha
);

574 
i
 += 1;

575 
time
=
	`şock
();

576 
	`±h»ad_još
(
lßd_th»ad
, 0);

577 
Œaš
 = 
bufãr
;

579 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

581 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

583 
d©a
 
g’
 = 
	`cİy_d©a
(
Œaš
);

584 
j
 = 0; j < 
imgs
; ++j) {

585 
Œaš
.
y
.
v®s
[
j
][0] = 1;

586 
g’
.
y
.
v®s
[
j
][0] = 0;

588 
time
=
	`şock
();

590 
j
 = 0; j < 
gÃt
->
subdivisiÚs
; ++j) {

591 
	`g‘_Ãxt_b©ch
(
Œaš
, 
gÃt
->
b©ch
, 
j
*gÃt->b©ch, gÃt->
Œuth
, 0);

592 
z
;

593 
z
 = 0; z < 
x_size
; ++z){

594 
gÃt
->
šput
[
z
] = 
	`¿nd_nÜm®
();

602 *
gÃt
->
£’
 +ğgÃt->
b©ch
;

603 
	`fÜw¬d_ÃtwÜk
(
gÃt
);

605 
	`fl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 0, 
im”rÜ
, 1);

606 
	`fl_ıu
(
ª‘
->
Œuths
*ª‘->
b©ch
, 1,‡Ãt->
Œuth
, 1);

607 
	`cİy_ıu
(
ª‘
->
šputs
*ª‘->
b©ch
, 
imÏy”
.
ouut
, 1,‡Ãt->
šput
, 1);

608 
ª‘
->
d–_gpu
 = 
im”rÜ
;

609 
	`fÜw¬d_ÃtwÜk
(
ª‘
);

610 
	`backw¬d_ÃtwÜk
(
ª‘
);

614 
	`sÿl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1, 
im”rÜ
, 1);

615 
	`sÿl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 0, 
gÃt
->
Ïy”s
[gÃt->
n
-1].
d–_gpu
, 1);

617 
	`axpy_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1, 
im”rÜ
, 1, 
gÃt
->
Ïy”s
[gÃt->
n
-1].
d–_gpu
, 1);

619 
	`backw¬d_ÃtwÜk
(
gÃt
);

621 
k
 = 0; k < 
gÃt
->
b©ch
; ++k){

622 
šdex
 = 
j
*
gÃt
->
b©ch
 + 
k
;

623 
	`cİy_ıu
(
gÃt
->
ouuts
, gÃt->
ouut
 + 
k
*gÃt->ouuts, 1, 
g’
.
X
.
v®s
[
šdex
], 1);

626 
	`h¬mËss_upd©e_ÃtwÜk_gpu
(
ª‘
);

628 
d©a
 
m”ge
 = 
	`cÚÿt_d©a
(
Œaš
, 
g’
);

629 
®oss
 = 
	`Œaš_ÃtwÜk
(
ª‘
, 
m”ge
);

631 #ifdeà
OPENCV


632 if(
di¥Ïy
){

633 
image
 
im
 = 
	`æßt_to_image
(
ª‘
->
w
,‡Ãt->
h
,‡Ãt->
c
, 
g’
.
X
.
v®s
[0]);

634 
image
 
im2
 = 
	`æßt_to_image
(
ª‘
->
w
,‡Ãt->
h
,‡Ãt->
c
, 
Œaš
.
X
.
v®s
[0]);

635 
	`show_image
(
im
, "gen", 1);

636 
	`show_image
(
im2
, "train", 1);

637 
	`§ve_image
(
im
, "gen");

638 
	`§ve_image
(
im2
, "train");

642 
	`upd©e_ÃtwÜk_gpu
(
gÃt
);

644 
	`ä“_d©a
(
m”ge
);

645 
	`ä“_d©a
(
Œaš
);

646 
	`ä“_d©a
(
g’
);

647 ià(
®oss_avg
 < 0è®oss_avg = 
®oss
;

648 
®oss_avg
 =‡loss_avg*.9 + 
®oss
*.1;

650 
	`´štf
("%d:‡dv: %à|‡dv_avg: %f, %à¿‹, %là£cÚds, %d images\n", 
i
, 
®oss
, 
®oss_avg
, 
	`g‘_cu¼’t_¿‹
(
gÃt
), 
	`£c
(
	`şock
()-
time
), i*
imgs
);

651 if(
i
%10000==0){

652 
buff
[256];

653 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

654 
	`§ve_weights
(
gÃt
, 
buff
);

655 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
aba£
, 
i
);

656 
	`§ve_weights
(
ª‘
, 
buff
);

658 if(
i
%1000==0){

659 
buff
[256];

660 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

661 
	`§ve_weights
(
gÃt
, 
buff
);

662 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
aba£
);

663 
	`§ve_weights
(
ª‘
, 
buff
);

666 
buff
[256];

667 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

668 
	`§ve_weights
(
gÃt
, 
buff
);

670 
	}
}

672 
	$Œaš_dcgª
(*
cfg
, *
weight
, *
acfg
, *
aweight
, 
ş—r
, 
di¥Ïy
, *
Œaš_images
, 
maxb©ch
)

674 #ifdeà
GPU


675 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

676 
	`¤ªd
(
	`time
(0));

677 *
ba£
 = 
	`ba£cfg
(
cfg
);

678 *
aba£
 = 
	`ba£cfg
(
acfg
);

679 
	`´štf
("%s\n", 
ba£
);

680 
ÃtwÜk
 *
gÃt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weight
, 
ş—r
);

681 
ÃtwÜk
 *
ª‘
 = 
	`lßd_ÃtwÜk
(
acfg
, 
aweight
, 
ş—r
);

684 
i
, 
j
, 
k
;

685 
Ïy”
 
imÏy”
 = {0};

686 
i
 = 0; i < 
gÃt
->
n
; ++i) {

687 ià(
gÃt
->
Ïy”s
[
i
].
out_c
 == 3) {

688 
imÏy”
 = 
gÃt
->
Ïy”s
[
i
];

693 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
gÃt
->
Ë¬nšg_¿‹
, gÃt->
mom’tum
, gÃt->
deÿy
);

694 
imgs
 = 
gÃt
->
b©ch
*gÃt->
subdivisiÚs
;

695 
i
 = *
gÃt
->
£’
/
imgs
;

696 
d©a
 
Œaš
, 
bufãr
;

699 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

701 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

703 
lßd_¬gs
 
¬gs
ğ
	`g‘_ba£_¬gs
(
ª‘
);

704 
¬gs
.
·ths
 =…aths;

705 
¬gs
.
n
 = 
imgs
;

706 
¬gs
.
m
 = 
¶i¡
->
size
;

707 
¬gs
.
d
 = &
bufãr
;

708 
¬gs
.
ty³
 = 
CLASSIFICATION_DATA
;

709 
¬gs
.
th»ads
=16;

710 
¬gs
.
şas£s
 = 1;

711 *
ls
[2] = {"imagenet", "zzzzzzzz"};

712 
¬gs
.
Ïb–s
 = 
ls
;

714 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

715 
şock_t
 
time
;

717 
gÃt
->
Œaš
 = 1;

718 
ª‘
->
Œaš
 = 1;

720 
x_size
 = 
gÃt
->
šputs
*gÃt->
b©ch
;

721 
y_size
 = 
gÃt
->
Œuths
*gÃt->
b©ch
;

722 *
im”rÜ
 = 
	`cuda_make_¬¿y
(0, 
y_size
);

726 
®oss_avg
 = -1;

730 ià(
maxb©ch
 =ğ0èmaxb©ch = 
gÃt
->
max_b©ches
;

731 
	`g‘_cu¼’t_b©ch
(
gÃt
è< 
maxb©ch
) {

732 
i
 += 1;

733 
time
=
	`şock
();

734 
	`±h»ad_još
(
lßd_th»ad
, 0);

735 
Œaš
 = 
bufãr
;

740 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

742 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

744 
d©a
 
g’
 = 
	`cİy_d©a
(
Œaš
);

745 
j
 = 0; j < 
imgs
; ++j) {

746 
Œaš
.
y
.
v®s
[
j
][0] = 1;

747 
g’
.
y
.
v®s
[
j
][0] = 0;

749 
time
=
	`şock
();

751 
j
 = 0; j < 
gÃt
->
subdivisiÚs
; ++j){

752 
	`g‘_Ãxt_b©ch
(
Œaš
, 
gÃt
->
b©ch
, 
j
*gÃt->b©ch, gÃt->
Œuth
, 0);

753 
z
;

754 
z
 = 0; z < 
x_size
; ++z){

755 
gÃt
->
šput
[
z
] = 
	`¿nd_nÜm®
();

757 
z
 = 0; z < 
gÃt
->
b©ch
; ++z){

758 
mag
 = 
	`mag_¬¿y
(
gÃt
->
šput
 + 
z
*gÃt->
šputs
, gnet->inputs);

759 
	`sÿË_¬¿y
(
gÃt
->
šput
 + 
z
*gÃt->
šputs
, gÃt->šputs, 1./
mag
);

771 *
gÃt
->
£’
 +ğgÃt->
b©ch
;

772 
	`fÜw¬d_ÃtwÜk
(
gÃt
);

774 
	`fl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 0, 
im”rÜ
, 1);

775 
	`fl_ıu
(
ª‘
->
Œuths
*ª‘->
b©ch
, 1,‡Ãt->
Œuth
, 1);

776 
	`cİy_ıu
(
ª‘
->
šputs
*ª‘->
b©ch
, 
imÏy”
.
ouut
, 1,‡Ãt->
šput
, 1);

777 
ª‘
->
d–_gpu
 = 
im”rÜ
;

778 
	`fÜw¬d_ÃtwÜk
(
ª‘
);

779 
	`backw¬d_ÃtwÜk
(
ª‘
);

784 
	`sÿl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1, 
im”rÜ
, 1);

785 
	`sÿl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 0, 
gÃt
->
Ïy”s
[gÃt->
n
-1].
d–_gpu
, 1);

790 
	`axpy_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1, 
im”rÜ
, 1, 
gÃt
->
Ïy”s
[gÃt->
n
-1].
d–_gpu
, 1);

792 
	`backw¬d_ÃtwÜk
(
gÃt
);

802 
k
 = 0; k < 
gÃt
->
b©ch
; ++k){

803 
šdex
 = 
j
*
gÃt
->
b©ch
 + 
k
;

804 
	`cİy_ıu
(
gÃt
->
ouuts
, gÃt->
ouut
 + 
k
*gÃt->ouuts, 1, 
g’
.
X
.
v®s
[
šdex
], 1);

807 
	`h¬mËss_upd©e_ÃtwÜk_gpu
(
ª‘
);

809 
d©a
 
m”ge
 = 
	`cÚÿt_d©a
(
Œaš
, 
g’
);

811 
®oss
 = 
	`Œaš_ÃtwÜk
(
ª‘
, 
m”ge
);

817 #ifdeà
OPENCV


818 if(
di¥Ïy
){

819 
image
 
im
 = 
	`æßt_to_image
(
ª‘
->
w
,‡Ãt->
h
,‡Ãt->
c
, 
g’
.
X
.
v®s
[0]);

820 
image
 
im2
 = 
	`æßt_to_image
(
ª‘
->
w
,‡Ãt->
h
,‡Ãt->
c
, 
Œaš
.
X
.
v®s
[0]);

821 
	`show_image
(
im
, "gen", 1);

822 
	`show_image
(
im2
, "train", 1);

823 
	`§ve_image
(
im
, "gen");

824 
	`§ve_image
(
im2
, "train");

836 
	`upd©e_ÃtwÜk_gpu
(
gÃt
);

838 
	`ä“_d©a
(
m”ge
);

839 
	`ä“_d©a
(
Œaš
);

840 
	`ä“_d©a
(
g’
);

841 ià(
®oss_avg
 < 0è®oss_avg = 
®oss
;

842 
®oss_avg
 =‡loss_avg*.9 + 
®oss
*.1;

844 
	`´štf
("%d:‡dv: %à|‡dv_avg: %f, %à¿‹, %là£cÚds, %d images\n", 
i
, 
®oss
, 
®oss_avg
, 
	`g‘_cu¼’t_¿‹
(
gÃt
), 
	`£c
(
	`şock
()-
time
), i*
imgs
);

845 if(
i
%10000==0){

846 
buff
[256];

847 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

848 
	`§ve_weights
(
gÃt
, 
buff
);

849 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
aba£
, 
i
);

850 
	`§ve_weights
(
ª‘
, 
buff
);

852 if(
i
%1000==0){

853 
buff
[256];

854 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

855 
	`§ve_weights
(
gÃt
, 
buff
);

856 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
aba£
);

857 
	`§ve_weights
(
ª‘
, 
buff
);

860 
buff
[256];

861 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

862 
	`§ve_weights
(
gÃt
, 
buff
);

864 
	}
}

866 
	$Œaš_cŞÜiz”
(*
cfg
, *
weight
, *
acfg
, *
aweight
, 
ş—r
, 
di¥Ïy
)

868 #ifdeà
GPU


871 *
Œaš_images
 = "/home/pjreddie/data/imagenet/imagenet1k.train.list";

872 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

873 
	`¤ªd
(
	`time
(0));

874 *
ba£
 = 
	`ba£cfg
(
cfg
);

875 *
aba£
 = 
	`ba£cfg
(
acfg
);

876 
	`´štf
("%s\n", 
ba£
);

877 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weight
, 
ş—r
);

878 
ÃtwÜk
 *
ª‘
 = 
	`lßd_ÃtwÜk
(
acfg
, 
aweight
, 
ş—r
);

880 
i
, 
j
, 
k
;

881 
Ïy”
 
imÏy”
 = {0};

882 
i
 = 0; i < 
Ãt
->
n
; ++i) {

883 ià(
Ãt
->
Ïy”s
[
i
].
out_c
 == 3) {

884 
imÏy”
 = 
Ãt
->
Ïy”s
[
i
];

889 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

890 
imgs
 = 
Ãt
->
b©ch
*Ãt->
subdivisiÚs
;

891 
i
 = *
Ãt
->
£’
/
imgs
;

892 
d©a
 
Œaš
, 
bufãr
;

895 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

897 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

899 
lßd_¬gs
 
¬gs
ğ
	`g‘_ba£_¬gs
(
Ãt
);

900 
¬gs
.
·ths
 =…aths;

901 
¬gs
.
n
 = 
imgs
;

902 
¬gs
.
m
 = 
¶i¡
->
size
;

903 
¬gs
.
d
 = &
bufãr
;

905 
¬gs
.
ty³
 = 
CLASSIFICATION_DATA
;

906 
¬gs
.
şas£s
 = 1;

907 *
ls
[2] = {"imagenet"};

908 
¬gs
.
Ïb–s
 = 
ls
;

910 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

911 
şock_t
 
time
;

913 
x_size
 = 
Ãt
->
šputs
*Ãt->
b©ch
;

915 
Ãt
->
d–
 = 0;

916 
Ãt
->
Œaš
 = 1;

917 *
pixs
 = 
	`ÿÎoc
(
x_size
, ());

918 *
g¿ypixs
 = 
	`ÿÎoc
(
x_size
, ());

922 
ª‘
->
d–
 = 0;

923 
ª‘
->
Œaš
 = 1;

925 *
im”rÜ
 = 
	`cuda_make_¬¿y
(0, 
imÏy”
.
ouuts
*imÏy”.
b©ch
);

927 
®oss_avg
 = -1;

928 
gloss_avg
 = -1;

932 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
) {

933 
i
 += 1;

934 
time
=
	`şock
();

935 
	`±h»ad_još
(
lßd_th»ad
, 0);

936 
Œaš
 = 
bufãr
;

937 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

939 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

941 
d©a
 
g¿y
 = 
	`cİy_d©a
(
Œaš
);

942 
j
 = 0; j < 
imgs
; ++j){

943 
image
 
gim
 = 
	`æßt_to_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
, 
g¿y
.
X
.
v®s
[
j
]);

944 
	`g¿ysÿË_image_3c
(
gim
);

945 
Œaš
.
y
.
v®s
[
j
][0] = .95;

946 
g¿y
.
y
.
v®s
[
j
][0] = .05;

948 
time
=
	`şock
();

949 
gloss
 = 0;

951 
j
 = 0; j < 
Ãt
->
subdivisiÚs
; ++j){

952 
	`g‘_Ãxt_b©ch
(
Œaš
, 
Ãt
->
b©ch
, 
j
*Ãt->b©ch, 
pixs
, 0);

953 
	`g‘_Ãxt_b©ch
(
g¿y
, 
Ãt
->
b©ch
, 
j
*Ãt->b©ch, 
g¿ypixs
, 0);

954 
	`cuda_push_¬¿y
(
Ãt
->
šput_gpu
, 
g¿ypixs
,‚‘->
šputs
*Ãt->
b©ch
);

955 
	`cuda_push_¬¿y
(
Ãt
->
Œuth_gpu
, 
pixs
,‚‘->
Œuths
*Ãt->
b©ch
);

963 *
Ãt
->
£’
 +ğÃt->
b©ch
;

964 
	`fÜw¬d_ÃtwÜk_gpu
(
Ãt
);

966 
	`fl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 0, 
im”rÜ
, 1);

967 
	`cİy_gpu
(
ª‘
->
šputs
*ª‘->
b©ch
, 
imÏy”
.
ouut_gpu
, 1,‡Ãt->
šput_gpu
, 1);

968 
	`fl_gpu
(
ª‘
->
šputs
*ª‘->
b©ch
, .95,‡Ãt->
Œuth_gpu
, 1);

969 
ª‘
->
d–_gpu
 = 
im”rÜ
;

970 
	`fÜw¬d_ÃtwÜk_gpu
(
ª‘
);

971 
	`backw¬d_ÃtwÜk_gpu
(
ª‘
);

973 
	`sÿl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1./100., 
Ãt
->
Ïy”s
[Ãt->
n
-1].
d–_gpu
, 1);

975 
	`sÿl_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1, 
im”rÜ
, 1);

977 
	`´štf
("»®Ãs %f\n", 
	`cuda_mag_¬¿y
(
im”rÜ
, 
imÏy”
.
ouuts
*imÏy”.
b©ch
));

978 
	`´štf
("ã©u» %f\n", 
	`cuda_mag_¬¿y
(
Ãt
->
Ïy”s
[Ãt->
n
-1].
d–_gpu
, 
imÏy”
.
ouuts
*imÏy”.
b©ch
));

980 
	`axpy_gpu
(
imÏy”
.
ouuts
*imÏy”.
b©ch
, 1, 
im”rÜ
, 1, 
Ãt
->
Ïy”s
[Ãt->
n
-1].
d–_gpu
, 1);

982 
	`backw¬d_ÃtwÜk_gpu
(
Ãt
);

985 
gloss
 +ğ*
Ãt
->
co¡
 /Ò‘->
subdivisiÚs
*Ãt->
b©ch
);

987 
k
 = 0; k < 
Ãt
->
b©ch
; ++k){

988 
šdex
 = 
j
*
Ãt
->
b©ch
 + 
k
;

989 
	`cİy_ıu
(
imÏy”
.
ouuts
, imÏy”.
ouut
 + 
k
*imÏy”.ouuts, 1, 
g¿y
.
X
.
v®s
[
šdex
], 1);

992 
	`h¬mËss_upd©e_ÃtwÜk_gpu
(
ª‘
);

994 
d©a
 
m”ge
 = 
	`cÚÿt_d©a
(
Œaš
, 
g¿y
);

996 
®oss
 = 
	`Œaš_ÃtwÜk
(
ª‘
, 
m”ge
);

998 
	`upd©e_ÃtwÜk_gpu
(
Ãt
);

1000 #ifdeà
OPENCV


1001 if(
di¥Ïy
){

1002 
image
 
im
 = 
	`æßt_to_image
(
ª‘
->
w
,‡Ãt->
h
,‡Ãt->
c
, 
g¿y
.
X
.
v®s
[0]);

1003 
image
 
im2
 = 
	`æßt_to_image
(
ª‘
->
w
,‡Ãt->
h
,‡Ãt->
c
, 
Œaš
.
X
.
v®s
[0]);

1004 
	`show_image
(
im
, "gen", 1);

1005 
	`show_image
(
im2
, "train", 1);

1008 
	`ä“_d©a
(
m”ge
);

1009 
	`ä“_d©a
(
Œaš
);

1010 
	`ä“_d©a
(
g¿y
);

1011 ià(
®oss_avg
 < 0è®oss_avg = 
®oss
;

1012 
®oss_avg
 =‡loss_avg*.9 + 
®oss
*.1;

1013 
gloss_avg
 = gloss_avg*.9 + 
gloss
*.1;

1015 
	`´štf
("%d: g’: %f,‡dv: %à| g’_avg: %f,‡dv_avg: %f, %à¿‹, %là£cÚds, %d images\n", 
i
, 
gloss
, 
®oss
, 
gloss_avg
, 
®oss_avg
, 
	`g‘_cu¼’t_¿‹
(
Ãt
), 
	`£c
(
	`şock
()-
time
), i*
imgs
);

1016 if(
i
%1000==0){

1017 
buff
[256];

1018 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

1019 
	`§ve_weights
(
Ãt
, 
buff
);

1020 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
aba£
, 
i
);

1021 
	`§ve_weights
(
ª‘
, 
buff
);

1023 if(
i
%100==0){

1024 
buff
[256];

1025 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

1026 
	`§ve_weights
(
Ãt
, 
buff
);

1027 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
aba£
);

1028 
	`§ve_weights
(
ª‘
, 
buff
);

1031 
buff
[256];

1032 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

1033 
	`§ve_weights
(
Ãt
, 
buff
);

1035 
	}
}

1294 
	$‹¡_lsd
(*
cfg
, *
weights
, *
f’ame
, 
g¿y
)

1296 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

1297 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

1298 
	`¤ªd
(2222222);

1300 
şock_t
 
time
;

1301 
buff
[256];

1302 *
šput
 = 
buff
;

1303 
i
, 
imÏy”
 = 0;

1305 
i
 = 0; i < 
Ãt
->
n
; ++i) {

1306 ià(
Ãt
->
Ïy”s
[
i
].
out_c
 == 3) {

1307 
imÏy”
 = 
i
;

1308 
	`´štf
("%d\n", 
i
);

1314 if(
f’ame
){

1315 
	`¡ºıy
(
šput
, 
f’ame
, 256);

1317 
	`´štf
("Enter Image Path: ");

1318 
	`fæush
(
¡dout
);

1319 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

1320 if(!
šput
) ;

1321 
	`¡¹ok
(
šput
, "\n");

1323 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

1324 
image
 
»sized
 = 
	`»size_mš
(
im
, 
Ãt
->
w
);

1325 
image
 
üİ
 = 
	`üİ_image
(
»sized
, (»sized.
w
 - 
Ãt
->w)/2, (»sized.
h
 -‚et->h)/2,‚et->w,‚et->h);

1326 if(
g¿y
è
	`g¿ysÿË_image_3c
(
üİ
);

1328 *
X
 = 
üİ
.
d©a
;

1329 
time
=
	`şock
();

1330 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

1331 
image
 
out
 = 
	`g‘_ÃtwÜk_image_Ïy”
(
Ãt
, 
imÏy”
);

1333 
	`cÚ¡¿š_image
(
out
);

1334 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

1335 
	`§ve_image
(
out
, "out");

1336 
	`show_image
(
out
, "out", 1);

1337 
	`show_image
(
üİ
, "crop", 0);

1339 
	`ä“_image
(
im
);

1340 
	`ä“_image
(
»sized
);

1341 
	`ä“_image
(
üİ
);

1342 ià(
f’ame
) ;

1344 
	}
}

1347 
	$run_lsd
(
¬gc
, **
¬gv
)

1349 if(
¬gc
 < 4){

1350 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

1354 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

1355 
di¥Ïy
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-display");

1356 
b©ches
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-b", 0);

1357 *
fe
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-file", "/home/pjreddie/data/imagenet/imagenet1k.train.list");

1359 *
cfg
 = 
¬gv
[3];

1360 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

1361 *
f’ame
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

1362 *
acfg
 = 
¬gv
[5];

1363 *
aweights
 = (
¬gc
 > 6è? 
¬gv
[6] : 0;

1368 if(0==
	`¡rcmp
(
¬gv
[2], "Œašgª")è
	`Œaš_dcgª
(
cfg
, 
weights
, 
acfg
, 
aweights
, 
ş—r
, 
di¥Ïy
, 
fe
, 
b©ches
);

1369 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš´og")è
	`Œaš_´og
(
cfg
, 
weights
, 
acfg
, 
aweights
, 
ş—r
, 
di¥Ïy
, 
fe
, 
b©ches
);

1370 if(0==
	`¡rcmp
(
¬gv
[2], "ŒašcŞÜ")è
	`Œaš_cŞÜiz”
(
cfg
, 
weights
, 
acfg
, 
aweights
, 
ş—r
, 
di¥Ïy
);

1371 if(0==
	`¡rcmp
(
¬gv
[2], "gª")è
	`‹¡_dcgª
(
cfg
, 
weights
);

1372 if(0==
	`¡rcmp
(
¬gv
[2], "š‹r")è
	`š‹r_dcgª
(
cfg
, 
weights
);

1373 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_lsd
(
cfg
, 
weights
, 
f’ame
, 0);

1374 if(0==
	`¡rcmp
(
¬gv
[2], "cŞÜ")è
	`‹¡_lsd
(
cfg
, 
weights
, 
f’ame
, 1);

1378 
	}
}

	@host/examples/nightmare.c

1 
	~"d¬kÃt.h
"

3 
	~<m©h.h
>

7 
	$abs_m—n
(*
x
, 
n
)

9 
i
;

10 
sum
 = 0;

11 
i
 = 0; i < 
n
; ++i){

12 
sum
 +ğ
	`çbs
(
x
[
i
]);

14  
sum
/
n
;

15 
	}
}

17 
	$ÿlcuÏ‹_loss
(*
ouut
, *
d–
, 
n
, 
th»sh
)

19 
i
;

20 
m—n
 = 
	`m—n_¬¿y
(
ouut
, 
n
);

21 
v¬
 = 
	`v¬Ÿnû_¬¿y
(
ouut
, 
n
);

22 
i
 = 0; i < 
n
; ++i){

23 if(
d–
[
i
] > 
m—n
 + 
th»sh
*
	`sq¹
(
v¬
)èd–[i] = 
ouut
[i];

24 
d–
[
i
] = 0;

26 
	}
}

28 
	$İtimize_piùu»
(
ÃtwÜk
 *
Ãt
, 
image
 
Üig
, 
max_Ïy”
, 
sÿË
, 
¿‹
, 
th»sh
, 
nÜm
)

32 
Ãt
->
n
 = 
max_Ïy”
 + 1;

34 
dx
 = 
	`¿nd
()%16 - 8;

35 
dy
 = 
	`¿nd
()%16 - 8;

36 
æ
 = 
	`¿nd
()%2;

38 
image
 
üİ
 = 
	`üİ_image
(
Üig
, 
dx
, 
dy
, orig.
w
, orig.
h
);

39 
image
 
im
 = 
	`»size_image
(
üİ
, ()(
Üig
.
w
 * 
sÿË
), ()(Üig.
h
 * scale));

40 if(
æ
è
	`æ_image
(
im
);

42 
	`»size_ÃtwÜk
(
Ãt
, 
im
.
w
, im.
h
);

43 
Ïy”
 
Ï¡
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

46 
image
 
d–
 = 
	`make_image
(
im
.
w
, im.
h
, im.
c
);

48 #ifdeà
GPU


49 
Ãt
->
d–_gpu
 = 
	`cuda_make_¬¿y
(
d–
.
d©a
, 
im
.
w
*im.
h
*im.
c
);

50 
	`cİy_ıu
(
Ãt
->
šputs
, 
im
.
d©a
, 1,‚‘->
šput
, 1);

52 
	`fÜw¬d_ÃtwÜk_gpu
(
Ãt
);

53 
	`cİy_gpu
(
Ï¡
.
ouuts
,†a¡.
ouut_gpu
, 1,†a¡.
d–_gpu
, 1);

55 
	`cuda_puÎ_¬¿y
(
Ï¡
.
d–_gpu
,†a¡.
d–
,†a¡.
ouuts
);

56 
	`ÿlcuÏ‹_loss
(
Ï¡
.
d–
,†a¡.d–,†a¡.
ouuts
, 
th»sh
);

57 
	`cuda_push_¬¿y
(
Ï¡
.
d–_gpu
,†a¡.
d–
,†a¡.
ouuts
);

59 
	`backw¬d_ÃtwÜk_gpu
(
Ãt
);

61 
	`cuda_puÎ_¬¿y
(
Ãt
->
d–_gpu
, 
d–
.
d©a
, 
im
.
w
*im.
h
*im.
c
);

62 
	`cuda_ä“
(
Ãt
->
d–_gpu
);

63 
Ãt
->
d–_gpu
 = 0;

65 
	`´štf
("\Â‘: %d %d %d im: %d %d %d\n", 
Ãt
->
w
,‚‘->
h
,‚‘->
šputs
, 
im
.w, im.h, im.
c
);

66 
	`cİy_ıu
(
Ãt
->
šputs
, 
im
.
d©a
, 1,‚‘->
šput
, 1);

67 
Ãt
->
d–
 = d–.
d©a
;

68 
	`fÜw¬d_ÃtwÜk
(
Ãt
);

69 
	`cİy_ıu
(
Ï¡
.
ouuts
,†a¡.
ouut
, 1,†a¡.
d–
, 1);

70 
	`ÿlcuÏ‹_loss
(
Ï¡
.
ouut
,†a¡.
d–
,†a¡.
ouuts
, 
th»sh
);

71 
	`backw¬d_ÃtwÜk
(
Ãt
);

74 if(
æ
è
	`æ_image
(
d–
);

76 
image
 
»sized
 = 
	`»size_image
(
d–
, 
Üig
.
w
, orig.
h
);

77 
image
 
out
 = 
	`üİ_image
(
»sized
, -
dx
, -
dy
, 
Üig
.
w
, orig.
h
);

86 
image
 
g¿y
 = 
	`make_image
(
out
.
w
, out.
h
, out.
c
);

87 
	`fl_image
(
g¿y
, .5);

88 
	`axpy_ıu
(
Üig
.
w
*Üig.
h
*Üig.
c
, -1, orig.
d©a
, 1, 
g¿y
.data, 1);

89 
	`axpy_ıu
(
Üig
.
w
*Üig.
h
*Üig.
c
, .1, 
g¿y
.
d©a
, 1, 
out
.data, 1);

91 if(
nÜm
è
	`nÜm®ize_¬¿y
(
out
.
d©a
, out.
w
*out.
h
*out.
c
);

92 
	`axpy_ıu
(
Üig
.
w
*Üig.
h
*Üig.
c
, 
¿‹
, 
out
.
d©a
, 1, orig.data, 1);

104 
	`cÚ¡¿š_image
(
Üig
);

106 
	`ä“_image
(
üİ
);

107 
	`ä“_image
(
im
);

108 
	`ä“_image
(
d–
);

109 
	`ä“_image
(
»sized
);

110 
	`ä“_image
(
out
);

112 
	}
}

114 
	$smoÙh
(
image
 
»cÚ
, imag
upd©e
, 
Ïmbda
, 
num
)

116 
i
, 
j
, 
k
;

117 
ii
, 
jj
;

118 
k
 = 0; k < 
»cÚ
.
c
; ++k){

119 
j
 = 0; j < 
»cÚ
.
h
; ++j){

120 
i
 = 0; i < 
»cÚ
.
w
; ++i){

121 
out_šdex
 = 
i
 + 
»cÚ
.
w
*(
j
 +„ecÚ.
h
*
k
);

122 
jj
 = 
j
-
num
; jj <ğj +‚um && jj < 
»cÚ
.
h
; ++jj){

123 ià(
jj
 < 0) ;

124 
ii
 = 
i
-
num
; i˜<ğ˜+‚um && i˜< 
»cÚ
.
w
; ++ii){

125 ià(
ii
 < 0) ;

126 
š_šdex
 = 
ii
 + 
»cÚ
.
w
*(
jj
 +„ecÚ.
h
*
k
);

127 
upd©e
.
d©a
[
out_šdex
] +ğ
Ïmbda
 * (
»cÚ
.d©a[
š_šdex
] -„econ.data[out_index]);

133 
	}
}

135 
	$»cÚ¡ruù_piùu»
(
ÃtwÜk
 *
Ãt
, *
ã©u»s
, 
image
 
»cÚ
, imag
upd©e
, 
¿‹
, 
mom’tum
, 
Ïmbda
, 
smoÙh_size
, 
™”s
)

137 
™”
 = 0;

138 
™”
 = 0; i‹¸< 
™”s
; ++iter) {

139 
image
 
d–
 = 
	`make_image
(
»cÚ
.
w
,„ecÚ.
h
,„ecÚ.
c
);

141 #ifdeà
GPU


142 
Ïy”
 
l
 = 
	`g‘_ÃtwÜk_ouut_Ïy”
(
Ãt
);

143 
	`cuda_push_¬¿y
(
Ãt
->
šput_gpu
, 
»cÚ
.
d©a
,„ecÚ.
w
*»cÚ.
h
*»cÚ.
c
);

145 
Ãt
->
d–_gpu
 = 
	`cuda_make_¬¿y
(
d–
.
d©a
, d–.
w
*d–.
h
*d–.
c
);

147 
	`fÜw¬d_ÃtwÜk_gpu
(
Ãt
);

148 
	`cuda_push_¬¿y
(
l
.
d–_gpu
, 
ã©u»s
,†.
ouuts
);

149 
	`axpy_gpu
(
l
.
ouuts
, -1,†.
ouut_gpu
, 1,†.
d–_gpu
, 1);

150 
	`backw¬d_ÃtwÜk_gpu
(
Ãt
);

152 
	`cuda_puÎ_¬¿y
(
Ãt
->
d–_gpu
, 
d–
.
d©a
, d–.
w
*d–.
h
*d–.
c
);

154 
	`cuda_ä“
(
Ãt
->
d–_gpu
);

156 
Ãt
->
šput
 = 
»cÚ
.
d©a
;

157 
Ãt
->
d–
 = d–.
d©a
;

158 
Ãt
->
Œuth
 = 
ã©u»s
;

160 
	`fÜw¬d_ÃtwÜk
(
Ãt
);

161 
	`backw¬d_ÃtwÜk
(
Ãt
);

165 
	`axpy_ıu
(
»cÚ
.
w
*»cÚ.
h
*»cÚ.
c
, 1, 
d–
.
d©a
, 1, 
upd©e
.data, 1);

168 
	`axpy_ıu
(
»cÚ
.
w
*»cÚ.
h
*»cÚ.
c
, 
¿‹
, 
upd©e
.
d©a
, 1,„econ.data, 1);

169 
	`sÿl_ıu
(
»cÚ
.
w
*»cÚ.
h
*»cÚ.
c
, 
mom’tum
, 
upd©e
.
d©a
, 1);

171 
mag
 = 
	`mag_¬¿y
(
d–
.
d©a
, 
»cÚ
.
w
*»cÚ.
h
*»cÚ.
c
);

172 
	`´štf
("mag: %f\n", 
mag
);

175 
	`cÚ¡¿š_image
(
»cÚ
);

176 
	`ä“_image
(
d–
);

178 
	}
}

288 
	$run_nightm¬e
(
¬gc
, **
¬gv
)

290 
	`¤ªd
(0);

291 if(
¬gc
 < 4){

292 
	`årštf
(
¡d”r
, "u§ge: % % [cfg] [weights] [image] [Ïy”] [İtiÚs! (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

296 *
cfg
 = 
¬gv
[2];

297 *
weights
 = 
¬gv
[3];

298 *
šput
 = 
¬gv
[4];

299 
max_Ïy”
 = 
	`©oi
(
¬gv
[5]);

301 
¿nge
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-range", 1);

302 
nÜm
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-norm", 1);

303 
rounds
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-rounds", 1);

304 
™”s
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-iters", 10);

305 
oùaves
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-octaves", 4);

306 
zoom
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-zoom", 1.);

307 
¿‹
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-rate", .04);

308 
th»sh
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-thresh", 1.);

309 
rÙ©e
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-rotate", 0);

310 
mom’tum
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-momentum", .9);

311 
Ïmbda
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-lambda", .01);

312 *
´efix
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-prefix", 0);

313 
»cÚ¡ruù
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-reconstruct");

314 
smoÙh_size
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-smooth", 1);

316 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

317 *
cfgba£
 = 
	`ba£cfg
(
cfg
);

318 *
imba£
 = 
	`ba£cfg
(
šput
);

320 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

321 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

323 
sÿË
 = 1;

324 if(
im
.
w
 > 512 || im.
h
 > 512){

325 if(
im
.
w
 > im.
h
è
sÿË
 = 512.0/im.w;

326 
sÿË
 = 512.0/
im
.
h
;

328 
image
 
»sized
 = 
	`»size_image
(
im
, 
sÿË
*im.
w
, sÿË*im.
h
);

329 
	`ä“_image
(
im
);

330 
im
 = 
»sized
;

334 *
ã©u»s
 = 0;

335 
image
 
upd©e
;

336 ià(
»cÚ¡ruù
){

337 
Ãt
->
n
 = 
max_Ïy”
;

338 
im
 = 
	`Ë‰”box_image
(im, 
Ãt
->
w
,‚‘->
h
);

341 
	`ÃtwÜk_´ediù
(
Ãt
, 
im
.
d©a
);

342 if(
Ãt
->
Ïy”s
[Ãt->
n
-1].
ty³
 =ğ
REGION
){

343 
	`´štf
("region!\n");

344 
	`z”o_objeùÃss
(
Ãt
->
Ïy”s
[Ãt->
n
-1]);

346 
image
 
out_im
 = 
	`cİy_image
(
	`g‘_ÃtwÜk_image
(
Ãt
));

353 
	`´štf
("%d f—tu»s\n", 
out_im
.
w
*out_im.
h
*out_im.
c
);

355 
ã©u»s
 = 
out_im
.
d©a
;

365 
upd©e
 = 
	`make_image
(
im
.
w
, im.
h
, im.
c
);

368 
e
;

369 
n
;

370 
e
 = 0;ƒ < 
rounds
; ++e){

371 
	`årštf
(
¡d”r
, "Iteration: ");

372 
	`fæush
(
¡d”r
);

373 
n
 = 0;‚ < 
™”s
; ++n){

374 
	`årštf
(
¡d”r
, "%d, ", 
n
);

375 
	`fæush
(
¡d”r
);

376 if(
»cÚ¡ruù
){

377 
	`»cÚ¡ruù_piùu»
(
Ãt
, 
ã©u»s
, 
im
, 
upd©e
, 
¿‹
, 
mom’tum
, 
Ïmbda
, 
smoÙh_size
, 1);

379 
	`show_image
(
im
, "reconstruction", 10);

381 
Ïy”
 = 
max_Ïy”
 + 
	`¿nd
()%
¿nge
 -„ange/2;

382 
oùave
 = 
	`¿nd
()%
oùaves
;

383 
	`İtimize_piùu»
(
Ãt
, 
im
, 
Ïy”
, 1/
	`pow
(1.33333333, 
oùave
), 
¿‹
, 
th»sh
, 
nÜm
);

386 
	`årštf
(
¡d”r
, "done\n");

388 
image
 
g
 = 
	`g¿ysÿË_image
(
im
);

389 
	`ä“_image
(
im
);

390 
im
 = 
g
;

392 
buff
[256];

393 ià(
´efix
){

394 
	`¥rštf
(
buff
, "%s/%s_%s_%d_%06d",
´efix
, 
imba£
, 
cfgba£
, 
max_Ïy”
, 
e
);

396 
	`¥rštf
(
buff
, "%s_%s_%d_%06d",
imba£
, 
cfgba£
, 
max_Ïy”
, 
e
);

398 
	`´štf
("%d %s\n", 
e
, 
buff
);

399 
	`§ve_image
(
im
, 
buff
);

402 if(
rÙ©e
){

403 
image
 
rÙ
 = 
	`rÙ©e_image
(
im
, 
rÙ©e
);

404 
	`ä“_image
(
im
);

405 
im
 = 
rÙ
;

407 
image
 
üİ
 = 
	`üİ_image
(
im
, im.
w
 * (1. - 
zoom
)/2., im.
h
 * (1.-zoom)/2., im.w*zoom, im.h*zoom);

408 
image
 
»sized
 = 
	`»size_image
(
üİ
, 
im
.
w
, im.
h
);

409 
	`ä“_image
(
im
);

410 
	`ä“_image
(
üİ
);

411 
im
 = 
»sized
;

413 
	}
}

	@host/examples/regressor.c

1 
	~"d¬kÃt.h
"

2 
	~<sys/time.h
>

3 
	~<as£¹.h
>

5 
	$Œaš_»g»ssÜ
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
gpus
, 
ngpus
, 
ş—r
)

7 
i
;

9 
avg_loss
 = -1;

10 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

11 
	`´štf
("%s\n", 
ba£
);

12 
	`´štf
("%d\n", 
ngpus
);

13 
ÃtwÜk
 **
Ãts
 = 
	`ÿÎoc
(
ngpus
, (network*));

15 
	`¤ªd
(
	`time
(0));

16 
£ed
 = 
	`¿nd
();

17 
i
 = 0; i < 
ngpus
; ++i){

18 
	`¤ªd
(
£ed
);

19 #ifdeà
GPU


20 
	`cuda_£t_deviû
(
gpus
[
i
]);

22 
Ãts
[
i
] = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

23 
Ãts
[
i
]->
Ë¬nšg_¿‹
 *ğ
ngpus
;

25 
	`¤ªd
(
	`time
(0));

26 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

28 
imgs
 = 
Ãt
->
b©ch
 *‚‘->
subdivisiÚs
 * 
ngpus
;

30 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

31 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

33 *
backup_dœeùÜy
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "backup", "/backup/");

34 *
Œaš_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "train", "data/train.list");

35 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 1);

37 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_li¡
);

38 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

39 
	`´štf
("%d\n", 
¶i¡
->
size
);

40 
N
 = 
¶i¡
->
size
;

41 
şock_t
 
time
;

43 
lßd_¬gs
 
¬gs
 = {0};

44 
¬gs
.
w
 = 
Ãt
->w;

45 
¬gs
.
h
 = 
Ãt
->h;

46 
¬gs
.
th»ads
 = 32;

47 
¬gs
.
şas£s
 = classes;

49 
¬gs
.
mš
 = 
Ãt
->
mš_¿tio
*Ãt->
w
;

50 
¬gs
.
max
 = 
Ãt
->
max_¿tio
*Ãt->
w
;

51 
¬gs
.
ªgË
 = 
Ãt
->angle;

52 
¬gs
.
a¥eù
 = 
Ãt
->aspect;

53 
¬gs
.
exposu»
 = 
Ãt
->exposure;

54 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

55 
¬gs
.
hue
 = 
Ãt
->hue;

56 
¬gs
.
size
 = 
Ãt
->
w
;

58 
¬gs
.
·ths
 =…aths;

59 
¬gs
.
n
 = 
imgs
;

60 
¬gs
.
m
 = 
N
;

61 
¬gs
.
ty³
 = 
REGRESSION_DATA
;

63 
d©a
 
Œaš
;

64 
d©a
 
bufãr
;

65 
±h»ad_t
 
lßd_th»ad
;

66 
¬gs
.
d
 = &
bufãr
;

67 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

69 
•och
 = (*
Ãt
->
£’
)/
N
;

70 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

71 
time
=
	`şock
();

73 
	`±h»ad_još
(
lßd_th»ad
, 0);

74 
Œaš
 = 
bufãr
;

75 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

77 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

78 
time
=
	`şock
();

80 
loss
 = 0;

81 #ifdeà
GPU


82 if(
ngpus
 == 1){

83 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

85 
loss
 = 
	`Œaš_ÃtwÜks
(
Ãts
, 
ngpus
, 
Œaš
, 4);

88 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

90 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

91 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

92 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`£c
(
	`şock
()-
time
), *net->seen);

93 
	`ä“_d©a
(
Œaš
);

94 if(*
Ãt
->
£’
/
N
 > 
•och
){

95 
•och
 = *
Ãt
->
£’
/
N
;

96 
buff
[256];

97 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

98 
	`§ve_weights
(
Ãt
, 
buff
);

100 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%100 == 0){

101 
buff
[256];

102 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

103 
	`§ve_weights
(
Ãt
, 
buff
);

106 
buff
[256];

107 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

108 
	`§ve_weights
(
Ãt
, 
buff
);

110 
	`ä“_ÃtwÜk
(
Ãt
);

111 
	`ä“_±rs
((**)
·ths
, 
¶i¡
->
size
);

112 
	`ä“_li¡
(
¶i¡
);

113 
	`ä“
(
ba£
);

114 
	}
}

116 
	$´ediù_»g»ssÜ
(*
cfgfe
, *
weightfe
, *
f’ame
)

118 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

119 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

120 
	`¤ªd
(2222222);

122 
şock_t
 
time
;

123 
buff
[256];

124 *
šput
 = 
buff
;

126 if(
f’ame
){

127 
	`¡ºıy
(
šput
, 
f’ame
, 256);

129 
	`´štf
("Enter Image Path: ");

130 
	`fæush
(
¡dout
);

131 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

132 if(!
šput
) ;

133 
	`¡¹ok
(
šput
, "\n");

135 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

136 
image
 
sized
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

138 *
X
 = 
sized
.
d©a
;

139 
time
=
	`şock
();

140 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

141 
	`´štf
("P»diùed: %f\n", 
´ediùiÚs
[0]);

142 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

143 
	`ä“_image
(
im
);

144 
	`ä“_image
(
sized
);

145 ià(
f’ame
) ;

147 
	}
}

150 
	$demo_»g»ssÜ
(*
d©acfg
, *
cfgfe
, *
weightfe
, 
ÿm_šdex
, cÚ¡ *
f’ame
)

152 #ifdeà
OPENCV


153 
	`´štf
("Regressor Demo\n");

154 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

155 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

157 
	`¤ªd
(2222222);

158 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

159 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 1);

160 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", 0);

161 **
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

163 * 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 
ÿm_šdex
, 0,0,0);

164 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

165 
ås
 = 0;

168 
timev®
 
tv®_befÜe
, 
tv®_aá”
, 
tv®_»suÉ
;

169 
	`g‘timeofday
(&
tv®_befÜe
, 
NULL
);

171 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

172 
image
 
üİ
 = 
	`ûÁ”_üİ_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

173 
	`g¿ysÿË_image_3c
(
üİ
);

175 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
üİ
.
d©a
);

177 
	`´štf
("\033[2J");

178 
	`´štf
("\033[1;1H");

179 
	`´štf
("\nFPS:%.0f\n",
ås
);

181 
i
;

182 
i
 = 0; i < 
şas£s
; ++i){

183 
	`´štf
("%s: %f\n", 
Çmes
[
i
], 
´ediùiÚs
[i]);

186 
	`show_image
(
üİ
, "Regressor", 10);

187 
	`ä“_image
(
š
);

188 
	`ä“_image
(
üİ
);

190 
	`g‘timeofday
(&
tv®_aá”
, 
NULL
);

191 
	`tim”sub
(&
tv®_aá”
, &
tv®_befÜe
, &
tv®_»suÉ
);

192 
cu¼
 = 1000000.f/(()
tv®_»suÉ
.
tv_u£c
);

193 
ås
 = .9*å + .1*
cu¼
;

196 
	}
}

199 
	$run_»g»ssÜ
(
¬gc
, **
¬gv
)

201 if(
¬gc
 < 4){

202 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

206 *
gpu_li¡
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-gpus", 0);

207 *
gpus
 = 0;

208 
gpu
 = 0;

209 
ngpus
 = 0;

210 if(
gpu_li¡
){

211 
	`´štf
("%s\n", 
gpu_li¡
);

212 
Ën
 = 
	`¡¾’
(
gpu_li¡
);

213 
ngpus
 = 1;

214 
i
;

215 
i
 = 0; i < 
Ën
; ++i){

216 ià(
gpu_li¡
[
i
] =ğ','è++
ngpus
;

218 
gpus
 = 
	`ÿÎoc
(
ngpus
, ());

219 
i
 = 0; i < 
ngpus
; ++i){

220 
gpus
[
i
] = 
	`©oi
(
gpu_li¡
);

221 
gpu_li¡
 = 
	`¡rchr
(gpu_list, ',')+1;

224 
gpu
 = 
gpu_šdex
;

225 
gpus
 = &
gpu
;

226 
ngpus
 = 1;

229 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

230 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

231 *
d©a
 = 
¬gv
[3];

232 *
cfg
 = 
¬gv
[4];

233 *
weights
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

234 *
f’ame
 = (
¬gc
 > 6è? 
¬gv
[6]: 0;

235 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`´ediù_»g»ssÜ
(
d©a
, 
cfg
, 
weights
);

236 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_»g»ssÜ
(
d©a
, 
cfg
, 
weights
, 
gpus
, 
ngpus
, 
ş—r
);

237 if(0==
	`¡rcmp
(
¬gv
[2], "demo")è
	`demo_»g»ssÜ
(
d©a
, 
cfg
, 
weights
, 
ÿm_šdex
, 
f’ame
);

238 
	}
}

	@host/examples/rnn.c

1 
	~"d¬kÃt.h
"

3 
	~<m©h.h
>

6 *
	mx
;

7 *
	my
;

8 } 
	tæßt_·œ
;

10 **
	$lßd_fes
(*
f’ame
, *
n
)

12 
li¡
 *
·ths
 = 
	`g‘_·ths
(
f’ame
);

13 *
n
 = 
·ths
->
size
;

14 **
cÚ‹Ás
 = 
	`ÿÎoc
(*
n
, (*));

15 
i
;

16 
node
 *
x
 = 
·ths
->
äÚt
;

17 
i
 = 0; i < *
n
; ++i){

18 
cÚ‹Ás
[
i
] = 
	`»ad_fe
((*)
x
->
v®
);

19 
x
 = x->
Ãxt
;

21  
cÚ‹Ás
;

22 
	}
}

24 *
	$»ad_tok’ized_d©a
(*
f’ame
, 
size_t
 *
»ad
)

26 
size_t
 
size
 = 512;

27 
size_t
 
couÁ
 = 0;

28 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "r");

29 *
d
 = 
	`ÿÎoc
(
size
, ());

30 
n
, 
Úe
;

31 
Úe
 = 
	`fsÿnf
(
å
, "%d", &
n
);

32 
Úe
 == 1){

33 ++
couÁ
;

34 if(
couÁ
 > 
size
){

35 
size
 = size*2;

36 
d
 = 
	`»®loc
(d, 
size
*());

38 
d
[
couÁ
-1] = 
n
;

39 
Úe
 = 
	`fsÿnf
(
å
, "%d", &
n
);

41 
	`fşo£
(
å
);

42 
d
 = 
	`»®loc
(d, 
couÁ
*());

43 *
»ad
 = 
couÁ
;

44  
d
;

45 
	}
}

47 **
	$»ad_tok’s
(*
f’ame
, 
size_t
 *
»ad
)

49 
size_t
 
size
 = 512;

50 
size_t
 
couÁ
 = 0;

51 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "r");

52 **
d
 = 
	`ÿÎoc
(
size
, (*));

53 *
lše
;

54 (
lše
=
	`fg‘l
(
å
)) != 0){

55 ++
couÁ
;

56 if(
couÁ
 > 
size
){

57 
size
 = size*2;

58 
d
 = 
	`»®loc
(d, 
size
*(*));

60 if(0==
	`¡rcmp
(
lše
, "<NEWLINE>"))†ine = "\n";

61 
d
[
couÁ
-1] = 
lše
;

63 
	`fşo£
(
å
);

64 
d
 = 
	`»®loc
(d, 
couÁ
*(*));

65 *
»ad
 = 
couÁ
;

66  
d
;

67 
	}
}

70 
æßt_·œ
 
	$g‘_ºn_tok’_d©a
(*
tok’s
, 
size_t
 *
off£ts
, 
ch¬aù”s
, size_ˆ
Ën
, 
b©ch
, 
¡•s
)

72 *
x
 = 
	`ÿÎoc
(
b©ch
 * 
¡•s
 * 
ch¬aù”s
, ());

73 *
y
 = 
	`ÿÎoc
(
b©ch
 * 
¡•s
 * 
ch¬aù”s
, ());

74 
i
,
j
;

75 
i
 = 0; i < 
b©ch
; ++i){

76 
j
 = 0; j < 
¡•s
; ++j){

77 
cu¼
 = 
tok’s
[(
off£ts
[
i
])%
Ën
];

78 
Ãxt
 = 
tok’s
[(
off£ts
[
i
] + 1)%
Ën
];

80 
x
[(
j
*
b©ch
 + 
i
)*
ch¬aù”s
 + 
cu¼
] = 1;

81 
y
[(
j
*
b©ch
 + 
i
)*
ch¬aù”s
 + 
Ãxt
] = 1;

83 
off£ts
[
i
] = (off£ts[i] + 1è% 
Ën
;

85 if(
cu¼
 >ğ
ch¬aù”s
 || cu¼ < 0 || 
Ãxt
 >= characters ||‚ext < 0){

86 
	`”rÜ
("Bad char");

90 
æßt_·œ
 
p
;

91 
p
.
x
 = x;

92 
p
.
y
 = y;

93  
p
;

94 
	}
}

96 
æßt_·œ
 
	$g‘_£q2£q_d©a
(**
sourû
, **
de¡
, 
n
, 
ch¬aù”s
, 
size_t
 
Ën
, 
b©ch
, 
¡•s
)

98 
i
,
j
;

99 *
x
 = 
	`ÿÎoc
(
b©ch
 * 
¡•s
 * 
ch¬aù”s
, ());

100 *
y
 = 
	`ÿÎoc
(
b©ch
 * 
¡•s
 * 
ch¬aù”s
, ());

101 
i
 = 0; i < 
b©ch
; ++i){

102 
šdex
 = 
	`¿nd
()%
n
;

105 
j
 = 0; j < 
¡•s
; ++j){

106 
cu¼
 = 
sourû
[
šdex
][
j
];

107 
Ãxt
 = 
de¡
[
šdex
][
j
];

109 
x
[(
j
*
b©ch
 + 
i
)*
ch¬aù”s
 + 
cu¼
] = 1;

110 
y
[(
j
*
b©ch
 + 
i
)*
ch¬aù”s
 + 
Ãxt
] = 1;

112 if(
cu¼
 > 255 || cu¼ <ğ0 || 
Ãxt
 > 255 ||‚ext <= 0){

117 
	`”rÜ
("Bad char");

121 
æßt_·œ
 
p
;

122 
p
.
x
 = x;

123 
p
.
y
 = y;

124  
p
;

125 
	}
}

127 
æßt_·œ
 
	$g‘_ºn_d©a
(*
‹xt
, 
size_t
 *
off£ts
, 
ch¬aù”s
, size_ˆ
Ën
, 
b©ch
, 
¡•s
)

129 *
x
 = 
	`ÿÎoc
(
b©ch
 * 
¡•s
 * 
ch¬aù”s
, ());

130 *
y
 = 
	`ÿÎoc
(
b©ch
 * 
¡•s
 * 
ch¬aù”s
, ());

131 
i
,
j
;

132 
i
 = 0; i < 
b©ch
; ++i){

133 
j
 = 0; j < 
¡•s
; ++j){

134 
cu¼
 = 
‹xt
[(
off£ts
[
i
])%
Ën
];

135 
Ãxt
 = 
‹xt
[(
off£ts
[
i
] + 1)%
Ën
];

137 
x
[(
j
*
b©ch
 + 
i
)*
ch¬aù”s
 + 
cu¼
] = 1;

138 
y
[(
j
*
b©ch
 + 
i
)*
ch¬aù”s
 + 
Ãxt
] = 1;

140 
off£ts
[
i
] = (off£ts[i] + 1è% 
Ën
;

142 if(
cu¼
 > 255 || cu¼ <ğ0 || 
Ãxt
 > 255 ||‚ext <= 0){

147 
	`”rÜ
("Bad char");

151 
æßt_·œ
 
p
;

152 
p
.
x
 = x;

153 
p
.
y
 = y;

154  
p
;

155 
	}
}

157 
	$Œaš_ch¬_ºn
(*
cfgfe
, *
weightfe
, *
f’ame
, 
ş—r
, 
tok’ized
)

159 
	`¤ªd
(
	`time
(0));

160 *
‹xt
 = 0;

161 *
tok’s
 = 0;

162 
size_t
 
size
;

163 if(
tok’ized
){

164 
tok’s
 = 
	`»ad_tok’ized_d©a
(
f’ame
, &
size
);

166 
‹xt
 = 
	`»ad_fe
(
f’ame
);

167 
size
 = 
	`¡¾’
((cÚ¡ *)
‹xt
);

170 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

171 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

172 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

173 
avg_loss
 = -1;

174 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

176 
šputs
 = 
Ãt
->inputs;

177 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g, IÅuts: %d %d %d\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
, 
šputs
,‚‘->
b©ch
,‚‘->
time_¡•s
);

178 
b©ch
 = 
Ãt
->batch;

179 
¡•s
 = 
Ãt
->
time_¡•s
;

180 if(
ş—r
è*
Ãt
->
£’
 = 0;

181 
i
 = (*
Ãt
->
£’
)/Ãt->
b©ch
;

183 
¡»ams
 = 
b©ch
/
¡•s
;

184 
size_t
 *
off£ts
 = 
	`ÿÎoc
(
¡»ams
, (size_t));

185 
j
;

186 
j
 = 0; j < 
¡»ams
; ++j){

187 
off£ts
[
j
] = 
	`¿nd_size_t
()%
size
;

190 
şock_t
 
time
;

191 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
){

192 
i
 += 1;

193 
time
=
	`şock
();

194 
æßt_·œ
 
p
;

195 if(
tok’ized
){

196 
p
 = 
	`g‘_ºn_tok’_d©a
(
tok’s
, 
off£ts
, 
šputs
, 
size
, 
¡»ams
, 
¡•s
);

198 
p
 = 
	`g‘_ºn_d©a
(
‹xt
, 
off£ts
, 
šputs
, 
size
, 
¡»ams
, 
¡•s
);

201 
	`cİy_ıu
(
Ãt
->
šputs
*Ãt->
b©ch
, 
p
.
x
, 1,‚‘->
šput
, 1);

202 
	`cİy_ıu
(
Ãt
->
Œuths
*Ãt->
b©ch
, 
p
.
y
, 1,‚‘->
Œuth
, 1);

203 
loss
 = 
	`Œaš_ÃtwÜk_d©um
(
Ãt
è/ (
b©ch
);

204 
	`ä“
(
p
.
x
);

205 
	`ä“
(
p
.
y
);

206 ià(
avg_loss
 < 0èavg_los ğ
loss
;

207 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

209 
size_t
 
ch¬s
 = 
	`g‘_cu¼’t_b©ch
(
Ãt
)*
b©ch
;

210 
	`årštf
(
¡d”r
, "%d: %f, %àavg, %à¿‹, %là£cÚds, %à•ochs\n", 
i
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
(
Ãt
), 
	`£c
(
	`şock
()-
time
), (è
ch¬s
/
size
);

212 
j
 = 0; j < 
¡»ams
; ++j){

214 if(
	`¿nd
()%64 == 0){

216 
off£ts
[
j
] = 
	`¿nd_size_t
()%
size
;

217 
	`»£t_ÃtwÜk_¡©e
(
Ãt
, 
j
);

221 if(
i
%10000==0){

222 
buff
[256];

223 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

224 
	`§ve_weights
(
Ãt
, 
buff
);

226 if(
i
%100==0){

227 
buff
[256];

228 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

229 
	`§ve_weights
(
Ãt
, 
buff
);

232 
buff
[256];

233 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

234 
	`§ve_weights
(
Ãt
, 
buff
);

235 
	}
}

237 
	$´št_symbŞ
(
n
, **
tok’s
){

238 if(
tok’s
){

239 
	`´štf
("% ", 
tok’s
[
n
]);

241 
	`´štf
("%c", 
n
);

243 
	}
}

245 
	$‹¡_ch¬_ºn
(*
cfgfe
, *
weightfe
, 
num
, *
£ed
, 
‹mp
, 
r£ed
, *
tok’_fe
)

247 **
tok’s
 = 0;

248 if(
tok’_fe
){

249 
size_t
 
n
;

250 
tok’s
 = 
	`»ad_tok’s
(
tok’_fe
, &
n
);

253 
	`¤ªd
(
r£ed
);

254 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

255 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

257 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

258 
šputs
 = 
Ãt
->inputs;

260 
i
, 
j
;

261 
i
 = 0; i < 
Ãt
->
n
; ++ièÃt->
Ïy”s
[i].
‹m³¿tu»
 = 
‹mp
;

262 
c
 = 0;

263 
Ën
 = 
	`¡¾’
(
£ed
);

264 *
šput
 = 
	`ÿÎoc
(
šputs
, ());

274 
i
 = 0; i < 
Ën
-1; ++i){

275 
c
 = 
£ed
[
i
];

276 
šput
[
c
] = 1;

277 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

278 
šput
[
c
] = 0;

279 
	`´št_symbŞ
(
c
, 
tok’s
);

281 if(
Ën
è
c
 = 
£ed
[len-1];

282 
	`´št_symbŞ
(
c
, 
tok’s
);

283 
i
 = 0; i < 
num
; ++i){

284 
šput
[
c
] = 1;

285 *
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

286 
šput
[
c
] = 0;

287 
j
 = 32; j < 127; ++j){

290 
j
 = 0; j < 
šputs
; ++j){

291 ià(
out
[
j
] < .0001) out[j] = 0;

293 
c
 = 
	`§m¶e_¬¿y
(
out
, 
šputs
);

294 
	`´št_symbŞ
(
c
, 
tok’s
);

296 
	`´štf
("\n");

297 
	}
}

299 
	$‹¡_ùic_ºn_muÉi
(*
cfgfe
, *
weightfe
, 
num
, 
‹mp
, 
r£ed
, *
tok’_fe
)

301 **
tok’s
 = 0;

302 if(
tok’_fe
){

303 
size_t
 
n
;

304 
tok’s
 = 
	`»ad_tok’s
(
tok’_fe
, &
n
);

307 
	`¤ªd
(
r£ed
);

308 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

309 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

311 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

312 
šputs
 = 
Ãt
->inputs;

314 
i
, 
j
;

315 
i
 = 0; i < 
Ãt
->
n
; ++ièÃt->
Ïy”s
[i].
‹m³¿tu»
 = 
‹mp
;

316 
c
 = 0;

317 *
šput
 = 
	`ÿÎoc
(
šputs
, ());

318 *
out
 = 0;

321 
	`»£t_ÃtwÜk_¡©e
(
Ãt
, 0);

322 (
c
 = 
	`g‘c
(
¡dš
)è!ğ
EOF
 && c != 0){

323 
šput
[
c
] = 1;

324 
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

325 
šput
[
c
] = 0;

327 
i
 = 0; i < 
num
; ++i){

328 
j
 = 0; j < 
šputs
; ++j){

329 ià(
out
[
j
] < .0001) out[j] = 0;

331 
Ãxt
 = 
	`§m¶e_¬¿y
(
out
, 
šputs
);

332 if(
c
 =ğ'.' && 
Ãxt
 == '\n') ;

333 
c
 = 
Ãxt
;

334 
	`´št_symbŞ
(
c
, 
tok’s
);

336 
šput
[
c
] = 1;

337 
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

338 
šput
[
c
] = 0;

340 
	`´štf
("\n");

342 
	}
}

344 
	$‹¡_ùic_ºn
(*
cfgfe
, *
weightfe
, 
num
, 
‹mp
, 
r£ed
, *
tok’_fe
)

346 **
tok’s
 = 0;

347 if(
tok’_fe
){

348 
size_t
 
n
;

349 
tok’s
 = 
	`»ad_tok’s
(
tok’_fe
, &
n
);

352 
	`¤ªd
(
r£ed
);

353 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

354 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

356 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

357 
šputs
 = 
Ãt
->inputs;

359 
i
, 
j
;

360 
i
 = 0; i < 
Ãt
->
n
; ++ièÃt->
Ïy”s
[i].
‹m³¿tu»
 = 
‹mp
;

361 
c
 = 0;

362 *
šput
 = 
	`ÿÎoc
(
šputs
, ());

363 *
out
 = 0;

365 (
c
 = 
	`g‘c
(
¡dš
)è!ğ
EOF
){

366 
šput
[
c
] = 1;

367 
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

368 
šput
[
c
] = 0;

370 
i
 = 0; i < 
num
; ++i){

371 
j
 = 0; j < 
šputs
; ++j){

372 ià(
out
[
j
] < .0001) out[j] = 0;

374 
Ãxt
 = 
	`§m¶e_¬¿y
(
out
, 
šputs
);

375 if(
c
 =ğ'.' && 
Ãxt
 == '\n') ;

376 
c
 = 
Ãxt
;

377 
	`´št_symbŞ
(
c
, 
tok’s
);

379 
šput
[
c
] = 1;

380 
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

381 
šput
[
c
] = 0;

383 
	`´štf
("\n");

384 
	}
}

386 
	$v®id_ùic_ºn
(*
cfgfe
, *
weightfe
, *
£ed
)

388 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

389 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

391 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

392 
šputs
 = 
Ãt
->inputs;

394 
couÁ
 = 0;

395 
wÜds
 = 1;

396 
c
;

397 
Ën
 = 
	`¡¾’
(
£ed
);

398 *
šput
 = 
	`ÿÎoc
(
šputs
, ());

399 
i
;

400 
i
 = 0; i < 
Ën
; ++i){

401 
c
 = 
£ed
[
i
];

402 
šput
[()
c
] = 1;

403 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

404 
šput
[()
c
] = 0;

406 
sum
 = 0;

407 
c
 = 
	`g‘c
(
¡dš
);

408 
log2
 = 
	`log
(2);

409 
š
 = 0;

410 
c
 !ğ
EOF
){

411 
Ãxt
 = 
	`g‘c
(
¡dš
);

412 if(
Ãxt
 =ğ
EOF
) ;

413 if(
Ãxt
 < 0 ||‚exˆ>ğ255è
	`”rÜ
("Out of„ange character");

415 
šput
[
c
] = 1;

416 *
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

417 
šput
[
c
] = 0;

419 if(
c
 =ğ'.' && 
Ãxt
 =ğ'\n'è
š
 = 0;

420 if(!
š
) {

421 if(
c
 =ğ'>' && 
Ãxt
 == '>'){

422 
š
 = 1;

423 ++
wÜds
;

425 
c
 = 
Ãxt
;

428 ++
couÁ
;

429 
sum
 +ğ
	`log
(
out
[
Ãxt
])/
log2
;

430 
c
 = 
Ãxt
;

431 
	`´štf
("%d %d P”¶ex™y: %4.4à WÜd P”¶ex™y: %4.4f\n", 
couÁ
, 
wÜds
, 
	`pow
(2, -
sum
/count),…ow(2, -sum/words));

433 
	}
}

435 
	$v®id_ch¬_ºn
(*
cfgfe
, *
weightfe
, *
£ed
)

437 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

438 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

440 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

441 
šputs
 = 
Ãt
->inputs;

443 
couÁ
 = 0;

444 
wÜds
 = 1;

445 
c
;

446 
Ën
 = 
	`¡¾’
(
£ed
);

447 *
šput
 = 
	`ÿÎoc
(
šputs
, ());

448 
i
;

449 
i
 = 0; i < 
Ën
; ++i){

450 
c
 = 
£ed
[
i
];

451 
šput
[()
c
] = 1;

452 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

453 
šput
[()
c
] = 0;

455 
sum
 = 0;

456 
c
 = 
	`g‘c
(
¡dš
);

457 
log2
 = 
	`log
(2);

458 
c
 !ğ
EOF
){

459 
Ãxt
 = 
	`g‘c
(
¡dš
);

460 if(
Ãxt
 =ğ
EOF
) ;

461 if(
Ãxt
 < 0 ||‚exˆ>ğ255è
	`”rÜ
("Out of„ange character");

462 ++
couÁ
;

463 if(
Ãxt
 =ğ' ' ||‚exˆ=ğ'\n' ||‚exˆ=ğ'\t'è++
wÜds
;

464 
šput
[
c
] = 1;

465 *
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

466 
šput
[
c
] = 0;

467 
sum
 +ğ
	`log
(
out
[
Ãxt
])/
log2
;

468 
c
 = 
Ãxt
;

469 
	`´štf
("%d BPC: %4.4à P”¶ex™y: %4.4à WÜd P”¶ex™y: %4.4f\n", 
couÁ
, -
sum
/couÁ, 
	`pow
(2, -sum/couÁ),…ow(2, -sum/
wÜds
));

471 
	}
}

473 
	$vec_ch¬_ºn
(*
cfgfe
, *
weightfe
, *
£ed
)

475 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

476 
	`årštf
(
¡d”r
, "%s\n", 
ba£
);

478 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

479 
šputs
 = 
Ãt
->inputs;

481 
c
;

482 
£ed_Ën
 = 
	`¡¾’
(
£ed
);

483 *
šput
 = 
	`ÿÎoc
(
šputs
, ());

484 
i
;

485 *
lše
;

486 (
lše
=
	`fg‘l
(
¡dš
)) != 0){

487 
	`»£t_ÃtwÜk_¡©e
(
Ãt
, 0);

488 
i
 = 0; i < 
£ed_Ën
; ++i){

489 
c
 = 
£ed
[
i
];

490 
šput
[()
c
] = 1;

491 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

492 
šput
[()
c
] = 0;

494 
	`¡r
(
lše
);

495 
¡r_Ën
 = 
	`¡¾’
(
lše
);

496 
i
 = 0; i < 
¡r_Ën
; ++i){

497 
c
 = 
lše
[
i
];

498 
šput
[()
c
] = 1;

499 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

500 
šput
[()
c
] = 0;

502 
c
 = ' ';

503 
šput
[()
c
] = 1;

504 
	`ÃtwÜk_´ediù
(
Ãt
, 
šput
);

505 
šput
[()
c
] = 0;

507 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[0];

508 #ifdeà
GPU


509 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
ouuts
);

511 
	`´štf
("%s", 
lše
);

512 
i
 = 0; i < 
l
.
ouuts
; ++i){

513 
	`´štf
(",%g", 
l
.
ouut
[
i
]);

515 
	`´štf
("\n");

517 
	}
}

519 
	$run_ch¬_ºn
(
¬gc
, **
¬gv
)

521 if(
¬gc
 < 4){

522 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

525 *
f’ame
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-file", "data/shakespeare.txt");

526 *
£ed
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-seed", "\n\n");

527 
Ën
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-len", 1000);

528 
‹mp
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-temp", .7);

529 
r£ed
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-¤ªd", 
	`time
(0));

530 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

531 
tok’ized
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-tokenized");

532 *
tok’s
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-tokens", 0);

534 *
cfg
 = 
¬gv
[3];

535 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

536 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_ch¬_ºn
(
cfg
, 
weights
, 
f’ame
, 
ş—r
, 
tok’ized
);

537 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id_ch¬_ºn
(
cfg
, 
weights
, 
£ed
);

538 if(0==
	`¡rcmp
(
¬gv
[2], "v®idùic")è
	`v®id_ùic_ºn
(
cfg
, 
weights
, 
£ed
);

539 if(0==
	`¡rcmp
(
¬gv
[2], "vec")è
	`vec_ch¬_ºn
(
cfg
, 
weights
, 
£ed
);

540 if(0==
	`¡rcmp
(
¬gv
[2], "g’”©e")è
	`‹¡_ch¬_ºn
(
cfg
, 
weights
, 
Ën
, 
£ed
, 
‹mp
, 
r£ed
, 
tok’s
);

541 if(0==
	`¡rcmp
(
¬gv
[2], "g’”©‘aùic")è
	`‹¡_ùic_ºn
(
cfg
, 
weights
, 
Ën
, 
‹mp
, 
r£ed
, 
tok’s
);

542 
	}
}

	@host/examples/segmenter.c

1 
	~"d¬kÃt.h
"

2 
	~<sys/time.h
>

3 
	~<as£¹.h
>

5 
	$Œaš_£gm’‹r
(*
d©acfg
, *
cfgfe
, *
weightfe
, *
gpus
, 
ngpus
, 
ş—r
, 
di¥Ïy
)

7 
i
;

9 
avg_loss
 = -1;

10 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

11 
	`´štf
("%s\n", 
ba£
);

12 
	`´štf
("%d\n", 
ngpus
);

13 
ÃtwÜk
 **
Ãts
 = 
	`ÿÎoc
(
ngpus
, (network*));

15 
	`¤ªd
(
	`time
(0));

16 
£ed
 = 
	`¿nd
();

17 
i
 = 0; i < 
ngpus
; ++i){

18 
	`¤ªd
(
£ed
);

19 #ifdeà
GPU


20 
	`cuda_£t_deviû
(
gpus
[
i
]);

22 
Ãts
[
i
] = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

23 
Ãts
[
i
]->
Ë¬nšg_¿‹
 *ğ
ngpus
;

25 
	`¤ªd
(
	`time
(0));

26 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

27 
image
 
´ed
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

29 
div
 = 
Ãt
->
w
/
´ed
.w;

30 
	`as£¹
(
´ed
.
w
 * 
div
 =ğ
Ãt
->w);

31 
	`as£¹
(
´ed
.
h
 * 
div
 =ğ
Ãt
->h);

33 
imgs
 = 
Ãt
->
b©ch
 *‚‘->
subdivisiÚs
 * 
ngpus
;

35 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

36 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
d©acfg
);

38 *
backup_dœeùÜy
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "backup", "/backup/");

39 *
Œaš_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "train", "data/train.list");

41 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_li¡
);

42 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

43 
	`´štf
("%d\n", 
¶i¡
->
size
);

44 
N
 = 
¶i¡
->
size
;

46 
lßd_¬gs
 
¬gs
 = {0};

47 
¬gs
.
w
 = 
Ãt
->w;

48 
¬gs
.
h
 = 
Ãt
->h;

49 
¬gs
.
th»ads
 = 32;

50 
¬gs
.
sÿË
 = 
div
;

52 
¬gs
.
mš
 = 
Ãt
->
mš_üİ
;

53 
¬gs
.
max
 = 
Ãt
->
max_üİ
;

54 
¬gs
.
ªgË
 = 
Ãt
->angle;

55 
¬gs
.
a¥eù
 = 
Ãt
->aspect;

56 
¬gs
.
exposu»
 = 
Ãt
->exposure;

57 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

58 
¬gs
.
hue
 = 
Ãt
->hue;

59 
¬gs
.
size
 = 
Ãt
->
w
;

60 
¬gs
.
şas£s
 = 80;

62 
¬gs
.
·ths
 =…aths;

63 
¬gs
.
n
 = 
imgs
;

64 
¬gs
.
m
 = 
N
;

65 
¬gs
.
ty³
 = 
SEGMENTATION_DATA
;

67 
d©a
 
Œaš
;

68 
d©a
 
bufãr
;

69 
±h»ad_t
 
lßd_th»ad
;

70 
¬gs
.
d
 = &
bufãr
;

71 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

73 
•och
 = (*
Ãt
->
£’
)/
N
;

74 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

75 
time
 = 
	`wh©_time_is_™_now
();

77 
	`±h»ad_još
(
lßd_th»ad
, 0);

78 
Œaš
 = 
bufãr
;

79 
lßd_th»ad
 = 
	`lßd_d©a
(
¬gs
);

81 
	`´štf
("Lßded: %là£cÚds\n", 
	`wh©_time_is_™_now
()-
time
);

82 
time
 = 
	`wh©_time_is_™_now
();

84 
loss
 = 0;

85 #ifdeà
GPU


86 if(
ngpus
 == 1){

87 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

89 
loss
 = 
	`Œaš_ÃtwÜks
(
Ãts
, 
ngpus
, 
Œaš
, 4);

92 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

94 if(
di¥Ïy
){

95 
image
 
Œ
 = 
	`æßt_to_image
(
Ãt
->
w
/
div
,‚‘->
h
/div, 80, 
Œaš
.
y
.
v®s
[Ãt->
b©ch
*Ò‘->
subdivisiÚs
-1)]);

96 
image
 
im
 = 
	`æßt_to_image
(
Ãt
->
w
,‚‘->
h
,‚‘->
c
, 
Œaš
.
X
.
v®s
[Ãt->
b©ch
*Ò‘->
subdivisiÚs
-1)]);

97 
image
 
mask
 = 
	`mask_to_rgb
(
Œ
);

98 
image
 
´mask
 = 
	`mask_to_rgb
(
´ed
);

99 
	`show_image
(
im
, "input", 1);

100 
	`show_image
(
´mask
, "pred", 1);

101 
	`show_image
(
mask
, "truth", 100);

102 
	`ä“_image
(
mask
);

103 
	`ä“_image
(
´mask
);

105 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

106 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

107 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`wh©_time_is_™_now
()-
time
, *net->seen);

108 
	`ä“_d©a
(
Œaš
);

109 if(*
Ãt
->
£’
/
N
 > 
•och
){

110 
•och
 = *
Ãt
->
£’
/
N
;

111 
buff
[256];

112 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

113 
	`§ve_weights
(
Ãt
, 
buff
);

115 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%100 == 0){

116 
buff
[256];

117 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

118 
	`§ve_weights
(
Ãt
, 
buff
);

121 
buff
[256];

122 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

123 
	`§ve_weights
(
Ãt
, 
buff
);

125 
	`ä“_ÃtwÜk
(
Ãt
);

126 
	`ä“_±rs
((**)
·ths
, 
¶i¡
->
size
);

127 
	`ä“_li¡
(
¶i¡
);

128 
	`ä“
(
ba£
);

129 
	}
}

131 
	$´ediù_£gm’‹r
(*
d©afe
, *
cfg
, *
weights
, *
f’ame
)

133 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

134 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

135 
	`¤ªd
(2222222);

137 
şock_t
 
time
;

138 
buff
[256];

139 *
šput
 = 
buff
;

141 if(
f’ame
){

142 
	`¡ºıy
(
šput
, 
f’ame
, 256);

144 
	`´štf
("Enter Image Path: ");

145 
	`fæush
(
¡dout
);

146 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

147 if(!
šput
) ;

148 
	`¡¹ok
(
šput
, "\n");

150 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

151 
image
 
sized
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

153 *
X
 = 
sized
.
d©a
;

154 
time
=
	`şock
();

155 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

156 
image
 
´ed
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

157 
image
 
´mask
 = 
	`mask_to_rgb
(
´ed
);

158 
	`´štf
("P»diùed: %f\n", 
´ediùiÚs
[0]);

159 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

160 
	`show_image
(
sized
, "orig", 1);

161 
	`show_image
(
´mask
, "pred", 0);

162 
	`ä“_image
(
im
);

163 
	`ä“_image
(
sized
);

164 
	`ä“_image
(
´mask
);

165 ià(
f’ame
) ;

167 
	}
}

170 
	$demo_£gm’‹r
(*
d©acfg
, *
cfg
, *
weights
, 
ÿm_šdex
, cÚ¡ *
f’ame
)

172 #ifdeà
OPENCV


173 
	`´štf
("Classifier Demo\n");

174 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

175 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

177 
	`¤ªd
(2222222);

178 * 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 
ÿm_šdex
, 0,0,0);

180 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

181 
ås
 = 0;

184 
timev®
 
tv®_befÜe
, 
tv®_aá”
, 
tv®_»suÉ
;

185 
	`g‘timeofday
(&
tv®_befÜe
, 
NULL
);

187 
image
 
š
 = 
	`g‘_image_äom_¡»am
(
ÿp
);

188 
image
 
š_s
 = 
	`Ë‰”box_image
(
š
, 
Ãt
->
w
,‚‘->
h
);

190 
	`ÃtwÜk_´ediù
(
Ãt
, 
š_s
.
d©a
);

192 
	`´štf
("\033[2J");

193 
	`´štf
("\033[1;1H");

194 
	`´štf
("\nFPS:%.0f\n",
ås
);

196 
image
 
´ed
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

197 
image
 
´mask
 = 
	`mask_to_rgb
(
´ed
);

198 
	`show_image
(
´mask
, "Segmenter", 10);

200 
	`ä“_image
(
š_s
);

201 
	`ä“_image
(
š
);

202 
	`ä“_image
(
´mask
);

204 
	`g‘timeofday
(&
tv®_aá”
, 
NULL
);

205 
	`tim”sub
(&
tv®_aá”
, &
tv®_befÜe
, &
tv®_»suÉ
);

206 
cu¼
 = 1000000.f/(()
tv®_»suÉ
.
tv_u£c
);

207 
ås
 = .9*å + .1*
cu¼
;

210 
	}
}

213 
	$run_£gm’‹r
(
¬gc
, **
¬gv
)

215 if(
¬gc
 < 4){

216 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

220 *
gpu_li¡
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-gpus", 0);

221 *
gpus
 = 0;

222 
gpu
 = 0;

223 
ngpus
 = 0;

224 if(
gpu_li¡
){

225 
	`´štf
("%s\n", 
gpu_li¡
);

226 
Ën
 = 
	`¡¾’
(
gpu_li¡
);

227 
ngpus
 = 1;

228 
i
;

229 
i
 = 0; i < 
Ën
; ++i){

230 ià(
gpu_li¡
[
i
] =ğ','è++
ngpus
;

232 
gpus
 = 
	`ÿÎoc
(
ngpus
, ());

233 
i
 = 0; i < 
ngpus
; ++i){

234 
gpus
[
i
] = 
	`©oi
(
gpu_li¡
);

235 
gpu_li¡
 = 
	`¡rchr
(gpu_list, ',')+1;

238 
gpu
 = 
gpu_šdex
;

239 
gpus
 = &
gpu
;

240 
ngpus
 = 1;

243 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

244 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

245 
di¥Ïy
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-display");

246 *
d©a
 = 
¬gv
[3];

247 *
cfg
 = 
¬gv
[4];

248 *
weights
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

249 *
f’ame
 = (
¬gc
 > 6è? 
¬gv
[6]: 0;

250 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`´ediù_£gm’‹r
(
d©a
, 
cfg
, 
weights
, 
f’ame
);

251 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_£gm’‹r
(
d©a
, 
cfg
, 
weights
, 
gpus
, 
ngpus
, 
ş—r
, 
di¥Ïy
);

252 if(0==
	`¡rcmp
(
¬gv
[2], "demo")è
	`demo_£gm’‹r
(
d©a
, 
cfg
, 
weights
, 
ÿm_šdex
, 
f’ame
);

253 
	}
}

	@host/examples/super.c

1 
	~"d¬kÃt.h
"

3 
	$Œaš_su³r
(*
cfgfe
, *
weightfe
, 
ş—r
)

5 *
Œaš_images
 = "/data/imagenet/imagenet1k.train.list";

6 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

7 
	`¤ªd
(
	`time
(0));

8 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

9 
	`´štf
("%s\n", 
ba£
);

10 
avg_loss
 = -1;

11 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

12 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

13 
imgs
 = 
Ãt
->
b©ch
*Ãt->
subdivisiÚs
;

14 
i
 = *
Ãt
->
£’
/
imgs
;

15 
d©a
 
Œaš
, 
bufãr
;

18 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

20 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

22 
lßd_¬gs
 
¬gs
 = {0};

23 
¬gs
.
w
 = 
Ãt
->w;

24 
¬gs
.
h
 = 
Ãt
->h;

25 
¬gs
.
sÿË
 = 4;

26 
¬gs
.
·ths
 =…aths;

27 
¬gs
.
n
 = 
imgs
;

28 
¬gs
.
m
 = 
¶i¡
->
size
;

29 
¬gs
.
d
 = &
bufãr
;

30 
¬gs
.
ty³
 = 
SUPER_DATA
;

32 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

33 
şock_t
 
time
;

35 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
){

36 
i
 += 1;

37 
time
=
	`şock
();

38 
	`±h»ad_još
(
lßd_th»ad
, 0);

39 
Œaš
 = 
bufãr
;

40 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

42 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

44 
time
=
	`şock
();

45 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

46 ià(
avg_loss
 < 0èavg_los ğ
loss
;

47 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

49 
	`´štf
("%d: %f, %àavg, %à¿‹, %là£cÚds, %d images\n", 
i
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
(
Ãt
), 
	`£c
(
	`şock
()-
time
), i*
imgs
);

50 if(
i
%1000==0){

51 
buff
[256];

52 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

53 
	`§ve_weights
(
Ãt
, 
buff
);

55 if(
i
%100==0){

56 
buff
[256];

57 
	`¥rštf
(
buff
, "%s/%s.backup", 
backup_dœeùÜy
, 
ba£
);

58 
	`§ve_weights
(
Ãt
, 
buff
);

60 
	`ä“_d©a
(
Œaš
);

62 
buff
[256];

63 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

64 
	`§ve_weights
(
Ãt
, 
buff
);

65 
	}
}

67 
	$‹¡_su³r
(*
cfgfe
, *
weightfe
, *
f’ame
)

69 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

70 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

71 
	`¤ªd
(2222222);

73 
şock_t
 
time
;

74 
buff
[256];

75 *
šput
 = 
buff
;

77 if(
f’ame
){

78 
	`¡ºıy
(
šput
, 
f’ame
, 256);

80 
	`´štf
("Enter Image Path: ");

81 
	`fæush
(
¡dout
);

82 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

83 if(!
šput
) ;

84 
	`¡¹ok
(
šput
, "\n");

86 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

87 
	`»size_ÃtwÜk
(
Ãt
, 
im
.
w
, im.
h
);

88 
	`´štf
("%d %d\n", 
im
.
w
, im.
h
);

90 *
X
 = 
im
.
d©a
;

91 
time
=
	`şock
();

92 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

93 
image
 
out
 = 
	`g‘_ÃtwÜk_image
(
Ãt
);

94 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

95 
	`§ve_image
(
out
, "out");

96 
	`show_image
(
out
, "out", 0);

98 
	`ä“_image
(
im
);

99 ià(
f’ame
) ;

101 
	}
}

104 
	$run_su³r
(
¬gc
, **
¬gv
)

106 if(
¬gc
 < 4){

107 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

111 *
cfg
 = 
¬gv
[3];

112 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

113 *
f’ame
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

114 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

115 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_su³r
(
cfg
, 
weights
, 
ş—r
);

116 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_su³r
(
cfg
, 
weights
, 
f’ame
);

120 
	}
}

	@host/examples/tag.c

1 
	~"d¬kÃt.h
"

3 
	$Œaš_g
(*
cfgfe
, *
weightfe
, 
ş—r
)

5 
	`¤ªd
(
	`time
(0));

6 
avg_loss
 = -1;

7 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

8 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

9 
	`´štf
("%s\n", 
ba£
);

10 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 
ş—r
);

11 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

12 
imgs
 = 1024;

13 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("/home/pjreddie/tag/train.list");

14 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

15 
	`´štf
("%d\n", 
¶i¡
->
size
);

16 
N
 = 
¶i¡
->
size
;

17 
şock_t
 
time
;

18 
±h»ad_t
 
lßd_th»ad
;

19 
d©a
 
Œaš
;

20 
d©a
 
bufãr
;

22 
lßd_¬gs
 
¬gs
 = {0};

23 
¬gs
.
w
 = 
Ãt
->w;

24 
¬gs
.
h
 = 
Ãt
->h;

26 
¬gs
.
mš
 = 
Ãt
->
w
;

27 
¬gs
.
max
 = 
Ãt
->
max_üİ
;

28 
¬gs
.
size
 = 
Ãt
->
w
;

30 
¬gs
.
·ths
 =…aths;

31 
¬gs
.
şas£s
 = 
Ãt
->
ouuts
;

32 
¬gs
.
n
 = 
imgs
;

33 
¬gs
.
m
 = 
N
;

34 
¬gs
.
d
 = &
bufãr
;

35 
¬gs
.
ty³
 = 
TAG_DATA
;

37 
¬gs
.
ªgË
 = 
Ãt
->angle;

38 
¬gs
.
exposu»
 = 
Ãt
->exposure;

39 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

40 
¬gs
.
hue
 = 
Ãt
->hue;

42 
	`årštf
(
¡d”r
, "%d cÏs£s\n", 
Ãt
->
ouuts
);

44 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

45 
•och
 = (*
Ãt
->
£’
)/
N
;

46 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
 ||‚et->max_batches == 0){

47 
time
=
	`şock
();

48 
	`±h»ad_još
(
lßd_th»ad
, 0);

49 
Œaš
 = 
bufãr
;

51 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

52 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

53 
time
=
	`şock
();

54 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

55 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

56 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

57 
	`´štf
("%ld, %.3f: %f, %àavg, %à¿‹, %là£cÚds, %ld images\n", 
	`g‘_cu¼’t_b©ch
(
Ãt
), ()(*Ãt->
£’
)/
N
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
Ò‘), 
	`£c
(
	`şock
()-
time
), *net->seen);

58 
	`ä“_d©a
(
Œaš
);

59 if(*
Ãt
->
£’
/
N
 > 
•och
){

60 
•och
 = *
Ãt
->
£’
/
N
;

61 
buff
[256];

62 
	`¥rštf
(
buff
, "%s/%s_%d.weights",
backup_dœeùÜy
,
ba£
, 
•och
);

63 
	`§ve_weights
(
Ãt
, 
buff
);

65 if(
	`g‘_cu¼’t_b©ch
(
Ãt
)%100 == 0){

66 
buff
[256];

67 
	`¥rštf
(
buff
, "%s/%s.backup",
backup_dœeùÜy
,
ba£
);

68 
	`§ve_weights
(
Ãt
, 
buff
);

71 
buff
[256];

72 
	`¥rštf
(
buff
, "%s/%s.weights", 
backup_dœeùÜy
, 
ba£
);

73 
	`§ve_weights
(
Ãt
, 
buff
);

75 
	`±h»ad_još
(
lßd_th»ad
, 0);

76 
	`ä“_d©a
(
bufãr
);

77 
	`ä“_ÃtwÜk
(
Ãt
);

78 
	`ä“_±rs
((**)
·ths
, 
¶i¡
->
size
);

79 
	`ä“_li¡
(
¶i¡
);

80 
	`ä“
(
ba£
);

81 
	}
}

83 
	$‹¡_g
(*
cfgfe
, *
weightfe
, *
f’ame
)

85 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

86 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

87 
	`¤ªd
(2222222);

88 
i
 = 0;

89 **
Çmes
 = 
	`g‘_Ïb–s
("data/tags.txt");

90 
şock_t
 
time
;

91 
šdexes
[10];

92 
buff
[256];

93 *
šput
 = 
buff
;

94 
size
 = 
Ãt
->
w
;

96 if(
f’ame
){

97 
	`¡ºıy
(
šput
, 
f’ame
, 256);

99 
	`´štf
("Enter Image Path: ");

100 
	`fæush
(
¡dout
);

101 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

102 if(!
šput
) ;

103 
	`¡¹ok
(
šput
, "\n");

105 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
, 0, 0);

106 
image
 
r
 = 
	`»size_mš
(
im
, 
size
);

107 
	`»size_ÃtwÜk
(
Ãt
, 
r
.
w
,„.
h
);

108 
	`´štf
("%d %d\n", 
r
.
w
,„.
h
);

110 *
X
 = 
r
.
d©a
;

111 
time
=
	`şock
();

112 *
´ediùiÚs
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

113 
	`tİ_´ediùiÚs
(
Ãt
, 10, 
šdexes
);

114 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

115 
i
 = 0; i < 10; ++i){

116 
šdex
 = 
šdexes
[
i
];

117 
	`´štf
("%.1f%%: %s\n", 
´ediùiÚs
[
šdex
]*100, 
Çmes
[index]);

119 if(
r
.
d©a
 !ğ
im
.d©aè
	`ä“_image
(r);

120 
	`ä“_image
(
im
);

121 ià(
f’ame
) ;

123 
	}
}

126 
	$run_g
(
¬gc
, **
¬gv
)

128 if(
¬gc
 < 4){

129 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

133 
ş—r
 = 
	`fšd_¬g
(
¬gc
, 
¬gv
, "-clear");

134 *
cfg
 = 
¬gv
[3];

135 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

136 *
f’ame
 = (
¬gc
 > 5è? 
¬gv
[5] : 0;

137 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_g
(
cfg
, 
weights
, 
ş—r
);

138 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_g
(
cfg
, 
weights
, 
f’ame
);

139 
	}
}

	@host/examples/yolo.c

1 
	~"d¬kÃt.h
"

3 *
	gvoc_Çmes
[] = {"aeroplane", "bicycle", "bird", "boat", "bottle", "bus", "car", "cat", "chair", "cow", "diningtable", "dog", "horse", "motorbike", "person", "pottedplant", "sheep", "sofa", "train", "tvmonitor"};

5 
	$Œaš_yŞo
(*
cfgfe
, *
weightfe
)

7 *
Œaš_images
 = "/data/voc/train.txt";

8 *
backup_dœeùÜy
 = "/home/pjreddie/backup/";

9 
	`¤ªd
(
	`time
(0));

10 *
ba£
 = 
	`ba£cfg
(
cfgfe
);

11 
	`´štf
("%s\n", 
ba£
);

12 
avg_loss
 = -1;

13 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

14 
	`´štf
("L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

15 
imgs
 = 
Ãt
->
b©ch
*Ãt->
subdivisiÚs
;

16 
i
 = *
Ãt
->
£’
/
imgs
;

17 
d©a
 
Œaš
, 
bufãr
;

20 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 1];

22 
side
 = 
l
.side;

23 
şas£s
 = 
l
.classes;

24 
j™‹r
 = 
l
.jitter;

26 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
Œaš_images
);

28 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

30 
lßd_¬gs
 
¬gs
 = {0};

31 
¬gs
.
w
 = 
Ãt
->w;

32 
¬gs
.
h
 = 
Ãt
->h;

33 
¬gs
.
·ths
 =…aths;

34 
¬gs
.
n
 = 
imgs
;

35 
¬gs
.
m
 = 
¶i¡
->
size
;

36 
¬gs
.
şas£s
 = classes;

37 
¬gs
.
j™‹r
 = jitter;

38 
¬gs
.
num_boxes
 = 
side
;

39 
¬gs
.
d
 = &
bufãr
;

40 
¬gs
.
ty³
 = 
REGION_DATA
;

42 
¬gs
.
ªgË
 = 
Ãt
->angle;

43 
¬gs
.
exposu»
 = 
Ãt
->exposure;

44 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

45 
¬gs
.
hue
 = 
Ãt
->hue;

47 
±h»ad_t
 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

48 
şock_t
 
time
;

50 
	`g‘_cu¼’t_b©ch
(
Ãt
è<‚‘->
max_b©ches
){

51 
i
 += 1;

52 
time
=
	`şock
();

53 
	`±h»ad_još
(
lßd_th»ad
, 0);

54 
Œaš
 = 
bufãr
;

55 
lßd_th»ad
 = 
	`lßd_d©a_š_th»ad
(
¬gs
);

57 
	`´štf
("Lßded: %là£cÚds\n", 
	`£c
(
	`şock
()-
time
));

59 
time
=
	`şock
();

60 
loss
 = 
	`Œaš_ÃtwÜk
(
Ãt
, 
Œaš
);

61 ià(
avg_loss
 < 0èavg_los ğ
loss
;

62 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

64 
	`´štf
("%d: %f, %àavg, %à¿‹, %là£cÚds, %d images\n", 
i
, 
loss
, 
avg_loss
, 
	`g‘_cu¼’t_¿‹
(
Ãt
), 
	`£c
(
	`şock
()-
time
), i*
imgs
);

65 if(
i
%1000==0 || (i < 1000 && i%100 == 0)){

66 
buff
[256];

67 
	`¥rštf
(
buff
, "%s/%s_%d.weights", 
backup_dœeùÜy
, 
ba£
, 
i
);

68 
	`§ve_weights
(
Ãt
, 
buff
);

70 
	`ä“_d©a
(
Œaš
);

72 
buff
[256];

73 
	`¥rštf
(
buff
, "%s/%s_fš®.weights", 
backup_dœeùÜy
, 
ba£
);

74 
	`§ve_weights
(
Ãt
, 
buff
);

75 
	}
}

77 
	$´št_yŞo_d‘eùiÚs
(
FILE
 **
ås
, *
id
, 
tÙ®
, 
şas£s
, 
w
, 
h
, 
d‘eùiÚ
 *
d‘s
)

79 
i
, 
j
;

80 
i
 = 0; i < 
tÙ®
; ++i){

81 
xmš
 = 
d‘s
[
i
].
bbox
.
x
 - d‘s[i].bbox.
w
/2.;

82 
xmax
 = 
d‘s
[
i
].
bbox
.
x
 + d‘s[i].bbox.
w
/2.;

83 
ymš
 = 
d‘s
[
i
].
bbox
.
y
 - d‘s[i].bbox.
h
/2.;

84 
ymax
 = 
d‘s
[
i
].
bbox
.
y
 + d‘s[i].bbox.
h
/2.;

86 ià(
xmš
 < 0) xmin = 0;

87 ià(
ymš
 < 0) ymin = 0;

88 ià(
xmax
 > 
w
) xmax = w;

89 ià(
ymax
 > 
h
) ymax = h;

91 
j
 = 0; j < 
şas£s
; ++j){

92 ià(
d‘s
[
i
].
´ob
[
j
]è
	`årštf
(
ås
[j], "% %à%à%à%à%f\n", 
id
, dets[i].prob[j],

93 
xmš
, 
ymš
, 
xmax
, 
ymax
);

96 
	}
}

98 
	$v®id©e_yŞo
(*
cfg
, *
weights
)

100 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

101 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

102 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

103 
	`¤ªd
(
	`time
(0));

105 *
ba£
 = "results/comp4_det_test_";

107 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("/home/pjreddie/data/voc/2007_test.txt");

109 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

111 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

112 
şas£s
 = 
l
.classes;

114 
j
;

115 
FILE
 **
ås
 = 
	`ÿÎoc
(
şas£s
, (FILE *));

116 
j
 = 0; j < 
şas£s
; ++j){

117 
buff
[1024];

118 
	`¢´štf
(
buff
, 1024, "%s%s.txt", 
ba£
, 
voc_Çmes
[
j
]);

119 
ås
[
j
] = 
	`fİ’
(
buff
, "w");

122 
m
 = 
¶i¡
->
size
;

123 
i
=0;

124 
t
;

126 
th»sh
 = .001;

127 
nms
 = 1;

128 
iou_th»sh
 = .5;

130 
Áh»ads
 = 8;

131 
image
 *
v®
 = 
	`ÿÎoc
(
Áh»ads
, (image));

132 
image
 *
v®_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

133 
image
 *
buf
 = 
	`ÿÎoc
(
Áh»ads
, (image));

134 
image
 *
buf_»sized
 = 
	`ÿÎoc
(
Áh»ads
, (image));

135 
±h»ad_t
 *
thr
 = 
	`ÿÎoc
(
Áh»ads
, (pthread_t));

137 
lßd_¬gs
 
¬gs
 = {0};

138 
¬gs
.
w
 = 
Ãt
->w;

139 
¬gs
.
h
 = 
Ãt
->h;

140 
¬gs
.
ty³
 = 
IMAGE_DATA
;

142 
t
 = 0; < 
Áh»ads
; ++t){

143 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

144 
¬gs
.
im
 = &
buf
[
t
];

145 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

146 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

148 
time_t
 
¡¬t
 = 
	`time
(0);

149 
i
 = 
Áh»ads
; i < 
m
+nthreads; i +=‚threads){

150 
	`årštf
(
¡d”r
, "%d\n", 
i
);

151 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

152 
	`±h»ad_još
(
thr
[
t
], 0);

153 
v®
[
t
] = 
buf
[t];

154 
v®_»sized
[
t
] = 
buf_»sized
[t];

156 
t
 = 0; < 
Áh»ads
 && 
i
+ˆ< 
m
; ++t){

157 
¬gs
.
·th
 = 
·ths
[
i
+
t
];

158 
¬gs
.
im
 = &
buf
[
t
];

159 
¬gs
.
»sized
 = &
buf_»sized
[
t
];

160 
thr
[
t
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

162 
t
 = 0; < 
Áh»ads
 && 
i
+t-Áh»ad < 
m
; ++t){

163 *
·th
 = 
·ths
[
i
+
t
-
Áh»ads
];

164 *
id
 = 
	`ba£cfg
(
·th
);

165 *
X
 = 
v®_»sized
[
t
].
d©a
;

166 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

167 
w
 = 
v®
[
t
].w;

168 
h
 = 
v®
[
t
].h;

169 
nboxes
 = 0;

170 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
w
, 
h
, 
th»sh
, 0, 0, 0, &
nboxes
);

171 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
l
.
side
*l.side*l.
n
, 
şas£s
, 
iou_th»sh
);

172 
	`´št_yŞo_d‘eùiÚs
(
ås
, 
id
, 
l
.
side
*l.side*l.
n
, 
şas£s
, 
w
, 
h
, 
d‘s
);

173 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

174 
	`ä“
(
id
);

175 
	`ä“_image
(
v®
[
t
]);

176 
	`ä“_image
(
v®_»sized
[
t
]);

179 
	`årštf
(
¡d”r
, "TÙ® D‘eùiÚ Time: %àSecÚds\n", ()(
	`time
(0è- 
¡¬t
));

180 
	}
}

182 
	$v®id©e_yŞo_»ÿÎ
(*
cfg
, *
weights
)

184 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfg
, 
weights
, 0);

185 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

186 
	`årštf
(
¡d”r
, "L—ºšg R©e: %g, Mom’tum: %g, Deÿy: %g\n", 
Ãt
->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
);

187 
	`¤ªd
(
	`time
(0));

189 *
ba£
 = "results/comp4_det_test_";

190 
li¡
 *
¶i¡
 = 
	`g‘_·ths
("data/voc.2007.test");

191 **
·ths
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

193 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

194 
şas£s
 = 
l
.classes;

195 
side
 = 
l
.side;

197 
j
, 
k
;

198 
FILE
 **
ås
 = 
	`ÿÎoc
(
şas£s
, (FILE *));

199 
j
 = 0; j < 
şas£s
; ++j){

200 
buff
[1024];

201 
	`¢´štf
(
buff
, 1024, "%s%s.txt", 
ba£
, 
voc_Çmes
[
j
]);

202 
ås
[
j
] = 
	`fİ’
(
buff
, "w");

205 
m
 = 
¶i¡
->
size
;

206 
i
=0;

208 
th»sh
 = .001;

209 
iou_th»sh
 = .5;

210 
nms
 = 0;

212 
tÙ®
 = 0;

213 
cÜ»ù
 = 0;

214 
´İo§ls
 = 0;

215 
avg_iou
 = 0;

217 
i
 = 0; i < 
m
; ++i){

218 *
·th
 = 
·ths
[
i
];

219 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
·th
, 0, 0);

220 
image
 
sized
 = 
	`»size_image
(
Üig
, 
Ãt
->
w
,‚‘->
h
);

221 *
id
 = 
	`ba£cfg
(
·th
);

222 
	`ÃtwÜk_´ediù
(
Ãt
, 
sized
.
d©a
);

224 
nboxes
 = 0;

225 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
Üig
.
w
, orig.
h
, 
th»sh
, 0, 0, 1, &
nboxes
);

226 ià(
nms
è
	`do_nms_obj
(
d‘s
, 
side
*side*
l
.
n
, 1,‚ms);

228 
Ïb–·th
[4096];

229 
	`fšd_»¶aû
(
·th
, "images", "Ïb–s", 
Ïb–·th
);

230 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

231 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

232 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

234 
num_Ïb–s
 = 0;

235 
box_Ïb–
 *
Œuth
 = 
	`»ad_boxes
(
Ïb–·th
, &
num_Ïb–s
);

236 
k
 = 0; k < 
side
*side*
l
.
n
; ++k){

237 if(
d‘s
[
k
].
objeùÃss
 > 
th»sh
){

238 ++
´İo§ls
;

241 
j
 = 0; j < 
num_Ïb–s
; ++j) {

242 ++
tÙ®
;

243 
box
 
t
 = {
Œuth
[
j
].
x
,ruth[j].
y
,ruth[j].
w
,ruth[j].
h
};

244 
be¡_iou
 = 0;

245 
k
 = 0; k < 
side
*side*
l
.
n
; ++k){

246 
iou
 = 
	`box_iou
(
d‘s
[
k
].
bbox
, 
t
);

247 if(
d‘s
[
k
].
objeùÃss
 > 
th»sh
 && 
iou
 > 
be¡_iou
){

248 
be¡_iou
 = 
iou
;

251 
avg_iou
 +ğ
be¡_iou
;

252 if(
be¡_iou
 > 
iou_th»sh
){

253 ++
cÜ»ù
;

257 
	`årštf
(
¡d”r
, "%5d %5d %5d\tRPs/Img: %.2f\tIOU: %.2f%%\tReÿÎ:%.2f%%\n", 
i
, 
cÜ»ù
, 
tÙ®
, ()
´İo§ls
/(i+1), 
avg_iou
*100/total, 100.*correct/total);

258 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

259 
	`ä“
(
id
);

260 
	`ä“_image
(
Üig
);

261 
	`ä“_image
(
sized
);

263 
	}
}

265 
	$‹¡_yŞo
(*
cfgfe
, *
weightfe
, *
f’ame
, 
th»sh
)

267 
image
 **
®phab‘
 = 
	`lßd_®phab‘
();

268 
ÃtwÜk
 *
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

269 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

270 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

271 
	`¤ªd
(2222222);

272 
şock_t
 
time
;

273 
buff
[256];

274 *
šput
 = 
buff
;

275 
nms
=.4;

277 if(
f’ame
){

278 
	`¡ºıy
(
šput
, 
f’ame
, 256);

280 
	`´štf
("Enter Image Path: ");

281 
	`fæush
(
¡dout
);

282 
šput
 = 
	`fg‘s
(šput, 256, 
¡dš
);

283 if(!
šput
) ;

284 
	`¡¹ok
(
šput
, "\n");

286 
image
 
im
 = 
	`lßd_image_cŞÜ
(
šput
,0,0);

287 
image
 
sized
 = 
	`»size_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

288 *
X
 = 
sized
.
d©a
;

289 
time
=
	`şock
();

290 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

291 
	`´štf
("%s: P»diùed iÀ%à£cÚds.\n", 
šput
, 
	`£c
(
	`şock
()-
time
));

293 
nboxes
 = 0;

294 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 1, 1, 
th»sh
, 0, 0, 0, &
nboxes
);

295 ià(
nms
è
	`do_nms_sÜt
(
d‘s
, 
l
.
side
*l.side*l.
n
,†.
şas£s
,‚ms);

297 
	`d¿w_d‘eùiÚs
(
im
, 
d‘s
, 
l
.
side
*l.side*l.
n
, 
th»sh
, 
voc_Çmes
, 
®phab‘
, 20);

298 
	`§ve_image
(
im
, "predictions");

299 
	`show_image
(
im
, "predictions", 0);

300 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

301 
	`ä“_image
(
im
);

302 
	`ä“_image
(
sized
);

303 ià(
f’ame
) ;

305 
	}
}

307 
	$run_yŞo
(
¬gc
, **
¬gv
)

309 *
´efix
 = 
	`fšd_ch¬_¬g
(
¬gc
, 
¬gv
, "-prefix", 0);

310 
th»sh
 = 
	`fšd_æßt_¬g
(
¬gc
, 
¬gv
, "-thresh", .2);

311 
ÿm_šdex
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-c", 0);

312 
äame_sk
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-s", 0);

313 if(
¬gc
 < 4){

314 
	`årštf
(
¡d”r
, "u§ge: % % [Œaš/‹¡/v®id] [cfg] [weight (İtiÚ®)]\n", 
¬gv
[0],‡rgv[1]);

318 
avg
 = 
	`fšd_št_¬g
(
¬gc
, 
¬gv
, "-avg", 1);

319 *
cfg
 = 
¬gv
[3];

320 *
weights
 = (
¬gc
 > 4è? 
¬gv
[4] : 0;

321 *
f’ame
 = (
¬gc
 > 5è? 
¬gv
[5]: 0;

322 if(0==
	`¡rcmp
(
¬gv
[2], "‹¡")è
	`‹¡_yŞo
(
cfg
, 
weights
, 
f’ame
, 
th»sh
);

323 if(0==
	`¡rcmp
(
¬gv
[2], "Œaš")è
	`Œaš_yŞo
(
cfg
, 
weights
);

324 if(0==
	`¡rcmp
(
¬gv
[2], "v®id")è
	`v®id©e_yŞo
(
cfg
, 
weights
);

325 if(0==
	`¡rcmp
(
¬gv
[2], "»ÿÎ")è
	`v®id©e_yŞo_»ÿÎ
(
cfg
, 
weights
);

326 if(0==
	`¡rcmp
(
¬gv
[2], "demo")è
	`demo
(
cfg
, 
weights
, 
th»sh
, 
ÿm_šdex
, 
f’ame
, 
voc_Çmes
, 20, 
äame_sk
, 
´efix
, 
avg
, .5, 0,0,0,0);

327 
	}
}

	@host/include/darknet.h

1 #iâdeà
DARKNET_API


2 
	#DARKNET_API


	)

3 
	~<¡dlib.h
>

4 
	~<¡dio.h
>

5 
	~<¡ršg.h
>

6 
	~<±h»ad.h
>

8 #ifdeà
GPU


9 
	#BLOCK
 512

	)

11 
	~"cuda_ruÁime.h
"

12 
	~"cu¿nd.h
"

13 
	~"cubÏs_v2.h
"

15 #ifdeà
CUDNN


16 
	~"cudÂ.h
"

20 #ifdeà
__ılu¥lus


24 
	#SECRET_NUM
 -1234

	)

25 
gpu_šdex
;

26 *
Ãt_»suÉ_back
;

29 
	gşas£s
;

30 **
	gÇmes
;

31 } 
	tm‘ad©a
;

33 
m‘ad©a
 
g‘_m‘ad©a
(*
fe
);

36 *
	gËaf
;

37 
	gn
;

38 *
	g·»Á
;

39 *
	gchd
;

40 *
	ggroup
;

41 **
	gÇme
;

43 
	ggroups
;

44 *
	ggroup_size
;

45 *
	ggroup_off£t
;

46 } 
	tŒ“
;

47 
Œ“
 *
»ad_Œ“
(*
f’ame
);

50 
	gLOGISTIC
, 
	gRELU
, 
	gRELIE
, 
	gLINEAR
, 
	gRAMP
, 
	gTANH
, 
	gPLSE
, 
	gLEAKY
, 
	gELU
, 
	gLOGGY
, 
	gSTAIR
, 
	gHARDTAN
, 
	gLHTAN
, 
	gSELU


51 } 
	tACTIVATION
;

54 
	gPNG
, 
	gBMP
, 
	gTGA
, 
	gJPG


55 } 
	tIMTYPE
;

58 
	gMULT
, 
	gADD
, 
	gSUB
, 
	gDIV


59 } 
	tBINARY_ACTIVATION
;

62 
	gCONVOLUTIONAL
,

63 
	gDECONVOLUTIONAL
,

64 
	gCONNECTED
,

65 
	gMAXPOOL
,

66 
	gSOFTMAX
,

67 
	gDETECTION
,

68 
	gDROPOUT
,

69 
	gCROP
,

70 
	gROUTE
,

71 
	gCOST
,

72 
	gNORMALIZATION
,

73 
	gAVGPOOL
,

74 
	gLOCAL
,

75 
	gSHORTCUT
,

76 
	gACTIVE
,

77 
	gRNN
,

78 
	gGRU
,

79 
	gLSTM
,

80 
	gCRNN
,

81 
	gBATCHNORM
,

82 
	gNETWORK
,

83 
	gXNOR
,

84 
	gREGION
,

85 
	gYOLO
,

86 
	gISEG
,

87 
	gREORG
,

88 
	gUPSAMPLE
,

89 
	gLOGXENT
,

90 
	gL2NORM
,

91 
	gBLANK


92 } 
	tLAYER_TYPE
;

95 
	gSSE
, 
	gMASKED
, 
	gL1
, 
	gSEG
, 
	gSMOOTH
,
	gWGAN


96 } 
	tCOST_TYPE
;

99 
	gb©ch
;

100 
	gË¬nšg_¿‹
;

101 
	gmom’tum
;

102 
	gdeÿy
;

103 
	gadam
;

104 
	gB1
;

105 
	gB2
;

106 
	g•s
;

107 
	gt
;

108 } 
	tupd©e_¬gs
;

110 
	gÃtwÜk
;

111 
ÃtwÜk
 
	tÃtwÜk
;

113 
	gÏy”
;

114 
Ïy”
 
	tÏy”
;

115 
	sÏy”
{

116 
LAYER_TYPE
 
	gty³
;

117 
ACTIVATION
 
	gaùiv©iÚ
;

118 
COST_TYPE
 
	gco¡_ty³
;

120 (*
	gfÜw¬d
è(
	gÏy”
, 
	gÃtwÜk
);

121 (*
	gbackw¬d
è(
	gÏy”
, 
	gÃtwÜk
);

122 (*
	gupd©e
è(
	gÏy”
, 
	gupd©e_¬gs
);

123 (*
	gfÜw¬d_gpu
è(
	gÏy”
, 
	gÃtwÜk
);

124 (*
	gbackw¬d_gpu
è(
	gÏy”
, 
	gÃtwÜk
);

125 (*
	gupd©e_gpu
è(
	gÏy”
, 
	gupd©e_¬gs
);

127 (*
	gfÜw¬d_TA
è(
	gÏy”
, * 
	gÃt_šput
, 
	gÃt_Œaš
);

128 (*
	gbackw¬d_TA
è(
	gÏy”
, 
	gÃtwÜk
);

129 (*
	gupd©e_TA
è(
	gÏy”
, 
	gupd©e_¬gs
);

131 
	gb©ch_nÜm®ize
;

132 
	gshÜtcut
;

133 
	gb©ch
;

134 
	gfÜûd
;

135 
	gæ³d
;

136 
	gšputs
;

137 
	gouuts
;

138 
	gnweights
;

139 
	gnbŸ£s
;

140 
	gexŒa
;

141 
	gŒuths
;

142 
	gh
,
	gw
,
	gc
;

143 
	gout_h
, 
	gout_w
, 
	gout_c
;

144 
	gn
;

145 
	gmax_boxes
;

146 
	ggroups
;

147 
	gsize
;

148 
	gside
;

149 
	g¡ride
;

150 
	g»v”£
;

151 
	gæ©‹n
;

152 
	g¥©Ÿl
;

153 
	g·d
;

154 
	gsq¹
;

155 
	gæ
;

156 
	gšdex
;

157 
	gbš¬y
;

158 
	gxnÜ
;

159 
	g¡•s
;

160 
	ghidd’
;

161 
	gŒuth
;

162 
	gsmoÙh
;

163 
	gdÙ
;

164 
	gªgË
;

165 
	gj™‹r
;

166 
	g§tu¿tiÚ
;

167 
	gexposu»
;

168 
	gshiá
;

169 
	g¿tio
;

170 
	gË¬nšg_¿‹_sÿË
;

171 
	gş
;

172 
	gnŞoss
;

173 
	gsoámax
;

174 
	gşas£s
;

175 
	gcoÜds
;

176 
	gbackground
;

177 
	g»scÜe
;

178 
	gobjeùÃss
;

179 
	gjošt
;

180 
	gnßdju¡
;

181 
	g»Üg
;

182 
	glog
;

183 
	gnh
;

184 *
	gmask
;

185 
	gtÙ®
;

187 
	g®pha
;

188 
	gb‘a
;

189 
	gk­·
;

191 
	gcoÜd_sÿË
;

192 
	gobjeù_sÿË
;

193 
	gnoobjeù_sÿË
;

194 
	gmask_sÿË
;

195 
	gşass_sÿË
;

196 
	gbŸs_m©ch
;

197 
	g¿ndom
;

198 
	gignÜe_th»sh
;

199 
	gŒuth_th»sh
;

200 
	gth»sh
;

201 
	gfocus
;

202 
	gşassfix
;

203 
	gabsŞu‹
;

205 
	gÚlyfÜw¬d
;

206 
	g¡İbackw¬d
;

207 
	gdÚßd
;

208 
	gdÚt§ve
;

209 
	gdÚßdsÿËs
;

210 
	gnumlßd
;

212 
	g‹m³¿tu»
;

213 
	g´obab™y
;

214 
	gsÿË
;

216 * 
	gcweights
;

217 * 
	gšdexes
;

218 * 
	gšput_Ïy”s
;

219 * 
	gšput_sizes
;

220 * 
	gm­
;

221 * 
	gcouÁs
;

222 ** 
	gsums
;

223 * 
	g¿nd
;

224 * 
	gco¡
;

225 * 
	g¡©e
;

226 * 
	g´ev_¡©e
;

227 * 
	gfÜgÙ_¡©e
;

228 * 
	gfÜgÙ_d–
;

229 * 
	g¡©e_d–
;

230 * 
	gcombše_ıu
;

231 * 
	gcombše_d–_ıu
;

233 * 
	gcÚÿt
;

234 * 
	gcÚÿt_d–
;

236 * 
	gbš¬y_weights
;

238 * 
	gbŸ£s
;

239 * 
	gbŸs_upd©es
;

241 * 
	gsÿËs
;

242 * 
	gsÿË_upd©es
;

244 * 
	gweights
;

245 * 
	gweight_upd©es
;

247 * 
	gd–
;

248 * 
	gouut
;

249 * 
	gloss
;

250 * 
	gsqu¬ed
;

251 * 
	gnÜms
;

253 * 
	g¥©Ÿl_m—n
;

254 * 
	gm—n
;

255 * 
	gv¬Ÿnû
;

257 * 
	gm—n_d–
;

258 * 
	gv¬Ÿnû_d–
;

260 * 
	grŞlšg_m—n
;

261 * 
	grŞlšg_v¬Ÿnû
;

263 * 
	gx
;

264 * 
	gx_nÜm
;

266 * 
	gm
;

267 * 
	gv
;

269 * 
	gbŸs_m
;

270 * 
	gbŸs_v
;

271 * 
	gsÿË_m
;

272 * 
	gsÿË_v
;

275 *
	gz_ıu
;

276 *
	gr_ıu
;

277 *
	gh_ıu
;

278 * 
	g´ev_¡©e_ıu
;

280 *
	g‹mp_ıu
;

281 *
	g‹mp2_ıu
;

282 *
	g‹mp3_ıu
;

284 *
	gdh_ıu
;

285 *
	ghh_ıu
;

286 *
	g´ev_ûÎ_ıu
;

287 *
	gûÎ_ıu
;

288 *
	gf_ıu
;

289 *
	gi_ıu
;

290 *
	gg_ıu
;

291 *
	go_ıu
;

292 *
	gc_ıu
;

293 *
	gdc_ıu
;

295 * 
	gbš¬y_šput
;

297 
Ïy”
 *
	gšput_Ïy”
;

298 
Ïy”
 *
	g£lf_Ïy”
;

299 
Ïy”
 *
	gouut_Ïy”
;

301 
Ïy”
 *
	g»£t_Ïy”
;

302 
Ïy”
 *
	gupd©e_Ïy”
;

303 
Ïy”
 *
	g¡©e_Ïy”
;

305 
Ïy”
 *
	gšput_g©e_Ïy”
;

306 
Ïy”
 *
	g¡©e_g©e_Ïy”
;

307 
Ïy”
 *
	gšput_§ve_Ïy”
;

308 
Ïy”
 *
	g¡©e_§ve_Ïy”
;

309 
Ïy”
 *
	gšput_¡©e_Ïy”
;

310 
Ïy”
 *
	g¡©e_¡©e_Ïy”
;

312 
Ïy”
 *
	gšput_z_Ïy”
;

313 
Ïy”
 *
	g¡©e_z_Ïy”
;

315 
Ïy”
 *
	gšput_r_Ïy”
;

316 
Ïy”
 *
	g¡©e_r_Ïy”
;

318 
Ïy”
 *
	gšput_h_Ïy”
;

319 
Ïy”
 *
	g¡©e_h_Ïy”
;

321 
Ïy”
 *
	gwz
;

322 
Ïy”
 *
	guz
;

323 
Ïy”
 *
	gwr
;

324 
Ïy”
 *
	gur
;

325 
Ïy”
 *
	gwh
;

326 
Ïy”
 *
	guh
;

327 
Ïy”
 *
	guo
;

328 
Ïy”
 *
	gwo
;

329 
Ïy”
 *
	guf
;

330 
Ïy”
 *
	gwf
;

331 
Ïy”
 *
	gui
;

332 
Ïy”
 *
	gwi
;

333 
Ïy”
 *
	gug
;

334 
Ïy”
 *
	gwg
;

336 
Œ“
 *
	gsoámax_Œ“
;

338 
size_t
 
	gwÜk¥aû_size
;

340 #ifdeà
GPU


341 *
	gšdexes_gpu
;

343 *
	gz_gpu
;

344 *
	gr_gpu
;

345 *
	gh_gpu
;

347 *
	g‹mp_gpu
;

348 *
	g‹mp2_gpu
;

349 *
	g‹mp3_gpu
;

351 *
	gdh_gpu
;

352 *
	ghh_gpu
;

353 *
	g´ev_ûÎ_gpu
;

354 *
	gûÎ_gpu
;

355 *
	gf_gpu
;

356 *
	gi_gpu
;

357 *
	gg_gpu
;

358 *
	go_gpu
;

359 *
	gc_gpu
;

360 *
	gdc_gpu
;

362 *
	gm_gpu
;

363 *
	gv_gpu
;

364 *
	gbŸs_m_gpu
;

365 *
	gsÿË_m_gpu
;

366 *
	gbŸs_v_gpu
;

367 *
	gsÿË_v_gpu
;

369 * 
	gcombše_gpu
;

370 * 
	gcombše_d–_gpu
;

372 * 
	g´ev_¡©e_gpu
;

373 * 
	gfÜgÙ_¡©e_gpu
;

374 * 
	gfÜgÙ_d–_gpu
;

375 * 
	g¡©e_gpu
;

376 * 
	g¡©e_d–_gpu
;

377 * 
	gg©e_gpu
;

378 * 
	gg©e_d–_gpu
;

379 * 
	g§ve_gpu
;

380 * 
	g§ve_d–_gpu
;

381 * 
	gcÚÿt_gpu
;

382 * 
	gcÚÿt_d–_gpu
;

384 * 
	gbš¬y_šput_gpu
;

385 * 
	gbš¬y_weights_gpu
;

387 * 
	gm—n_gpu
;

388 * 
	gv¬Ÿnû_gpu
;

390 * 
	grŞlšg_m—n_gpu
;

391 * 
	grŞlšg_v¬Ÿnû_gpu
;

393 * 
	gv¬Ÿnû_d–_gpu
;

394 * 
	gm—n_d–_gpu
;

396 * 
	gx_gpu
;

397 * 
	gx_nÜm_gpu
;

398 * 
	gweights_gpu
;

399 * 
	gweight_upd©es_gpu
;

400 * 
	gweight_chªge_gpu
;

402 * 
	gbŸ£s_gpu
;

403 * 
	gbŸs_upd©es_gpu
;

404 * 
	gbŸs_chªge_gpu
;

406 * 
	gsÿËs_gpu
;

407 * 
	gsÿË_upd©es_gpu
;

408 * 
	gsÿË_chªge_gpu
;

410 * 
	gouut_gpu
;

411 * 
	gloss_gpu
;

412 * 
	gd–_gpu
;

413 * 
	g¿nd_gpu
;

414 * 
	gsqu¬ed_gpu
;

415 * 
	gnÜms_gpu
;

416 #ifdeà
CUDNN


417 
cudÂT’sÜDesütÜ_t
 
	g¤cT’sÜDesc
, 
	gd¡T’sÜDesc
;

418 
cudÂT’sÜDesütÜ_t
 
	gd¤cT’sÜDesc
, 
	gdd¡T’sÜDesc
;

419 
cudÂT’sÜDesütÜ_t
 
	gnÜmT’sÜDesc
;

420 
cudÂF‹rDesütÜ_t
 
	gweightDesc
;

421 
cudÂF‹rDesütÜ_t
 
	gdweightDesc
;

422 
cudÂCÚvŞutiÚDesütÜ_t
 
	gcÚvDesc
;

423 
cudÂCÚvŞutiÚFwdAlgo_t
 
	gfw_®go
;

424 
cudÂCÚvŞutiÚBwdD©aAlgo_t
 
	gbd_®go
;

425 
cudÂCÚvŞutiÚBwdF‹rAlgo_t
 
	gbf_®go
;

431 
ä“_Ïy”
(
Ïy”
);

434 
	gCONSTANT
, 
	gSTEP
, 
	gEXP
, 
	gPOLY
, 
	gSTEPS
, 
	gSIG
, 
	gRANDOM


435 } 
	tË¬nšg_¿‹_pŞicy
;

437 
	sÃtwÜk
{

438 
	gn
;

439 
	gb©ch
;

440 
size_t
 *
	g£’
;

441 *
	gt
;

442 
	g•och
;

443 
	gsubdivisiÚs
;

444 
Ïy”
 *
	gÏy”s
;

445 *
	gouut
;

446 
Ë¬nšg_¿‹_pŞicy
 
	gpŞicy
;

448 
	gË¬nšg_¿‹
;

449 
	gmom’tum
;

450 
	gdeÿy
;

451 
	ggamma
;

452 
	gsÿË
;

453 
	gpow”
;

454 
	gtime_¡•s
;

455 
	g¡•
;

456 
	gmax_b©ches
;

457 *
	gsÿËs
;

458 *
	g¡•s
;

459 
	gnum_¡•s
;

460 
	gbuº_š
;

462 
	gadam
;

463 
	gB1
;

464 
	gB2
;

465 
	g•s
;

467 
	gšputs
;

468 
	gouuts
;

469 
	gŒuths
;

470 
	gnÙruth
;

471 
	gh
, 
	gw
, 
	gc
;

472 
	gmax_üİ
;

473 
	gmš_üİ
;

474 
	gmax_¿tio
;

475 
	gmš_¿tio
;

476 
	gûÁ”
;

477 
	gªgË
;

478 
	ga¥eù
;

479 
	gexposu»
;

480 
	g§tu¿tiÚ
;

481 
	ghue
;

482 
	g¿ndom
;

484 
	ggpu_šdex
;

485 
Œ“
 *
	gh›¿rchy
;

487 *
	gšput
;

488 *
	gŒuth
;

489 *
	gd–
;

490 *
	gwÜk¥aû
;

491 
	gŒaš
;

492 
	gšdex
;

493 *
	gco¡
;

494 
	gş
;

496 #ifdeà
GPU


497 *
	gšput_gpu
;

498 *
	gŒuth_gpu
;

499 *
	gd–_gpu
;

500 *
	gouut_gpu
;

503 } 
	tÃtwÜk
;

506 
	gw
;

507 
	gh
;

508 
	gsÿË
;

509 
	g¿d
;

510 
	gdx
;

511 
	gdy
;

512 
	ga¥eù
;

513 } 
	taugm’t_¬gs
;

516 
	gw
;

517 
	gh
;

518 
	gc
;

519 *
	gd©a
;

520 } 
	timage
;

523 
	gx
, 
	gy
, 
	gw
, 
	gh
;

524 } 
	tbox
;

526 
	sd‘eùiÚ
{

527 
box
 
	gbbox
;

528 
	gşas£s
;

529 *
	g´ob
;

530 *
	gmask
;

531 
	gobjeùÃss
;

532 
	gsÜt_şass
;

533 } 
	td‘eùiÚ
;

535 
	sm©rix
{

536 
	grows
, 
	gcŞs
;

537 **
	gv®s
;

538 } 
	tm©rix
;

542 
	gw
, 
	gh
;

543 
m©rix
 
	gX
;

544 
m©rix
 
	gy
;

545 
	gsh®low
;

546 *
	gnum_boxes
;

547 
box
 **
	gboxes
;

548 } 
	td©a
;

551 
	gCLASSIFICATION_DATA
, 
	gDETECTION_DATA
, 
	gCAPTCHA_DATA
, 
	gREGION_DATA
, 
	gIMAGE_DATA
, 
	gCOMPARE_DATA
, 
	gWRITING_DATA
, 
	gSWAG_DATA
, 
	gTAG_DATA
, 
	gOLD_CLASSIFICATION_DATA
, 
	gSTUDY_DATA
, 
	gDET_DATA
, 
	gSUPER_DATA
, 
	gLETTERBOX_DATA
, 
	gREGRESSION_DATA
, 
	gSEGMENTATION_DATA
, 
	gINSTANCE_DATA
, 
	gISEG_DATA


552 } 
	td©a_ty³
;

554 
	slßd_¬gs
{

555 
	gth»ads
;

556 **
	g·ths
;

557 *
	g·th
;

558 
	gn
;

559 
	gm
;

560 **
	gÏb–s
;

561 
	gh
;

562 
	gw
;

563 
	gout_w
;

564 
	gout_h
;

565 
	gnh
;

566 
	gnw
;

567 
	gnum_boxes
;

568 
	gmš
, 
	gmax
, 
	gsize
;

569 
	gşas£s
;

570 
	gbackground
;

571 
	gsÿË
;

572 
	gûÁ”
;

573 
	gcoÜds
;

574 
	gj™‹r
;

575 
	gªgË
;

576 
	ga¥eù
;

577 
	g§tu¿tiÚ
;

578 
	gexposu»
;

579 
	ghue
;

580 
d©a
 *
	gd
;

581 
image
 *
	gim
;

582 
image
 *
	g»sized
;

583 
d©a_ty³
 
	gty³
;

584 
Œ“
 *
	gh›¿rchy
;

585 } 
	tlßd_¬gs
;

588 
	gid
;

589 
	gx
,
	gy
,
	gw
,
	gh
;

590 
	gËá
, 
	gright
, 
	gtİ
, 
	gbÙtom
;

591 } 
	tbox_Ïb–
;

594 
ÃtwÜk
 *
lßd_ÃtwÜk
(*
cfg
, *
weights
, 
ş—r
);

595 
lßd_¬gs
 
g‘_ba£_¬gs
(
ÃtwÜk
 *
Ãt
);

597 
ä“_d©a
(
d©a
 
d
);

599 
	snode
{

600 *
	gv®
;

601 
node
 *
	gÃxt
;

602 
node
 *
	g´ev
;

603 } 
	tnode
;

605 
	sli¡
{

606 
	gsize
;

607 
node
 *
	gäÚt
;

608 
node
 *
	gback
;

609 } 
	tli¡
;

611 
±h»ad_t
 
lßd_d©a
(
lßd_¬gs
 
¬gs
);

612 
li¡
 *
»ad_d©a_cfg
(*
f’ame
);

613 
li¡
 *
»ad_cfg
(*
f’ame
);

614 *
»ad_fe
(*
f’ame
);

615 
d©a
 
»size_d©a
(d©¨
Üig
, 
w
, 
h
);

616 
d©a
 *
te_d©a
(d©¨
Üig
, 
divs
, 
size
);

617 
d©a
 
£Ëù_d©a
(d©¨*
Üig
, *
šds
);

619 
fÜw¬d_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

620 
backw¬d_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

621 
upd©e_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

624 
dÙ_ıu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
);

625 
axpy_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
);

626 
cİy_ıu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
);

627 
sÿl_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
);

628 
fl_ıu
(
N
, 
ALPHA
, * 
X
, 
INCX
);

629 
nÜm®ize_ıu
(*
x
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
);

630 
soámax
(*
šput
, 
n
, 
‹mp
, 
¡ride
, *
ouut
);

632 
be¡_3d_shiá_r
(
image
 
a
, imag
b
, 
mš
, 
max
);

633 #ifdeà
GPU


634 
axpy_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
, * 
Y
, 
INCY
);

635 
fl_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
);

636 
sÿl_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
);

637 
cİy_gpu
(
N
, * 
X
, 
INCX
, * 
Y
, 
INCY
);

639 
cuda_£t_deviû
(
n
);

640 
cuda_ä“
(*
x_gpu
);

641 *
cuda_make_¬¿y
(*
x
, 
size_t
 
n
);

642 
cuda_puÎ_¬¿y
(*
x_gpu
, *
x
, 
size_t
 
n
);

643 
cuda_mag_¬¿y
(*
x_gpu
, 
size_t
 
n
);

644 
cuda_push_¬¿y
(*
x_gpu
, *
x
, 
size_t
 
n
);

646 
fÜw¬d_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ãt
);

647 
backw¬d_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ãt
);

648 
upd©e_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ãt
);

650 
Œaš_ÃtwÜks
(
ÃtwÜk
 **
Ãts
, 
n
, 
d©a
 
d
, 
š‹rv®
);

651 
sync_Ãts
(
ÃtwÜk
 **
Ãts
, 
n
, 
š‹rv®
);

652 
h¬mËss_upd©e_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ãt
);

654 
image
 
g‘_Ïb–
(imag**
ch¬aù”s
, *
¡ršg
, 
size
);

655 
d¿w_Ïb–
(
image
 
a
, 
r
, 
c
, imag
Ïb–
, cÚ¡ *
rgb
);

656 
§ve_image
(
image
 
im
, cÚ¡ *
Çme
);

657 
§ve_image_İtiÚs
(
image
 
im
, cÚ¡ *
Çme
, 
IMTYPE
 
f
, 
qu®™y
);

658 
g‘_Ãxt_b©ch
(
d©a
 
d
, 
n
, 
off£t
, *
X
, *
y
);

659 
g¿ysÿË_image_3c
(
image
 
im
);

660 
nÜm®ize_image
(
image
 
p
);

661 
m©rix_to_csv
(
m©rix
 
m
);

662 
Œaš_ÃtwÜk_sgd
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, 
n
);

663 
rgbgr_image
(
image
 
im
);

664 
d©a
 
cİy_d©a
(d©¨
d
);

665 
d©a
 
cÚÿt_d©a
(d©¨
d1
, d©¨
d2
);

666 
d©a
 
lßd_ciçr10_d©a
(*
f’ame
);

667 
m©rix_tİk_accu¿cy
(
m©rix
 
Œuth
, m©rix 
guess
, 
k
);

668 
m©rix_add_m©rix
(
m©rix
 
äom
, m©rix 
to
);

669 
sÿË_m©rix
(
m©rix
 
m
, 
sÿË
);

670 
m©rix
 
csv_to_m©rix
(*
f’ame
);

671 *
ÃtwÜk_accu¿c›s
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, 
n
);

672 
Œaš_ÃtwÜk_d©um
(
ÃtwÜk
 *
Ãt
);

673 
image
 
make_¿ndom_image
(
w
, 
h
, 
c
);

675 
d’Üm®ize_cÚÃùed_Ïy”
(
Ïy”
 
l
);

676 
d’Üm®ize_cÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
);

677 
¡©i¡ics_cÚÃùed_Ïy”
(
Ïy”
 
l
);

678 
»sÿË_weights
(
Ïy”
 
l
, 
sÿË
, 
Œªs
);

679 
rgbgr_weights
(
Ïy”
 
l
);

680 
image
 *
g‘_weights
(
Ïy”
 
l
);

682 
demo
(*
cfgfe
, *
weightfe
, 
th»sh
, 
ÿm_šdex
, cÚ¡ *
f’ame
, **
Çmes
, 
şas£s
, 
äame_sk
, *
´efix
, 
avg
, 
h›r_th»sh
, 
w
, 
h
, 
ås
, 
fuÎsü“n
);

683 
g‘_d‘eùiÚ_d‘eùiÚs
(
Ïy”
 
l
, 
w
, 
h
, 
th»sh
, 
d‘eùiÚ
 *
d‘s
);

685 *
İtiÚ_fšd_¡r
(
li¡
 *
l
, *
key
, *
def
);

686 
İtiÚ_fšd_št
(
li¡
 *
l
, *
key
, 
def
);

687 
İtiÚ_fšd_št_qu›t
(
li¡
 *
l
, *
key
, 
def
);

689 
ÃtwÜk
 *
·r£_ÃtwÜk_cfg
(*
f’ame
);

690 
§ve_weights
(
ÃtwÜk
 *
Ãt
, *
f’ame
);

691 
lßd_weights
(
ÃtwÜk
 *
Ãt
, *
f’ame
);

692 
§ve_weights_u±o
(
ÃtwÜk
 *
Ãt
, *
f’ame
, 
cutoff
);

693 
lßd_weights_u±o
(
ÃtwÜk
 *
Ãt
, *
f’ame
, 
¡¬t
, 
cutoff
);

695 
z”o_objeùÃss
(
Ïy”
 
l
);

696 
g‘_»giÚ_d‘eùiÚs
(
Ïy”
 
l
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
th»sh
, *
m­
, 
Œ“_th»sh
, 
»Ïtive
, 
d‘eùiÚ
 *
d‘s
);

697 
g‘_yŞo_d‘eùiÚs
(
Ïy”
 
l
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
th»sh
, *
m­
, 
»Ïtive
, 
d‘eùiÚ
 *
d‘s
);

698 
ä“_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

699 
£t_b©ch_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
b
);

700 
£t_‹mp_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
t
);

701 
image
 
lßd_image
(*
f’ame
, 
w
, 
h
, 
c
);

702 
image
 
lßd_image_cŞÜ
(*
f’ame
, 
w
, 
h
);

703 
image
 
make_image
(
w
, 
h
, 
c
);

704 
image
 
»size_image
(imag
im
, 
w
, 
h
);

705 
ûnsÜ_image
(
image
 
im
, 
dx
, 
dy
, 
w
, 
h
);

706 
image
 
Ë‰”box_image
(imag
im
, 
w
, 
h
);

707 
image
 
üİ_image
(imag
im
, 
dx
, 
dy
, 
w
, 
h
);

708 
image
 
ûÁ”_üİ_image
(imag
im
, 
w
, 
h
);

709 
image
 
»size_mš
(imag
im
, 
mš
);

710 
image
 
»size_max
(imag
im
, 
max
);

711 
image
 
th»shŞd_image
(imag
im
, 
th»sh
);

712 
image
 
mask_to_rgb
(imag
mask
);

713 
»size_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
);

714 
ä“_m©rix
(
m©rix
 
m
);

715 
‹¡_»size
(*
f’ame
);

716 
show_image
(
image
 
p
, cÚ¡ *
Çme
, 
ms
);

717 
image
 
cİy_image
(imag
p
);

718 
d¿w_box_width
(
image
 
a
, 
x1
, 
y1
, 
x2
, 
y2
, 
w
, 
r
, 
g
, 
b
);

719 
g‘_cu¼’t_¿‹
(
ÃtwÜk
 *
Ãt
);

720 
compos™e_3d
(*
f1
, *
f2
, *
out
, 
d–
);

721 
d©a
 
lßd_d©a_Şd
(**
·ths
, 
n
, 
m
, **
Ïb–s
, 
k
, 
w
, 
h
);

722 
size_t
 
g‘_cu¼’t_b©ch
(
ÃtwÜk
 *
Ãt
);

723 
cÚ¡¿š_image
(
image
 
im
);

724 
image
 
g‘_ÃtwÜk_image_Ïy”
(
ÃtwÜk
 *
Ãt
, 
i
);

725 
Ïy”
 
g‘_ÃtwÜk_ouut_Ïy”
(
ÃtwÜk
 *
Ãt
);

726 
tİ_´ediùiÚs
(
ÃtwÜk
 *
Ãt
, 
n
, *
šdex
);

727 
æ_image
(
image
 
a
);

728 
image
 
æßt_to_image
(
w
, 
h
, 
c
, *
d©a
);

729 
gho¡_image
(
image
 
sourû
, imag
de¡
, 
dx
, 
dy
);

730 
ÃtwÜk_accu¿cy
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
);

731 
¿ndom_di¡Üt_image
(
image
 
im
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

732 
fl_image
(
image
 
m
, 
s
);

733 
image
 
g¿ysÿË_image
(imag
im
);

734 
rÙ©e_image_cw
(
image
 
im
, 
times
);

735 
wh©_time_is_™_now
();

736 
image
 
rÙ©e_image
(imag
m
, 
¿d
);

737 
visu®ize_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

738 
box_iou
(
box
 
a
, box 
b
);

739 
d©a
 
lßd_®l_ciçr10
();

740 
box_Ïb–
 *
»ad_boxes
(*
f’ame
, *
n
);

741 
box
 
æßt_to_box
(*
f
, 
¡ride
);

742 
d¿w_d‘eùiÚs
(
image
 
im
, 
d‘eùiÚ
 *
d‘s
, 
num
, 
th»sh
, **
Çmes
, imag**
®phab‘
, 
şas£s
);

744 
m©rix
 
ÃtwÜk_´ediù_d©a
(
ÃtwÜk
 *
Ãt
, 
d©a
 
‹¡
);

745 
image
 **
lßd_®phab‘
();

746 
image
 
g‘_ÃtwÜk_image
(
ÃtwÜk
 *
Ãt
);

747 *
ÃtwÜk_´ediù
(
ÃtwÜk
 *
Ãt
, *
šput
);

749 
ÃtwÜk_width
(
ÃtwÜk
 *
Ãt
);

750 
ÃtwÜk_height
(
ÃtwÜk
 *
Ãt
);

751 *
ÃtwÜk_´ediù_image
(
ÃtwÜk
 *
Ãt
, 
image
 
im
);

752 
ÃtwÜk_d‘eù
(
ÃtwÜk
 *
Ãt
, 
image
 
im
, 
th»sh
, 
h›r_th»sh
, 
nms
, 
d‘eùiÚ
 *
d‘s
);

753 
d‘eùiÚ
 *
g‘_ÃtwÜk_boxes
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
, 
th»sh
, 
h›r
, *
m­
, 
»Ïtive
, *
num
);

754 
ä“_d‘eùiÚs
(
d‘eùiÚ
 *
d‘s
, 
n
);

756 
»£t_ÃtwÜk_¡©e
(
ÃtwÜk
 *
Ãt
, 
b
);

758 **
g‘_Ïb–s
(*
f’ame
);

759 
do_nms_obj
(
d‘eùiÚ
 *
d‘s
, 
tÙ®
, 
şas£s
, 
th»sh
);

760 
do_nms_sÜt
(
d‘eùiÚ
 *
d‘s
, 
tÙ®
, 
şas£s
, 
th»sh
);

762 
m©rix
 
make_m©rix
(
rows
, 
cŞs
);

764 #ifdeà
OPENCV


765 *
İ’_video_¡»am
(cÚ¡ *
f
, 
c
, 
w
, 
h
, 
ås
);

766 
image
 
g‘_image_äom_¡»am
(*
p
);

767 
make_wšdow
(*
Çme
, 
w
, 
h
, 
fuÎsü“n
);

770 
ä“_image
(
image
 
m
);

771 
Œaš_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
);

772 
±h»ad_t
 
lßd_d©a_š_th»ad
(
lßd_¬gs
 
¬gs
);

773 
lßd_d©a_blockšg
(
lßd_¬gs
 
¬gs
);

774 
li¡
 *
g‘_·ths
(*
f’ame
);

775 
h›¿rchy_´ediùiÚs
(*
´ediùiÚs
, 
n
, 
Œ“
 *
h›r
, 
Úly_Ëaves
, 
¡ride
);

776 
chªge_Ëaves
(
Œ“
 *
t
, *
Ëaf_li¡
);

778 
fšd_št_¬g
(
¬gc
, **
¬gv
, *
¬g
, 
def
);

779 
fšd_æßt_¬g
(
¬gc
, **
¬gv
, *
¬g
, 
def
);

780 
fšd_¬g
(
¬gc
, * 
¬gv
[], *
¬g
);

781 *
fšd_ch¬_¬g
(
¬gc
, **
¬gv
, *
¬g
, *
def
);

782 *
ba£cfg
(*
cfgfe
);

783 
fšd_»¶aû
(*
¡r
, *
Üig
, *
»p
, *
ouut
);

784 
ä“_±rs
(**
±rs
, 
n
);

785 *
fg‘l
(
FILE
 *
å
);

786 
¡r
(*
s
);

787 
£c
(
şock_t
 
şocks
);

788 **
li¡_to_¬¿y
(
li¡
 *
l
);

789 
tİ_k
(*
a
, 
n
, 
k
, *
šdex
);

790 *
»ad_m­
(*
f’ame
);

791 
”rÜ
(cÚ¡ *
s
);

792 
max_šdex
(*
a
, 
n
);

793 
max_št_šdex
(*
a
, 
n
);

794 
§m¶e_¬¿y
(*
a
, 
n
);

795 *
¿ndom_šdex_Üd”
(
mš
, 
max
);

796 
ä“_li¡
(
li¡
 *
l
);

797 
m£_¬¿y
(*
a
, 
n
);

798 
v¬Ÿnû_¬¿y
(*
a
, 
n
);

799 
mag_¬¿y
(*
a
, 
n
);

800 
sÿË_¬¿y
(*
a
, 
n
, 
s
);

801 
m—n_¬¿y
(*
a
, 
n
);

802 
sum_¬¿y
(*
a
, 
n
);

803 
nÜm®ize_¬¿y
(*
a
, 
n
);

804 *
»ad_ši¡
(*
s
, *
n
, 
d
);

805 
size_t
 
¿nd_size_t
();

806 
¿nd_nÜm®
();

807 
¿nd_unifÜm
(
mš
, 
max
);

809 #ifdeà
__ılu¥lus


	@host/include/main.h

1 #iâdeà
MAIN_CA_H


2 
	#MAIN_CA_H


	)

4 
	~<”r.h
>

5 
	~<¡dio.h
>

6 
	~<¡ršg.h
>

9 
	~<‹e_ş›Á_­i.h
>

10 
	~"d¬kÃt.h
"

12 
	#MAKE_NETWORK_CMD
 1

	)

13 
	#WORKSPACE_NETWORK_CMD
 2

	)

14 
	#MAKE_CONV_CMD
 3

	)

15 
	#MAKE_MAX_CMD
 4

	)

16 
	#MAKE_DROP_CMD
 5

	)

17 
	#MAKE_CONNECTED_CMD
 6

	)

18 
	#MAKE_SOFTMAX_CMD
 7

	)

19 
	#MAKE_COST_CMD
 8

	)

20 
	#FORWARD_CMD
 9

	)

21 
	#BACKWARD_CMD
 10

	)

22 
	#BACKWARD_ADD_CMD
 11

	)

23 
	#UPDATE_CMD
 12

	)

24 
	#NET_TRUTH_CMD
 13

	)

25 
	#CALC_LOSS_CMD
 14

	)

26 
	#TRANS_WEI_CMD
 15

	)

27 
	#OUTPUT_RETURN_CMD
 16

	)

28 
	#SAVE_WEI_CMD
 17

	)

29 
	#ALLOCATE_WORKSPACE_CMD
 18

	)

30 
	#FORWARD_SOFTMAX_CMD
 19

	)

31 
	#RAND_NUMBER_GENERATOR
 20

	)

32 
	#VERIFY_ATTESTATION_TOKEN
 21

	)

34 
	#TA_DARKNETP_UUID
 \

36 { 0x80, 0xaf, 0xb4, 0x—, 0xb2, 0xf1, 0x99, 0x8d} }

	)

38 
TEEC_CÚ‹xt
 
ùx
;

39 
TEEC_SessiÚ
 
£ss
;

41 *
Ãt_šput_back
;

42 *
Ãt_d–_back
;

43 *
Ãt_ouut_back
;

44 
ušt8_t
 *
Ãt_g_bufãr
;

45 
¡©e
;

47 
debug_¶Ù
(*
f’ame
, 
num
, *
tob•lÙ
, 
Ëngth
);

49 
make_ÃtwÜk_CA
(
n
, 
Ë¬nšg_¿‹
, 
mom’tum
, 
deÿy
, 
time_¡•s
, 
nÙruth
, 
b©ch
, 
subdivisiÚs
, 
¿ndom
, 
adam
, 
B1
, 
B2
, 
•s
, 
h
, 
w
, 
c
, 
šputs
, 
max_üİ
, 
mš_üİ
, 
max_¿tio
, 
mš_¿tio
, 
ûÁ”
, 
ş
, 
ªgË
, 
a¥eù
, 
§tu¿tiÚ
, 
exposu»
, 
hue
, 
buº_š
, 
pow”
, 
max_b©ches
);

51 
upd©e_Ãt_agrv_CA_®loÿ‹SM
(
wÜk¥aû_size
, *
wÜk¥aû
);

53 
upd©e_Ãt_agrv_CA
(
cÚd
, 
wÜk¥aû_size
, *
wÜk¥aû
);

55 
®loÿ‹_wÜk¥aû_CA
(
wÜk¥aû_size
);

57 
make_cÚvŞutiÚ®_Ïy”_CA
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
, 
æ³d
, 
dÙ
);

59 
make_maxpoŞ_Ïy”_CA
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
);

61 
make_drİout_Ïy”_CA
(
b©ch
, 
šputs
, 
´obab™y
, 
w
, 
h
, 
c
, *
Ãt_´ev_ouut
, *
Ãt_´ev_d–
);

63 
make_cÚÃùed_Ïy”_CA
(
b©ch
, 
šputs
, 
ouuts
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

65 
make_soámax_Ïy”_CA
(
b©ch
, 
šputs
, 
groups
, 
‹m³¿tu»
, 
w
, 
h
, 
c
, 
¥©Ÿl
, 
nŞoss
);

67 
make_co¡_Ïy”_CA
(
b©ch
, 
šputs
, 
COST_TYPE
 
co¡_ty³
, 
sÿË
, 
¿tio
, 
noobjeù_sÿË
, 
th»sh
);

69 
fÜw¬d_ÃtwÜk_CA
(*
Ãt_šput
, 
Ãt_šputs
, 
Ãt_b©ch
, 
Ãt_Œaš
);

71 
backw¬d_ÃtwÜk_CA_addidiÚ
(
Ãt_šputs
, 
Ãt_b©ch
);

73 
backw¬d_ÃtwÜk_CA
(*
Ãt_šput
, 
l_šputs
, 
b©ch
, *
Ãt_d–
, 
Ãt_Œaš
);

75 
upd©e_ÃtwÜk_CA
(
upd©e_¬gs
 
a
);

77 
Ãt_Œuth_CA
(*
Ãt_Œuth
, 
Ãt_Œuths
, 
Ãt_b©ch
);

79 
ÿlc_ÃtwÜk_loss_CA
(
n
, 
b©ch
);

81 
Œªsãr_weights_CA
(*
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
, 
add™iÚ®
);

83 
§ve_weights_CA
(*
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
);

85 
backw¬d_ÃtwÜk_CA_addidiÚ
(
Ãt_šputs
, 
Ãt_b©ch
);

87 
fÜw¬d_soámax_CA
(*
Ãt_šput
, 
l_šputs
, 
Ãt_b©ch
, 
l_ouuts
, *
Ãt_ouut
);

89 
»mÙe_©‹¡©iÚ
();

91 
g‘_£cu»_¿ndomnumb”
();

93 
v”ify_©‹¡©iÚ_tok’
(*
©‹¡©iÚ_bufãr
, 
tok’_size
);

	@host/include/socket_api.h

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<¡dboŞ.h
>

5 
	~<¡ršg.h
>

6 
	~<sys/sock‘.h
>

7 
	~<¬·/š‘.h
>

8 
	~<uni¡d.h
>

9 
	~<sys/»sourû.h
>

10 
	~<sys/ty³s.h
>

11 
	~<sys/¡©.h
>

12 
	~<Ãtš‘/š.h
>

13 
	~<sigÇl.h
>

14 
	~<time.h
>

16 
	#mš
(
X
,
Y
è(((Xè< (Y)è? (Xè: (Y))

	)

17 
	#max
(
X
,
Y
è(((Xè> (Y)è? (Xè: (Y))

	)

23 
Sock‘_Cl›Á
(*
f’ame
, *
f’ame1
, 
pÜt
, 
mode
);

24 
Sock‘C»©e_Cl›Á
();

25 
Sock‘CÚÃù
(
hSock‘
, 
pÜt
);

28 
boŞ
 
£ndfe
(
sock
, 
FILE
 *
f
);

29 
boŞ
 
£ndlÚg
(
sock
, 
v®ue
);

30 
boŞ
 
£ndd©a
(
sock
, *
buf
, 
buæ’
);

33 
Sock‘_S”v”
(*
f’ame
, *
fesize
, *
g
, *
g_size
, 
şock_t
 *
time
, 
pÜt
, 
mode
);

34 
BšdC»©edSock‘
(
hSock‘
, 
pÜt
);

35 
boŞ
 
»add©a
(
sock
, *
buf
, 
buæ’
);

36 
boŞ
 
»adlÚg
(
sock
, *
v®ue
);

37 
boŞ
 
»adfe
(
sock
, 
FILE
 *
f
, FILE *
f1
);

	@host/main.c

1 
	~<”r.h
>

2 
	~<¡dio.h
>

3 
	~<¡ršg.h
>

5 
	~"d¬kÃt.h
"

6 
	~"aùiv©iÚs.h
"

7 
	~"co¡_Ïy”.h
"

9 
	~"maš.h
"

10 
	~"sock‘_­i.h
"

11 
	~"uts.h
"

14 
	~<‹e_ş›Á_­i.h
>

17 
TEEC_CÚ‹xt
 
	gùx
;

18 
TEEC_SessiÚ
 
	g£ss
;

19 
TEEC_Sh¬edMemÜy
 
	gwÜk¥aûSM
;

21 *
	gÃt_šput_back
;

22 *
	gÃt_d–_back
;

23 *
	gÃt_ouut_back
;

24 *
	gÃt_»suÉ_back
;

25 
ušt8_t
 *
	gÃt_g_bufãr
;

26 
ušt32_t
 
	g£ssiÚ_tok’
;

28 
	gsysCouÁ
 = 0;

29 
	g¡©e
;

31 
	$debug_¶Ù
(*
f’ame
, 
num
, *
tob•lÙ
, 
Ëngth
)

33 
FILE
 * 
å
;

34 
i
;

36 
¡ºum
[10];

37 
	`¥rštf
(
¡ºum
, "%d", 
num
);

40 *
s1
 = "debug_plot/";

42 *
s2
 = ".txt";

44 *
»suÉ
 = 
	`m®loc
(
	`¡¾’
(
s1
è+ sŒËn(
f’ame
è+ sŒËn(
s2
) + 1);

47 
	`¡rıy
(
»suÉ
, 
s1
);

48 
	`¡rÿt
(
»suÉ
, 
f’ame
);

49 
	`¡rÿt
(
»suÉ
, 
¡ºum
);

50 
	`¡rÿt
(
»suÉ
, 
s2
);

52 
å
 = 
	`fİ’
(
»suÉ
,"w");

55 
i
 = 0; i < 
Ëngth
; i++){

56 
	`årštf
(
å
, "%f\n",
tob•lÙ
[
i
]);

60 
	`fşo£
 (
å
);

61 
	`ä“
(
»suÉ
);

62 
	}
}

64 
	$make_ÃtwÜk_CA
(
n
, 
Ë¬nšg_¿‹
, 
mom’tum
, 
deÿy
, 
time_¡•s
, 
nÙruth
, 
b©ch
, 
subdivisiÚs
, 
¿ndom
, 
adam
, 
B1
, 
B2
, 
•s
, 
h
, 
w
, 
c
, 
šputs
, 
max_üİ
, 
mš_üİ
, 
max_¿tio
, 
mš_¿tio
, 
ûÁ”
, 
ş
, 
ªgË
, 
a¥eù
, 
§tu¿tiÚ
, 
exposu»
, 
hue
, 
buº_š
, 
pow”
, 
max_b©ches
)

66 
TEEC_O³¿tiÚ
 
İ
;

67 
ušt32_t
 
Üigš
;

68 
TEEC_ResuÉ
 
»s
;

70 
·ssšt
[17];

71 
·ssšt
[0] = 
n
;

72 
·ssšt
[1] = 
time_¡•s
;

73 
·ssšt
[2] = 
nÙruth
;

74 
·ssšt
[3] = 
b©ch
;

75 
·ssšt
[4] = 
subdivisiÚs
;

76 
·ssšt
[5] = 
¿ndom
;

77 
·ssšt
[6] = 
adam
;

78 
·ssšt
[7] = 
h
;

79 
·ssšt
[8] = 
w
;

80 
·ssšt
[9] = 
c
;

81 
·ssšt
[10] = 
šputs
;

82 
·ssšt
[11] = 
max_üİ
;

83 
·ssšt
[12] = 
mš_üİ
;

84 
·ssšt
[13] = 
ûÁ”
;

85 
·ssšt
[14] = 
buº_š
;

86 
·ssšt
[15] = 
max_b©ches
;

88 
·ssæßt
[15];

89 
·ssæßt
[0] = 
Ë¬nšg_¿‹
;

90 
·ssæßt
[1] = 
mom’tum
;

91 
·ssæßt
[2] = 
deÿy
;

92 
·ssæßt
[3] = 
B1
;

93 
·ssæßt
[4] = 
B2
;

94 
·ssæßt
[5] = 
•s
;

95 
·ssæßt
[6] = 
max_¿tio
;

96 
·ssæßt
[7] = 
mš_¿tio
;

97 
·ssæßt
[8] = 
ş
;

98 
·ssæßt
[9] = 
ªgË
;

99 
·ssæßt
[10] = 
a¥eù
;

100 
·ssæßt
[11] = 
§tu¿tiÚ
;

101 
·ssæßt
[12] = 
exposu»
;

102 
·ssæßt
[13] = 
hue
;

103 
·ssæßt
[14] = 
pow”
;

105 
	`mem£t
(&
İ
, 0, (op));

106 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT,

107 
TEEC_NONE
, TEEC_NONE);

109 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

110 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

112 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·ssæßt
;

113 
İ
.
·¿ms
[1].
tm´ef
.
size
 = (
·ssæßt
);

115 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_NETWORK_CMD
,

116 &
İ
, &
Üigš
);

119 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

121 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

123 
	`ex™
(0);

126 ià(
»s
 !ğ
TEEC_SUCCESS
)

127 
	`”rx
(1, "TEEC_InvokeCommand(MAKE_NET) failed 0x%x origin 0x%x",

128 
»s
, 
Üigš
);

129 
	}
}

147 
	$upd©e_Ãt_agrv_CA
(
cÚd
, 
wÜk¥aû_size
, *
wÜk¥aû
)

150 if(
cÚd
 == 0)

152 
TEEC_O³¿tiÚ
 
İ
;

153 
ušt32_t
 
Üigš
;

154 
TEEC_ResuÉ
 
»s
;

156 
wÜk¥aûSM
.
bufãr
 = 
wÜk¥aû
;

158 
	`mem£t
(&
İ
, 0, (op));

159 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_VALUE_INPUT
, 
TEEC_MEMREF_PARTIAL_INOUT
,

160 
TEEC_NONE
, TEEC_NONE);

162 
İ
.
·¿ms
[0].
v®ue
.
a
 = 
cÚd
;

163 
İ
.
·¿ms
[1].
mem»f
.
·»Á
 = &
wÜk¥aûSM
;

164 
İ
.
·¿ms
[1].
mem»f
.
off£t
 = 0;

165 
İ
.
·¿ms
[1].
mem»f
.
size
 = (è* 
wÜk¥aû_size
;

167 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
WORKSPACE_NETWORK_CMD
,

168 &
İ
, &
Üigš
);

170 ià(
»s
 !ğ
TEEC_SUCCESS
)

171 
	`”rx
(1, "TEEC_InvokeCommand(UPDATE_NET) failed 0x%x origin 0x%x",

172 
»s
, 
Üigš
);

176 if(
cÚd
 == 1){

177 *
wsbufãr
 = 
wÜk¥aûSM
.
bufãr
;

178 
z
=0; z<
wÜk¥aû_size
; z++){

179 
wÜk¥aû
[
z
] = 
wsbufãr
[z];

182 
	}
}

184 
	$®loÿ‹_wÜk¥aû_CA
(
wÜk¥aû_size
)

186 
TEEC_O³¿tiÚ
 
İ
;

187 
ušt32_t
 
Üigš
;

188 
TEEC_ResuÉ
 
»s
;

190 
·¿ms0
[1];

191 
·¿ms0
[0] = 
wÜk¥aû_size
;

193 
	`mem£t
(&
İ
, 0, (op));

194 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
,

195 
TEEC_NONE
,

196 
TEEC_NONE
, TEEC_NONE);

198 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·¿ms0
;

199 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·¿ms0
);

201 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
ALLOCATE_WORKSPACE_CMD
,

202 &
İ
, &
Üigš
);

204 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

206 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

208 
	`ex™
(0);

211 ià(
»s
 !ğ
TEEC_SUCCESS
)

212 
	`”rx
(1, "TEEC_InvokeCommand(loss) failed 0x%x origin 0x%x",

213 
»s
, 
Üigš
);

214 
	}
}

216 
	$make_cÚvŞutiÚ®_Ïy”_CA
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
, 
æ³d
, 
dÙ
)

218 
TEEC_O³¿tiÚ
 
İ
;

219 
ušt32_t
 
Üigš
;

220 
TEEC_ResuÉ
 
»s
;

222 
·ssšt
[15];

223 
·ssšt
[0] = 
b©ch
;

224 
·ssšt
[1] = 
h
;

225 
·ssšt
[2] = 
w
;

226 
·ssšt
[3] = 
c
;

227 
·ssšt
[4] = 
n
;

228 
·ssšt
[5] = 
groups
;

229 
·ssšt
[6] = 
size
;

230 
·ssšt
[7] = 
¡ride
;

231 
·ssšt
[8] = 
·ddšg
;

232 
·ssšt
[9] = 
b©ch_nÜm®ize
;

233 
·ssšt
[10] = 
bš¬y
;

234 
·ssšt
[11] = 
xnÜ
;

235 
·ssšt
[12] = 
adam
;

236 
·ssšt
[13] = 
æ³d
;

238 
·ssæo
 = 
dÙ
;

239 *
aùi
 = 
	`g‘_aùiv©iÚ_¡ršg
(
aùiv©iÚ
);

241 
	`mem£t
(&
İ
, 0, (op));

242 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, 
TEEC_VALUE_INPUT
,

243 
TEEC_MEMREF_TEMP_INPUT
, 
TEEC_NONE
);

245 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

246 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

248 
İ
.
·¿ms
[1].
v®ue
.
a
 = 
·ssæo
;

250 
İ
.
·¿ms
[2].
tm´ef
.
bufãr
 = 
aùi
;

251 
İ
.
·¿ms
[2].
tm´ef
.
size
 = 
	`¡¾’
(
aùi
)+1;

253 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_CONV_CMD
,

254 &
İ
, &
Üigš
);

256 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

258 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

260 
	`ex™
(0);

263 ià(
»s
 !ğ
TEEC_SUCCESS
)

264 
	`”rx
(1, "TEEC_InvokeCommand(CONV) failed 0x%x origin 0x%x",

265 
»s
, 
Üigš
);

266 
	}
}

268 
	$make_maxpoŞ_Ïy”_CA
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
)

271 
TEEC_O³¿tiÚ
 
İ
;

272 
ušt32_t
 
Üigš
;

273 
TEEC_ResuÉ
 
»s
;

275 
·ssšt
[7];

276 
·ssšt
[0] = 
b©ch
;

277 
·ssšt
[1] = 
h
;

278 
·ssšt
[2] = 
w
;

279 
·ssšt
[3] = 
c
;

280 
·ssšt
[4] = 
size
;

281 
·ssšt
[5] = 
¡ride
;

282 
·ssšt
[6] = 
·ddšg
;

284 
	`mem£t
(&
İ
, 0, (op));

285 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, 
TEEC_NONE
,

286 
TEEC_NONE
, TEEC_NONE);

288 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

289 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

291 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_MAX_CMD
,

292 &
İ
, &
Üigš
);

294 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

296 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

298 
	`ex™
(0);

301 ià(
»s
 !ğ
TEEC_SUCCESS
)

302 
	`”rx
(1, "TEEC_InvokeCommand(MAX) failed 0x%x origin 0x%x",

303 
»s
, 
Üigš
);

304 
	}
}

306 
	$make_drİout_Ïy”_CA
(
b©ch
, 
šputs
, 
´obab™y
, 
w
, 
h
, 
c
, *
Ãt_´ev_ouut
, *
Ãt_´ev_d–
)

309 
TEEC_O³¿tiÚ
 
İ
;

310 
ušt32_t
 
Üigš
;

311 
TEEC_ResuÉ
 
»s
;

313 
·ssšt
[5];

314 
·ssšt
[0] = 
b©ch
;

315 
·ssšt
[1] = 
šputs
;

316 
·ssšt
[2] = 
w
;

317 
·ssšt
[3] = 
h
;

318 
·ssšt
[4] = 
c
;

319 
·ssæo
[1];

320 
·ssæo
[0] = 
´obab™y
;

322 
	`mem£t
(&
İ
, 0, (op));

323 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT,

324 
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT);

326 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

327 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

328 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·ssæo
;

329 
İ
.
·¿ms
[1].
tm´ef
.
size
 = ()*1;

335 
İ
.
·¿ms
[2].
tm´ef
.
bufãr
 = 
Ãt_´ev_ouut
;

336 
İ
.
·¿ms
[2].
tm´ef
.
size
 = ()*
šputs
*
b©ch
;

337 
İ
.
·¿ms
[3].
tm´ef
.
bufãr
 = 
Ãt_´ev_d–
;

338 
İ
.
·¿ms
[3].
tm´ef
.
size
 = ()*
šputs
*
b©ch
;

341 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_DROP_CMD
,

342 &
İ
, &
Üigš
);

344 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

346 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

348 
	`ex™
(0);

351 ià(
»s
 !ğ
TEEC_SUCCESS
)

352 
	`”rx
(1, "TEEC_InvokeCommand(DROP) failed 0x%x origin 0x%x",

353 
»s
, 
Üigš
);

354 
	}
}

358 
	$make_cÚÃùed_Ïy”_CA
(
b©ch
, 
šputs
, 
ouuts
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
)

361 
TEEC_O³¿tiÚ
 
İ
;

362 
ušt32_t
 
Üigš
;

363 
TEEC_ResuÉ
 
»s
;

365 
·s§rg
[5];

366 
·s§rg
[0] = 
b©ch
;

367 
·s§rg
[1] = 
šputs
;

368 
·s§rg
[2] = 
ouuts
;

369 
·s§rg
[3] = 
b©ch_nÜm®ize
;

370 
·s§rg
[4] = 
adam
;

372 *
aùv
 = 
	`g‘_aùiv©iÚ_¡ršg
(
aùiv©iÚ
);

374 
	`mem£t
(&
İ
, 0, (op));

375 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT,

376 
TEEC_NONE
, TEEC_NONE);

378 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·s§rg
;

379 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·s§rg
);

381 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
aùv
;

382 
İ
.
·¿ms
[1].
tm´ef
.
size
 = 
	`¡¾’
(
aùv
)+1;

384 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_CONNECTED_CMD
,

385 &
İ
, &
Üigš
);

387 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

389 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

391 
	`ex™
(0);

394 ià(
»s
 !ğ
TEEC_SUCCESS
)

395 
	`”rx
(1, "TEEC_InvokeCommand(FC) failed 0x%x origin 0x%x",

396 
»s
, 
Üigš
);

397 
	}
}

399 
	$make_soámax_Ïy”_CA
(
b©ch
, 
šputs
, 
groups
, 
‹m³¿tu»
, 
w
, 
h
, 
c
, 
¥©Ÿl
, 
nŞoss
)

402 
TEEC_O³¿tiÚ
 
İ
;

403 
ušt32_t
 
Üigš
;

404 
TEEC_ResuÉ
 
»s
;

406 
·ssšt
[8];

407 
·ssæo
 = 
‹m³¿tu»
;

408 
·ssšt
[0] = 
b©ch
;

409 
·ssšt
[1] = 
šputs
;

410 
·ssšt
[2] = 
groups
;

411 
·ssšt
[3] = 
w
;

412 
·ssšt
[4] = 
h
;

413 
·ssšt
[5] = 
c
;

414 
·ssšt
[6] = 
¥©Ÿl
;

415 
·ssšt
[7] = 
nŞoss
;

417 
	`mem£t
(&
İ
, 0, (op));

418 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
,

419 
TEEC_VALUE_INPUT
,

420 
TEEC_NONE
, TEEC_NONE);

422 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

423 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

424 
İ
.
·¿ms
[1].
v®ue
.
a
 = 
·ssæo
;

426 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_SOFTMAX_CMD
,

427 &
İ
, &
Üigš
);

428 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

430 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

432 
	`ex™
(0);

435 ià(
»s
 !ğ
TEEC_SUCCESS
)

436 
	`”rx
(1, "TEEC_InvokeCommand(SOFTMAX) failed 0x%x origin 0x%x",

437 
»s
, 
Üigš
);

438 
	}
}

440 
	$make_co¡_Ïy”_CA
(
b©ch
, 
šputs
, 
COST_TYPE
 
co¡_ty³
, 
sÿË
, 
¿tio
, 
noobjeù_sÿË
, 
th»sh
)

443 
TEEC_O³¿tiÚ
 
İ
;

444 
ušt32_t
 
Üigš
;

445 
TEEC_ResuÉ
 
»s
;

447 
·ssšt
[2];

448 
·ssæo
[4];

449 *
·ssco¡
;

451 
·ssšt
[0] = 
b©ch
;

452 
·ssšt
[1] = 
šputs
;

453 
·ssæo
[0] = 
sÿË
;

454 
·ssæo
[1] = 
¿tio
;

455 
·ssæo
[2] = 
noobjeù_sÿË
;

456 
·ssæo
[3] = 
th»sh
;

458 
·ssco¡
 = 
	`g‘_co¡_¡ršg
(
co¡_ty³
);

460 
	`mem£t
(&
İ
, 0, (op));

461 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
,

462 
TEEC_MEMREF_TEMP_INPUT
,

463 
TEEC_MEMREF_TEMP_INPUT
, 
TEEC_NONE
);

465 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

466 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

468 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·ssæo
;

469 
İ
.
·¿ms
[1].
tm´ef
.
size
 = (
·ssæo
);

471 
İ
.
·¿ms
[2].
tm´ef
.
bufãr
 = 
·ssco¡
;

472 
İ
.
·¿ms
[2].
tm´ef
.
size
 = 
	`¡¾’
(
·ssco¡
)+1;

474 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
MAKE_COST_CMD
,

475 &
İ
, &
Üigš
);

476 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

478 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

480 
	`ex™
(0);

483 ià(
»s
 !ğ
TEEC_SUCCESS
)

484 
	`”rx
(1, "TEEC_InvokeCommand(COST) failed 0x%x origin 0x%x",

485 
»s
, 
Üigš
);

486 
	}
}

488 
	$Œªsãr_weights_CA
(*
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
, 
add™iÚ®
)

490 
TEEC_O³¿tiÚ
 
İ
;

491 
ušt32_t
 
Üigš
;

492 
TEEC_ResuÉ
 
»s
;

494 
·ssšt
[3];

495 
·ssšt
[0] = 
Ëngth
;

496 
·ssšt
[1] = 
Ïy”_i
;

497 
·ssšt
[2] = 
add™iÚ®
;

499 
	`mem£t
(&
İ
, 0, (op));

500 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT, 
TEEC_VALUE_INPUT
, 
TEEC_NONE
);

502 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
vec
;

503 
İ
.
·¿ms
[0].
tm´ef
.
size
 = ()*
Ëngth
;

505 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·ssšt
;

506 
İ
.
·¿ms
[1].
tm´ef
.
size
 = (
·ssšt
);

508 
İ
.
·¿ms
[2].
v®ue
.
a
 = 
ty³
;

510 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
TRANS_WEI_CMD
,

511 &
İ
, &
Üigš
);

512 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

514 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

516 
	`ex™
(0);

519 ià(
»s
 !ğ
TEEC_SUCCESS
)

520 
	`”rx
(1, "TEEC_InvokeCommand(TRANS_WEI) failed 0x%x origin 0x%x",

521 
»s
, 
Üigš
);

522 
	}
}

524 
	$§ve_weights_CA
(*
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
)

526 
TEEC_O³¿tiÚ
 
İ
;

527 
ušt32_t
 
Üigš
;

528 
TEEC_ResuÉ
 
»s
;

530 
·ssšt
[2];

531 
·ssšt
[0] = 
Ëngth
;

532 
·ssšt
[1] = 
Ïy”_i
;

534 *
weights_back
 = 
	`m®loc
((è* 
Ëngth
);

536 
	`mem£t
(&
İ
, 0, (op));

537 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_OUTPUT
, 
TEEC_MEMREF_TEMP_INPUT
, 
TEEC_VALUE_INPUT
, 
TEEC_NONE
);

539 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
weights_back
;

540 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (è* 
Ëngth
;

542 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·ssšt
;

543 
İ
.
·¿ms
[1].
tm´ef
.
size
 = (
·ssšt
);

545 
İ
.
·¿ms
[2].
v®ue
.
a
 = 
ty³
;

547 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
SAVE_WEI_CMD
,

548 &
İ
, &
Üigš
);

550 
z
=0; z<
Ëngth
; z++){

551 
vec
[
z
] = 
weights_back
[z];

554 
	`ä“
(
weights_back
);

556 ià(
»s
 !ğ
TEEC_SUCCESS
)

557 
	`”rx
(1, "TEEC_InvokeCommand(SAVE_WEI) failed 0x%x origin 0x%x",

558 
»s
, 
Üigš
);

559 
	}
}

561 
	$fÜw¬d_ÃtwÜk_CA
(*
Ãt_šput
, 
l_šputs
, 
Ãt_b©ch
, 
Ãt_Œaš
)

564 
TEEC_O³¿tiÚ
 
İ
;

565 
ušt32_t
 
Üigš
;

566 
TEEC_ResuÉ
 
»s
;

568 
	`mem£t
(&
İ
, 0, (op));

569 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, 
TEEC_VALUE_INPUT
,

570 
TEEC_NONE
, TEEC_NONE);

572 *
·¿ms0
 = 
	`m®loc
(()*
l_šputs
*
Ãt_b©ch
);

573 
z
=0; z<
l_šputs
*
Ãt_b©ch
; z++){

574 
·¿ms0
[
z
] = 
Ãt_šput
[z];

576 
·¿ms1
 = 
Ãt_Œaš
;

578 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·¿ms0
;

579 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (è* 
l_šputs
*
Ãt_b©ch
;

580 
İ
.
·¿ms
[1].
v®ue
.
a
 = 
·¿ms1
;

585 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
FORWARD_CMD
,

586 &
İ
, &
Üigš
);

587 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

589 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

591 
	`ex™
(0);

594 ià(
»s
 !ğ
TEEC_SUCCESS
)

595 
	`”rx
(1, "TEEC_InvokeCommand(forward) failed 0x%x origin 0x%x",

596 
»s
, 
Üigš
);

598 
	`ä“
(
·¿ms0
);

599 
	}
}

601 
	$fÜw¬d_soámax_CA
(*
Ãt_šput
, 
l_šputs
, 
Ãt_b©ch
, 
l_ouuts
, *
Ãt_ouut
)

604 
TEEC_O³¿tiÚ
 
İ
;

605 
ušt32_t
 
Üigš
;

606 
TEEC_ResuÉ
 
»s
;

608 
	`mem£t
(&
İ
, 0, (op));

609 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT,

610 
TEEC_MEMREF_TEMP_OUTPUT
, 
TEEC_NONE
);

612 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
Ãt_šput
;

613 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (è* 
l_šputs
 * 
Ãt_b©ch
;

614 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
Ãt_g_bufãr
;

615 
İ
.
·¿ms
[1].
tm´ef
.
size
 = 16;

616 
İ
.
·¿ms
[2].
tm´ef
.
bufãr
 = 
Ãt_ouut
;

617 
İ
.
·¿ms
[2].
tm´ef
.
size
 = (è* 
l_ouuts
 * 
Ãt_b©ch
;

619 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
FORWARD_SOFTMAX_CMD
,

620 &
İ
, &
Üigš
);

628 ià(
»s
 !ğ
TEEC_SUCCESS
)

629 
	`”rx
(1, "TEEC_InvokeCommand(forward) failed 0x%x origin 0x%x",

630 
»s
, 
Üigš
);

631 
	}
}

633 
	$backw¬d_ÃtwÜk_CA_addidiÚ
(
Ãt_šputs
, 
Ãt_b©ch
)

635 
TEEC_O³¿tiÚ
 
İ
;

636 
ušt32_t
 
Üigš
;

637 
TEEC_ResuÉ
 
»s
;

639 
Ãt_šput_back
 = 
	`m®loc
((è* 
Ãt_šputs
*
Ãt_b©ch
);

640 
Ãt_d–_back
 = 
	`m®loc
((è* 
Ãt_šputs
*
Ãt_b©ch
);

648 
	`mem£t
(&
İ
, 0, (op));

649 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_OUTPUT
, TEEC_MEMREF_TEMP_OUTPUT,

650 
TEEC_NONE
, TEEC_NONE);

654 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
Ãt_šput_back
;

655 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (è* 
Ãt_šputs
*
Ãt_b©ch
;

656 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
Ãt_d–_back
;

657 
İ
.
·¿ms
[1].
tm´ef
.
size
 = (è* 
Ãt_šputs
*
Ãt_b©ch
;

659 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
BACKWARD_ADD_CMD
,

660 &
İ
, &
Üigš
);

666 ià(
»s
 !ğ
TEEC_SUCCESS
)

667 
	`”rx
(1, "TEEC_InvokeCommand(backward_add) failed 0x%x origin 0x%x",

668 
»s
, 
Üigš
);

669 
	}
}

673 
	$backw¬d_ÃtwÜk_CA
(*
Ãt_šput
, 
l_šputs
, 
Ãt_b©ch
, *
Ãt_d–
, 
Ãt_Œaš
)

676 
TEEC_O³¿tiÚ
 
İ
;

677 
ušt32_t
 
Üigš
;

678 
TEEC_ResuÉ
 
»s
;

681 
	`mem£t
(&
İ
, 0, (op));

682 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
, TEEC_MEMREF_TEMP_INPUT,

683 
TEEC_VALUE_INPUT
, 
TEEC_NONE
);

685 *
·¿ms0
 = 
	`m®loc
(()*
l_šputs
*
Ãt_b©ch
);

686 *
·¿ms1
 = 
	`m®loc
(()*
l_šputs
*
Ãt_b©ch
);

688 
z
=0; z<
l_šputs
*
Ãt_b©ch
; z++){

689 
·¿ms0
[
z
] = 
Ãt_šput
[z];

690 
·¿ms1
[
z
] = 
Ãt_d–
[z];

693 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·¿ms0
;

694 
İ
.
·¿ms
[0].
tm´ef
.
size
 = ()*
l_šputs
*
Ãt_b©ch
;

695 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·¿ms1
;

696 
İ
.
·¿ms
[1].
tm´ef
.
size
 = ()*
l_šputs
*
Ãt_b©ch
;

697 
İ
.
·¿ms
[2].
v®ue
.
a
 = 
Ãt_Œaš
;

699 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
BACKWARD_CMD
,

700 &
İ
, &
Üigš
);

702 ià(
»s
 !ğ
TEEC_SUCCESS
)

703 
	`”rx
(1, "TEEC_InvokeCommand(backward) failed 0x%x origin 0x%x",

704 
»s
, 
Üigš
);

710 
	`ä“
(
·¿ms0
);

711 
	`ä“
(
·¿ms1
);

712 
	}
}

716 
	$upd©e_ÃtwÜk_CA
(
upd©e_¬gs
 
a
)

719 
TEEC_O³¿tiÚ
 
İ
;

720 
ušt32_t
 
Üigš
;

721 
TEEC_ResuÉ
 
»s
;

723 
·ssšt
[3];

724 
·ssšt
[0] = 
a
.
b©ch
;

725 
·ssšt
[1] = 
a
.
adam
;

726 
·ssšt
[2] = 
a
.
t
;

728 
·ssæo
[6];

729 
·ssæo
[0] = 
a
.
Ë¬nšg_¿‹
;

730 
·ssæo
[1] = 
a
.
mom’tum
;

731 
·ssæo
[2] = 
a
.
deÿy
;

732 
·ssæo
[3] = 
a
.
B1
;

733 
·ssæo
[4] = 
a
.
B2
;

734 
·ssæo
[5] = 
a
.
•s
;

736 
	`mem£t
(&
İ
, 0, (op));

737 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
,

738 
TEEC_MEMREF_TEMP_INPUT
,

739 
TEEC_NONE
, TEEC_NONE);

741 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·ssšt
;

742 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·ssšt
);

743 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
·ssæo
;

744 
İ
.
·¿ms
[1].
tm´ef
.
size
 = (
·ssæo
);

746 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
UPDATE_CMD
,

747 &
İ
, &
Üigš
);

748 ià(
»s
 !ğ
TEEC_SUCCESS
)

749 
	`”rx
(1, "TEEC_InvokeCommand(update) failed 0x%x origin 0x%x",

750 
»s
, 
Üigš
);

751 
	}
}

755 
	$Ãt_Œuth_CA
(*
Ãt_Œuth
, 
Ãt_Œuths
, 
Ãt_b©ch
)

758 
TEEC_O³¿tiÚ
 
İ
;

759 
ušt32_t
 
Üigš
;

760 
TEEC_ResuÉ
 
»s
;

763 *
·¿ms0
 = 
	`m®loc
((è* 
Ãt_Œuths
 * 
Ãt_b©ch
);

765 
z
=0; z<
Ãt_Œuths
*
Ãt_b©ch
; z++){

766 
·¿ms0
[
z
] = 
Ãt_Œuth
[z];

769 
	`mem£t
(&
İ
, 0, (op));

770 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
,

771 
TEEC_NONE
,

772 
TEEC_NONE
, TEEC_NONE);

774 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·¿ms0
;

775 
İ
.
·¿ms
[0].
tm´ef
.
size
 = ()*
Ãt_Œuths
*
Ãt_b©ch
;

777 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
NET_TRUTH_CMD
,

778 &
İ
, &
Üigš
);

779 ià(
»s
 !ğ
TEEC_SUCCESS
)

780 
	`”rx
(1, "TEEC_InvokeCommand(truth) failed 0x%x origin 0x%x",

781 
»s
, 
Üigš
);

786 
	`ä“
(
·¿ms0
);

787 
	}
}

789 
	$ÿlc_ÃtwÜk_loss_CA
(
n
, 
b©ch
)

791 
sysCouÁ
++;

793 
TEEC_O³¿tiÚ
 
İ
;

794 
ušt32_t
 
Üigš
;

795 
TEEC_ResuÉ
 
»s
;

797 
·¿ms0
[2];

798 
·¿ms0
[0] = 
n
;

799 
·¿ms0
[1] = 
b©ch
;

801 
	`mem£t
(&
İ
, 0, (op));

802 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INPUT
,

803 
TEEC_NONE
,

804 
TEEC_NONE
, TEEC_NONE);

806 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
·¿ms0
;

807 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (
·¿ms0
);

809 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
CALC_LOSS_CMD
,

810 &
İ
, &
Üigš
);

811 ià(
»s
 !ğ
TEEC_SUCCESS
)

812 
	`”rx
(1, "TEEC_InvokeCommand(loss) failed 0x%x origin 0x%x",

813 
»s
, 
Üigš
);

814 
	}
}

816 
	$Ãt_ouut_»tuº_CA
(
Ãt_ouuts
, 
Ãt_b©ch
)

819 
TEEC_O³¿tiÚ
 
İ
;

820 
ušt32_t
 
Üigš
;

821 
TEEC_ResuÉ
 
»s
;

823 
Ãt_ouut_back
 = 
	`m®loc
((è* 
Ãt_ouuts
 * 
Ãt_b©ch
);

826 
	`mem£t
(&
İ
, 0, (op));

827 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_OUTPUT
,

828 
TEEC_MEMREF_TEMP_OUTPUT
,

829 
TEEC_NONE
, TEEC_NONE);

831 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
Ãt_ouut_back
;

832 
İ
.
·¿ms
[0].
tm´ef
.
size
 = (è* 
Ãt_ouuts
 * 
Ãt_b©ch
;

834 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
Ãt_g_bufãr
;

835 
İ
.
·¿ms
[1].
tm´ef
.
size
 = 16;

837 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
OUTPUT_RETURN_CMD
,

838 &
İ
, &
Üigš
);

840 *
‹m
 = 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
;

842 if(
»s
 =ğ
TEEC_ERROR_OUT_OF_MEMORY
)

844 
	`´štf
("Memoryhresholdƒxceeded. Offload!!\n");

846 
	`ex™
(0);

849 ià(
»s
 !ğ
TEEC_SUCCESS
)

850 
	`”rx
(1, "TEEC_InvokeCommand(return) failed 0x%x origin 0x%x",

851 
»s
, 
Üigš
);

852 
	}
}

854 
	$v”ify_©‹¡©iÚ_tok’
(*
©‹¡©iÚ_bufãr
, 
tok’_size
)

856 
»suÉ
 = 0;

858 
TEEC_O³¿tiÚ
 
İ
;

859 
ušt32_t
 
Üigš
;

860 
TEEC_ResuÉ
 
»s
;

862 
	`mem£t
(&
İ
, 0, (op));

863 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_MEMREF_TEMP_INOUT
,

864 
TEEC_MEMREF_TEMP_INPUT
,

865 
TEEC_NONE
,

866 
TEEC_NONE
);

868 
İ
.
·¿ms
[0].
tm´ef
.
bufãr
 = 
©‹¡©iÚ_bufãr
;

869 
İ
.
·¿ms
[0].
tm´ef
.
size
 = 
tok’_size
 * ();

871 
İ
.
·¿ms
[1].
tm´ef
.
bufãr
 = 
Ãt_g_bufãr
;

872 
İ
.
·¿ms
[1].
tm´ef
.
size
 = 16;

874 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
VERIFY_ATTESTATION_TOKEN
,

875 &
İ
, &
Üigš
);

877 ià(
»s
 !ğ
TEEC_SUCCESS
)

879 
	`”rx
(1, "TEEC_InvokeCommand(return) failed 0x%x origin 0x%x",

880 
»s
, 
Üigš
);

881 
»suÉ
 = -1;

883  
»suÉ
;

884 
	}
}

886 
	$g‘_£cu»_¿ndomnumb”
()

889 
TEEC_O³¿tiÚ
 
İ
;

890 
ušt32_t
 
Üigš
;

891 
TEEC_ResuÉ
 
»s
;

893 
£ssiÚ_tok’
 = 
	`m®loc
((
ušt32_t
));

895 
	`mem£t
(&
İ
, 0, (op));

896 
İ
.
·¿mTy³s
 = 
	`TEEC_PARAM_TYPES
(
TEEC_VALUE_OUTPUT
,

897 
TEEC_NONE
,

898 
TEEC_NONE
,

899 
TEEC_NONE
);

904 
»s
 = 
	`TEEC_InvokeCommªd
(&
£ss
, 
RAND_NUMBER_GENERATOR
,

905 &
İ
, &
Üigš
);

907 ià(
»s
 !ğ
TEEC_SUCCESS
)

908 
	`”rx
(1, "TEEC_InvokeCommand(return) failed 0x%x origin 0x%x",

909 
»s
, 
Üigš
);

911 
£ssiÚ_tok’
 = 
İ
.
·¿ms
[0].
v®ue
.
a
;

912 
	}
}

914 
	$»mÙe_©‹¡©iÚ
()

916 
şock_t
 
time1
 = 
	`şock
();

917 
şock_t
 
time2
;

918 
t1
;

920 
	`g‘_£cu»_¿ndomnumb”
();

921 
	`´štf
("\nV®uoà£ssiÚok’: %d\n", 
£ssiÚ_tok’
);

923 
tok’
[80];

924 
	`¡rıy
(
tok’
, "data/darknet/session_token.data");

925 
	`årštf
(
¡d”r
, "Savšg…¬tŸÈouut tØ%s\n", 
tok’
);

926 
FILE
 *
å
 = 
	`fİ’
(
tok’
, "wb");

927 if(!
å
è
	`fe_”rÜ
(
tok’
);

929 
	`fwr™e
(&
£ssiÚ_tok’
, (
ušt32_t
), 1, 
å
);

930 
	`fşo£
(
å
);

933 
	`´štf
("\nSending sessionokeno SGX\n");

934 
¡©us
 = 0;

935 
¡©us
 = 
	`Sock‘_Cl›Á
(
tok’
, 
NULL
, 8000, 1);

936 if(
¡©us
 != 0)

938 
	`´štf
("\nFile sending failed...\n");

939 
	`ex™
(1);

941 
	`´štf
("Done.....\n");

943 
t1
 = 
	`£c
(
	`şock
()-
time1
);

945 
	`´štf
("\nWait forƒncrypted UUID+token from SGX\n");

946 
¡©us
 = 
	`Sock‘_S”v”
("d©a/d¬kÃt/tok’_uuid_sgx.d©a", "d©a/d¬kÃt/tok’_size.txt", "d©a/d¬kÃt/tok’_g_sgx.d©a", "d©a/d¬kÃt/tok’_g_size.txt", &
time2
, 8000, 0);

947 if(
¡©us
 != 0)

949 
	`´štf
("\nFile„eceiving failed...\n");

950 
	`ex™
(1);

952 
	`´štf
("Done....\n");

955 *
g_bufãr
 = "data/darknet/token_tag_sgx.data";

957 *
uuid_tok’
 = "data/darknet/token_uuid_sgx.data";

958 *
uuid_tok’_size
 = "data/darknet/token_size.txt";

960 
	`årštf
(
¡d”r
, "Lßdšgok’ from %s...", 
uuid_tok’
);

961 
FILE
 *
å1
 = 
	`fİ’
(
uuid_tok’_size
, "rb");

962 
FILE
 *
å1_1
 = 
	`fİ’
(
uuid_tok’
, "rb");

963 if(
å1
 =ğ
NULL
)

965 
	`fe_”rÜ
(
uuid_tok’_size
);

967 if(
å1_1
 =ğ
NULL
)

969 
	`fe_”rÜ
(
uuid_tok’
);

972 
tok’_size
;

973 
	`ä—d
(&
tok’_size
, (), 1, 
å1
);

974 
tok’_size
 = 46;

975 
	`´štf
("\nR—dok’ w™h size: %d\n", 
tok’_size
);

978 *
©‹¡©iÚ_bufãr
 = 
	`m®loc
((è* 
tok’_size
);

979 
	`ä—d
(
©‹¡©iÚ_bufãr
, (), 
tok’_size
, 
å1_1
);

981 
Ãt_g_bufãr
 = (
ušt8_t
 *)
	`ÿÎoc
(1,16);

982 
FILE
 *
å0
 = 
	`fİ’
(
g_bufãr
, "rb");

983 if(
å0
 =ğ
NULL
)

985 
	`fe_”rÜ
(
g_bufãr
);

987 
	`ä—d
(
Ãt_g_bufãr
, 1, 16, 
å0
);

989 
	`fşo£
(
å0
);

990 
	`fşo£
(
å1
);

991 
	`fşo£
(
å1_1
);

993 
¡©us
 = 
	`v”ify_©‹¡©iÚ_tok’
(
©‹¡©iÚ_bufãr
, 
tok’_size
);

994 if(
¡©us
 != 0)

996 
	`´štf
("\nRemote‡ttestation verification failed....\n");

1000 
	`´štf
("\nRemote‡ttestation verification successful....\n");

1003 
	`årštf
(
¡d”r
, "\nA‰e¡©iÚ…roûs com¶‘ed iÀ%à£cÚds.\n", 
t1
 + 
	`£c
(
	`şock
()-
time2
));

1005 
	`ä“
(
Ãt_g_bufãr
);

1006 
	`ä“
(
©‹¡©iÚ_bufãr
);

1007  
¡©us
;

1008 
	}
}

1010 
	$´•¬e_‹e_£ssiÚ
()

1012 
TEEC_UUID
 
uuid
 = 
TA_DARKNETP_UUID
;

1013 
ušt32_t
 
Üigš
;

1014 
TEEC_ResuÉ
 
»s
;

1017 
»s
 = 
	`TEEC_In™ŸlizeCÚ‹xt
(
NULL
, &
ùx
);

1018 ià(
»s
 !ğ
TEEC_SUCCESS
)

1019 
	`”rx
(1, "TEEC_In™ŸlizeCÚ‹xˆçed w™h cod0x%x", 
»s
);

1022 
»s
 = 
	`TEEC_O³nSessiÚ
(&
ùx
, &
£ss
, &
uuid
,

1023 
TEEC_LOGIN_PUBLIC
, 
NULL
, NULL, &
Üigš
);

1024 ià(
»s
 !ğ
TEEC_SUCCESS
)

1025 
	`”rx
(1, "TEEC_Opensession failed with code 0x%x origin 0x%x",

1026 
»s
, 
Üigš
);

1027 
	}
}

1029 
	$‹rmš©e_‹e_£ssiÚ
()

1031 
	`TEEC_Clo£SessiÚ
(&
£ss
);

1032 
	`TEEC_Fš®izeCÚ‹xt
(&
ùx
);

1033 
	}
}

1035 
	$maš
(
¬gc
, **
¬gv
)

1038 
	`´štf
("Prepare session withhe TA\n");

1039 
	`´•¬e_‹e_£ssiÚ
();

1042 
»suÉ
 = 
	`»mÙe_©‹¡©iÚ
();

1044 if(
»suÉ
 == 0)

1046 
	`´štf
("Begin darknet\n");

1047 
	`d¬kÃt_maš
(
¬gc
, 
¬gv
);

1051 
	`´štf
("Remote‡ttestation failed....!!!\n");

1054 
	`‹rmš©e_‹e_£ssiÚ
();

1056 
	}
}

	@host/src/activation_layer.c

1 
	~"aùiv©iÚ_Ïy”.h
"

2 
	~"uts.h
"

3 
	~"cuda.h
"

4 
	~"bÏs.h
"

5 
	~"gemm.h
"

7 
	~<m©h.h
>

8 
	~<¡dio.h
>

9 
	~<¡dlib.h
>

10 
	~<¡ršg.h
>

12 
Ïy”
 
	$make_aùiv©iÚ_Ïy”
(
b©ch
, 
šputs
, 
ACTIVATION
 
aùiv©iÚ
)

14 
Ïy”
 
l
 = {0};

15 
l
.
ty³
 = 
ACTIVE
;

17 
l
.
šputs
 = inputs;

18 
l
.
ouuts
 = 
šputs
;

19 
l
.
b©ch
=batch;

21 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*
šputs
, (*));

22 
l
.
d–
 = 
	`ÿÎoc
(
b©ch
*
šputs
, (*));

24 
l
.
fÜw¬d
 = 
fÜw¬d_aùiv©iÚ_Ïy”
;

25 
l
.
backw¬d
 = 
backw¬d_aùiv©iÚ_Ïy”
;

26 #ifdeà
GPU


27 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_aùiv©iÚ_Ïy”_gpu
;

28 
l
.
backw¬d_gpu
 = 
backw¬d_aùiv©iÚ_Ïy”_gpu
;

30 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
šputs
*
b©ch
);

31 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
šputs
*
b©ch
);

33 
l
.
aùiv©iÚ
 =‡ctivation;

34 
	`årštf
(
¡d”r
, "Aùiv©iÚ Lay”: %d iÅuts\n", 
šputs
);

35  
l
;

36 
	}
}

38 
	$fÜw¬d_aùiv©iÚ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

40 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput
, 1,†.
ouut
, 1);

41 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

42 
	}
}

44 
	$backw¬d_aùiv©iÚ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

46 
	`g¿d›Á_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

47 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
d–
, 1, 
Ãt
.delta, 1);

48 
	}
}

50 #ifdeà
GPU


52 
	$fÜw¬d_aùiv©iÚ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

54 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

55 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

56 
	}
}

58 
	$backw¬d_aùiv©iÚ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

60 
	`g¿d›Á_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–_gpu
);

61 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

62 
	}
}

	@host/src/activation_layer.h

1 #iâdeà
ACTIVATION_LAYER_H


2 
	#ACTIVATION_LAYER_H


	)

4 
	~"aùiv©iÚs.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_aùiv©iÚ_Ïy”
(
b©ch
, 
šputs
, 
ACTIVATION
 
aùiv©iÚ
);

10 
fÜw¬d_aùiv©iÚ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
backw¬d_aùiv©iÚ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 #ifdeà
GPU


14 
fÜw¬d_aùiv©iÚ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
backw¬d_aùiv©iÚ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/activations.c

1 
	~"aùiv©iÚs.h
"

3 
	~<m©h.h
>

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<¡ršg.h
>

8 *
	$g‘_aùiv©iÚ_¡ršg
(
ACTIVATION
 
a
)

10 
a
){

11 
LOGISTIC
:

13 
LOGGY
:

15 
RELU
:

17 
ELU
:

19 
SELU
:

21 
RELIE
:

23 
RAMP
:

25 
LINEAR
:

27 
TANH
:

29 
PLSE
:

31 
LEAKY
:

33 
STAIR
:

35 
HARDTAN
:

37 
LHTAN
:

43 
	}
}

45 
ACTIVATION
 
	$g‘_aùiv©iÚ
(*
s
)

47 ià(
	`¡rcmp
(
s
, "logi¡ic")==0è 
LOGISTIC
;

48 ià(
	`¡rcmp
(
s
, "loggy")==0è 
LOGGY
;

49 ià(
	`¡rcmp
(
s
, "»lu")==0è 
RELU
;

50 ià(
	`¡rcmp
(
s
, "–u")==0è 
ELU
;

51 ià(
	`¡rcmp
(
s
, "£lu")==0è 
SELU
;

52 ià(
	`¡rcmp
(
s
, "»l›")==0è 
RELIE
;

53 ià(
	`¡rcmp
(
s
, "¶£")==0è 
PLSE
;

54 ià(
	`¡rcmp
(
s
, "h¬dn")==0è 
HARDTAN
;

55 ià(
	`¡rcmp
(
s
, "lhn")==0è 
LHTAN
;

56 ià(
	`¡rcmp
(
s
, "lš—r")==0è 
LINEAR
;

57 ià(
	`¡rcmp
(
s
, "¿mp")==0è 
RAMP
;

58 ià(
	`¡rcmp
(
s
, "Ëaky")==0è 
LEAKY
;

59 ià(
	`¡rcmp
(
s
, "nh")==0è 
TANH
;

60 ià(
	`¡rcmp
(
s
, "¡aœ")==0è 
STAIR
;

61 
	`årštf
(
¡d”r
, "Couldn'ˆfšd‡ùiv©iÚ funùiÚ %s, gošg w™h ReLU\n", 
s
);

62  
RELU
;

63 
	}
}

65 
	$aùiv©e
(
x
, 
ACTIVATION
 
a
)

67 
a
){

68 
LINEAR
:

69  
	`lš—r_aùiv©e
(
x
);

70 
LOGISTIC
:

71  
	`logi¡ic_aùiv©e
(
x
);

72 
LOGGY
:

73  
	`loggy_aùiv©e
(
x
);

74 
RELU
:

75  
	`»lu_aùiv©e
(
x
);

76 
ELU
:

77  
	`–u_aùiv©e
(
x
);

78 
SELU
:

79  
	`£lu_aùiv©e
(
x
);

80 
RELIE
:

81  
	`»l›_aùiv©e
(
x
);

82 
RAMP
:

83  
	`¿mp_aùiv©e
(
x
);

84 
LEAKY
:

85  
	`Ëaky_aùiv©e
(
x
);

86 
TANH
:

87  
	`nh_aùiv©e
(
x
);

88 
PLSE
:

89  
	`¶£_aùiv©e
(
x
);

90 
STAIR
:

91  
	`¡aœ_aùiv©e
(
x
);

92 
HARDTAN
:

93  
	`h¬dn_aùiv©e
(
x
);

94 
LHTAN
:

95  
	`lhn_aùiv©e
(
x
);

98 
	}
}

100 
	$aùiv©e_¬¿y
(*
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION
 
a
)

102 
i
;

103 
i
 = 0; i < 
n
; ++i){

104 
x
[
i
] = 
	`aùiv©e
(x[i], 
a
);

106 
	}
}

108 
	$g¿d›Á
(
x
, 
ACTIVATION
 
a
)

110 
a
){

111 
LINEAR
:

112  
	`lš—r_g¿d›Á
(
x
);

113 
LOGISTIC
:

114  
	`logi¡ic_g¿d›Á
(
x
);

115 
LOGGY
:

116  
	`loggy_g¿d›Á
(
x
);

117 
RELU
:

118  
	`»lu_g¿d›Á
(
x
);

119 
ELU
:

120  
	`–u_g¿d›Á
(
x
);

121 
SELU
:

122  
	`£lu_g¿d›Á
(
x
);

123 
RELIE
:

124  
	`»l›_g¿d›Á
(
x
);

125 
RAMP
:

126  
	`¿mp_g¿d›Á
(
x
);

127 
LEAKY
:

128  
	`Ëaky_g¿d›Á
(
x
);

129 
TANH
:

130  
	`nh_g¿d›Á
(
x
);

131 
PLSE
:

132  
	`¶£_g¿d›Á
(
x
);

133 
STAIR
:

134  
	`¡aœ_g¿d›Á
(
x
);

135 
HARDTAN
:

136  
	`h¬dn_g¿d›Á
(
x
);

137 
LHTAN
:

138  
	`lhn_g¿d›Á
(
x
);

141 
	}
}

143 
	$g¿d›Á_¬¿y
(cÚ¡ *
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION
 
a
, *
d–
)

145 
i
;

146 
i
 = 0; i < 
n
; ++i){

147 
d–
[
i
] *ğ
	`g¿d›Á
(
x
[i], 
a
);

149 
	}
}

	@host/src/activations.h

1 #iâdeà
ACTIVATIONS_H


2 
	#ACTIVATIONS_H


	)

3 
	~"d¬kÃt.h
"

4 
	~"cuda.h
"

5 
	~"m©h.h
"

7 
ACTIVATION
 
g‘_aùiv©iÚ
(*
s
);

9 *
g‘_aùiv©iÚ_¡ršg
(
ACTIVATION
 
a
);

10 
aùiv©e
(
x
, 
ACTIVATION
 
a
);

11 
g¿d›Á
(
x
, 
ACTIVATION
 
a
);

12 
g¿d›Á_¬¿y
(cÚ¡ *
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION
 
a
, *
d–
);

13 
aùiv©e_¬¿y
(*
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION
 
a
);

14 #ifdeà
GPU


15 
aùiv©e_¬¿y_gpu
(*
x
, 
n
, 
ACTIVATION
 
a
);

16 
g¿d›Á_¬¿y_gpu
(*
x
, 
n
, 
ACTIVATION
 
a
, *
d–
);

19 
šlše
 
	$¡aœ_aùiv©e
(
x
)

21 
n
 = 
	`æoÜ
(
x
);

22 ià(
n
%2 =ğ0è 
	`æoÜ
(
x
/2.);

23  (
x
 - 
n
è+ 
	`æoÜ
(x/2.);

24 
	}
}

25 
šlše
 
	$h¬dn_aùiv©e
(
x
)

27 ià(
x
 < -1)  -1;

28 ià(
x
 > 1)  1;

29  
x
;

30 
	}
}

31 
šlše
 
	$lš—r_aùiv©e
(
x
){ x;
	}
}

32 
šlše
 
	$logi¡ic_aùiv©e
(
x
){ 1./(1. + 
	`exp
(-x));
	}
}

33 
šlše
 
	$loggy_aùiv©e
(
x
){ 2./(1. + 
	`exp
(-x)è- 1;
	}
}

34 
šlše
 
	$»lu_aùiv©e
(
x
){ x*(x>0);
	}
}

35 
šlše
 
	$–u_aùiv©e
(
x
){ (x >ğ0)*x + (x < 0)*(
	`exp
(x)-1);
	}
}

36 
šlše
 
	$£lu_aùiv©e
(
x
){ (x >ğ0)*1.0507*x + (x < 0)*1.0507*1.6732*(
	`exp
(x)-1);
	}
}

37 
šlše
 
	$»l›_aùiv©e
(
x
){ (x>0è? x : .01*x;
	}
}

38 
šlše
 
	$¿mp_aùiv©e
(
x
){ x*(x>0)+.1*x;
	}
}

39 
šlše
 
	$Ëaky_aùiv©e
(
x
){ (x>0è? x : .1*x;
	}
}

40 
šlše
 
	$nh_aùiv©e
(
x
){ (
	`exp
(2*x)-1)/Óxp(2*x)+1);
	}
}

41 
šlše
 
	$¶£_aùiv©e
(
x
)

43 if(
x
 < -4)  .01 * (x + 4);

44 if(
x
 > 4)  .01 * (x - 4) + 1;

45  .125*
x
 + .5;

46 
	}
}

48 
šlše
 
	$lhn_aùiv©e
(
x
)

50 if(
x
 < 0)  .001*x;

51 if(
x
 > 1)  .001*(x-1) + 1;

52  
x
;

53 
	}
}

54 
šlše
 
	$lhn_g¿d›Á
(
x
)

56 if(
x
 > 0 && x < 1)  1;

58 
	}
}

60 
šlše
 
	$h¬dn_g¿d›Á
(
x
)

62 ià(
x
 > -1 && x < 1)  1;

64 
	}
}

65 
šlše
 
	$lš—r_g¿d›Á
(
x
){ 1;
	}
}

66 
šlše
 
	$logi¡ic_g¿d›Á
(
x
){ (1-x)*x;
	}
}

67 
šlše
 
	$loggy_g¿d›Á
(
x
)

69 
y
 = (
x
+1.)/2.;

70  2*(1-
y
)*y;

71 
	}
}

72 
šlše
 
	$¡aœ_g¿d›Á
(
x
)

74 ià(
	`æoÜ
(
x
) == x)  0;

76 
	}
}

77 
šlše
 
	$»lu_g¿d›Á
(
x
){ (x>0);
	}
}

78 
šlše
 
	$–u_g¿d›Á
(
x
){ (x >ğ0è+ (x < 0)*(x + 1);
	}
}

79 
šlše
 
	$£lu_g¿d›Á
(
x
){ (x >ğ0)*1.0507 + (x < 0)*(x + 1.0507*1.6732);
	}
}

80 
šlše
 
	$»l›_g¿d›Á
(
x
){ (x>0è? 1 : .01;
	}
}

81 
šlše
 
	$¿mp_g¿d›Á
(
x
){ (x>0)+.1;
	}
}

82 
šlše
 
	$Ëaky_g¿d›Á
(
x
){ (x>0è? 1 : .1;
	}
}

83 
šlše
 
	$nh_g¿d›Á
(
x
){ 1-x*x;
	}
}

84 
šlše
 
	$¶£_g¿d›Á
(
x
){ (x < 0 || x > 1è? .01 : .125;
	}
}

	@host/src/avgpool_layer.c

1 
	~"avgpoŞ_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~<¡dio.h
>

5 
avgpoŞ_Ïy”
 
	$make_avgpoŞ_Ïy”
(
b©ch
, 
w
, 
h
, 
c
)

7 
	`årštf
(
¡d”r
, "avg %4d x%4d x%4d -> %4d\n", 
w
, 
h
, 
c
, c);

8 
avgpoŞ_Ïy”
 
l
 = {0};

9 
l
.
ty³
 = 
AVGPOOL
;

10 
l
.
b©ch
 = batch;

11 
l
.
h
 = h;

12 
l
.
w
 = w;

13 
l
.
c
 = c;

14 
l
.
out_w
 = 1;

15 
l
.
out_h
 = 1;

16 
l
.
out_c
 = 
c
;

17 
l
.
ouuts
 =†.
out_c
;

18 
l
.
šputs
 = 
h
*
w
*
c
;

19 
ouut_size
 = 
l
.
ouuts
 * 
b©ch
;

20 
l
.
ouut
 = 
	`ÿÎoc
(
ouut_size
, ());

21 
l
.
d–
 = 
	`ÿÎoc
(
ouut_size
, ());

22 
l
.
fÜw¬d
 = 
fÜw¬d_avgpoŞ_Ïy”
;

23 
l
.
backw¬d
 = 
backw¬d_avgpoŞ_Ïy”
;

24 #ifdeà
GPU


25 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_avgpoŞ_Ïy”_gpu
;

26 
l
.
backw¬d_gpu
 = 
backw¬d_avgpoŞ_Ïy”_gpu
;

27 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
ouut_size
);

28 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
ouut_size
);

30  
l
;

31 
	}
}

33 
	$»size_avgpoŞ_Ïy”
(
avgpoŞ_Ïy”
 *
l
, 
w
, 
h
)

35 
l
->
w
 = w;

36 
l
->
h
 = h;

37 
l
->
šputs
 = 
h
*
w
*l->
c
;

38 
	}
}

40 
	$fÜw¬d_avgpoŞ_Ïy”
(cÚ¡ 
avgpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

42 
b
,
i
,
k
;

44 
b
 = 0; b < 
l
.
b©ch
; ++b){

45 
k
 = 0; k < 
l
.
c
; ++k){

46 
out_šdex
 = 
k
 + 
b
*
l
.
c
;

47 
l
.
ouut
[
out_šdex
] = 0;

48 
i
 = 0; i < 
l
.
h
*l.
w
; ++i){

49 
š_šdex
 = 
i
 + 
l
.
h
*l.
w
*(
k
 + 
b
*l.
c
);

50 
l
.
ouut
[
out_šdex
] +ğ
Ãt
.
šput
[
š_šdex
];

52 
l
.
ouut
[
out_šdex
] /ğl.
h
*l.
w
;

55 
	}
}

57 
	$backw¬d_avgpoŞ_Ïy”
(cÚ¡ 
avgpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

59 
b
,
i
,
k
;

61 
b
 = 0; b < 
l
.
b©ch
; ++b){

62 
k
 = 0; k < 
l
.
c
; ++k){

63 
out_šdex
 = 
k
 + 
b
*
l
.
c
;

64 
i
 = 0; i < 
l
.
h
*l.
w
; ++i){

65 
š_šdex
 = 
i
 + 
l
.
h
*l.
w
*(
k
 + 
b
*l.
c
);

66 
Ãt
.
d–
[
š_šdex
] +ğ
l
.d–[
out_šdex
] / (l.
h
*l.
w
);

70 
	}
}

	@host/src/avgpool_layer.h

1 #iâdeà
AVGPOOL_LAYER_H


2 
	#AVGPOOL_LAYER_H


	)

4 
	~"image.h
"

5 
	~"cuda.h
"

6 
	~"Ïy”.h
"

7 
	~"ÃtwÜk.h
"

9 
Ïy”
 
	tavgpoŞ_Ïy”
;

11 
image
 
g‘_avgpoŞ_image
(
avgpoŞ_Ïy”
 
l
);

12 
avgpoŞ_Ïy”
 
make_avgpoŞ_Ïy”
(
b©ch
, 
w
, 
h
, 
c
);

13 
»size_avgpoŞ_Ïy”
(
avgpoŞ_Ïy”
 *
l
, 
w
, 
h
);

14 
fÜw¬d_avgpoŞ_Ïy”
(cÚ¡ 
avgpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
backw¬d_avgpoŞ_Ïy”
(cÚ¡ 
avgpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 #ifdeà
GPU


18 
fÜw¬d_avgpoŞ_Ïy”_gpu
(
avgpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

19 
backw¬d_avgpoŞ_Ïy”_gpu
(
avgpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/batchnorm_layer.c

1 
	~"cÚvŞutiÚ®_Ïy”.h
"

2 
	~"b©chnÜm_Ïy”.h
"

3 
	~"bÏs.h
"

4 
	~<¡dio.h
>

6 
Ïy”
 
	$make_b©chnÜm_Ïy”
(
b©ch
, 
w
, 
h
, 
c
)

8 
	`årštf
(
¡d”r
, "B©ch NÜm®iz©iÚ Lay”: %d x %d x %d image\n", 
w
,
h
,
c
);

9 
Ïy”
 
l
 = {0};

10 
l
.
ty³
 = 
BATCHNORM
;

11 
l
.
b©ch
 = batch;

12 
l
.
h
 =†.
out_h
 = h;

13 
l
.
w
 =†.
out_w
 = w;

14 
l
.
c
 =†.
out_c
 = c;

15 
l
.
ouut
 = 
	`ÿÎoc
(
h
 * 
w
 * 
c
 * 
b©ch
, ());

16 
l
.
d–
 = 
	`ÿÎoc
(
h
 * 
w
 * 
c
 * 
b©ch
, ());

17 
l
.
šputs
 = 
w
*
h
*
c
;

18 
l
.
ouuts
 =†.
šputs
;

20 
l
.
sÿËs
 = 
	`ÿÎoc
(
c
, ());

21 
l
.
sÿË_upd©es
 = 
	`ÿÎoc
(
c
, ());

22 
l
.
bŸ£s
 = 
	`ÿÎoc
(
c
, ());

23 
l
.
bŸs_upd©es
 = 
	`ÿÎoc
(
c
, ());

24 
i
;

25 
i
 = 0; i < 
c
; ++i){

26 
l
.
sÿËs
[
i
] = 1;

29 
l
.
m—n
 = 
	`ÿÎoc
(
c
, ());

30 
l
.
v¬Ÿnû
 = 
	`ÿÎoc
(
c
, ());

32 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
c
, ());

33 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
c
, ());

35 
l
.
fÜw¬d
 = 
fÜw¬d_b©chnÜm_Ïy”
;

36 
l
.
backw¬d
 = 
backw¬d_b©chnÜm_Ïy”
;

37 #ifdeà
GPU


38 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_b©chnÜm_Ïy”_gpu
;

39 
l
.
backw¬d_gpu
 = 
backw¬d_b©chnÜm_Ïy”_gpu
;

41 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
h
 * 
w
 * 
c
 * 
b©ch
);

42 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
h
 * 
w
 * 
c
 * 
b©ch
);

44 
l
.
bŸ£s_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸ£s
, 
c
);

45 
l
.
bŸs_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_upd©es
, 
c
);

47 
l
.
sÿËs_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿËs
, 
c
);

48 
l
.
sÿË_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_upd©es
, 
c
);

50 
l
.
m—n_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
c
);

51 
l
.
v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
c
);

53 
l
.
rŞlšg_m—n_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
c
);

54 
l
.
rŞlšg_v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
c
);

56 
l
.
m—n_d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
c
);

57 
l
.
v¬Ÿnû_d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
c
);

59 
l
.
x_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*l.
ouuts
);

60 
l
.
x_nÜm_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*l.
ouuts
);

61 #ifdeà
CUDNN


62 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
nÜmT’sÜDesc
);

63 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
d¡T’sÜDesc
);

64 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†.
b©ch
,†.
out_c
,†.
out_h
,†.
out_w
);

65 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
nÜmT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†.
out_c
, 1, 1);

69  
l
;

70 
	}
}

72 
	$backw¬d_sÿË_ıu
(*
x_nÜm
, *
d–
, 
b©ch
, 
n
, 
size
, *
sÿË_upd©es
)

74 
i
,
b
,
f
;

75 
f
 = 0; f < 
n
; ++f){

76 
sum
 = 0;

77 
b
 = 0; b < 
b©ch
; ++b){

78 
i
 = 0; i < 
size
; ++i){

79 
šdex
 = 
i
 + 
size
*(
f
 + 
n
*
b
);

80 
sum
 +ğ
d–
[
šdex
] * 
x_nÜm
[index];

83 
sÿË_upd©es
[
f
] +ğ
sum
;

85 
	}
}

87 
	$m—n_d–_ıu
(*
d–
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n_d–
)

90 
i
,
j
,
k
;

91 
i
 = 0; i < 
f‹rs
; ++i){

92 
m—n_d–
[
i
] = 0;

93 
j
 = 0; j < 
b©ch
; ++j) {

94 
k
 = 0; k < 
¥©Ÿl
; ++k) {

95 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

96 
m—n_d–
[
i
] +ğ
d–
[
šdex
];

99 
m—n_d–
[
i
] *ğ(-1./
	`sq¹
(
v¬Ÿnû
[i] + .00001f));

101 
	}
}

102 
	$v¬Ÿnû_d–_ıu
(*
x
, *
d–
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû_d–
)

105 
i
,
j
,
k
;

106 
i
 = 0; i < 
f‹rs
; ++i){

107 
v¬Ÿnû_d–
[
i
] = 0;

108 
j
 = 0; j < 
b©ch
; ++j){

109 
k
 = 0; k < 
¥©Ÿl
; ++k){

110 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

111 
v¬Ÿnû_d–
[
i
] +ğ
d–
[
šdex
]*(
x
[šdex] - 
m—n
[i]);

114 
v¬Ÿnû_d–
[
i
] *ğ-.5 * 
	`pow
(
v¬Ÿnû
[i] + .00001f, ()(-3./2.));

116 
	}
}

117 
	$nÜm®ize_d–_ıu
(*
x
, *
m—n
, *
v¬Ÿnû
, *
m—n_d–
, *
v¬Ÿnû_d–
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
d–
)

119 
f
, 
j
, 
k
;

120 
j
 = 0; j < 
b©ch
; ++j){

121 
f
 = 0; f < 
f‹rs
; ++f){

122 
k
 = 0; k < 
¥©Ÿl
; ++k){

123 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
f
*¥©ŸÈ+ 
k
;

124 
d–
[
šdex
] = d–[šdex] * 1./(
	`sq¹
(
v¬Ÿnû
[
f
] + .00001f)è+ 
v¬Ÿnû_d–
[f] * 2. * (
x
[šdex] - 
m—n
[f]è/ (
¥©Ÿl
 * 
b©ch
è+ 
m—n_d–
[f]/(spatial*batch);

128 
	}
}

130 
	$»size_b©chnÜm_Ïy”
(
Ïy”
 *Ïy”, 
w
, 
h
)

132 
	`årštf
(
¡d”r
, "Not implemented\n");

133 
	}
}

135 
	$fÜw¬d_b©chnÜm_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

137 if(
l
.
ty³
 =ğ
BATCHNORM
è
	`cİy_ıu
Ö.
ouuts
*l.
b©ch
, 
Ãt
.
šput
, 1,†.
ouut
, 1);

138 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ouut
, 1,†.
x
, 1);

139 if(
Ãt
.
Œaš
){

140 
	`m—n_ıu
(
l
.
ouut
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
,†.
m—n
);

141 
	`v¬Ÿnû_ıu
(
l
.
ouut
,†.
m—n
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
,†.
v¬Ÿnû
);

143 
	`sÿl_ıu
(
l
.
out_c
, .99,†.
rŞlšg_m—n
, 1);

144 
	`axpy_ıu
(
l
.
out_c
, .01,†.
m—n
, 1,†.
rŞlšg_m—n
, 1);

145 
	`sÿl_ıu
(
l
.
out_c
, .99,†.
rŞlšg_v¬Ÿnû
, 1);

146 
	`axpy_ıu
(
l
.
out_c
, .01,†.
v¬Ÿnû
, 1,†.
rŞlšg_v¬Ÿnû
, 1);

148 
	`nÜm®ize_ıu
(
l
.
ouut
,†.
m—n
,†.
v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

149 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ouut
, 1,†.
x_nÜm
, 1);

151 
	`nÜm®ize_ıu
(
l
.
ouut
,†.
rŞlšg_m—n
,†.
rŞlšg_v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

153 
	`sÿË_bŸs
(
l
.
ouut
,†.
sÿËs
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

154 
	`add_bŸs
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

155 
	}
}

157 
	$backw¬d_b©chnÜm_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

159 if(!
Ãt
.
Œaš
){

160 
l
.
m—n
 =†.
rŞlšg_m—n
;

161 
l
.
v¬Ÿnû
 =†.
rŞlšg_v¬Ÿnû
;

163 
	`backw¬d_bŸs
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

164 
	`backw¬d_sÿË_ıu
(
l
.
x_nÜm
,†.
d–
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
sÿË_upd©es
);

166 
	`sÿË_bŸs
(
l
.
d–
,†.
sÿËs
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

168 
	`m—n_d–_ıu
(
l
.
d–
,†.
v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
m—n_d–
);

169 
	`v¬Ÿnû_d–_ıu
(
l
.
x
,†.
d–
,†.
m—n
,†.
v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
v¬Ÿnû_d–
);

170 
	`nÜm®ize_d–_ıu
(
l
.
x
,†.
m—n
,†.
v¬Ÿnû
,†.
m—n_d–
,†.
v¬Ÿnû_d–
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
d–
);

171 if(
l
.
ty³
 =ğ
BATCHNORM
è
	`cİy_ıu
Ö.
ouuts
*l.
b©ch
,†.
d–
, 1, 
Ãt
.delta, 1);

172 
	}
}

174 #ifdeà
GPU


176 
	$puÎ_b©chnÜm_Ïy”
(
Ïy”
 
l
)

178 
	`cuda_puÎ_¬¿y
(
l
.
sÿËs_gpu
,†.
sÿËs
,†.
c
);

179 
	`cuda_puÎ_¬¿y
(
l
.
rŞlšg_m—n_gpu
,†.
rŞlšg_m—n
,†.
c
);

180 
	`cuda_puÎ_¬¿y
(
l
.
rŞlšg_v¬Ÿnû_gpu
,†.
rŞlšg_v¬Ÿnû
,†.
c
);

181 
	}
}

182 
	$push_b©chnÜm_Ïy”
(
Ïy”
 
l
)

184 
	`cuda_push_¬¿y
(
l
.
sÿËs_gpu
,†.
sÿËs
,†.
c
);

185 
	`cuda_push_¬¿y
(
l
.
rŞlšg_m—n_gpu
,†.
rŞlšg_m—n
,†.
c
);

186 
	`cuda_push_¬¿y
(
l
.
rŞlšg_v¬Ÿnû_gpu
,†.
rŞlšg_v¬Ÿnû
,†.
c
);

187 
	}
}

189 
	$fÜw¬d_b©chnÜm_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

191 if(
l
.
ty³
 =ğ
BATCHNORM
è
	`cİy_gpu
Ö.
ouuts
*l.
b©ch
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

192 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
, 1,†.
x_gpu
, 1);

193 ià(
Ãt
.
Œaš
) {

194 #ifdeà
CUDNN


195 
Úe
 = 1;

196 
z”o
 = 0;

197 
	`cudÂB©chNÜm®iz©iÚFÜw¬dT¿ššg
(
	`cudÂ_hªdË
(),

198 
CUDNN_BATCHNORM_SPATIAL
,

199 &
Úe
,

200 &
z”o
,

201 
l
.
d¡T’sÜDesc
,

202 
l
.
x_gpu
,

203 
l
.
d¡T’sÜDesc
,

204 
l
.
ouut_gpu
,

205 
l
.
nÜmT’sÜDesc
,

206 
l
.
sÿËs_gpu
,

207 
l
.
bŸ£s_gpu
,

209 
l
.
rŞlšg_m—n_gpu
,

210 
l
.
rŞlšg_v¬Ÿnû_gpu
,

212 
l
.
m—n_gpu
,

213 
l
.
v¬Ÿnû_gpu
);

215 
	`ç¡_m—n_gpu
(
l
.
ouut_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
,†.
m—n_gpu
);

216 
	`ç¡_v¬Ÿnû_gpu
(
l
.
ouut_gpu
,†.
m—n_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
,†.
v¬Ÿnû_gpu
);

218 
	`sÿl_gpu
(
l
.
out_c
, .99,†.
rŞlšg_m—n_gpu
, 1);

219 
	`axpy_gpu
(
l
.
out_c
, .01,†.
m—n_gpu
, 1,†.
rŞlšg_m—n_gpu
, 1);

220 
	`sÿl_gpu
(
l
.
out_c
, .99,†.
rŞlšg_v¬Ÿnû_gpu
, 1);

221 
	`axpy_gpu
(
l
.
out_c
, .01,†.
v¬Ÿnû_gpu
, 1,†.
rŞlšg_v¬Ÿnû_gpu
, 1);

223 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
, 1,†.
x_gpu
, 1);

224 
	`nÜm®ize_gpu
(
l
.
ouut_gpu
,†.
m—n_gpu
,†.
v¬Ÿnû_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

225 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
, 1,†.
x_nÜm_gpu
, 1);

227 
	`sÿË_bŸs_gpu
(
l
.
ouut_gpu
,†.
sÿËs_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

228 
	`add_bŸs_gpu
(
l
.
ouut_gpu
,†.
bŸ£s_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

231 
	`nÜm®ize_gpu
(
l
.
ouut_gpu
,†.
rŞlšg_m—n_gpu
,†.
rŞlšg_v¬Ÿnû_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

232 
	`sÿË_bŸs_gpu
(
l
.
ouut_gpu
,†.
sÿËs_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

233 
	`add_bŸs_gpu
(
l
.
ouut_gpu
,†.
bŸ£s_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

236 
	}
}

238 
	$backw¬d_b©chnÜm_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

240 if(!
Ãt
.
Œaš
){

241 
l
.
m—n_gpu
 =†.
rŞlšg_m—n_gpu
;

242 
l
.
v¬Ÿnû_gpu
 =†.
rŞlšg_v¬Ÿnû_gpu
;

244 #ifdeà
CUDNN


245 
Úe
 = 1;

246 
z”o
 = 0;

247 
	`cudÂB©chNÜm®iz©iÚBackw¬d
(
	`cudÂ_hªdË
(),

248 
CUDNN_BATCHNORM_SPATIAL
,

249 &
Úe
,

250 &
z”o
,

251 &
Úe
,

252 &
Úe
,

253 
l
.
d¡T’sÜDesc
,

254 
l
.
x_gpu
,

255 
l
.
d¡T’sÜDesc
,

256 
l
.
d–_gpu
,

257 
l
.
d¡T’sÜDesc
,

258 
l
.
x_nÜm_gpu
,

259 
l
.
nÜmT’sÜDesc
,

260 
l
.
sÿËs_gpu
,

261 
l
.
sÿË_upd©es_gpu
,

262 
l
.
bŸs_upd©es_gpu
,

264 
l
.
m—n_gpu
,

265 
l
.
v¬Ÿnû_gpu
);

266 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
x_nÜm_gpu
, 1,†.
d–_gpu
, 1);

268 
	`backw¬d_bŸs_gpu
(
l
.
bŸs_upd©es_gpu
,†.
d–_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

269 
	`backw¬d_sÿË_gpu
(
l
.
x_nÜm_gpu
,†.
d–_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
sÿË_upd©es_gpu
);

271 
	`sÿË_bŸs_gpu
(
l
.
d–_gpu
,†.
sÿËs_gpu
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

273 
	`ç¡_m—n_d–_gpu
(
l
.
d–_gpu
,†.
v¬Ÿnû_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
m—n_d–_gpu
);

274 
	`ç¡_v¬Ÿnû_d–_gpu
(
l
.
x_gpu
,†.
d–_gpu
,†.
m—n_gpu
,†.
v¬Ÿnû_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
v¬Ÿnû_d–_gpu
);

275 
	`nÜm®ize_d–_gpu
(
l
.
x_gpu
,†.
m—n_gpu
,†.
v¬Ÿnû_gpu
,†.
m—n_d–_gpu
,†.
v¬Ÿnû_d–_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
d–_gpu
);

277 if(
l
.
ty³
 =ğ
BATCHNORM
è
	`cİy_gpu
Ö.
ouuts
*l.
b©ch
,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

278 
	}
}

	@host/src/batchnorm_layer.h

1 #iâdeà
BATCHNORM_LAYER_H


2 
	#BATCHNORM_LAYER_H


	)

4 
	~"image.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_b©chnÜm_Ïy”
(
b©ch
, 
w
, 
h
, 
c
);

9 
fÜw¬d_b©chnÜm_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 
backw¬d_b©chnÜm_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 #ifdeà
GPU


13 
fÜw¬d_b©chnÜm_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

14 
backw¬d_b©chnÜm_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
puÎ_b©chnÜm_Ïy”
(
Ïy”
 
l
);

16 
push_b©chnÜm_Ïy”
(
Ïy”
 
l
);

	@host/src/blas.c

1 
	~"bÏs.h
"

3 
	~<m©h.h
>

4 
	~<as£¹.h
>

5 
	~<æßt.h
>

6 
	~<¡dio.h
>

7 
	~<¡dlib.h
>

8 
	~<¡ršg.h
>

9 
	$»Üg_ıu
(*
x
, 
w
, 
h
, 
c
, 
b©ch
, 
¡ride
, 
fÜw¬d
, *
out
)

11 
b
,
i
,
j
,
k
;

12 
out_c
 = 
c
/(
¡ride
*stride);

14 
b
 = 0; b < 
b©ch
; ++b){

15 
k
 = 0; k < 
c
; ++k){

16 
j
 = 0; j < 
h
; ++j){

17 
i
 = 0; i < 
w
; ++i){

18 
š_šdex
 = 
i
 + 
w
*(
j
 + 
h
*(
k
 + 
c
*
b
));

19 
c2
 = 
k
 % 
out_c
;

20 
off£t
 = 
k
 / 
out_c
;

21 
w2
 = 
i
*
¡ride
 + 
off£t
 % stride;

22 
h2
 = 
j
*
¡ride
 + 
off£t
 / stride;

23 
out_šdex
 = 
w2
 + 
w
*
¡ride
*(
h2
 + 
h
*¡ride*(
c2
 + 
out_c
*
b
));

24 if(
fÜw¬d
è
out
[
out_šdex
] = 
x
[
š_šdex
];

25 
out
[
š_šdex
] = 
x
[
out_šdex
];

30 
	}
}

32 
	$æ©‹n
(*
x
, 
size
, 
Ïy”s
, 
b©ch
, 
fÜw¬d
)

34 *
sw­
 = 
	`ÿÎoc
(
size
*
Ïy”s
*
b©ch
, ());

35 
i
,
c
,
b
;

36 
b
 = 0; b < 
b©ch
; ++b){

37 
c
 = 0; c < 
Ïy”s
; ++c){

38 
i
 = 0; i < 
size
; ++i){

39 
i1
 = 
b
*
Ïy”s
*
size
 + 
c
*siz+ 
i
;

40 
i2
 = 
b
*
Ïy”s
*
size
 + 
i
*Ïy” + 
c
;

41 ià(
fÜw¬d
è
sw­
[
i2
] = 
x
[
i1
];

42 
sw­
[
i1
] = 
x
[
i2
];

46 
	`memıy
(
x
, 
sw­
, 
size
*
Ïy”s
*
b©ch
*());

47 
	`ä“
(
sw­
);

48 
	}
}

50 
	$weigh‹d_sum_ıu
(*
a
, *
b
, *
s
, 
n
, *
c
)

52 
i
;

53 
i
 = 0; i < 
n
; ++i){

54 
c
[
i
] = 
s
[i]*
a
[i] + (1-s[i])*(
b
 ? b[i] : 0);

56 
	}
}

58 
	$weigh‹d_d–_ıu
(*
a
, *
b
, *
s
, *
da
, *
db
, *
ds
, 
n
, *
dc
)

60 
i
;

61 
i
 = 0; i < 
n
; ++i){

62 if(
da
èda[
i
] +ğ
dc
[i] * 
s
[i];

63 if(
db
èdb[
i
] +ğ
dc
[i] * (1-
s
[i]);

64 
ds
[
i
] +ğ
dc
[i] * (
a
[i] - 
b
[i]);

66 
	}
}

68 
	$shÜtcut_ıu
(
b©ch
, 
w1
, 
h1
, 
c1
, *
add
, 
w2
, 
h2
, 
c2
, 
s1
, 
s2
, *
out
)

70 
¡ride
 = 
w1
/
w2
;

71 
§m¶e
 = 
w2
/
w1
;

72 
	`as£¹
(
¡ride
 =ğ
h1
/
h2
);

73 
	`as£¹
(
§m¶e
 =ğ
h2
/
h1
);

74 if(
¡ride
 < 1) stride = 1;

75 if(
§m¶e
 < 1) sample = 1;

76 
mšw
 = (
w1
 < 
w2
) ? w1 : w2;

77 
mšh
 = (
h1
 < 
h2
) ? h1 : h2;

78 
mšc
 = (
c1
 < 
c2
) ? c1 : c2;

80 
i
,
j
,
k
,
b
;

81 
b
 = 0; b < 
b©ch
; ++b){

82 
k
 = 0; k < 
mšc
; ++k){

83 
j
 = 0; j < 
mšh
; ++j){

84 
i
 = 0; i < 
mšw
; ++i){

85 
out_šdex
 = 
i
*
§m¶e
 + 
w2
*(
j
*§m¶+ 
h2
*(
k
 + 
c2
*
b
));

86 
add_šdex
 = 
i
*
¡ride
 + 
w1
*(
j
*¡rid+ 
h1
*(
k
 + 
c1
*
b
));

87 
out
[
out_šdex
] = 
s1
*out[out_šdex] + 
s2
*
add
[
add_šdex
];

92 
	}
}

94 
	$m—n_ıu
(*
x
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n
)

96 
sÿË
 = 1./(
b©ch
 * 
¥©Ÿl
);

97 
i
,
j
,
k
;

98 
i
 = 0; i < 
f‹rs
; ++i){

99 
m—n
[
i
] = 0;

100 
j
 = 0; j < 
b©ch
; ++j){

101 
k
 = 0; k < 
¥©Ÿl
; ++k){

102 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

103 
m—n
[
i
] +ğ
x
[
šdex
];

106 
m—n
[
i
] *ğ
sÿË
;

108 
	}
}

110 
	$v¬Ÿnû_ıu
(*
x
, *
m—n
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû
)

112 
sÿË
 = 1./(
b©ch
 * 
¥©Ÿl
 - 1);

113 
i
,
j
,
k
;

114 
i
 = 0; i < 
f‹rs
; ++i){

115 
v¬Ÿnû
[
i
] = 0;

116 
j
 = 0; j < 
b©ch
; ++j){

117 
k
 = 0; k < 
¥©Ÿl
; ++k){

118 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

119 
v¬Ÿnû
[
i
] +ğ
	`pow
((
x
[
šdex
] - 
m—n
[i]), 2);

122 
v¬Ÿnû
[
i
] *ğ
sÿË
;

124 
	}
}

126 
	$l2nÜm®ize_ıu
(*
x
, *
dx
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
)

128 
b
,
f
,
i
;

129 
b
 = 0; b < 
b©ch
; ++b){

130 
i
 = 0; i < 
¥©Ÿl
; ++i){

131 
sum
 = 0;

132 
f
 = 0; f < 
f‹rs
; ++f){

133 
šdex
 = 
b
*
f‹rs
*
¥©Ÿl
 + 
f
*¥©ŸÈ+ 
i
;

134 
sum
 +ğ
	`powf
(
x
[
šdex
], 2);

136 
sum
 = 
	`sq¹f
(sum);

137 
f
 = 0; f < 
f‹rs
; ++f){

138 
šdex
 = 
b
*
f‹rs
*
¥©Ÿl
 + 
f
*¥©ŸÈ+ 
i
;

139 
x
[
šdex
] /ğ
sum
;

140 
dx
[
šdex
] = (1 - 
x
[šdex]è/ 
sum
;

144 
	}
}

147 
	$nÜm®ize_ıu
(*
x
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
)

149 
b
, 
f
, 
i
;

150 
b
 = 0; b < 
b©ch
; ++b){

151 
f
 = 0; f < 
f‹rs
; ++f){

152 
i
 = 0; i < 
¥©Ÿl
; ++i){

153 
šdex
 = 
b
*
f‹rs
*
¥©Ÿl
 + 
f
*¥©ŸÈ+ 
i
;

154 
x
[
šdex
] = (x[šdex] - 
m—n
[
f
])/(
	`sq¹
(
v¬Ÿnû
[f]) + .000001f);

158 
	}
}

160 
	$cÚ¡_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
)

162 
i
;

163 
i
 = 0; i < 
N
; ++iè
X
[i*
INCX
] = 
ALPHA
;

164 
	}
}

166 
	$mul_ıu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
)

168 
i
;

169 
i
 = 0; i < 
N
; ++iè
Y
[i*
INCY
] *ğ
X
[i*
INCX
];

170 
	}
}

172 
	$pow_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
)

174 
i
;

175 
i
 = 0; i < 
N
; ++iè
Y
[i*
INCY
] = 
	`pow
(
X
[i*
INCX
], 
ALPHA
);

176 
	}
}

178 
	$axpy_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
)

180 
i
;

181 
i
 = 0; i < 
N
; ++iè
Y
[i*
INCY
] +ğ
ALPHA
*
X
[i*
INCX
];

182 
	}
}

184 
	$sÿl_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
)

186 
i
;

187 
i
 = 0; i < 
N
; ++iè
X
[i*
INCX
] *ğ
ALPHA
;

188 
	}
}

190 
	$fl_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
)

192 
i
;

193 
i
 = 0; i < 
N
; ++iè
X
[i*
INCX
] = 
ALPHA
;

194 
	}
}

196 
	$deš‹r_ıu
(
NX
, *
X
, 
NY
, *
Y
, 
B
, *
OUT
)

198 
i
, 
j
;

199 
šdex
 = 0;

200 
j
 = 0; j < 
B
; ++j) {

201 
i
 = 0; i < 
NX
; ++i){

202 if(
X
èX[
j
*
NX
 + 
i
] +ğ
OUT
[
šdex
];

203 ++
šdex
;

205 
i
 = 0; i < 
NY
; ++i){

206 if(
Y
èY[
j
*
NY
 + 
i
] +ğ
OUT
[
šdex
];

207 ++
šdex
;

210 
	}
}

212 
	$š‹r_ıu
(
NX
, *
X
, 
NY
, *
Y
, 
B
, *
OUT
)

214 
i
, 
j
;

215 
šdex
 = 0;

216 
j
 = 0; j < 
B
; ++j) {

217 
i
 = 0; i < 
NX
; ++i){

218 
OUT
[
šdex
++] = 
X
[
j
*
NX
 + 
i
];

220 
i
 = 0; i < 
NY
; ++i){

221 
OUT
[
šdex
++] = 
Y
[
j
*
NY
 + 
i
];

224 
	}
}

226 
	$cİy_ıu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
)

228 
i
;

229 
i
 = 0; i < 
N
; ++iè
Y
[i*
INCY
] = 
X
[i*
INCX
];

230 
	}
}

232 
	$muÉ_add_što_ıu
(
N
, *
X
, *
Y
, *
Z
)

234 
i
;

235 
i
 = 0; i < 
N
; ++iè
Z
[i] +ğ
X
[i]*
Y
[i];

236 
	}
}

238 
	$smoÙh_l1_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

240 
i
;

241 
i
 = 0; i < 
n
; ++i){

242 
diff
 = 
Œuth
[
i
] - 
´ed
[i];

243 
abs_v®
 = 
	`çbs
(
diff
);

244 if(
abs_v®
 < 1) {

245 
”rÜ
[
i
] = 
diff
 * diff;

246 
d–
[
i
] = 
diff
;

249 
”rÜ
[
i
] = 2*
abs_v®
 - 1;

250 
d–
[
i
] = (
diff
 < 0) ? 1 : -1;

253 
	}
}

255 
	$l1_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

257 
i
;

258 
i
 = 0; i < 
n
; ++i){

259 
diff
 = 
Œuth
[
i
] - 
´ed
[i];

260 
”rÜ
[
i
] = 
	`çbs
(
diff
);

261 
d–
[
i
] = 
diff
 > 0 ? 1 : -1;

263 
	}
}

265 
	$soámax_x_’t_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

267 
i
;

268 
i
 = 0; i < 
n
; ++i){

269 
t
 = 
Œuth
[
i
];

270 
p
 = 
´ed
[
i
];

271 
”rÜ
[
i
] = (
t
è? -
	`log
(
p
) : 0;

272 
d–
[
i
] = 
t
-
p
;

274 
	}
}

276 
	$logi¡ic_x_’t_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

278 
i
;

279 
i
 = 0; i < 
n
; ++i){

280 
t
 = 
Œuth
[
i
];

281 
p
 = 
´ed
[
i
];

282 
”rÜ
[
i
] = -
t
*
	`log
(
p
) - (1-t)*log(1-p);

283 
d–
[
i
] = 
t
-
p
;

285 
	}
}

287 
	$l2_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

289 
i
;

290 
i
 = 0; i < 
n
; ++i){

291 
diff
 = 
Œuth
[
i
] - 
´ed
[i];

292 
”rÜ
[
i
] = 
diff
 * diff;

293 
d–
[
i
] = 
diff
;

295 
	}
}

297 
	$dÙ_ıu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
)

299 
i
;

300 
dÙ
 = 0;

301 
i
 = 0; i < 
N
; ++iè
dÙ
 +ğ
X
[i*
INCX
] * 
Y
[i*
INCY
];

302  
dÙ
;

303 
	}
}

305 
	$soámax
(*
šput
, 
n
, 
‹mp
, 
¡ride
, *
ouut
)

307 
i
;

308 
sum
 = 0;

309 
Ïrge¡
 = -
FLT_MAX
;

310 
i
 = 0; i < 
n
; ++i){

311 if(
šput
[
i
*
¡ride
] > 
Ïrge¡
)†argest = input[i*stride];

313 
i
 = 0; i < 
n
; ++i){

314 
e
 = 
	`exp
(
šput
[
i
*
¡ride
]/
‹mp
 - 
Ïrge¡
/temp);

315 
sum
 +ğ
e
;

316 
ouut
[
i
*
¡ride
] = 
e
;

318 
i
 = 0; i < 
n
; ++i){

319 
ouut
[
i
*
¡ride
] /ğ
sum
;

321 
	}
}

324 
	$soámax_ıu
(*
šput
, 
n
, 
b©ch
, 
b©ch_off£t
, 
groups
, 
group_off£t
, 
¡ride
, 
‹mp
, *
ouut
)

326 
g
, 
b
;

327 
b
 = 0; b < 
b©ch
; ++b){

328 
g
 = 0; g < 
groups
; ++g){

329 
	`soámax
(
šput
 + 
b
*
b©ch_off£t
 + 
g
*
group_off£t
, 
n
, 
‹mp
, 
¡ride
, 
ouut
 + b*batch_offset + g*group_offset);

332 
	}
}

334 
	$up§m¶e_ıu
(*
š
, 
w
, 
h
, 
c
, 
b©ch
, 
¡ride
, 
fÜw¬d
, 
sÿË
, *
out
)

336 
i
, 
j
, 
k
, 
b
;

337 
b
 = 0; b < 
b©ch
; ++b){

338 
k
 = 0; k < 
c
; ++k){

339 
j
 = 0; j < 
h
*
¡ride
; ++j){

340 
i
 = 0; i < 
w
*
¡ride
; ++i){

341 
š_šdex
 = 
b
*
w
*
h
*
c
 + 
k
*w*h + (
j
/
¡ride
)*w + 
i
/stride;

342 
out_šdex
 = 
b
*
w
*
h
*
c
*
¡ride
*¡rid+ 
k
*w*h*¡ride*¡rid+ 
j
*w*¡rid+ 
i
;

343 if(
fÜw¬d
è
out
[
out_šdex
] = 
sÿË
*
š
[
š_šdex
];

344 
š
[
š_šdex
] +ğ
sÿË
*
out
[
out_šdex
];

349 
	}
}

	@host/src/blas.h

1 #iâdeà
BLAS_H


2 
	#BLAS_H


	)

3 
	~"d¬kÃt.h
"

5 
æ©‹n
(*
x
, 
size
, 
Ïy”s
, 
b©ch
, 
fÜw¬d
);

6 
pm
(
M
, 
N
, *
A
);

7 *
¿ndom_m©rix
(
rows
, 
cŞs
);

8 
time_¿ndom_m©rix
(
TA
, 
TB
, 
m
, 
k
, 
n
);

9 
»Üg_ıu
(*
x
, 
w
, 
h
, 
c
, 
b©ch
, 
¡ride
, 
fÜw¬d
, *
out
);

11 
‹¡_bÏs
();

13 
š‹r_ıu
(
NX
, *
X
, 
NY
, *
Y
, 
B
, *
OUT
);

14 
deš‹r_ıu
(
NX
, *
X
, 
NY
, *
Y
, 
B
, *
OUT
);

15 
muÉ_add_što_ıu
(
N
, *
X
, *
Y
, *
Z
);

17 
cÚ¡_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
);

18 
cÚ¡¿š_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
);

19 
pow_ıu
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
);

20 
mul_ıu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
);

22 
‹¡_gpu_bÏs
();

23 
shÜtcut_ıu
(
b©ch
, 
w1
, 
h1
, 
c1
, *
add
, 
w2
, 
h2
, 
c2
, 
s1
, 
s2
, *
out
);

25 
m—n_ıu
(*
x
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n
);

26 
v¬Ÿnû_ıu
(*
x
, *
m—n
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû
);

28 
sÿË_bŸs
(*
ouut
, *
sÿËs
, 
b©ch
, 
n
, 
size
);

29 
backw¬d_sÿË_ıu
(*
x_nÜm
, *
d–
, 
b©ch
, 
n
, 
size
, *
sÿË_upd©es
);

30 
m—n_d–_ıu
(*
d–
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n_d–
);

31 
v¬Ÿnû_d–_ıu
(*
x
, *
d–
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû_d–
);

32 
nÜm®ize_d–_ıu
(*
x
, *
m—n
, *
v¬Ÿnû
, *
m—n_d–
, *
v¬Ÿnû_d–
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
d–
);

33 
l2nÜm®ize_ıu
(*
x
, *
dx
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
);

35 
smoÙh_l1_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

36 
l2_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

37 
l1_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

38 
logi¡ic_x_’t_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

39 
soámax_x_’t_ıu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

40 
weigh‹d_sum_ıu
(*
a
, *
b
, *
s
, 
num
, *
c
);

41 
weigh‹d_d–_ıu
(*
a
, *
b
, *
s
, *
da
, *
db
, *
ds
, 
n
, *
dc
);

43 
soámax
(*
šput
, 
n
, 
‹mp
, 
¡ride
, *
ouut
);

44 
soámax_ıu
(*
šput
, 
n
, 
b©ch
, 
b©ch_off£t
, 
groups
, 
group_off£t
, 
¡ride
, 
‹mp
, *
ouut
);

45 
up§m¶e_ıu
(*
š
, 
w
, 
h
, 
c
, 
b©ch
, 
¡ride
, 
fÜw¬d
, 
sÿË
, *
out
);

47 #ifdeà
GPU


48 
	~"cuda.h
"

49 
	~"Œ“.h
"

51 
axpy_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
, * 
Y
, 
INCY
);

52 
axpy_gpu_off£t
(
N
, 
ALPHA
, * 
X
, 
OFFX
, 
INCX
, * 
Y
, 
OFFY
, 
INCY
);

53 
cİy_gpu
(
N
, * 
X
, 
INCX
, * 
Y
, 
INCY
);

54 
cİy_gpu_off£t
(
N
, * 
X
, 
OFFX
, 
INCX
, * 
Y
, 
OFFY
, 
INCY
);

55 
add_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
);

56 
suµ_gpu
(
N
, 
ALPHA
, * 
X
, 
INCX
);

57 
mask_gpu
(
N
, * 
X
, 
mask_num
, * 
mask
, 
v®
);

58 
sÿË_mask_gpu
(
N
, * 
X
, 
mask_num
, * 
mask
, 
sÿË
);

59 
cÚ¡_gpu
(
N
, 
ALPHA
, *
X
, 
INCX
);

60 
pow_gpu
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
);

61 
mul_gpu
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
);

63 
m—n_gpu
(*
x
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n
);

64 
v¬Ÿnû_gpu
(*
x
, *
m—n
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû
);

65 
nÜm®ize_gpu
(*
x
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
);

66 
l2nÜm®ize_gpu
(*
x
, *
dx
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
);

68 
nÜm®ize_d–_gpu
(*
x
, *
m—n
, *
v¬Ÿnû
, *
m—n_d–
, *
v¬Ÿnû_d–
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
d–
);

70 
ç¡_m—n_d–_gpu
(*
d–
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n_d–
);

71 
ç¡_v¬Ÿnû_d–_gpu
(*
x
, *
d–
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû_d–
);

73 
ç¡_v¬Ÿnû_gpu
(*
x
, *
m—n
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû
);

74 
ç¡_m—n_gpu
(*
x
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n
);

75 
shÜtcut_gpu
(
b©ch
, 
w1
, 
h1
, 
c1
, *
add
, 
w2
, 
h2
, 
c2
, 
s1
, 
s2
, *
out
);

76 
sÿË_bŸs_gpu
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

77 
backw¬d_sÿË_gpu
(*
x_nÜm
, *
d–
, 
b©ch
, 
n
, 
size
, *
sÿË_upd©es
);

78 
sÿË_bŸs_gpu
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

79 
add_bŸs_gpu
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

80 
backw¬d_bŸs_gpu
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
);

82 
logi¡ic_x_’t_gpu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

83 
soámax_x_’t_gpu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

84 
smoÙh_l1_gpu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

85 
l2_gpu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

86 
l1_gpu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

87 
wgª_gpu
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

88 
weigh‹d_d–_gpu
(*
a
, *
b
, *
s
, *
da
, *
db
, *
ds
, 
num
, *
dc
);

89 
weigh‹d_sum_gpu
(*
a
, *
b
, *
s
, 
num
, *
c
);

90 
muÉ_add_što_gpu
(
num
, *
a
, *
b
, *
c
);

91 
š‹r_gpu
(
NX
, *
X
, 
NY
, *
Y
, 
B
, *
OUT
);

92 
deš‹r_gpu
(
NX
, *
X
, 
NY
, *
Y
, 
B
, *
OUT
);

94 
»Üg_gpu
(*
x
, 
w
, 
h
, 
c
, 
b©ch
, 
¡ride
, 
fÜw¬d
, *
out
);

96 
soámax_gpu
(*
šput
, 
n
, 
b©ch
, 
b©ch_off£t
, 
groups
, 
group_off£t
, 
¡ride
, 
‹mp
, *
ouut
);

97 
adam_upd©e_gpu
(*
w
, *
d
, *
m
, *
v
, 
B1
, 
B2
, 
•s
, 
deÿy
, 
¿‹
, 
n
, 
b©ch
, 
t
);

98 
adam_gpu
(
n
, *
x
, *
m
, *
v
, 
B1
, 
B2
, 
¿‹
, 
•s
, 
t
);

100 
æ©‹n_gpu
(*
x
, 
¥©Ÿl
, 
Ïy”s
, 
b©ch
, 
fÜw¬d
, *
out
);

101 
soámax_Œ“
(*
šput
, 
¥©Ÿl
, 
b©ch
, 
¡ride
, 
‹mp
, *
ouut
, 
Œ“
 
h›r
);

102 
up§m¶e_gpu
(*
š
, 
w
, 
h
, 
c
, 
b©ch
, 
¡ride
, 
fÜw¬d
, 
sÿË
, *
out
);

	@host/src/box.c

1 
	~"box.h
"

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~<¡dlib.h
>

6 
	$nms_com·¿tÜ
(cÚ¡ *
·
, cÚ¡ *
pb
)

8 
d‘eùiÚ
 
a
 = *(d‘eùiÚ *)
·
;

9 
d‘eùiÚ
 
b
 = *(d‘eùiÚ *)
pb
;

10 
diff
 = 0;

11 if(
b
.
sÜt_şass
 >= 0){

12 
diff
 = 
a
.
´ob
[
b
.
sÜt_şass
] - b.prob[b.sort_class];

14 
diff
 = 
a
.
objeùÃss
 - 
b
.objectness;

16 if(
diff
 < 0)  1;

17 if(
diff
 > 0)  -1;

19 
	}
}

21 
	$do_nms_obj
(
d‘eùiÚ
 *
d‘s
, 
tÙ®
, 
şas£s
, 
th»sh
)

23 
i
, 
j
, 
k
;

24 
k
 = 
tÙ®
-1;

25 
i
 = 0; i <ğ
k
; ++i){

26 if(
d‘s
[
i
].
objeùÃss
 == 0){

27 
d‘eùiÚ
 
sw­
 = 
d‘s
[
i
];

28 
d‘s
[
i
] = d‘s[
k
];

29 
d‘s
[
k
] = 
sw­
;

30 --
k
;

31 --
i
;

34 
tÙ®
 = 
k
+1;

36 
i
 = 0; i < 
tÙ®
; ++i){

37 
d‘s
[
i
].
sÜt_şass
 = -1;

40 
	`qsÜt
(
d‘s
, 
tÙ®
, (
d‘eùiÚ
), 
nms_com·¿tÜ
);

41 
i
 = 0; i < 
tÙ®
; ++i){

42 if(
d‘s
[
i
].
objeùÃss
 == 0) ;

43 
box
 
a
 = 
d‘s
[
i
].
bbox
;

44 
j
 = 
i
+1; j < 
tÙ®
; ++j){

45 if(
d‘s
[
j
].
objeùÃss
 == 0) ;

46 
box
 
b
 = 
d‘s
[
j
].
bbox
;

47 ià(
	`box_iou
(
a
, 
b
è> 
th»sh
){

48 
d‘s
[
j
].
objeùÃss
 = 0;

49 
k
 = 0; k < 
şas£s
; ++k){

50 
d‘s
[
j
].
´ob
[
k
] = 0;

55 
	}
}

58 
	$do_nms_sÜt
(
d‘eùiÚ
 *
d‘s
, 
tÙ®
, 
şas£s
, 
th»sh
)

60 
i
, 
j
, 
k
;

61 
k
 = 
tÙ®
-1;

62 
i
 = 0; i <ğ
k
; ++i){

63 if(
d‘s
[
i
].
objeùÃss
 == 0){

64 
d‘eùiÚ
 
sw­
 = 
d‘s
[
i
];

65 
d‘s
[
i
] = d‘s[
k
];

66 
d‘s
[
k
] = 
sw­
;

67 --
k
;

68 --
i
;

71 
tÙ®
 = 
k
+1;

73 
k
 = 0; k < 
şas£s
; ++k){

74 
i
 = 0; i < 
tÙ®
; ++i){

75 
d‘s
[
i
].
sÜt_şass
 = 
k
;

77 
	`qsÜt
(
d‘s
, 
tÙ®
, (
d‘eùiÚ
), 
nms_com·¿tÜ
);

78 
i
 = 0; i < 
tÙ®
; ++i){

79 if(
d‘s
[
i
].
´ob
[
k
] == 0) ;

80 
box
 
a
 = 
d‘s
[
i
].
bbox
;

81 
j
 = 
i
+1; j < 
tÙ®
; ++j){

82 
box
 
b
 = 
d‘s
[
j
].
bbox
;

83 ià(
	`box_iou
(
a
, 
b
è> 
th»sh
){

84 
d‘s
[
j
].
´ob
[
k
] = 0;

89 
	}
}

91 
box
 
	$æßt_to_box
(*
f
, 
¡ride
)

93 
box
 
b
 = {0};

94 
b
.
x
 = 
f
[0];

95 
b
.
y
 = 
f
[1*
¡ride
];

96 
b
.
w
 = 
f
[2*
¡ride
];

97 
b
.
h
 = 
f
[3*
¡ride
];

98  
b
;

99 
	}
}

101 
dbox
 
	$d”iv©ive
(
box
 
a
, box 
b
)

103 
dbox
 
d
;

104 
d
.
dx
 = 0;

105 
d
.
dw
 = 0;

106 
l1
 = 
a
.
x
 -‡.
w
/2;

107 
l2
 = 
b
.
x
 - b.
w
/2;

108 ià(
l1
 > 
l2
){

109 
d
.
dx
 -= 1;

110 
d
.
dw
 += .5;

112 
r1
 = 
a
.
x
 +‡.
w
/2;

113 
r2
 = 
b
.
x
 + b.
w
/2;

114 if(
r1
 < 
r2
){

115 
d
.
dx
 += 1;

116 
d
.
dw
 += .5;

118 ià(
l1
 > 
r2
) {

119 
d
.
dx
 = -1;

120 
d
.
dw
 = 0;

122 ià(
r1
 < 
l2
){

123 
d
.
dx
 = 1;

124 
d
.
dw
 = 0;

127 
d
.
dy
 = 0;

128 
d
.
dh
 = 0;

129 
t1
 = 
a
.
y
 -‡.
h
/2;

130 
t2
 = 
b
.
y
 - b.
h
/2;

131 ià(
t1
 > 
t2
){

132 
d
.
dy
 -= 1;

133 
d
.
dh
 += .5;

135 
b1
 = 
a
.
y
 +‡.
h
/2;

136 
b2
 = 
b
.
y
 + b.
h
/2;

137 if(
b1
 < 
b2
){

138 
d
.
dy
 += 1;

139 
d
.
dh
 += .5;

141 ià(
t1
 > 
b2
) {

142 
d
.
dy
 = -1;

143 
d
.
dh
 = 0;

145 ià(
b1
 < 
t2
){

146 
d
.
dy
 = 1;

147 
d
.
dh
 = 0;

149  
d
;

150 
	}
}

152 
	$ov”Ïp
(
x1
, 
w1
, 
x2
, 
w2
)

154 
l1
 = 
x1
 - 
w1
/2;

155 
l2
 = 
x2
 - 
w2
/2;

156 
Ëá
 = 
l1
 > 
l2
 ?†1 :†2;

157 
r1
 = 
x1
 + 
w1
/2;

158 
r2
 = 
x2
 + 
w2
/2;

159 
right
 = 
r1
 < 
r2
 ?„1 :„2;

160  
right
 - 
Ëá
;

161 
	}
}

163 
	$box_š‹r£ùiÚ
(
box
 
a
, box 
b
)

165 
w
 = 
	`ov”Ïp
(
a
.
x
,‡.w, 
b
.x, b.w);

166 
h
 = 
	`ov”Ïp
(
a
.
y
,‡.h, 
b
.y, b.h);

167 if(
w
 < 0 || 
h
 < 0)  0;

168 
¬—
 = 
w
*
h
;

169  
¬—
;

170 
	}
}

172 
	$box_uniÚ
(
box
 
a
, box 
b
)

174 
i
 = 
	`box_š‹r£ùiÚ
(
a
, 
b
);

175 
u
 = 
a
.
w
*a.
h
 + 
b
.w*b.h - 
i
;

176  
u
;

177 
	}
}

179 
	$box_iou
(
box
 
a
, box 
b
)

181  
	`box_š‹r£ùiÚ
(
a
, 
b
)/
	`box_uniÚ
(a, b);

182 
	}
}

184 
	$box_rm£
(
box
 
a
, box 
b
)

186  
	`sq¹
(
	`pow
(
a
.
x
-
b
.x, 2) +

187 
	`pow
(
a
.
y
-
b
.y, 2) +

188 
	`pow
(
a
.
w
-
b
.w, 2) +

189 
	`pow
(
a
.
h
-
b
.h, 2));

190 
	}
}

192 
dbox
 
	$dš‹r£ù
(
box
 
a
, box 
b
)

194 
w
 = 
	`ov”Ïp
(
a
.
x
,‡.w, 
b
.x, b.w);

195 
h
 = 
	`ov”Ïp
(
a
.
y
,‡.h, 
b
.y, b.h);

196 
dbox
 
dov”
 = 
	`d”iv©ive
(
a
, 
b
);

197 
dbox
 
di
;

199 
di
.
dw
 = 
dov”
.dw*
h
;

200 
di
.
dx
 = 
dov”
.dx*
h
;

201 
di
.
dh
 = 
dov”
.dh*
w
;

202 
di
.
dy
 = 
dov”
.dy*
w
;

204  
di
;

205 
	}
}

207 
dbox
 
	$duniÚ
(
box
 
a
, box 
b
)

209 
dbox
 
du
;

211 
dbox
 
di
 = 
	`dš‹r£ù
(
a
, 
b
);

212 
du
.
dw
 = 
a
.
h
 - 
di
.dw;

213 
du
.
dh
 = 
a
.
w
 - 
di
.dh;

214 
du
.
dx
 = -
di
.dx;

215 
du
.
dy
 = -
di
.dy;

217  
du
;

218 
	}
}

221 
	$‹¡_duniÚ
()

223 
box
 
a
 = {0, 0, 1, 1};

224 
box
 
dxa
= {0+.0001, 0, 1, 1};

225 
box
 
dya
= {0, 0+.0001, 1, 1};

226 
box
 
dwa
= {0, 0, 1+.0001, 1};

227 
box
 
dha
= {0, 0, 1, 1+.0001};

229 
box
 
b
 = {.5, .5, .2, .2};

230 
dbox
 
di
 = 
	`duniÚ
(
a
,
b
);

231 
	`´štf
("UniÚ: %à%à%à%f\n", 
di
.
dx
, di.
dy
, di.
dw
, di.
dh
);

232 
š‹r
 = 
	`box_uniÚ
(
a
, 
b
);

233 
xš‹r
 = 
	`box_uniÚ
(
dxa
, 
b
);

234 
yš‹r
 = 
	`box_uniÚ
(
dya
, 
b
);

235 
wš‹r
 = 
	`box_uniÚ
(
dwa
, 
b
);

236 
hš‹r
 = 
	`box_uniÚ
(
dha
, 
b
);

237 
xš‹r
 = (xš‹¸- 
š‹r
)/(.0001);

238 
yš‹r
 = (yš‹¸- 
š‹r
)/(.0001);

239 
wš‹r
 = (wš‹¸- 
š‹r
)/(.0001);

240 
hš‹r
 = (hš‹¸- 
š‹r
)/(.0001);

241 
	`´štf
("UniÚ Mªu® %à%à%à%f\n", 
xš‹r
, 
yš‹r
, 
wš‹r
, 
hš‹r
);

242 
	}
}

243 
	$‹¡_dš‹r£ù
()

245 
box
 
a
 = {0, 0, 1, 1};

246 
box
 
dxa
= {0+.0001, 0, 1, 1};

247 
box
 
dya
= {0, 0+.0001, 1, 1};

248 
box
 
dwa
= {0, 0, 1+.0001, 1};

249 
box
 
dha
= {0, 0, 1, 1+.0001};

251 
box
 
b
 = {.5, .5, .2, .2};

252 
dbox
 
di
 = 
	`dš‹r£ù
(
a
,
b
);

253 
	`´štf
("IÁ”: %à%à%à%f\n", 
di
.
dx
, di.
dy
, di.
dw
, di.
dh
);

254 
š‹r
 = 
	`box_š‹r£ùiÚ
(
a
, 
b
);

255 
xš‹r
 = 
	`box_š‹r£ùiÚ
(
dxa
, 
b
);

256 
yš‹r
 = 
	`box_š‹r£ùiÚ
(
dya
, 
b
);

257 
wš‹r
 = 
	`box_š‹r£ùiÚ
(
dwa
, 
b
);

258 
hš‹r
 = 
	`box_š‹r£ùiÚ
(
dha
, 
b
);

259 
xš‹r
 = (xš‹¸- 
š‹r
)/(.0001);

260 
yš‹r
 = (yš‹¸- 
š‹r
)/(.0001);

261 
wš‹r
 = (wš‹¸- 
š‹r
)/(.0001);

262 
hš‹r
 = (hš‹¸- 
š‹r
)/(.0001);

263 
	`´štf
("IÁ” Mªu® %à%à%à%f\n", 
xš‹r
, 
yš‹r
, 
wš‹r
, 
hš‹r
);

264 
	}
}

266 
	$‹¡_box
()

268 
	`‹¡_dš‹r£ù
();

269 
	`‹¡_duniÚ
();

270 
box
 
a
 = {0, 0, 1, 1};

271 
box
 
dxa
= {0+.00001, 0, 1, 1};

272 
box
 
dya
= {0, 0+.00001, 1, 1};

273 
box
 
dwa
= {0, 0, 1+.00001, 1};

274 
box
 
dha
= {0, 0, 1, 1+.00001};

276 
box
 
b
 = {.5, 0, .2, .2};

278 
iou
 = 
	`box_iou
(
a
,
b
);

279 
iou
 = (1-iou)*(1-iou);

280 
	`´štf
("%f\n", 
iou
);

281 
dbox
 
d
 = 
	`diou
(
a
, 
b
);

282 
	`´štf
("%à%à%à%f\n", 
d
.
dx
, d.
dy
, d.
dw
, d.
dh
);

284 
xiou
 = 
	`box_iou
(
dxa
, 
b
);

285 
yiou
 = 
	`box_iou
(
dya
, 
b
);

286 
wiou
 = 
	`box_iou
(
dwa
, 
b
);

287 
hiou
 = 
	`box_iou
(
dha
, 
b
);

288 
xiou
 = ((1-xiou)*(1-xiouè- 
iou
)/(.00001);

289 
yiou
 = ((1-yiou)*(1-yiouè- 
iou
)/(.00001);

290 
wiou
 = ((1-wiou)*(1-wiouè- 
iou
)/(.00001);

291 
hiou
 = ((1-hiou)*(1-hiouè- 
iou
)/(.00001);

292 
	`´štf
("mªu® %à%à%à%f\n", 
xiou
, 
yiou
, 
wiou
, 
hiou
);

293 
	}
}

295 
dbox
 
	$diou
(
box
 
a
, box 
b
)

297 
u
 = 
	`box_uniÚ
(
a
,
b
);

298 
i
 = 
	`box_š‹r£ùiÚ
(
a
,
b
);

299 
dbox
 
di
 = 
	`dš‹r£ù
(
a
,
b
);

300 
dbox
 
du
 = 
	`duniÚ
(
a
,
b
);

301 
dbox
 
dd
 = {0,0,0,0};

303 if(
i
 <= 0 || 1) {

304 
dd
.
dx
 = 
b
.
x
 - 
a
.x;

305 
dd
.
dy
 = 
b
.
y
 - 
a
.y;

306 
dd
.
dw
 = 
b
.
w
 - 
a
.w;

307 
dd
.
dh
 = 
b
.
h
 - 
a
.h;

308  
dd
;

311 
dd
.
dx
 = 2*
	`pow
((1-(
i
/
u
)),1)*(
di
.dx*u - 
du
.dx*i)/(u*u);

312 
dd
.
dy
 = 2*
	`pow
((1-(
i
/
u
)),1)*(
di
.dy*u - 
du
.dy*i)/(u*u);

313 
dd
.
dw
 = 2*
	`pow
((1-(
i
/
u
)),1)*(
di
.dw*u - 
du
.dw*i)/(u*u);

314 
dd
.
dh
 = 2*
	`pow
((1-(
i
/
u
)),1)*(
di
.dh*u - 
du
.dh*i)/(u*u);

315  
dd
;

316 
	}
}

319 
	$do_nms
(
box
 *
boxes
, **
´obs
, 
tÙ®
, 
şas£s
, 
th»sh
)

321 
i
, 
j
, 
k
;

322 
i
 = 0; i < 
tÙ®
; ++i){

323 
ªy
 = 0;

324 
k
 = 0; k < 
şas£s
; ++kè
ªy
 =‡ny || (
´obs
[
i
][k] > 0);

325 if(!
ªy
) {

328 
j
 = 
i
+1; j < 
tÙ®
; ++j){

329 ià(
	`box_iou
(
boxes
[
i
], boxes[
j
]è> 
th»sh
){

330 
k
 = 0; k < 
şas£s
; ++k){

331 ià(
´obs
[
i
][
k
] <…robs[
j
][k])…robs[i][k] = 0;

332 
´obs
[
j
][
k
] = 0;

337 
	}
}

339 
box
 
	$’code_box
(
box
 
b
, box 
ªchÜ
)

341 
box
 
’code
;

342 
’code
.
x
 = (
b
.x - 
ªchÜ
.xè/‡nchÜ.
w
;

343 
’code
.
y
 = (
b
.y - 
ªchÜ
.yè/‡nchÜ.
h
;

344 
’code
.
w
 = 
	`log2
(
b
.w / 
ªchÜ
.w);

345 
’code
.
h
 = 
	`log2
(
b
.h / 
ªchÜ
.h);

346  
’code
;

347 
	}
}

349 
box
 
	$decode_box
(
box
 
b
, box 
ªchÜ
)

351 
box
 
decode
;

352 
decode
.
x
 = 
b
.x * 
ªchÜ
.
w
 +‡nchor.x;

353 
decode
.
y
 = 
b
.y * 
ªchÜ
.
h
 +‡nchor.y;

354 
decode
.
w
 = 
	`pow
(2., 
b
.wè* 
ªchÜ
.w;

355 
decode
.
h
 = 
	`pow
(2., 
b
.hè* 
ªchÜ
.h;

356  
decode
;

357 
	}
}

	@host/src/box.h

1 #iâdeà
BOX_H


2 
	#BOX_H


	)

3 
	~"d¬kÃt.h
"

6 
	mdx
, 
	mdy
, 
	mdw
, 
	mdh
;

7 } 
	tdbox
;

9 
box_rm£
(
box
 
a
, box 
b
);

10 
dbox
 
diou
(
box
 
a
, box 
b
);

11 
box
 
decode_box
(box 
b
, box 
ªchÜ
);

12 
box
 
’code_box
(box 
b
, box 
ªchÜ
);

	@host/src/classifier.h

	@host/src/col2im.c

1 
	~<¡dio.h
>

2 
	~<m©h.h
>

3 
	$cŞ2im_add_pix–
(*
im
, 
height
, 
width
, 
chªÃls
,

4 
row
, 
cŞ
, 
chªÃl
, 
·d
, 
v®
)

6 
row
 -ğ
·d
;

7 
cŞ
 -ğ
·d
;

9 ià(
row
 < 0 || 
cŞ
 < 0 ||

10 
row
 >ğ
height
 || 
cŞ
 >ğ
width
) ;

11 
im
[
cŞ
 + 
width
*(
row
 + 
height
*
chªÃl
)] +ğ
v®
;

12 
	}
}

14 
	$cŞ2im_ıu
(* 
d©a_cŞ
,

15 
chªÃls
, 
height
, 
width
,

16 
ksize
, 
¡ride
, 
·d
, * 
d©a_im
)

18 
c
,
h
,
w
;

19 
height_cŞ
 = (
height
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

20 
width_cŞ
 = (
width
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

22 
chªÃls_cŞ
 = 
chªÃls
 * 
ksize
 * ksize;

23 
c
 = 0; c < 
chªÃls_cŞ
; ++c) {

24 
w_off£t
 = 
c
 % 
ksize
;

25 
h_off£t
 = (
c
 / 
ksize
) % ksize;

26 
c_im
 = 
c
 / 
ksize
 / ksize;

27 
h
 = 0; h < 
height_cŞ
; ++h) {

28 
w
 = 0; w < 
width_cŞ
; ++w) {

29 
im_row
 = 
h_off£t
 + 
h
 * 
¡ride
;

30 
im_cŞ
 = 
w_off£t
 + 
w
 * 
¡ride
;

31 
cŞ_šdex
 = (
c
 * 
height_cŞ
 + 
h
è* 
width_cŞ
 + 
w
;

32 
v®
 = 
d©a_cŞ
[
cŞ_šdex
];

33 
	`cŞ2im_add_pix–
(
d©a_im
, 
height
, 
width
, 
chªÃls
,

34 
im_row
, 
im_cŞ
, 
c_im
, 
·d
, 
v®
);

38 
	}
}

	@host/src/col2im.h

1 #iâdeà
COL2IM_H


2 
	#COL2IM_H


	)

4 
cŞ2im_ıu
(* 
d©a_cŞ
,

5 
chªÃls
, 
height
, 
width
,

6 
ksize
, 
¡ride
, 
·d
, * 
d©a_im
);

8 #ifdeà
GPU


9 
cŞ2im_gpu
(*
d©a_cŞ
,

10 
chªÃls
, 
height
, 
width
,

11 
ksize
, 
¡ride
, 
·d
, *
d©a_im
);

	@host/src/connected_layer.c

1 
	~"cÚÃùed_Ïy”.h
"

2 
	~"cÚvŞutiÚ®_Ïy”.h
"

3 
	~"b©chnÜm_Ïy”.h
"

4 
	~"uts.h
"

5 
	~"cuda.h
"

6 
	~"bÏs.h
"

7 
	~"gemm.h
"

8 
	~"·r£r.h
"

10 
	~<m©h.h
>

11 
	~<¡dio.h
>

12 
	~<¡dlib.h
>

13 
	~<¡ršg.h
>

15 
Ïy”
 
	$make_cÚÃùed_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
)

17 
i
;

18 
Ïy”
 
l
 = {0};

19 
l
.
Ë¬nšg_¿‹_sÿË
 = 1;

20 
l
.
ty³
 = 
CONNECTED
;

22 
l
.
šputs
 = inputs;

23 
l
.
ouuts
 = outputs;

24 
l
.
b©ch
 = batch;

25 
l
.
b©ch_nÜm®ize
 = batch_normalize;

26 
l
.
h
 = 1;

27 
l
.
w
 = 1;

28 
l
.
c
 = 
šputs
;

29 
l
.
out_h
 = 1;

30 
l
.
out_w
 = 1;

31 
l
.
out_c
 = 
ouuts
;

33 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

39 
l
.
weights
 = 
	`ÿÎoc
(
ouuts
*
šputs
, ());

40 
l
.
bŸ£s
 = 
	`ÿÎoc
(
ouuts
, ());

42 
l
.
fÜw¬d
 = 
fÜw¬d_cÚÃùed_Ïy”
;

43 
l
.
backw¬d
 = 
backw¬d_cÚÃùed_Ïy”
;

44 
l
.
upd©e
 = 
upd©e_cÚÃùed_Ïy”
;

47 
sÿË
 = 
	`sq¹
(2./
šputs
);

54 
i
 = 0; i < 
ouuts
; ++i){

55 
l
.
bŸ£s
[
i
] = 0;

58 if(
adam
){

59 
l
.
m
 = 
	`ÿÎoc
Ö.
šputs
*l.
ouuts
, ());

60 
l
.
v
 = 
	`ÿÎoc
Ö.
šputs
*l.
ouuts
, ());

61 
l
.
bŸs_m
 = 
	`ÿÎoc
Ö.
ouuts
, ());

62 
l
.
sÿË_m
 = 
	`ÿÎoc
Ö.
ouuts
, ());

63 
l
.
bŸs_v
 = 
	`ÿÎoc
Ö.
ouuts
, ());

64 
l
.
sÿË_v
 = 
	`ÿÎoc
Ö.
ouuts
, ());

66 if(
b©ch_nÜm®ize
){

67 
l
.
sÿËs
 = 
	`ÿÎoc
(
ouuts
, ());

69 
i
 = 0; i < 
ouuts
; ++i){

70 
l
.
sÿËs
[
i
] = 1;

78 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
ouuts
, ());

79 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
ouuts
, ());

81 
l
.
x
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

85 #ifdeà
GPU


86 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_cÚÃùed_Ïy”_gpu
;

87 
l
.
backw¬d_gpu
 = 
backw¬d_cÚÃùed_Ïy”_gpu
;

88 
l
.
upd©e_gpu
 = 
upd©e_cÚÃùed_Ïy”_gpu
;

90 
l
.
weights_gpu
 = 
	`cuda_make_¬¿y
Ö.
weights
, 
ouuts
*
šputs
);

91 
l
.
bŸ£s_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸ£s
, 
ouuts
);

93 
l
.
weight_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
weight_upd©es
, 
ouuts
*
šputs
);

94 
l
.
bŸs_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_upd©es
, 
ouuts
);

96 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
ouuts
*
b©ch
);

97 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
ouuts
*
b©ch
);

98 ià(
adam
) {

99 
l
.
m_gpu
 = 
	`cuda_make_¬¿y
(0, 
šputs
*
ouuts
);

100 
l
.
v_gpu
 = 
	`cuda_make_¬¿y
(0, 
šputs
*
ouuts
);

101 
l
.
bŸs_m_gpu
 = 
	`cuda_make_¬¿y
(0, 
ouuts
);

102 
l
.
bŸs_v_gpu
 = 
	`cuda_make_¬¿y
(0, 
ouuts
);

103 
l
.
sÿË_m_gpu
 = 
	`cuda_make_¬¿y
(0, 
ouuts
);

104 
l
.
sÿË_v_gpu
 = 
	`cuda_make_¬¿y
(0, 
ouuts
);

107 if(
b©ch_nÜm®ize
){

108 
l
.
m—n_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
ouuts
);

109 
l
.
v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
ouuts
);

111 
l
.
rŞlšg_m—n_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
ouuts
);

112 
l
.
rŞlšg_v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
ouuts
);

114 
l
.
m—n_d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
ouuts
);

115 
l
.
v¬Ÿnû_d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
ouuts
);

117 
l
.
sÿËs_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿËs
, 
ouuts
);

118 
l
.
sÿË_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_upd©es
, 
ouuts
);

120 
l
.
x_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*
ouuts
);

121 
l
.
x_nÜm_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*
ouuts
);

122 #ifdeà
CUDNN


123 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
nÜmT’sÜDesc
);

124 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
d¡T’sÜDesc
);

125 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†.
b©ch
,†.
out_c
,†.
out_h
,†.
out_w
);

126 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
nÜmT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†.
out_c
, 1, 1);

130 
l
.
aùiv©iÚ
 =‡ctivation;

134 
	`årštf
(
¡d”r
, "cÚÃùed %4d -> %4d\n", 
šputs
, 
ouuts
);

136 
	`årštf
(
¡d”r
, "cÚÃùed_TA %4d -> %4d\n", 
šputs
, 
ouuts
);

139  
l
;

140 
	}
}

142 
	$upd©e_cÚÃùed_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

144 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

145 
mom’tum
 = 
a
.momentum;

146 
deÿy
 = 
a
.decay;

147 
b©ch
 = 
a
.batch;

148 
	`axpy_ıu
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es
, 1,†.
bŸ£s
, 1);

149 
	`sÿl_ıu
(
l
.
ouuts
, 
mom’tum
,†.
bŸs_upd©es
, 1);

151 if(
l
.
b©ch_nÜm®ize
){

152 
	`axpy_ıu
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
sÿË_upd©es
, 1,†.
sÿËs
, 1);

153 
	`sÿl_ıu
(
l
.
ouuts
, 
mom’tum
,†.
sÿË_upd©es
, 1);

156 
	`axpy_ıu
(
l
.
šputs
*l.
ouuts
, -
deÿy
*
b©ch
,†.
weights
, 1,†.
weight_upd©es
, 1);

157 
	`axpy_ıu
(
l
.
šputs
*l.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
weight_upd©es
, 1,†.
weights
, 1);

158 
	`sÿl_ıu
(
l
.
šputs
*l.
ouuts
, 
mom’tum
,†.
weight_upd©es
, 1);

159 
	}
}

161 
	$fÜw¬d_cÚÃùed_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

164 
	`fl_ıu
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut
, 1);

165 
m
 = 
l
.
b©ch
;

166 
k
 = 
l
.
šputs
;

167 
n
 = 
l
.
ouuts
;

168 *
a
 = 
Ãt
.
šput
;

169 *
b
 = 
l
.
weights
;

170 *
c
 = 
l
.
ouut
;

171 
	`gemm
(0,1,
m
,
n
,
k
,1,
a
,k,
b
,k,1,
c
,n);

174 if(
l
.
b©ch_nÜm®ize
){

175 
	`fÜw¬d_b©chnÜm_Ïy”
(
l
, 
Ãt
);

177 
	`add_bŸs
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
ouuts
, 1);

179 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

180 
	}
}

182 
	$backw¬d_cÚÃùed_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

184 
	`g¿d›Á_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

186 if(
l
.
b©ch_nÜm®ize
){

187 
	`backw¬d_b©chnÜm_Ïy”
(
l
, 
Ãt
);

190 if(
Ãt
.
šdex
 < 
glob®_dp
){

191 
	`backw¬d_bŸs_diff
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
ouuts
, 1);

193 
	`backw¬d_bŸs
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
ouuts
, 1);

197 
m
 = 
l
.
ouuts
;

198 
k
 = 
l
.
b©ch
;

199 
n
 = 
l
.
šputs
;

200 *
a
 = 
l
.
d–
;

201 *
b
 = 
Ãt
.
šput
;

202 *
c
 = 
l
.
weight_upd©es
;

205 if(
Ãt
.
šdex
 < 
glob®_dp
){

206 
	`gemm_diff
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,n,1,
c
,n);

208 
	`gemm
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,n,1,
c
,n);

211 
m
 = 
l
.
b©ch
;

212 
k
 = 
l
.
ouuts
;

213 
n
 = 
l
.
šputs
;

215 
a
 = 
l
.
d–
;

216 
b
 = 
l
.
weights
;

217 
c
 = 
Ãt
.
d–
;

219 if(
c
è
	`gemm
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,n,1,c,n);

220 
	}
}

223 
	$d’Üm®ize_cÚÃùed_Ïy”
(
Ïy”
 
l
)

225 
i
, 
j
;

226 
i
 = 0; i < 
l
.
ouuts
; ++i){

227 
sÿË
 = 
l
.
sÿËs
[
i
]/
	`sq¹
Ö.
rŞlšg_v¬Ÿnû
[i] + .000001);

228 
j
 = 0; j < 
l
.
šputs
; ++j){

229 
l
.
weights
[
i
*l.
šputs
 + 
j
] *ğ
sÿË
;

231 
l
.
bŸ£s
[
i
] -ğl.
rŞlšg_m—n
[i] * 
sÿË
;

232 
l
.
sÿËs
[
i
] = 1;

233 
l
.
rŞlšg_m—n
[
i
] = 0;

234 
l
.
rŞlšg_v¬Ÿnû
[
i
] = 1;

236 
	}
}

239 
	$¡©i¡ics_cÚÃùed_Ïy”
(
Ïy”
 
l
)

241 if(
l
.
b©ch_nÜm®ize
){

242 
	`´štf
("Scales ");

243 
	`´št_¡©i¡ics
(
l
.
sÿËs
,†.
ouuts
);

251 
	`´štf
("Biases ");

252 
	`´št_¡©i¡ics
(
l
.
bŸ£s
,†.
ouuts
);

253 
	`´štf
("Weights ");

254 
	`´št_¡©i¡ics
(
l
.
weights
,†.
ouuts
);

255 
	}
}

257 #ifdeà
GPU


259 
	$puÎ_cÚÃùed_Ïy”
(
Ïy”
 
l
)

261 
	`cuda_puÎ_¬¿y
(
l
.
weights_gpu
,†.
weights
,†.
šputs
*l.
ouuts
);

262 
	`cuda_puÎ_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸ£s
,†.
ouuts
);

263 
	`cuda_puÎ_¬¿y
(
l
.
weight_upd©es_gpu
,†.
weight_upd©es
,†.
šputs
*l.
ouuts
);

264 
	`cuda_puÎ_¬¿y
(
l
.
bŸs_upd©es_gpu
,†.
bŸs_upd©es
,†.
ouuts
);

265 ià(
l
.
b©ch_nÜm®ize
){

266 
	`cuda_puÎ_¬¿y
(
l
.
sÿËs_gpu
,†.
sÿËs
,†.
ouuts
);

267 
	`cuda_puÎ_¬¿y
(
l
.
rŞlšg_m—n_gpu
,†.
rŞlšg_m—n
,†.
ouuts
);

268 
	`cuda_puÎ_¬¿y
(
l
.
rŞlšg_v¬Ÿnû_gpu
,†.
rŞlšg_v¬Ÿnû
,†.
ouuts
);

270 
	}
}

272 
	$push_cÚÃùed_Ïy”
(
Ïy”
 
l
)

274 
	`cuda_push_¬¿y
(
l
.
weights_gpu
,†.
weights
,†.
šputs
*l.
ouuts
);

275 
	`cuda_push_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸ£s
,†.
ouuts
);

276 
	`cuda_push_¬¿y
(
l
.
weight_upd©es_gpu
,†.
weight_upd©es
,†.
šputs
*l.
ouuts
);

277 
	`cuda_push_¬¿y
(
l
.
bŸs_upd©es_gpu
,†.
bŸs_upd©es
,†.
ouuts
);

278 ià(
l
.
b©ch_nÜm®ize
){

279 
	`cuda_push_¬¿y
(
l
.
sÿËs_gpu
,†.
sÿËs
,†.
ouuts
);

280 
	`cuda_push_¬¿y
(
l
.
rŞlšg_m—n_gpu
,†.
rŞlšg_m—n
,†.
ouuts
);

281 
	`cuda_push_¬¿y
(
l
.
rŞlšg_v¬Ÿnû_gpu
,†.
rŞlšg_v¬Ÿnû
,†.
ouuts
);

283 
	}
}

285 
	$upd©e_cÚÃùed_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

287 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

288 
mom’tum
 = 
a
.momentum;

289 
deÿy
 = 
a
.decay;

290 
b©ch
 = 
a
.batch;

291 if(
a
.
adam
){

292 
	`adam_upd©e_gpu
(
l
.
weights_gpu
,†.
weight_upd©es_gpu
,†.
m_gpu
,†.
v_gpu
, 
a
.
B1
,‡.
B2
,‡.
•s
, 
deÿy
, 
Ë¬nšg_¿‹
,†.
šputs
*l.
ouuts
, 
b©ch
,‡.
t
);

293 
	`adam_upd©e_gpu
(
l
.
bŸ£s_gpu
,†.
bŸs_upd©es_gpu
,†.
bŸs_m_gpu
,†.
bŸs_v_gpu
, 
a
.
B1
,‡.
B2
,‡.
•s
, 
deÿy
, 
Ë¬nšg_¿‹
,†.
ouuts
, 
b©ch
,‡.
t
);

294 if(
l
.
sÿËs_gpu
){

295 
	`adam_upd©e_gpu
(
l
.
sÿËs_gpu
,†.
sÿË_upd©es_gpu
,†.
sÿË_m_gpu
,†.
sÿË_v_gpu
, 
a
.
B1
,‡.
B2
,‡.
•s
, 
deÿy
, 
Ë¬nšg_¿‹
,†.
ouuts
, 
b©ch
,‡.
t
);

298 
	`axpy_gpu
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es_gpu
, 1,†.
bŸ£s_gpu
, 1);

299 
	`sÿl_gpu
(
l
.
ouuts
, 
mom’tum
,†.
bŸs_upd©es_gpu
, 1);

301 if(
l
.
b©ch_nÜm®ize
){

302 
	`axpy_gpu
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
sÿË_upd©es_gpu
, 1,†.
sÿËs_gpu
, 1);

303 
	`sÿl_gpu
(
l
.
ouuts
, 
mom’tum
,†.
sÿË_upd©es_gpu
, 1);

306 
	`axpy_gpu
(
l
.
šputs
*l.
ouuts
, -
deÿy
*
b©ch
,†.
weights_gpu
, 1,†.
weight_upd©es_gpu
, 1);

307 
	`axpy_gpu
(
l
.
šputs
*l.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
weight_upd©es_gpu
, 1,†.
weights_gpu
, 1);

308 
	`sÿl_gpu
(
l
.
šputs
*l.
ouuts
, 
mom’tum
,†.
weight_upd©es_gpu
, 1);

310 
	}
}

312 
	$fÜw¬d_cÚÃùed_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

314 
	`fl_gpu
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut_gpu
, 1);

316 
m
 = 
l
.
b©ch
;

317 
k
 = 
l
.
šputs
;

318 
n
 = 
l
.
ouuts
;

319 * 
a
 = 
Ãt
.
šput_gpu
;

320 * 
b
 = 
l
.
weights_gpu
;

321 * 
c
 = 
l
.
ouut_gpu
;

322 
	`gemm_gpu
(0,1,
m
,
n
,
k
,1,
a
,k,
b
,k,1,
c
,n);

324 ià(
l
.
b©ch_nÜm®ize
) {

325 
	`fÜw¬d_b©chnÜm_Ïy”_gpu
(
l
, 
Ãt
);

327 
	`add_bŸs_gpu
(
l
.
ouut_gpu
,†.
bŸ£s_gpu
,†.
b©ch
,†.
ouuts
, 1);

329 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

330 
	}
}

332 
	$backw¬d_cÚÃùed_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

334 
	`cÚ¡¿š_gpu
(
l
.
ouuts
*l.
b©ch
, 1,†.
d–_gpu
, 1);

335 
	`g¿d›Á_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–_gpu
);

336 if(
l
.
b©ch_nÜm®ize
){

337 
	`backw¬d_b©chnÜm_Ïy”_gpu
(
l
, 
Ãt
);

339 
	`backw¬d_bŸs_gpu
(
l
.
bŸs_upd©es_gpu
,†.
d–_gpu
,†.
b©ch
,†.
ouuts
, 1);

342 
m
 = 
l
.
ouuts
;

343 
k
 = 
l
.
b©ch
;

344 
n
 = 
l
.
šputs
;

345 * 
a
 = 
l
.
d–_gpu
;

346 * 
b
 = 
Ãt
.
šput_gpu
;

347 * 
c
 = 
l
.
weight_upd©es_gpu
;

348 
	`gemm_gpu
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,n,1,
c
,n);

350 
m
 = 
l
.
b©ch
;

351 
k
 = 
l
.
ouuts
;

352 
n
 = 
l
.
šputs
;

354 
a
 = 
l
.
d–_gpu
;

355 
b
 = 
l
.
weights_gpu
;

356 
c
 = 
Ãt
.
d–_gpu
;

358 if(
c
è
	`gemm_gpu
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,n,1,c,n);

359 
	}
}

	@host/src/connected_layer.h

1 #iâdeà
CONNECTED_LAYER_H


2 
	#CONNECTED_LAYER_H


	)

4 
	~"aùiv©iÚs.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_cÚÃùed_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

10 
fÜw¬d_cÚÃùed_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
backw¬d_cÚÃùed_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
upd©e_cÚÃùed_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

14 #ifdeà
GPU


15 
fÜw¬d_cÚÃùed_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_cÚÃùed_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 
upd©e_cÚÃùed_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

18 
push_cÚÃùed_Ïy”
(
Ïy”
 
l
);

19 
puÎ_cÚÃùed_Ïy”
(
Ïy”
 
l
);

	@host/src/convolutional_layer.c

1 
	~"difåriv©e.h
"

3 
	~"cÚvŞutiÚ®_Ïy”.h
"

4 
	~"uts.h
"

5 
	~"b©chnÜm_Ïy”.h
"

6 
	~"im2cŞ.h
"

7 
	~"cŞ2im.h
"

8 
	~"bÏs.h
"

9 
	~"gemm.h
"

11 
	~"·r£r.h
"

13 
	~<¡dio.h
>

14 
	~<time.h
>

16 #ifdeà
AI2


17 
	~"xnÜ_Ïy”.h
"

20 
	$sw­_bš¬y
(
cÚvŞutiÚ®_Ïy”
 *
l
)

22 *
sw­
 = 
l
->
weights
;

23 
l
->
weights
 =†->
bš¬y_weights
;

24 
l
->
bš¬y_weights
 = 
sw­
;

26 #ifdeà
GPU


27 
sw­
 = 
l
->
weights_gpu
;

28 
l
->
weights_gpu
 =†->
bš¬y_weights_gpu
;

29 
l
->
bš¬y_weights_gpu
 = 
sw­
;

31 
	}
}

33 
	$bš¬ize_weights
(*
weights
, 
n
, 
size
, *
bš¬y
)

35 
i
, 
f
;

36 
f
 = 0; f < 
n
; ++f){

37 
m—n
 = 0;

38 
i
 = 0; i < 
size
; ++i){

39 
m—n
 +ğ
	`çbs
(
weights
[
f
*
size
 + 
i
]);

41 
m—n
 = m—À/ 
size
;

42 
i
 = 0; i < 
size
; ++i){

43 
bš¬y
[
f
*
size
 + 
i
] = (
weights
[f*siz+ i] > 0è? 
m—n
 : -mean;

46 
	}
}

48 
	$bš¬ize_ıu
(*
šput
, 
n
, *
bš¬y
)

50 
i
;

51 
i
 = 0; i < 
n
; ++i){

52 
bš¬y
[
i
] = (
šput
[i] > 0) ? 1 : -1;

54 
	}
}

56 
	$bš¬ize_šput
(*
šput
, 
n
, 
size
, *
bš¬y
)

58 
i
, 
s
;

59 
s
 = 0; s < 
size
; ++s){

60 
m—n
 = 0;

61 
i
 = 0; i < 
n
; ++i){

62 
m—n
 +ğ
	`çbs
(
šput
[
i
*
size
 + 
s
]);

64 
m—n
 = m—À/ 
n
;

65 
i
 = 0; i < 
n
; ++i){

66 
bš¬y
[
i
*
size
 + 
s
] = (
šput
[i*siz+ s] > 0è? 
m—n
 : -mean;

69 
	}
}

71 
	$cÚvŞutiÚ®_out_height
(
cÚvŞutiÚ®_Ïy”
 
l
)

73  (
l
.
h
 + 2*l.
·d
 -†.
size
è/†.
¡ride
 + 1;

74 
	}
}

76 
	$cÚvŞutiÚ®_out_width
(
cÚvŞutiÚ®_Ïy”
 
l
)

78  (
l
.
w
 + 2*l.
·d
 -†.
size
è/†.
¡ride
 + 1;

79 
	}
}

81 
image
 
	$g‘_cÚvŞutiÚ®_image
(
cÚvŞutiÚ®_Ïy”
 
l
)

83  
	`æßt_to_image
(
l
.
out_w
,l.
out_h
,l.
out_c
,l.
ouut
);

84 
	}
}

86 
image
 
	$g‘_cÚvŞutiÚ®_d–
(
cÚvŞutiÚ®_Ïy”
 
l
)

88  
	`æßt_to_image
(
l
.
out_w
,l.
out_h
,l.
out_c
,l.
d–
);

89 
	}
}

91 
size_t
 
	$g‘_wÜk¥aû_size
(
Ïy”
 
l
){

92 #ifdeà
CUDNN


93 if(
gpu_šdex
 >= 0){

94 
size_t
 
mo¡
 = 0;

95 
size_t
 
s
 = 0;

96 
	`cudÂG‘CÚvŞutiÚFÜw¬dWÜk¥aûSize
(
	`cudÂ_hªdË
(),

97 
l
.
¤cT’sÜDesc
,

98 
l
.
weightDesc
,

99 
l
.
cÚvDesc
,

100 
l
.
d¡T’sÜDesc
,

101 
l
.
fw_®go
,

102 &
s
);

103 ià(
s
 > 
mo¡
) most = s;

104 
	`cudÂG‘CÚvŞutiÚBackw¬dF‹rWÜk¥aûSize
(
	`cudÂ_hªdË
(),

105 
l
.
¤cT’sÜDesc
,

106 
l
.
dd¡T’sÜDesc
,

107 
l
.
cÚvDesc
,

108 
l
.
dweightDesc
,

109 
l
.
bf_®go
,

110 &
s
);

111 ià(
s
 > 
mo¡
) most = s;

112 
	`cudÂG‘CÚvŞutiÚBackw¬dD©aWÜk¥aûSize
(
	`cudÂ_hªdË
(),

113 
l
.
weightDesc
,

114 
l
.
dd¡T’sÜDesc
,

115 
l
.
cÚvDesc
,

116 
l
.
d¤cT’sÜDesc
,

117 
l
.
bd_®go
,

118 &
s
);

119 ià(
s
 > 
mo¡
) most = s;

120  
mo¡
;

123  (
size_t
)
l
.
out_h
*l.
out_w
*l.
size
*l.size*l.
c
/l.
groups
*();

124 
	}
}

126 #ifdeà
GPU


127 #ifdeà
CUDNN


128 
	$cudÂ_cÚvŞutiÚ®_£tup
(
Ïy”
 *
l
)

130 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
d¤cT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†->
b©ch
,†->
c
,†->
h
,†->
w
);

131 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
dd¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†->
b©ch
,†->
out_c
,†->
out_h
,†->
out_w
);

133 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
¤cT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†->
b©ch
,†->
c
,†->
h
,†->
w
);

134 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†->
b©ch
,†->
out_c
,†->
out_h
,†->
out_w
);

135 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
nÜmT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†->
out_c
, 1, 1);

137 
	`cudÂS‘F‹r4dDesütÜ
(
l
->
dweightDesc
, 
CUDNN_DATA_FLOAT
, 
CUDNN_TENSOR_NCHW
,†->
n
,†->
c
/l->
groups
,†->
size
,†->size);

138 
	`cudÂS‘F‹r4dDesütÜ
(
l
->
weightDesc
, 
CUDNN_DATA_FLOAT
, 
CUDNN_TENSOR_NCHW
,†->
n
,†->
c
/l->
groups
,†->
size
,†->size);

139 #ià
CUDNN_MAJOR
 >= 6

140 
	`cudÂS‘CÚvŞutiÚ2dDesütÜ
(
l
->
cÚvDesc
,†->
·d
,†->·d,†->
¡ride
,†->¡ride, 1, 1, 
CUDNN_CROSS_CORRELATION
, 
CUDNN_DATA_FLOAT
);

142 
	`cudÂS‘CÚvŞutiÚ2dDesütÜ
(
l
->
cÚvDesc
,†->
·d
,†->·d,†->
¡ride
,†->¡ride, 1, 1, 
CUDNN_CROSS_CORRELATION
);

145 #ià
CUDNN_MAJOR
 >= 7

146 
	`cudÂS‘CÚvŞutiÚGroupCouÁ
(
l
->
cÚvDesc
,†->
groups
);

148 if(
l
->
groups
 > 1){

149 
	`”rÜ
("CUDNN < 7 doesn't support groups,…lease upgrade!");

153 
	`cudÂG‘CÚvŞutiÚFÜw¬dAlgÜ™hm
(
	`cudÂ_hªdË
(),

154 
l
->
¤cT’sÜDesc
,

155 
l
->
weightDesc
,

156 
l
->
cÚvDesc
,

157 
l
->
d¡T’sÜDesc
,

158 
CUDNN_CONVOLUTION_FWD_SPECIFY_WORKSPACE_LIMIT
,

160 &
l
->
fw_®go
);

161 
	`cudÂG‘CÚvŞutiÚBackw¬dD©aAlgÜ™hm
(
	`cudÂ_hªdË
(),

162 
l
->
weightDesc
,

163 
l
->
dd¡T’sÜDesc
,

164 
l
->
cÚvDesc
,

165 
l
->
d¤cT’sÜDesc
,

166 
CUDNN_CONVOLUTION_BWD_DATA_SPECIFY_WORKSPACE_LIMIT
,

168 &
l
->
bd_®go
);

169 
	`cudÂG‘CÚvŞutiÚBackw¬dF‹rAlgÜ™hm
(
	`cudÂ_hªdË
(),

170 
l
->
¤cT’sÜDesc
,

171 
l
->
dd¡T’sÜDesc
,

172 
l
->
cÚvDesc
,

173 
l
->
dweightDesc
,

174 
CUDNN_CONVOLUTION_BWD_FILTER_SPECIFY_WORKSPACE_LIMIT
,

176 &
l
->
bf_®go
);

177 
	}
}

181 
cÚvŞutiÚ®_Ïy”
 
	$make_cÚvŞutiÚ®_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
)

183 
i
;

184 
cÚvŞutiÚ®_Ïy”
 
l
 = {0};

185 
l
.
ty³
 = 
CONVOLUTIONAL
;

187 
l
.
groups
 = groups;

188 
l
.
h
 = h;

189 
l
.
w
 = w;

190 
l
.
c
 = c;

191 
l
.
n
 =‚;

192 
l
.
bš¬y
 = binary;

193 
l
.
xnÜ
 = xnor;

194 
l
.
b©ch
 = batch;

195 
l
.
¡ride
 = stride;

196 
l
.
size
 = size;

197 
l
.
·d
 = 
·ddšg
;

198 
l
.
b©ch_nÜm®ize
 = batch_normalize;

200 
l
.
weights
 = 
	`ÿÎoc
(
c
/
groups
*
n
*
size
*size, ());

203 
l
.
bŸ£s
 = 
	`ÿÎoc
(
n
, ());

206 
l
.
nweights
 = 
c
/
groups
*
n
*
size
*size;

207 
l
.
nbŸ£s
 = 
n
;

210 
sÿË
 = 
	`sq¹
(2./(
size
*size*
c
/
l
.
groups
));

222 
out_w
 = 
	`cÚvŞutiÚ®_out_width
(
l
);

223 
out_h
 = 
	`cÚvŞutiÚ®_out_height
(
l
);

224 
l
.
out_h
 = out_h;

225 
l
.
out_w
 = out_w;

226 
l
.
out_c
 = 
n
;

227 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

228 
l
.
šputs
 =†.
w
 *†.
h
 *†.
c
;

230 
l
.
ouut
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

233 
l
.
fÜw¬d
 = 
fÜw¬d_cÚvŞutiÚ®_Ïy”
;

234 
l
.
backw¬d
 = 
backw¬d_cÚvŞutiÚ®_Ïy”
;

235 
l
.
upd©e
 = 
upd©e_cÚvŞutiÚ®_Ïy”
;

236 if(
bš¬y
){

237 
l
.
bš¬y_weights
 = 
	`ÿÎoc
Ö.
nweights
, ());

238 
l
.
cweights
 = 
	`ÿÎoc
Ö.
nweights
, ());

239 
l
.
sÿËs
 = 
	`ÿÎoc
(
n
, ());

241 if(
xnÜ
){

242 
l
.
bš¬y_weights
 = 
	`ÿÎoc
Ö.
nweights
, ());

243 
l
.
bš¬y_šput
 = 
	`ÿÎoc
Ö.
šputs
*l.
b©ch
, ());

246 if(
b©ch_nÜm®ize
){

247 
l
.
sÿËs
 = 
	`ÿÎoc
(
n
, ());

249 
i
 = 0; i < 
n
; ++i){

250 
l
.
sÿËs
[
i
] = 1;

259 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
n
, ());

260 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
n
, ());

261 
l
.
x
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

264 if(
adam
){

265 
l
.
m
 = 
	`ÿÎoc
Ö.
nweights
, ());

266 
l
.
v
 = 
	`ÿÎoc
Ö.
nweights
, ());

267 
l
.
bŸs_m
 = 
	`ÿÎoc
(
n
, ());

268 
l
.
sÿË_m
 = 
	`ÿÎoc
(
n
, ());

269 
l
.
bŸs_v
 = 
	`ÿÎoc
(
n
, ());

270 
l
.
sÿË_v
 = 
	`ÿÎoc
(
n
, ());

273 #ifdeà
GPU


274 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_cÚvŞutiÚ®_Ïy”_gpu
;

275 
l
.
backw¬d_gpu
 = 
backw¬d_cÚvŞutiÚ®_Ïy”_gpu
;

276 
l
.
upd©e_gpu
 = 
upd©e_cÚvŞutiÚ®_Ïy”_gpu
;

278 if(
gpu_šdex
 >= 0){

279 ià(
adam
) {

280 
l
.
m_gpu
 = 
	`cuda_make_¬¿y
Ö.
m
,†.
nweights
);

281 
l
.
v_gpu
 = 
	`cuda_make_¬¿y
Ö.
v
,†.
nweights
);

282 
l
.
bŸs_m_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_m
, 
n
);

283 
l
.
bŸs_v_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_v
, 
n
);

284 
l
.
sÿË_m_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_m
, 
n
);

285 
l
.
sÿË_v_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_v
, 
n
);

288 
l
.
weights_gpu
 = 
	`cuda_make_¬¿y
Ö.
weights
,†.
nweights
);

289 
l
.
weight_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
weight_upd©es
,†.
nweights
);

291 
l
.
bŸ£s_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸ£s
, 
n
);

292 
l
.
bŸs_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_upd©es
, 
n
);

294 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
,†.
b©ch
*
out_h
*
out_w
*
n
);

295 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*
out_h
*
out_w
*
n
);

297 if(
bš¬y
){

298 
l
.
bš¬y_weights_gpu
 = 
	`cuda_make_¬¿y
Ö.
weights
,†.
nweights
);

300 if(
xnÜ
){

301 
l
.
bš¬y_weights_gpu
 = 
	`cuda_make_¬¿y
Ö.
weights
,†.
nweights
);

302 
l
.
bš¬y_šput_gpu
 = 
	`cuda_make_¬¿y
(0,†.
šputs
*l.
b©ch
);

305 if(
b©ch_nÜm®ize
){

306 
l
.
m—n_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
n
);

307 
l
.
v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
n
);

309 
l
.
rŞlšg_m—n_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
n
);

310 
l
.
rŞlšg_v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
n
);

312 
l
.
m—n_d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
m—n
, 
n
);

313 
l
.
v¬Ÿnû_d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
v¬Ÿnû
, 
n
);

315 
l
.
sÿËs_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿËs
, 
n
);

316 
l
.
sÿË_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_upd©es
, 
n
);

318 
l
.
x_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*
out_h
*
out_w
*
n
);

319 
l
.
x_nÜm_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*
out_h
*
out_w
*
n
);

321 #ifdeà
CUDNN


322 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
nÜmT’sÜDesc
);

323 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
¤cT’sÜDesc
);

324 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
d¡T’sÜDesc
);

325 
	`cudÂC»©eF‹rDesütÜ
(&
l
.
weightDesc
);

326 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
d¤cT’sÜDesc
);

327 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
dd¡T’sÜDesc
);

328 
	`cudÂC»©eF‹rDesütÜ
(&
l
.
dweightDesc
);

329 
	`cudÂC»©eCÚvŞutiÚDesütÜ
(&
l
.
cÚvDesc
);

330 
	`cudÂ_cÚvŞutiÚ®_£tup
(&
l
);

334 
l
.
wÜk¥aû_size
 = 
	`g‘_wÜk¥aû_size
(l);

335 
l
.
aùiv©iÚ
 =‡ctivation;

341 
	`årštf
(
¡d”r
, "cÚv %5d %2d x%2d /%2d %4d x%4d x%4d -> %4d x%4d x%4d %5.3àBFLOPs\n", 
n
, 
size
, size, 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
, (2.0 *†.À*†.size*l.size*l.c/l.
groups
 *†.out_h*l.out_w)/1000000000.);

343 
	`årštf
(
¡d”r
, "cÚv_TA%5d %2d x%2d /%2d %4d x%4d x%4d -> %4d x%4d x%4d %5.3àBFLOPs\n", 
n
, 
size
, size, 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
, (2.0 *†.À*†.size*l.size*l.c/l.
groups
 *†.out_h*l.out_w)/1000000000.);

346  
l
;

347 
	}
}

349 
	$d’Üm®ize_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
l
)

351 
i
, 
j
;

352 
i
 = 0; i < 
l
.
n
; ++i){

353 
sÿË
 = 
l
.
sÿËs
[
i
]/
	`sq¹
Ö.
rŞlšg_v¬Ÿnû
[i] + .00001);

354 
j
 = 0; j < 
l
.
c
/l.
groups
*l.
size
*l.size; ++j){

355 
l
.
weights
[
i
*l.
c
/l.
groups
*l.
size
*l.siz+ 
j
] *ğ
sÿË
;

357 
l
.
bŸ£s
[
i
] -ğl.
rŞlšg_m—n
[i] * 
sÿË
;

358 
l
.
sÿËs
[
i
] = 1;

359 
l
.
rŞlšg_m—n
[
i
] = 0;

360 
l
.
rŞlšg_v¬Ÿnû
[
i
] = 1;

362 
	}
}

389 
	$»size_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 *
l
, 
w
, 
h
)

391 
l
->
w
 = w;

392 
l
->
h
 = h;

393 
out_w
 = 
	`cÚvŞutiÚ®_out_width
(*
l
);

394 
out_h
 = 
	`cÚvŞutiÚ®_out_height
(*
l
);

396 
l
->
out_w
 = out_w;

397 
l
->
out_h
 = out_h;

399 
l
->
ouuts
 =†->
out_h
 *†->
out_w
 *†->
out_c
;

400 
l
->
šputs
 =†->
w
 *†->
h
 *†->
c
;

402 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
b©ch
*l->
ouuts
*());

403 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
b©ch
*l->
ouuts
*());

404 if(
l
->
b©ch_nÜm®ize
){

405 
l
->
x
 = 
	`»®loc
Ö->x,†->
b©ch
*l->
ouuts
*());

406 
l
->
x_nÜm
 = 
	`»®loc
Ö->x_nÜm,†->
b©ch
*l->
ouuts
*());

409 #ifdeà
GPU


410 
	`cuda_ä“
(
l
->
d–_gpu
);

411 
	`cuda_ä“
(
l
->
ouut_gpu
);

413 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
b©ch
*l->
ouuts
);

414 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

416 if(
l
->
b©ch_nÜm®ize
){

417 
	`cuda_ä“
(
l
->
x_gpu
);

418 
	`cuda_ä“
(
l
->
x_nÜm_gpu
);

420 
l
->
x_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

421 
l
->
x_nÜm_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

423 #ifdeà
CUDNN


424 
	`cudÂ_cÚvŞutiÚ®_£tup
(
l
);

427 
l
->
wÜk¥aû_size
 = 
	`g‘_wÜk¥aû_size
(*l);

428 
	}
}

430 
	$add_bŸs
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
)

432 
i
,
j
,
b
;

433 
b
 = 0; b < 
b©ch
; ++b){

434 
i
 = 0; i < 
n
; ++i){

435 
j
 = 0; j < 
size
; ++j){

436 
ouut
[(
b
*
n
 + 
i
)*
size
 + 
j
] +ğ
bŸ£s
[i];

440 
	}
}

442 
	$sÿË_bŸs
(*
ouut
, *
sÿËs
, 
b©ch
, 
n
, 
size
)

444 
i
,
j
,
b
;

445 
b
 = 0; b < 
b©ch
; ++b){

446 
i
 = 0; i < 
n
; ++i){

447 
j
 = 0; j < 
size
; ++j){

448 
ouut
[(
b
*
n
 + 
i
)*
size
 + 
j
] *ğ
sÿËs
[i];

452 
	}
}

454 
	$backw¬d_bŸs
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
)

456 
i
,
b
;

457 
b
 = 0; b < 
b©ch
; ++b){

458 
i
 = 0; i < 
n
; ++i){

459 
bŸs_upd©es
[
i
] +ğ
	`sum_¬¿y
(
d–
+
size
*(i+
b
*
n
), size);

462 
	}
}

464 
	$backw¬d_bŸs_diff
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
)

466 
i
,
b
;

467 
b
 = 0; b < 
b©ch
; ++b){

468 
i
 = 0; i < 
n
; ++i){

469 
bŸs_upd©es
[
i
] +ğ
	`sum_¬¿y
(
d–
+
size
*(i+
b
*
n
), size);

473 
	`diff_´iv©e_func
(
bŸs_upd©es
, 
n
);

475 
	}
}

477 
	gdebug_num
 = 0;

479 
	$fÜw¬d_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

481 
i
, 
j
;

483 
	`fl_ıu
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut
, 1);

485 if(
l
.
xnÜ
){

486 
	`bš¬ize_weights
(
l
.
weights
,†.
n
,†.
c
/l.
groups
*l.
size
*l.size,†.
bš¬y_weights
);

487 
	`sw­_bš¬y
(&
l
);

488 
	`bš¬ize_ıu
(
Ãt
.
šput
, 
l
.
c
*l.
h
*l.
w
*l.
b©ch
,†.
bš¬y_šput
);

489 
Ãt
.
šput
 = 
l
.
bš¬y_šput
;

492 
m
 = 
l
.
n
/l.
groups
;

493 
k
 = 
l
.
size
*l.size*l.
c
/l.
groups
;

494 
n
 = 
l
.
out_w
*l.
out_h
;

496 
i
 = 0; i < 
l
.
b©ch
; ++i){

497 
j
 = 0; j < 
l
.
groups
; ++j){

498 *
a
 = 
l
.
weights
 + 
j
*l.
nweights
/l.
groups
;

499 *
b
 = 
Ãt
.
wÜk¥aû
;

500 *
c
 = 
l
.
ouut
 + (
i
*l.
groups
 + 
j
)*
n
*
m
;

501 *
im
 = 
Ãt
.
šput
 + (
i
*
l
.
groups
 + 
j
)*l.
c
/l.groups*l.
h
*l.
w
;

503 ià(
l
.
size
 == 1) {

504 
b
 = 
im
;

506 
	`im2cŞ_ıu
(
im
, 
l
.
c
/l.
groups
,†.
h
,†.
w
,†.
size
,†.
¡ride
,†.
·d
, 
b
);

508 
	`gemm
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,n,1,
c
,n);

514 if(
l
.
b©ch_nÜm®ize
){

515 
	`fÜw¬d_b©chnÜm_Ïy”
(
l
, 
Ãt
);

517 
	`add_bŸs
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
n
,†.
out_h
*l.
out_w
);

520 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

521 if(
l
.
bš¬y
 ||†.
xnÜ
è
	`sw­_bš¬y
(&l);

523 
debug_num
++;

524 
	}
}

526 
	$backw¬d_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

528 
i
, 
j
;

529 
m
 = 
l
.
n
/l.
groups
;

530 
n
 = 
l
.
size
*l.size*l.
c
/l.
groups
;

531 
k
 = 
l
.
out_w
*l.
out_h
;

533 
	`g¿d›Á_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

535 if(
l
.
b©ch_nÜm®ize
){

536 
	`backw¬d_b©chnÜm_Ïy”
(
l
, 
Ãt
);

539 if(
Ãt
.
šdex
 < 
glob®_dp
){

540 
	`backw¬d_bŸs_diff
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
n
, 
k
);

542 
	`backw¬d_bŸs
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
n
, 
k
);

546 
i
 = 0; i < 
l
.
b©ch
; ++i){

547 
j
 = 0; j < 
l
.
groups
; ++j){

548 *
a
 = 
l
.
d–
 + (
i
*l.
groups
 + 
j
)*
m
*
k
;

549 *
b
 = 
Ãt
.
wÜk¥aû
;

550 *
c
 = 
l
.
weight_upd©es
 + 
j
*l.
nweights
/l.
groups
;

552 *
im
 = 
Ãt
.
šput
 + (
i
*
l
.
groups
 + 
j
)*l.
c
/l.groups*l.
h
*l.
w
;

553 *
imd
 = 
Ãt
.
d–
 + (
i
*
l
.
groups
 + 
j
)*l.
c
/l.groups*l.
h
*l.
w
;

555 if(
l
.
size
 == 1){

556 
b
 = 
im
;

558 
	`im2cŞ_ıu
(
im
, 
l
.
c
/l.
groups
,†.
h
,†.
w
,

559 
l
.
size
,†.
¡ride
,†.
·d
, 
b
);

562 
	`gemm
(0,1,
m
,
n
,
k
,1,
a
,k,
b
,k,1,
c
,n);

564 ià(
Ãt
.
d–
) {

565 
a
 = 
l
.
weights
 + 
j
*l.
nweights
/l.
groups
;

566 
b
 = 
l
.
d–
 + (
i
*l.
groups
 + 
j
)*
m
*
k
;

567 
c
 = 
Ãt
.
wÜk¥aû
;

568 ià(
l
.
size
 == 1) {

569 
c
 = 
imd
;

572 
	`gemm
(1,0,
n
,
k
,
m
,1,
a
,n,
b
,k,0,
c
,k);

574 ià(
l
.
size
 != 1) {

575 
	`cŞ2im_ıu
(
Ãt
.
wÜk¥aû
, 
l
.
c
/l.
groups
,†.
h
,†.
w
,†.
size
,†.
¡ride
,†.
·d
, 
imd
);

580 if(
Ãt
.
šdex
 < 
glob®_dp
){

582 
	`diff_´iv©e_func
(
l
.
weight_upd©es
,†.
nweights
);

584 
	}
}

586 
	$upd©e_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
l
, 
upd©e_¬gs
 
a
)

588 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

589 
mom’tum
 = 
a
.momentum;

590 
deÿy
 = 
a
.decay;

591 
b©ch
 = 
a
.batch;

593 
	`axpy_ıu
(
l
.
n
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es
, 1,†.
bŸ£s
, 1);

594 
	`sÿl_ıu
(
l
.
n
, 
mom’tum
,†.
bŸs_upd©es
, 1);

596 if(
l
.
sÿËs
){

597 
	`axpy_ıu
(
l
.
n
, 
Ë¬nšg_¿‹
/
b©ch
,†.
sÿË_upd©es
, 1,†.
sÿËs
, 1);

598 
	`sÿl_ıu
(
l
.
n
, 
mom’tum
,†.
sÿË_upd©es
, 1);

601 
	`axpy_ıu
(
l
.
nweights
, -
deÿy
*
b©ch
,†.
weights
, 1,†.
weight_upd©es
, 1);

602 
	`axpy_ıu
(
l
.
nweights
, 
Ë¬nšg_¿‹
/
b©ch
,†.
weight_upd©es
, 1,†.
weights
, 1);

603 
	`sÿl_ıu
(
l
.
nweights
, 
mom’tum
,†.
weight_upd©es
, 1);

604 
	}
}

607 
image
 
	$g‘_cÚvŞutiÚ®_weight
(
cÚvŞutiÚ®_Ïy”
 
l
, 
i
)

609 
h
 = 
l
.
size
;

610 
w
 = 
l
.
size
;

611 
c
 = 
l
.c/l.
groups
;

612  
	`æßt_to_image
(
w
,
h
,
c
,
l
.
weights
+
i
*h*w*c);

613 
	}
}

615 
	$rgbgr_weights
(
cÚvŞutiÚ®_Ïy”
 
l
)

617 
i
;

618 
i
 = 0; i < 
l
.
n
; ++i){

619 
image
 
im
 = 
	`g‘_cÚvŞutiÚ®_weight
(
l
, 
i
);

620 ià(
im
.
c
 == 3) {

621 
	`rgbgr_image
(
im
);

624 
	}
}

626 
	$»sÿË_weights
(
cÚvŞutiÚ®_Ïy”
 
l
, 
sÿË
, 
Œªs
)

628 
i
;

629 
i
 = 0; i < 
l
.
n
; ++i){

630 
image
 
im
 = 
	`g‘_cÚvŞutiÚ®_weight
(
l
, 
i
);

631 ià(
im
.
c
 == 3) {

632 
	`sÿË_image
(
im
, 
sÿË
);

633 
sum
 = 
	`sum_¬¿y
(
im
.
d©a
, im.
w
*im.
h
*im.
c
);

634 
l
.
bŸ£s
[
i
] +ğ
sum
*
Œªs
;

637 
	}
}

639 
image
 *
	$g‘_weights
(
cÚvŞutiÚ®_Ïy”
 
l
)

641 
image
 *
weights
 = 
	`ÿÎoc
(
l
.
n
, (image));

642 
i
;

643 
i
 = 0; i < 
l
.
n
; ++i){

644 
weights
[
i
] = 
	`cİy_image
(
	`g‘_cÚvŞutiÚ®_weight
(
l
, i));

645 
	`nÜm®ize_image
(
weights
[
i
]);

653  
weights
;

654 
	}
}

656 
image
 *
	$visu®ize_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
l
, *
wšdow
, 
image
 *
´ev_weights
)

658 
image
 *
sšgË_weights
 = 
	`g‘_weights
(
l
);

659 
	`show_images
(
sšgË_weights
, 
l
.
n
, 
wšdow
);

661 
image
 
d–
 = 
	`g‘_cÚvŞutiÚ®_image
(
l
);

662 
image
 
dc
 = 
	`cŞÏp£_image_Ïy”s
(
d–
, 1);

663 
buff
[256];

664 
	`¥rštf
(
buff
, "%s: Ouut", 
wšdow
);

667 
	`ä“_image
(
dc
);

668  
sšgË_weights
;

669 
	}
}

	@host/src/convolutional_layer.h

1 #iâdeà
CONVOLUTIONAL_LAYER_H


2 
	#CONVOLUTIONAL_LAYER_H


	)

4 
	~"cuda.h
"

5 
	~"image.h
"

6 
	~"aùiv©iÚs.h
"

7 
	~"Ïy”.h
"

8 
	~"ÃtwÜk.h
"

10 
Ïy”
 
	tcÚvŞutiÚ®_Ïy”
;

12 #ifdeà
GPU


13 
fÜw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

14 
backw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

15 
upd©e_cÚvŞutiÚ®_Ïy”_gpu
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
upd©e_¬gs
 
a
);

17 
push_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
);

18 
puÎ_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
);

20 
add_bŸs_gpu
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

21 
backw¬d_bŸs_gpu
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
);

22 
adam_upd©e_gpu
(*
w
, *
d
, *
m
, *
v
, 
B1
, 
B2
, 
•s
, 
deÿy
, 
¿‹
, 
n
, 
b©ch
, 
t
);

23 #ifdeà
CUDNN


24 
cudÂ_cÚvŞutiÚ®_£tup
(
Ïy”
 *
l
);

28 
cÚvŞutiÚ®_Ïy”
 
make_cÚvŞutiÚ®_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
);

29 
»size_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 *
Ïy”
, 
w
, 
h
);

30 
fÜw¬d_cÚvŞutiÚ®_Ïy”
(cÚ¡ 
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

31 
upd©e_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
upd©e_¬gs
 
a
);

32 
image
 *
visu®ize_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, *
wšdow
, imag*
´ev_weights
);

33 
bš¬ize_weights
(*
weights
, 
n
, 
size
, *
bš¬y
);

34 
sw­_bš¬y
(
cÚvŞutiÚ®_Ïy”
 *
l
);

35 
bš¬ize_weights2
(*
weights
, 
n
, 
size
, *
bš¬y
, *
sÿËs
);

37 
backw¬d_cÚvŞutiÚ®_Ïy”
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

39 
add_bŸs
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

40 
backw¬d_bŸs
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
);

42 
image
 
g‘_cÚvŞutiÚ®_image
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
);

43 
image
 
g‘_cÚvŞutiÚ®_d–
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
);

44 
image
 
g‘_cÚvŞutiÚ®_weight
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
, 
i
);

46 
cÚvŞutiÚ®_out_height
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
);

47 
cÚvŞutiÚ®_out_width
(
cÚvŞutiÚ®_Ïy”
 
Ïy”
);

49 
backw¬d_bŸs_diff
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
);

	@host/src/cost_layer.c

1 
	~"co¡_Ïy”.h
"

2 
	~"uts.h
"

3 
	~"cuda.h
"

4 
	~"bÏs.h
"

5 
	~"·r£r.h
"

7 
	~<m©h.h
>

8 
	~<¡ršg.h
>

9 
	~<¡dlib.h
>

10 
	~<¡dio.h
>

12 
COST_TYPE
 
	$g‘_co¡_ty³
(*
s
)

14 ià(
	`¡rcmp
(
s
, "£g")==0è 
SEG
;

15 ià(
	`¡rcmp
(
s
, "s£")==0è 
SSE
;

16 ià(
	`¡rcmp
(
s
, "masked")==0è 
MASKED
;

17 ià(
	`¡rcmp
(
s
, "smoÙh")==0è 
SMOOTH
;

18 ià(
	`¡rcmp
(
s
, "L1")==0è 
L1
;

19 ià(
	`¡rcmp
(
s
, "wgª")==0è 
WGAN
;

20 
	`årštf
(
¡d”r
, "Couldn'ˆfšd co¡y³ %s, gošg w™h SSE\n", 
s
);

21  
SSE
;

22 
	}
}

24 *
	$g‘_co¡_¡ršg
(
COST_TYPE
 
a
)

26 
a
){

27 
SEG
:

29 
SSE
:

31 
MASKED
:

33 
SMOOTH
:

35 
L1
:

37 
WGAN
:

41 
	}
}

43 
co¡_Ïy”
 
	$make_co¡_Ïy”
(
b©ch
, 
šputs
, 
COST_TYPE
 
co¡_ty³
, 
sÿË
)

47 
	`årštf
(
¡d”r
, "co¡ %4d\n", 
šputs
);

49 
	`årštf
(
¡d”r
, "co¡_TA %4d\n", 
šputs
);

51 
co¡_Ïy”
 
l
 = {0};

52 
l
.
ty³
 = 
COST
;

54 
l
.
sÿË
 = scale;

55 
l
.
b©ch
 = batch;

56 
l
.
šputs
 = inputs;

57 
l
.
ouuts
 = 
šputs
;

58 
l
.
co¡_ty³
 = cost_type;

59 
l
.
d–
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

60 
l
.
ouut
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

61 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

63 
l
.
fÜw¬d
 = 
fÜw¬d_co¡_Ïy”
;

64 
l
.
backw¬d
 = 
backw¬d_co¡_Ïy”
;

65 #ifdeà
GPU


66 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_co¡_Ïy”_gpu
;

67 
l
.
backw¬d_gpu
 = 
backw¬d_co¡_Ïy”_gpu
;

69 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
šputs
*
b©ch
);

70 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
šputs
*
b©ch
);

72  
l
;

73 
	}
}

75 
	$»size_co¡_Ïy”
(
co¡_Ïy”
 *
l
, 
šputs
)

77 
l
->
šputs
 = inputs;

78 
l
->
ouuts
 = 
šputs
;

79 
l
->
d–
 = 
	`»®loc
Ö->d–, 
šputs
*l->
b©ch
*());

80 
l
->
ouut
 = 
	`»®loc
Ö->ouut, 
šputs
*l->
b©ch
*());

81 #ifdeà
GPU


82 
	`cuda_ä“
(
l
->
d–_gpu
);

83 
	`cuda_ä“
(
l
->
ouut_gpu
);

84 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
, 
šputs
*l->
b©ch
);

85 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
, 
šputs
*l->
b©ch
);

87 
	}
}

89 
	$fÜw¬d_co¡_Ïy”
(
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

91 ià(!
Ãt
.
Œuth
) ;

92 if(
l
.
co¡_ty³
 =ğ
MASKED
){

93 
i
;

94 
i
 = 0; i < 
l
.
b©ch
*l.
šputs
; ++i){

95 if(
Ãt
.
Œuth
[
i
] =ğ
SECRET_NUM
èÃt.
šput
[i] = SECRET_NUM;

98 if(
l
.
co¡_ty³
 =ğ
SMOOTH
){

99 
	`smoÙh_l1_ıu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput
,‚‘.
Œuth
,†.
d–
,†.
ouut
);

100 }if(
l
.
co¡_ty³
 =ğ
L1
){

101 
	`l1_ıu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput
,‚‘.
Œuth
,†.
d–
,†.
ouut
);

103 
	`l2_ıu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput
,‚‘.
Œuth
,†.
d–
,†.
ouut
);

105 
l
.
co¡
[0] = 
	`sum_¬¿y
Ö.
ouut
,†.
b©ch
*l.
šputs
);

106 
	}
}

108 
	$backw¬d_co¡_Ïy”
(cÚ¡ 
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

110 
	`axpy_ıu
(
l
.
b©ch
*l.
šputs
,†.
sÿË
,†.
d–
, 1, 
Ãt
.delta, 1);

111 
	}
}

113 #ifdeà
GPU


115 
	$puÎ_co¡_Ïy”
(
co¡_Ïy”
 
l
)

117 
	`cuda_puÎ_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
šputs
);

118 
	}
}

120 
	$push_co¡_Ïy”
(
co¡_Ïy”
 
l
)

122 
	`cuda_push_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
šputs
);

123 
	}
}

125 
	$æßt_abs_com·»
 (cÚ¡ * 
a
, cÚ¡ * 
b
)

127 
ç
 = *(cÚ¡ *è
a
;

128 if(
ç
 < 0) fa = -fa;

129 
fb
 = *(cÚ¡ *è
b
;

130 if(
fb
 < 0) fb = -fb;

131  (
ç
 > 
fb
) - (fa < fb);

132 
	}
}

134 
	$fÜw¬d_co¡_Ïy”_gpu
(
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

136 ià(!
Ãt
.
Œuth
) ;

137 if(
l
.
smoÙh
){

138 
	`sÿl_gpu
(
l
.
b©ch
*l.
šputs
, (1-l.
smoÙh
), 
Ãt
.
Œuth_gpu
, 1);

139 
	`add_gpu
(
l
.
b©ch
*l.
šputs
,†.
smoÙh
 * 1./l.šputs, 
Ãt
.
Œuth_gpu
, 1);

142 if(
l
.
co¡_ty³
 =ğ
SMOOTH
){

143 
	`smoÙh_l1_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
,‚‘.
Œuth_gpu
,†.
d–_gpu
,†.
ouut_gpu
);

144 } ià(
l
.
co¡_ty³
 =ğ
L1
){

145 
	`l1_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
,‚‘.
Œuth_gpu
,†.
d–_gpu
,†.
ouut_gpu
);

146 } ià(
l
.
co¡_ty³
 =ğ
WGAN
){

147 
	`wgª_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
,‚‘.
Œuth_gpu
,†.
d–_gpu
,†.
ouut_gpu
);

149 
	`l2_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
,‚‘.
Œuth_gpu
,†.
d–_gpu
,†.
ouut_gpu
);

152 ià(
l
.
co¡_ty³
 =ğ
SEG
 &&†.
noobjeù_sÿË
 != 1) {

153 
	`sÿË_mask_gpu
(
l
.
b©ch
*l.
šputs
,†.
d–_gpu
, 0, 
Ãt
.
Œuth_gpu
,†.
noobjeù_sÿË
);

154 
	`sÿË_mask_gpu
(
l
.
b©ch
*l.
šputs
,†.
ouut_gpu
, 0, 
Ãt
.
Œuth_gpu
,†.
noobjeù_sÿË
);

156 ià(
l
.
co¡_ty³
 =ğ
MASKED
) {

157 
	`mask_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
d–_gpu
, 
SECRET_NUM
,‚‘.
Œuth_gpu
, 0);

160 if(
l
.
¿tio
){

161 
	`cuda_puÎ_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
šputs
);

162 
	`qsÜt
(
l
.
d–
,†.
b©ch
*l.
šputs
, (), 
æßt_abs_com·»
);

163 
n
 = (1-
l
.
¿tio
è*†.
b©ch
*l.
šputs
;

164 
th»sh
 = 
l
.
d–
[
n
];

165 
th»sh
 = 0;

166 
	`´štf
("%f\n", 
th»sh
);

167 
	`suµ_gpu
(
l
.
b©ch
*l.
šputs
, 
th»sh
,†.
d–_gpu
, 1);

170 if(
l
.
th»sh
){

171 
	`suµ_gpu
(
l
.
b©ch
*l.
šputs
,†.
th»sh
*1./l.šputs,†.
d–_gpu
, 1);

174 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
b©ch
*l.
šputs
);

175 
l
.
co¡
[0] = 
	`sum_¬¿y
Ö.
ouut
,†.
b©ch
*l.
šputs
);

176 
	}
}

178 
	$backw¬d_co¡_Ïy”_gpu
(cÚ¡ 
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

180 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
,†.
sÿË
,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

181 
	}
}

	@host/src/cost_layer.h

1 #iâdeà
COST_LAYER_H


2 
	#COST_LAYER_H


	)

3 
	~"Ïy”.h
"

4 
	~"ÃtwÜk.h
"

6 
Ïy”
 
	tco¡_Ïy”
;

8 
COST_TYPE
 
g‘_co¡_ty³
(*
s
);

9 *
g‘_co¡_¡ršg
(
COST_TYPE
 
a
);

10 
co¡_Ïy”
 
make_co¡_Ïy”
(
b©ch
, 
šputs
, 
COST_TYPE
 
ty³
, 
sÿË
);

11 
fÜw¬d_co¡_Ïy”
(cÚ¡ 
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_co¡_Ïy”
(cÚ¡ 
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 
»size_co¡_Ïy”
(
co¡_Ïy”
 *
l
, 
šputs
);

15 #ifdeà
GPU


16 
fÜw¬d_co¡_Ïy”_gpu
(
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 
backw¬d_co¡_Ïy”_gpu
(cÚ¡ 
co¡_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/crnn_layer.c

1 
	~"üÂ_Ïy”.h
"

2 
	~"cÚvŞutiÚ®_Ïy”.h
"

3 
	~"uts.h
"

4 
	~"cuda.h
"

5 
	~"bÏs.h
"

6 
	~"gemm.h
"

8 
	~<m©h.h
>

9 
	~<¡dio.h
>

10 
	~<¡dlib.h
>

11 
	~<¡ršg.h
>

13 
	$šüem’t_Ïy”
(
Ïy”
 *
l
, 
¡•s
)

15 
num
 = 
l
->
ouuts
*l->
b©ch
*
¡•s
;

16 
l
->
ouut
 +ğ
num
;

17 
l
->
d–
 +ğ
num
;

18 
l
->
x
 +ğ
num
;

19 
l
->
x_nÜm
 +ğ
num
;

21 #ifdeà
GPU


22 
l
->
ouut_gpu
 +ğ
num
;

23 
l
->
d–_gpu
 +ğ
num
;

24 
l
->
x_gpu
 +ğ
num
;

25 
l
->
x_nÜm_gpu
 +ğ
num
;

27 
	}
}

29 
Ïy”
 
	$make_üÂ_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
hidd’_f‹rs
, 
ouut_f‹rs
, 
¡•s
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
)

31 
	`årštf
(
¡d”r
, "CRNN Lay”: %d x %d x %d image, %d f‹rs\n", 
h
,
w
,
c
,
ouut_f‹rs
);

32 
b©ch
 = b©ch / 
¡•s
;

33 
Ïy”
 
l
 = {0};

34 
l
.
b©ch
 = batch;

35 
l
.
ty³
 = 
CRNN
;

36 
l
.
¡•s
 = steps;

37 
l
.
h
 = h;

38 
l
.
w
 = w;

39 
l
.
c
 = c;

40 
l
.
out_h
 = 
h
;

41 
l
.
out_w
 = 
w
;

42 
l
.
out_c
 = 
ouut_f‹rs
;

43 
l
.
šputs
 = 
h
*
w
*
c
;

44 
l
.
hidd’
 = 
h
 * 
w
 * 
hidd’_f‹rs
;

45 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

47 
l
.
¡©e
 = 
	`ÿÎoc
Ö.
hidd’
*
b©ch
*(
¡•s
+1), ());

49 
l
.
šput_Ïy”
 = 
	`m®loc
((
Ïy”
));

50 
	`årštf
(
¡d”r
, "\t\t");

51 *(
l
.
šput_Ïy”
èğ
	`make_cÚvŞutiÚ®_Ïy”
(
b©ch
*
¡•s
, 
h
, 
w
, 
c
, 
hidd’_f‹rs
, 1, 3, 1, 1, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 0, 0, 0);

52 
l
.
šput_Ïy”
->
b©ch
 = batch;

54 
l
.
£lf_Ïy”
 = 
	`m®loc
((
Ïy”
));

55 
	`årštf
(
¡d”r
, "\t\t");

56 *(
l
.
£lf_Ïy”
èğ
	`make_cÚvŞutiÚ®_Ïy”
(
b©ch
*
¡•s
, 
h
, 
w
, 
hidd’_f‹rs
, hidd’_f‹rs, 1, 3, 1, 1, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 0, 0, 0);

57 
l
.
£lf_Ïy”
->
b©ch
 = batch;

59 
l
.
ouut_Ïy”
 = 
	`m®loc
((
Ïy”
));

60 
	`årštf
(
¡d”r
, "\t\t");

61 *(
l
.
ouut_Ïy”
èğ
	`make_cÚvŞutiÚ®_Ïy”
(
b©ch
*
¡•s
, 
h
, 
w
, 
hidd’_f‹rs
, 
ouut_f‹rs
, 1, 3, 1, 1, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 0, 0, 0);

62 
l
.
ouut_Ïy”
->
b©ch
 = batch;

64 
l
.
ouut
 =†.
ouut_Ïy”
->output;

65 
l
.
d–
 =†.
ouut_Ïy”
->delta;

67 
l
.
fÜw¬d
 = 
fÜw¬d_üÂ_Ïy”
;

68 
l
.
backw¬d
 = 
backw¬d_üÂ_Ïy”
;

69 
l
.
upd©e
 = 
upd©e_üÂ_Ïy”
;

71 #ifdeà
GPU


72 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_üÂ_Ïy”_gpu
;

73 
l
.
backw¬d_gpu
 = 
backw¬d_üÂ_Ïy”_gpu
;

74 
l
.
upd©e_gpu
 = 
upd©e_üÂ_Ïy”_gpu
;

76 
l
.
¡©e_gpu
 = 
	`cuda_make_¬¿y
Ö.
¡©e
,†.
hidd’
*
b©ch
*(
¡•s
+1));

77 
l
.
ouut_gpu
 =†.
ouut_Ïy”
->output_gpu;

78 
l
.
d–_gpu
 =†.
ouut_Ïy”
->delta_gpu;

81  
l
;

82 
	}
}

84 
	$upd©e_üÂ_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

86 
	`upd©e_cÚvŞutiÚ®_Ïy”
(*(
l
.
šput_Ïy”
), 
a
);

87 
	`upd©e_cÚvŞutiÚ®_Ïy”
(*(
l
.
£lf_Ïy”
), 
a
);

88 
	`upd©e_cÚvŞutiÚ®_Ïy”
(*(
l
.
ouut_Ïy”
), 
a
);

89 
	}
}

91 
	$fÜw¬d_üÂ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

93 
ÃtwÜk
 
s
 = 
Ãt
;

94 
s
.
Œaš
 = 
Ãt
.train;

95 
i
;

96 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

97 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

98 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

100 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ouut_Ïy”
.
d–
, 1);

101 
	`fl_ıu
(
l
.
hidd’
 *†.
b©ch
 *†.
¡•s
, 0, 
£lf_Ïy”
.
d–
, 1);

102 
	`fl_ıu
(
l
.
hidd’
 *†.
b©ch
 *†.
¡•s
, 0, 
šput_Ïy”
.
d–
, 1);

103 if(
Ãt
.
Œaš
è
	`fl_ıu
(
l
.
hidd’
 *†.
b©ch
, 0,†.
¡©e
, 1);

105 
i
 = 0; i < 
l
.
¡•s
; ++i) {

106 
s
.
šput
 = 
Ãt
.input;

107 
	`fÜw¬d_cÚvŞutiÚ®_Ïy”
(
šput_Ïy”
, 
s
);

109 
s
.
šput
 = 
l
.
¡©e
;

110 
	`fÜw¬d_cÚvŞutiÚ®_Ïy”
(
£lf_Ïy”
, 
s
);

112 *
Şd_¡©e
 = 
l
.
¡©e
;

113 if(
Ãt
.
Œaš
è
l
.
¡©e
 +ğl.
hidd’
*l.
b©ch
;

114 if(
l
.
shÜtcut
){

115 
	`cİy_ıu
(
l
.
hidd’
 *†.
b©ch
, 
Şd_¡©e
, 1,†.
¡©e
, 1);

117 
	`fl_ıu
(
l
.
hidd’
 *†.
b©ch
, 0,†.
¡©e
, 1);

119 
	`axpy_ıu
(
l
.
hidd’
 *†.
b©ch
, 1, 
šput_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

120 
	`axpy_ıu
(
l
.
hidd’
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

122 
s
.
šput
 = 
l
.
¡©e
;

123 
	`fÜw¬d_cÚvŞutiÚ®_Ïy”
(
ouut_Ïy”
, 
s
);

125 
Ãt
.
šput
 +ğ
l
.
šputs
*l.
b©ch
;

126 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 1);

127 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 1);

128 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 1);

130 
	}
}

132 
	$backw¬d_üÂ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

134 
ÃtwÜk
 
s
 = 
Ãt
;

135 
i
;

136 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

137 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

138 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

140 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 
l
.
¡•s
-1);

141 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 
l
.
¡•s
-1);

142 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 
l
.
¡•s
-1);

144 
l
.
¡©e
 +ğl.
hidd’
*l.
b©ch
*l.
¡•s
;

145 
i
 = 
l
.
¡•s
-1; i >= 0; --i) {

146 
	`cİy_ıu
(
l
.
hidd’
 *†.
b©ch
, 
šput_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

147 
	`axpy_ıu
(
l
.
hidd’
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

149 
s
.
šput
 = 
l
.
¡©e
;

150 
s
.
d–
 = 
£lf_Ïy”
.delta;

151 
	`backw¬d_cÚvŞutiÚ®_Ïy”
(
ouut_Ïy”
, 
s
);

153 
l
.
¡©e
 -ğl.
hidd’
*l.
b©ch
;

163 
s
.
šput
 = 
l
.
¡©e
;

164 
s
.
d–
 = 
£lf_Ïy”
.d– - 
l
.
hidd’
*l.
b©ch
;

165 ià(
i
 =ğ0è
s
.
d–
 = 0;

166 
	`backw¬d_cÚvŞutiÚ®_Ïy”
(
£lf_Ïy”
, 
s
);

168 
	`cİy_ıu
(
l
.
hidd’
*l.
b©ch
, 
£lf_Ïy”
.
d–
, 1, 
šput_Ïy”
.delta, 1);

169 ià(
i
 > 0 && 
l
.
shÜtcut
è
	`axpy_ıu
Ö.
hidd’
*l.
b©ch
, 1, 
£lf_Ïy”
.
d–
, 1, self_layer.delta -†.hidden*l.batch, 1);

170 
s
.
šput
 = 
Ãt
.špuˆ+ 
i
*
l
.
šputs
*l.
b©ch
;

171 if(
Ãt
.
d–
è
s
.d– =‚‘.d– + 
i
*
l
.
šputs
*l.
b©ch
;

172 
s
.
d–
 = 0;

173 
	`backw¬d_cÚvŞutiÚ®_Ïy”
(
šput_Ïy”
, 
s
);

175 
	`šüem’t_Ïy”
(&
šput_Ïy”
, -1);

176 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, -1);

177 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, -1);

179 
	}
}

181 #ifdeà
GPU


183 
	$puÎ_üÂ_Ïy”
(
Ïy”
 
l
)

185 
	`puÎ_cÚvŞutiÚ®_Ïy”
(*(
l
.
šput_Ïy”
));

186 
	`puÎ_cÚvŞutiÚ®_Ïy”
(*(
l
.
£lf_Ïy”
));

187 
	`puÎ_cÚvŞutiÚ®_Ïy”
(*(
l
.
ouut_Ïy”
));

188 
	}
}

190 
	$push_üÂ_Ïy”
(
Ïy”
 
l
)

192 
	`push_cÚvŞutiÚ®_Ïy”
(*(
l
.
šput_Ïy”
));

193 
	`push_cÚvŞutiÚ®_Ïy”
(*(
l
.
£lf_Ïy”
));

194 
	`push_cÚvŞutiÚ®_Ïy”
(*(
l
.
ouut_Ïy”
));

195 
	}
}

197 
	$upd©e_üÂ_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

199 
	`upd©e_cÚvŞutiÚ®_Ïy”_gpu
(*(
l
.
šput_Ïy”
), 
a
);

200 
	`upd©e_cÚvŞutiÚ®_Ïy”_gpu
(*(
l
.
£lf_Ïy”
), 
a
);

201 
	`upd©e_cÚvŞutiÚ®_Ïy”_gpu
(*(
l
.
ouut_Ïy”
), 
a
);

202 
	}
}

204 
	$fÜw¬d_üÂ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

206 
ÃtwÜk
 
s
 = 
Ãt
;

207 
i
;

208 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

209 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

210 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

212 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ouut_Ïy”
.
d–_gpu
, 1);

213 
	`fl_gpu
(
l
.
hidd’
 *†.
b©ch
 *†.
¡•s
, 0, 
£lf_Ïy”
.
d–_gpu
, 1);

214 
	`fl_gpu
(
l
.
hidd’
 *†.
b©ch
 *†.
¡•s
, 0, 
šput_Ïy”
.
d–_gpu
, 1);

215 if(
Ãt
.
Œaš
è
	`fl_gpu
(
l
.
hidd’
 *†.
b©ch
, 0,†.
¡©e_gpu
, 1);

217 
i
 = 0; i < 
l
.
¡•s
; ++i) {

218 
s
.
šput_gpu
 = 
Ãt
.input_gpu;

219 
	`fÜw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
šput_Ïy”
, 
s
);

221 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

222 
	`fÜw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
£lf_Ïy”
, 
s
);

224 *
Şd_¡©e
 = 
l
.
¡©e_gpu
;

225 if(
Ãt
.
Œaš
è
l
.
¡©e_gpu
 +ğl.
hidd’
*l.
b©ch
;

226 if(
l
.
shÜtcut
){

227 
	`cİy_gpu
(
l
.
hidd’
 *†.
b©ch
, 
Şd_¡©e
, 1,†.
¡©e_gpu
, 1);

229 
	`fl_gpu
(
l
.
hidd’
 *†.
b©ch
, 0,†.
¡©e_gpu
, 1);

231 
	`axpy_gpu
(
l
.
hidd’
 *†.
b©ch
, 1, 
šput_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

232 
	`axpy_gpu
(
l
.
hidd’
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

234 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

235 
	`fÜw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
ouut_Ïy”
, 
s
);

237 
Ãt
.
šput_gpu
 +ğ
l
.
šputs
*l.
b©ch
;

238 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 1);

239 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 1);

240 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 1);

242 
	}
}

244 
	$backw¬d_üÂ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

246 
ÃtwÜk
 
s
 = 
Ãt
;

247 
s
.
Œaš
 = 
Ãt
.train;

248 
i
;

249 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

250 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

251 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

252 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 
l
.
¡•s
 - 1);

253 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 
l
.
¡•s
 - 1);

254 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 
l
.
¡•s
 - 1);

255 
l
.
¡©e_gpu
 +ğl.
hidd’
*l.
b©ch
*l.
¡•s
;

256 
i
 = 
l
.
¡•s
-1; i >= 0; --i) {

257 
	`cİy_gpu
(
l
.
hidd’
 *†.
b©ch
, 
šput_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

258 
	`axpy_gpu
(
l
.
hidd’
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

260 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

261 
s
.
d–_gpu
 = 
£lf_Ïy”
.delta_gpu;

262 
	`backw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
ouut_Ïy”
, 
s
);

264 
l
.
¡©e_gpu
 -ğl.
hidd’
*l.
b©ch
;

266 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

267 
s
.
d–_gpu
 = 
£lf_Ïy”
.d–_gpu - 
l
.
hidd’
*l.
b©ch
;

268 ià(
i
 =ğ0è
s
.
d–_gpu
 = 0;

269 
	`backw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
£lf_Ïy”
, 
s
);

271 
	`cİy_gpu
(
l
.
hidd’
*l.
b©ch
, 
£lf_Ïy”
.
d–_gpu
, 1, 
šput_Ïy”
.delta_gpu, 1);

272 ià(
i
 > 0 && 
l
.
shÜtcut
è
	`axpy_gpu
Ö.
hidd’
*l.
b©ch
, 1, 
£lf_Ïy”
.
d–_gpu
, 1, self_layer.delta_gpu -†.hidden*l.batch, 1);

273 
s
.
šput_gpu
 = 
Ãt
.šput_gpu + 
i
*
l
.
šputs
*l.
b©ch
;

274 if(
Ãt
.
d–_gpu
è
s
.d–_gpu =‚‘.d–_gpu + 
i
*
l
.
šputs
*l.
b©ch
;

275 
s
.
d–_gpu
 = 0;

276 
	`backw¬d_cÚvŞutiÚ®_Ïy”_gpu
(
šput_Ïy”
, 
s
);

278 
	`šüem’t_Ïy”
(&
šput_Ïy”
, -1);

279 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, -1);

280 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, -1);

282 
	}
}

	@host/src/crnn_layer.h

2 #iâdeà
CRNN_LAYER_H


3 
	#CRNN_LAYER_H


	)

5 
	~"aùiv©iÚs.h
"

6 
	~"Ïy”.h
"

7 
	~"ÃtwÜk.h
"

9 
Ïy”
 
make_üÂ_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
hidd’_f‹rs
, 
ouut_f‹rs
, 
¡•s
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
);

11 
fÜw¬d_üÂ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_üÂ_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 
upd©e_üÂ_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

15 #ifdeà
GPU


16 
fÜw¬d_üÂ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 
backw¬d_üÂ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

18 
upd©e_üÂ_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

19 
push_üÂ_Ïy”
(
Ïy”
 
l
);

20 
puÎ_üÂ_Ïy”
(
Ïy”
 
l
);

	@host/src/crop_layer.c

1 
	~"üİ_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~<¡dio.h
>

5 
image
 
	$g‘_üİ_image
(
üİ_Ïy”
 
l
)

7 
h
 = 
l
.
out_h
;

8 
w
 = 
l
.
out_w
;

9 
c
 = 
l
.
out_c
;

10  
	`æßt_to_image
(
w
,
h
,
c
,
l
.
ouut
);

11 
	}
}

13 
	$backw¬d_üİ_Ïy”
(cÚ¡ 
üİ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
){
	}
}

14 
	$backw¬d_üİ_Ïy”_gpu
(cÚ¡ 
üİ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
){
	}
}

16 
üİ_Ïy”
 
	$make_üİ_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
üİ_height
, 
üİ_width
, 
æ
, 
ªgË
, 
§tu¿tiÚ
, 
exposu»
)

18 
	`årštf
(
¡d”r
, "Crİ Lay”: %d x %d -> %d x %d x %d image\n", 
h
,
w
,
üİ_height
,
üİ_width
,
c
);

19 
üİ_Ïy”
 
l
 = {0};

20 
l
.
ty³
 = 
CROP
;

21 
l
.
b©ch
 = batch;

22 
l
.
h
 = h;

23 
l
.
w
 = w;

24 
l
.
c
 = c;

25 
l
.
sÿË
 = ()
üİ_height
 / 
h
;

26 
l
.
æ
 = flip;

27 
l
.
ªgË
 =‡ngle;

28 
l
.
§tu¿tiÚ
 = saturation;

29 
l
.
exposu»
 =ƒxposure;

30 
l
.
out_w
 = 
üİ_width
;

31 
l
.
out_h
 = 
üİ_height
;

32 
l
.
out_c
 = 
c
;

33 
l
.
šputs
 =†.
w
 *†.
h
 *†.
c
;

34 
l
.
ouuts
 =†.
out_w
 *†.
out_h
 *†.
out_c
;

35 
l
.
ouut
 = 
	`ÿÎoc
Ö.
ouuts
*
b©ch
, ());

36 
l
.
fÜw¬d
 = 
fÜw¬d_üİ_Ïy”
;

37 
l
.
backw¬d
 = 
backw¬d_üİ_Ïy”
;

39 #ifdeà
GPU


40 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_üİ_Ïy”_gpu
;

41 
l
.
backw¬d_gpu
 = 
backw¬d_üİ_Ïy”_gpu
;

42 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
ouuts
*
b©ch
);

43 
l
.
¿nd_gpu
 = 
	`cuda_make_¬¿y
(0,†.
b©ch
*8);

45  
l
;

46 
	}
}

48 
	$»size_üİ_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

50 
l
->
w
 = w;

51 
l
->
h
 = h;

53 
l
->
out_w
 =†->
sÿË
*
w
;

54 
l
->
out_h
 =†->
sÿË
*
h
;

56 
l
->
šputs
 =†->
w
 *†->
h
 *†->
c
;

57 
l
->
ouuts
 =†->
out_h
 *†->
out_w
 *†->
out_c
;

59 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
b©ch
*l->
ouuts
*());

60 #ifdeà
GPU


61 
	`cuda_ä“
(
l
->
ouut_gpu
);

62 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
ouuts
*l->
b©ch
);

64 
	}
}

67 
	$fÜw¬d_üİ_Ïy”
(cÚ¡ 
üİ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

69 
i
,
j
,
c
,
b
,
row
,
cŞ
;

70 
šdex
;

71 
couÁ
 = 0;

72 
æ
 = (
l
.æ && 
	`¿nd
()%2);

73 
dh
 = 
	`¿nd
()%(
l
.
h
 -†.
out_h
 + 1);

74 
dw
 = 
	`¿nd
()%(
l
.
w
 -†.
out_w
 + 1);

75 
sÿË
 = 2;

76 
Œªs
 = -1;

77 if(
l
.
nßdju¡
){

78 
sÿË
 = 1;

79 
Œªs
 = 0;

81 if(!
Ãt
.
Œaš
){

82 
æ
 = 0;

83 
dh
 = (
l
.
h
 -†.
out_h
)/2;

84 
dw
 = (
l
.
w
 -†.
out_w
)/2;

86 
b
 = 0; b < 
l
.
b©ch
; ++b){

87 
c
 = 0; c < 
l
.c; ++c){

88 
i
 = 0; i < 
l
.
out_h
; ++i){

89 
j
 = 0; j < 
l
.
out_w
; ++j){

90 if(
æ
){

91 
cŞ
 = 
l
.
w
 - 
dw
 - 
j
 - 1;

93 
cŞ
 = 
j
 + 
dw
;

95 
row
 = 
i
 + 
dh
;

96 
šdex
 = 
cŞ
+
l
.
w
*(
row
+l.
h
*(
c
 +†.c*
b
));

97 
l
.
ouut
[
couÁ
++] = 
Ãt
.
šput
[
šdex
]*
sÿË
 + 
Œªs
;

102 
	}
}

	@host/src/crop_layer.h

1 #iâdeà
CROP_LAYER_H


2 
	#CROP_LAYER_H


	)

4 
	~"image.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
	tüİ_Ïy”
;

10 
image
 
g‘_üİ_image
(
üİ_Ïy”
 
l
);

11 
üİ_Ïy”
 
make_üİ_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
üİ_height
, 
üİ_width
, 
æ
, 
ªgË
, 
§tu¿tiÚ
, 
exposu»
);

12 
fÜw¬d_üİ_Ïy”
(cÚ¡ 
üİ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 
»size_üİ_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

15 #ifdeà
GPU


16 
fÜw¬d_üİ_Ïy”_gpu
(
üİ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/cuda.c

1 
	ggpu_šdex
 = 0;

3 #ifdeà
GPU


5 
	~"cuda.h
"

6 
	~"uts.h
"

7 
	~"bÏs.h
"

8 
	~<as£¹.h
>

9 
	~<¡dlib.h
>

10 
	~<time.h
>

12 
	$cuda_£t_deviû
(
n
)

14 
gpu_šdex
 = 
n
;

15 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaS‘Deviû
(
n
);

16 
	`check_”rÜ
(
¡©us
);

17 
	}
}

19 
	$cuda_g‘_deviû
()

21 
n
 = 0;

22 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaG‘Deviû
(&
n
);

23 
	`check_”rÜ
(
¡©us
);

24  
n
;

25 
	}
}

27 
	$check_”rÜ
(
cudaE¼Ü_t
 
¡©us
)

30 
cudaE¼Ü_t
 
¡©us2
 = 
	`cudaG‘La¡E¼Ü
();

31 ià(
¡©us
 !ğ
cudaSucûss
)

33 cÚ¡ *
s
 = 
	`cudaG‘E¼ÜSŒšg
(
¡©us
);

34 
bufãr
[256];

35 
	`´štf
("CUDA E¼Ü: %s\n", 
s
);

36 
	`as£¹
(0);

37 
	`¢´štf
(
bufãr
, 256, "CUDA E¼Ü: %s", 
s
);

38 
	`”rÜ
(
bufãr
);

40 ià(
¡©us2
 !ğ
cudaSucûss
)

42 cÚ¡ *
s
 = 
	`cudaG‘E¼ÜSŒšg
(
¡©us
);

43 
bufãr
[256];

44 
	`´štf
("CUDA E¼Ü P»v: %s\n", 
s
);

45 
	`as£¹
(0);

46 
	`¢´štf
(
bufãr
, 256, "CUDA E¼Ü P»v: %s", 
s
);

47 
	`”rÜ
(
bufãr
);

49 
	}
}

51 
dim3
 
	$cuda_gridsize
(
size_t
 
n
){

52 
size_t
 
k
 = (
n
-1è/ 
BLOCK
 + 1;

53 
size_t
 
x
 = 
k
;

54 
size_t
 
y
 = 1;

55 if(
x
 > 65535){

56 
x
 = 
	`û
(
	`sq¹
(
k
));

57 
y
 = (
n
-1)/(
x
*
BLOCK
) + 1;

59 
dim3
 
d
 = {
x
, 
y
, 1};

61  
d
;

62 
	}
}

64 #ifdeà
CUDNN


65 
cudÂHªdË_t
 
	$cudÂ_hªdË
()

67 
š™
[16] = {0};

68 
cudÂHªdË_t
 
hªdË
[16];

69 
i
 = 
	`cuda_g‘_deviû
();

70 if(!
š™
[
i
]) {

71 
	`cudÂC»©e
(&
hªdË
[
i
]);

72 
š™
[
i
] = 1;

74  
hªdË
[
i
];

75 
	}
}

78 
cubÏsHªdË_t
 
	$bÏs_hªdË
()

80 
š™
[16] = {0};

81 
cubÏsHªdË_t
 
hªdË
[16];

82 
i
 = 
	`cuda_g‘_deviû
();

83 if(!
š™
[
i
]) {

84 
	`cubÏsC»©e
(&
hªdË
[
i
]);

85 
š™
[
i
] = 1;

87  
hªdË
[
i
];

88 
	}
}

90 *
	$cuda_make_¬¿y
(*
x
, 
size_t
 
n
)

92 *
x_gpu
;

93 
size_t
 
size
 = ()*
n
;

94 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaM®loc
((**)&
x_gpu
, 
size
);

95 
	`check_”rÜ
(
¡©us
);

96 if(
x
){

97 
¡©us
 = 
	`cudaMemıy
(
x_gpu
, 
x
, 
size
, 
cudaMemıyHo¡ToDeviû
);

98 
	`check_”rÜ
(
¡©us
);

100 
	`fl_gpu
(
n
, 0, 
x_gpu
, 1);

102 if(!
x_gpu
è
	`”rÜ
("Cuda malloc failed\n");

103  
x_gpu
;

104 
	}
}

106 
	$cuda_¿ndom
(*
x_gpu
, 
size_t
 
n
)

108 
cu¿ndG’”©Ü_t
 
g’
[16];

109 
š™
[16] = {0};

110 
i
 = 
	`cuda_g‘_deviû
();

111 if(!
š™
[
i
]){

112 
	`cu¿ndC»©eG’”©Ü
(&
g’
[
i
], 
CURAND_RNG_PSEUDO_DEFAULT
);

113 
	`cu¿ndS‘P£udoRªdomG’”©ÜS“d
(
g’
[
i
], 
	`time
(0));

114 
š™
[
i
] = 1;

116 
	`cu¿ndG’”©eUnifÜm
(
g’
[
i
], 
x_gpu
, 
n
);

117 
	`check_”rÜ
(
	`cudaP“kAtLa¡E¼Ü
());

118 
	}
}

120 
	$cuda_com·»
(*
x_gpu
, *
x
, 
size_t
 
n
, *
s
)

122 *
tmp
 = 
	`ÿÎoc
(
n
, ());

123 
	`cuda_puÎ_¬¿y
(
x_gpu
, 
tmp
, 
n
);

126 
	`axpy_ıu
(
n
, -1, 
x
, 1, 
tmp
, 1);

127 
”r
 = 
	`dÙ_ıu
(
n
, 
tmp
, 1,mp, 1);

128 
	`´štf
("E¼Ü %s: %f\n", 
s
, 
	`sq¹
(
”r
/
n
));

129 
	`ä“
(
tmp
);

130  
”r
;

131 
	}
}

133 *
	$cuda_make_št_¬¿y
(*
x
, 
size_t
 
n
)

135 *
x_gpu
;

136 
size_t
 
size
 = ()*
n
;

137 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaM®loc
((**)&
x_gpu
, 
size
);

138 
	`check_”rÜ
(
¡©us
);

139 if(
x
){

140 
¡©us
 = 
	`cudaMemıy
(
x_gpu
, 
x
, 
size
, 
cudaMemıyHo¡ToDeviû
);

141 
	`check_”rÜ
(
¡©us
);

143 if(!
x_gpu
è
	`”rÜ
("Cuda malloc failed\n");

144  
x_gpu
;

145 
	}
}

147 
	$cuda_ä“
(*
x_gpu
)

149 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaF»e
(
x_gpu
);

150 
	`check_”rÜ
(
¡©us
);

151 
	}
}

153 
	$cuda_push_¬¿y
(*
x_gpu
, *
x
, 
size_t
 
n
)

155 
size_t
 
size
 = ()*
n
;

156 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaMemıy
(
x_gpu
, 
x
, 
size
, 
cudaMemıyHo¡ToDeviû
);

157 
	`check_”rÜ
(
¡©us
);

158 
	}
}

160 
	$cuda_puÎ_¬¿y
(*
x_gpu
, *
x
, 
size_t
 
n
)

162 
size_t
 
size
 = ()*
n
;

163 
cudaE¼Ü_t
 
¡©us
 = 
	`cudaMemıy
(
x
, 
x_gpu
, 
size
, 
cudaMemıyDeviûToHo¡
);

164 
	`check_”rÜ
(
¡©us
);

165 
	}
}

167 
	$cuda_mag_¬¿y
(*
x_gpu
, 
size_t
 
n
)

169 *
‹mp
 = 
	`ÿÎoc
(
n
, ());

170 
	`cuda_puÎ_¬¿y
(
x_gpu
, 
‹mp
, 
n
);

171 
m
 = 
	`mag_¬¿y
(
‹mp
, 
n
);

172 
	`ä“
(
‹mp
);

173  
m
;

174 
	}
}

176 
	$cuda_£t_deviû
(
n
){
	}
}

	@host/src/cuda.h

1 #iâdeà
CUDA_H


2 
	#CUDA_H


	)

4 
	~"d¬kÃt.h
"

6 #ifdeà
GPU


8 
check_”rÜ
(
cudaE¼Ü_t
 
¡©us
);

9 
cubÏsHªdË_t
 
bÏs_hªdË
();

10 *
cuda_make_št_¬¿y
(*
x
, 
size_t
 
n
);

11 
cuda_¿ndom
(*
x_gpu
, 
size_t
 
n
);

12 
cuda_com·»
(*
x_gpu
, *
x
, 
size_t
 
n
, *
s
);

13 
dim3
 
cuda_gridsize
(
size_t
 
n
);

15 #ifdeà
CUDNN


16 
cudÂHªdË_t
 
cudÂ_hªdË
();

	@host/src/data.c

1 
	~"d©a.h
"

2 
	~"uts.h
"

3 
	~"image.h
"

4 
	~"cuda.h
"

6 
	~<¡dio.h
>

7 
	~<¡dlib.h
>

8 
	~<¡ršg.h
>

10 
±h»ad_mu‹x_t
 
	gmu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

12 
li¡
 *
	$g‘_·ths
(*
f’ame
)

14 *
·th
;

15 
FILE
 *
fe
 = 
	`fİ’
(
f’ame
, "r");

16 if(!
fe
è
	`fe_”rÜ
(
f’ame
);

17 
li¡
 *
lšes
 = 
	`make_li¡
();

18 (
·th
=
	`fg‘l
(
fe
))){

19 
	`li¡_š£¹
(
lšes
, 
·th
);

21 
	`fşo£
(
fe
);

22  
lšes
;

23 
	}
}

42 **
	$g‘_¿ndom_·ths
(**
·ths
, 
n
, 
m
)

44 **
¿ndom_·ths
 = 
	`ÿÎoc
(
n
, (*));

45 
i
;

46 
	`±h»ad_mu‹x_lock
(&
mu‹x
);

47 
i
 = 0; i < 
n
; ++i){

48 
šdex
 = 
	`¿nd
()%
m
;

49 
¿ndom_·ths
[
i
] = 
·ths
[
šdex
];

52 
	`±h»ad_mu‹x_uÆock
(&
mu‹x
);

53  
¿ndom_·ths
;

54 
	}
}

56 **
	$fšd_»¶aû_·ths
(**
·ths
, 
n
, *
fšd
, *
»¶aû
)

58 **
»¶aû_·ths
 = 
	`ÿÎoc
(
n
, (*));

59 
i
;

60 
i
 = 0; i < 
n
; ++i){

61 
»¶aûd
[4096];

62 
	`fšd_»¶aû
(
·ths
[
i
], 
fšd
, 
»¶aû
, 
»¶aûd
);

63 
»¶aû_·ths
[
i
] = 
	`cİy_¡ršg
(
»¶aûd
);

65  
»¶aû_·ths
;

66 
	}
}

68 
m©rix
 
	$lßd_image_·ths_g¿y
(**
·ths
, 
n
, 
w
, 
h
)

70 
i
;

71 
m©rix
 
X
;

72 
X
.
rows
 = 
n
;

73 
X
.
v®s
 = 
	`ÿÎoc
(X.
rows
, (*));

74 
X
.
cŞs
 = 0;

76 
i
 = 0; i < 
n
; ++i){

77 
image
 
im
 = 
	`lßd_image
(
·ths
[
i
], 
w
, 
h
, 3);

79 
image
 
g¿y
 = 
	`g¿ysÿË_image
(
im
);

80 
	`ä“_image
(
im
);

81 
im
 = 
g¿y
;

83 
X
.
v®s
[
i
] = 
im
.
d©a
;

84 
X
.
cŞs
 = 
im
.
h
*im.
w
*im.
c
;

86  
X
;

87 
	}
}

89 
m©rix
 
	$lßd_image_·ths
(**
·ths
, 
n
, 
w
, 
h
)

91 
i
;

92 
m©rix
 
X
;

93 
X
.
rows
 = 
n
;

94 
X
.
v®s
 = 
	`ÿÎoc
(X.
rows
, (*));

95 
X
.
cŞs
 = 0;

97 
i
 = 0; i < 
n
; ++i){

98 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 
w
, 
h
);

99 
X
.
v®s
[
i
] = 
im
.
d©a
;

100 
X
.
cŞs
 = 
im
.
h
*im.
w
*im.
c
;

102  
X
;

103 
	}
}

105 
m©rix
 
	$lßd_image_augm’t_·ths
(**
·ths
, 
n
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 
ûÁ”
)

107 
i
;

108 
m©rix
 
X
;

109 
X
.
rows
 = 
n
;

110 
X
.
v®s
 = 
	`ÿÎoc
(X.
rows
, (*));

111 
X
.
cŞs
 = 0;

113 
i
 = 0; i < 
n
; ++i){

114 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

115 
image
 
üİ
;

116 if(
ûÁ”
){

117 
üİ
 = 
	`ûÁ”_üİ_image
(
im
, 
size
, size);

119 
üİ
 = 
	`¿ndom_augm’t_image
(
im
, 
ªgË
, 
a¥eù
, 
mš
, 
max
, 
size
, size);

121 
æ
 = 
	`¿nd
()%2;

122 ià(
æ
è
	`æ_image
(
üİ
);

123 
	`¿ndom_di¡Üt_image
(
üİ
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

131 
	`ä“_image
(
im
);

132 
X
.
v®s
[
i
] = 
üİ
.
d©a
;

133 
X
.
cŞs
 = 
üİ
.
h
*üİ.
w
*üİ.
c
;

135  
X
;

136 
	}
}

139 
box_Ïb–
 *
	$»ad_boxes
(*
f’ame
, *
n
)

141 
FILE
 *
fe
 = 
	`fİ’
(
f’ame
, "r");

142 if(!
fe
è
	`fe_”rÜ
(
f’ame
);

143 
x
, 
y
, 
h
, 
w
;

144 
id
;

145 
couÁ
 = 0;

146 
size
 = 64;

147 
box_Ïb–
 *
boxes
 = 
	`ÿÎoc
(
size
, (box_label));

148 
	`fsÿnf
(
fe
, "%d %à%à%à%f", &
id
, &
x
, &
y
, &
w
, &
h
) == 5){

149 if(
couÁ
 =ğ
size
) {

150 
size
 = size * 2;

151 
boxes
 = 
	`»®loc
(boxes, 
size
*(
box_Ïb–
));

153 
boxes
[
couÁ
].
id
 = id;

154 
boxes
[
couÁ
].
x
 = x;

155 
boxes
[
couÁ
].
y
 = y;

156 
boxes
[
couÁ
].
h
 = h;

157 
boxes
[
couÁ
].
w
 = w;

158 
boxes
[
couÁ
].
Ëá
 = 
x
 - 
w
/2;

159 
boxes
[
couÁ
].
right
 = 
x
 + 
w
/2;

160 
boxes
[
couÁ
].
tİ
 = 
y
 - 
h
/2;

161 
boxes
[
couÁ
].
bÙtom
 = 
y
 + 
h
/2;

162 ++
couÁ
;

164 
	`fşo£
(
fe
);

165 *
n
 = 
couÁ
;

166  
boxes
;

167 
	}
}

169 
	$¿ndomize_boxes
(
box_Ïb–
 *
b
, 
n
)

171 
i
;

172 
i
 = 0; i < 
n
; ++i){

173 
box_Ïb–
 
sw­
 = 
b
[
i
];

174 
šdex
 = 
	`¿nd
()%
n
;

175 
b
[
i
] = b[
šdex
];

176 
b
[
šdex
] = 
sw­
;

178 
	}
}

180 
	$cÜ»ù_boxes
(
box_Ïb–
 *
boxes
, 
n
, 
dx
, 
dy
, 
sx
, 
sy
, 
æ
)

182 
i
;

183 
i
 = 0; i < 
n
; ++i){

184 if(
boxes
[
i
].
x
 =ğ0 && boxes[i].
y
 == 0) {

185 
boxes
[
i
].
x
 = 999999;

186 
boxes
[
i
].
y
 = 999999;

187 
boxes
[
i
].
w
 = 999999;

188 
boxes
[
i
].
h
 = 999999;

191 
boxes
[
i
].
Ëá
 = boxes[i].Ëá * 
sx
 - 
dx
;

192 
boxes
[
i
].
right
 = boxes[i].righˆ* 
sx
 - 
dx
;

193 
boxes
[
i
].
tİ
 = boxes[i].tİ * 
sy
 - 
dy
;

194 
boxes
[
i
].
bÙtom
 = boxes[i].bÙtom* 
sy
 - 
dy
;

196 if(
æ
){

197 
sw­
 = 
boxes
[
i
].
Ëá
;

198 
boxes
[
i
].
Ëá
 = 1. - boxes[i].
right
;

199 
boxes
[
i
].
right
 = 1. - 
sw­
;

202 
boxes
[
i
].
Ëá
 = 
	`cÚ¡¿š
(0, 1, boxes[i].left);

203 
boxes
[
i
].
right
 = 
	`cÚ¡¿š
(0, 1, boxes[i].right);

204 
boxes
[
i
].
tİ
 = 
	`cÚ¡¿š
(0, 1, boxes[i].top);

205 
boxes
[
i
].
bÙtom
 = 
	`cÚ¡¿š
(0, 1, boxes[i].bottom);

207 
boxes
[
i
].
x
 = (boxes[i].
Ëá
+boxes[i].
right
)/2;

208 
boxes
[
i
].
y
 = (boxes[i].
tİ
+boxes[i].
bÙtom
)/2;

209 
boxes
[
i
].
w
 = (boxes[i].
right
 - boxes[i].
Ëá
);

210 
boxes
[
i
].
h
 = (boxes[i].
bÙtom
 - boxes[i].
tİ
);

212 
boxes
[
i
].
w
 = 
	`cÚ¡¿š
(0, 1, boxes[i].w);

213 
boxes
[
i
].
h
 = 
	`cÚ¡¿š
(0, 1, boxes[i].h);

215 
	}
}

217 
	$fl_Œuth_swag
(*
·th
, *
Œuth
, 
şas£s
, 
æ
, 
dx
, 
dy
, 
sx
, 
sy
)

219 
Ïb–·th
[4096];

220 
	`fšd_»¶aû
(
·th
, "images", "Ïb–s", 
Ïb–·th
);

221 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

222 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

223 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

224 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

226 
couÁ
 = 0;

227 
box_Ïb–
 *
boxes
 = 
	`»ad_boxes
(
Ïb–·th
, &
couÁ
);

228 
	`¿ndomize_boxes
(
boxes
, 
couÁ
);

229 
	`cÜ»ù_boxes
(
boxes
, 
couÁ
, 
dx
, 
dy
, 
sx
, 
sy
, 
æ
);

230 
x
,
y
,
w
,
h
;

231 
id
;

232 
i
;

234 
i
 = 0; i < 
couÁ
 && i < 90; ++i) {

235 
x
 = 
boxes
[
i
].x;

236 
y
 = 
boxes
[
i
].y;

237 
w
 = 
boxes
[
i
].w;

238 
h
 = 
boxes
[
i
].h;

239 
id
 = 
boxes
[
i
].id;

241 ià(
w
 < .0 || 
h
 < .0) ;

243 
šdex
 = (4+
şas£s
è* 
i
;

245 
Œuth
[
šdex
++] = 
x
;

246 
Œuth
[
šdex
++] = 
y
;

247 
Œuth
[
šdex
++] = 
w
;

248 
Œuth
[
šdex
++] = 
h
;

250 ià(
id
 < 
şas£s
è
Œuth
[
šdex
+id] = 1;

252 
	`ä“
(
boxes
);

253 
	}
}

255 
	$fl_Œuth_»giÚ
(*
·th
, *
Œuth
, 
şas£s
, 
num_boxes
, 
æ
, 
dx
, 
dy
, 
sx
, 
sy
)

257 
Ïb–·th
[4096];

258 
	`fšd_»¶aû
(
·th
, "images", "Ïb–s", 
Ïb–·th
);

259 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

261 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

262 
	`fšd_»¶aû
(
Ïb–·th
, ".png", ".txt",†abelpath);

263 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

264 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

265 
couÁ
 = 0;

266 
box_Ïb–
 *
boxes
 = 
	`»ad_boxes
(
Ïb–·th
, &
couÁ
);

267 
	`¿ndomize_boxes
(
boxes
, 
couÁ
);

268 
	`cÜ»ù_boxes
(
boxes
, 
couÁ
, 
dx
, 
dy
, 
sx
, 
sy
, 
æ
);

269 
x
,
y
,
w
,
h
;

270 
id
;

271 
i
;

273 
i
 = 0; i < 
couÁ
; ++i) {

274 
x
 = 
boxes
[
i
].x;

275 
y
 = 
boxes
[
i
].y;

276 
w
 = 
boxes
[
i
].w;

277 
h
 = 
boxes
[
i
].h;

278 
id
 = 
boxes
[
i
].id;

280 ià(
w
 < .005 || 
h
 < .005) ;

282 
cŞ
 = ()(
x
*
num_boxes
);

283 
row
 = ()(
y
*
num_boxes
);

285 
x
 = x*
num_boxes
 - 
cŞ
;

286 
y
 = y*
num_boxes
 - 
row
;

288 
šdex
 = (
cŞ
+
row
*
num_boxes
)*(5+
şas£s
);

289 ià(
Œuth
[
šdex
]) ;

290 
Œuth
[
šdex
++] = 1;

292 ià(
id
 < 
şas£s
è
Œuth
[
šdex
+id] = 1;

293 
šdex
 +ğ
şas£s
;

295 
Œuth
[
šdex
++] = 
x
;

296 
Œuth
[
šdex
++] = 
y
;

297 
Œuth
[
šdex
++] = 
w
;

298 
Œuth
[
šdex
++] = 
h
;

300 
	`ä“
(
boxes
);

301 
	}
}

303 
	$lßd_¾e
(
image
 
im
, *
¾e
, 
n
)

305 
couÁ
 = 0;

306 
cu¼
 = 0;

307 
i
,
j
;

308 
i
 = 0; i < 
n
; ++i){

309 
j
 = 0; j < 
¾e
[
i
]; ++j){

310 
im
.
d©a
[
couÁ
++] = 
cu¼
;

312 
cu¼
 = 1 - curr;

314 ; 
couÁ
 < 
im
.
h
*im.
w
*im.
c
; ++count){

315 
im
.
d©a
[
couÁ
] = 
cu¼
;

317 
	}
}

319 
	$Ü_image
(
image
 
¤c
, imag
de¡
, 
c
)

321 
i
;

322 
i
 = 0; i < 
¤c
.
w
*¤c.
h
; ++i){

323 if(
¤c
.
d©a
[
i
]è
de¡
.d©a[de¡.
w
*de¡.
h
*
c
 + i] = 1;

325 
	}
}

327 
	$exşusive_image
(
image
 
¤c
)

329 
k
, 
j
, 
i
;

330 
s
 = 
¤c
.
w
*¤c.
h
;

331 
k
 = 0; k < 
¤c
.
c
-1; ++k){

332 
i
 = 0; i < 
s
; ++i){

333 ià(
¤c
.
d©a
[
k
*
s
 + 
i
]){

334 
j
 = 
k
+1; j < 
¤c
.
c
; ++j){

335 
¤c
.
d©a
[
j
*
s
 + 
i
] = 0;

340 
	}
}

342 
box
 
	$bound_image
(
image
 
im
)

344 
x
,
y
;

345 
mšx
 = 
im
.
w
;

346 
mšy
 = 
im
.
h
;

347 
maxx
 = 0;

348 
maxy
 = 0;

349 
y
 = 0; y < 
im
.
h
; ++y){

350 
x
 = 0; x < 
im
.
w
; ++x){

351 if(
im
.
d©a
[
y
*im.
w
 + 
x
]){

352 
mšx
 = (
x
 < minx) ? x : minx;

353 
mšy
 = (
y
 < miny) ? y : miny;

354 
maxx
 = (
x
 > maxx) ? x : maxx;

355 
maxy
 = (
y
 > maxy) ? y : maxy;

359 
box
 
b
 = {
mšx
, 
mšy
, 
maxx
-mšx + 1, 
maxy
-miny + 1};

361  
b
;

362 
	}
}

364 
	$fl_Œuth_i£g
(*
·th
, 
num_boxes
, *
Œuth
, 
şas£s
, 
w
, 
h
, 
augm’t_¬gs
 
aug
, 
æ
, 
mw
, 
mh
)

366 
Ïb–·th
[4096];

367 
	`fšd_»¶aû
(
·th
, "images", "mask", 
Ïb–·th
);

368 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "mask",†abelpath);

369 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

370 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

371 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

372 
FILE
 *
fe
 = 
	`fİ’
(
Ïb–·th
, "r");

373 if(!
fe
è
	`fe_”rÜ
(
Ïb–·th
);

374 
buff
[32788];

375 
id
;

376 
i
 = 0;

377 
j
;

378 
image
 
·¹
 = 
	`make_image
(
w
, 
h
, 1);

379 (
	`fsÿnf
(
fe
, "%d %s", &
id
, 
buff
è=ğ2è&& 
i
 < 
num_boxes
){

380 
n
 = 0;

381 *
¾e
 = 
	`»ad_ši¡
(
buff
, &
n
, 0);

382 
	`lßd_¾e
(
·¹
, 
¾e
, 
n
);

383 
image
 
sized
 = 
	`rÙ©e_üİ_image
(
·¹
, 
aug
.
¿d
,‡ug.
sÿË
,‡ug.
w
,‡ug.
h
,‡ug.
dx
,‡ug.
dy
,‡ug.
a¥eù
);

384 if(
æ
è
	`æ_image
(
sized
);

386 
image
 
mask
 = 
	`»size_image
(
sized
, 
mw
, 
mh
);

387 
Œuth
[
i
*(
mw
*
mh
+1)] = 
id
;

388 
j
 = 0; j < 
mw
*
mh
; ++j){

389 
Œuth
[
i
*(
mw
*
mh
 + 1è+ 1 + 
j
] = 
mask
.
d©a
[j];

391 ++
i
;

393 
	`ä“_image
(
mask
);

394 
	`ä“_image
(
sized
);

395 
	`ä“
(
¾e
);

397 if(
i
 < 
num_boxes
è
Œuth
[i*(
mw
*
mh
+1)] = -1;

398 
	`fşo£
(
fe
);

399 
	`ä“_image
(
·¹
);

400 
	}
}

402 
	$fl_Œuth_mask
(*
·th
, 
num_boxes
, *
Œuth
, 
şas£s
, 
w
, 
h
, 
augm’t_¬gs
 
aug
, 
æ
, 
mw
, 
mh
)

404 
Ïb–·th
[4096];

405 
	`fšd_»¶aû
(
·th
, "images", "mask", 
Ïb–·th
);

406 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "mask",†abelpath);

407 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

408 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

409 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

410 
FILE
 *
fe
 = 
	`fİ’
(
Ïb–·th
, "r");

411 if(!
fe
è
	`fe_”rÜ
(
Ïb–·th
);

412 
buff
[32788];

413 
id
;

414 
i
 = 0;

415 
image
 
·¹
 = 
	`make_image
(
w
, 
h
, 1);

416 (
	`fsÿnf
(
fe
, "%d %s", &
id
, 
buff
è=ğ2è&& 
i
 < 
num_boxes
){

417 
n
 = 0;

418 *
¾e
 = 
	`»ad_ši¡
(
buff
, &
n
, 0);

419 
	`lßd_¾e
(
·¹
, 
¾e
, 
n
);

420 
image
 
sized
 = 
	`rÙ©e_üİ_image
(
·¹
, 
aug
.
¿d
,‡ug.
sÿË
,‡ug.
w
,‡ug.
h
,‡ug.
dx
,‡ug.
dy
,‡ug.
a¥eù
);

421 if(
æ
è
	`æ_image
(
sized
);

422 
box
 
b
 = 
	`bound_image
(
sized
);

423 if(
b
.
w
 > 0){

424 
image
 
üİ
 = 
	`üİ_image
(
sized
, 
b
.
x
, b.
y
, b.
w
, b.
h
);

425 
image
 
mask
 = 
	`»size_image
(
üİ
, 
mw
, 
mh
);

426 
Œuth
[
i
*(4 + 
mw
*
mh
 + 1è+ 0] = (
b
.
x
 + b.
w
/2.)/
sized
.w;

427 
Œuth
[
i
*(4 + 
mw
*
mh
 + 1è+ 1] = (
b
.
y
 + b.
h
/2.)/
sized
.h;

428 
Œuth
[
i
*(4 + 
mw
*
mh
 + 1è+ 2] = 
b
.
w
/
sized
.w;

429 
Œuth
[
i
*(4 + 
mw
*
mh
 + 1è+ 3] = 
b
.
h
/
sized
.h;

430 
j
;

431 
j
 = 0; j < 
mw
*
mh
; ++j){

432 
Œuth
[
i
*(4 + 
mw
*
mh
 + 1è+ 4 + 
j
] = 
mask
.
d©a
[j];

434 
Œuth
[
i
*(4 + 
mw
*
mh
 + 1è+ 4 + mw*mh] = 
id
;

435 
	`ä“_image
(
üİ
);

436 
	`ä“_image
(
mask
);

437 ++
i
;

439 
	`ä“_image
(
sized
);

440 
	`ä“
(
¾e
);

442 
	`fşo£
(
fe
);

443 
	`ä“_image
(
·¹
);

444 
	}
}

447 
	$fl_Œuth_d‘eùiÚ
(*
·th
, 
num_boxes
, *
Œuth
, 
şas£s
, 
æ
, 
dx
, 
dy
, 
sx
, 
sy
)

449 
Ïb–·th
[4096];

450 
	`fšd_»¶aû
(
·th
, "images", "Ïb–s", 
Ïb–·th
);

451 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

453 
	`fšd_»¶aû
(
Ïb–·th
, "raw", "labels",†abelpath);

454 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

455 
	`fšd_»¶aû
(
Ïb–·th
, ".png", ".txt",†abelpath);

456 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

457 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

458 
couÁ
 = 0;

459 
box_Ïb–
 *
boxes
 = 
	`»ad_boxes
(
Ïb–·th
, &
couÁ
);

460 
	`¿ndomize_boxes
(
boxes
, 
couÁ
);

461 
	`cÜ»ù_boxes
(
boxes
, 
couÁ
, 
dx
, 
dy
, 
sx
, 
sy
, 
æ
);

462 if(
couÁ
 > 
num_boxes
) count =‚um_boxes;

463 
x
,
y
,
w
,
h
;

464 
id
;

465 
i
;

466 
sub
 = 0;

468 
i
 = 0; i < 
couÁ
; ++i) {

469 
x
 = 
boxes
[
i
].x;

470 
y
 = 
boxes
[
i
].y;

471 
w
 = 
boxes
[
i
].w;

472 
h
 = 
boxes
[
i
].h;

473 
id
 = 
boxes
[
i
].id;

475 ià((
w
 < .001 || 
h
 < .001)) {

476 ++
sub
;

480 
Œuth
[(
i
-
sub
)*5+0] = 
x
;

481 
Œuth
[(
i
-
sub
)*5+1] = 
y
;

482 
Œuth
[(
i
-
sub
)*5+2] = 
w
;

483 
Œuth
[(
i
-
sub
)*5+3] = 
h
;

484 
Œuth
[(
i
-
sub
)*5+4] = 
id
;

486 
	`ä“
(
boxes
);

487 
	}
}

489 
	#NUMCHARS
 37

	)

491 
	$´št_Ë‰”s
(*
´ed
, 
n
)

493 
i
;

494 
i
 = 0; i < 
n
; ++i){

495 
šdex
 = 
	`max_šdex
(
´ed
+
i
*
NUMCHARS
, NUMCHARS);

496 
	`´štf
("%c", 
	`št_to_®phªum
(
šdex
));

498 
	`´štf
("\n");

499 
	}
}

501 
	$fl_Œuth_ÿ±cha
(*
·th
, 
n
, *
Œuth
)

503 *
begš
 = 
	`¡¼chr
(
·th
, '/');

504 ++
begš
;

505 
i
;

506 
i
 = 0; i < 
	`¡¾’
(
begš
è&& i < 
n
 && begin[i] != '.'; ++i){

507 
šdex
 = 
	`®phªum_to_št
(
begš
[
i
]);

508 if(
šdex
 > 35è
	`´štf
("Bad %c\n", 
begš
[
i
]);

509 
Œuth
[
i
*
NUMCHARS
+
šdex
] = 1;

511 ;
i
 < 
n
; ++i){

512 
Œuth
[
i
*
NUMCHARS
 + NUMCHARS-1] = 1;

514 
	}
}

516 
d©a
 
	$lßd_d©a_ÿ±cha
(**
·ths
, 
n
, 
m
, 
k
, 
w
, 
h
)

518 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

519 
d©a
 
d
 = {0};

520 
d
.
sh®low
 = 0;

521 
d
.
X
 = 
	`lßd_image_·ths
(
·ths
, 
n
, 
w
, 
h
);

522 
d
.
y
 = 
	`make_m©rix
(
n
, 
k
*
NUMCHARS
);

523 
i
;

524 
i
 = 0; i < 
n
; ++i){

525 
	`fl_Œuth_ÿ±cha
(
·ths
[
i
], 
k
, 
d
.
y
.
v®s
[i]);

527 if(
m
è
	`ä“
(
·ths
);

528  
d
;

529 
	}
}

531 
d©a
 
	$lßd_d©a_ÿ±cha_’code
(**
·ths
, 
n
, 
m
, 
w
, 
h
)

533 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

534 
d©a
 
d
 = {0};

535 
d
.
sh®low
 = 0;

536 
d
.
X
 = 
	`lßd_image_·ths
(
·ths
, 
n
, 
w
, 
h
);

537 
d
.
X
.
cŞs
 = 17100;

538 
d
.
y
 = d.
X
;

539 if(
m
è
	`ä“
(
·ths
);

540  
d
;

541 
	}
}

543 
	$fl_Œuth
(*
·th
, **
Ïb–s
, 
k
, *
Œuth
)

545 
i
;

546 
	`mem£t
(
Œuth
, 0, 
k
*());

547 
couÁ
 = 0;

548 
i
 = 0; i < 
k
; ++i){

549 if(
	`¡r¡r
(
·th
, 
Ïb–s
[
i
])){

550 
Œuth
[
i
] = 1;

551 ++
couÁ
;

555 if(
couÁ
 !ğ1 && (
k
 !ğ1 || couÁ !ğ0)è
	`´štf
("ToØmªy o¸toØãw†ab–s: %d, %s\n", couÁ, 
·th
);

556 
	}
}

558 
	$fl_h›¿rchy
(*
Œuth
, 
k
, 
Œ“
 *
h›¿rchy
)

560 
j
;

561 
j
 = 0; j < 
k
; ++j){

562 if(
Œuth
[
j
]){

563 
·»Á
 = 
h›¿rchy
->·»Á[
j
];

564 
·»Á
 >= 0){

565 
Œuth
[
·»Á
] = 1;

566 
·»Á
 = 
h›¿rchy
->parent[parent];

570 
i
;

571 
couÁ
 = 0;

572 
j
 = 0; j < 
h›¿rchy
->
groups
; ++j){

574 
mask
 = 1;

575 
i
 = 0; i < 
h›¿rchy
->
group_size
[
j
]; ++i){

576 if(
Œuth
[
couÁ
 + 
i
]){

577 
mask
 = 0;

581 ià(
mask
) {

582 
i
 = 0; i < 
h›¿rchy
->
group_size
[
j
]; ++i){

583 
Œuth
[
couÁ
 + 
i
] = 
SECRET_NUM
;

586 
couÁ
 +ğ
h›¿rchy
->
group_size
[
j
];

588 
	}
}

590 
m©rix
 
	$lßd_»g»ssiÚ_Ïb–s_·ths
(**
·ths
, 
n
, 
k
)

592 
m©rix
 
y
 = 
	`make_m©rix
(
n
, 
k
);

593 
i
,
j
;

594 
i
 = 0; i < 
n
; ++i){

595 
Ïb–·th
[4096];

596 
	`fšd_»¶aû
(
·ths
[
i
], "images", "Ïb–s", 
Ïb–·th
);

597 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "labels",†abelpath);

598 
	`fšd_»¶aû
(
Ïb–·th
, ".BMP", ".txt",†abelpath);

599 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

600 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

601 
	`fšd_»¶aû
(
Ïb–·th
, ".JPeG", ".txt",†abelpath);

602 
	`fšd_»¶aû
(
Ïb–·th
, ".Jpeg", ".txt",†abelpath);

603 
	`fšd_»¶aû
(
Ïb–·th
, ".PNG", ".txt",†abelpath);

604 
	`fšd_»¶aû
(
Ïb–·th
, ".TIF", ".txt",†abelpath);

605 
	`fšd_»¶aû
(
Ïb–·th
, ".bmp", ".txt",†abelpath);

606 
	`fšd_»¶aû
(
Ïb–·th
, ".jpeg", ".txt",†abelpath);

607 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

608 
	`fšd_»¶aû
(
Ïb–·th
, ".png", ".txt",†abelpath);

609 
	`fšd_»¶aû
(
Ïb–·th
, ".tif", ".txt",†abelpath);

611 
FILE
 *
fe
 = 
	`fİ’
(
Ïb–·th
, "r");

612 
j
 = 0; j < 
k
; ++j){

613 
	`fsÿnf
(
fe
, "%f", &(
y
.
v®s
[
i
][
j
]));

615 
	`fşo£
(
fe
);

617  
y
;

618 
	}
}

620 
m©rix
 
	$lßd_Ïb–s_·ths
(**
·ths
, 
n
, **
Ïb–s
, 
k
, 
Œ“
 *
h›¿rchy
)

622 
m©rix
 
y
 = 
	`make_m©rix
(
n
, 
k
);

623 
i
;

624 
i
 = 0; i < 
n
 && 
Ïb–s
; ++i){

625 
	`fl_Œuth
(
·ths
[
i
], 
Ïb–s
, 
k
, 
y
.
v®s
[i]);

626 if(
h›¿rchy
){

627 
	`fl_h›¿rchy
(
y
.
v®s
[
i
], 
k
, 
h›¿rchy
);

630  
y
;

631 
	}
}

633 
m©rix
 
	$lßd_gs_·ths
(**
·ths
, 
n
, 
k
)

635 
m©rix
 
y
 = 
	`make_m©rix
(
n
, 
k
);

636 
i
;

638 
i
 = 0; i < 
n
; ++i){

639 
Ïb–
[4096];

640 
	`fšd_»¶aû
(
·ths
[
i
], "images", "Ïb–s", 
Ïb–
);

641 
	`fšd_»¶aû
(
Ïb–
, ".jpg", ".txt",†abel);

642 
FILE
 *
fe
 = 
	`fİ’
(
Ïb–
, "r");

643 ià(!
fe
) ;

645 
g
;

646 
	`fsÿnf
(
fe
, "%d", &
g
) == 1){

647 if(
g
 < 
k
){

648 
y
.
v®s
[
i
][
g
] = 1;

651 
	`fşo£
(
fe
);

654  
y
;

655 
	}
}

657 **
	$g‘_Ïb–s
(*
f’ame
)

659 
li¡
 *
¶i¡
 = 
	`g‘_·ths
(
f’ame
);

660 **
Ïb–s
 = (**)
	`li¡_to_¬¿y
(
¶i¡
);

661 
	`ä“_li¡
(
¶i¡
);

662  
Ïb–s
;

663 
	}
}

665 
	$ä“_d©a
(
d©a
 
d
)

667 if(!
d
.
sh®low
){

668 
	`ä“_m©rix
(
d
.
X
);

669 
	`ä“_m©rix
(
d
.
y
);

671 
	`ä“
(
d
.
X
.
v®s
);

672 
	`ä“
(
d
.
y
.
v®s
);

674 
	}
}

676 
image
 
	$g‘_£gm’tiÚ_image
(*
·th
, 
w
, 
h
, 
şas£s
)

678 
Ïb–·th
[4096];

679 
	`fšd_»¶aû
(
·th
, "images", "mask", 
Ïb–·th
);

680 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "mask",†abelpath);

681 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

682 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

683 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

684 
image
 
mask
 = 
	`make_image
(
w
, 
h
, 
şas£s
);

685 
FILE
 *
fe
 = 
	`fİ’
(
Ïb–·th
, "r");

686 if(!
fe
è
	`fe_”rÜ
(
Ïb–·th
);

687 
buff
[32788];

688 
id
;

689 
image
 
·¹
 = 
	`make_image
(
w
, 
h
, 1);

690 
	`fsÿnf
(
fe
, "%d %s", &
id
, 
buff
) == 2){

691 
n
 = 0;

692 *
¾e
 = 
	`»ad_ši¡
(
buff
, &
n
, 0);

693 
	`lßd_¾e
(
·¹
, 
¾e
, 
n
);

694 
	`Ü_image
(
·¹
, 
mask
, 
id
);

695 
	`ä“
(
¾e
);

698 
	`fşo£
(
fe
);

699 
	`ä“_image
(
·¹
);

700  
mask
;

701 
	}
}

703 
image
 
	$g‘_£gm’tiÚ_image2
(*
·th
, 
w
, 
h
, 
şas£s
)

705 
Ïb–·th
[4096];

706 
	`fšd_»¶aû
(
·th
, "images", "mask", 
Ïb–·th
);

707 
	`fšd_»¶aû
(
Ïb–·th
, "JPEGImages", "mask",†abelpath);

708 
	`fšd_»¶aû
(
Ïb–·th
, ".jpg", ".txt",†abelpath);

709 
	`fšd_»¶aû
(
Ïb–·th
, ".JPG", ".txt",†abelpath);

710 
	`fšd_»¶aû
(
Ïb–·th
, ".JPEG", ".txt",†abelpath);

711 
image
 
mask
 = 
	`make_image
(
w
, 
h
, 
şas£s
+1);

712 
i
;

713 
i
 = 0; i < 
w
*
h
; ++i){

714 
mask
.
d©a
[
w
*
h
*
şas£s
 + 
i
] = 1;

716 
FILE
 *
fe
 = 
	`fİ’
(
Ïb–·th
, "r");

717 if(!
fe
è
	`fe_”rÜ
(
Ïb–·th
);

718 
buff
[32788];

719 
id
;

720 
image
 
·¹
 = 
	`make_image
(
w
, 
h
, 1);

721 
	`fsÿnf
(
fe
, "%d %s", &
id
, 
buff
) == 2){

722 
n
 = 0;

723 *
¾e
 = 
	`»ad_ši¡
(
buff
, &
n
, 0);

724 
	`lßd_¾e
(
·¹
, 
¾e
, 
n
);

725 
	`Ü_image
(
·¹
, 
mask
, 
id
);

726 
i
 = 0; i < 
w
*
h
; ++i){

727 if(
·¹
.
d©a
[
i
]è
mask
.d©a[
w
*
h
*
şas£s
 + i] = 0;

729 
	`ä“
(
¾e
);

732 
	`fşo£
(
fe
);

733 
	`ä“_image
(
·¹
);

734  
mask
;

735 
	}
}

737 
d©a
 
	$lßd_d©a_£g
(
n
, **
·ths
, 
m
, 
w
, 
h
, 
şas£s
, 
mš
, 
max
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 
div
)

739 **
¿ndom_·ths
 = 
	`g‘_¿ndom_·ths
(
·ths
, 
n
, 
m
);

740 
i
;

741 
d©a
 
d
 = {0};

742 
d
.
sh®low
 = 0;

744 
d
.
X
.
rows
 = 
n
;

745 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

746 
d
.
X
.
cŞs
 = 
h
*
w
*3;

749 
d
.
y
.
rows
 = 
n
;

750 
d
.
y
.
cŞs
 = 
h
*
w
*
şas£s
/
div
/div;

751 
d
.
y
.
v®s
 = 
	`ÿÎoc
(d.
X
.
rows
, (*));

753 
i
 = 0; i < 
n
; ++i){

754 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
¿ndom_·ths
[
i
], 0, 0);

755 
augm’t_¬gs
 
a
 = 
	`¿ndom_augm’t_¬gs
(
Üig
, 
ªgË
, 
a¥eù
, 
mš
, 
max
, 
w
, 
h
);

756 
image
 
sized
 = 
	`rÙ©e_üİ_image
(
Üig
, 
a
.
¿d
,‡.
sÿË
,‡.
w
,‡.
h
,‡.
dx
,‡.
dy
,‡.
a¥eù
);

758 
æ
 = 
	`¿nd
()%2;

759 if(
æ
è
	`æ_image
(
sized
);

760 
	`¿ndom_di¡Üt_image
(
sized
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

761 
d
.
X
.
v®s
[
i
] = 
sized
.
d©a
;

763 
image
 
mask
 = 
	`g‘_£gm’tiÚ_image
(
¿ndom_·ths
[
i
], 
Üig
.
w
, orig.
h
, 
şas£s
);

765 
image
 
sized_m
 = 
	`rÙ©e_üİ_image
(
mask
, 
a
.
¿d
,‡.
sÿË
/
div
,‡.
w
/div,‡.
h
/div,‡.
dx
/div,‡.
dy
/div,‡.
a¥eù
);

767 if(
æ
è
	`æ_image
(
sized_m
);

768 
d
.
y
.
v®s
[
i
] = 
sized_m
.
d©a
;

770 
	`ä“_image
(
Üig
);

771 
	`ä“_image
(
mask
);

781 
	`ä“
(
¿ndom_·ths
);

782  
d
;

783 
	}
}

785 
d©a
 
	$lßd_d©a_i£g
(
n
, **
·ths
, 
m
, 
w
, 
h
, 
şas£s
, 
boxes
, 
div
, 
mš
, 
max
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

787 **
¿ndom_·ths
 = 
	`g‘_¿ndom_·ths
(
·ths
, 
n
, 
m
);

788 
i
;

789 
d©a
 
d
 = {0};

790 
d
.
sh®low
 = 0;

792 
d
.
X
.
rows
 = 
n
;

793 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

794 
d
.
X
.
cŞs
 = 
h
*
w
*3;

796 
d
.
y
 = 
	`make_m©rix
(
n
, (((
w
/
div
)*(
h
/div))+1)*
boxes
);

798 
i
 = 0; i < 
n
; ++i){

799 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
¿ndom_·ths
[
i
], 0, 0);

800 
augm’t_¬gs
 
a
 = 
	`¿ndom_augm’t_¬gs
(
Üig
, 
ªgË
, 
a¥eù
, 
mš
, 
max
, 
w
, 
h
);

801 
image
 
sized
 = 
	`rÙ©e_üİ_image
(
Üig
, 
a
.
¿d
,‡.
sÿË
,‡.
w
,‡.
h
,‡.
dx
,‡.
dy
,‡.
a¥eù
);

803 
æ
 = 
	`¿nd
()%2;

804 if(
æ
è
	`æ_image
(
sized
);

805 
	`¿ndom_di¡Üt_image
(
sized
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

806 
d
.
X
.
v®s
[
i
] = 
sized
.
d©a
;

809 
	`fl_Œuth_i£g
(
¿ndom_·ths
[
i
], 
boxes
, 
d
.
y
.
v®s
[i], 
şas£s
, 
Üig
.
w
, orig.
h
, 
a
, 
æ
, w/
div
, h/div);

811 
	`ä“_image
(
Üig
);

821 
	`ä“
(
¿ndom_·ths
);

822  
d
;

823 
	}
}

825 
d©a
 
	$lßd_d©a_mask
(
n
, **
·ths
, 
m
, 
w
, 
h
, 
şas£s
, 
boxes
, 
coÜds
, 
mš
, 
max
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

827 **
¿ndom_·ths
 = 
	`g‘_¿ndom_·ths
(
·ths
, 
n
, 
m
);

828 
i
;

829 
d©a
 
d
 = {0};

830 
d
.
sh®low
 = 0;

832 
d
.
X
.
rows
 = 
n
;

833 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

834 
d
.
X
.
cŞs
 = 
h
*
w
*3;

836 
d
.
y
 = 
	`make_m©rix
(
n
, (
coÜds
+1)*
boxes
);

838 
i
 = 0; i < 
n
; ++i){

839 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
¿ndom_·ths
[
i
], 0, 0);

840 
augm’t_¬gs
 
a
 = 
	`¿ndom_augm’t_¬gs
(
Üig
, 
ªgË
, 
a¥eù
, 
mš
, 
max
, 
w
, 
h
);

841 
image
 
sized
 = 
	`rÙ©e_üİ_image
(
Üig
, 
a
.
¿d
,‡.
sÿË
,‡.
w
,‡.
h
,‡.
dx
,‡.
dy
,‡.
a¥eù
);

843 
æ
 = 
	`¿nd
()%2;

844 if(
æ
è
	`æ_image
(
sized
);

845 
	`¿ndom_di¡Üt_image
(
sized
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

846 
d
.
X
.
v®s
[
i
] = 
sized
.
d©a
;

849 
	`fl_Œuth_mask
(
¿ndom_·ths
[
i
], 
boxes
, 
d
.
y
.
v®s
[i], 
şas£s
, 
Üig
.
w
, orig.
h
, 
a
, 
æ
, 14, 14);

851 
	`ä“_image
(
Üig
);

861 
	`ä“
(
¿ndom_·ths
);

862  
d
;

863 
	}
}

865 
d©a
 
	$lßd_d©a_»giÚ
(
n
, **
·ths
, 
m
, 
w
, 
h
, 
size
, 
şas£s
, 
j™‹r
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

867 **
¿ndom_·ths
 = 
	`g‘_¿ndom_·ths
(
·ths
, 
n
, 
m
);

868 
i
;

869 
d©a
 
d
 = {0};

870 
d
.
sh®low
 = 0;

872 
d
.
X
.
rows
 = 
n
;

873 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

874 
d
.
X
.
cŞs
 = 
h
*
w
*3;

877 
k
 = 
size
*size*(5+
şas£s
);

878 
d
.
y
 = 
	`make_m©rix
(
n
, 
k
);

879 
i
 = 0; i < 
n
; ++i){

880 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
¿ndom_·ths
[
i
], 0, 0);

882 
oh
 = 
Üig
.
h
;

883 
ow
 = 
Üig
.
w
;

885 
dw
 = (
ow
*
j™‹r
);

886 
dh
 = (
oh
*
j™‹r
);

888 
¶eá
 = 
	`¿nd_unifÜm
(-
dw
, dw);

889 
´ight
 = 
	`¿nd_unifÜm
(-
dw
, dw);

890 
±İ
 = 
	`¿nd_unifÜm
(-
dh
, dh);

891 
pbÙ
 = 
	`¿nd_unifÜm
(-
dh
, dh);

893 
swidth
 = 
ow
 - 
¶eá
 - 
´ight
;

894 
sheight
 = 
oh
 - 
±İ
 - 
pbÙ
;

896 
sx
 = ()
swidth
 / 
ow
;

897 
sy
 = ()
sheight
 / 
oh
;

899 
æ
 = 
	`¿nd
()%2;

900 
image
 
üİ³d
 = 
	`üİ_image
(
Üig
, 
¶eá
, 
±İ
, 
swidth
, 
sheight
);

902 
dx
 = (()
¶eá
/
ow
)/
sx
;

903 
dy
 = (()
±İ
 /
oh
)/
sy
;

905 
image
 
sized
 = 
	`»size_image
(
üİ³d
, 
w
, 
h
);

906 if(
æ
è
	`æ_image
(
sized
);

907 
	`¿ndom_di¡Üt_image
(
sized
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

908 
d
.
X
.
v®s
[
i
] = 
sized
.
d©a
;

910 
	`fl_Œuth_»giÚ
(
¿ndom_·ths
[
i
], 
d
.
y
.
v®s
[i], 
şas£s
, 
size
, 
æ
, 
dx
, 
dy
, 1./
sx
, 1./
sy
);

912 
	`ä“_image
(
Üig
);

913 
	`ä“_image
(
üİ³d
);

915 
	`ä“
(
¿ndom_·ths
);

916  
d
;

917 
	}
}

919 
d©a
 
	$lßd_d©a_com·»
(
n
, **
·ths
, 
m
, 
şas£s
, 
w
, 
h
)

921 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 2*
n
, m);

922 
i
,
j
;

923 
d©a
 
d
 = {0};

924 
d
.
sh®low
 = 0;

926 
d
.
X
.
rows
 = 
n
;

927 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

928 
d
.
X
.
cŞs
 = 
h
*
w
*6;

930 
k
 = 2*(
şas£s
);

931 
d
.
y
 = 
	`make_m©rix
(
n
, 
k
);

932 
i
 = 0; i < 
n
; ++i){

933 
image
 
im1
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
*2], 
w
, 
h
);

934 
image
 
im2
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
*2+1], 
w
, 
h
);

936 
d
.
X
.
v®s
[
i
] = 
	`ÿÎoc
(d.X.
cŞs
, ());

937 
	`memıy
(
d
.
X
.
v®s
[
i
], 
im1
.
d©a
, 
h
*
w
*3*());

938 
	`memıy
(
d
.
X
.
v®s
[
i
] + 
h
*
w
*3, 
im2
.
d©a
, h*w*3*());

940 
id
;

941 
iou
;

943 
imÏb–1
[4096];

944 
imÏb–2
[4096];

945 
	`fšd_»¶aû
(
·ths
[
i
*2], "imgs", "Ïb–s", 
imÏb–1
);

946 
	`fšd_»¶aû
(
imÏb–1
, "jpg", "txt", imlabel1);

947 
FILE
 *
å1
 = 
	`fİ’
(
imÏb–1
, "r");

949 
	`fsÿnf
(
å1
, "%d %f", &
id
, &
iou
) == 2){

950 ià(
d
.
y
.
v®s
[
i
][2*
id
] < 
iou
) d.y.vals[i][2*id] = iou;

953 
	`fšd_»¶aû
(
·ths
[
i
*2+1], "imgs", "Ïb–s", 
imÏb–2
);

954 
	`fšd_»¶aû
(
imÏb–2
, "jpg", "txt", imlabel2);

955 
FILE
 *
å2
 = 
	`fİ’
(
imÏb–2
, "r");

957 
	`fsÿnf
(
å2
, "%d %f", &
id
, &
iou
) == 2){

958 ià(
d
.
y
.
v®s
[
i
][2*
id
 + 1] < 
iou
) d.y.vals[i][2*id + 1] = iou;

961 
j
 = 0; j < 
şas£s
; ++j){

962 ià(
d
.
y
.
v®s
[
i
][2*
j
] > .5 && d.y.vals[i][2*j+1] < .5){

963 
d
.
y
.
v®s
[
i
][2*
j
] = 1;

964 
d
.
y
.
v®s
[
i
][2*
j
+1] = 0;

965 } ià(
d
.
y
.
v®s
[
i
][2*
j
] < .5 && d.y.vals[i][2*j+1] > .5){

966 
d
.
y
.
v®s
[
i
][2*
j
] = 0;

967 
d
.
y
.
v®s
[
i
][2*
j
+1] = 1;

969 
d
.
y
.
v®s
[
i
][2*
j
] = 
SECRET_NUM
;

970 
d
.
y
.
v®s
[
i
][2*
j
+1] = 
SECRET_NUM
;

973 
	`fşo£
(
å1
);

974 
	`fşo£
(
å2
);

976 
	`ä“_image
(
im1
);

977 
	`ä“_image
(
im2
);

979 if(
m
è
	`ä“
(
·ths
);

980  
d
;

981 
	}
}

983 
d©a
 
	$lßd_d©a_swag
(**
·ths
, 
n
, 
şas£s
, 
j™‹r
)

985 
šdex
 = 
	`¿nd
()%
n
;

986 *
¿ndom_·th
 = 
·ths
[
šdex
];

988 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
¿ndom_·th
, 0, 0);

989 
h
 = 
Üig
.h;

990 
w
 = 
Üig
.w;

992 
d©a
 
d
 = {0};

993 
d
.
sh®low
 = 0;

994 
d
.
w
 = w;

995 
d
.
h
 = h;

997 
d
.
X
.
rows
 = 1;

998 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

999 
d
.
X
.
cŞs
 = 
h
*
w
*3;

1001 
k
 = (4+
şas£s
)*90;

1002 
d
.
y
 = 
	`make_m©rix
(1, 
k
);

1004 
dw
 = 
w
*
j™‹r
;

1005 
dh
 = 
h
*
j™‹r
;

1007 
¶eá
 = 
	`¿nd_unifÜm
(-
dw
, dw);

1008 
´ight
 = 
	`¿nd_unifÜm
(-
dw
, dw);

1009 
±İ
 = 
	`¿nd_unifÜm
(-
dh
, dh);

1010 
pbÙ
 = 
	`¿nd_unifÜm
(-
dh
, dh);

1012 
swidth
 = 
w
 - 
¶eá
 - 
´ight
;

1013 
sheight
 = 
h
 - 
±İ
 - 
pbÙ
;

1015 
sx
 = ()
swidth
 / 
w
;

1016 
sy
 = ()
sheight
 / 
h
;

1018 
æ
 = 
	`¿nd
()%2;

1019 
image
 
üİ³d
 = 
	`üİ_image
(
Üig
, 
¶eá
, 
±İ
, 
swidth
, 
sheight
);

1021 
dx
 = (()
¶eá
/
w
)/
sx
;

1022 
dy
 = (()
±İ
 /
h
)/
sy
;

1024 
image
 
sized
 = 
	`»size_image
(
üİ³d
, 
w
, 
h
);

1025 if(
æ
è
	`æ_image
(
sized
);

1026 
d
.
X
.
v®s
[0] = 
sized
.
d©a
;

1028 
	`fl_Œuth_swag
(
¿ndom_·th
, 
d
.
y
.
v®s
[0], 
şas£s
, 
æ
, 
dx
, 
dy
, 1./
sx
, 1./
sy
);

1030 
	`ä“_image
(
Üig
);

1031 
	`ä“_image
(
üİ³d
);

1033  
d
;

1034 
	}
}

1036 
d©a
 
	$lßd_d©a_d‘eùiÚ
(
n
, **
·ths
, 
m
, 
w
, 
h
, 
boxes
, 
şas£s
, 
j™‹r
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

1038 **
¿ndom_·ths
 = 
	`g‘_¿ndom_·ths
(
·ths
, 
n
, 
m
);

1039 
i
;

1040 
d©a
 
d
 = {0};

1041 
d
.
sh®low
 = 0;

1043 
d
.
X
.
rows
 = 
n
;

1044 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

1045 
d
.
X
.
cŞs
 = 
h
*
w
*3;

1047 
d
.
y
 = 
	`make_m©rix
(
n
, 5*
boxes
);

1048 
i
 = 0; i < 
n
; ++i){

1049 
image
 
Üig
 = 
	`lßd_image_cŞÜ
(
¿ndom_·ths
[
i
], 0, 0);

1050 
image
 
sized
 = 
	`make_image
(
w
, 
h
, 
Üig
.
c
);

1051 
	`fl_image
(
sized
, .5);

1053 
dw
 = 
j™‹r
 * 
Üig
.
w
;

1054 
dh
 = 
j™‹r
 * 
Üig
.
h
;

1056 
Ãw_¬
 = (
Üig
.
w
 + 
	`¿nd_unifÜm
(-
dw
, dw)è/ (Üig.
h
 +„ªd_unifÜm(-
dh
, dh));

1058 
sÿË
 = 1;

1060 
nw
, 
nh
;

1062 if(
Ãw_¬
 < 1){

1063 
nh
 = 
sÿË
 * 
h
;

1064 
nw
 = 
nh
 * 
Ãw_¬
;

1066 
nw
 = 
sÿË
 * 
w
;

1067 
nh
 = 
nw
 / 
Ãw_¬
;

1070 
dx
 = 
	`¿nd_unifÜm
(0, 
w
 - 
nw
);

1071 
dy
 = 
	`¿nd_unifÜm
(0, 
h
 - 
nh
);

1073 
	`¶aû_image
(
Üig
, 
nw
, 
nh
, 
dx
, 
dy
, 
sized
);

1075 
	`¿ndom_di¡Üt_image
(
sized
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

1077 
æ
 = 
	`¿nd
()%2;

1078 if(
æ
è
	`æ_image
(
sized
);

1079 
d
.
X
.
v®s
[
i
] = 
sized
.
d©a
;

1082 
	`fl_Œuth_d‘eùiÚ
(
¿ndom_·ths
[
i
], 
boxes
, 
d
.
y
.
v®s
[i], 
şas£s
, 
æ
, -
dx
/
w
, -
dy
/
h
, 
nw
/w, 
nh
/h);

1084 
	`ä“_image
(
Üig
);

1086 
	`ä“
(
¿ndom_·ths
);

1087  
d
;

1088 
	}
}

1090 *
	$lßd_th»ad
(*
±r
)

1093 
lßd_¬gs
 
a
 = *(lßd_¬gs*)
±r
;

1094 if(
a
.
exposu»
 == 0)‡.exposure = 1;

1095 if(
a
.
§tu¿tiÚ
 == 0)‡.saturation = 1;

1096 if(
a
.
a¥eù
 == 0)‡.aspect = 1;

1098 ià(
a
.
ty³
 =ğ
OLD_CLASSIFICATION_DATA
){

1099 *
a
.
d
 = 
	`lßd_d©a_Şd
×.
·ths
,‡.
n
,‡.
m
,‡.
Ïb–s
,‡.
şas£s
,‡.
w
,‡.
h
);

1100 } ià(
a
.
ty³
 =ğ
REGRESSION_DATA
){

1101 *
a
.
d
 = 
	`lßd_d©a_»g»ssiÚ
×.
·ths
,‡.
n
,‡.
m
,‡.
şas£s
,‡.
mš
,‡.
max
,‡.
size
,‡.
ªgË
,‡.
a¥eù
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
);

1102 } ià(
a
.
ty³
 =ğ
CLASSIFICATION_DATA
){

1103 *
a
.
d
 = 
	`lßd_d©a_augm’t
×.
·ths
,‡.
n
,‡.
m
,‡.
Ïb–s
,‡.
şas£s
,‡.
h›¿rchy
,‡.
mš
,‡.
max
,‡.
size
,‡.
ªgË
,‡.
a¥eù
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
,‡.
ûÁ”
);

1104 } ià(
a
.
ty³
 =ğ
SUPER_DATA
){

1105 *
a
.
d
 = 
	`lßd_d©a_su³r
×.
·ths
,‡.
n
,‡.
m
,‡.
w
,‡.
h
,‡.
sÿË
);

1106 } ià(
a
.
ty³
 =ğ
WRITING_DATA
){

1107 *
a
.
d
 = 
	`lßd_d©a_wr™šg
×.
·ths
,‡.
n
,‡.
m
,‡.
w
,‡.
h
,‡.
out_w
,‡.
out_h
);

1108 } ià(
a
.
ty³
 =ğ
ISEG_DATA
){

1109 *
a
.
d
 = 
	`lßd_d©a_i£g
×.
n
,‡.
·ths
,‡.
m
,‡.
w
,‡.
h
,‡.
şas£s
,‡.
num_boxes
,‡.
sÿË
,‡.
mš
,‡.
max
,‡.
ªgË
,‡.
a¥eù
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
);

1110 } ià(
a
.
ty³
 =ğ
INSTANCE_DATA
){

1111 *
a
.
d
 = 
	`lßd_d©a_mask
×.
n
,‡.
·ths
,‡.
m
,‡.
w
,‡.
h
,‡.
şas£s
,‡.
num_boxes
,‡.
coÜds
,‡.
mš
,‡.
max
,‡.
ªgË
,‡.
a¥eù
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
);

1112 } ià(
a
.
ty³
 =ğ
SEGMENTATION_DATA
){

1113 *
a
.
d
 = 
	`lßd_d©a_£g
×.
n
,‡.
·ths
,‡.
m
,‡.
w
,‡.
h
,‡.
şas£s
,‡.
mš
,‡.
max
,‡.
ªgË
,‡.
a¥eù
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
,‡.
sÿË
);

1114 } ià(
a
.
ty³
 =ğ
REGION_DATA
){

1115 *
a
.
d
 = 
	`lßd_d©a_»giÚ
×.
n
,‡.
·ths
,‡.
m
,‡.
w
,‡.
h
,‡.
num_boxes
,‡.
şas£s
,‡.
j™‹r
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
);

1116 } ià(
a
.
ty³
 =ğ
DETECTION_DATA
){

1117 *
a
.
d
 = 
	`lßd_d©a_d‘eùiÚ
×.
n
,‡.
·ths
,‡.
m
,‡.
w
,‡.
h
,‡.
num_boxes
,‡.
şas£s
,‡.
j™‹r
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
);

1118 } ià(
a
.
ty³
 =ğ
SWAG_DATA
){

1119 *
a
.
d
 = 
	`lßd_d©a_swag
×.
·ths
,‡.
n
,‡.
şas£s
,‡.
j™‹r
);

1120 } ià(
a
.
ty³
 =ğ
COMPARE_DATA
){

1121 *
a
.
d
 = 
	`lßd_d©a_com·»
×.
n
,‡.
·ths
,‡.
m
,‡.
şas£s
,‡.
w
,‡.
h
);

1122 } ià(
a
.
ty³
 =ğ
IMAGE_DATA
){

1123 *(
a
.
im
èğ
	`lßd_image_cŞÜ
×.
·th
, 0, 0);

1124 *(
a
.
»sized
èğ
	`»size_image
(*×.
im
),‡.
w
,‡.
h
);

1125 } ià(
a
.
ty³
 =ğ
LETTERBOX_DATA
){

1126 *(
a
.
im
èğ
	`lßd_image_cŞÜ
×.
·th
, 0, 0);

1127 *(
a
.
»sized
èğ
	`Ë‰”box_image
(*×.
im
),‡.
w
,‡.
h
);

1128 } ià(
a
.
ty³
 =ğ
TAG_DATA
){

1129 *
a
.
d
 = 
	`lßd_d©a_g
×.
·ths
,‡.
n
,‡.
m
,‡.
şas£s
,‡.
mš
,‡.
max
,‡.
size
,‡.
ªgË
,‡.
a¥eù
,‡.
hue
,‡.
§tu¿tiÚ
,‡.
exposu»
);

1131 
	`ä“
(
±r
);

1133 
	}
}

1135 
±h»ad_t
 
	$lßd_d©a_š_th»ad
(
lßd_¬gs
 
¬gs
)

1137 
±h»ad_t
 
th»ad
;

1138 
lßd_¬gs
 *
±r
 = 
	`ÿÎoc
(1, (load_args));

1139 *
±r
 = 
¬gs
;

1140 if(
	`±h»ad_ü—‹
(&
th»ad
, 0, 
lßd_th»ad
, 
±r
)è
	`”rÜ
("Thread creation failed");

1141  
th»ad
;

1142 
	}
}

1144 *
	$lßd_th»ads
(*
±r
)

1146 
i
;

1147 
lßd_¬gs
 
¬gs
 = *Ößd_¬g *)
±r
;

1148 ià(
¬gs
.
th»ads
 == 0)‡rgs.threads = 1;

1149 
d©a
 *
out
 = 
¬gs
.
d
;

1150 
tÙ®
 = 
¬gs
.
n
;

1151 
	`ä“
(
±r
);

1152 
d©a
 *
bufãrs
 = 
	`ÿÎoc
(
¬gs
.
th»ads
, (data));

1153 
±h»ad_t
 *
th»ads
 = 
	`ÿÎoc
(
¬gs
.threads, (pthread_t));

1154 
i
 = 0; i < 
¬gs
.
th»ads
; ++i){

1155 
¬gs
.
d
 = 
bufãrs
 + 
i
;

1156 
¬gs
.
n
 = (
i
+1è* 
tÙ®
/¬gs.
th»ads
 - i *otal/args.threads;

1157 
th»ads
[
i
] = 
	`lßd_d©a_š_th»ad
(
¬gs
);

1159 
i
 = 0; i < 
¬gs
.
th»ads
; ++i){

1160 
	`±h»ad_još
(
th»ads
[
i
], 0);

1162 *
out
 = 
	`cÚÿt_d©as
(
bufãrs
, 
¬gs
.
th»ads
);

1163 
out
->
sh®low
 = 0;

1164 
i
 = 0; i < 
¬gs
.
th»ads
; ++i){

1165 
bufãrs
[
i
].
sh®low
 = 1;

1166 
	`ä“_d©a
(
bufãrs
[
i
]);

1168 
	`ä“
(
bufãrs
);

1169 
	`ä“
(
th»ads
);

1171 
	}
}

1173 
	$lßd_d©a_blockšg
(
lßd_¬gs
 
¬gs
)

1175 
lßd_¬gs
 *
±r
 = 
	`ÿÎoc
(1, (load_args));

1176 *
±r
 = 
¬gs
;

1177 
	`lßd_th»ad
(
±r
);

1178 
	}
}

1180 
±h»ad_t
 
	$lßd_d©a
(
lßd_¬gs
 
¬gs
)

1182 
±h»ad_t
 
th»ad
;

1183 
lßd_¬gs
 *
±r
 = 
	`ÿÎoc
(1, (load_args));

1184 *
±r
 = 
¬gs
;

1185 if(
	`±h»ad_ü—‹
(&
th»ad
, 0, 
lßd_th»ads
, 
±r
)è
	`”rÜ
("Thread creation failed");

1186  
th»ad
;

1187 
	}
}

1189 
d©a
 
	$lßd_d©a_wr™šg
(**
·ths
, 
n
, 
m
, 
w
, 
h
, 
out_w
, 
out_h
)

1191 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

1192 **
»¶aû_·ths
 = 
	`fšd_»¶aû_·ths
(
·ths
, 
n
, ".png", "-label.png");

1193 
d©a
 
d
 = {0};

1194 
d
.
sh®low
 = 0;

1195 
d
.
X
 = 
	`lßd_image_·ths
(
·ths
, 
n
, 
w
, 
h
);

1196 
d
.
y
 = 
	`lßd_image_·ths_g¿y
(
»¶aû_·ths
, 
n
, 
out_w
, 
out_h
);

1197 if(
m
è
	`ä“
(
·ths
);

1198 
i
;

1199 
i
 = 0; i < 
n
; ++iè
	`ä“
(
»¶aû_·ths
[i]);

1200 
	`ä“
(
»¶aû_·ths
);

1201  
d
;

1202 
	}
}

1204 
d©a
 
	$lßd_d©a_Şd
(**
·ths
, 
n
, 
m
, **
Ïb–s
, 
k
, 
w
, 
h
)

1206 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

1207 
d©a
 
d
 = {0};

1208 
d
.
sh®low
 = 0;

1209 
d
.
X
 = 
	`lßd_image_·ths
(
·ths
, 
n
, 
w
, 
h
);

1210 
d
.
y
 = 
	`lßd_Ïb–s_·ths
(
·ths
, 
n
, 
Ïb–s
, 
k
, 0);

1211 if(
m
è
	`ä“
(
·ths
);

1212  
d
;

1213 
	}
}

1229 
d©a
 
	$lßd_d©a_su³r
(**
·ths
, 
n
, 
m
, 
w
, 
h
, 
sÿË
)

1231 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

1232 
d©a
 
d
 = {0};

1233 
d
.
sh®low
 = 0;

1235 
i
;

1236 
d
.
X
.
rows
 = 
n
;

1237 
d
.
X
.
v®s
 = 
	`ÿÎoc
(
n
, (*));

1238 
d
.
X
.
cŞs
 = 
w
*
h
*3;

1240 
d
.
y
.
rows
 = 
n
;

1241 
d
.
y
.
v®s
 = 
	`ÿÎoc
(
n
, (*));

1242 
d
.
y
.
cŞs
 = 
w
*
sÿË
 * 
h
*scale * 3;

1244 
i
 = 0; i < 
n
; ++i){

1245 
image
 
im
 = 
	`lßd_image_cŞÜ
(
·ths
[
i
], 0, 0);

1246 
image
 
üİ
 = 
	`¿ndom_üİ_image
(
im
, 
w
*
sÿË
, 
h
*scale);

1247 
æ
 = 
	`¿nd
()%2;

1248 ià(
æ
è
	`æ_image
(
üİ
);

1249 
image
 
»size
 = 
	`»size_image
(
üİ
, 
w
, 
h
);

1250 
d
.
X
.
v®s
[
i
] = 
»size
.
d©a
;

1251 
d
.
y
.
v®s
[
i
] = 
üİ
.
d©a
;

1252 
	`ä“_image
(
im
);

1255 if(
m
è
	`ä“
(
·ths
);

1256  
d
;

1257 
	}
}

1259 
d©a
 
	$lßd_d©a_»g»ssiÚ
(**
·ths
, 
n
, 
m
, 
k
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

1261 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

1262 
d©a
 
d
 = {0};

1263 
d
.
sh®low
 = 0;

1264 
d
.
X
 = 
	`lßd_image_augm’t_·ths
(
·ths
, 
n
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 0);

1265 
d
.
y
 = 
	`lßd_»g»ssiÚ_Ïb–s_·ths
(
·ths
, 
n
, 
k
);

1266 if(
m
è
	`ä“
(
·ths
);

1267  
d
;

1268 
	}
}

1270 
d©a
 
	$£Ëù_d©a
(
d©a
 *
Üig
, *
šds
)

1272 
d©a
 
d
 = {0};

1273 
d
.
sh®low
 = 1;

1274 
d
.
w
 = 
Üig
[0].w;

1275 
d
.
h
 = 
Üig
[0].h;

1277 
d
.
X
.
rows
 = 
Üig
[0].X.rows;

1278 
d
.
y
.
rows
 = 
Üig
[0].
X
.rows;

1280 
d
.
X
.
cŞs
 = 
Üig
[0].X.cols;

1281 
d
.
y
.
cŞs
 = 
Üig
[0].y.cols;

1283 
d
.
X
.
v®s
 = 
	`ÿÎoc
(
Üig
[0].X.
rows
, (*));

1284 
d
.
y
.
v®s
 = 
	`ÿÎoc
(
Üig
[0].y.
rows
, (*));

1285 
i
;

1286 
i
 = 0; i < 
d
.
X
.
rows
; ++i){

1287 
d
.
X
.
v®s
[
i
] = 
Üig
[
šds
[i]].X.vals[i];

1288 
d
.
y
.
v®s
[
i
] = 
Üig
[
šds
[i]].y.vals[i];

1290  
d
;

1291 
	}
}

1293 
d©a
 *
	$te_d©a
(
d©a
 
Üig
, 
divs
, 
size
)

1295 
d©a
 *
ds
 = 
	`ÿÎoc
(
divs
*divs, (data));

1296 
i
, 
j
;

1297 #´agm¨
omp
 
·¿Î–
 

1298 
i
 = 0; i < 
divs
*divs; ++i){

1299 
d©a
 
d
;

1300 
d
.
sh®low
 = 0;

1301 
d
.
w
 = 
Üig
.w/
divs
 * 
size
;

1302 
d
.
h
 = 
Üig
.h/
divs
 * 
size
;

1303 
d
.
X
.
rows
 = 
Üig
.X.rows;

1304 
d
.
X
.
cŞs
 = d.
w
*d.
h
*3;

1305 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

1307 
d
.
y
 = 
	`cİy_m©rix
(
Üig
.y);

1308 #´agm¨
omp
 
·¿Î–
 

1309 
j
 = 0; j < 
Üig
.
X
.
rows
; ++j){

1310 
x
 = (
i
%
divs
è* 
Üig
.
w
 / div - (
d
.w - orig.w/divs)/2;

1311 
y
 = (
i
/
divs
è* 
Üig
.
h
 / div - (
d
.h - orig.h/divs)/2;

1312 
image
 
im
 = 
	`æßt_to_image
(
Üig
.
w
, orig.
h
, 3, orig.
X
.
v®s
[
j
]);

1313 
d
.
X
.
v®s
[
j
] = 
	`üİ_image
(
im
, 
x
, 
y
, d.
w
, d.
h
).
d©a
;

1315 
ds
[
i
] = 
d
;

1317  
ds
;

1318 
	}
}

1320 
d©a
 
	$»size_d©a
(
d©a
 
Üig
, 
w
, 
h
)

1322 
d©a
 
d
 = {0};

1323 
d
.
sh®low
 = 0;

1324 
d
.
w
 = w;

1325 
d
.
h
 = h;

1326 
i
;

1327 
d
.
X
.
rows
 = 
Üig
.X.rows;

1328 
d
.
X
.
cŞs
 = 
w
*
h
*3;

1329 
d
.
X
.
v®s
 = 
	`ÿÎoc
(d.X.
rows
, (*));

1331 
d
.
y
 = 
	`cİy_m©rix
(
Üig
.y);

1332 #´agm¨
omp
 
·¿Î–
 

1333 
i
 = 0; i < 
Üig
.
X
.
rows
; ++i){

1334 
image
 
im
 = 
	`æßt_to_image
(
Üig
.
w
, orig.
h
, 3, orig.
X
.
v®s
[
i
]);

1335 
d
.
X
.
v®s
[
i
] = 
	`»size_image
(
im
, 
w
, 
h
).
d©a
;

1337  
d
;

1338 
	}
}

1340 
d©a
 
	$lßd_d©a_augm’t
(**
·ths
, 
n
, 
m
, **
Ïb–s
, 
k
, 
Œ“
 *
h›¿rchy
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 
ûÁ”
)

1342 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

1343 
d©a
 
d
 = {0};

1344 
d
.
sh®low
 = 0;

1345 
d
.
w
=
size
;

1346 
d
.
h
=
size
;

1347 
d
.
X
 = 
	`lßd_image_augm’t_·ths
(
·ths
, 
n
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 
ûÁ”
);

1348 
d
.
y
 = 
	`lßd_Ïb–s_·ths
(
·ths
, 
n
, 
Ïb–s
, 
k
, 
h›¿rchy
);

1349 if(
m
è
	`ä“
(
·ths
);

1350  
d
;

1351 
	}
}

1353 
d©a
 
	$lßd_d©a_g
(**
·ths
, 
n
, 
m
, 
k
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

1355 if(
m
è
·ths
 = 
	`g‘_¿ndom_·ths
Õ©hs, 
n
, m);

1356 
d©a
 
d
 = {0};

1357 
d
.
w
 = 
size
;

1358 
d
.
h
 = 
size
;

1359 
d
.
sh®low
 = 0;

1360 
d
.
X
 = 
	`lßd_image_augm’t_·ths
(
·ths
, 
n
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 0);

1361 
d
.
y
 = 
	`lßd_gs_·ths
(
·ths
, 
n
, 
k
);

1362 if(
m
è
	`ä“
(
·ths
);

1363  
d
;

1364 
	}
}

1366 
m©rix
 
	$cÚÿt_m©rix
(
m©rix
 
m1
, m©rix 
m2
)

1368 
i
, 
couÁ
 = 0;

1369 
m©rix
 
m
;

1370 
m
.
cŞs
 = 
m1
.cols;

1371 
m
.
rows
 = 
m1
.rows+
m2
.rows;

1372 
m
.
v®s
 = 
	`ÿÎoc
(
m1
.
rows
 + 
m2
.rows, (*));

1373 
i
 = 0; i < 
m1
.
rows
; ++i){

1374 
m
.
v®s
[
couÁ
++] = 
m1
.v®s[
i
];

1376 
i
 = 0; i < 
m2
.
rows
; ++i){

1377 
m
.
v®s
[
couÁ
++] = 
m2
.v®s[
i
];

1379  
m
;

1380 
	}
}

1382 
d©a
 
	$cÚÿt_d©a
(
d©a
 
d1
, d©¨
d2
)

1384 
d©a
 
d
 = {0};

1385 
d
.
sh®low
 = 1;

1386 
d
.
X
 = 
	`cÚÿt_m©rix
(
d1
.X, 
d2
.X);

1387 
d
.
y
 = 
	`cÚÿt_m©rix
(
d1
.y, 
d2
.y);

1388 
d
.
w
 = 
d1
.w;

1389 
d
.
h
 = 
d1
.h;

1390  
d
;

1391 
	}
}

1393 
d©a
 
	$cÚÿt_d©as
(
d©a
 *
d
, 
n
)

1395 
i
;

1396 
d©a
 
out
 = {0};

1397 
i
 = 0; i < 
n
; ++i){

1398 
d©a
 
Ãw
 = 
	`cÚÿt_d©a
(
d
[
i
], 
out
);

1399 
	`ä“_d©a
(
out
);

1400 
out
 = 
Ãw
;

1402  
out
;

1403 
	}
}

1405 
d©a
 
	$lßd_ÿ‹gÜiÿl_d©a_csv
(*
f’ame
, 
rg‘
, 
k
)

1407 
d©a
 
d
 = {0};

1408 
d
.
sh®low
 = 0;

1409 
m©rix
 
X
 = 
	`csv_to_m©rix
(
f’ame
);

1410 *
Œuth_1d
 = 
	`pİ_cŞumn
(&
X
, 
rg‘
);

1411 **
Œuth
 = 
	`Úe_hÙ_’code
(
Œuth_1d
, 
X
.
rows
, 
k
);

1412 
m©rix
 
y
;

1413 
y
.
rows
 = 
X
.rows;

1414 
y
.
cŞs
 = 
k
;

1415 
y
.
v®s
 = 
Œuth
;

1416 
d
.
X
 = X;

1417 
d
.
y
 = y;

1418 
	`ä“
(
Œuth_1d
);

1419  
d
;

1420 
	}
}

1422 
d©a
 
	$lßd_ciçr10_d©a
(*
f’ame
)

1424 
d©a
 
d
 = {0};

1425 
d
.
sh®low
 = 0;

1426 
i
,
j
;

1427 
m©rix
 
X
 = 
	`make_m©rix
(10000, 3072);

1428 
m©rix
 
y
 = 
	`make_m©rix
(10000, 10);

1429 
d
.
X
 = X;

1430 
d
.
y
 = y;

1432 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "rb");

1433 if(!
å
è
	`fe_”rÜ
(
f’ame
);

1434 
i
 = 0; i < 10000; ++i){

1435 
by‹s
[3073];

1436 
	`ä—d
(
by‹s
, 1, 3073, 
å
);

1437 
şass
 = 
by‹s
[0];

1438 
y
.
v®s
[
i
][
şass
] = 1;

1439 
j
 = 0; j < 
X
.
cŞs
; ++j){

1440 
X
.
v®s
[
i
][
j
] = ()
by‹s
[j+1];

1443 
	`sÿË_d©a_rows
(
d
, 1./255);

1445 
	`fşo£
(
å
);

1446  
d
;

1447 
	}
}

1449 
	$g‘_¿ndom_b©ch
(
d©a
 
d
, 
n
, *
X
, *
y
)

1451 
j
;

1452 
j
 = 0; j < 
n
; ++j){

1453 
šdex
 = 
	`¿nd
()%
d
.
X
.
rows
;

1454 
	`memıy
(
X
+
j
*
d
.X.
cŞs
, d.X.
v®s
[
šdex
], d.X.cols*());

1455 
	`memıy
(
y
+
j
*
d
.y.
cŞs
, d.y.
v®s
[
šdex
], d.y.cols*());

1457 
	}
}

1459 
	$g‘_Ãxt_b©ch
(
d©a
 
d
, 
n
, 
off£t
, *
X
, *
y
)

1461 
j
;

1462 
j
 = 0; j < 
n
; ++j){

1463 
šdex
 = 
off£t
 + 
j
;

1464 
	`memıy
(
X
+
j
*
d
.X.
cŞs
, d.X.
v®s
[
šdex
], d.X.cols*());

1465 if(
y
è
	`memıy
(y+
j
*
d
.y.
cŞs
, d.y.
v®s
[
šdex
], d.y.cols*());

1467 
	}
}

1469 
	$smoÙh_d©a
(
d©a
 
d
)

1471 
i
, 
j
;

1472 
sÿË
 = 1. / 
d
.
y
.
cŞs
;

1473 
•s
 = .1;

1474 
i
 = 0; i < 
d
.
y
.
rows
; ++i){

1475 
j
 = 0; j < 
d
.
y
.
cŞs
; ++j){

1476 
d
.
y
.
v®s
[
i
][
j
] = 
•s
 * 
sÿË
 + (1-eps) * d.y.vals[i][j];

1479 
	}
}

1481 
d©a
 
	$lßd_®l_ciçr10
()

1483 
d©a
 
d
 = {0};

1484 
d
.
sh®low
 = 0;

1485 
i
,
j
,
b
;

1486 
m©rix
 
X
 = 
	`make_m©rix
(50000, 3072);

1487 
m©rix
 
y
 = 
	`make_m©rix
(50000, 10);

1488 
d
.
X
 = X;

1489 
d
.
y
 = y;

1492 
b
 = 0; b < 5; ++b){

1493 
buff
[256];

1494 
	`¥rštf
(
buff
, "d©a/ciçr/ciçr-10-b©ches-bš/d©a_b©ch_%d.bš", 
b
+1);

1495 
FILE
 *
å
 = 
	`fİ’
(
buff
, "rb");

1496 if(!
å
è
	`fe_”rÜ
(
buff
);

1497 
i
 = 0; i < 10000; ++i){

1498 
by‹s
[3073];

1499 
	`ä—d
(
by‹s
, 1, 3073, 
å
);

1500 
şass
 = 
by‹s
[0];

1501 
y
.
v®s
[
i
+
b
*10000][
şass
] = 1;

1502 
j
 = 0; j < 
X
.
cŞs
; ++j){

1503 
X
.
v®s
[
i
+
b
*10000][
j
] = ()
by‹s
[j+1];

1506 
	`fşo£
(
å
);

1509 
	`sÿË_d©a_rows
(
d
, 1./255);

1510 
	`smoÙh_d©a
(
d
);

1511  
d
;

1512 
	}
}

1514 
d©a
 
	$lßd_go
(*
f’ame
)

1516 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "rb");

1517 
m©rix
 
X
 = 
	`make_m©rix
(3363059, 361);

1518 
m©rix
 
y
 = 
	`make_m©rix
(3363059, 361);

1519 
row
, 
cŞ
;

1521 if(!
å
è
	`fe_”rÜ
(
f’ame
);

1522 *
Ïb–
;

1523 
couÁ
 = 0;

1524 (
Ïb–
 = 
	`fg‘l
(
å
))){

1525 
i
;

1526 if(
couÁ
 =ğ
X
.
rows
){

1527 
X
 = 
	`»size_m©rix
(X, 
couÁ
*2);

1528 
y
 = 
	`»size_m©rix
(y, 
couÁ
*2);

1530 
	`ssÿnf
(
Ïb–
, "%d %d", &
row
, &
cŞ
);

1531 *
bßrd
 = 
	`fg‘l
(
å
);

1533 
šdex
 = 
row
*19 + 
cŞ
;

1534 
y
.
v®s
[
couÁ
][
šdex
] = 1;

1536 
i
 = 0; i < 19*19; ++i){

1537 
v®
 = 0;

1538 if(
bßrd
[
i
] =ğ'1'è
v®
 = 1;

1539 if(
bßrd
[
i
] =ğ'2'è
v®
 = -1;

1540 
X
.
v®s
[
couÁ
][
i
] = 
v®
;

1542 ++
couÁ
;

1543 
	`ä“
(
Ïb–
);

1544 
	`ä“
(
bßrd
);

1546 
X
 = 
	`»size_m©rix
(X, 
couÁ
);

1547 
y
 = 
	`»size_m©rix
(y, 
couÁ
);

1549 
d©a
 
d
 = {0};

1550 
d
.
sh®low
 = 0;

1551 
d
.
X
 = X;

1552 
d
.
y
 = y;

1555 
	`fşo£
(
å
);

1557  
d
;

1558 
	}
}

1561 
	$¿ndomize_d©a
(
d©a
 
d
)

1563 
i
;

1564 
i
 = 
d
.
X
.
rows
-1; i > 0; --i){

1565 
šdex
 = 
	`¿nd
()%
i
;

1566 *
sw­
 = 
d
.
X
.
v®s
[
šdex
];

1567 
d
.
X
.
v®s
[
šdex
] = d.X.v®s[
i
];

1568 
d
.
X
.
v®s
[
i
] = 
sw­
;

1570 
sw­
 = 
d
.
y
.
v®s
[
šdex
];

1571 
d
.
y
.
v®s
[
šdex
] = d.y.v®s[
i
];

1572 
d
.
y
.
v®s
[
i
] = 
sw­
;

1574 
	}
}

1576 
	$sÿË_d©a_rows
(
d©a
 
d
, 
s
)

1578 
i
;

1579 
i
 = 0; i < 
d
.
X
.
rows
; ++i){

1580 
	`sÿË_¬¿y
(
d
.
X
.
v®s
[
i
], d.X.
cŞs
, 
s
);

1582 
	}
}

1584 
	$Œª¦©e_d©a_rows
(
d©a
 
d
, 
s
)

1586 
i
;

1587 
i
 = 0; i < 
d
.
X
.
rows
; ++i){

1588 
	`Œª¦©e_¬¿y
(
d
.
X
.
v®s
[
i
], d.X.
cŞs
, 
s
);

1590 
	}
}

1592 
d©a
 
	$cİy_d©a
(
d©a
 
d
)

1594 
d©a
 
c
 = {0};

1595 
c
.
w
 = 
d
.w;

1596 
c
.
h
 = 
d
.h;

1597 
c
.
sh®low
 = 0;

1598 
c
.
num_boxes
 = 
d
.num_boxes;

1599 
c
.
boxes
 = 
d
.boxes;

1600 
c
.
X
 = 
	`cİy_m©rix
(
d
.X);

1601 
c
.
y
 = 
	`cİy_m©rix
(
d
.y);

1602  
c
;

1603 
	}
}

1605 
	$nÜm®ize_d©a_rows
(
d©a
 
d
)

1607 
i
;

1608 
i
 = 0; i < 
d
.
X
.
rows
; ++i){

1609 
	`nÜm®ize_¬¿y
(
d
.
X
.
v®s
[
i
], d.X.
cŞs
);

1611 
	}
}

1613 
d©a
 
	$g‘_d©a_·¹
(
d©a
 
d
, 
·¹
, 
tÙ®
)

1615 
d©a
 
p
 = {0};

1616 
p
.
sh®low
 = 1;

1617 
p
.
X
.
rows
 = 
d
.X.row * (
·¹
 + 1è/ 
tÙ®
 - d.X.rows *…art /otal;

1618 
p
.
y
.
rows
 = 
d
.y.row * (
·¹
 + 1è/ 
tÙ®
 - d.y.rows *…art /otal;

1619 
p
.
X
.
cŞs
 = 
d
.X.cols;

1620 
p
.
y
.
cŞs
 = 
d
.y.cols;

1621 
p
.
X
.
v®s
 = 
d
.X.v® + d.X.
rows
 * 
·¹
 / 
tÙ®
;

1622 
p
.
y
.
v®s
 = 
d
.y.v® + d.y.
rows
 * 
·¹
 / 
tÙ®
;

1623  
p
;

1624 
	}
}

1626 
d©a
 
	$g‘_¿ndom_d©a
(
d©a
 
d
, 
num
)

1628 
d©a
 
r
 = {0};

1629 
r
.
sh®low
 = 1;

1631 
r
.
X
.
rows
 = 
num
;

1632 
r
.
y
.
rows
 = 
num
;

1634 
r
.
X
.
cŞs
 = 
d
.X.cols;

1635 
r
.
y
.
cŞs
 = 
d
.y.cols;

1637 
r
.
X
.
v®s
 = 
	`ÿÎoc
(
num
, (*));

1638 
r
.
y
.
v®s
 = 
	`ÿÎoc
(
num
, (*));

1640 
i
;

1641 
i
 = 0; i < 
num
; ++i){

1642 
šdex
 = 
	`¿nd
()%
d
.
X
.
rows
;

1643 
r
.
X
.
v®s
[
i
] = 
d
.X.v®s[
šdex
];

1644 
r
.
y
.
v®s
[
i
] = 
d
.y.v®s[
šdex
];

1646  
r
;

1647 
	}
}

1649 
d©a
 *
	$¥l™_d©a
(
d©a
 
d
, 
·¹
, 
tÙ®
)

1651 
d©a
 *
¥l™
 = 
	`ÿÎoc
(2, (data));

1652 
i
;

1653 
¡¬t
 = 
·¹
*
d
.
X
.
rows
/
tÙ®
;

1654 
’d
 = (
·¹
+1)*
d
.
X
.
rows
/
tÙ®
;

1655 
d©a
 
Œaš
;

1656 
d©a
 
‹¡
;

1657 
Œaš
.
sh®low
 = 
‹¡
.shallow = 1;

1659 
‹¡
.
X
.
rows
 =e¡.
y
.row ğ
’d
-
¡¬t
;

1660 
Œaš
.
X
.
rows
 =¿š.
y
.row ğ
d
.X.row - (
’d
-
¡¬t
);

1661 
Œaš
.
X
.
cŞs
 = 
‹¡
.X.cŞ ğ
d
.X.cols;

1662 
Œaš
.
y
.
cŞs
 = 
‹¡
.y.cŞ ğ
d
.y.cols;

1664 
Œaš
.
X
.
v®s
 = 
	`ÿÎoc
Ñ¿š.X.
rows
, (*));

1665 
‹¡
.
X
.
v®s
 = 
	`ÿÎoc
Ñe¡.X.
rows
, (*));

1666 
Œaš
.
y
.
v®s
 = 
	`ÿÎoc
Ñ¿š.y.
rows
, (*));

1667 
‹¡
.
y
.
v®s
 = 
	`ÿÎoc
Ñe¡.y.
rows
, (*));

1669 
i
 = 0; i < 
¡¬t
; ++i){

1670 
Œaš
.
X
.
v®s
[
i
] = 
d
.X.vals[i];

1671 
Œaš
.
y
.
v®s
[
i
] = 
d
.y.vals[i];

1673 
i
 = 
¡¬t
; i < 
’d
; ++i){

1674 
‹¡
.
X
.
v®s
[
i
-
¡¬t
] = 
d
.X.vals[i];

1675 
‹¡
.
y
.
v®s
[
i
-
¡¬t
] = 
d
.y.vals[i];

1677 
i
 = 
’d
; i < 
d
.
X
.
rows
; ++i){

1678 
Œaš
.
X
.
v®s
[
i
-(
’d
-
¡¬t
)] = 
d
.X.vals[i];

1679 
Œaš
.
y
.
v®s
[
i
-(
’d
-
¡¬t
)] = 
d
.y.vals[i];

1681 
¥l™
[0] = 
Œaš
;

1682 
¥l™
[1] = 
‹¡
;

1683  
¥l™
;

1684 
	}
}

	@host/src/data.h

1 #iâdeà
DATA_H


2 
	#DATA_H


	)

3 
	~<±h»ad.h
>

5 
	~"d¬kÃt.h
"

6 
	~"m©rix.h
"

7 
	~"li¡.h
"

8 
	~"image.h
"

9 
	~"Œ“.h
"

11 
šlše
 
	$di¡ªû_äom_edge
(
x
, 
max
)

13 
dx
 = (
max
/2è- 
x
;

14 ià(
dx
 < 0) dx = -dx;

15 
dx
 = (
max
/2) + 1 - dx;

16 
dx
 *= 2;

17 
di¡
 = ()
dx
/
max
;

18 ià(
di¡
 > 1) dist = 1;

19  
di¡
;

20 
	}
}

21 
lßd_d©a_blockšg
(
lßd_¬gs
 
¬gs
);

24 
´št_Ë‰”s
(*
´ed
, 
n
);

25 
d©a
 
lßd_d©a_ÿ±cha
(**
·ths
, 
n
, 
m
, 
k
, 
w
, 
h
);

26 
d©a
 
lßd_d©a_ÿ±cha_’code
(**
·ths
, 
n
, 
m
, 
w
, 
h
);

27 
d©a
 
lßd_d©a_d‘eùiÚ
(
n
, **
·ths
, 
m
, 
w
, 
h
, 
boxes
, 
şas£s
, 
j™‹r
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

28 
d©a
 
lßd_d©a_g
(**
·ths
, 
n
, 
m
, 
k
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

29 
m©rix
 
lßd_image_augm’t_·ths
(**
·ths
, 
n
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 
ûÁ”
);

30 
d©a
 
lßd_d©a_su³r
(**
·ths
, 
n
, 
m
, 
w
, 
h
, 
sÿË
);

31 
d©a
 
lßd_d©a_augm’t
(**
·ths
, 
n
, 
m
, **
Ïb–s
, 
k
, 
Œ“
 *
h›¿rchy
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
, 
ûÁ”
);

32 
d©a
 
lßd_d©a_»g»ssiÚ
(**
·ths
, 
n
, 
m
, 
şas£s
, 
mš
, 
max
, 
size
, 
ªgË
, 
a¥eù
, 
hue
, 
§tu¿tiÚ
, 
exposu»
);

33 
d©a
 
lßd_go
(*
f’ame
);

36 
d©a
 
lßd_d©a_wr™šg
(**
·ths
, 
n
, 
m
, 
w
, 
h
, 
out_w
, 
out_h
);

38 
g‘_¿ndom_b©ch
(
d©a
 
d
, 
n
, *
X
, *
y
);

39 
d©a
 
g‘_d©a_·¹
(d©¨
d
, 
·¹
, 
tÙ®
);

40 
d©a
 
g‘_¿ndom_d©a
(d©¨
d
, 
num
);

41 
d©a
 
lßd_ÿ‹gÜiÿl_d©a_csv
(*
f’ame
, 
rg‘
, 
k
);

42 
nÜm®ize_d©a_rows
(
d©a
 
d
);

43 
sÿË_d©a_rows
(
d©a
 
d
, 
s
);

44 
Œª¦©e_d©a_rows
(
d©a
 
d
, 
s
);

45 
¿ndomize_d©a
(
d©a
 
d
);

46 
d©a
 *
¥l™_d©a
(d©¨
d
, 
·¹
, 
tÙ®
);

47 
d©a
 
cÚÿt_d©as
(d©¨*
d
, 
n
);

48 
fl_Œuth
(*
·th
, **
Ïb–s
, 
k
, *
Œuth
);

	@host/src/deconvolutional_layer.c

1 
	~"decÚvŞutiÚ®_Ïy”.h
"

2 
	~"cÚvŞutiÚ®_Ïy”.h
"

3 
	~"b©chnÜm_Ïy”.h
"

4 
	~"uts.h
"

5 
	~"im2cŞ.h
"

6 
	~"cŞ2im.h
"

7 
	~"bÏs.h
"

8 
	~"gemm.h
"

10 
	~<¡dio.h
>

11 
	~<time.h
>

14 
size_t
 
	$g‘_wÜk¥aû_size
(
Ïy”
 
l
){

15  (
size_t
)
l
.
h
*l.
w
*l.
size
*l.size*l.
n
*();

16 
	}
}

18 
	$bš—r_š™
(
Ïy”
 
l
)

20 
i
,
j
,
f
;

21 
ûÁ”
 = (
l
.
size
-1) / 2.;

22 
f
 = 0; f < 
l
.
n
; ++f){

23 
j
 = 0; j < 
l
.
size
; ++j){

24 
i
 = 0; i < 
l
.
size
; ++i){

25 
v®
 = (1 - 
	`çbs
(
i
 - 
ûÁ”
)è* (1 - fabs(
j
 - center));

26 
c
 = 
f
%
l
.c;

27 
šd
 = 
f
*
l
.
size
*l.size*l.
c
 + c*l.size*l.siz+ 
j
*l.siz+ 
i
;

28 
l
.
weights
[
šd
] = 
v®
;

32 
	}
}

35 
Ïy”
 
	$make_decÚvŞutiÚ®_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
)

37 
i
;

38 
Ïy”
 
l
 = {0};

39 
l
.
ty³
 = 
DECONVOLUTIONAL
;

41 
l
.
h
 = h;

42 
l
.
w
 = w;

43 
l
.
c
 = c;

44 
l
.
n
 =‚;

45 
l
.
b©ch
 = batch;

46 
l
.
¡ride
 = stride;

47 
l
.
size
 = size;

49 
l
.
nweights
 = 
c
*
n
*
size
*size;

50 
l
.
nbŸ£s
 = 
n
;

52 
l
.
weights
 = 
	`ÿÎoc
(
c
*
n
*
size
*size, ());

53 
l
.
weight_upd©es
 = 
	`ÿÎoc
(
c
*
n
*
size
*size, ());

55 
l
.
bŸ£s
 = 
	`ÿÎoc
(
n
, ());

56 
l
.
bŸs_upd©es
 = 
	`ÿÎoc
(
n
, ());

59 
sÿË
 = .02;

60 
i
 = 0; i < 
c
*
n
*
size
*size; ++iè
l
.
weights
[i] = 
sÿË
*
	`¿nd_nÜm®
();

62 
i
 = 0; i < 
n
; ++i){

63 
l
.
bŸ£s
[
i
] = 0;

65 
l
.
·d
 = 
·ddšg
;

67 
l
.
out_h
 = (l.
h
 - 1è*†.
¡ride
 +†.
size
 - 2*l.
·d
;

68 
l
.
out_w
 = (l.
w
 - 1è*†.
¡ride
 +†.
size
 - 2*l.
·d
;

69 
l
.
out_c
 = 
n
;

70 
l
.
ouuts
 =†.
out_w
 *†.
out_h
 *†.
out_c
;

71 
l
.
šputs
 =†.
w
 *†.
h
 *†.
c
;

73 
	`sÿl_ıu
(
l
.
nweights
, (î.
out_w
*l.
out_h
/Ö.
w
*l.
h
),†.
weights
, 1);

75 
l
.
ouut
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

76 
l
.
d–
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

78 
l
.
fÜw¬d
 = 
fÜw¬d_decÚvŞutiÚ®_Ïy”
;

79 
l
.
backw¬d
 = 
backw¬d_decÚvŞutiÚ®_Ïy”
;

80 
l
.
upd©e
 = 
upd©e_decÚvŞutiÚ®_Ïy”
;

82 
l
.
b©ch_nÜm®ize
 = batch_normalize;

84 if(
b©ch_nÜm®ize
){

85 
l
.
sÿËs
 = 
	`ÿÎoc
(
n
, ());

86 
l
.
sÿË_upd©es
 = 
	`ÿÎoc
(
n
, ());

87 
i
 = 0; i < 
n
; ++i){

88 
l
.
sÿËs
[
i
] = 1;

91 
l
.
m—n
 = 
	`ÿÎoc
(
n
, ());

92 
l
.
v¬Ÿnû
 = 
	`ÿÎoc
(
n
, ());

94 
l
.
m—n_d–
 = 
	`ÿÎoc
(
n
, ());

95 
l
.
v¬Ÿnû_d–
 = 
	`ÿÎoc
(
n
, ());

97 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
n
, ());

98 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
n
, ());

99 
l
.
x
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

100 
l
.
x_nÜm
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

102 if(
adam
){

103 
l
.
m
 = 
	`ÿÎoc
(
c
*
n
*
size
*size, ());

104 
l
.
v
 = 
	`ÿÎoc
(
c
*
n
*
size
*size, ());

105 
l
.
bŸs_m
 = 
	`ÿÎoc
(
n
, ());

106 
l
.
sÿË_m
 = 
	`ÿÎoc
(
n
, ());

107 
l
.
bŸs_v
 = 
	`ÿÎoc
(
n
, ());

108 
l
.
sÿË_v
 = 
	`ÿÎoc
(
n
, ());

111 #ifdeà
GPU


112 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_decÚvŞutiÚ®_Ïy”_gpu
;

113 
l
.
backw¬d_gpu
 = 
backw¬d_decÚvŞutiÚ®_Ïy”_gpu
;

114 
l
.
upd©e_gpu
 = 
upd©e_decÚvŞutiÚ®_Ïy”_gpu
;

116 if(
gpu_šdex
 >= 0){

118 ià(
adam
) {

119 
l
.
m_gpu
 = 
	`cuda_make_¬¿y
Ö.
m
, 
c
*
n
*
size
*size);

120 
l
.
v_gpu
 = 
	`cuda_make_¬¿y
Ö.
v
, 
c
*
n
*
size
*size);

121 
l
.
bŸs_m_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_m
, 
n
);

122 
l
.
bŸs_v_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_v
, 
n
);

123 
l
.
sÿË_m_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_m
, 
n
);

124 
l
.
sÿË_v_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿË_v
, 
n
);

126 
l
.
weights_gpu
 = 
	`cuda_make_¬¿y
Ö.
weights
, 
c
*
n
*
size
*size);

127 
l
.
weight_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
weight_upd©es
, 
c
*
n
*
size
*size);

129 
l
.
bŸ£s_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸ£s
, 
n
);

130 
l
.
bŸs_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_upd©es
, 
n
);

132 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
,†.
b©ch
*l.
out_h
*l.
out_w
*
n
);

133 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*l.
out_h
*l.
out_w
*
n
);

135 if(
b©ch_nÜm®ize
){

136 
l
.
m—n_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

137 
l
.
v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

139 
l
.
rŞlšg_m—n_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

140 
l
.
rŞlšg_v¬Ÿnû_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

142 
l
.
m—n_d–_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

143 
l
.
v¬Ÿnû_d–_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

145 
l
.
sÿËs_gpu
 = 
	`cuda_make_¬¿y
Ö.
sÿËs
, 
n
);

146 
l
.
sÿË_upd©es_gpu
 = 
	`cuda_make_¬¿y
(0, 
n
);

148 
l
.
x_gpu
 = 
	`cuda_make_¬¿y
(0,†.
b©ch
*l.
out_h
*l.
out_w
*
n
);

149 
l
.
x_nÜm_gpu
 = 
	`cuda_make_¬¿y
(0,†.
b©ch
*l.
out_h
*l.
out_w
*
n
);

152 #ifdeà
CUDNN


153 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
d¡T’sÜDesc
);

154 
	`cudÂC»©eT’sÜDesütÜ
(&
l
.
nÜmT’sÜDesc
);

155 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†.
b©ch
,†.
out_c
,†.
out_h
,†.
out_w
);

156 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
nÜmT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†.
out_c
, 1, 1);

160 
l
.
aùiv©iÚ
 =‡ctivation;

161 
l
.
wÜk¥aû_size
 = 
	`g‘_wÜk¥aû_size
(l);

163 
	`årštf
(
¡d”r
, "decÚv%5d %2d x%2d /%2d %4d x%4d x%4d -> %4d x%4d x%4d\n", 
n
, 
size
, size, 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
);

165  
l
;

166 
	}
}

168 
	$d’Üm®ize_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
)

170 
i
, 
j
;

171 
i
 = 0; i < 
l
.
n
; ++i){

172 
sÿË
 = 
l
.
sÿËs
[
i
]/
	`sq¹
Ö.
rŞlšg_v¬Ÿnû
[i] + .00001);

173 
j
 = 0; j < 
l
.
c
*l.
size
*l.size; ++j){

174 
l
.
weights
[
i
*l.
c
*l.
size
*l.siz+ 
j
] *ğ
sÿË
;

176 
l
.
bŸ£s
[
i
] -ğl.
rŞlšg_m—n
[i] * 
sÿË
;

177 
l
.
sÿËs
[
i
] = 1;

178 
l
.
rŞlšg_m—n
[
i
] = 0;

179 
l
.
rŞlšg_v¬Ÿnû
[
i
] = 1;

181 
	}
}

183 
	$»size_decÚvŞutiÚ®_Ïy”
(
Ïy”
 *
l
, 
h
, 
w
)

185 
l
->
h
 = h;

186 
l
->
w
 = w;

187 
l
->
out_h
 = (l->
h
 - 1è*†->
¡ride
 +†->
size
 - 2*l->
·d
;

188 
l
->
out_w
 = (l->
w
 - 1è*†->
¡ride
 +†->
size
 - 2*l->
·d
;

190 
l
->
ouuts
 =†->
out_h
 *†->
out_w
 *†->
out_c
;

191 
l
->
šputs
 =†->
w
 *†->
h
 *†->
c
;

193 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
b©ch
*l->
ouuts
*());

194 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
b©ch
*l->
ouuts
*());

195 if(
l
->
b©ch_nÜm®ize
){

196 
l
->
x
 = 
	`»®loc
Ö->x,†->
b©ch
*l->
ouuts
*());

197 
l
->
x_nÜm
 = 
	`»®loc
Ö->x_nÜm,†->
b©ch
*l->
ouuts
*());

200 #ifdeà
GPU


201 
	`cuda_ä“
(
l
->
d–_gpu
);

202 
	`cuda_ä“
(
l
->
ouut_gpu
);

204 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
b©ch
*l->
ouuts
);

205 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

207 if(
l
->
b©ch_nÜm®ize
){

208 
	`cuda_ä“
(
l
->
x_gpu
);

209 
	`cuda_ä“
(
l
->
x_nÜm_gpu
);

211 
l
->
x_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

212 
l
->
x_nÜm_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

214 #ifdeà
CUDNN


215 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
,†->
b©ch
,†->
out_c
,†->
out_h
,†->
out_w
);

216 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
nÜmT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†->
out_c
, 1, 1);

219 
l
->
wÜk¥aû_size
 = 
	`g‘_wÜk¥aû_size
(*l);

220 
	}
}

222 
	$fÜw¬d_decÚvŞutiÚ®_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

224 
i
;

226 
m
 = 
l
.
size
*l.size*l.
n
;

227 
n
 = 
l
.
h
*l.
w
;

228 
k
 = 
l
.
c
;

230 
	`fl_ıu
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut
, 1);

232 
i
 = 0; i < 
l
.
b©ch
; ++i){

233 *
a
 = 
l
.
weights
;

234 *
b
 = 
Ãt
.
šput
 + 
i
*
l
.
c
*l.
h
*l.
w
;

235 *
c
 = 
Ãt
.
wÜk¥aû
;

237 
	`gemm_ıu
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,n,0,
c
,n);

239 
	`cŞ2im_ıu
(
Ãt
.
wÜk¥aû
, 
l
.
out_c
,†.
out_h
,†.
out_w
,†.
size
,†.
¡ride
,†.
·d
,†.
ouut
+
i
*l.
ouuts
);

241 ià(
l
.
b©ch_nÜm®ize
) {

242 
	`fÜw¬d_b©chnÜm_Ïy”
(
l
, 
Ãt
);

244 
	`add_bŸs
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
n
,†.
out_w
*l.
out_h
);

246 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
b©ch
*l.
n
*l.
out_w
*l.
out_h
,†.
aùiv©iÚ
);

247 
	}
}

249 
	$backw¬d_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

251 
i
;

253 
	`g¿d›Á_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

255 if(
l
.
b©ch_nÜm®ize
){

256 
	`backw¬d_b©chnÜm_Ïy”
(
l
, 
Ãt
);

258 
	`backw¬d_bŸs
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
n
,†.
out_w
*l.
out_h
);

263 
i
 = 0; i < 
l
.
b©ch
; ++i){

264 
m
 = 
l
.
c
;

265 
n
 = 
l
.
size
*l.size*l.n;

266 
k
 = 
l
.
h
*l.
w
;

268 *
a
 = 
Ãt
.
šput
 + 
i
*
m
*
k
;

269 *
b
 = 
Ãt
.
wÜk¥aû
;

270 *
c
 = 
l
.
weight_upd©es
;

272 
	`im2cŞ_ıu
(
l
.
d–
 + 
i
*l.
ouuts
,†.
out_c
,†.
out_h
,†.
out_w
,

273 
l
.
size
,†.
¡ride
,†.
·d
, 
b
);

274 
	`gemm_ıu
(0,1,
m
,
n
,
k
,1,
a
,k,
b
,k,1,
c
,n);

276 if(
Ãt
.
d–
){

277 
m
 = 
l
.
c
;

278 
n
 = 
l
.
h
*l.
w
;

279 
k
 = 
l
.
size
*l.size*l.
n
;

281 *
a
 = 
l
.
weights
;

282 *
b
 = 
Ãt
.
wÜk¥aû
;

283 *
c
 = 
Ãt
.
d–
 + 
i
*
n
*
m
;

285 
	`gemm_ıu
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,n,1,
c
,n);

288 
	}
}

290 
	$upd©e_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

292 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

293 
mom’tum
 = 
a
.momentum;

294 
deÿy
 = 
a
.decay;

295 
b©ch
 = 
a
.batch;

297 
size
 = 
l
.size*l.size*l.
c
*l.
n
;

298 
	`axpy_ıu
(
l
.
n
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es
, 1,†.
bŸ£s
, 1);

299 
	`sÿl_ıu
(
l
.
n
, 
mom’tum
,†.
bŸs_upd©es
, 1);

301 if(
l
.
sÿËs
){

302 
	`axpy_ıu
(
l
.
n
, 
Ë¬nšg_¿‹
/
b©ch
,†.
sÿË_upd©es
, 1,†.
sÿËs
, 1);

303 
	`sÿl_ıu
(
l
.
n
, 
mom’tum
,†.
sÿË_upd©es
, 1);

306 
	`axpy_ıu
(
size
, -
deÿy
*
b©ch
, 
l
.
weights
, 1,†.
weight_upd©es
, 1);

307 
	`axpy_ıu
(
size
, 
Ë¬nšg_¿‹
/
b©ch
, 
l
.
weight_upd©es
, 1,†.
weights
, 1);

308 
	`sÿl_ıu
(
size
, 
mom’tum
, 
l
.
weight_upd©es
, 1);

309 
	}
}

	@host/src/deconvolutional_layer.h

1 #iâdeà
DECONVOLUTIONAL_LAYER_H


2 
	#DECONVOLUTIONAL_LAYER_H


	)

4 
	~"cuda.h
"

5 
	~"image.h
"

6 
	~"aùiv©iÚs.h
"

7 
	~"Ïy”.h
"

8 
	~"ÃtwÜk.h
"

10 #ifdeà
GPU


11 
fÜw¬d_decÚvŞutiÚ®_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_decÚvŞutiÚ®_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 
upd©e_decÚvŞutiÚ®_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

14 
push_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
);

15 
puÎ_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
);

18 
Ïy”
 
make_decÚvŞutiÚ®_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

19 
»size_decÚvŞutiÚ®_Ïy”
(
Ïy”
 *
l
, 
h
, 
w
);

20 
fÜw¬d_decÚvŞutiÚ®_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

21 
upd©e_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

22 
backw¬d_decÚvŞutiÚ®_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/demo.c

1 
	~"ÃtwÜk.h
"

2 
	~"d‘eùiÚ_Ïy”.h
"

3 
	~"»giÚ_Ïy”.h
"

4 
	~"co¡_Ïy”.h
"

5 
	~"uts.h
"

6 
	~"·r£r.h
"

7 
	~"box.h
"

8 
	~"image.h
"

9 
	~"demo.h
"

10 
	~<sys/time.h
>

12 
	#DEMO
 1

	)

14 #ifdeà
OPENCV


16 **
	gdemo_Çmes
;

17 
image
 **
	gdemo_®phab‘
;

18 
	gdemo_şas£s
;

20 
ÃtwÜk
 *
	gÃt
;

21 
image
 
	gbuff
 [3];

22 
image
 
	gbuff_Ë‰”
[3];

23 
	gbuff_šdex
 = 0;

24 * 
	gÿp
;

25 
	gås
 = 0;

26 
	gdemo_th»sh
 = 0;

27 
	gdemo_h›r
 = .5;

28 
	gruÂšg
 = 0;

30 
	gdemo_äame
 = 3;

31 
	gdemo_šdex
 = 0;

32 **
	g´ediùiÚs
;

33 *
	gavg
;

34 
	gdemo_dÚe
 = 0;

35 
	gdemo_tÙ®
 = 0;

36 
	gdemo_time
;

38 
d‘eùiÚ
 *
g‘_ÃtwÜk_boxes
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
, 
th»sh
, 
h›r
, *
m­
, 
»Ïtive
, *
num
);

40 
	$size_ÃtwÜk
(
ÃtwÜk
 *
Ãt
)

42 
i
;

43 
couÁ
 = 0;

44 
i
 = 0; i < 
Ãt
->
n
; ++i){

45 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

46 if(
l
.
ty³
 =ğ
YOLO
 ||†.ty³ =ğ
REGION
 ||†.ty³ =ğ
DETECTION
){

47 
couÁ
 +ğ
l
.
ouuts
;

50  
couÁ
;

51 
	}
}

53 
	$»memb”_ÃtwÜk
(
ÃtwÜk
 *
Ãt
)

55 
i
;

56 
couÁ
 = 0;

57 
i
 = 0; i < 
Ãt
->
n
; ++i){

58 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

59 if(
l
.
ty³
 =ğ
YOLO
 ||†.ty³ =ğ
REGION
 ||†.ty³ =ğ
DETECTION
){

60 
	`memıy
(
´ediùiÚs
[
demo_šdex
] + 
couÁ
, 
Ãt
->
Ïy”s
[
i
].
ouut
, (è* 
l
.
ouuts
);

61 
couÁ
 +ğ
l
.
ouuts
;

64 
	}
}

66 
d‘eùiÚ
 *
	$avg_´ediùiÚs
(
ÃtwÜk
 *
Ãt
, *
nboxes
)

68 
i
, 
j
;

69 
couÁ
 = 0;

70 
	`fl_ıu
(
demo_tÙ®
, 0, 
avg
, 1);

71 
j
 = 0; j < 
demo_äame
; ++j){

72 
	`axpy_ıu
(
demo_tÙ®
, 1./
demo_äame
, 
´ediùiÚs
[
j
], 1, 
avg
, 1);

74 
i
 = 0; i < 
Ãt
->
n
; ++i){

75 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

76 if(
l
.
ty³
 =ğ
YOLO
 ||†.ty³ =ğ
REGION
 ||†.ty³ =ğ
DETECTION
){

77 
	`memıy
(
l
.
ouut
, 
avg
 + 
couÁ
, (è*†.
ouuts
);

78 
couÁ
 +ğ
l
.
ouuts
;

81 
d‘eùiÚ
 *
d‘s
 = 
	`g‘_ÃtwÜk_boxes
(
Ãt
, 
buff
[0].
w
, buff[0].
h
, 
demo_th»sh
, 
demo_h›r
, 0, 1, 
nboxes
);

82  
d‘s
;

83 
	}
}

85 *
	$d‘eù_š_th»ad
(*
±r
)

87 
ruÂšg
 = 1;

88 
nms
 = .4;

90 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
-1];

91 *
X
 = 
buff_Ë‰”
[(
buff_šdex
+2)%3].
d©a
;

92 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

98 
	`»memb”_ÃtwÜk
(
Ãt
);

99 
d‘eùiÚ
 *
d‘s
 = 0;

100 
nboxes
 = 0;

101 
d‘s
 = 
	`avg_´ediùiÚs
(
Ãt
, &
nboxes
);

125 ià(
nms
 > 0è
	`do_nms_obj
(
d‘s
, 
nboxes
, 
l
.
şas£s
,‚ms);

127 
	`´štf
("\033[2J");

128 
	`´štf
("\033[1;1H");

129 
	`´štf
("\nFPS:%.1f\n",
ås
);

130 
	`´štf
("Objects:\n\n");

131 
image
 
di¥Ïy
 = 
buff
[(
buff_šdex
+2) % 3];

132 
	`d¿w_d‘eùiÚs
(
di¥Ïy
, 
d‘s
, 
nboxes
, 
demo_th»sh
, 
demo_Çmes
, 
demo_®phab‘
, 
demo_şas£s
);

133 
	`ä“_d‘eùiÚs
(
d‘s
, 
nboxes
);

135 
demo_šdex
 = (demo_šdex + 1)%
demo_äame
;

136 
ruÂšg
 = 0;

138 
	}
}

140 *
	$ãtch_š_th»ad
(*
±r
)

142 
	`ä“_image
(
buff
[
buff_šdex
]);

143 
buff
[
buff_šdex
] = 
	`g‘_image_äom_¡»am
(
ÿp
);

144 if(
buff
[
buff_šdex
].
d©a
 == 0) {

145 
demo_dÚe
 = 1;

148 
	`Ë‰”box_image_što
(
buff
[
buff_šdex
], 
Ãt
->
w
,‚‘->
h
, 
buff_Ë‰”
[buff_index]);

150 
	}
}

152 *
	$di¥Ïy_š_th»ad
(*
±r
)

154 
c
 = 
	`show_image
(
buff
[(
buff_šdex
 + 1)%3], "Demo", 1);

155 ià(
c
 != -1) c = c%256;

156 ià(
c
 == 27) {

157 
demo_dÚe
 = 1;

159 } ià(
c
 == 82) {

160 
demo_th»sh
 += .02;

161 } ià(
c
 == 84) {

162 
demo_th»sh
 -= .02;

163 if(
demo_th»sh
 <= .02) demo_thresh = .02;

164 } ià(
c
 == 83) {

165 
demo_h›r
 += .02;

166 } ià(
c
 == 81) {

167 
demo_h›r
 -= .02;

168 if(
demo_h›r
 <= .0) demo_hier = .0;

171 
	}
}

173 *
	$di¥Ïy_loİ
(*
±r
)

176 
	`di¥Ïy_š_th»ad
(0);

178 
	}
}

180 *
	$d‘eù_loİ
(*
±r
)

183 
	`d‘eù_š_th»ad
(0);

185 
	}
}

187 
	$demo
(*
cfgfe
, *
weightfe
, 
th»sh
, 
ÿm_šdex
, cÚ¡ *
f’ame
, **
Çmes
, 
şas£s
, 
d–ay
, *
´efix
, 
avg_äames
, 
h›r
, 
w
, 
h
, 
äames
, 
fuÎsü“n
)

190 
image
 **
®phab‘
 = 
	`lßd_®phab‘
();

191 
demo_Çmes
 = 
Çmes
;

192 
demo_®phab‘
 = 
®phab‘
;

193 
demo_şas£s
 = 
şas£s
;

194 
demo_th»sh
 = 
th»sh
;

195 
demo_h›r
 = 
h›r
;

196 
	`´štf
("Demo\n");

197 
Ãt
 = 
	`lßd_ÃtwÜk
(
cfgfe
, 
weightfe
, 0);

198 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

199 
±h»ad_t
 
d‘eù_th»ad
;

200 
±h»ad_t
 
ãtch_th»ad
;

202 
	`¤ªd
(2222222);

204 
i
;

205 
demo_tÙ®
 = 
	`size_ÃtwÜk
(
Ãt
);

206 
´ediùiÚs
 = 
	`ÿÎoc
(
demo_äame
, (*));

207 
i
 = 0; i < 
demo_äame
; ++i){

208 
´ediùiÚs
[
i
] = 
	`ÿÎoc
(
demo_tÙ®
, ());

210 
avg
 = 
	`ÿÎoc
(
demo_tÙ®
, ());

212 if(
f’ame
){

213 
	`´štf
("videØfe: %s\n", 
f’ame
);

214 
ÿp
 = 
	`İ’_video_¡»am
(
f’ame
, 0, 0, 0, 0);

216 
ÿp
 = 
	`İ’_video_¡»am
(0, 
ÿm_šdex
, 
w
, 
h
, 
äames
);

219 if(!
ÿp
è
	`”rÜ
("Couldn't connecto webcam.\n");

221 
buff
[0] = 
	`g‘_image_äom_¡»am
(
ÿp
);

222 
buff
[1] = 
	`cİy_image
(buff[0]);

223 
buff
[2] = 
	`cİy_image
(buff[0]);

224 
buff_Ë‰”
[0] = 
	`Ë‰”box_image
(
buff
[0], 
Ãt
->
w
,‚‘->
h
);

225 
buff_Ë‰”
[1] = 
	`Ë‰”box_image
(
buff
[0], 
Ãt
->
w
,‚‘->
h
);

226 
buff_Ë‰”
[2] = 
	`Ë‰”box_image
(
buff
[0], 
Ãt
->
w
,‚‘->
h
);

228 
couÁ
 = 0;

229 if(!
´efix
){

230 
	`make_wšdow
("Demo", 1352, 1013, 
fuÎsü“n
);

233 
demo_time
 = 
	`wh©_time_is_™_now
();

235 !
demo_dÚe
){

236 
buff_šdex
 = (buff_index + 1) %3;

237 if(
	`±h»ad_ü—‹
(&
ãtch_th»ad
, 0, 
ãtch_š_th»ad
, 0)è
	`”rÜ
("Thread creation failed");

238 if(
	`±h»ad_ü—‹
(&
d‘eù_th»ad
, 0, 
d‘eù_š_th»ad
, 0)è
	`”rÜ
("Thread creation failed");

239 if(!
´efix
){

240 
ås
 = 1./(
	`wh©_time_is_™_now
(è- 
demo_time
);

241 
demo_time
 = 
	`wh©_time_is_™_now
();

242 
	`di¥Ïy_š_th»ad
(0);

244 
Çme
[256];

245 
	`¥rštf
(
Çme
, "%s_%08d", 
´efix
, 
couÁ
);

246 
	`§ve_image
(
buff
[(
buff_šdex
 + 1)%3], 
Çme
);

248 
	`±h»ad_još
(
ãtch_th»ad
, 0);

249 
	`±h»ad_još
(
d‘eù_th»ad
, 0);

250 ++
couÁ
;

252 
	}
}

344 
	$demo
(*
cfgfe
, *
weightfe
, 
th»sh
, 
ÿm_šdex
, cÚ¡ *
f’ame
, **
Çmes
, 
şas£s
, 
d–ay
, *
´efix
, 
avg
, 
h›r
, 
w
, 
h
, 
äames
, 
fuÎsü“n
)

346 
	`årštf
(
¡d”r
, "Demo‚eeds OpenCV for webcam images.\n");

347 
	}
}

	@host/src/demo.h

1 #iâdeà
DEMO_H


2 
	#DEMO_H


	)

4 
	~"image.h
"

	@host/src/detection_layer.c

1 
	~"d‘eùiÚ_Ïy”.h
"

2 
	~"aùiv©iÚs.h
"

3 
	~"soámax_Ïy”.h
"

4 
	~"bÏs.h
"

5 
	~"box.h
"

6 
	~"cuda.h
"

7 
	~"uts.h
"

9 
	~<¡dio.h
>

10 
	~<as£¹.h
>

11 
	~<¡ršg.h
>

12 
	~<¡dlib.h
>

14 
d‘eùiÚ_Ïy”
 
	$make_d‘eùiÚ_Ïy”
(
b©ch
, 
šputs
, 
n
, 
side
, 
şas£s
, 
coÜds
, 
»scÜe
)

16 
d‘eùiÚ_Ïy”
 
l
 = {0};

17 
l
.
ty³
 = 
DETECTION
;

19 
l
.
n
 =‚;

20 
l
.
b©ch
 = batch;

21 
l
.
šputs
 = inputs;

22 
l
.
şas£s
 = classes;

23 
l
.
coÜds
 = coords;

24 
l
.
»scÜe
 =„escore;

25 
l
.
side
 = side;

26 
l
.
w
 = 
side
;

27 
l
.
h
 = 
side
;

28 
	`as£¹
(
side
*side*((1 + 
l
.
coÜds
)*l.
n
 +†.
şas£s
è=ğ
šputs
);

29 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

30 
l
.
ouuts
 =†.
šputs
;

31 
l
.
Œuths
 =†.
side
*l.side*(1+l.
coÜds
+l.
şas£s
);

32 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

33 
l
.
d–
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

35 
l
.
fÜw¬d
 = 
fÜw¬d_d‘eùiÚ_Ïy”
;

36 
l
.
backw¬d
 = 
backw¬d_d‘eùiÚ_Ïy”
;

37 #ifdeà
GPU


38 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_d‘eùiÚ_Ïy”_gpu
;

39 
l
.
backw¬d_gpu
 = 
backw¬d_d‘eùiÚ_Ïy”_gpu
;

40 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
b©ch
*l.
ouuts
);

41 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
b©ch
*l.
ouuts
);

44 
	`årštf
(
¡d”r
, "Detection Layer\n");

45 
	`¤ªd
(0);

47  
l
;

48 
	}
}

50 
	$fÜw¬d_d‘eùiÚ_Ïy”
(cÚ¡ 
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

52 
loÿtiÚs
 = 
l
.
side
*l.side;

53 
i
,
j
;

54 
	`memıy
(
l
.
ouut
, 
Ãt
.
šput
,†.
ouuts
*l.
b©ch
*());

56 
b
;

57 ià(
l
.
soámax
){

58 
b
 = 0; b < 
l
.
b©ch
; ++b){

59 
šdex
 = 
b
*
l
.
šputs
;

60 
i
 = 0; i < 
loÿtiÚs
; ++i) {

61 
off£t
 = 
i
*
l
.
şas£s
;

62 
	`soámax
(
l
.
ouut
 + 
šdex
 + 
off£t
,†.
şas£s
, 1, 1,

63 
l
.
ouut
 + 
šdex
 + 
off£t
);

67 if(
Ãt
.
Œaš
){

68 
avg_iou
 = 0;

69 
avg_ÿt
 = 0;

70 
avg_®lÿt
 = 0;

71 
avg_obj
 = 0;

72 
avg_ªyobj
 = 0;

73 
couÁ
 = 0;

74 *(
l
.
co¡
) = 0;

75 
size
 = 
l
.
šputs
 *†.
b©ch
;

76 
	`mem£t
(
l
.
d–
, 0, 
size
 * ());

77 
b
 = 0; b < 
l
.
b©ch
; ++b){

78 
šdex
 = 
b
*
l
.
šputs
;

79 
i
 = 0; i < 
loÿtiÚs
; ++i) {

80 
Œuth_šdex
 = (
b
*
loÿtiÚs
 + 
i
)*(1+
l
.
coÜds
+l.
şas£s
);

81 
is_obj
 = 
Ãt
.
Œuth
[
Œuth_šdex
];

82 
j
 = 0; j < 
l
.
n
; ++j) {

83 
p_šdex
 = 
šdex
 + 
loÿtiÚs
*
l
.
şas£s
 + 
i
*l.
n
 + 
j
;

84 
l
.
d–
[
p_šdex
] =†.
noobjeù_sÿË
*(0 -†.
ouut
[p_index]);

85 *(
l
.
co¡
è+ğl.
noobjeù_sÿË
*
	`pow
Ö.
ouut
[
p_šdex
], 2);

86 
avg_ªyobj
 +ğ
l
.
ouut
[
p_šdex
];

89 
be¡_šdex
 = -1;

90 
be¡_iou
 = 0;

91 
be¡_rm£
 = 20;

93 ià(!
is_obj
){

97 
şass_šdex
 = 
šdex
 + 
i
*
l
.
şas£s
;

98 
j
 = 0; j < 
l
.
şas£s
; ++j) {

99 
l
.
d–
[
şass_šdex
+
j
] =†.
şass_sÿË
 * (
Ãt
.
Œuth
[
Œuth_šdex
+1+j] -†.
ouut
[class_index+j]);

100 *(
l
.
co¡
è+ğl.
şass_sÿË
 * 
	`pow
(
Ãt
.
Œuth
[
Œuth_šdex
+1+
j
] -†.
ouut
[
şass_šdex
+j], 2);

101 if(
Ãt
.
Œuth
[
Œuth_šdex
 + 1 + 
j
]è
avg_ÿt
 +ğ
l
.
ouut
[
şass_šdex
+j];

102 
avg_®lÿt
 +ğ
l
.
ouut
[
şass_šdex
+
j
];

105 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
Œuth_šdex
 + 1 + 
l
.
şas£s
, 1);

106 
Œuth
.
x
 /ğ
l
.
side
;

107 
Œuth
.
y
 /ğ
l
.
side
;

109 
j
 = 0; j < 
l
.
n
; ++j){

110 
box_šdex
 = 
šdex
 + 
loÿtiÚs
*(
l
.
şas£s
 +†.
n
è+ (
i
*l.À+ 
j
è*†.
coÜds
;

111 
box
 
out
 = 
	`æßt_to_box
(
l
.
ouut
 + 
box_šdex
, 1);

112 
out
.
x
 /ğ
l
.
side
;

113 
out
.
y
 /ğ
l
.
side
;

115 ià(
l
.
sq¹
){

116 
out
.
w
 = out.w*out.w;

117 
out
.
h
 = out.h*out.h;

120 
iou
 = 
	`box_iou
(
out
, 
Œuth
);

122 
rm£
 = 
	`box_rm£
(
out
, 
Œuth
);

123 if(
be¡_iou
 > 0 || 
iou
 > 0){

124 if(
iou
 > 
be¡_iou
){

125 
be¡_iou
 = 
iou
;

126 
be¡_šdex
 = 
j
;

129 if(
rm£
 < 
be¡_rm£
){

130 
be¡_rm£
 = 
rm£
;

131 
be¡_šdex
 = 
j
;

136 if(
l
.
fÜûd
){

137 if(
Œuth
.
w
*Œuth.
h
 < .1){

138 
be¡_šdex
 = 1;

140 
be¡_šdex
 = 0;

143 if(
l
.
¿ndom
 && *(
Ãt
.
£’
) < 64000){

144 
be¡_šdex
 = 
	`¿nd
()%
l
.
n
;

147 
box_šdex
 = 
šdex
 + 
loÿtiÚs
*(
l
.
şas£s
 +†.
n
è+ (
i
*l.À+ 
be¡_šdex
è*†.
coÜds
;

148 
tbox_šdex
 = 
Œuth_šdex
 + 1 + 
l
.
şas£s
;

150 
box
 
out
 = 
	`æßt_to_box
(
l
.
ouut
 + 
box_šdex
, 1);

151 
out
.
x
 /ğ
l
.
side
;

152 
out
.
y
 /ğ
l
.
side
;

153 ià(
l
.
sq¹
) {

154 
out
.
w
 = out.w*out.w;

155 
out
.
h
 = out.h*out.h;

157 
iou
 = 
	`box_iou
(
out
, 
Œuth
);

160 
p_šdex
 = 
šdex
 + 
loÿtiÚs
*
l
.
şas£s
 + 
i
*l.
n
 + 
be¡_šdex
;

161 *(
l
.
co¡
è-ğl.
noobjeù_sÿË
 * 
	`pow
Ö.
ouut
[
p_šdex
], 2);

162 *(
l
.
co¡
è+ğl.
objeù_sÿË
 * 
	`pow
(1-l.
ouut
[
p_šdex
], 2);

163 
avg_obj
 +ğ
l
.
ouut
[
p_šdex
];

164 
l
.
d–
[
p_šdex
] =†.
objeù_sÿË
 * (1.-l.
ouut
[p_index]);

166 if(
l
.
»scÜe
){

167 
l
.
d–
[
p_šdex
] =†.
objeù_sÿË
 * (
iou
 -†.
ouut
[p_index]);

170 
l
.
d–
[
box_šdex
+0] =†.
coÜd_sÿË
*(
Ãt
.
Œuth
[
tbox_šdex
 + 0] -†.
ouut
[box_index + 0]);

171 
l
.
d–
[
box_šdex
+1] =†.
coÜd_sÿË
*(
Ãt
.
Œuth
[
tbox_šdex
 + 1] -†.
ouut
[box_index + 1]);

172 
l
.
d–
[
box_šdex
+2] =†.
coÜd_sÿË
*(
Ãt
.
Œuth
[
tbox_šdex
 + 2] -†.
ouut
[box_index + 2]);

173 
l
.
d–
[
box_šdex
+3] =†.
coÜd_sÿË
*(
Ãt
.
Œuth
[
tbox_šdex
 + 3] -†.
ouut
[box_index + 3]);

174 if(
l
.
sq¹
){

175 
l
.
d–
[
box_šdex
+2] =†.
coÜd_sÿË
*(
	`sq¹
(
Ãt
.
Œuth
[
tbox_šdex
 + 2]è-†.
ouut
[box_index + 2]);

176 
l
.
d–
[
box_šdex
+3] =†.
coÜd_sÿË
*(
	`sq¹
(
Ãt
.
Œuth
[
tbox_šdex
 + 3]è-†.
ouut
[box_index + 3]);

179 *(
l
.
co¡
è+ğ
	`pow
(1-
iou
, 2);

180 
avg_iou
 +ğ
iou
;

181 ++
couÁ
;

186 *
co¡s
 = 
	`ÿÎoc
(
l
.
b©ch
*
loÿtiÚs
*l.
n
, ());

187 
b
 = 0; b < 
l
.
b©ch
; ++b) {

188 
šdex
 = 
b
*
l
.
šputs
;

189 
i
 = 0; i < 
loÿtiÚs
; ++i) {

190 
j
 = 0; j < 
l
.
n
; ++j) {

191 
p_šdex
 = 
šdex
 + 
loÿtiÚs
*
l
.
şas£s
 + 
i
*l.
n
 + 
j
;

192 
co¡s
[
b
*
loÿtiÚs
*
l
.
n
 + 
i
*l.À+ 
j
] =†.
d–
[
p_šdex
]*l.delta[p_index];

196 
šdexes
[100];

197 
	`tİ_k
(
co¡s
, 
l
.
b©ch
*
loÿtiÚs
*l.
n
, 100, 
šdexes
);

198 
cutoff
 = 
co¡s
[
šdexes
[99]];

199 
b
 = 0; b < 
l
.
b©ch
; ++b) {

200 
šdex
 = 
b
*
l
.
šputs
;

201 
i
 = 0; i < 
loÿtiÚs
; ++i) {

202 
j
 = 0; j < 
l
.
n
; ++j) {

203 
p_šdex
 = 
šdex
 + 
loÿtiÚs
*
l
.
şas£s
 + 
i
*l.
n
 + 
j
;

204 ià(
l
.
d–
[
p_šdex
]*l.d–[p_šdex] < 
cutoff
)†.delta[p_index] = 0;

208 
	`ä“
(
co¡s
);

212 *(
l
.
co¡
èğ
	`pow
(
	`mag_¬¿y
Ö.
d–
,†.
ouuts
 *†.
b©ch
), 2);

215 
	`´štf
("D‘eùiÚ Avg IOU: %f, Po C©: %f, AÎ C©: %f, Po Obj: %f, Any Obj: %f, couÁ: %d\n", 
avg_iou
/
couÁ
, 
avg_ÿt
/couÁ, 
avg_®lÿt
/(couÁ*
l
.
şas£s
), 
avg_obj
/couÁ, 
avg_ªyobj
/Ö.
b©ch
*
loÿtiÚs
*l.
n
), count);

218 
	}
}

220 
	$backw¬d_d‘eùiÚ_Ïy”
(cÚ¡ 
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

222 
	`axpy_ıu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

223 
	}
}

225 
	$g‘_d‘eùiÚ_d‘eùiÚs
(
Ïy”
 
l
, 
w
, 
h
, 
th»sh
, 
d‘eùiÚ
 *
d‘s
)

227 
i
,
j
,
n
;

228 *
´ediùiÚs
 = 
l
.
ouut
;

230 
i
 = 0; i < 
l
.
side
*l.side; ++i){

231 
row
 = 
i
 / 
l
.
side
;

232 
cŞ
 = 
i
 % 
l
.
side
;

233 
n
 = 0;‚ < 
l
.n; ++n){

234 
šdex
 = 
i
*
l
.
n
 +‚;

235 
p_šdex
 = 
l
.
side
*l.side*l.
şas£s
 + 
i
*l.
n
 +‚;

236 
sÿË
 = 
´ediùiÚs
[
p_šdex
];

237 
box_šdex
 = 
l
.
side
*l.side*Ö.
şas£s
 +†.
n
è+ (
i
*l.n +‚)*4;

238 
box
 
b
;

239 
b
.
x
 = (
´ediùiÚs
[
box_šdex
 + 0] + 
cŞ
è/ 
l
.
side
 * 
w
;

240 
b
.
y
 = (
´ediùiÚs
[
box_šdex
 + 1] + 
row
è/ 
l
.
side
 * 
h
;

241 
b
.
w
 = 
	`pow
(
´ediùiÚs
[
box_šdex
 + 2], (
l
.
sq¹
?2:1)) * w;

242 
b
.
h
 = 
	`pow
(
´ediùiÚs
[
box_šdex
 + 3], (
l
.
sq¹
?2:1)) * h;

243 
d‘s
[
šdex
].
bbox
 = 
b
;

244 
d‘s
[
šdex
].
objeùÃss
 = 
sÿË
;

245 
j
 = 0; j < 
l
.
şas£s
; ++j){

246 
şass_šdex
 = 
i
*
l
.
şas£s
;

247 
´ob
 = 
sÿË
*
´ediùiÚs
[
şass_šdex
+
j
];

248 
d‘s
[
šdex
].
´ob
[
j
] = (´ob > 
th»sh
) ?…rob : 0;

252 
	}
}

254 #ifdeà
GPU


256 
	$fÜw¬d_d‘eùiÚ_Ïy”_gpu
(cÚ¡ 
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

258 if(!
Ãt
.
Œaš
){

259 
	`cİy_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

263 
	`cuda_puÎ_¬¿y
(
Ãt
.
šput_gpu
,‚‘.
šput
, 
l
.
b©ch
*l.
šputs
);

264 
	`fÜw¬d_d‘eùiÚ_Ïy”
(
l
, 
Ãt
);

265 
	`cuda_push_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
b©ch
*l.
ouuts
);

266 
	`cuda_push_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
šputs
);

267 
	}
}

269 
	$backw¬d_d‘eùiÚ_Ïy”_gpu
(
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

271 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

273 
	}
}

	@host/src/detection_layer.h

1 #iâdeà
DETECTION_LAYER_H


2 
	#DETECTION_LAYER_H


	)

4 
	~"Ïy”.h
"

5 
	~"ÃtwÜk.h
"

7 
Ïy”
 
	td‘eùiÚ_Ïy”
;

9 
d‘eùiÚ_Ïy”
 
make_d‘eùiÚ_Ïy”
(
b©ch
, 
šputs
, 
n
, 
size
, 
şas£s
, 
coÜds
, 
»scÜe
);

10 
fÜw¬d_d‘eùiÚ_Ïy”
(cÚ¡ 
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
backw¬d_d‘eùiÚ_Ïy”
(cÚ¡ 
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 #ifdeà
GPU


14 
fÜw¬d_d‘eùiÚ_Ïy”_gpu
(cÚ¡ 
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
backw¬d_d‘eùiÚ_Ïy”_gpu
(
d‘eùiÚ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/diffprivate.c

1 
	~"uts.h
"

2 
	~"m©h.h
"

3 
	~"difåriv©e.h
"

5 
	$diff_´iv©e_func
(*
šput
, 
Ën_šput
)

8 
bound
 = 4;

9 
•sÚ
 = 4;

10 
d–
 = 0.00001;

12 
sum
 = 0;

13 
i
=0; i<
Ën_šput
; i++){

14 
sum
 +ğ
	`pow
(
šput
[
i
],2);

16 
squm
 = 
	`sq¹
(
sum
)/
bound
;

18 if(
squm
 < 1){

19 
squm
 = 1;

22 
sigma
 = 
	`sq¹
((2*
	`pow
(
bound
,2))/Õow(
•sÚ
,2)è* 
	`log
(1.25/
d–
));

24 
i
=0; i<
Ën_šput
; i++){

25 
šput
[
i
] = iÅut[i]/
squm
 + 
	`¿nd_nÜm®_ms
(0.0f, 
sigma
);

29 
	}
}

	@host/src/diffprivate.h

1 #iâdeà
DIFF_TA_H


2 
	#DIFF_TA_H


	)

4 
diff_´iv©e_func
(*
šput
, 
Ën_šput
);

	@host/src/dropout_layer.c

1 
	~"drİout_Ïy”.h
"

2 
	~"uts.h
"

3 
	~"cuda.h
"

5 
	~"·r£r.h
"

7 
	~<¡dlib.h
>

8 
	~<¡dio.h
>

10 
drİout_Ïy”
 
	$make_drİout_Ïy”
(
b©ch
, 
šputs
, 
´obab™y
)

12 
drİout_Ïy”
 
l
 = {0};

13 
l
.
ty³
 = 
DROPOUT
;

14 
l
.
´obab™y
 =…robability;

15 
l
.
šputs
 = inputs;

16 
l
.
ouuts
 = 
šputs
;

17 
l
.
b©ch
 = batch;

18 
l
.
¿nd
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

19 
l
.
sÿË
 = 1./(1.-
´obab™y
);

20 
l
.
fÜw¬d
 = 
fÜw¬d_drİout_Ïy”
;

21 
l
.
backw¬d
 = 
backw¬d_drİout_Ïy”
;

22 #ifdeà
GPU


23 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_drİout_Ïy”_gpu
;

24 
l
.
backw¬d_gpu
 = 
backw¬d_drİout_Ïy”_gpu
;

25 
l
.
¿nd_gpu
 = 
	`cuda_make_¬¿y
Ö.
¿nd
, 
šputs
*
b©ch
);

30 
	`årštf
(
¡d”r
, "drİouˆ… = %.2à %4d -> %4d\n", 
´obab™y
, 
šputs
, inputs);

32 
	`årštf
(
¡d”r
, "drİout_TA… = %.2à %4d -> %4d\n", 
´obab™y
, 
šputs
, inputs);

34  
l
;

35 
	}
}

37 
	$»size_drİout_Ïy”
(
drİout_Ïy”
 *
l
, 
šputs
)

39 
l
->
¿nd
 = 
	`»®loc
Ö->¿nd,†->
šputs
*l->
b©ch
*());

40 #ifdeà
GPU


41 
	`cuda_ä“
(
l
->
¿nd_gpu
);

43 
l
->
¿nd_gpu
 = 
	`cuda_make_¬¿y
Ö->
¿nd
, 
šputs
*l->
b©ch
);

45 
	}
}

47 
	$fÜw¬d_drİout_Ïy”
(
drİout_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

49 
i
;

50 ià(!
Ãt
.
Œaš
) ;

51 
i
 = 0; i < 
l
.
b©ch
 *†.
šputs
; ++i){

53 
r
 = 
	`¿nd_unifÜm
(0, 1);

54 
l
.
¿nd
[
i
] = 
r
;

55 if(
r
 < 
l
.
´obab™y
è
Ãt
.
šput
[
i
] = 0;

56 
Ãt
.
šput
[
i
] *ğ
l
.
sÿË
;

58 
	}
}

60 
	$backw¬d_drİout_Ïy”
(
drİout_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

62 
i
;

63 if(!
Ãt
.
d–
) ;

64 
i
 = 0; i < 
l
.
b©ch
 *†.
šputs
; ++i){

65 
r
 = 
l
.
¿nd
[
i
];

66 if(
r
 < 
l
.
´obab™y
è
Ãt
.
d–
[
i
] = 0;

67 
Ãt
.
d–
[
i
] *ğ
l
.
sÿË
;

69 
	}
}

	@host/src/dropout_layer.h

1 #iâdeà
DROPOUT_LAYER_H


2 
	#DROPOUT_LAYER_H


	)

4 
	~"Ïy”.h
"

5 
	~"ÃtwÜk.h
"

7 
Ïy”
 
	tdrİout_Ïy”
;

9 
drİout_Ïy”
 
make_drİout_Ïy”
(
b©ch
, 
šputs
, 
´obab™y
);

11 
fÜw¬d_drİout_Ïy”
(
drİout_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_drİout_Ïy”
(
drİout_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 
»size_drİout_Ïy”
(
drİout_Ïy”
 *
l
, 
šputs
);

15 #ifdeà
GPU


16 
fÜw¬d_drİout_Ïy”_gpu
(
drİout_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 
backw¬d_drİout_Ïy”_gpu
(
drİout_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/gemm.c

1 
	~"gemm.h
"

2 
	~"uts.h
"

3 
	~"cuda.h
"

4 
	~<¡dlib.h
>

5 
	~<¡dio.h
>

6 
	~<m©h.h
>

8 
	~"difåriv©e.h
"

10 
	$gemm_bš
(
M
, 
N
, 
K
, 
ALPHA
,

11 *
A
, 
lda
,

12 *
B
, 
ldb
,

13 *
C
, 
ldc
)

15 
i
,
j
,
k
;

16 
i
 = 0; i < 
M
; ++i){

17 
k
 = 0; k < 
K
; ++k){

18 
A_PART
 = 
A
[
i
*
lda
+
k
];

19 if(
A_PART
){

20 
j
 = 0; j < 
N
; ++j){

21 
C
[
i
*
ldc
+
j
] +ğ
B
[
k
*
ldb
+j];

24 
j
 = 0; j < 
N
; ++j){

25 
C
[
i
*
ldc
+
j
] -ğ
B
[
k
*
ldb
+j];

30 
	}
}

32 *
	$¿ndom_m©rix
(
rows
, 
cŞs
)

34 
i
;

35 *
m
 = 
	`ÿÎoc
(
rows
*
cŞs
, ());

36 
i
 = 0; i < 
rows
*
cŞs
; ++i){

37 
m
[
i
] = ()
	`¿nd
()/
RAND_MAX
;

39  
m
;

40 
	}
}

42 
	$time_¿ndom_m©rix
(
TA
, 
TB
, 
m
, 
k
, 
n
)

44 *
a
;

45 if(!
TA
è
a
 = 
	`¿ndom_m©rix
(
m
,
k
);

46 
a
 = 
	`¿ndom_m©rix
(
k
,
m
);

47 
lda
 = (!
TA
)?
k
:
m
;

48 *
b
;

49 if(!
TB
è
b
 = 
	`¿ndom_m©rix
(
k
,
n
);

50 
b
 = 
	`¿ndom_m©rix
(
n
,
k
);

51 
ldb
 = (!
TB
)?
n
:
k
;

53 *
c
 = 
	`¿ndom_m©rix
(
m
,
n
);

54 
i
;

55 
şock_t
 
¡¬t
 = 
	`şock
(), 
’d
;

56 
i
 = 0; i<10; ++i){

57 
	`gemm_ıu
(
TA
,
TB
,
m
,
n
,
k
,1,
a
,
lda
,
b
,
ldb
,1,
c
,n);

59 
’d
 = 
	`şock
();

60 
	`´štf
("M©rix MuÉliÿtiÚ %dx%d * %dx%d, TA=%d, TB=%d: %làms\n",
m
,
k
,k,
n
, 
TA
, 
TB
, ()(
’d
-
¡¬t
)/
CLOCKS_PER_SEC
);

61 
	`ä“
(
a
);

62 
	`ä“
(
b
);

63 
	`ä“
(
c
);

64 
	}
}

67 
	$gemm
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

68 *
A
, 
lda
,

69 *
B
, 
ldb
,

70 
BETA
,

71 *
C
, 
ldc
)

73 
	`gemm_ıu
Ğ
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
BETA
,
C
,
ldc
);

74 
	}
}

76 
	$gemm_diff
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

77 *
A
, 
lda
,

78 *
B
, 
ldb
,

79 
BETA
,

80 *
C
, 
ldc
)

82 
	`gemm_ıu_diff
Ğ
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
BETA
,
C
,
ldc
);

83 
	}
}

85 
	$gemm_Â
(
M
, 
N
, 
K
, 
ALPHA
,

86 *
A
, 
lda
,

87 *
B
, 
ldb
,

88 *
C
, 
ldc
)

90 
i
,
j
,
k
;

91 #´agm¨
omp
 
·¿Î–
 

92 
i
 = 0; i < 
M
; ++i){

93 
k
 = 0; k < 
K
; ++k){

94 
A_PART
 = 
ALPHA
*
A
[
i
*
lda
+
k
];

95 
j
 = 0; j < 
N
; ++j){

96 
C
[
i
*
ldc
+
j
] +ğ
A_PART
*
B
[
k
*
ldb
+j];

100 
	}
}

102 
	$gemm_Á
(
M
, 
N
, 
K
, 
ALPHA
,

103 *
A
, 
lda
,

104 *
B
, 
ldb
,

105 *
C
, 
ldc
)

107 
i
,
j
,
k
;

108 #´agm¨
omp
 
·¿Î–
 

109 
i
 = 0; i < 
M
; ++i){

110 
j
 = 0; j < 
N
; ++j){

111 
sum
 = 0;

112 
k
 = 0; k < 
K
; ++k){

113 
sum
 +ğ
ALPHA
*
A
[
i
*
lda
+
k
]*
B
[
j
*
ldb
 + k];

115 
C
[
i
*
ldc
+
j
] +ğ
sum
;

118 
	}
}

120 
	$gemm_Á_diff
(
M
, 
N
, 
K
, 
ALPHA
,

121 *
A
, 
lda
,

122 *
B
, 
ldb
,

123 *
C
, 
ldc
)

125 
i
,
j
,
k
;

126 #´agm¨
omp
 
·¿Î–
 

127 
k
 = 0; k < 
K
; ++k){

128 
i
 = 0; i < 
M
; ++i){

129 
j
 = 0; j < 
N
; ++j){

130 
C
[
i
*
ldc
+
j
] +ğ
ALPHA
*
A
[i*
lda
+
k
]*
B
[j*
ldb
 + k];

134 
	}
}

136 
	$gemm_Š
(
M
, 
N
, 
K
, 
ALPHA
,

137 *
A
, 
lda
,

138 *
B
, 
ldb
,

139 *
C
, 
ldc
)

141 
i
,
j
,
k
;

142 #´agm¨
omp
 
·¿Î–
 

143 
i
 = 0; i < 
M
; ++i){

144 
k
 = 0; k < 
K
; ++k){

145 
A_PART
 = 
ALPHA
*
A
[
k
*
lda
+
i
];

146 
j
 = 0; j < 
N
; ++j){

147 
C
[
i
*
ldc
+
j
] +ğ
A_PART
*
B
[
k
*
ldb
+j];

151 
	}
}

153 
	$gemm_Š_diff
(
M
, 
N
, 
K
, 
ALPHA
,

154 *
A
, 
lda
,

155 *
B
, 
ldb
,

156 *
C
, 
ldc
)

159 
i
,
j
,
k
;

160 #´agm¨
omp
 
·¿Î–
 

161 
k
 = 0; k < 
K
; ++k){

162 
i
 = 0; i < 
M
; ++i){

163 
A_PART
 = 
ALPHA
*
A
[
k
*
lda
+
i
];

164 
j
 = 0; j < 
N
; ++j){

165 
C
[
i
*
ldc
+
j
] +ğ
A_PART
*
B
[
k
*
ldb
+j];

170 
	`diff_´iv©e_func
(
C
, 
N
*
M
);

172 
	}
}

174 
	$gemm_‰
(
M
, 
N
, 
K
, 
ALPHA
,

175 *
A
, 
lda
,

176 *
B
, 
ldb
,

177 *
C
, 
ldc
)

179 
i
,
j
,
k
;

180 #´agm¨
omp
 
·¿Î–
 

181 
i
 = 0; i < 
M
; ++i){

182 
j
 = 0; j < 
N
; ++j){

183 
sum
 = 0;

184 
k
 = 0; k < 
K
; ++k){

185 
sum
 +ğ
ALPHA
*
A
[
i
+
k
*
lda
]*
B
[k+
j
*
ldb
];

187 
C
[
i
*
ldc
+
j
] +ğ
sum
;

190 
	}
}

193 
	$gemm_ıu
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

194 *
A
, 
lda
,

195 *
B
, 
ldb
,

196 
BETA
,

197 *
C
, 
ldc
)

200 
i
, 
j
;

201 
i
 = 0; i < 
M
; ++i){

202 
j
 = 0; j < 
N
; ++j){

203 
C
[
i
*
ldc
 + 
j
] *ğ
BETA
;

206 if(!
TA
 && !
TB
)

207 
	`gemm_Â
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

208 if(
TA
 && !
TB
)

209 
	`gemm_Š
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

210 if(!
TA
 && 
TB
)

211 
	`gemm_Á
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

213 
	`gemm_‰
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

214 
	}
}

216 
	$gemm_ıu_diff
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

217 *
A
, 
lda
,

218 *
B
, 
ldb
,

219 
BETA
,

220 *
C
, 
ldc
)

223 
i
, 
j
;

224 
i
 = 0; i < 
M
; ++i){

225 
j
 = 0; j < 
N
; ++j){

226 
C
[
i
*
ldc
 + 
j
] *ğ
BETA
;

229 if(!
TA
 && !
TB
)

230 
	`gemm_Â
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

231 if(
TA
 && !
TB
)

232 
	`gemm_Š_diff
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

233 if(!
TA
 && 
TB
)

234 
	`gemm_Á_diff
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

236 
	`gemm_‰
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

237 
	}
}

239 #ifdeà
GPU


241 
	~<m©h.h
>

243 
	$gemm_gpu
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

244 *
A_gpu
, 
lda
,

245 *
B_gpu
, 
ldb
,

246 
BETA
,

247 *
C_gpu
, 
ldc
)

249 
cubÏsHªdË_t
 
hªdË
 = 
	`bÏs_hªdË
();

250 
cudaE¼Ü_t
 
¡©us
 = 
	`cubÏsSgemm
(
hªdË
, (
TB
 ? 
CUBLAS_OP_T
 : 
CUBLAS_OP_N
),

251 (
TA
 ? 
CUBLAS_OP_T
 : 
CUBLAS_OP_N
), 
N
, 
M
, 
K
, &
ALPHA
, 
B_gpu
, 
ldb
, 
A_gpu
, 
lda
, &
BETA
, 
C_gpu
, 
ldc
);

252 
	`check_”rÜ
(
¡©us
);

253 
	}
}

255 
	~<¡dio.h
>

256 
	~<¡dlib.h
>

257 
	~<¡ršg.h
>

258 
	~<time.h
>

260 
	$time_gpu_¿ndom_m©rix
(
TA
, 
TB
, 
m
, 
k
, 
n
)

262 *
a
;

263 if(!
TA
è
a
 = 
	`¿ndom_m©rix
(
m
,
k
);

264 
a
 = 
	`¿ndom_m©rix
(
k
,
m
);

265 
lda
 = (!
TA
)?
k
:
m
;

266 *
b
;

267 if(!
TB
è
b
 = 
	`¿ndom_m©rix
(
k
,
n
);

268 
b
 = 
	`¿ndom_m©rix
(
n
,
k
);

269 
ldb
 = (!
TB
)?
n
:
k
;

271 *
c
 = 
	`¿ndom_m©rix
(
m
,
n
);

272 
i
;

273 
şock_t
 
¡¬t
 = 
	`şock
(), 
’d
;

274 
i
 = 0; i<32; ++i){

275 
	`gemm_gpu
(
TA
,
TB
,
m
,
n
,
k
,1,
a
,
lda
,
b
,
ldb
,1,
c
,n);

277 
’d
 = 
	`şock
();

278 
	`´štf
("M©rix MuÉliÿtiÚ %dx%d * %dx%d, TA=%d, TB=%d: %làs\n",
m
,
k
,k,
n
, 
TA
, 
TB
, ()(
’d
-
¡¬t
)/
CLOCKS_PER_SEC
);

279 
	`ä“
(
a
);

280 
	`ä“
(
b
);

281 
	`ä“
(
c
);

282 
	}
}

284 
	$time_gpu
(
TA
, 
TB
, 
m
, 
k
, 
n
)

286 
™”
 = 10;

287 *
a
 = 
	`¿ndom_m©rix
(
m
,
k
);

288 *
b
 = 
	`¿ndom_m©rix
(
k
,
n
);

290 
lda
 = (!
TA
)?
k
:
m
;

291 
ldb
 = (!
TB
)?
n
:
k
;

293 *
c
 = 
	`¿ndom_m©rix
(
m
,
n
);

295 *
a_ş
 = 
	`cuda_make_¬¿y
(
a
, 
m
*
k
);

296 *
b_ş
 = 
	`cuda_make_¬¿y
(
b
, 
k
*
n
);

297 *
c_ş
 = 
	`cuda_make_¬¿y
(
c
, 
m
*
n
);

299 
i
;

300 
şock_t
 
¡¬t
 = 
	`şock
(), 
’d
;

301 
i
 = 0; i<
™”
; ++i){

302 
	`gemm_gpu
(
TA
,
TB
,
m
,
n
,
k
,1,
a_ş
,
lda
,
b_ş
,
ldb
,1,
c_ş
,n);

303 
	`cudaTh»adSynchrÚize
();

305 
æİ
 = (()
m
)*
n
*(2.*
k
 + 2.)*
™”
;

306 
gæİ
 = 
æİ
/
	`pow
(10., 9);

307 
’d
 = 
	`şock
();

308 
£cÚds
 = 
	`£c
(
’d
-
¡¬t
);

309 
	`´štf
("M©rix MuÉliÿtiÚ %dx%d * %dx%d, TA=%d, TB=%d: %làs, %làGFLOPS\n",
m
,
k
,k,
n
, 
TA
, 
TB
, 
£cÚds
, 
gæİ
/seconds);

310 
	`cuda_ä“
(
a_ş
);

311 
	`cuda_ä“
(
b_ş
);

312 
	`cuda_ä“
(
c_ş
);

313 
	`ä“
(
a
);

314 
	`ä“
(
b
);

315 
	`ä“
(
c
);

316 
	}
}

319 
	$‹¡_gpu_accu¿cy
(
TA
, 
TB
, 
m
, 
k
, 
n
)

321 
	`¤ªd
(0);

322 *
a
;

323 if(!
TA
è
a
 = 
	`¿ndom_m©rix
(
m
,
k
);

324 
a
 = 
	`¿ndom_m©rix
(
k
,
m
);

325 
lda
 = (!
TA
)?
k
:
m
;

326 *
b
;

327 if(!
TB
è
b
 = 
	`¿ndom_m©rix
(
k
,
n
);

328 
b
 = 
	`¿ndom_m©rix
(
n
,
k
);

329 
ldb
 = (!
TB
)?
n
:
k
;

331 *
c
 = 
	`¿ndom_m©rix
(
m
,
n
);

332 *
c_gpu
 = 
	`¿ndom_m©rix
(
m
,
n
);

333 
	`mem£t
(
c
, 0, 
m
*
n
*());

334 
	`mem£t
(
c_gpu
, 0, 
m
*
n
*());

335 
i
;

337 
	`gemm_gpu
(
TA
,
TB
,
m
,
n
,
k
,1,
a
,
lda
,
b
,
ldb
,1,
c_gpu
,n);

341 
	`gemm_ıu
(
TA
,
TB
,
m
,
n
,
k
,1,
a
,
lda
,
b
,
ldb
,1,
c
,n);

344 
s£
 = 0;

345 
i
 = 0; i < 
m
*
n
; ++i) {

347 
s£
 +ğ
	`pow
(
c
[
i
]-
c_gpu
[i], 2);

349 
	`´štf
("M©rix MuÉliÿtiÚ %dx%d * %dx%d, TA=%d, TB=%d: %g SSE\n",
m
,
k
,k,
n
, 
TA
, 
TB
, 
s£
/(m*n));

350 
	`ä“
(
a
);

351 
	`ä“
(
b
);

352 
	`ä“
(
c
);

353 
	`ä“
(
c_gpu
);

354 
	}
}

356 
	$‹¡_gpu_bÏs
()

383 
	`time_gpu
(0,0,64,75,12544);

384 
	`time_gpu
(0,0,64,75,12544);

385 
	`time_gpu
(0,0,64,75,12544);

386 
	`time_gpu
(0,0,64,576,12544);

387 
	`time_gpu
(0,0,256,2304,784);

388 
	`time_gpu
(1,1,2304,256,784);

389 
	`time_gpu
(0,0,512,4608,196);

390 
	`time_gpu
(1,1,4608,512,196);

393 
	}
}

	@host/src/gemm.h

1 #iâdeà
GEMM_H


2 
	#GEMM_H


	)

4 
gemm_bš
(
M
, 
N
, 
K
, 
ALPHA
,

5 *
A
, 
lda
,

6 *
B
, 
ldb
,

7 *
C
, 
ldc
);

9 
gemm
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

10 *
A
, 
lda
,

11 *
B
, 
ldb
,

12 
BETA
,

13 *
C
, 
ldc
);

14 
gemm_diff
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

15 *
A
, 
lda
,

16 *
B
, 
ldb
,

17 
BETA
,

18 *
C
, 
ldc
);

20 
gemm_ıu
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

21 *
A
, 
lda
,

22 *
B
, 
ldb
,

23 
BETA
,

24 *
C
, 
ldc
);

25 
gemm_ıu_diff
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

26 *
A
, 
lda
,

27 *
B
, 
ldb
,

28 
BETA
,

29 *
C
, 
ldc
);

31 #ifdeà
GPU


32 
gemm_gpu
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

33 *
A_gpu
, 
lda
,

34 *
B_gpu
, 
ldb
,

35 
BETA
,

36 *
C_gpu
, 
ldc
);

38 
gemm_gpu
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

39 *
A
, 
lda
,

40 *
B
, 
ldb
,

41 
BETA
,

42 *
C
, 
ldc
);

	@host/src/gru_layer.c

1 
	~"gru_Ïy”.h
"

2 
	~"cÚÃùed_Ïy”.h
"

3 
	~"uts.h
"

4 
	~"cuda.h
"

5 
	~"bÏs.h
"

6 
	~"gemm.h
"

8 
	~<m©h.h
>

9 
	~<¡dio.h
>

10 
	~<¡dlib.h
>

11 
	~<¡ršg.h
>

13 
	$šüem’t_Ïy”
(
Ïy”
 *
l
, 
¡•s
)

15 
num
 = 
l
->
ouuts
*l->
b©ch
*
¡•s
;

16 
l
->
ouut
 +ğ
num
;

17 
l
->
d–
 +ğ
num
;

18 
l
->
x
 +ğ
num
;

19 
l
->
x_nÜm
 +ğ
num
;

21 #ifdeà
GPU


22 
l
->
ouut_gpu
 +ğ
num
;

23 
l
->
d–_gpu
 +ğ
num
;

24 
l
->
x_gpu
 +ğ
num
;

25 
l
->
x_nÜm_gpu
 +ğ
num
;

27 
	}
}

29 
Ïy”
 
	$make_gru_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
¡•s
, 
b©ch_nÜm®ize
, 
adam
)

31 
	`årštf
(
¡d”r
, "GRU Lay”: %d iÅuts, %d ouuts\n", 
šputs
, 
ouuts
);

32 
b©ch
 = b©ch / 
¡•s
;

33 
Ïy”
 
l
 = {0};

34 
l
.
b©ch
 = batch;

35 
l
.
ty³
 = 
GRU
;

36 
l
.
¡•s
 = steps;

37 
l
.
šputs
 = inputs;

39 
l
.
uz
 = 
	`m®loc
((
Ïy”
));

40 
	`årštf
(
¡d”r
, "\t\t");

41 *(
l
.
uz
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

42 
l
.
uz
->
b©ch
 = batch;

44 
l
.
wz
 = 
	`m®loc
((
Ïy”
));

45 
	`årštf
(
¡d”r
, "\t\t");

46 *(
l
.
wz
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

47 
l
.
wz
->
b©ch
 = batch;

49 
l
.
ur
 = 
	`m®loc
((
Ïy”
));

50 
	`årštf
(
¡d”r
, "\t\t");

51 *(
l
.
ur
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

52 
l
.
ur
->
b©ch
 = batch;

54 
l
.
wr
 = 
	`m®loc
((
Ïy”
));

55 
	`årštf
(
¡d”r
, "\t\t");

56 *(
l
.
wr
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

57 
l
.
wr
->
b©ch
 = batch;

61 
l
.
uh
 = 
	`m®loc
((
Ïy”
));

62 
	`årštf
(
¡d”r
, "\t\t");

63 *(
l
.
uh
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

64 
l
.
uh
->
b©ch
 = batch;

66 
l
.
wh
 = 
	`m®loc
((
Ïy”
));

67 
	`årštf
(
¡d”r
, "\t\t");

68 *(
l
.
wh
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

69 
l
.
wh
->
b©ch
 = batch;

71 
l
.
b©ch_nÜm®ize
 = batch_normalize;

74 
l
.
ouuts
 = outputs;

75 
l
.
ouut
 = 
	`ÿÎoc
(
ouuts
*
b©ch
*
¡•s
, ());

76 
l
.
d–
 = 
	`ÿÎoc
(
ouuts
*
b©ch
*
¡•s
, ());

77 
l
.
¡©e
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

78 
l
.
´ev_¡©e
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

79 
l
.
fÜgÙ_¡©e
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

80 
l
.
fÜgÙ_d–
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

82 
l
.
r_ıu
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

83 
l
.
z_ıu
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

84 
l
.
h_ıu
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

86 
l
.
fÜw¬d
 = 
fÜw¬d_gru_Ïy”
;

87 
l
.
backw¬d
 = 
backw¬d_gru_Ïy”
;

88 
l
.
upd©e
 = 
upd©e_gru_Ïy”
;

90 #ifdeà
GPU


91 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_gru_Ïy”_gpu
;

92 
l
.
backw¬d_gpu
 = 
backw¬d_gru_Ïy”_gpu
;

93 
l
.
upd©e_gpu
 = 
upd©e_gru_Ïy”_gpu
;

95 
l
.
fÜgÙ_¡©e_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

96 
l
.
fÜgÙ_d–_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

97 
l
.
´ev_¡©e_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

98 
l
.
¡©e_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

99 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
*
¡•s
);

100 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
*
¡•s
);

101 
l
.
r_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

102 
l
.
z_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

103 
l
.
h_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

105 #ifdeà
CUDNN


106 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
uz
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.uz->
out_c
,†.uz->
out_h
,†.uz->
out_w
);

107 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
uh
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.uh->
out_c
,†.uh->
out_h
,†.uh->
out_w
);

108 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
ur
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.ur->
out_c
,†.ur->
out_h
,†.ur->
out_w
);

109 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wz
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wz->
out_c
,†.wz->
out_h
,†.wz->
out_w
);

110 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wh
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wh->
out_c
,†.wh->
out_h
,†.wh->
out_w
);

111 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wr
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wr->
out_c
,†.wr->
out_h
,†.wr->
out_w
);

115  
l
;

116 
	}
}

118 
	$upd©e_gru_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

120 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
ur
), 
a
);

121 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
uz
), 
a
);

122 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
uh
), 
a
);

123 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wr
), 
a
);

124 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wz
), 
a
);

125 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wh
), 
a
);

126 
	}
}

128 
	$fÜw¬d_gru_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

130 
ÃtwÜk
 
s
 = 
Ãt
;

131 
s
.
Œaš
 = 
Ãt
.train;

132 
i
;

133 
Ïy”
 
uz
 = *(
l
.uz);

134 
Ïy”
 
ur
 = *(
l
.ur);

135 
Ïy”
 
uh
 = *(
l
.uh);

137 
Ïy”
 
wz
 = *(
l
.wz);

138 
Ïy”
 
wr
 = *(
l
.wr);

139 
Ïy”
 
wh
 = *(
l
.wh);

141 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uz
.
d–
, 1);

142 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ur
.
d–
, 1);

143 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uh
.
d–
, 1);

145 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wz
.
d–
, 1);

146 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wr
.
d–
, 1);

147 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wh
.
d–
, 1);

148 if(
Ãt
.
Œaš
) {

149 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0,†.
d–
, 1);

150 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
¡©e
, 1,†.
´ev_¡©e
, 1);

153 
i
 = 0; i < 
l
.
¡•s
; ++i) {

154 
s
.
šput
 = 
l
.
¡©e
;

155 
	`fÜw¬d_cÚÃùed_Ïy”
(
wz
, 
s
);

156 
	`fÜw¬d_cÚÃùed_Ïy”
(
wr
, 
s
);

158 
s
.
šput
 = 
Ãt
.input;

159 
	`fÜw¬d_cÚÃùed_Ïy”
(
uz
, 
s
);

160 
	`fÜw¬d_cÚÃùed_Ïy”
(
ur
, 
s
);

161 
	`fÜw¬d_cÚÃùed_Ïy”
(
uh
, 
s
);

164 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
uz
.
ouut
, 1,†.
z_ıu
, 1);

165 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
wz
.
ouut
, 1,†.
z_ıu
, 1);

167 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
ur
.
ouut
, 1,†.
r_ıu
, 1);

168 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
wr
.
ouut
, 1,†.
r_ıu
, 1);

170 
	`aùiv©e_¬¿y
(
l
.
z_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

171 
	`aùiv©e_¬¿y
(
l
.
r_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

173 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
¡©e
, 1,†.
fÜgÙ_¡©e
, 1);

174 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
r_ıu
, 1,†.
fÜgÙ_¡©e
, 1);

176 
s
.
šput
 = 
l
.
fÜgÙ_¡©e
;

177 
	`fÜw¬d_cÚÃùed_Ïy”
(
wh
, 
s
);

179 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
uh
.
ouut
, 1,†.
h_ıu
, 1);

180 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
wh
.
ouut
, 1,†.
h_ıu
, 1);

182 if(
l
.
nh
){

183 
	`aùiv©e_¬¿y
(
l
.
h_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
);

185 
	`aùiv©e_¬¿y
(
l
.
h_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

188 
	`weigh‹d_sum_ıu
(
l
.
¡©e
,†.
h_ıu
,†.
z_ıu
,†.
ouuts
*l.
b©ch
,†.
ouut
);

190 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ouut
, 1,†.
¡©e
, 1);

192 
Ãt
.
šput
 +ğ
l
.
šputs
*l.
b©ch
;

193 
l
.
ouut
 +ğl.
ouuts
*l.
b©ch
;

194 
	`šüem’t_Ïy”
(&
uz
, 1);

195 
	`šüem’t_Ïy”
(&
ur
, 1);

196 
	`šüem’t_Ïy”
(&
uh
, 1);

198 
	`šüem’t_Ïy”
(&
wz
, 1);

199 
	`šüem’t_Ïy”
(&
wr
, 1);

200 
	`šüem’t_Ïy”
(&
wh
, 1);

202 
	}
}

204 
	$backw¬d_gru_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

206 
	}
}

208 #ifdeà
GPU


210 
	$puÎ_gru_Ïy”
(
Ïy”
 
l
)

212 
	}
}

214 
	$push_gru_Ïy”
(
Ïy”
 
l
)

216 
	}
}

218 
	$upd©e_gru_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

220 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
ur
), 
a
);

221 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
uz
), 
a
);

222 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
uh
), 
a
);

223 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wr
), 
a
);

224 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wz
), 
a
);

225 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wh
), 
a
);

226 
	}
}

228 
	$fÜw¬d_gru_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

230 
ÃtwÜk
 
s
 = {0};

231 
s
.
Œaš
 = 
Ãt
.train;

232 
i
;

233 
Ïy”
 
uz
 = *(
l
.uz);

234 
Ïy”
 
ur
 = *(
l
.ur);

235 
Ïy”
 
uh
 = *(
l
.uh);

237 
Ïy”
 
wz
 = *(
l
.wz);

238 
Ïy”
 
wr
 = *(
l
.wr);

239 
Ïy”
 
wh
 = *(
l
.wh);

241 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uz
.
d–_gpu
, 1);

242 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ur
.
d–_gpu
, 1);

243 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uh
.
d–_gpu
, 1);

245 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wz
.
d–_gpu
, 1);

246 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wr
.
d–_gpu
, 1);

247 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wh
.
d–_gpu
, 1);

248 if(
Ãt
.
Œaš
) {

249 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0,†.
d–_gpu
, 1);

250 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
¡©e_gpu
, 1,†.
´ev_¡©e_gpu
, 1);

253 
i
 = 0; i < 
l
.
¡•s
; ++i) {

254 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

255 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wz
, 
s
);

256 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wr
, 
s
);

258 
s
.
šput_gpu
 = 
Ãt
.input_gpu;

259 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
uz
, 
s
);

260 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
ur
, 
s
);

261 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
uh
, 
s
);

263 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
uz
.
ouut_gpu
, 1,†.
z_gpu
, 1);

264 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
wz
.
ouut_gpu
, 1,†.
z_gpu
, 1);

266 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
ur
.
ouut_gpu
, 1,†.
r_gpu
, 1);

267 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
wr
.
ouut_gpu
, 1,†.
r_gpu
, 1);

269 
	`aùiv©e_¬¿y_gpu
(
l
.
z_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

270 
	`aùiv©e_¬¿y_gpu
(
l
.
r_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

272 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
¡©e_gpu
, 1,†.
fÜgÙ_¡©e_gpu
, 1);

273 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
r_gpu
, 1,†.
fÜgÙ_¡©e_gpu
, 1);

275 
s
.
šput_gpu
 = 
l
.
fÜgÙ_¡©e_gpu
;

276 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wh
, 
s
);

278 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
uh
.
ouut_gpu
, 1,†.
h_gpu
, 1);

279 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
wh
.
ouut_gpu
, 1,†.
h_gpu
, 1);

281 if(
l
.
nh
){

282 
	`aùiv©e_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

284 
	`aùiv©e_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

287 
	`weigh‹d_sum_gpu
(
l
.
¡©e_gpu
,†.
h_gpu
,†.
z_gpu
,†.
ouuts
*l.
b©ch
,†.
ouut_gpu
);

288 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

290 
Ãt
.
šput_gpu
 +ğ
l
.
šputs
*l.
b©ch
;

291 
l
.
ouut_gpu
 +ğl.
ouuts
*l.
b©ch
;

292 
	`šüem’t_Ïy”
(&
uz
, 1);

293 
	`šüem’t_Ïy”
(&
ur
, 1);

294 
	`šüem’t_Ïy”
(&
uh
, 1);

296 
	`šüem’t_Ïy”
(&
wz
, 1);

297 
	`šüem’t_Ïy”
(&
wr
, 1);

298 
	`šüem’t_Ïy”
(&
wh
, 1);

300 
	}
}

302 
	$backw¬d_gru_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

304 
ÃtwÜk
 
s
 = {0};

305 
s
.
Œaš
 = 
Ãt
.train;

306 
i
;

307 
Ïy”
 
uz
 = *(
l
.uz);

308 
Ïy”
 
ur
 = *(
l
.ur);

309 
Ïy”
 
uh
 = *(
l
.uh);

311 
Ïy”
 
wz
 = *(
l
.wz);

312 
Ïy”
 
wr
 = *(
l
.wr);

313 
Ïy”
 
wh
 = *(
l
.wh);

315 
	`šüem’t_Ïy”
(&
uz
, 
l
.
¡•s
 - 1);

316 
	`šüem’t_Ïy”
(&
ur
, 
l
.
¡•s
 - 1);

317 
	`šüem’t_Ïy”
(&
uh
, 
l
.
¡•s
 - 1);

319 
	`šüem’t_Ïy”
(&
wz
, 
l
.
¡•s
 - 1);

320 
	`šüem’t_Ïy”
(&
wr
, 
l
.
¡•s
 - 1);

321 
	`šüem’t_Ïy”
(&
wh
, 
l
.
¡•s
 - 1);

323 
Ãt
.
šput_gpu
 +ğ
l
.
šputs
*l.
b©ch
*Ö.
¡•s
-1);

324 if(
Ãt
.
d–_gpu
èÃt.d–_gpu +ğ
l
.
šputs
*l.
b©ch
*Ö.
¡•s
-1);

325 
l
.
ouut_gpu
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
-1);

326 
l
.
d–_gpu
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
-1);

327 *
’d_¡©e
 = 
l
.
ouut_gpu
;

328 
i
 = 
l
.
¡•s
-1; i >= 0; --i) {

329 if(
i
 !ğ0è
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
 -†.ouuts*l.b©ch, 1,†.
¡©e_gpu
, 1);

330 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
´ev_¡©e_gpu
, 1,†.
¡©e_gpu
, 1);

331 *
´ev_d–_gpu
 = (
i
 =ğ0è? 0 : 
l
.
d–_gpu
 -†.
ouuts
*l.
b©ch
;

333 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
uz
.
ouut_gpu
, 1,†.
z_gpu
, 1);

334 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
wz
.
ouut_gpu
, 1,†.
z_gpu
, 1);

336 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
ur
.
ouut_gpu
, 1,†.
r_gpu
, 1);

337 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
wr
.
ouut_gpu
, 1,†.
r_gpu
, 1);

339 
	`aùiv©e_¬¿y_gpu
(
l
.
z_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

340 
	`aùiv©e_¬¿y_gpu
(
l
.
r_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

342 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
uh
.
ouut_gpu
, 1,†.
h_gpu
, 1);

343 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
wh
.
ouut_gpu
, 1,†.
h_gpu
, 1);

345 if(
l
.
nh
){

346 
	`aùiv©e_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

348 
	`aùiv©e_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

351 
	`weigh‹d_d–_gpu
(
l
.
¡©e_gpu
,†.
h_gpu
,†.
z_gpu
, 
´ev_d–_gpu
, 
uh
.
d–_gpu
, 
uz
.d–_gpu,†.
ouuts
*l.
b©ch
,†.delta_gpu);

353 if(
l
.
nh
){

354 
	`g¿d›Á_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
, 
uh
.
d–_gpu
);

356 
	`g¿d›Á_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
, 
uh
.
d–_gpu
);

359 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
uh
.
d–_gpu
, 1, 
wh
.delta_gpu, 1);

361 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
¡©e_gpu
, 1,†.
fÜgÙ_¡©e_gpu
, 1);

362 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
r_gpu
, 1,†.
fÜgÙ_¡©e_gpu
, 1);

363 
	`fl_gpu
(
l
.
ouuts
*l.
b©ch
, 0,†.
fÜgÙ_d–_gpu
, 1);

365 
s
.
šput_gpu
 = 
l
.
fÜgÙ_¡©e_gpu
;

366 
s
.
d–_gpu
 = 
l
.
fÜgÙ_d–_gpu
;

368 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wh
, 
s
);

369 if(
´ev_d–_gpu
è
	`muÉ_add_što_gpu
(
l
.
ouuts
*l.
b©ch
,†.
fÜgÙ_d–_gpu
,†.
r_gpu
,…rev_delta_gpu);

370 
	`muÉ_add_što_gpu
(
l
.
ouuts
*l.
b©ch
,†.
fÜgÙ_d–_gpu
,†.
¡©e_gpu
, 
ur
.
d–_gpu
);

372 
	`g¿d›Á_¬¿y_gpu
(
l
.
r_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
, 
ur
.
d–_gpu
);

373 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
ur
.
d–_gpu
, 1, 
wr
.delta_gpu, 1);

375 
	`g¿d›Á_¬¿y_gpu
(
l
.
z_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
, 
uz
.
d–_gpu
);

376 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
uz
.
d–_gpu
, 1, 
wz
.delta_gpu, 1);

378 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

379 
s
.
d–_gpu
 = 
´ev_d–_gpu
;

381 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wr
, 
s
);

382 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wz
, 
s
);

384 
s
.
šput_gpu
 = 
Ãt
.input_gpu;

385 
s
.
d–_gpu
 = 
Ãt
.delta_gpu;

387 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
uh
, 
s
);

388 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
ur
, 
s
);

389 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
uz
, 
s
);

392 
Ãt
.
šput_gpu
 -ğ
l
.
šputs
*l.
b©ch
;

393 if(
Ãt
.
d–_gpu
èÃt.d–_gpu -ğ
l
.
šputs
*l.
b©ch
;

394 
l
.
ouut_gpu
 -ğl.
ouuts
*l.
b©ch
;

395 
l
.
d–_gpu
 -ğl.
ouuts
*l.
b©ch
;

396 
	`šüem’t_Ïy”
(&
uz
, -1);

397 
	`šüem’t_Ïy”
(&
ur
, -1);

398 
	`šüem’t_Ïy”
(&
uh
, -1);

400 
	`šüem’t_Ïy”
(&
wz
, -1);

401 
	`šüem’t_Ïy”
(&
wr
, -1);

402 
	`šüem’t_Ïy”
(&
wh
, -1);

404 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
’d_¡©e
, 1,†.
¡©e_gpu
, 1);

405 
	}
}

	@host/src/gru_layer.h

2 #iâdeà
GRU_LAYER_H


3 
	#GRU_LAYER_H


	)

5 
	~"aùiv©iÚs.h
"

6 
	~"Ïy”.h
"

7 
	~"ÃtwÜk.h
"

9 
Ïy”
 
make_gru_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
¡•s
, 
b©ch_nÜm®ize
, 
adam
);

11 
fÜw¬d_gru_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
);

12 
backw¬d_gru_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
);

13 
upd©e_gru_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

15 #ifdeà
GPU


16 
fÜw¬d_gru_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
);

17 
backw¬d_gru_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
);

18 
upd©e_gru_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

19 
push_gru_Ïy”
(
Ïy”
 
l
);

20 
puÎ_gru_Ïy”
(
Ïy”
 
l
);

	@host/src/im2col.c

1 
	~"im2cŞ.h
"

2 
	~<¡dio.h
>

3 
	$im2cŞ_g‘_pix–
(*
im
, 
height
, 
width
, 
chªÃls
,

4 
row
, 
cŞ
, 
chªÃl
, 
·d
)

6 
row
 -ğ
·d
;

7 
cŞ
 -ğ
·d
;

9 ià(
row
 < 0 || 
cŞ
 < 0 ||

10 
row
 >ğ
height
 || 
cŞ
 >ğ
width
)  0;

11  
im
[
cŞ
 + 
width
*(
row
 + 
height
*
chªÃl
)];

12 
	}
}

16 
	$im2cŞ_ıu
(* 
d©a_im
,

17 
chªÃls
, 
height
, 
width
,

18 
ksize
, 
¡ride
, 
·d
, * 
d©a_cŞ
)

20 
c
,
h
,
w
;

21 
height_cŞ
 = (
height
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

22 
width_cŞ
 = (
width
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

24 
chªÃls_cŞ
 = 
chªÃls
 * 
ksize
 * ksize;

25 
c
 = 0; c < 
chªÃls_cŞ
; ++c) {

26 
w_off£t
 = 
c
 % 
ksize
;

27 
h_off£t
 = (
c
 / 
ksize
) % ksize;

28 
c_im
 = 
c
 / 
ksize
 / ksize;

29 
h
 = 0; h < 
height_cŞ
; ++h) {

30 
w
 = 0; w < 
width_cŞ
; ++w) {

31 
im_row
 = 
h_off£t
 + 
h
 * 
¡ride
;

32 
im_cŞ
 = 
w_off£t
 + 
w
 * 
¡ride
;

33 
cŞ_šdex
 = (
c
 * 
height_cŞ
 + 
h
è* 
width_cŞ
 + 
w
;

34 
d©a_cŞ
[
cŞ_šdex
] = 
	`im2cŞ_g‘_pix–
(
d©a_im
, 
height
, 
width
, 
chªÃls
,

35 
im_row
, 
im_cŞ
, 
c_im
, 
·d
);

39 
	}
}

	@host/src/im2col.h

1 #iâdeà
IM2COL_H


2 
	#IM2COL_H


	)

4 
im2cŞ_ıu
(* 
d©a_im
,

5 
chªÃls
, 
height
, 
width
,

6 
ksize
, 
¡ride
, 
·d
, * 
d©a_cŞ
);

8 #ifdeà
GPU


10 
im2cŞ_gpu
(*
im
,

11 
chªÃls
, 
height
, 
width
,

12 
ksize
, 
¡ride
, 
·d
,*
d©a_cŞ
);

	@host/src/image.c

1 
	~"image.h
"

2 
	~"uts.h
"

3 
	~"bÏs.h
"

4 
	~"cuda.h
"

5 
	~<¡dio.h
>

6 
	~<m©h.h
>

8 
	#STB_IMAGE_IMPLEMENTATION


	)

9 
	~"¡b_image.h
"

10 
	#STB_IMAGE_WRITE_IMPLEMENTATION


	)

11 
	~"¡b_image_wr™e.h
"

13 
	gwšdows
 = 0;

15 
	gcŞÜs
[6][3] = { {1,0,1}, {0,0,1},{0,1,1},{0,1,0},{1,1,0},{1,0,0} };

17 
	$g‘_cŞÜ
(
c
, 
x
, 
max
)

19 
¿tio
 = (()
x
/
max
)*5;

20 
i
 = 
	`æoÜ
(
¿tio
);

21 
j
 = 
	`û
(
¿tio
);

22 
¿tio
 -ğ
i
;

23 
r
 = (1-
¿tio
è* 
cŞÜs
[
i
][
c
] +„©io*cŞÜs[
j
][c];

25  
r
;

26 
	}
}

28 
image
 
	$mask_to_rgb
(
image
 
mask
)

30 
n
 = 
mask
.
c
;

31 
image
 
im
 = 
	`make_image
(
mask
.
w
, mask.
h
, 3);

32 
i
, 
j
;

33 
j
 = 0; j < 
n
; ++j){

34 
off£t
 = 
j
*123457 % 
n
;

35 
»d
 = 
	`g‘_cŞÜ
(2,
off£t
,
n
);

36 
g»’
 = 
	`g‘_cŞÜ
(1,
off£t
,
n
);

37 
blue
 = 
	`g‘_cŞÜ
(0,
off£t
,
n
);

38 
i
 = 0; i < 
im
.
w
*im.
h
; ++i){

39 
im
.
d©a
[
i
 + 0*im.
w
*im.
h
] +ğ
mask
.d©a[
j
*im.h*im.w + i]*
»d
;

40 
im
.
d©a
[
i
 + 1*im.
w
*im.
h
] +ğ
mask
.d©a[
j
*im.h*im.w + i]*
g»’
;

41 
im
.
d©a
[
i
 + 2*im.
w
*im.
h
] +ğ
mask
.d©a[
j
*im.h*im.w + i]*
blue
;

44  
im
;

45 
	}
}

47 
	$g‘_pix–
(
image
 
m
, 
x
, 
y
, 
c
)

49 
	`as£¹
(
x
 < 
m
.
w
 && 
y
 < m.
h
 && 
c
 < m.c);

50  
m
.
d©a
[
c
*m.
h
*m.
w
 + 
y
*m.w + 
x
];

51 
	}
}

52 
	$g‘_pix–_ex‹nd
(
image
 
m
, 
x
, 
y
, 
c
)

54 if(
x
 < 0 || x >ğ
m
.
w
 || 
y
 < 0 || y >ğm.
h
)  0;

61 if(
c
 < 0 || c >ğ
m
.c)  0;

62  
	`g‘_pix–
(
m
, 
x
, 
y
, 
c
);

63 
	}
}

64 
	$£t_pix–
(
image
 
m
, 
x
, 
y
, 
c
, 
v®
)

66 ià(
x
 < 0 || 
y
 < 0 || 
c
 < 0 || x >ğ
m
.
w
 || y >ğm.
h
 || c >= m.c) ;

67 
	`as£¹
(
x
 < 
m
.
w
 && 
y
 < m.
h
 && 
c
 < m.c);

68 
m
.
d©a
[
c
*m.
h
*m.
w
 + 
y
*m.w + 
x
] = 
v®
;

69 
	}
}

70 
	$add_pix–
(
image
 
m
, 
x
, 
y
, 
c
, 
v®
)

72 
	`as£¹
(
x
 < 
m
.
w
 && 
y
 < m.
h
 && 
c
 < m.c);

73 
m
.
d©a
[
c
*m.
h
*m.
w
 + 
y
*m.w + 
x
] +ğ
v®
;

74 
	}
}

76 
	$bš—r_š‹½Ş©e
(
image
 
im
, 
x
, 
y
, 
c
)

78 
ix
 = (è
	`æoÜf
(
x
);

79 
iy
 = (è
	`æoÜf
(
y
);

81 
dx
 = 
x
 - 
ix
;

82 
dy
 = 
y
 - 
iy
;

84 
v®
 = (1-
dy
è* (1-
dx
è* 
	`g‘_pix–_ex‹nd
(
im
, 
ix
, 
iy
, 
c
) +

85 
dy
 * (1-
dx
è* 
	`g‘_pix–_ex‹nd
(
im
, 
ix
, 
iy
+1, 
c
) +

86 (1-
dy
è* 
dx
 * 
	`g‘_pix–_ex‹nd
(
im
, 
ix
+1, 
iy
, 
c
) +

87 
dy
 * 
dx
 * 
	`g‘_pix–_ex‹nd
(
im
, 
ix
+1, 
iy
+1, 
c
);

88  
v®
;

89 
	}
}

92 
	$compos™e_image
(
image
 
sourû
, imag
de¡
, 
dx
, 
dy
)

94 
x
,
y
,
k
;

95 
k
 = 0; k < 
sourû
.
c
; ++k){

96 
y
 = 0; y < 
sourû
.
h
; ++y){

97 
x
 = 0; x < 
sourû
.
w
; ++x){

98 
v®
 = 
	`g‘_pix–
(
sourû
, 
x
, 
y
, 
k
);

99 
v®2
 = 
	`g‘_pix–_ex‹nd
(
de¡
, 
dx
+
x
, 
dy
+
y
, 
k
);

100 
	`£t_pix–
(
de¡
, 
dx
+
x
, 
dy
+
y
, 
k
, 
v®
 * 
v®2
);

104 
	}
}

106 
image
 
	$bÜd”_image
(
image
 
a
, 
bÜd”
)

108 
image
 
b
 = 
	`make_image
(
a
.
w
 + 2*
bÜd”
,‡.
h
 + 2*bÜd”,‡.
c
);

109 
x
,
y
,
k
;

110 
k
 = 0; k < 
b
.
c
; ++k){

111 
y
 = 0; y < 
b
.
h
; ++y){

112 
x
 = 0; x < 
b
.
w
; ++x){

113 
v®
 = 
	`g‘_pix–_ex‹nd
(
a
, 
x
 - 
bÜd”
, 
y
 - bÜd”, 
k
);

114 if(
x
 - 
bÜd”
 < 0 || x - bÜd” >ğ
a
.
w
 || 
y
 - bÜd” < 0 || y - bÜd” >ğa.
h
è
v®
 = 1;

115 
	`£t_pix–
(
b
, 
x
, 
y
, 
k
, 
v®
);

119  
b
;

120 
	}
}

122 
image
 
	$te_images
(
image
 
a
, imag
b
, 
dx
)

124 if(
a
.
w
 =ğ0è 
	`cİy_image
(
b
);

125 
image
 
c
 = 
	`make_image
(
a
.
w
 + 
b
.w + 
dx
, (a.
h
 > b.h) ?‡.h : b.h, (a.c > b.c) ?‡.c : b.c);

126 
	`fl_ıu
(
c
.
w
*c.
h
*c.c, 1, c.
d©a
, 1);

127 
	`embed_image
(
a
, 
c
, 0, 0);

128 
	`compos™e_image
(
b
, 
c
, 
a
.
w
 + 
dx
, 0);

129  
c
;

130 
	}
}

132 
image
 
	$g‘_Ïb–
(
image
 **
ch¬aù”s
, *
¡ršg
, 
size
)

134 
size
 = size/10;

135 if(
size
 > 7) size = 7;

136 
image
 
Ïb–
 = 
	`make_em±y_image
(0,0,0);

137 *
¡ršg
){

138 
image
 
l
 = 
ch¬aù”s
[
size
][()*
¡ršg
];

139 
image
 
n
 = 
	`te_images
(
Ïb–
, 
l
, -
size
 - 1 + (size+1)/2);

140 
	`ä“_image
(
Ïb–
);

141 
Ïb–
 = 
n
;

142 ++
¡ršg
;

144 
image
 
b
 = 
	`bÜd”_image
(
Ïb–
,†ab–.
h
*.25);

145 
	`ä“_image
(
Ïb–
);

146  
b
;

147 
	}
}

149 
	$d¿w_Ïb–
(
image
 
a
, 
r
, 
c
, imag
Ïb–
, cÚ¡ *
rgb
)

151 
w
 = 
Ïb–
.w;

152 
h
 = 
Ïb–
.h;

153 ià(
r
 - 
h
 >= 0)„ =„ - h;

155 
i
, 
j
, 
k
;

156 
j
 = 0; j < 
h
 && j + 
r
 < 
a
.h; ++j){

157 
i
 = 0; i < 
w
 && i + 
c
 < 
a
.w; ++i){

158 
k
 = 0; k < 
Ïb–
.
c
; ++k){

159 
v®
 = 
	`g‘_pix–
(
Ïb–
, 
i
, 
j
, 
k
);

160 
	`£t_pix–
(
a
, 
i
+
c
, 
j
+
r
, 
k
, 
rgb
[k] * 
v®
);

164 
	}
}

166 
	$d¿w_box
(
image
 
a
, 
x1
, 
y1
, 
x2
, 
y2
, 
r
, 
g
, 
b
)

169 
i
;

170 if(
x1
 < 0) x1 = 0;

171 if(
x1
 >ğ
a
.
w
) x1 =‡.w-1;

172 if(
x2
 < 0) x2 = 0;

173 if(
x2
 >ğ
a
.
w
) x2 =‡.w-1;

175 if(
y1
 < 0) y1 = 0;

176 if(
y1
 >ğ
a
.
h
) y1 =‡.h-1;

177 if(
y2
 < 0) y2 = 0;

178 if(
y2
 >ğ
a
.
h
) y2 =‡.h-1;

180 
i
 = 
x1
; i <ğ
x2
; ++i){

181 
a
.
d©a
[
i
 + 
y1
*a.
w
 + 0*a.w*a.
h
] = 
r
;

182 
a
.
d©a
[
i
 + 
y2
*a.
w
 + 0*a.w*a.
h
] = 
r
;

184 
a
.
d©a
[
i
 + 
y1
*a.
w
 + 1*a.w*a.
h
] = 
g
;

185 
a
.
d©a
[
i
 + 
y2
*a.
w
 + 1*a.w*a.
h
] = 
g
;

187 
a
.
d©a
[
i
 + 
y1
*a.
w
 + 2*a.w*a.
h
] = 
b
;

188 
a
.
d©a
[
i
 + 
y2
*a.
w
 + 2*a.w*a.
h
] = 
b
;

190 
i
 = 
y1
; i <ğ
y2
; ++i){

191 
a
.
d©a
[
x1
 + 
i
*a.
w
 + 0*a.w*a.
h
] = 
r
;

192 
a
.
d©a
[
x2
 + 
i
*a.
w
 + 0*a.w*a.
h
] = 
r
;

194 
a
.
d©a
[
x1
 + 
i
*a.
w
 + 1*a.w*a.
h
] = 
g
;

195 
a
.
d©a
[
x2
 + 
i
*a.
w
 + 1*a.w*a.
h
] = 
g
;

197 
a
.
d©a
[
x1
 + 
i
*a.
w
 + 2*a.w*a.
h
] = 
b
;

198 
a
.
d©a
[
x2
 + 
i
*a.
w
 + 2*a.w*a.
h
] = 
b
;

200 
	}
}

202 
	$d¿w_box_width
(
image
 
a
, 
x1
, 
y1
, 
x2
, 
y2
, 
w
, 
r
, 
g
, 
b
)

204 
i
;

205 
i
 = 0; i < 
w
; ++i){

206 
	`d¿w_box
(
a
, 
x1
+
i
, 
y1
+i, 
x2
-i, 
y2
-i, 
r
, 
g
, 
b
);

208 
	}
}

210 
	$d¿w_bbox
(
image
 
a
, 
box
 
bbox
, 
w
, 
r
, 
g
, 
b
)

212 
Ëá
 = (
bbox
.
x
-bbox.
w
/2)*
a
.w;

213 
right
 = (
bbox
.
x
+bbox.
w
/2)*
a
.w;

214 
tİ
 = (
bbox
.
y
-bbox.
h
/2)*
a
.h;

215 
bÙ
 = (
bbox
.
y
+bbox.
h
/2)*
a
.h;

217 
i
;

218 
i
 = 0; i < 
w
; ++i){

219 
	`d¿w_box
(
a
, 
Ëá
+
i
, 
tİ
+i, 
right
-i, 
bÙ
-i, 
r
, 
g
, 
b
);

221 
	}
}

223 
image
 **
	$lßd_®phab‘
()

225 
i
, 
j
;

226 cÚ¡ 
nsize
 = 8;

227 
image
 **
®phab‘s
 = 
	`ÿÎoc
(
nsize
, (image));

228 
j
 = 0; j < 
nsize
; ++j){

229 
®phab‘s
[
j
] = 
	`ÿÎoc
(128, (
image
));

230 
i
 = 32; i < 127; ++i){

231 
buff
[256];

232 
	`¥rštf
(
buff
, "d©a/Ïb–s/%d_%d.²g", 
i
, 
j
);

233 
®phab‘s
[
j
][
i
] = 
	`lßd_image_cŞÜ
(
buff
, 0, 0);

236  
®phab‘s
;

237 
	}
}

239 
	$d¿w_d‘eùiÚs
(
image
 
im
, 
d‘eùiÚ
 *
d‘s
, 
num
, 
th»sh
, **
Çmes
, imag**
®phab‘
, 
şas£s
)

241 
i
,
j
;

243 
i
 = 0; i < 
num
; ++i){

244 
Ïb–¡r
[4096] = {0};

245 
şass
 = -1;

246 
j
 = 0; j < 
şas£s
; ++j){

247 ià(
d‘s
[
i
].
´ob
[
j
] > 
th»sh
){

248 ià(
şass
 < 0) {

249 
	`¡rÿt
(
Ïb–¡r
, 
Çmes
[
j
]);

250 
şass
 = 
j
;

252 
	`¡rÿt
(
Ïb–¡r
, ", ");

253 
	`¡rÿt
(
Ïb–¡r
, 
Çmes
[
j
]);

255 
	`´štf
("%s: %.0f%%\n", 
Çmes
[
j
], 
d‘s
[
i
].
´ob
[j]*100);

258 if(
şass
 >= 0){

259 
width
 = 
im
.
h
 * .006;

269 
off£t
 = 
şass
*123457 % 
şas£s
;

270 
»d
 = 
	`g‘_cŞÜ
(2,
off£t
,
şas£s
);

271 
g»’
 = 
	`g‘_cŞÜ
(1,
off£t
,
şas£s
);

272 
blue
 = 
	`g‘_cŞÜ
(0,
off£t
,
şas£s
);

273 
rgb
[3];

277 
rgb
[0] = 
»d
;

278 
rgb
[1] = 
g»’
;

279 
rgb
[2] = 
blue
;

280 
box
 
b
 = 
d‘s
[
i
].
bbox
;

283 
Ëá
 = (
b
.
x
-b.
w
/2.)*
im
.w;

284 
right
 = (
b
.
x
+b.
w
/2.)*
im
.w;

285 
tİ
 = (
b
.
y
-b.
h
/2.)*
im
.h;

286 
bÙ
 = (
b
.
y
+b.
h
/2.)*
im
.h;

288 if(
Ëá
 < 0)†eft = 0;

289 if(
right
 > 
im
.
w
-1)„ight = im.w-1;

290 if(
tİ
 < 0)op = 0;

291 if(
bÙ
 > 
im
.
h
-1) bot = im.h-1;

293 
	`d¿w_box_width
(
im
, 
Ëá
, 
tİ
, 
right
, 
bÙ
, 
width
, 
»d
, 
g»’
, 
blue
);

294 ià(
®phab‘
) {

295 
image
 
Ïb–
 = 
	`g‘_Ïb–
(
®phab‘
, 
Ïb–¡r
, (
im
.
h
*.03));

296 
	`d¿w_Ïb–
(
im
, 
tİ
 + 
width
, 
Ëá
, 
Ïb–
, 
rgb
);

297 
	`ä“_image
(
Ïb–
);

299 ià(
d‘s
[
i
].
mask
){

300 
image
 
mask
 = 
	`æßt_to_image
(14, 14, 1, 
d‘s
[
i
].mask);

301 
image
 
»sized_mask
 = 
	`»size_image
(
mask
, 
b
.
w
*
im
.w, b.
h
*im.h);

302 
image
 
tmask
 = 
	`th»shŞd_image
(
»sized_mask
, .5);

303 
	`embed_image
(
tmask
, 
im
, 
Ëá
, 
tİ
);

304 
	`ä“_image
(
mask
);

305 
	`ä“_image
(
»sized_mask
);

306 
	`ä“_image
(
tmask
);

310 
	}
}

312 
	$Œª¥o£_image
(
image
 
im
)

314 
	`as£¹
(
im
.
w
 =ğim.
h
);

315 
n
, 
m
;

316 
c
;

317 
c
 = 0; c < 
im
.c; ++c){

318 
n
 = 0;‚ < 
im
.
w
-1; ++n){

319 
m
 = 
n
 + 1; m < 
im
.
w
; ++m){

320 
sw­
 = 
im
.
d©a
[
m
 + im.
w
*(
n
 + im.
h
*
c
)];

321 
im
.
d©a
[
m
 + im.
w
*(
n
 + im.
h
*
c
)] = im.data[n + im.w*(m + im.h*c)];

322 
im
.
d©a
[
n
 + im.
w
*(
m
 + im.
h
*
c
)] = 
sw­
;

326 
	}
}

328 
	$rÙ©e_image_cw
(
image
 
im
, 
times
)

330 
	`as£¹
(
im
.
w
 =ğim.
h
);

331 
times
 = (times + 400) % 4;

332 
i
, 
x
, 
y
, 
c
;

333 
n
 = 
im
.
w
;

334 
i
 = 0; i < 
times
; ++i){

335 
c
 = 0; c < 
im
.c; ++c){

336 
x
 = 0; x < 
n
/2; ++x){

337 
y
 = 0; y < (
n
-1)/2 + 1; ++y){

338 
‹mp
 = 
im
.
d©a
[
y
 + im.
w
*(
x
 + im.
h
*
c
)];

339 
im
.
d©a
[
y
 + im.
w
*(
x
 + im.
h
*
c
)] = im.d©a[
n
-1-x + im.w*(y + im.h*c)];

340 
im
.
d©a
[
n
-1-
x
 + im.
w
*(
y
 + im.
h
*
c
)] = im.data[n-1-y + im.w*(n-1-x + im.h*c)];

341 
im
.
d©a
[
n
-1-
y
 + im.
w
*Ò-1-
x
 + im.
h
*
c
)] = im.data[x + im.w*(n-1-y + im.h*c)];

342 
im
.
d©a
[
x
 + im.
w
*(
n
-1-
y
 + im.
h
*
c
)] = 
‹mp
;

347 
	}
}

349 
	$æ_image
(
image
 
a
)

351 
i
,
j
,
k
;

352 
k
 = 0; k < 
a
.
c
; ++k){

353 
i
 = 0; i < 
a
.
h
; ++i){

354 
j
 = 0; j < 
a
.
w
/2; ++j){

355 
šdex
 = 
j
 + 
a
.
w
*(
i
 +‡.
h
*(
k
));

356 
æ
 = (
a
.
w
 - 
j
 - 1è+‡.w*(
i
 +‡.
h
*(
k
));

357 
sw­
 = 
a
.
d©a
[
æ
];

358 
a
.
d©a
[
æ
] =‡.d©a[
šdex
];

359 
a
.
d©a
[
šdex
] = 
sw­
;

363 
	}
}

365 
image
 
	$image_di¡ªû
(
image
 
a
, imag
b
)

367 
i
,
j
;

368 
image
 
di¡
 = 
	`make_image
(
a
.
w
,‡.
h
, 1);

369 
i
 = 0; i < 
a
.
c
; ++i){

370 
j
 = 0; j < 
a
.
h
*a.
w
; ++j){

371 
di¡
.
d©a
[
j
] +ğ
	`pow
(
a
.d©a[
i
*a.
h
*a.
w
+j]-
b
.data[i*a.h*a.w+j],2);

374 
j
 = 0; j < 
a
.
h
*a.
w
; ++j){

375 
di¡
.
d©a
[
j
] = 
	`sq¹
(dist.data[j]);

377  
di¡
;

378 
	}
}

380 
	$gho¡_image
(
image
 
sourû
, imag
de¡
, 
dx
, 
dy
)

382 
x
,
y
,
k
;

383 
max_di¡
 = 
	`sq¹
((-
sourû
.
w
/2. + .5)*(-source.w/2. + .5));

384 
k
 = 0; k < 
sourû
.
c
; ++k){

385 
y
 = 0; y < 
sourû
.
h
; ++y){

386 
x
 = 0; x < 
sourû
.
w
; ++x){

387 
di¡
 = 
	`sq¹
((
x
 - 
sourû
.
w
/2. + .5)*(x - sourû.w/2. + .5è+ (
y
 - sourû.
h
/2. + .5)*(y - source.h/2. + .5));

388 
®pha
 = (1 - 
di¡
/
max_di¡
);

389 if(
®pha
 < 0)‡lpha = 0;

390 
v1
 = 
	`g‘_pix–
(
sourû
, 
x
,
y
,
k
);

391 
v2
 = 
	`g‘_pix–
(
de¡
, 
dx
+
x
,
dy
+
y
,
k
);

392 
v®
 = 
®pha
*
v1
 + (1-®pha)*
v2
;

393 
	`£t_pix–
(
de¡
, 
dx
+
x
, 
dy
+
y
, 
k
, 
v®
);

397 
	}
}

399 
	$blocky_image
(
image
 
im
, 
s
)

401 
i
,
j
,
k
;

402 
k
 = 0; k < 
im
.
c
; ++k){

403 
j
 = 0; j < 
im
.
h
; ++j){

404 
i
 = 0; i < 
im
.
w
; ++i){

405 
im
.
d©a
[
i
 + im.
w
*(
j
 + im.
h
*
k
)] = im.d©a[i/
s
*s + im.w*(j/s*s + im.h*k)];

409 
	}
}

411 
	$ûnsÜ_image
(
image
 
im
, 
dx
, 
dy
, 
w
, 
h
)

413 
i
,
j
,
k
;

414 
s
 = 32;

415 if(
dx
 < 0) dx = 0;

416 if(
dy
 < 0) dy = 0;

418 
k
 = 0; k < 
im
.
c
; ++k){

419 
j
 = 
dy
; j < dy + 
h
 && j < 
im
.h; ++j){

420 
i
 = 
dx
; i < dx + 
w
 && i < 
im
.w; ++i){

421 
im
.
d©a
[
i
 + im.
w
*(
j
 + im.
h
*
k
)] = im.d©a[i/
s
*s + im.w*(j/s*s + im.h*k)];

426 
	}
}

428 
	$embed_image
(
image
 
sourû
, imag
de¡
, 
dx
, 
dy
)

430 
x
,
y
,
k
;

431 
k
 = 0; k < 
sourû
.
c
; ++k){

432 
y
 = 0; y < 
sourû
.
h
; ++y){

433 
x
 = 0; x < 
sourû
.
w
; ++x){

434 
v®
 = 
	`g‘_pix–
(
sourû
, 
x
,
y
,
k
);

435 
	`£t_pix–
(
de¡
, 
dx
+
x
, 
dy
+
y
, 
k
, 
v®
);

439 
	}
}

441 
image
 
	$cŞÏp£_image_Ïy”s
(
image
 
sourû
, 
bÜd”
)

443 
h
 = 
sourû
.h;

444 
h
 = (h+
bÜd”
)*
sourû
.
c
 - border;

445 
image
 
de¡
 = 
	`make_image
(
sourû
.
w
, 
h
, 1);

446 
i
;

447 
i
 = 0; i < 
sourû
.
c
; ++i){

448 
image
 
Ïy”
 = 
	`g‘_image_Ïy”
(
sourû
, 
i
);

449 
h_off£t
 = 
i
*(
sourû
.
h
+
bÜd”
);

450 
	`embed_image
(
Ïy”
, 
de¡
, 0, 
h_off£t
);

451 
	`ä“_image
(
Ïy”
);

453  
de¡
;

454 
	}
}

456 
	$cÚ¡¿š_image
(
image
 
im
)

458 
i
;

459 
i
 = 0; i < 
im
.
w
*im.
h
*im.
c
; ++i){

460 if(
im
.
d©a
[
i
] < 0) im.data[i] = 0;

461 if(
im
.
d©a
[
i
] > 1) im.data[i] = 1;

463 
	}
}

465 
	$nÜm®ize_image
(
image
 
p
)

467 
i
;

468 
mš
 = 9999999;

469 
max
 = -999999;

471 
i
 = 0; i < 
p
.
h
*p.
w
*p.
c
; ++i){

472 
v
 = 
p
.
d©a
[
i
];

473 if(
v
 < 
mš
) min = v;

474 if(
v
 > 
max
) max = v;

476 if(
max
 - 
mš
 < .000000001){

477 
mš
 = 0;

478 
max
 = 1;

480 
i
 = 0; i < 
p
.
c
*p.
w
*p.
h
; ++i){

481 
p
.
d©a
[
i
] = (p.d©a[i] - 
mš
)/(
max
-min);

483 
	}
}

485 
	$nÜm®ize_image2
(
image
 
p
)

487 *
mš
 = 
	`ÿÎoc
(
p
.
c
, ());

488 *
max
 = 
	`ÿÎoc
(
p
.
c
, ());

489 
i
,
j
;

490 
i
 = 0; i < 
p
.
c
; ++iè
mš
[i] = 
max
[i] =….
d©a
[i*p.
h
*p.
w
];

492 
j
 = 0; j < 
p
.
c
; ++j){

493 
i
 = 0; i < 
p
.
h
*p.
w
; ++i){

494 
v
 = 
p
.
d©a
[
i
+
j
*p.
h
*p.
w
];

495 if(
v
 < 
mš
[
j
]) min[j] = v;

496 if(
v
 > 
max
[
j
]) max[j] = v;

499 
i
 = 0; i < 
p
.
c
; ++i){

500 if(
max
[
i
] - 
mš
[i] < .000000001){

501 
mš
[
i
] = 0;

502 
max
[
i
] = 1;

505 
j
 = 0; j < 
p
.
c
; ++j){

506 
i
 = 0; i < 
p
.
w
*p.
h
; ++i){

507 
p
.
d©a
[
i
+
j
*p.
h
*p.
w
] = (p.d©a[i+j*p.h*p.w] - 
mš
[j])/(
max
[j]-min[j]);

510 
	`ä“
(
mš
);

511 
	`ä“
(
max
);

512 
	}
}

514 
	$cİy_image_što
(
image
 
¤c
, imag
de¡
)

516 
	`memıy
(
de¡
.
d©a
, 
¤c
.d©a, src.
h
*¤c.
w
*¤c.
c
*());

517 
	}
}

519 
image
 
	$cİy_image
(
image
 
p
)

521 
image
 
cİy
 = 
p
;

522 
cİy
.
d©a
 = 
	`ÿÎoc
(
p
.
h
*p.
w
*p.
c
, ());

523 
	`memıy
(
cİy
.
d©a
, 
p
.d©a,….
h
*p.
w
*p.
c
*());

524  
cİy
;

525 
	}
}

527 
	$rgbgr_image
(
image
 
im
)

529 
i
;

530 
i
 = 0; i < 
im
.
w
*im.
h
; ++i){

531 
sw­
 = 
im
.
d©a
[
i
];

532 
im
.
d©a
[
i
] = im.d©a[i+im.
w
*im.
h
*2];

533 
im
.
d©a
[
i
+im.
w
*im.
h
*2] = 
sw­
;

535 
	}
}

537 
	$show_image
(
image
 
p
, cÚ¡ *
Çme
, 
ms
)

539 #ifdeà
OPENCV


540 
c
 = 
	`show_image_cv
(
p
, 
Çme
, 
ms
);

541  
c
;

543 
	`årštf
(
¡d”r
, "NÙ comped w™h O³nCV, savšgØ%s.²g in¡—d\n", 
Çme
);

544 
	`§ve_image
(
p
, 
Çme
);

547 
	}
}

549 
	$§ve_image_İtiÚs
(
image
 
im
, cÚ¡ *
Çme
, 
IMTYPE
 
f
, 
qu®™y
)

551 
buff
[256];

553 if(
f
 =ğ
PNG
è
	`¥rštf
(
buff
, "%s.²g", 
Çme
);

554 ià(
f
 =ğ
BMP
è
	`¥rštf
(
buff
, "%s.bmp", 
Çme
);

555 ià(
f
 =ğ
TGA
è
	`¥rštf
(
buff
, "%s.tga", 
Çme
);

556 ià(
f
 =ğ
JPG
è
	`¥rštf
(
buff
, "%s.jpg", 
Çme
);

557 
	`¥rštf
(
buff
, "%s.²g", 
Çme
);

558 *
d©a
 = 
	`ÿÎoc
(
im
.
w
*im.
h
*im.
c
, ());

559 
i
,
k
;

560 
k
 = 0; k < 
im
.
c
; ++k){

561 
i
 = 0; i < 
im
.
w
*im.
h
; ++i){

562 
d©a
[
i
*
im
.
c
+
k
] = (è(255*im.d©a[˜+ k*im.
w
*im.
h
]);

565 
sucûss
 = 0;

566 if(
f
 =ğ
PNG
è
sucûss
 = 
	`¡bi_wr™e_²g
(
buff
, 
im
.
w
, im.
h
, im.
c
, 
d©a
, im.w*im.c);

567 ià(
f
 =ğ
BMP
è
sucûss
 = 
	`¡bi_wr™e_bmp
(
buff
, 
im
.
w
, im.
h
, im.
c
, 
d©a
);

568 ià(
f
 =ğ
TGA
è
sucûss
 = 
	`¡bi_wr™e_tga
(
buff
, 
im
.
w
, im.
h
, im.
c
, 
d©a
);

569 ià(
f
 =ğ
JPG
è
sucûss
 = 
	`¡bi_wr™e_jpg
(
buff
, 
im
.
w
, im.
h
, im.
c
, 
d©a
, 
qu®™y
);

570 
	`ä“
(
d©a
);

571 if(!
sucûss
è
	`årštf
(
¡d”r
, "FaedØwr™imag%s\n", 
buff
);

572 
	}
}

574 
	$§ve_image
(
image
 
im
, cÚ¡ *
Çme
)

576 
	`§ve_image_İtiÚs
(
im
, 
Çme
, 
JPG
, 80);

577 
	}
}

579 
	$show_image_Ïy”s
(
image
 
p
, *
Çme
)

581 
i
;

582 
buff
[256];

583 
i
 = 0; i < 
p
.
c
; ++i){

584 
	`¥rštf
(
buff
, "% - Lay” %d", 
Çme
, 
i
);

585 
image
 
Ïy”
 = 
	`g‘_image_Ïy”
(
p
, 
i
);

586 
	`show_image
(
Ïy”
, 
buff
, 1);

587 
	`ä“_image
(
Ïy”
);

589 
	}
}

591 
	$show_image_cŞÏp£d
(
image
 
p
, *
Çme
)

593 
image
 
c
 = 
	`cŞÏp£_image_Ïy”s
(
p
, 1);

594 
	`show_image
(
c
, 
Çme
, 1);

595 
	`ä“_image
(
c
);

596 
	}
}

598 
image
 
	$make_em±y_image
(
w
, 
h
, 
c
)

600 
image
 
out
;

601 
out
.
d©a
 = 0;

602 
out
.
h
 = h;

603 
out
.
w
 = w;

604 
out
.
c
 = c;

605  
out
;

606 
	}
}

608 
image
 
	$make_image
(
w
, 
h
, 
c
)

610 
image
 
out
 = 
	`make_em±y_image
(
w
,
h
,
c
);

611 
out
.
d©a
 = 
	`ÿÎoc
(
h
*
w
*
c
, ());

612  
out
;

613 
	}
}

615 
image
 
	$make_¿ndom_image
(
w
, 
h
, 
c
)

617 
image
 
out
 = 
	`make_em±y_image
(
w
,
h
,
c
);

618 
out
.
d©a
 = 
	`ÿÎoc
(
h
*
w
*
c
, ());

619 
i
;

620 
i
 = 0; i < 
w
*
h
*
c
; ++i){

621 
out
.
d©a
[
i
] = (
	`¿nd_nÜm®
() * .25) + .5;

623  
out
;

624 
	}
}

626 
image
 
	$æßt_to_image
(
w
, 
h
, 
c
, *
d©a
)

628 
image
 
out
 = 
	`make_em±y_image
(
w
,
h
,
c
);

629 
out
.
d©a
 = data;

630  
out
;

631 
	}
}

633 
	$¶aû_image
(
image
 
im
, 
w
, 
h
, 
dx
, 
dy
, imag
ÿnvas
)

635 
x
, 
y
, 
c
;

636 
c
 = 0; c < 
im
.c; ++c){

637 
y
 = 0; y < 
h
; ++y){

638 
x
 = 0; x < 
w
; ++x){

639 
rx
 = (()
x
 / 
w
è* 
im
.w;

640 
ry
 = (()
y
 / 
h
è* 
im
.h;

641 
v®
 = 
	`bš—r_š‹½Ş©e
(
im
, 
rx
, 
ry
, 
c
);

642 
	`£t_pix–
(
ÿnvas
, 
x
 + 
dx
, 
y
 + 
dy
, 
c
, 
v®
);

646 
	}
}

648 
image
 
	$ûÁ”_üİ_image
(
image
 
im
, 
w
, 
h
)

650 
m
 = (
im
.
w
 < im.
h
) ? im.w : im.h;

651 
image
 
c
 = 
	`üİ_image
(
im
, (im.
w
 - 
m
è/ 2, (im.
h
 - m)/2, m, m);

652 
image
 
r
 = 
	`»size_image
(
c
, 
w
, 
h
);

653 
	`ä“_image
(
c
);

654  
r
;

655 
	}
}

657 
image
 
	$rÙ©e_üİ_image
(
image
 
im
, 
¿d
, 
s
, 
w
, 
h
, 
dx
, 
dy
, 
a¥eù
)

659 
x
, 
y
, 
c
;

660 
cx
 = 
im
.
w
/2.;

661 
cy
 = 
im
.
h
/2.;

662 
image
 
rÙ
 = 
	`make_image
(
w
, 
h
, 
im
.
c
);

663 
c
 = 0; c < 
im
.c; ++c){

664 
y
 = 0; y < 
h
; ++y){

665 
x
 = 0; x < 
w
; ++x){

666 
rx
 = 
	`cos
(
¿d
)*((
x
 - 
w
/2.)/
s
*
a¥eù
 + 
dx
/s*a¥eùè- 
	`sš
Ôad)*((
y
 - 
h
/2.)/ + 
dy
/sè+ 
cx
;

667 
ry
 = 
	`sš
(
¿d
)*((
x
 - 
w
/2.)/
s
*
a¥eù
 + 
dx
/s*a¥eùè+ 
	`cos
Ôad)*((
y
 - 
h
/2.)/ + 
dy
/sè+ 
cy
;

668 
v®
 = 
	`bš—r_š‹½Ş©e
(
im
, 
rx
, 
ry
, 
c
);

669 
	`£t_pix–
(
rÙ
, 
x
, 
y
, 
c
, 
v®
);

673  
rÙ
;

674 
	}
}

676 
image
 
	$rÙ©e_image
(
image
 
im
, 
¿d
)

678 
x
, 
y
, 
c
;

679 
cx
 = 
im
.
w
/2.;

680 
cy
 = 
im
.
h
/2.;

681 
image
 
rÙ
 = 
	`make_image
(
im
.
w
, im.
h
, im.
c
);

682 
c
 = 0; c < 
im
.c; ++c){

683 
y
 = 0; y < 
im
.
h
; ++y){

684 
x
 = 0; x < 
im
.
w
; ++x){

685 
rx
 = 
	`cos
(
¿d
)*(
x
-
cx
è- 
	`sš
Ôad)*(
y
-
cy
) + cx;

686 
ry
 = 
	`sš
(
¿d
)*(
x
-
cx
è+ 
	`cos
Ôad)*(
y
-
cy
) + cy;

687 
v®
 = 
	`bš—r_š‹½Ş©e
(
im
, 
rx
, 
ry
, 
c
);

688 
	`£t_pix–
(
rÙ
, 
x
, 
y
, 
c
, 
v®
);

692  
rÙ
;

693 
	}
}

695 
	$fl_image
(
image
 
m
, 
s
)

697 
i
;

698 
i
 = 0; i < 
m
.
h
*m.
w
*m.
c
; ++ièm.
d©a
[i] = 
s
;

699 
	}
}

701 
	$Œª¦©e_image
(
image
 
m
, 
s
)

703 
i
;

704 
i
 = 0; i < 
m
.
h
*m.
w
*m.
c
; ++ièm.
d©a
[i] +ğ
s
;

705 
	}
}

707 
	$sÿË_image
(
image
 
m
, 
s
)

709 
i
;

710 
i
 = 0; i < 
m
.
h
*m.
w
*m.
c
; ++ièm.
d©a
[i] *ğ
s
;

711 
	}
}

713 
image
 
	$üİ_image
(
image
 
im
, 
dx
, 
dy
, 
w
, 
h
)

715 
image
 
üİ³d
 = 
	`make_image
(
w
, 
h
, 
im
.
c
);

716 
i
, 
j
, 
k
;

717 
k
 = 0; k < 
im
.
c
; ++k){

718 
j
 = 0; j < 
h
; ++j){

719 
i
 = 0; i < 
w
; ++i){

720 
r
 = 
j
 + 
dy
;

721 
c
 = 
i
 + 
dx
;

722 
v®
 = 0;

723 
r
 = 
	`cÚ¡¿š_št
Ô, 0, 
im
.
h
-1);

724 
c
 = 
	`cÚ¡¿š_št
(c, 0, 
im
.
w
-1);

725 
v®
 = 
	`g‘_pix–
(
im
, 
c
, 
r
, 
k
);

726 
	`£t_pix–
(
üİ³d
, 
i
, 
j
, 
k
, 
v®
);

730  
üİ³d
;

731 
	}
}

733 
	$be¡_3d_shiá_r
(
image
 
a
, imag
b
, 
mš
, 
max
)

735 if(
mš
 =ğ
max
)  min;

736 
mid
 = 
	`æoÜ
((
mš
 + 
max
) / 2.);

737 
image
 
c1
 = 
	`üİ_image
(
b
, 0, 
mid
, b.
w
, b.
h
);

738 
image
 
c2
 = 
	`üİ_image
(
b
, 0, 
mid
+1, b.
w
, b.
h
);

739 
d1
 = 
	`di¡_¬¿y
(
c1
.
d©a
, 
a
.d©a,‡.
w
*a.
h
*a.
c
, 10);

740 
d2
 = 
	`di¡_¬¿y
(
c2
.
d©a
, 
a
.d©a,‡.
w
*a.
h
*a.
c
, 10);

741 
	`ä“_image
(
c1
);

742 
	`ä“_image
(
c2
);

743 if(
d1
 < 
d2
è 
	`be¡_3d_shiá_r
(
a
, 
b
, 
mš
, 
mid
);

744  
	`be¡_3d_shiá_r
(
a
, 
b
, 
mid
+1, 
max
);

745 
	}
}

747 
	$be¡_3d_shiá
(
image
 
a
, imag
b
, 
mš
, 
max
)

749 
i
;

750 
be¡
 = 0;

751 
be¡_di¡ªû
 = 
FLT_MAX
;

752 
i
 = 
mš
; i <ğ
max
; i += 2){

753 
image
 
c
 = 
	`üİ_image
(
b
, 0, 
i
, b.
w
, b.
h
);

754 
d
 = 
	`di¡_¬¿y
(
c
.
d©a
, 
a
.d©a,‡.
w
*a.
h
*a.c, 100);

755 if(
d
 < 
be¡_di¡ªû
){

756 
be¡_di¡ªû
 = 
d
;

757 
be¡
 = 
i
;

759 
	`´štf
("%d %f\n", 
i
, 
d
);

760 
	`ä“_image
(
c
);

762  
be¡
;

763 
	}
}

765 
	$compos™e_3d
(*
f1
, *
f2
, *
out
, 
d–
)

767 if(!
out
) out = "out";

768 
image
 
a
 = 
	`lßd_image
(
f1
, 0,0,0);

769 
image
 
b
 = 
	`lßd_image
(
f2
, 0,0,0);

770 
shiá
 = 
	`be¡_3d_shiá_r
(
a
, 
b
, -a.
h
/100,‡.h/100);

772 
image
 
c1
 = 
	`üİ_image
(
b
, 10, 
shiá
, b.
w
, b.
h
);

773 
d1
 = 
	`di¡_¬¿y
(
c1
.
d©a
, 
a
.d©a,‡.
w
*a.
h
*a.
c
, 100);

774 
image
 
c2
 = 
	`üİ_image
(
b
, -10, 
shiá
, b.
w
, b.
h
);

775 
d2
 = 
	`di¡_¬¿y
(
c2
.
d©a
, 
a
.d©a,‡.
w
*a.
h
*a.
c
, 100);

777 if(
d2
 < 
d1
 && 0){

778 
image
 
sw­
 = 
a
;

779 
a
 = 
b
;

780 
b
 = 
sw­
;

781 
shiá
 = -shift;

782 
	`´štf
("sw­³d, %d\n", 
shiá
);

785 
	`´štf
("%d\n", 
shiá
);

788 
image
 
c
 = 
	`üİ_image
(
b
, 
d–
, 
shiá
, 
a
.
w
,‡.
h
);

789 
i
;

790 
i
 = 0; i < 
c
.
w
*c.
h
; ++i){

791 
c
.
d©a
[
i
] = 
a
.data[i];

793 
	`§ve_image
(
c
, 
out
);

794 
	}
}

796 
	$Ë‰”box_image_što
(
image
 
im
, 
w
, 
h
, imag
boxed
)

798 
Ãw_w
 = 
im
.
w
;

799 
Ãw_h
 = 
im
.
h
;

800 ià((()
w
/
im
.wè< (()
h
/im.h)) {

801 
Ãw_w
 = 
w
;

802 
Ãw_h
 = (
im
.
h
 * 
w
)/im.w;

804 
Ãw_h
 = 
h
;

805 
Ãw_w
 = (
im
.
w
 * 
h
)/im.h;

807 
image
 
»sized
 = 
	`»size_image
(
im
, 
Ãw_w
, 
Ãw_h
);

808 
	`embed_image
(
»sized
, 
boxed
, (
w
-
Ãw_w
)/2, (
h
-
Ãw_h
)/2);

809 
	`ä“_image
(
»sized
);

810 
	}
}

812 
image
 
	$Ë‰”box_image
(
image
 
im
, 
w
, 
h
)

814 
Ãw_w
 = 
im
.
w
;

815 
Ãw_h
 = 
im
.
h
;

816 ià((()
w
/
im
.wè< (()
h
/im.h)) {

817 
Ãw_w
 = 
w
;

818 
Ãw_h
 = (
im
.
h
 * 
w
)/im.w;

820 
Ãw_h
 = 
h
;

821 
Ãw_w
 = (
im
.
w
 * 
h
)/im.h;

823 
image
 
»sized
 = 
	`»size_image
(
im
, 
Ãw_w
, 
Ãw_h
);

824 
image
 
boxed
 = 
	`make_image
(
w
, 
h
, 
im
.
c
);

825 
	`fl_image
(
boxed
, .5);

828 
	`embed_image
(
»sized
, 
boxed
, (
w
-
Ãw_w
)/2, (
h
-
Ãw_h
)/2);

829 
	`ä“_image
(
»sized
);

830  
boxed
;

831 
	}
}

833 
image
 
	$»size_max
(
image
 
im
, 
max
)

835 
w
 = 
im
.w;

836 
h
 = 
im
.h;

837 if(
w
 > 
h
){

838 
h
 = (h * 
max
è/ 
w
;

839 
w
 = 
max
;

841 
w
 = (w * 
max
è/ 
h
;

842 
h
 = 
max
;

844 if(
w
 =ğ
im
.w && 
h
 == im.h)  im;

845 
image
 
»sized
 = 
	`»size_image
(
im
, 
w
, 
h
);

846  
»sized
;

847 
	}
}

849 
image
 
	$»size_mš
(
image
 
im
, 
mš
)

851 
w
 = 
im
.w;

852 
h
 = 
im
.h;

853 if(
w
 < 
h
){

854 
h
 = (h * 
mš
è/ 
w
;

855 
w
 = 
mš
;

857 
w
 = (w * 
mš
è/ 
h
;

858 
h
 = 
mš
;

860 if(
w
 =ğ
im
.w && 
h
 == im.h)  im;

861 
image
 
»sized
 = 
	`»size_image
(
im
, 
w
, 
h
);

862  
»sized
;

863 
	}
}

865 
image
 
	$¿ndom_üİ_image
(
image
 
im
, 
w
, 
h
)

867 
dx
 = 
	`¿nd_št
(0, 
im
.
w
 - w);

868 
dy
 = 
	`¿nd_št
(0, 
im
.
h
 - h);

869 
image
 
üİ
 = 
	`üİ_image
(
im
, 
dx
, 
dy
, 
w
, 
h
);

870  
üİ
;

871 
	}
}

873 
augm’t_¬gs
 
	$¿ndom_augm’t_¬gs
(
image
 
im
, 
ªgË
, 
a¥eù
, 
low
, 
high
, 
w
, 
h
)

875 
augm’t_¬gs
 
a
 = {0};

876 
a¥eù
 = 
	`¿nd_sÿË
(aspect);

877 
r
 = 
	`¿nd_št
(
low
, 
high
);

878 
mš
 = (
im
.
h
 < im.
w
*
a¥eù
) ? im.h : im.w*aspect;

879 
sÿË
 = ()
r
 / 
mš
;

881 
¿d
 = 
	`¿nd_unifÜm
(-
ªgË
,‡ngËè* 
TWO_PI
 / 360.;

883 
dx
 = (
im
.
w
*
sÿË
/
a¥eù
 - w) / 2.;

884 
dy
 = (
im
.
h
*
sÿË
 - 
w
) / 2.;

887 
dx
 = 
	`¿nd_unifÜm
(-dx, dx);

888 
dy
 = 
	`¿nd_unifÜm
(-dy, dy);

890 
a
.
¿d
 =„ad;

891 
a
.
sÿË
 = scale;

892 
a
.
w
 = w;

893 
a
.
h
 = h;

894 
a
.
dx
 = dx;

895 
a
.
dy
 = dy;

896 
a
.
a¥eù
 =‡spect;

897  
a
;

898 
	}
}

900 
image
 
	$¿ndom_augm’t_image
(
image
 
im
, 
ªgË
, 
a¥eù
, 
low
, 
high
, 
w
, 
h
)

902 
augm’t_¬gs
 
a
 = 
	`¿ndom_augm’t_¬gs
(
im
, 
ªgË
, 
a¥eù
, 
low
, 
high
, 
w
, 
h
);

903 
image
 
üİ
 = 
	`rÙ©e_üİ_image
(
im
, 
a
.
¿d
,‡.
sÿË
,‡.
w
,‡.
h
,‡.
dx
,‡.
dy
,‡.
a¥eù
);

904  
üİ
;

905 
	}
}

907 
	$th»e_way_max
(
a
, 
b
, 
c
)

909  (
a
 > 
b
è? ( (¨> 
c
) ?‡ : c) : ( (b > c) ? b : c) ;

910 
	}
}

912 
	$th»e_way_mš
(
a
, 
b
, 
c
)

914  (
a
 < 
b
è? ( (¨< 
c
) ?‡ : c) : ( (b < c) ? b : c) ;

915 
	}
}

917 
	$yuv_to_rgb
(
image
 
im
)

919 
	`as£¹
(
im
.
c
 == 3);

920 
i
, 
j
;

921 
r
, 
g
, 
b
;

922 
y
, 
u
, 
v
;

923 
j
 = 0; j < 
im
.
h
; ++j){

924 
i
 = 0; i < 
im
.
w
; ++i){

925 
y
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 0);

926 
u
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 1);

927 
v
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 2);

929 
r
 = 
y
 + 1.13983*
v
;

930 
g
 = 
y
 + -.39465*
u
 + -.58060*
v
;

931 
b
 = 
y
 + 2.03211*
u
;

933 
	`£t_pix–
(
im
, 
i
, 
j
, 0, 
r
);

934 
	`£t_pix–
(
im
, 
i
, 
j
, 1, 
g
);

935 
	`£t_pix–
(
im
, 
i
, 
j
, 2, 
b
);

938 
	}
}

940 
	$rgb_to_yuv
(
image
 
im
)

942 
	`as£¹
(
im
.
c
 == 3);

943 
i
, 
j
;

944 
r
, 
g
, 
b
;

945 
y
, 
u
, 
v
;

946 
j
 = 0; j < 
im
.
h
; ++j){

947 
i
 = 0; i < 
im
.
w
; ++i){

948 
r
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 0);

949 
g
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 1);

950 
b
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 2);

952 
y
 = .299*
r
 + .587*
g
 + .114*
b
;

953 
u
 = -.14713*
r
 + -.28886*
g
 + .436*
b
;

954 
v
 = .615*
r
 + -.51499*
g
 + -.10001*
b
;

956 
	`£t_pix–
(
im
, 
i
, 
j
, 0, 
y
);

957 
	`£t_pix–
(
im
, 
i
, 
j
, 1, 
u
);

958 
	`£t_pix–
(
im
, 
i
, 
j
, 2, 
v
);

961 
	}
}

964 
	$rgb_to_hsv
(
image
 
im
)

966 
	`as£¹
(
im
.
c
 == 3);

967 
i
, 
j
;

968 
r
, 
g
, 
b
;

969 
h
, 
s
, 
v
;

970 
j
 = 0; j < 
im
.
h
; ++j){

971 
i
 = 0; i < 
im
.
w
; ++i){

972 
r
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 0);

973 
g
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 1);

974 
b
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 2);

975 
max
 = 
	`th»e_way_max
(
r
,
g
,
b
);

976 
mš
 = 
	`th»e_way_mš
(
r
,
g
,
b
);

977 
d–
 = 
max
 - 
mš
;

978 
v
 = 
max
;

979 if(
max
 == 0){

980 
s
 = 0;

981 
h
 = 0;

983 
s
 = 
d–
/
max
;

984 if(
r
 =ğ
max
){

985 
h
 = (
g
 - 
b
è/ 
d–
;

986 } ià(
g
 =ğ
max
) {

987 
h
 = 2 + (
b
 - 
r
è/ 
d–
;

989 
h
 = 4 + (
r
 - 
g
è/ 
d–
;

991 ià(
h
 < 0) h += 6;

992 
h
 = h/6.;

994 
	`£t_pix–
(
im
, 
i
, 
j
, 0, 
h
);

995 
	`£t_pix–
(
im
, 
i
, 
j
, 1, 
s
);

996 
	`£t_pix–
(
im
, 
i
, 
j
, 2, 
v
);

999 
	}
}

1001 
	$hsv_to_rgb
(
image
 
im
)

1003 
	`as£¹
(
im
.
c
 == 3);

1004 
i
, 
j
;

1005 
r
, 
g
, 
b
;

1006 
h
, 
s
, 
v
;

1007 
f
, 
p
, 
q
, 
t
;

1008 
j
 = 0; j < 
im
.
h
; ++j){

1009 
i
 = 0; i < 
im
.
w
; ++i){

1010 
h
 = 6 * 
	`g‘_pix–
(
im
, 
i
 , 
j
, 0);

1011 
s
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 1);

1012 
v
 = 
	`g‘_pix–
(
im
, 
i
 , 
j
, 2);

1013 ià(
s
 == 0) {

1014 
r
 = 
g
 = 
b
 = 
v
;

1016 
šdex
 = 
	`æoÜ
(
h
);

1017 
f
 = 
h
 - 
šdex
;

1018 
p
 = 
v
*(1-
s
);

1019 
q
 = 
v
*(1-
s
*
f
);

1020 
t
 = 
v
*(1-
s
*(1-
f
));

1021 if(
šdex
 == 0){

1022 
r
 = 
v
; 
g
 = 
t
; 
b
 = 
p
;

1023 } if(
šdex
 == 1){

1024 
r
 = 
q
; 
g
 = 
v
; 
b
 = 
p
;

1025 } if(
šdex
 == 2){

1026 
r
 = 
p
; 
g
 = 
v
; 
b
 = 
t
;

1027 } if(
šdex
 == 3){

1028 
r
 = 
p
; 
g
 = 
q
; 
b
 = 
v
;

1029 } if(
šdex
 == 4){

1030 
r
 = 
t
; 
g
 = 
p
; 
b
 = 
v
;

1032 
r
 = 
v
; 
g
 = 
p
; 
b
 = 
q
;

1035 
	`£t_pix–
(
im
, 
i
, 
j
, 0, 
r
);

1036 
	`£t_pix–
(
im
, 
i
, 
j
, 1, 
g
);

1037 
	`£t_pix–
(
im
, 
i
, 
j
, 2, 
b
);

1040 
	}
}

1042 
	$g¿ysÿË_image_3c
(
image
 
im
)

1044 
	`as£¹
(
im
.
c
 == 3);

1045 
i
, 
j
, 
k
;

1046 
sÿË
[] = {0.299, 0.587, 0.114};

1047 
j
 = 0; j < 
im
.
h
; ++j){

1048 
i
 = 0; i < 
im
.
w
; ++i){

1049 
v®
 = 0;

1050 
k
 = 0; k < 3; ++k){

1051 
v®
 +ğ
sÿË
[
k
]*
	`g‘_pix–
(
im
, 
i
, 
j
, k);

1053 
im
.
d©a
[0*im.
h
*im.
w
 + im.w*
j
 + 
i
] = 
v®
;

1054 
im
.
d©a
[1*im.
h
*im.
w
 + im.w*
j
 + 
i
] = 
v®
;

1055 
im
.
d©a
[2*im.
h
*im.
w
 + im.w*
j
 + 
i
] = 
v®
;

1058 
	}
}

1060 
image
 
	$g¿ysÿË_image
(
image
 
im
)

1062 
	`as£¹
(
im
.
c
 == 3);

1063 
i
, 
j
, 
k
;

1064 
image
 
g¿y
 = 
	`make_image
(
im
.
w
, im.
h
, 1);

1065 
sÿË
[] = {0.299, 0.587, 0.114};

1066 
k
 = 0; k < 
im
.
c
; ++k){

1067 
j
 = 0; j < 
im
.
h
; ++j){

1068 
i
 = 0; i < 
im
.
w
; ++i){

1069 
g¿y
.
d©a
[
i
+
im
.
w
*
j
] +ğ
sÿË
[
k
]*
	`g‘_pix–
(im, i, j, k);

1073  
g¿y
;

1074 
	}
}

1076 
image
 
	$th»shŞd_image
(
image
 
im
, 
th»sh
)

1078 
i
;

1079 
image
 
t
 = 
	`make_image
(
im
.
w
, im.
h
, im.
c
);

1080 
i
 = 0; i < 
im
.
w
*im.
h
*im.
c
; ++i){

1081 
t
.
d©a
[
i
] = 
im
.d©a[i]>
th»sh
 ? 1 : 0;

1083  
t
;

1084 
	}
}

1086 
image
 
	$bËnd_image
(
image
 
fÜe
, imag
back
, 
®pha
)

1088 
	`as£¹
(
fÜe
.
w
 =ğ
back
.w && fÜe.
h
 =ğback.h && fÜe.
c
 == back.c);

1089 
image
 
bËnd
 = 
	`make_image
(
fÜe
.
w
, fÜe.
h
, fÜe.
c
);

1090 
i
, 
j
, 
k
;

1091 
k
 = 0; k < 
fÜe
.
c
; ++k){

1092 
j
 = 0; j < 
fÜe
.
h
; ++j){

1093 
i
 = 0; i < 
fÜe
.
w
; ++i){

1094 
v®
 = 
®pha
 * 
	`g‘_pix–
(
fÜe
, 
i
, 
j
, 
k
) +

1095 (1 - 
®pha
)* 
	`g‘_pix–
(
back
, 
i
, 
j
, 
k
);

1096 
	`£t_pix–
(
bËnd
, 
i
, 
j
, 
k
, 
v®
);

1100  
bËnd
;

1101 
	}
}

1103 
	$sÿË_image_chªÃl
(
image
 
im
, 
c
, 
v
)

1105 
i
, 
j
;

1106 
j
 = 0; j < 
im
.
h
; ++j){

1107 
i
 = 0; i < 
im
.
w
; ++i){

1108 
pix
 = 
	`g‘_pix–
(
im
, 
i
, 
j
, 
c
);

1109 
pix
 =…ix*
v
;

1110 
	`£t_pix–
(
im
, 
i
, 
j
, 
c
, 
pix
);

1113 
	}
}

1115 
	$Œª¦©e_image_chªÃl
(
image
 
im
, 
c
, 
v
)

1117 
i
, 
j
;

1118 
j
 = 0; j < 
im
.
h
; ++j){

1119 
i
 = 0; i < 
im
.
w
; ++i){

1120 
pix
 = 
	`g‘_pix–
(
im
, 
i
, 
j
, 
c
);

1121 
pix
 =…ix+
v
;

1122 
	`£t_pix–
(
im
, 
i
, 
j
, 
c
, 
pix
);

1125 
	}
}

1127 
image
 
	$bš¬ize_image
(
image
 
im
)

1129 
image
 
c
 = 
	`cİy_image
(
im
);

1130 
i
;

1131 
i
 = 0; i < 
im
.
w
 * im.
h
 * im.
c
; ++i){

1132 if(
c
.
d©a
[
i
] > .5) c.data[i] = 1;

1133 
c
.
d©a
[
i
] = 0;

1135  
c
;

1136 
	}
}

1138 
	$§tu¿‹_image
(
image
 
im
, 
§t
)

1140 
	`rgb_to_hsv
(
im
);

1141 
	`sÿË_image_chªÃl
(
im
, 1, 
§t
);

1142 
	`hsv_to_rgb
(
im
);

1143 
	`cÚ¡¿š_image
(
im
);

1144 
	}
}

1146 
	$hue_image
(
image
 
im
, 
hue
)

1148 
	`rgb_to_hsv
(
im
);

1149 
i
;

1150 
i
 = 0; i < 
im
.
w
*im.
h
; ++i){

1151 
im
.
d©a
[
i
] = im.d©a[i] + 
hue
;

1152 ià(
im
.
d©a
[
i
] > 1) im.data[i] -= 1;

1153 ià(
im
.
d©a
[
i
] < 0) im.data[i] += 1;

1155 
	`hsv_to_rgb
(
im
);

1156 
	`cÚ¡¿š_image
(
im
);

1157 
	}
}

1159 
	$exposu»_image
(
image
 
im
, 
§t
)

1161 
	`rgb_to_hsv
(
im
);

1162 
	`sÿË_image_chªÃl
(
im
, 2, 
§t
);

1163 
	`hsv_to_rgb
(
im
);

1164 
	`cÚ¡¿š_image
(
im
);

1165 
	}
}

1167 
	$di¡Üt_image
(
image
 
im
, 
hue
, 
§t
, 
v®
)

1169 
	`rgb_to_hsv
(
im
);

1170 
	`sÿË_image_chªÃl
(
im
, 1, 
§t
);

1171 
	`sÿË_image_chªÃl
(
im
, 2, 
v®
);

1172 
i
;

1173 
i
 = 0; i < 
im
.
w
*im.
h
; ++i){

1174 
im
.
d©a
[
i
] = im.d©a[i] + 
hue
;

1175 ià(
im
.
d©a
[
i
] > 1) im.data[i] -= 1;

1176 ià(
im
.
d©a
[
i
] < 0) im.data[i] += 1;

1178 
	`hsv_to_rgb
(
im
);

1179 
	`cÚ¡¿š_image
(
im
);

1180 
	}
}

1182 
	$¿ndom_di¡Üt_image
(
image
 
im
, 
hue
, 
§tu¿tiÚ
, 
exposu»
)

1184 
dhue
 = 
	`¿nd_unifÜm
(-
hue
, hue);

1185 
d§t
 = 
	`¿nd_sÿË
(
§tu¿tiÚ
);

1186 
dexp
 = 
	`¿nd_sÿË
(
exposu»
);

1187 
	`di¡Üt_image
(
im
, 
dhue
, 
d§t
, 
dexp
);

1188 
	}
}

1190 
	$§tu¿‹_exposu»_image
(
image
 
im
, 
§t
, 
exposu»
)

1192 
	`rgb_to_hsv
(
im
);

1193 
	`sÿË_image_chªÃl
(
im
, 1, 
§t
);

1194 
	`sÿË_image_chªÃl
(
im
, 2, 
exposu»
);

1195 
	`hsv_to_rgb
(
im
);

1196 
	`cÚ¡¿š_image
(
im
);

1197 
	}
}

1199 
image
 
	$»size_image
(
image
 
im
, 
w
, 
h
)

1201 
image
 
»sized
 = 
	`make_image
(
w
, 
h
, 
im
.
c
);

1202 
image
 
·¹
 = 
	`make_image
(
w
, 
im
.
h
, im.
c
);

1203 
r
, 
c
, 
k
;

1204 
w_sÿË
 = ()(
im
.
w
 - 1) / (w - 1);

1205 
h_sÿË
 = ()(
im
.
h
 - 1) / (h - 1);

1206 
k
 = 0; k < 
im
.
c
; ++k){

1207 
r
 = 0;„ < 
im
.
h
; ++r){

1208 
c
 = 0; c < 
w
; ++c){

1209 
v®
 = 0;

1210 if(
c
 =ğ
w
-1 || 
im
.w == 1){

1211 
v®
 = 
	`g‘_pix–
(
im
, im.
w
-1, 
r
, 
k
);

1213 
sx
 = 
c
*
w_sÿË
;

1214 
ix
 = (è
sx
;

1215 
dx
 = 
sx
 - 
ix
;

1216 
v®
 = (1 - 
dx
è* 
	`g‘_pix–
(
im
, 
ix
, 
r
, 
k
) + dx * get_pixel(im, ix+1,„, k);

1218 
	`£t_pix–
(
·¹
, 
c
, 
r
, 
k
, 
v®
);

1222 
k
 = 0; k < 
im
.
c
; ++k){

1223 
r
 = 0;„ < 
h
; ++r){

1224 
sy
 = 
r
*
h_sÿË
;

1225 
iy
 = (è
sy
;

1226 
dy
 = 
sy
 - 
iy
;

1227 
c
 = 0; c < 
w
; ++c){

1228 
v®
 = (1-
dy
è* 
	`g‘_pix–
(
·¹
, 
c
, 
iy
, 
k
);

1229 
	`£t_pix–
(
»sized
, 
c
, 
r
, 
k
, 
v®
);

1231 if(
r
 =ğ
h
-1 || 
im
.h == 1) ;

1232 
c
 = 0; c < 
w
; ++c){

1233 
v®
 = 
dy
 * 
	`g‘_pix–
(
·¹
, 
c
, 
iy
+1, 
k
);

1234 
	`add_pix–
(
»sized
, 
c
, 
r
, 
k
, 
v®
);

1239 
	`ä“_image
(
·¹
);

1240  
»sized
;

1241 
	}
}

1244 
	$‹¡_»size
(*
f’ame
)

1246 
image
 
im
 = 
	`lßd_image
(
f’ame
, 0,0, 3);

1247 
mag
 = 
	`mag_¬¿y
(
im
.
d©a
, im.
w
*im.
h
*im.
c
);

1248 
	`´štf
("L2 NÜm: %f\n", 
mag
);

1249 
image
 
g¿y
 = 
	`g¿ysÿË_image
(
im
);

1251 
image
 
c1
 = 
	`cİy_image
(
im
);

1252 
image
 
c2
 = 
	`cİy_image
(
im
);

1253 
image
 
c3
 = 
	`cİy_image
(
im
);

1254 
image
 
c4
 = 
	`cİy_image
(
im
);

1255 
	`di¡Üt_image
(
c1
, .1, 1.5, 1.5);

1256 
	`di¡Üt_image
(
c2
, -.1, .66666, .66666);

1257 
	`di¡Üt_image
(
c3
, .1, 1.5, .66666);

1258 
	`di¡Üt_image
(
c4
, .1, .66666, 1.5);

1261 
	`show_image
(
im
, "Original", 1);

1262 
	`show_image
(
g¿y
, "Gray", 1);

1263 
	`show_image
(
c1
, "C1", 1);

1264 
	`show_image
(
c2
, "C2", 1);

1265 
	`show_image
(
c3
, "C3", 1);

1266 
	`show_image
(
c4
, "C4", 1);

1267 #ifdeà
OPENCV


1269 
image
 
aug
 = 
	`¿ndom_augm’t_image
(
im
, 0, .75, 320, 448, 320, 320);

1270 
	`show_image
(
aug
, "aug", 1);

1271 
	`ä“_image
(
aug
);

1274 
exposu»
 = 1.15;

1275 
§tu¿tiÚ
 = 1.15;

1276 
hue
 = .05;

1278 
image
 
c
 = 
	`cİy_image
(
im
);

1280 
dexp
 = 
	`¿nd_sÿË
(
exposu»
);

1281 
d§t
 = 
	`¿nd_sÿË
(
§tu¿tiÚ
);

1282 
dhue
 = 
	`¿nd_unifÜm
(-
hue
, hue);

1284 
	`di¡Üt_image
(
c
, 
dhue
, 
d§t
, 
dexp
);

1285 
	`show_image
(
c
, "rand", 1);

1286 
	`´štf
("%à%à%f\n", 
dhue
, 
d§t
, 
dexp
);

1287 
	`ä“_image
(
c
);

1290 
	}
}

1293 
image
 
	$lßd_image_¡b
(*
f’ame
, 
chªÃls
)

1295 
w
, 
h
, 
c
;

1296 *
d©a
 = 
	`¡bi_lßd
(
f’ame
, &
w
, &
h
, &
c
, 
chªÃls
);

1297 ià(!
d©a
) {

1298 
	`årštf
(
¡d”r
, "CªnÙ†ßd imag\"%s\"\nSTB R—sÚ: %s\n", 
f’ame
, 
	`¡bi_çu»_»asÚ
());

1299 
	`ex™
(0);

1301 if(
chªÃls
è
c
 = channels;

1302 
i
,
j
,
k
;

1303 
image
 
im
 = 
	`make_image
(
w
, 
h
, 
c
);

1304 
k
 = 0; k < 
c
; ++k){

1305 
j
 = 0; j < 
h
; ++j){

1306 
i
 = 0; i < 
w
; ++i){

1307 
d¡_šdex
 = 
i
 + 
w
*
j
 + w*
h
*
k
;

1308 
¤c_šdex
 = 
k
 + 
c
*
i
 + c*
w
*
j
;

1309 
im
.
d©a
[
d¡_šdex
] = ()d©a[
¤c_šdex
]/255.;

1313 
	`ä“
(
d©a
);

1314  
im
;

1315 
	}
}

1317 
image
 
	$lßd_image
(*
f’ame
, 
w
, 
h
, 
c
)

1319 #ifdeà
OPENCV


1320 
image
 
out
 = 
	`lßd_image_cv
(
f’ame
, 
c
);

1322 
image
 
out
 = 
	`lßd_image_¡b
(
f’ame
, 
c
);

1325 if((
h
 && 
w
è&& (h !ğ
out
.h || w != out.w)){

1326 
image
 
»sized
 = 
	`»size_image
(
out
, 
w
, 
h
);

1327 
	`ä“_image
(
out
);

1328 
out
 = 
»sized
;

1330  
out
;

1331 
	}
}

1333 
image
 
	$lßd_image_cŞÜ
(*
f’ame
, 
w
, 
h
)

1335  
	`lßd_image
(
f’ame
, 
w
, 
h
, 3);

1336 
	}
}

1338 
image
 
	$g‘_image_Ïy”
(
image
 
m
, 
l
)

1340 
image
 
out
 = 
	`make_image
(
m
.
w
, m.
h
, 1);

1341 
i
;

1342 
i
 = 0; i < 
m
.
h
*m.
w
; ++i){

1343 
out
.
d©a
[
i
] = 
m
.d©a[i+
l
*m.
h
*m.
w
];

1345  
out
;

1346 
	}
}

1347 
	$´št_image
(
image
 
m
)

1349 
i
, 
j
, 
k
;

1350 
i
 =0 ; i < 
m
.
c
; ++i){

1351 
j
 =0 ; j < 
m
.
h
; ++j){

1352 
k
 = 0; k < 
m
.
w
; ++k){

1353 
	`´štf
("%.2lf, ", 
m
.
d©a
[
i
*m.
h
*m.
w
 + 
j
*m.w + 
k
]);

1354 if(
k
 > 30) ;

1356 
	`´štf
("\n");

1357 if(
j
 > 30) ;

1359 
	`´štf
("\n");

1361 
	`´štf
("\n");

1362 
	}
}

1364 
image
 
	$cŞÏp£_images_v”t
(
image
 *
ims
, 
n
)

1366 
cŞÜ
 = 1;

1367 
bÜd”
 = 1;

1368 
h
,
w
,
c
;

1369 
w
 = 
ims
[0].w;

1370 
h
 = (
ims
[0].h + 
bÜd”
è* 
n
 - border;

1371 
c
 = 
ims
[0].c;

1372 if(
c
 !ğ3 || !
cŞÜ
){

1373 
w
 = (w+
bÜd”
)*
c
 - border;

1374 
c
 = 1;

1377 
image
 
f‹rs
 = 
	`make_image
(
w
, 
h
, 
c
);

1378 
i
,
j
;

1379 
i
 = 0; i < 
n
; ++i){

1380 
h_off£t
 = 
i
*(
ims
[0].
h
+
bÜd”
);

1381 
image
 
cİy
 = 
	`cİy_image
(
ims
[
i
]);

1383 if(
c
 =ğ3 && 
cŞÜ
){

1384 
	`embed_image
(
cİy
, 
f‹rs
, 0, 
h_off£t
);

1387 
j
 = 0; j < 
cİy
.
c
; ++j){

1388 
w_off£t
 = 
j
*(
ims
[0].
w
+
bÜd”
);

1389 
image
 
Ïy”
 = 
	`g‘_image_Ïy”
(
cİy
, 
j
);

1390 
	`embed_image
(
Ïy”
, 
f‹rs
, 
w_off£t
, 
h_off£t
);

1391 
	`ä“_image
(
Ïy”
);

1394 
	`ä“_image
(
cİy
);

1396  
f‹rs
;

1397 
	}
}

1399 
image
 
	$cŞÏp£_images_hÜz
(
image
 *
ims
, 
n
)

1401 
cŞÜ
 = 1;

1402 
bÜd”
 = 1;

1403 
h
,
w
,
c
;

1404 
size
 = 
ims
[0].
h
;

1405 
h
 = 
size
;

1406 
w
 = (
ims
[0].w + 
bÜd”
è* 
n
 - border;

1407 
c
 = 
ims
[0].c;

1408 if(
c
 !ğ3 || !
cŞÜ
){

1409 
h
 = (h+
bÜd”
)*
c
 - border;

1410 
c
 = 1;

1413 
image
 
f‹rs
 = 
	`make_image
(
w
, 
h
, 
c
);

1414 
i
,
j
;

1415 
i
 = 0; i < 
n
; ++i){

1416 
w_off£t
 = 
i
*(
size
+
bÜd”
);

1417 
image
 
cİy
 = 
	`cİy_image
(
ims
[
i
]);

1419 if(
c
 =ğ3 && 
cŞÜ
){

1420 
	`embed_image
(
cİy
, 
f‹rs
, 
w_off£t
, 0);

1423 
j
 = 0; j < 
cİy
.
c
; ++j){

1424 
h_off£t
 = 
j
*(
size
+
bÜd”
);

1425 
image
 
Ïy”
 = 
	`g‘_image_Ïy”
(
cİy
, 
j
);

1426 
	`embed_image
(
Ïy”
, 
f‹rs
, 
w_off£t
, 
h_off£t
);

1427 
	`ä“_image
(
Ïy”
);

1430 
	`ä“_image
(
cİy
);

1432  
f‹rs
;

1433 
	}
}

1435 
	$show_image_nÜm®ized
(
image
 
im
, cÚ¡ *
Çme
)

1437 
image
 
c
 = 
	`cİy_image
(
im
);

1438 
	`nÜm®ize_image
(
c
);

1439 
	`show_image
(
c
, 
Çme
, 1);

1440 
	`ä“_image
(
c
);

1441 
	}
}

1443 
	$show_images
(
image
 *
ims
, 
n
, *
wšdow
)

1445 
image
 
m
 = 
	`cŞÏp£_images_v”t
(
ims
, 
n
);

1455 
	`nÜm®ize_image
(
m
);

1456 
	`§ve_image
(
m
, 
wšdow
);

1457 
	`show_image
(
m
, 
wšdow
, 1);

1458 
	`ä“_image
(
m
);

1459 
	}
}

1461 
	$ä“_image
(
image
 
m
)

1463 if(
m
.
d©a
){

1464 
	`ä“
(
m
.
d©a
);

1466 
	}
}

	@host/src/image.h

1 #iâdeà
IMAGE_H


2 
	#IMAGE_H


	)

4 
	~<¡dlib.h
>

5 
	~<¡dio.h
>

6 
	~<æßt.h
>

7 
	~<¡ršg.h
>

8 
	~<m©h.h
>

9 
	~"box.h
"

10 
	~"d¬kÃt.h
"

12 #ifdeà
__ılu¥lus


16 #ifdeà
OPENCV


17 *
İ’_video_¡»am
(cÚ¡ *
f
, 
c
, 
w
, 
h
, 
ås
);

18 
image
 
g‘_image_äom_¡»am
(*
p
);

19 
image
 
lßd_image_cv
(*
f’ame
, 
chªÃls
);

20 
show_image_cv
(
image
 
im
, cÚ¡ * 
Çme
, 
ms
);

23 
g‘_cŞÜ
(
c
, 
x
, 
max
);

24 
d¿w_box
(
image
 
a
, 
x1
, 
y1
, 
x2
, 
y2
, 
r
, 
g
, 
b
);

25 
d¿w_bbox
(
image
 
a
, 
box
 
bbox
, 
w
, 
r
, 
g
, 
b
);

26 
wr™e_Ïb–
(
image
 
a
, 
r
, 
c
, imag*
ch¬aù”s
, *
¡ršg
, *
rgb
);

27 
image
 
image_di¡ªû
(imag
a
, imag
b
);

28 
sÿË_image
(
image
 
m
, 
s
);

29 
image
 
rÙ©e_üİ_image
(imag
im
, 
¿d
, 
s
, 
w
, 
h
, 
dx
, 
dy
, 
a¥eù
);

30 
image
 
¿ndom_üİ_image
(imag
im
, 
w
, 
h
);

31 
image
 
¿ndom_augm’t_image
(imag
im
, 
ªgË
, 
a¥eù
, 
low
, 
high
, 
w
, 
h
);

32 
augm’t_¬gs
 
¿ndom_augm’t_¬gs
(
image
 
im
, 
ªgË
, 
a¥eù
, 
low
, 
high
, 
w
, 
h
);

33 
Ë‰”box_image_što
(
image
 
im
, 
w
, 
h
, imag
boxed
);

34 
image
 
»size_max
(imag
im
, 
max
);

35 
Œª¦©e_image
(
image
 
m
, 
s
);

36 
embed_image
(
image
 
sourû
, imag
de¡
, 
dx
, 
dy
);

37 
¶aû_image
(
image
 
im
, 
w
, 
h
, 
dx
, 
dy
, imag
ÿnvas
);

38 
§tu¿‹_image
(
image
 
im
, 
§t
);

39 
exposu»_image
(
image
 
im
, 
§t
);

40 
di¡Üt_image
(
image
 
im
, 
hue
, 
§t
, 
v®
);

41 
§tu¿‹_exposu»_image
(
image
 
im
, 
§t
, 
exposu»
);

42 
rgb_to_hsv
(
image
 
im
);

43 
hsv_to_rgb
(
image
 
im
);

44 
yuv_to_rgb
(
image
 
im
);

45 
rgb_to_yuv
(
image
 
im
);

48 
image
 
cŞÏp£_image_Ïy”s
(imag
sourû
, 
bÜd”
);

49 
image
 
cŞÏp£_images_hÜz
(imag*
ims
, 
n
);

50 
image
 
cŞÏp£_images_v”t
(imag*
ims
, 
n
);

52 
show_image_nÜm®ized
(
image
 
im
, cÚ¡ *
Çme
);

53 
show_images
(
image
 *
ims
, 
n
, *
wšdow
);

54 
show_image_Ïy”s
(
image
 
p
, *
Çme
);

55 
show_image_cŞÏp£d
(
image
 
p
, *
Çme
);

57 
´št_image
(
image
 
m
);

59 
image
 
make_em±y_image
(
w
, 
h
, 
c
);

60 
cİy_image_što
(
image
 
¤c
, imag
de¡
);

62 
image
 
g‘_image_Ïy”
(imag
m
, 
l
);

64 #ifdeà
__ılu¥lus


	@host/src/image_opencv.cpp

1 #ifdeà
OPENCV


3 
	~"¡dio.h
"

4 
	~"¡dlib.h
"

5 
	~"İ’cv2/İ’cv.hµ
"

6 
	~"image.h
"

8 
usšg
 
Çme¥aû
 
	gcv
;

12 
I¶Image
 *
image_to_l
(
image
 
im
)

14 
x
,
y
,
c
;

15 
I¶Image
 *
di¥
 = 
cvC»©eImage
(
cvSize
(
im
.
w
,im.
h
), 
IPL_DEPTH_8U
, im.
c
);

16 
¡•
 = 
di¥
->
widthS‹p
;

17 
y
 = 0; y < 
im
.
h
; ++y){

18 
x
 = 0; x < 
im
.
w
; ++x){

19 
c
ğ0; c < 
im
.c; ++c){

20 
v®
 = 
im
.
d©a
[
c
*im.
h
*im.
w
 + 
y
*im.w + 
x
];

21 
di¥
->
imageD©a
[
y
*
¡•
 + 
x
*
im
.
c
 + c] = ()(
v®
*255);

25  
di¥
;

28 
image
 
l_to_image
(
I¶Image
* 
¤c
)

30 
h
 = 
¤c
->
height
;

31 
w
 = 
¤c
->
width
;

32 
c
 = 
¤c
->
nChªÃls
;

33 
image
 
im
 = 
make_image
(
w
, 
h
, 
c
);

34 *
d©a
 = (*)
¤c
->
imageD©a
;

35 
¡•
 = 
¤c
->
widthS‹p
;

36 
i
, 
j
, 
k
;

38 
i
 = 0; i < 
h
; ++i){

39 
k
ğ0; k < 
c
; ++k){

40 
j
 = 0; j < 
w
; ++j){

41 
im
.
d©a
[
k
*
w
*
h
 + 
i
*w + 
j
] = d©a[i*
¡•
 + j*
c
 + k]/255.;

45  
im
;

48 
M©
 
image_to_m©
(
image
 
im
)

50 
image
 
cİy
 = 
cİy_image
(
im
);

51 
cÚ¡¿š_image
(
cİy
);

52 if(
im
.
c
 =ğ3è
rgbgr_image
(
cİy
);

54 
I¶Image
 *
l
 = 
image_to_l
(
cİy
);

55 
M©
 
m
 = 
cv¬rToM©
(
l
, 
Œue
);

56 
cvR–—£Image
(&
l
);

57 
ä“_image
(
cİy
);

58  
m
;

61 
image
 
m©_to_image
(
M©
 
m
)

63 
I¶Image
 
l
 = 
m
;

64 
image
 
im
 = 
l_to_image
(&
l
);

65 
rgbgr_image
(
im
);

66  
im
;

69 *
İ’_video_¡»am
(cÚ¡ *
f
, 
c
, 
w
, 
h
, 
ås
)

71 
VideoC­tu»
 *
ÿp
;

72 if(
f
è
ÿp
 = 
Ãw
 
VideoC­tu»
(f);

73 
ÿp
 = 
Ãw
 
VideoC­tu»
(
c
);

74 if(!
ÿp
->
isO³Ãd
())  0;

75 if(
w
è
ÿp
->
£t
(
CV_CAP_PROP_FRAME_WIDTH
, w);

76 if(
h
è
ÿp
->
£t
(
CV_CAP_PROP_FRAME_HEIGHT
, 
w
);

77 if(
ås
è
ÿp
->
£t
(
CV_CAP_PROP_FPS
, 
w
);

78  (*è
ÿp
;

81 
image
 
g‘_image_äom_¡»am
(*
p
)

83 
VideoC­tu»
 *
ÿp
 = (VideoC­tu» *)
p
;

84 
M©
 
m
;

85 *
ÿp
 >> 
m
;

86 if(
m
.
em±y
()è 
make_em±y_image
(0,0,0);

87  
m©_to_image
(
m
);

90 
image
 
lßd_image_cv
(*
f’ame
, 
chªÃls
)

92 
æag
 = -1;

93 ià(
chªÃls
 =ğ0è
æag
 = -1;

94 ià(
chªÃls
 =ğ1è
æag
 = 0;

95 ià(
chªÃls
 =ğ3è
æag
 = 1;

97 
årštf
(
¡d”r
, "O³nCV cª'ˆfÜû†ßd w™h %d chªÃls\n", 
chªÃls
);

99 
M©
 
m
;

100 
m
 = 
im»ad
(
f’ame
, 
æag
);

101 if(!
m
.
d©a
){

102 
årštf
(
¡d”r
, "CªnÙ†ßd imag\"%s\"\n", 
f’ame
);

103 
buff
[256];

104 
¥rštf
(
buff
, "echØ% >> bad.li¡", 
f’ame
);

105 
sy¡em
(
buff
);

106  
make_image
(10,10,3);

109 
image
 
im
 = 
m©_to_image
(
m
);

110  
im
;

113 
show_image_cv
(
image
 
im
, cÚ¡ * 
Çme
, 
ms
)

115 
M©
 
m
 = 
image_to_m©
(
im
);

116 
imshow
(
Çme
, 
m
);

117 
c
 = 
wa™Key
(
ms
);

118 ià(
c
 != -1) c = c%256;

119  
c
;

122 
make_wšdow
(*
Çme
, 
w
, 
h
, 
fuÎsü“n
)

124 
ÇmedWšdow
(
Çme
, 
WINDOW_NORMAL
);

125 ià(
fuÎsü“n
) {

126 
£tWšdowPrİ”ty
(
Çme
, 
CV_WND_PROP_FULLSCREEN
, 
CV_WINDOW_FULLSCREEN
);

128 
»sizeWšdow
(
Çme
, 
w
, 
h
);

129 if(
¡rcmp
(
Çme
, "Demo"è=ğ0è
moveWšdow
(name, 0, 0);

	@host/src/iseg_layer.c

1 
	~"i£g_Ïy”.h
"

2 
	~"aùiv©iÚs.h
"

3 
	~"bÏs.h
"

4 
	~"box.h
"

5 
	~"cuda.h
"

6 
	~"uts.h
"

8 
	~<¡dio.h
>

9 
	~<as£¹.h
>

10 
	~<¡ršg.h
>

11 
	~<¡dlib.h
>

13 
Ïy”
 
	$make_i£g_Ïy”
(
b©ch
, 
w
, 
h
, 
şas£s
, 
ids
)

15 
Ïy”
 
l
 = {0};

16 
l
.
ty³
 = 
ISEG
;

18 
l
.
h
 = h;

19 
l
.
w
 = w;

20 
l
.
c
 = 
şas£s
 + 
ids
;

21 
l
.
out_w
 =†.
w
;

22 
l
.
out_h
 =†.
h
;

23 
l
.
out_c
 =†.
c
;

24 
l
.
şas£s
 = classes;

25 
l
.
b©ch
 = batch;

26 
l
.
exŒa
 = 
ids
;

27 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

28 
l
.
ouuts
 = 
h
*
w
*l.
c
;

29 
l
.
šputs
 =†.
ouuts
;

30 
l
.
Œuths
 = 90*Ö.
w
*l.
h
+1);

31 
l
.
d–
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

32 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

34 
l
.
couÁs
 = 
	`ÿÎoc
(90, ());

35 
l
.
sums
 = 
	`ÿÎoc
(90, (*));

36 if(
ids
){

37 
i
;

38 
i
 = 0; i < 90; ++i){

39 
l
.
sums
[
i
] = 
	`ÿÎoc
(
ids
, ());

43 
l
.
fÜw¬d
 = 
fÜw¬d_i£g_Ïy”
;

44 
l
.
backw¬d
 = 
backw¬d_i£g_Ïy”
;

45 #ifdeà
GPU


46 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_i£g_Ïy”_gpu
;

47 
l
.
backw¬d_gpu
 = 
backw¬d_i£g_Ïy”_gpu
;

48 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
b©ch
*l.
ouuts
);

49 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
b©ch
*l.
ouuts
);

52 
	`årštf
(
¡d”r
, "iseg\n");

53 
	`¤ªd
(0);

55  
l
;

56 
	}
}

58 
	$»size_i£g_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

60 
l
->
w
 = w;

61 
l
->
h
 = h;

63 
l
->
ouuts
 = 
h
*
w
*l->
c
;

64 
l
->
šputs
 =†->
ouuts
;

66 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
b©ch
*l->
ouuts
*());

67 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
b©ch
*l->
ouuts
*());

69 #ifdeà
GPU


70 
	`cuda_ä“
(
l
->
d–_gpu
);

71 
	`cuda_ä“
(
l
->
ouut_gpu
);

73 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
b©ch
*l->
ouuts
);

74 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

76 
	}
}

78 
	$fÜw¬d_i£g_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

81 
time
 = 
	`wh©_time_is_™_now
();

82 
i
,
b
,
j
,
k
;

83 
ids
 = 
l
.
exŒa
;

84 
	`memıy
(
l
.
ouut
, 
Ãt
.
šput
,†.
ouuts
*l.
b©ch
*());

85 
	`mem£t
(
l
.
d–
, 0,†.
ouuts
 *†.
b©ch
 * ());

87 #iâdeà
GPU


88 
b
 = 0; b < 
l
.
b©ch
; ++b){

89 
šdex
 = 
b
*
l
.
ouuts
;

90 
	`aùiv©e_¬¿y
(
l
.
ouut
 + 
šdex
,†.
şas£s
*l.
w
*l.
h
, 
LOGISTIC
);

94 
b
 = 0; b < 
l
.
b©ch
; ++b){

96 
i
 = 0; i < 
l
.
şas£s
; ++i){

97 
k
 = 0; k < 
l
.
w
*l.
h
; ++k){

98 
šdex
 = 
b
*
l
.
ouuts
 + 
i
*l.
w
*l.
h
 + 
k
;

99 
l
.
d–
[
šdex
] = 0 -†.
ouut
[index];

104 
i
 = 0; i < 
ids
; ++i){

105 
k
 = 0; k < 
l
.
w
*l.
h
; ++k){

106 
šdex
 = 
b
*
l
.
ouuts
 + (
i
+l.
şas£s
)*l.
w
*l.
h
 + 
k
;

107 
l
.
d–
[
šdex
] = .1 * (0 -†.
ouut
[index]);

112 
	`mem£t
(
l
.
couÁs
, 0, 90*());

113 
i
 = 0; i < 90; ++i){

114 
	`fl_ıu
(
ids
, 0, 
l
.
sums
[
i
], 1);

116 
c
 = 
Ãt
.
Œuth
[
b
*
l
.
Œuths
 + 
i
*Ö.
w
*l.
h
+1)];

117 if(
c
 < 0) ;

119 
k
 = 0; k < 
l
.
w
*l.
h
; ++k){

120 
šdex
 = 
b
*
l
.
ouuts
 + 
c
*l.
w
*l.
h
 + 
k
;

121 
v
 = 
Ãt
.
Œuth
[
b
*
l
.
Œuths
 + 
i
*Ö.
w
*l.
h
 + 1è+ 1 + 
k
];

122 if(
v
){

123 
l
.
d–
[
šdex
] = 
v
 -†.
ouut
[index];

124 
	`axpy_ıu
(
ids
, 1, 
l
.
ouut
 + 
b
*l.
ouuts
 +†.
şas£s
*l.
w
*l.
h
 + 
k
,†.w*l.h,†.
sums
[
i
], 1);

125 ++
l
.
couÁs
[
i
];

130 *
m£
 = 
	`ÿÎoc
(90, ());

131 
i
 = 0; i < 90; ++i){

132 
c
 = 
Ãt
.
Œuth
[
b
*
l
.
Œuths
 + 
i
*Ö.
w
*l.
h
+1)];

133 if(
c
 < 0) ;

134 
k
 = 0; k < 
l
.
w
*l.
h
; ++k){

135 
v
 = 
Ãt
.
Œuth
[
b
*
l
.
Œuths
 + 
i
*Ö.
w
*l.
h
 + 1è+ 1 + 
k
];

136 if(
v
){

137 
z
;

138 
sum
 = 0;

139 
z
 = 0; z < 
ids
; ++z){

140 
šdex
 = 
b
*
l
.
ouuts
 + (l.
şas£s
 + 
z
)*l.
w
*l.
h
 + 
k
;

141 
sum
 +ğ
	`pow
(
l
.
sums
[
i
][
z
]/l.
couÁs
[i] -†.
ouut
[
šdex
], 2);

143 
m£
[
i
] +ğ
sum
;

146 
m£
[
i
] /ğ
l
.
couÁs
[i];

150 
i
 = 0; i < 90; ++i){

151 if(!
l
.
couÁs
[
i
]) ;

152 
	`sÿl_ıu
(
ids
, 1.f/
l
.
couÁs
[
i
],†.
sums
[i], 1);

153 if(
b
 =ğ0 && 
Ãt
.
gpu_šdex
 == 0){

154 
	`´štf
("%4d, %6.3f, ", 
l
.
couÁs
[
i
], 
m£
[i]);

155 
j
 = 0; j < 
ids
; ++j){

156 
	`´štf
("%6.3f,", 
l
.
sums
[
i
][
j
]);

158 
	`´štf
("\n");

161 
	`ä“
(
m£
);

164 
i
 = 0; i < 90; ++i){

165 if(!
l
.
couÁs
[
i
]) ;

166 
k
 = 0; k < 
l
.
w
*l.
h
; ++k){

167 
v
 = 
Ãt
.
Œuth
[
b
*
l
.
Œuths
 + 
i
*Ö.
w
*l.
h
 + 1è+ 1 + 
k
];

168 if(
v
){

169 
j
 = 0; j < 90; ++j){

170 if(!
l
.
couÁs
[
j
]);

171 
z
;

172 
z
 = 0; z < 
ids
; ++z){

173 
šdex
 = 
b
*
l
.
ouuts
 + (l.
şas£s
 + 
z
)*l.
w
*l.
h
 + 
k
;

174 
diff
 = 
l
.
sums
[
j
][
z
] -†.
ouut
[
šdex
];

175 ià(
j
 =ğ
i
è
l
.
d–
[
šdex
] +ğ
diff
 < 0? -.1 : .1;

176 
l
.
d–
[
šdex
] +ğ-(
diff
 < 0? -.1 : .1);

183 
i
 = 0; i < 
ids
; ++i){

184 
k
 = 0; k < 
l
.
w
*l.
h
; ++k){

185 
šdex
 = 
b
*
l
.
ouuts
 + (
i
+l.
şas£s
)*l.
w
*l.
h
 + 
k
;

186 
l
.
d–
[
šdex
] *= .01;

191 *(
l
.
co¡
èğ
	`pow
(
	`mag_¬¿y
Ö.
d–
,†.
ouuts
 *†.
b©ch
), 2);

192 
	`´štf
("took %là£c\n", 
	`wh©_time_is_™_now
(è- 
time
);

193 
	}
}

195 
	$backw¬d_i£g_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

197 
	`axpy_ıu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

198 
	}
}

200 #ifdeà
GPU


202 
	$fÜw¬d_i£g_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

204 
	`cİy_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

205 
b
;

206 
b
 = 0; b < 
l
.
b©ch
; ++b){

207 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
 + 
b
*l.
ouuts
,†.
şas£s
*l.
w
*l.
h
, 
LOGISTIC
);

211 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
, 
Ãt
.
šput
,†.
b©ch
*l.
šputs
);

212 
	`fÜw¬d_i£g_Ïy”
(
l
, 
Ãt
);

213 
	`cuda_push_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
ouuts
);

214 
	}
}

216 
	$backw¬d_i£g_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

218 
b
;

219 
b
 = 0; b < 
l
.
b©ch
; ++b){

222 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

223 
	}
}

	@host/src/iseg_layer.h

1 #iâdeà
ISEG_LAYER_H


2 
	#ISEG_LAYER_H


	)

4 
	~"d¬kÃt.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_i£g_Ïy”
(
b©ch
, 
w
, 
h
, 
şas£s
, 
ids
);

9 
fÜw¬d_i£g_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 
backw¬d_i£g_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
»size_i£g_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

12 
i£g_num_d‘eùiÚs
(
Ïy”
 
l
, 
th»sh
);

14 #ifdeà
GPU


15 
fÜw¬d_i£g_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_i£g_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/l2norm_layer.c

1 
	~"l2nÜm_Ïy”.h
"

2 
	~"aùiv©iÚs.h
"

3 
	~"bÏs.h
"

4 
	~"cuda.h
"

6 
	~<æßt.h
>

7 
	~<m©h.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dio.h
>

10 
	~<as£¹.h
>

12 
Ïy”
 
	$make_l2nÜm_Ïy”
(
b©ch
, 
šputs
)

14 
	`årštf
(
¡d”r
, "l2nÜm %4d\n", 
šputs
);

15 
Ïy”
 
l
 = {0};

16 
l
.
ty³
 = 
L2NORM
;

17 
l
.
b©ch
 = batch;

18 
l
.
šputs
 = inputs;

19 
l
.
ouuts
 = 
šputs
;

20 
l
.
ouut
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

21 
l
.
sÿËs
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

22 
l
.
d–
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

24 
l
.
fÜw¬d
 = 
fÜw¬d_l2nÜm_Ïy”
;

25 
l
.
backw¬d
 = 
backw¬d_l2nÜm_Ïy”
;

26 #ifdeà
GPU


27 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_l2nÜm_Ïy”_gpu
;

28 
l
.
backw¬d_gpu
 = 
backw¬d_l2nÜm_Ïy”_gpu
;

30 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
šputs
*
b©ch
);

31 
l
.
sÿËs_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
šputs
*
b©ch
);

32 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
šputs
*
b©ch
);

34  
l
;

35 
	}
}

37 
	$fÜw¬d_l2nÜm_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

39 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput
, 1,†.
ouut
, 1);

40 
	`l2nÜm®ize_ıu
(
l
.
ouut
,†.
sÿËs
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

41 
	}
}

43 
	$backw¬d_l2nÜm_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

46 
	`axpy_ıu
(
l
.
šputs
*l.
b©ch
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

47 
	}
}

49 #ifdeà
GPU


51 
	$fÜw¬d_l2nÜm_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

53 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

54 
	`l2nÜm®ize_gpu
(
l
.
ouut_gpu
,†.
sÿËs_gpu
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

55 
	}
}

57 
	$backw¬d_l2nÜm_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

59 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
sÿËs_gpu
, 1,†.
d–_gpu
, 1);

60 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

61 
	}
}

	@host/src/l2norm_layer.h

1 #iâdeà
L2NORM_LAYER_H


2 
	#L2NORM_LAYER_H


	)

3 
	~"Ïy”.h
"

4 
	~"ÃtwÜk.h
"

6 
Ïy”
 
make_l2nÜm_Ïy”
(
b©ch
, 
šputs
);

7 
fÜw¬d_l2nÜm_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

8 
backw¬d_l2nÜm_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 #ifdeà
GPU


11 
fÜw¬d_l2nÜm_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_l2nÜm_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/layer.c

1 
	~"Ïy”.h
"

2 
	~"cuda.h
"

4 
	~<¡dlib.h
>

6 
	$ä“_Ïy”
(
Ïy”
 
l
)

8 if(
l
.
ty³
 =ğ
DROPOUT
){

9 if(
l
.
¿nd
è
	`ä“
(l.rand);

10 #ifdeà
GPU


11 if(
l
.
¿nd_gpu
è
	`cuda_ä“
(l.rand_gpu);

15 if(
l
.
cweights
è
	`ä“
(l.cweights);

16 if(
l
.
šdexes
è
	`ä“
(l.indexes);

17 if(
l
.
šput_Ïy”s
è
	`ä“
(l.input_layers);

18 if(
l
.
šput_sizes
è
	`ä“
(l.input_sizes);

19 if(
l
.
m­
è
	`ä“
(l.map);

20 if(
l
.
¿nd
è
	`ä“
(l.rand);

21 if(
l
.
co¡
è
	`ä“
(l.cost);

22 if(
l
.
¡©e
è
	`ä“
(l.state);

23 if(
l
.
´ev_¡©e
è
	`ä“
(l.prev_state);

24 if(
l
.
fÜgÙ_¡©e
è
	`ä“
(l.forgot_state);

25 if(
l
.
fÜgÙ_d–
è
	`ä“
(l.forgot_delta);

26 if(
l
.
¡©e_d–
è
	`ä“
(l.state_delta);

27 if(
l
.
cÚÿt
è
	`ä“
(l.concat);

28 if(
l
.
cÚÿt_d–
è
	`ä“
(l.concat_delta);

29 if(
l
.
bš¬y_weights
è
	`ä“
(l.binary_weights);

30 if(
l
.
bŸ£s
è
	`ä“
(l.biases);

31 if(
l
.
bŸs_upd©es
è
	`ä“
(l.bias_updates);

32 if(
l
.
sÿËs
è
	`ä“
(l.scales);

33 if(
l
.
sÿË_upd©es
è
	`ä“
(l.scale_updates);

34 if(
l
.
weights
è
	`ä“
(l.weights);

35 if(
l
.
weight_upd©es
è
	`ä“
(l.weight_updates);

36 if(
l
.
d–
è
	`ä“
(l.delta);

37 if(
l
.
ouut
è
	`ä“
(l.output);

38 if(
l
.
squ¬ed
è
	`ä“
(l.squared);

39 if(
l
.
nÜms
è
	`ä“
(l.norms);

40 if(
l
.
¥©Ÿl_m—n
è
	`ä“
(l.spatial_mean);

41 if(
l
.
m—n
è
	`ä“
(l.mean);

42 if(
l
.
v¬Ÿnû
è
	`ä“
(l.variance);

43 if(
l
.
m—n_d–
è
	`ä“
(l.mean_delta);

44 if(
l
.
v¬Ÿnû_d–
è
	`ä“
(l.variance_delta);

45 if(
l
.
rŞlšg_m—n
è
	`ä“
(l.rolling_mean);

46 if(
l
.
rŞlšg_v¬Ÿnû
è
	`ä“
(l.rolling_variance);

47 if(
l
.
x
è
	`ä“
(l.x);

48 if(
l
.
x_nÜm
è
	`ä“
(l.x_norm);

49 if(
l
.
m
è
	`ä“
(l.m);

50 if(
l
.
v
è
	`ä“
(l.v);

51 if(
l
.
z_ıu
è
	`ä“
(l.z_cpu);

52 if(
l
.
r_ıu
è
	`ä“
(l.r_cpu);

53 if(
l
.
h_ıu
è
	`ä“
(l.h_cpu);

54 if(
l
.
bš¬y_šput
è
	`ä“
(l.binary_input);

56 #ifdeà
GPU


57 if(
l
.
šdexes_gpu
è
	`cuda_ä“
((*)l.indexes_gpu);

59 if(
l
.
z_gpu
è
	`cuda_ä“
(l.z_gpu);

60 if(
l
.
r_gpu
è
	`cuda_ä“
(l.r_gpu);

61 if(
l
.
h_gpu
è
	`cuda_ä“
(l.h_gpu);

62 if(
l
.
m_gpu
è
	`cuda_ä“
(l.m_gpu);

63 if(
l
.
v_gpu
è
	`cuda_ä“
(l.v_gpu);

64 if(
l
.
´ev_¡©e_gpu
è
	`cuda_ä“
(l.prev_state_gpu);

65 if(
l
.
fÜgÙ_¡©e_gpu
è
	`cuda_ä“
(l.forgot_state_gpu);

66 if(
l
.
fÜgÙ_d–_gpu
è
	`cuda_ä“
(l.forgot_delta_gpu);

67 if(
l
.
¡©e_gpu
è
	`cuda_ä“
(l.state_gpu);

68 if(
l
.
¡©e_d–_gpu
è
	`cuda_ä“
(l.state_delta_gpu);

69 if(
l
.
g©e_gpu
è
	`cuda_ä“
(l.gate_gpu);

70 if(
l
.
g©e_d–_gpu
è
	`cuda_ä“
(l.gate_delta_gpu);

71 if(
l
.
§ve_gpu
è
	`cuda_ä“
(l.save_gpu);

72 if(
l
.
§ve_d–_gpu
è
	`cuda_ä“
(l.save_delta_gpu);

73 if(
l
.
cÚÿt_gpu
è
	`cuda_ä“
(l.concat_gpu);

74 if(
l
.
cÚÿt_d–_gpu
è
	`cuda_ä“
(l.concat_delta_gpu);

75 if(
l
.
bš¬y_šput_gpu
è
	`cuda_ä“
(l.binary_input_gpu);

76 if(
l
.
bš¬y_weights_gpu
è
	`cuda_ä“
(l.binary_weights_gpu);

77 if(
l
.
m—n_gpu
è
	`cuda_ä“
(l.mean_gpu);

78 if(
l
.
v¬Ÿnû_gpu
è
	`cuda_ä“
(l.variance_gpu);

79 if(
l
.
rŞlšg_m—n_gpu
è
	`cuda_ä“
(l.rolling_mean_gpu);

80 if(
l
.
rŞlšg_v¬Ÿnû_gpu
è
	`cuda_ä“
(l.rolling_variance_gpu);

81 if(
l
.
v¬Ÿnû_d–_gpu
è
	`cuda_ä“
(l.variance_delta_gpu);

82 if(
l
.
m—n_d–_gpu
è
	`cuda_ä“
(l.mean_delta_gpu);

83 if(
l
.
x_gpu
è
	`cuda_ä“
(l.x_gpu);

84 if(
l
.
x_nÜm_gpu
è
	`cuda_ä“
(l.x_norm_gpu);

85 if(
l
.
weights_gpu
è
	`cuda_ä“
(l.weights_gpu);

86 if(
l
.
weight_upd©es_gpu
è
	`cuda_ä“
(l.weight_updates_gpu);

87 if(
l
.
bŸ£s_gpu
è
	`cuda_ä“
(l.biases_gpu);

88 if(
l
.
bŸs_upd©es_gpu
è
	`cuda_ä“
(l.bias_updates_gpu);

89 if(
l
.
sÿËs_gpu
è
	`cuda_ä“
(l.scales_gpu);

90 if(
l
.
sÿË_upd©es_gpu
è
	`cuda_ä“
(l.scale_updates_gpu);

91 if(
l
.
ouut_gpu
è
	`cuda_ä“
(l.output_gpu);

92 if(
l
.
d–_gpu
è
	`cuda_ä“
(l.delta_gpu);

93 if(
l
.
¿nd_gpu
è
	`cuda_ä“
(l.rand_gpu);

94 if(
l
.
squ¬ed_gpu
è
	`cuda_ä“
(l.squared_gpu);

95 if(
l
.
nÜms_gpu
è
	`cuda_ä“
(l.norms_gpu);

97 
	}
}

	@host/src/layer.h

1 
	~"d¬kÃt.h
"

	@host/src/list.c

1 
	~<¡dlib.h
>

2 
	~<¡ršg.h
>

3 
	~"li¡.h
"

5 
li¡
 *
	$make_li¡
()

7 
li¡
 *
l
 = 
	`m®loc
((list));

8 
l
->
size
 = 0;

9 
l
->
äÚt
 = 0;

10 
l
->
back
 = 0;

11  
l
;

12 
	}
}

28 *
	$li¡_pİ
(
li¡
 *
l
){

29 if(!
l
->
back
)  0;

30 
node
 *
b
 = 
l
->
back
;

31 *
v®
 = 
b
->val;

32 
l
->
back
 = 
b
->
´ev
;

33 if(
l
->
back
èl->back->
Ãxt
 = 0;

34 
	`ä“
(
b
);

35 --
l
->
size
;

37  
v®
;

38 
	}
}

40 
	$li¡_š£¹
(
li¡
 *
l
, *
v®
)

42 
node
 *
Ãw
 = 
	`m®loc
((node));

43 
Ãw
->
v®
 = val;

44 
Ãw
->
Ãxt
 = 0;

46 if(!
l
->
back
){

47 
l
->
äÚt
 = 
Ãw
;

48 
Ãw
->
´ev
 = 0;

50 
l
->
back
->
Ãxt
 = 
Ãw
;

51 
Ãw
->
´ev
 = 
l
->
back
;

53 
l
->
back
 = 
Ãw
;

54 ++
l
->
size
;

55 
	}
}

57 
	$ä“_node
(
node
 *
n
)

59 
node
 *
Ãxt
;

60 
n
) {

61 
Ãxt
 = 
n
->next;

62 
	`ä“
(
n
);

63 
n
 = 
Ãxt
;

65 
	}
}

67 
	$ä“_li¡
(
li¡
 *
l
)

69 
	`ä“_node
(
l
->
äÚt
);

70 
	`ä“
(
l
);

71 
	}
}

73 
	$ä“_li¡_cÚ‹Ás
(
li¡
 *
l
)

75 
node
 *
n
 = 
l
->
äÚt
;

76 
n
){

77 
	`ä“
(
n
->
v®
);

78 
n
 =‚->
Ãxt
;

80 
	}
}

82 **
	$li¡_to_¬¿y
(
li¡
 *
l
)

84 **
a
 = 
	`ÿÎoc
(
l
->
size
, (*));

85 
couÁ
 = 0;

86 
node
 *
n
 = 
l
->
äÚt
;

87 
n
){

88 
a
[
couÁ
++] = 
n
->
v®
;

89 
n
 =‚->
Ãxt
;

91  
a
;

92 
	}
}

	@host/src/list.h

1 #iâdeà
LIST_H


2 
	#LIST_H


	)

3 
	~"d¬kÃt.h
"

5 
li¡
 *
make_li¡
();

6 
li¡_fšd
(
li¡
 *
l
, *
v®
);

8 
li¡_š£¹
(
li¡
 *, *);

11 
ä“_li¡_cÚ‹Ás
(
li¡
 *
l
);

	@host/src/local_layer.c

1 
	~"loÿl_Ïy”.h
"

2 
	~"uts.h
"

3 
	~"im2cŞ.h
"

4 
	~"cŞ2im.h
"

5 
	~"bÏs.h
"

6 
	~"gemm.h
"

7 
	~<¡dio.h
>

8 
	~<time.h
>

10 
	$loÿl_out_height
(
loÿl_Ïy”
 
l
)

12 
h
 = 
l
.h;

13 ià(!
l
.
·d
è
h
 -ğl.
size
;

14 
h
 -= 1;

15  
h
/
l
.
¡ride
 + 1;

16 
	}
}

18 
	$loÿl_out_width
(
loÿl_Ïy”
 
l
)

20 
w
 = 
l
.w;

21 ià(!
l
.
·d
è
w
 -ğl.
size
;

22 
w
 -= 1;

23  
w
/
l
.
¡ride
 + 1;

24 
	}
}

26 
loÿl_Ïy”
 
	$make_loÿl_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
size
, 
¡ride
, 
·d
, 
ACTIVATION
 
aùiv©iÚ
)

28 
i
;

29 
loÿl_Ïy”
 
l
 = {0};

30 
l
.
ty³
 = 
LOCAL
;

32 
l
.
h
 = h;

33 
l
.
w
 = w;

34 
l
.
c
 = c;

35 
l
.
n
 =‚;

36 
l
.
b©ch
 = batch;

37 
l
.
¡ride
 = stride;

38 
l
.
size
 = size;

39 
l
.
·d
 =…ad;

41 
out_h
 = 
	`loÿl_out_height
(
l
);

42 
out_w
 = 
	`loÿl_out_width
(
l
);

43 
loÿtiÚs
 = 
out_h
*
out_w
;

44 
l
.
out_h
 = out_h;

45 
l
.
out_w
 = out_w;

46 
l
.
out_c
 = 
n
;

47 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

48 
l
.
šputs
 =†.
w
 *†.
h
 *†.
c
;

50 
l
.
weights
 = 
	`ÿÎoc
(
c
*
n
*
size
*size*
loÿtiÚs
, ());

51 
l
.
weight_upd©es
 = 
	`ÿÎoc
(
c
*
n
*
size
*size*
loÿtiÚs
, ());

53 
l
.
bŸ£s
 = 
	`ÿÎoc
Ö.
ouuts
, ());

54 
l
.
bŸs_upd©es
 = 
	`ÿÎoc
Ö.
ouuts
, ());

57 
sÿË
 = 
	`sq¹
(2./(
size
*size*
c
));

58 
i
 = 0; i < 
c
*
n
*
size
*size; ++iè
l
.
weights
[i] = 
sÿË
*
	`¿nd_unifÜm
(-1,1);

60 
l
.
ouut
 = 
	`ÿÎoc
Ö.
b©ch
*
out_h
 * 
out_w
 * 
n
, ());

61 
l
.
d–
 = 
	`ÿÎoc
Ö.
b©ch
*
out_h
 * 
out_w
 * 
n
, ());

63 
l
.
wÜk¥aû_size
 = 
out_h
*
out_w
*
size
*size*
c
;

65 
l
.
fÜw¬d
 = 
fÜw¬d_loÿl_Ïy”
;

66 
l
.
backw¬d
 = 
backw¬d_loÿl_Ïy”
;

67 
l
.
upd©e
 = 
upd©e_loÿl_Ïy”
;

69 #ifdeà
GPU


70 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_loÿl_Ïy”_gpu
;

71 
l
.
backw¬d_gpu
 = 
backw¬d_loÿl_Ïy”_gpu
;

72 
l
.
upd©e_gpu
 = 
upd©e_loÿl_Ïy”_gpu
;

74 
l
.
weights_gpu
 = 
	`cuda_make_¬¿y
Ö.
weights
, 
c
*
n
*
size
*size*
loÿtiÚs
);

75 
l
.
weight_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
weight_upd©es
, 
c
*
n
*
size
*size*
loÿtiÚs
);

77 
l
.
bŸ£s_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸ£s
,†.
ouuts
);

78 
l
.
bŸs_upd©es_gpu
 = 
	`cuda_make_¬¿y
Ö.
bŸs_upd©es
,†.
ouuts
);

80 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
,†.
b©ch
*
out_h
*
out_w
*
n
);

81 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
b©ch
*
out_h
*
out_w
*
n
);

84 
l
.
aùiv©iÚ
 =‡ctivation;

86 
	`årštf
(
¡d”r
, "LoÿÈLay”: %d x %d x %d image, %d f‹r -> %d x %d x %d image\n", 
h
,
w
,
c
,
n
, 
out_h
, 
out_w
,‚);

88  
l
;

89 
	}
}

91 
	$fÜw¬d_loÿl_Ïy”
(cÚ¡ 
loÿl_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

93 
out_h
 = 
	`loÿl_out_height
(
l
);

94 
out_w
 = 
	`loÿl_out_width
(
l
);

95 
i
, 
j
;

96 
loÿtiÚs
 = 
out_h
 * 
out_w
;

98 
i
 = 0; i < 
l
.
b©ch
; ++i){

99 
	`cİy_ıu
(
l
.
ouuts
,†.
bŸ£s
, 1,†.
ouut
 + 
i
*l.outputs, 1);

102 
i
 = 0; i < 
l
.
b©ch
; ++i){

103 *
šput
 = 
Ãt
.špuˆ+ 
i
*
l
.
w
*l.
h
*l.
c
;

104 
	`im2cŞ_ıu
(
šput
, 
l
.
c
,†.
h
,†.
w
,

105 
l
.
size
,†.
¡ride
,†.
·d
, 
Ãt
.
wÜk¥aû
);

106 *
ouut
 = 
l
.ouuˆ+ 
i
*l.
ouuts
;

107 
j
 = 0; j < 
loÿtiÚs
; ++j){

108 *
a
 = 
l
.
weights
 + 
j
*l.
size
*l.size*l.
c
*l.
n
;

109 *
b
 = 
Ãt
.
wÜk¥aû
 + 
j
;

110 *
c
 = 
ouut
 + 
j
;

112 
m
 = 
l
.
n
;

113 
n
 = 1;

114 
k
 = 
l
.
size
*l.size*l.
c
;

116 
	`gemm
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,
loÿtiÚs
,1,
c
,locations);

119 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

120 
	}
}

122 
	$backw¬d_loÿl_Ïy”
(
loÿl_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

124 
i
, 
j
;

125 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

127 
	`g¿d›Á_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

129 
i
 = 0; i < 
l
.
b©ch
; ++i){

130 
	`axpy_ıu
(
l
.
ouuts
, 1,†.
d–
 + 
i
*l.ouuts, 1,†.
bŸs_upd©es
, 1);

133 
i
 = 0; i < 
l
.
b©ch
; ++i){

134 *
šput
 = 
Ãt
.špuˆ+ 
i
*
l
.
w
*l.
h
*l.
c
;

135 
	`im2cŞ_ıu
(
šput
, 
l
.
c
,†.
h
,†.
w
,

136 
l
.
size
,†.
¡ride
,†.
·d
, 
Ãt
.
wÜk¥aû
);

138 
j
 = 0; j < 
loÿtiÚs
; ++j){

139 *
a
 = 
l
.
d–
 + 
i
*l.
ouuts
 + 
j
;

140 *
b
 = 
Ãt
.
wÜk¥aû
 + 
j
;

141 *
c
 = 
l
.
weight_upd©es
 + 
j
*l.
size
*l.size*l.c*l.
n
;

142 
m
 = 
l
.
n
;

143 
n
 = 
l
.
size
*l.size*l.
c
;

144 
k
 = 1;

146 
	`gemm
(0,1,
m
,
n
,
k
,1,
a
,
loÿtiÚs
,
b
,loÿtiÚs,1,
c
,n);

149 if(
Ãt
.
d–
){

150 
j
 = 0; j < 
loÿtiÚs
; ++j){

151 *
a
 = 
l
.
weights
 + 
j
*l.
size
*l.size*l.
c
*l.
n
;

152 *
b
 = 
l
.
d–
 + 
i
*l.
ouuts
 + 
j
;

153 *
c
 = 
Ãt
.
wÜk¥aû
 + 
j
;

155 
m
 = 
l
.
size
*l.size*l.
c
;

156 
n
 = 1;

157 
k
 = 
l
.
n
;

159 
	`gemm
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,
loÿtiÚs
,0,
c
,locations);

162 
	`cŞ2im_ıu
(
Ãt
.
wÜk¥aû
, 
l
.
c
,†.
h
,†.
w
,†.
size
,†.
¡ride
,†.
·d
,‚‘.
d–
+
i
*l.c*l.h*l.w);

165 
	}
}

167 
	$upd©e_loÿl_Ïy”
(
loÿl_Ïy”
 
l
, 
upd©e_¬gs
 
a
)

169 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

170 
mom’tum
 = 
a
.momentum;

171 
deÿy
 = 
a
.decay;

172 
b©ch
 = 
a
.batch;

174 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

175 
size
 = 
l
.size*l.size*l.
c
*l.
n
*
loÿtiÚs
;

176 
	`axpy_ıu
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es
, 1,†.
bŸ£s
, 1);

177 
	`sÿl_ıu
(
l
.
ouuts
, 
mom’tum
,†.
bŸs_upd©es
, 1);

179 
	`axpy_ıu
(
size
, -
deÿy
*
b©ch
, 
l
.
weights
, 1,†.
weight_upd©es
, 1);

180 
	`axpy_ıu
(
size
, 
Ë¬nšg_¿‹
/
b©ch
, 
l
.
weight_upd©es
, 1,†.
weights
, 1);

181 
	`sÿl_ıu
(
size
, 
mom’tum
, 
l
.
weight_upd©es
, 1);

182 
	}
}

184 #ifdeà
GPU


186 
	$fÜw¬d_loÿl_Ïy”_gpu
(cÚ¡ 
loÿl_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

188 
out_h
 = 
	`loÿl_out_height
(
l
);

189 
out_w
 = 
	`loÿl_out_width
(
l
);

190 
i
, 
j
;

191 
loÿtiÚs
 = 
out_h
 * 
out_w
;

193 
i
 = 0; i < 
l
.
b©ch
; ++i){

194 
	`cİy_gpu
(
l
.
ouuts
,†.
bŸ£s_gpu
, 1,†.
ouut_gpu
 + 
i
*l.outputs, 1);

197 
i
 = 0; i < 
l
.
b©ch
; ++i){

198 *
šput
 = 
Ãt
.
šput_gpu
 + 
i
*
l
.
w
*l.
h
*l.
c
;

199 
	`im2cŞ_gpu
(
šput
, 
l
.
c
,†.
h
,†.
w
,

200 
l
.
size
,†.
¡ride
,†.
·d
, 
Ãt
.
wÜk¥aû
);

201 *
ouut
 = 
l
.
ouut_gpu
 + 
i
*l.
ouuts
;

202 
j
 = 0; j < 
loÿtiÚs
; ++j){

203 *
a
 = 
l
.
weights_gpu
 + 
j
*l.
size
*l.size*l.
c
*l.
n
;

204 *
b
 = 
Ãt
.
wÜk¥aû
 + 
j
;

205 *
c
 = 
ouut
 + 
j
;

207 
m
 = 
l
.
n
;

208 
n
 = 1;

209 
k
 = 
l
.
size
*l.size*l.
c
;

211 
	`gemm_gpu
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,
loÿtiÚs
,1,
c
,locations);

214 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

215 
	}
}

217 
	$backw¬d_loÿl_Ïy”_gpu
(
loÿl_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

219 
i
, 
j
;

220 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

222 
	`g¿d›Á_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–_gpu
);

223 
i
 = 0; i < 
l
.
b©ch
; ++i){

224 
	`axpy_gpu
(
l
.
ouuts
, 1,†.
d–_gpu
 + 
i
*l.ouuts, 1,†.
bŸs_upd©es_gpu
, 1);

227 
i
 = 0; i < 
l
.
b©ch
; ++i){

228 *
šput
 = 
Ãt
.
šput_gpu
 + 
i
*
l
.
w
*l.
h
*l.
c
;

229 
	`im2cŞ_gpu
(
šput
, 
l
.
c
,†.
h
,†.
w
,

230 
l
.
size
,†.
¡ride
,†.
·d
, 
Ãt
.
wÜk¥aû
);

232 
j
 = 0; j < 
loÿtiÚs
; ++j){

233 *
a
 = 
l
.
d–_gpu
 + 
i
*l.
ouuts
 + 
j
;

234 *
b
 = 
Ãt
.
wÜk¥aû
 + 
j
;

235 *
c
 = 
l
.
weight_upd©es_gpu
 + 
j
*l.
size
*l.size*l.c*l.
n
;

236 
m
 = 
l
.
n
;

237 
n
 = 
l
.
size
*l.size*l.
c
;

238 
k
 = 1;

240 
	`gemm_gpu
(0,1,
m
,
n
,
k
,1,
a
,
loÿtiÚs
,
b
,loÿtiÚs,1,
c
,n);

243 if(
Ãt
.
d–_gpu
){

244 
j
 = 0; j < 
loÿtiÚs
; ++j){

245 *
a
 = 
l
.
weights_gpu
 + 
j
*l.
size
*l.size*l.
c
*l.
n
;

246 *
b
 = 
l
.
d–_gpu
 + 
i
*l.
ouuts
 + 
j
;

247 *
c
 = 
Ãt
.
wÜk¥aû
 + 
j
;

249 
m
 = 
l
.
size
*l.size*l.
c
;

250 
n
 = 1;

251 
k
 = 
l
.
n
;

253 
	`gemm_gpu
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,
loÿtiÚs
,0,
c
,locations);

256 
	`cŞ2im_gpu
(
Ãt
.
wÜk¥aû
, 
l
.
c
,†.
h
,†.
w
,†.
size
,†.
¡ride
,†.
·d
,‚‘.
d–_gpu
+
i
*l.c*l.h*l.w);

259 
	}
}

261 
	$upd©e_loÿl_Ïy”_gpu
(
loÿl_Ïy”
 
l
, 
upd©e_¬gs
 
a
)

263 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

264 
mom’tum
 = 
a
.momentum;

265 
deÿy
 = 
a
.decay;

266 
b©ch
 = 
a
.batch;

268 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

269 
size
 = 
l
.size*l.size*l.
c
*l.
n
*
loÿtiÚs
;

270 
	`axpy_gpu
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es_gpu
, 1,†.
bŸ£s_gpu
, 1);

271 
	`sÿl_gpu
(
l
.
ouuts
, 
mom’tum
,†.
bŸs_upd©es_gpu
, 1);

273 
	`axpy_gpu
(
size
, -
deÿy
*
b©ch
, 
l
.
weights_gpu
, 1,†.
weight_upd©es_gpu
, 1);

274 
	`axpy_gpu
(
size
, 
Ë¬nšg_¿‹
/
b©ch
, 
l
.
weight_upd©es_gpu
, 1,†.
weights_gpu
, 1);

275 
	`sÿl_gpu
(
size
, 
mom’tum
, 
l
.
weight_upd©es_gpu
, 1);

276 
	}
}

278 
	$puÎ_loÿl_Ïy”
(
loÿl_Ïy”
 
l
)

280 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

281 
size
 = 
l
.size*l.size*l.
c
*l.
n
*
loÿtiÚs
;

282 
	`cuda_puÎ_¬¿y
(
l
.
weights_gpu
,†.
weights
, 
size
);

283 
	`cuda_puÎ_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸ£s
,†.
ouuts
);

284 
	}
}

286 
	$push_loÿl_Ïy”
(
loÿl_Ïy”
 
l
)

288 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

289 
size
 = 
l
.size*l.size*l.
c
*l.
n
*
loÿtiÚs
;

290 
	`cuda_push_¬¿y
(
l
.
weights_gpu
,†.
weights
, 
size
);

291 
	`cuda_push_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸ£s
,†.
ouuts
);

292 
	}
}

	@host/src/local_layer.h

1 #iâdeà
LOCAL_LAYER_H


2 
	#LOCAL_LAYER_H


	)

4 
	~"cuda.h
"

5 
	~"image.h
"

6 
	~"aùiv©iÚs.h
"

7 
	~"Ïy”.h
"

8 
	~"ÃtwÜk.h
"

10 
Ïy”
 
	tloÿl_Ïy”
;

12 #ifdeà
GPU


13 
fÜw¬d_loÿl_Ïy”_gpu
(
loÿl_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

14 
backw¬d_loÿl_Ïy”_gpu
(
loÿl_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

15 
upd©e_loÿl_Ïy”_gpu
(
loÿl_Ïy”
 
Ïy”
, 
upd©e_¬gs
 
a
);

17 
push_loÿl_Ïy”
(
loÿl_Ïy”
 
Ïy”
);

18 
puÎ_loÿl_Ïy”
(
loÿl_Ïy”
 
Ïy”
);

21 
loÿl_Ïy”
 
make_loÿl_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
size
, 
¡ride
, 
·d
, 
ACTIVATION
 
aùiv©iÚ
);

23 
fÜw¬d_loÿl_Ïy”
(cÚ¡ 
loÿl_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

24 
backw¬d_loÿl_Ïy”
(
loÿl_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
);

25 
upd©e_loÿl_Ïy”
(
loÿl_Ïy”
 
Ïy”
, 
upd©e_¬gs
 
a
);

27 
bŸs_ouut
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

28 
backw¬d_bŸs
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
);

	@host/src/logistic_layer.c

1 
	~"logi¡ic_Ïy”.h
"

2 
	~"aùiv©iÚs.h
"

3 
	~"bÏs.h
"

4 
	~"cuda.h
"

6 
	~<æßt.h
>

7 
	~<m©h.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dio.h
>

10 
	~<as£¹.h
>

12 
Ïy”
 
	$make_logi¡ic_Ïy”
(
b©ch
, 
šputs
)

14 
	`årštf
(
¡d”r
, "logi¡iøxƒÁrİy %4d\n", 
šputs
);

15 
Ïy”
 
l
 = {0};

16 
l
.
ty³
 = 
LOGXENT
;

17 
l
.
b©ch
 = batch;

18 
l
.
šputs
 = inputs;

19 
l
.
ouuts
 = 
šputs
;

20 
l
.
loss
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

21 
l
.
ouut
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

22 
l
.
d–
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

23 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

25 
l
.
fÜw¬d
 = 
fÜw¬d_logi¡ic_Ïy”
;

26 
l
.
backw¬d
 = 
backw¬d_logi¡ic_Ïy”
;

27 #ifdeà
GPU


28 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_logi¡ic_Ïy”_gpu
;

29 
l
.
backw¬d_gpu
 = 
backw¬d_logi¡ic_Ïy”_gpu
;

31 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
šputs
*
b©ch
);

32 
l
.
loss_gpu
 = 
	`cuda_make_¬¿y
Ö.
loss
, 
šputs
*
b©ch
);

33 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
šputs
*
b©ch
);

35  
l
;

36 
	}
}

38 
	$fÜw¬d_logi¡ic_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

40 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput
, 1,†.
ouut
, 1);

41 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

42 if(
Ãt
.
Œuth
){

43 
	`logi¡ic_x_’t_ıu
(
l
.
b©ch
*l.
šputs
,†.
ouut
, 
Ãt
.
Œuth
,†.
d–
,†.
loss
);

44 
l
.
co¡
[0] = 
	`sum_¬¿y
Ö.
loss
,†.
b©ch
*l.
šputs
);

46 
	}
}

48 
	$backw¬d_logi¡ic_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

50 
	`axpy_ıu
(
l
.
šputs
*l.
b©ch
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

51 
	}
}

53 #ifdeà
GPU


55 
	$fÜw¬d_logi¡ic_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

57 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

58 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

59 if(
Ãt
.
Œuth
){

60 
	`logi¡ic_x_’t_gpu
(
l
.
b©ch
*l.
šputs
,†.
ouut_gpu
, 
Ãt
.
Œuth_gpu
,†.
d–_gpu
,†.
loss_gpu
);

61 
	`cuda_puÎ_¬¿y
(
l
.
loss_gpu
,†.
loss
,†.
b©ch
*l.
šputs
);

62 
l
.
co¡
[0] = 
	`sum_¬¿y
Ö.
loss
,†.
b©ch
*l.
šputs
);

64 
	}
}

66 
	$backw¬d_logi¡ic_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

68 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

69 
	}
}

	@host/src/logistic_layer.h

1 #iâdeà
LOGISTIC_LAYER_H


2 
	#LOGISTIC_LAYER_H


	)

3 
	~"Ïy”.h
"

4 
	~"ÃtwÜk.h
"

6 
Ïy”
 
make_logi¡ic_Ïy”
(
b©ch
, 
šputs
);

7 
fÜw¬d_logi¡ic_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

8 
backw¬d_logi¡ic_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 #ifdeà
GPU


11 
fÜw¬d_logi¡ic_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_logi¡ic_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/lstm_layer.c

1 
	~"l¡m_Ïy”.h
"

2 
	~"cÚÃùed_Ïy”.h
"

3 
	~"uts.h
"

4 
	~"cuda.h
"

5 
	~"bÏs.h
"

6 
	~"gemm.h
"

8 
	~<m©h.h
>

9 
	~<¡dio.h
>

10 
	~<¡dlib.h
>

11 
	~<¡ršg.h
>

13 
	$šüem’t_Ïy”
(
Ïy”
 *
l
, 
¡•s
)

15 
num
 = 
l
->
ouuts
*l->
b©ch
*
¡•s
;

16 
l
->
ouut
 +ğ
num
;

17 
l
->
d–
 +ğ
num
;

18 
l
->
x
 +ğ
num
;

19 
l
->
x_nÜm
 +ğ
num
;

21 #ifdeà
GPU


22 
l
->
ouut_gpu
 +ğ
num
;

23 
l
->
d–_gpu
 +ğ
num
;

24 
l
->
x_gpu
 +ğ
num
;

25 
l
->
x_nÜm_gpu
 +ğ
num
;

27 
	}
}

29 
Ïy”
 
	$make_l¡m_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
¡•s
, 
b©ch_nÜm®ize
, 
adam
)

31 
	`årštf
(
¡d”r
, "LSTM Lay”: %d iÅuts, %d ouuts\n", 
šputs
, 
ouuts
);

32 
b©ch
 = b©ch / 
¡•s
;

33 
Ïy”
 
l
 = { 0 };

34 
l
.
b©ch
 = batch;

35 
l
.
ty³
 = 
LSTM
;

36 
l
.
¡•s
 = steps;

37 
l
.
šputs
 = inputs;

39 
l
.
uf
 = 
	`m®loc
((
Ïy”
));

40 
	`årštf
(
¡d”r
, "\t\t");

41 *(
l
.
uf
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

42 
l
.
uf
->
b©ch
 = batch;

44 
l
.
ui
 = 
	`m®loc
((
Ïy”
));

45 
	`årštf
(
¡d”r
, "\t\t");

46 *(
l
.
ui
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

47 
l
.
ui
->
b©ch
 = batch;

49 
l
.
ug
 = 
	`m®loc
((
Ïy”
));

50 
	`årštf
(
¡d”r
, "\t\t");

51 *(
l
.
ug
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

52 
l
.
ug
->
b©ch
 = batch;

54 
l
.
uo
 = 
	`m®loc
((
Ïy”
));

55 
	`årštf
(
¡d”r
, "\t\t");

56 *(
l
.
uo
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

57 
l
.
uo
->
b©ch
 = batch;

59 
l
.
wf
 = 
	`m®loc
((
Ïy”
));

60 
	`årštf
(
¡d”r
, "\t\t");

61 *(
l
.
wf
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

62 
l
.
wf
->
b©ch
 = batch;

64 
l
.
wi
 = 
	`m®loc
((
Ïy”
));

65 
	`årštf
(
¡d”r
, "\t\t");

66 *(
l
.
wi
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

67 
l
.
wi
->
b©ch
 = batch;

69 
l
.
wg
 = 
	`m®loc
((
Ïy”
));

70 
	`årštf
(
¡d”r
, "\t\t");

71 *(
l
.
wg
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

72 
l
.
wg
->
b©ch
 = batch;

74 
l
.
wo
 = 
	`m®loc
((
Ïy”
));

75 
	`årštf
(
¡d”r
, "\t\t");

76 *(
l
.
wo
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
LINEAR
, 
b©ch_nÜm®ize
, 
adam
);

77 
l
.
wo
->
b©ch
 = batch;

79 
l
.
b©ch_nÜm®ize
 = batch_normalize;

80 
l
.
ouuts
 = outputs;

82 
l
.
ouut
 = 
	`ÿÎoc
(
ouuts
*
b©ch
*
¡•s
, ());

83 
l
.
¡©e
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

85 
l
.
fÜw¬d
 = 
fÜw¬d_l¡m_Ïy”
;

86 
l
.
upd©e
 = 
upd©e_l¡m_Ïy”
;

88 
l
.
´ev_¡©e_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

89 
l
.
´ev_ûÎ_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

90 
l
.
ûÎ_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
*
¡•s
, ());

92 
l
.
f_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

93 
l
.
i_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

94 
l
.
g_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

95 
l
.
o_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

96 
l
.
c_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

97 
l
.
h_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

98 
l
.
‹mp_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

99 
l
.
‹mp2_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

100 
l
.
‹mp3_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

101 
l
.
dc_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

102 
l
.
dh_ıu
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

104 #ifdeà
GPU


105 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_l¡m_Ïy”_gpu
;

106 
l
.
backw¬d_gpu
 = 
backw¬d_l¡m_Ïy”_gpu
;

107 
l
.
upd©e_gpu
 = 
upd©e_l¡m_Ïy”_gpu
;

109 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
*
¡•s
);

110 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*l.
ouuts
*
¡•s
);

112 
l
.
´ev_¡©e_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

113 
l
.
´ev_ûÎ_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

114 
l
.
ûÎ_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
*
¡•s
);

116 
l
.
f_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

117 
l
.
i_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

118 
l
.
g_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

119 
l
.
o_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

120 
l
.
c_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

121 
l
.
h_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

122 
l
.
‹mp_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

123 
l
.
‹mp2_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

124 
l
.
‹mp3_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

125 
l
.
dc_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

126 
l
.
dh_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

127 #ifdeà
CUDNN


128 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wf
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wf->
out_c
,†.wf->
out_h
,†.wf->
out_w
);

129 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wi
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wi->
out_c
,†.wi->
out_h
,†.wi->
out_w
);

130 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wg
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wg->
out_c
,†.wg->
out_h
,†.wg->
out_w
);

131 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
wo
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.wo->
out_c
,†.wo->
out_h
,†.wo->
out_w
);

133 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
uf
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.uf->
out_c
,†.uf->
out_h
,†.uf->
out_w
);

134 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
ui
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.ui->
out_c
,†.ui->
out_h
,†.ui->
out_w
);

135 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
ug
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.ug->
out_c
,†.ug->
out_h
,†.ug->
out_w
);

136 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
uo
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.uo->
out_c
,†.uo->
out_h
,†.uo->
out_w
);

141  
l
;

142 
	}
}

144 
	$upd©e_l¡m_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

146 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wf
), 
a
);

147 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wi
), 
a
);

148 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wg
), 
a
);

149 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
wo
), 
a
);

150 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
uf
), 
a
);

151 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
ui
), 
a
);

152 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
ug
), 
a
);

153 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
uo
), 
a
);

154 
	}
}

156 
	$fÜw¬d_l¡m_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
)

158 
ÃtwÜk
 
s
 = { 0 };

159 
s
.
Œaš
 = 
¡©e
.train;

160 
i
;

161 
Ïy”
 
wf
 = *(
l
.wf);

162 
Ïy”
 
wi
 = *(
l
.wi);

163 
Ïy”
 
wg
 = *(
l
.wg);

164 
Ïy”
 
wo
 = *(
l
.wo);

166 
Ïy”
 
uf
 = *(
l
.uf);

167 
Ïy”
 
ui
 = *(
l
.ui);

168 
Ïy”
 
ug
 = *(
l
.ug);

169 
Ïy”
 
uo
 = *(
l
.uo);

171 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wf
.
d–
, 1);

172 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wi
.
d–
, 1);

173 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wg
.
d–
, 1);

174 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wo
.
d–
, 1);

176 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uf
.
d–
, 1);

177 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ui
.
d–
, 1);

178 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ug
.
d–
, 1);

179 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uo
.
d–
, 1);

180 ià(
¡©e
.
Œaš
) {

181 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0,†.
d–
, 1);

184 
i
 = 0; i < 
l
.
¡•s
; ++i) {

185 
s
.
šput
 = 
l
.
h_ıu
;

186 
	`fÜw¬d_cÚÃùed_Ïy”
(
wf
, 
s
);

187 
	`fÜw¬d_cÚÃùed_Ïy”
(
wi
, 
s
);

188 
	`fÜw¬d_cÚÃùed_Ïy”
(
wg
, 
s
);

189 
	`fÜw¬d_cÚÃùed_Ïy”
(
wo
, 
s
);

191 
s
.
šput
 = 
¡©e
.input;

192 
	`fÜw¬d_cÚÃùed_Ïy”
(
uf
, 
s
);

193 
	`fÜw¬d_cÚÃùed_Ïy”
(
ui
, 
s
);

194 
	`fÜw¬d_cÚÃùed_Ïy”
(
ug
, 
s
);

195 
	`fÜw¬d_cÚÃùed_Ïy”
(
uo
, 
s
);

197 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wf
.
ouut
, 1,†.
f_ıu
, 1);

198 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
uf
.
ouut
, 1,†.
f_ıu
, 1);

200 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wi
.
ouut
, 1,†.
i_ıu
, 1);

201 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
ui
.
ouut
, 1,†.
i_ıu
, 1);

203 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wg
.
ouut
, 1,†.
g_ıu
, 1);

204 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
ug
.
ouut
, 1,†.
g_ıu
, 1);

206 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wo
.
ouut
, 1,†.
o_ıu
, 1);

207 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
uo
.
ouut
, 1,†.
o_ıu
, 1);

209 
	`aùiv©e_¬¿y
(
l
.
f_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

210 
	`aùiv©e_¬¿y
(
l
.
i_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

211 
	`aùiv©e_¬¿y
(
l
.
g_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
);

212 
	`aùiv©e_¬¿y
(
l
.
o_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

214 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
i_ıu
, 1,†.
‹mp_ıu
, 1);

215 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
g_ıu
, 1,†.
‹mp_ıu
, 1);

216 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
f_ıu
, 1,†.
c_ıu
, 1);

217 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1,†.
‹mp_ıu
, 1,†.
c_ıu
, 1);

219 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
c_ıu
, 1,†.
h_ıu
, 1);

220 
	`aùiv©e_¬¿y
(
l
.
h_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
);

221 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
o_ıu
, 1,†.
h_ıu
, 1);

223 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
c_ıu
, 1,†.
ûÎ_ıu
, 1);

224 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
h_ıu
, 1,†.
ouut
, 1);

226 
¡©e
.
šput
 +ğ
l
.
šputs
*l.
b©ch
;

227 
l
.
ouut
 +ğl.
ouuts
*l.
b©ch
;

228 
l
.
ûÎ_ıu
 +ğl.
ouuts
*l.
b©ch
;

230 
	`šüem’t_Ïy”
(&
wf
, 1);

231 
	`šüem’t_Ïy”
(&
wi
, 1);

232 
	`šüem’t_Ïy”
(&
wg
, 1);

233 
	`šüem’t_Ïy”
(&
wo
, 1);

235 
	`šüem’t_Ïy”
(&
uf
, 1);

236 
	`šüem’t_Ïy”
(&
ui
, 1);

237 
	`šüem’t_Ïy”
(&
ug
, 1);

238 
	`šüem’t_Ïy”
(&
uo
, 1);

240 
	}
}

242 
	$backw¬d_l¡m_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
)

244 
ÃtwÜk
 
s
 = { 0 };

245 
s
.
Œaš
 = 
¡©e
.train;

246 
i
;

247 
Ïy”
 
wf
 = *(
l
.wf);

248 
Ïy”
 
wi
 = *(
l
.wi);

249 
Ïy”
 
wg
 = *(
l
.wg);

250 
Ïy”
 
wo
 = *(
l
.wo);

252 
Ïy”
 
uf
 = *(
l
.uf);

253 
Ïy”
 
ui
 = *(
l
.ui);

254 
Ïy”
 
ug
 = *(
l
.ug);

255 
Ïy”
 
uo
 = *(
l
.uo);

257 
	`šüem’t_Ïy”
(&
wf
, 
l
.
¡•s
 - 1);

258 
	`šüem’t_Ïy”
(&
wi
, 
l
.
¡•s
 - 1);

259 
	`šüem’t_Ïy”
(&
wg
, 
l
.
¡•s
 - 1);

260 
	`šüem’t_Ïy”
(&
wo
, 
l
.
¡•s
 - 1);

262 
	`šüem’t_Ïy”
(&
uf
, 
l
.
¡•s
 - 1);

263 
	`šüem’t_Ïy”
(&
ui
, 
l
.
¡•s
 - 1);

264 
	`šüem’t_Ïy”
(&
ug
, 
l
.
¡•s
 - 1);

265 
	`šüem’t_Ïy”
(&
uo
, 
l
.
¡•s
 - 1);

267 
¡©e
.
šput
 +ğ
l
.
šputs
*l.
b©ch
*Ö.
¡•s
 - 1);

268 ià(
¡©e
.
d–
è¡©e.d– +ğ
l
.
šputs
*l.
b©ch
*Ö.
¡•s
 - 1);

270 
l
.
ouut
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
 - 1);

271 
l
.
ûÎ_ıu
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
 - 1);

272 
l
.
d–
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
 - 1);

274 
i
 = 
l
.
¡•s
 - 1; i >= 0; --i) {

275 ià(
i
 !ğ0è
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ûÎ_ıu
 -†.ouuts*l.b©ch, 1,†.
´ev_ûÎ_ıu
, 1);

276 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ûÎ_ıu
, 1,†.
c_ıu
, 1);

277 ià(
i
 !ğ0è
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ouut
 -†.ouuts*l.b©ch, 1,†.
´ev_¡©e_ıu
, 1);

278 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
ouut
, 1,†.
h_ıu
, 1);

280 
l
.
dh_ıu
 = (
i
 =ğ0è? 0 :†.
d–
 -†.
ouuts
*l.
b©ch
;

282 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wf
.
ouut
, 1,†.
f_ıu
, 1);

283 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
uf
.
ouut
, 1,†.
f_ıu
, 1);

285 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wi
.
ouut
, 1,†.
i_ıu
, 1);

286 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
ui
.
ouut
, 1,†.
i_ıu
, 1);

288 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wg
.
ouut
, 1,†.
g_ıu
, 1);

289 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
ug
.
ouut
, 1,†.
g_ıu
, 1);

291 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
wo
.
ouut
, 1,†.
o_ıu
, 1);

292 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1, 
uo
.
ouut
, 1,†.
o_ıu
, 1);

294 
	`aùiv©e_¬¿y
(
l
.
f_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

295 
	`aùiv©e_¬¿y
(
l
.
i_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

296 
	`aùiv©e_¬¿y
(
l
.
g_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
);

297 
	`aùiv©e_¬¿y
(
l
.
o_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

299 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
d–
, 1,†.
‹mp3_ıu
, 1);

301 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
c_ıu
, 1,†.
‹mp_ıu
, 1);

302 
	`aùiv©e_¬¿y
(
l
.
‹mp_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
);

304 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp3_ıu
, 1,†.
‹mp2_ıu
, 1);

305 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
o_ıu
, 1,†.
‹mp2_ıu
, 1);

307 
	`g¿d›Á_¬¿y
(
l
.
‹mp_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
,†.
‹mp2_ıu
);

308 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
, 1,†.
dc_ıu
, 1,†.
‹mp2_ıu
, 1);

310 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
c_ıu
, 1,†.
‹mp_ıu
, 1);

311 
	`aùiv©e_¬¿y
(
l
.
‹mp_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
);

312 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp3_ıu
, 1,†.
‹mp_ıu
, 1);

313 
	`g¿d›Á_¬¿y
(
l
.
o_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
,†.
‹mp_ıu
);

314 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
wo
.
d–
, 1);

315 
s
.
šput
 = 
l
.
´ev_¡©e_ıu
;

316 
s
.
d–
 = 
l
.
dh_ıu
;

317 
	`backw¬d_cÚÃùed_Ïy”
(
wo
, 
s
);

319 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
uo
.
d–
, 1);

320 
s
.
šput
 = 
¡©e
.input;

321 
s
.
d–
 = 
¡©e
.delta;

322 
	`backw¬d_cÚÃùed_Ïy”
(
uo
, 
s
);

324 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_ıu
, 1,†.
‹mp_ıu
, 1);

325 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
i_ıu
, 1,†.
‹mp_ıu
, 1);

326 
	`g¿d›Á_¬¿y
(
l
.
g_ıu
,†.
ouuts
*l.
b©ch
, 
TANH
,†.
‹mp_ıu
);

327 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
wg
.
d–
, 1);

328 
s
.
šput
 = 
l
.
´ev_¡©e_ıu
;

329 
s
.
d–
 = 
l
.
dh_ıu
;

330 
	`backw¬d_cÚÃùed_Ïy”
(
wg
, 
s
);

332 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
ug
.
d–
, 1);

333 
s
.
šput
 = 
¡©e
.input;

334 
s
.
d–
 = 
¡©e
.delta;

335 
	`backw¬d_cÚÃùed_Ïy”
(
ug
, 
s
);

337 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_ıu
, 1,†.
‹mp_ıu
, 1);

338 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
g_ıu
, 1,†.
‹mp_ıu
, 1);

339 
	`g¿d›Á_¬¿y
(
l
.
i_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
,†.
‹mp_ıu
);

340 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
wi
.
d–
, 1);

341 
s
.
šput
 = 
l
.
´ev_¡©e_ıu
;

342 
s
.
d–
 = 
l
.
dh_ıu
;

343 
	`backw¬d_cÚÃùed_Ïy”
(
wi
, 
s
);

345 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
ui
.
d–
, 1);

346 
s
.
šput
 = 
¡©e
.input;

347 
s
.
d–
 = 
¡©e
.delta;

348 
	`backw¬d_cÚÃùed_Ïy”
(
ui
, 
s
);

350 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_ıu
, 1,†.
‹mp_ıu
, 1);

351 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
´ev_ûÎ_ıu
, 1,†.
‹mp_ıu
, 1);

352 
	`g¿d›Á_¬¿y
(
l
.
f_ıu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
,†.
‹mp_ıu
);

353 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
wf
.
d–
, 1);

354 
s
.
šput
 = 
l
.
´ev_¡©e_ıu
;

355 
s
.
d–
 = 
l
.
dh_ıu
;

356 
	`backw¬d_cÚÃùed_Ïy”
(
wf
, 
s
);

358 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1, 
uf
.
d–
, 1);

359 
s
.
šput
 = 
¡©e
.input;

360 
s
.
d–
 = 
¡©e
.delta;

361 
	`backw¬d_cÚÃùed_Ïy”
(
uf
, 
s
);

363 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_ıu
, 1,†.
‹mp_ıu
, 1);

364 
	`mul_ıu
(
l
.
ouuts
*l.
b©ch
,†.
f_ıu
, 1,†.
‹mp_ıu
, 1);

365 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_ıu
, 1,†.
dc_ıu
, 1);

367 
¡©e
.
šput
 -ğ
l
.
šputs
*l.
b©ch
;

368 ià(
¡©e
.
d–
è¡©e.d– -ğ
l
.
šputs
*l.
b©ch
;

369 
l
.
ouut
 -ğl.
ouuts
*l.
b©ch
;

370 
l
.
ûÎ_ıu
 -ğl.
ouuts
*l.
b©ch
;

371 
l
.
d–
 -ğl.
ouuts
*l.
b©ch
;

373 
	`šüem’t_Ïy”
(&
wf
, -1);

374 
	`šüem’t_Ïy”
(&
wi
, -1);

375 
	`šüem’t_Ïy”
(&
wg
, -1);

376 
	`šüem’t_Ïy”
(&
wo
, -1);

378 
	`šüem’t_Ïy”
(&
uf
, -1);

379 
	`šüem’t_Ïy”
(&
ui
, -1);

380 
	`šüem’t_Ïy”
(&
ug
, -1);

381 
	`šüem’t_Ïy”
(&
uo
, -1);

383 
	}
}

385 #ifdeà
GPU


386 
	$upd©e_l¡m_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

388 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wf
), 
a
);

389 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wi
), 
a
);

390 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wg
), 
a
);

391 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
wo
), 
a
);

392 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
uf
), 
a
);

393 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
ui
), 
a
);

394 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
ug
), 
a
);

395 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
uo
), 
a
);

396 
	}
}

398 
	$fÜw¬d_l¡m_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
)

400 
ÃtwÜk
 
s
 = { 0 };

401 
s
.
Œaš
 = 
¡©e
.train;

402 
i
;

403 
Ïy”
 
wf
 = *(
l
.wf);

404 
Ïy”
 
wi
 = *(
l
.wi);

405 
Ïy”
 
wg
 = *(
l
.wg);

406 
Ïy”
 
wo
 = *(
l
.wo);

408 
Ïy”
 
uf
 = *(
l
.uf);

409 
Ïy”
 
ui
 = *(
l
.ui);

410 
Ïy”
 
ug
 = *(
l
.ug);

411 
Ïy”
 
uo
 = *(
l
.uo);

413 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wf
.
d–_gpu
, 1);

414 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wi
.
d–_gpu
, 1);

415 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wg
.
d–_gpu
, 1);

416 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
wo
.
d–_gpu
, 1);

418 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uf
.
d–_gpu
, 1);

419 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ui
.
d–_gpu
, 1);

420 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ug
.
d–_gpu
, 1);

421 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
uo
.
d–_gpu
, 1);

422 ià(
¡©e
.
Œaš
) {

423 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0,†.
d–_gpu
, 1);

426 
i
 = 0; i < 
l
.
¡•s
; ++i) {

427 
s
.
šput_gpu
 = 
l
.
h_gpu
;

428 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wf
, 
s
);

429 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wi
, 
s
);

430 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wg
, 
s
);

431 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
wo
, 
s
);

433 
s
.
šput_gpu
 = 
¡©e
.input_gpu;

434 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
uf
, 
s
);

435 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
ui
, 
s
);

436 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
ug
, 
s
);

437 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
uo
, 
s
);

439 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wf
.
ouut_gpu
, 1,†.
f_gpu
, 1);

440 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
uf
.
ouut_gpu
, 1,†.
f_gpu
, 1);

442 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wi
.
ouut_gpu
, 1,†.
i_gpu
, 1);

443 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
ui
.
ouut_gpu
, 1,†.
i_gpu
, 1);

445 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wg
.
ouut_gpu
, 1,†.
g_gpu
, 1);

446 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
ug
.
ouut_gpu
, 1,†.
g_gpu
, 1);

448 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wo
.
ouut_gpu
, 1,†.
o_gpu
, 1);

449 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
uo
.
ouut_gpu
, 1,†.
o_gpu
, 1);

451 
	`aùiv©e_¬¿y_gpu
(
l
.
f_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

452 
	`aùiv©e_¬¿y_gpu
(
l
.
i_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

453 
	`aùiv©e_¬¿y_gpu
(
l
.
g_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

454 
	`aùiv©e_¬¿y_gpu
(
l
.
o_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

456 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
i_gpu
, 1,†.
‹mp_gpu
, 1);

457 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
g_gpu
, 1,†.
‹mp_gpu
, 1);

458 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
f_gpu
, 1,†.
c_gpu
, 1);

459 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1,†.
‹mp_gpu
, 1,†.
c_gpu
, 1);

461 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
c_gpu
, 1,†.
h_gpu
, 1);

462 
	`aùiv©e_¬¿y_gpu
(
l
.
h_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

463 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
o_gpu
, 1,†.
h_gpu
, 1);

465 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
c_gpu
, 1,†.
ûÎ_gpu
, 1);

466 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
h_gpu
, 1,†.
ouut_gpu
, 1);

468 
¡©e
.
šput_gpu
 +ğ
l
.
šputs
*l.
b©ch
;

469 
l
.
ouut_gpu
 +ğl.
ouuts
*l.
b©ch
;

470 
l
.
ûÎ_gpu
 +ğl.
ouuts
*l.
b©ch
;

472 
	`šüem’t_Ïy”
(&
wf
, 1);

473 
	`šüem’t_Ïy”
(&
wi
, 1);

474 
	`šüem’t_Ïy”
(&
wg
, 1);

475 
	`šüem’t_Ïy”
(&
wo
, 1);

477 
	`šüem’t_Ïy”
(&
uf
, 1);

478 
	`šüem’t_Ïy”
(&
ui
, 1);

479 
	`šüem’t_Ïy”
(&
ug
, 1);

480 
	`šüem’t_Ïy”
(&
uo
, 1);

482 
	}
}

484 
	$backw¬d_l¡m_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
¡©e
)

486 
ÃtwÜk
 
s
 = { 0 };

487 
s
.
Œaš
 = 
¡©e
.train;

488 
i
;

489 
Ïy”
 
wf
 = *(
l
.wf);

490 
Ïy”
 
wi
 = *(
l
.wi);

491 
Ïy”
 
wg
 = *(
l
.wg);

492 
Ïy”
 
wo
 = *(
l
.wo);

494 
Ïy”
 
uf
 = *(
l
.uf);

495 
Ïy”
 
ui
 = *(
l
.ui);

496 
Ïy”
 
ug
 = *(
l
.ug);

497 
Ïy”
 
uo
 = *(
l
.uo);

499 
	`šüem’t_Ïy”
(&
wf
, 
l
.
¡•s
 - 1);

500 
	`šüem’t_Ïy”
(&
wi
, 
l
.
¡•s
 - 1);

501 
	`šüem’t_Ïy”
(&
wg
, 
l
.
¡•s
 - 1);

502 
	`šüem’t_Ïy”
(&
wo
, 
l
.
¡•s
 - 1);

504 
	`šüem’t_Ïy”
(&
uf
, 
l
.
¡•s
 - 1);

505 
	`šüem’t_Ïy”
(&
ui
, 
l
.
¡•s
 - 1);

506 
	`šüem’t_Ïy”
(&
ug
, 
l
.
¡•s
 - 1);

507 
	`šüem’t_Ïy”
(&
uo
, 
l
.
¡•s
 - 1);

509 
¡©e
.
šput_gpu
 +ğ
l
.
šputs
*l.
b©ch
*Ö.
¡•s
 - 1);

510 ià(
¡©e
.
d–_gpu
è¡©e.d–_gpu +ğ
l
.
šputs
*l.
b©ch
*Ö.
¡•s
 - 1);

512 
l
.
ouut_gpu
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
 - 1);

513 
l
.
ûÎ_gpu
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
 - 1);

514 
l
.
d–_gpu
 +ğl.
ouuts
*l.
b©ch
*Ö.
¡•s
 - 1);

516 
i
 = 
l
.
¡•s
 - 1; i >= 0; --i) {

517 ià(
i
 !ğ0è
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ûÎ_gpu
 -†.ouuts*l.b©ch, 1,†.
´ev_ûÎ_gpu
, 1);

518 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ûÎ_gpu
, 1,†.
c_gpu
, 1);

519 ià(
i
 !ğ0è
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
 -†.ouuts*l.b©ch, 1,†.
´ev_¡©e_gpu
, 1);

520 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
ouut_gpu
, 1,†.
h_gpu
, 1);

522 
l
.
dh_gpu
 = (
i
 =ğ0è? 0 :†.
d–_gpu
 -†.
ouuts
*l.
b©ch
;

524 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wf
.
ouut_gpu
, 1,†.
f_gpu
, 1);

525 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
uf
.
ouut_gpu
, 1,†.
f_gpu
, 1);

527 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wi
.
ouut_gpu
, 1,†.
i_gpu
, 1);

528 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
ui
.
ouut_gpu
, 1,†.
i_gpu
, 1);

530 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wg
.
ouut_gpu
, 1,†.
g_gpu
, 1);

531 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
ug
.
ouut_gpu
, 1,†.
g_gpu
, 1);

533 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
wo
.
ouut_gpu
, 1,†.
o_gpu
, 1);

534 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1, 
uo
.
ouut_gpu
, 1,†.
o_gpu
, 1);

536 
	`aùiv©e_¬¿y_gpu
(
l
.
f_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

537 
	`aùiv©e_¬¿y_gpu
(
l
.
i_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

538 
	`aùiv©e_¬¿y_gpu
(
l
.
g_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

539 
	`aùiv©e_¬¿y_gpu
(
l
.
o_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
);

541 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
d–_gpu
, 1,†.
‹mp3_gpu
, 1);

543 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
c_gpu
, 1,†.
‹mp_gpu
, 1);

544 
	`aùiv©e_¬¿y_gpu
(
l
.
‹mp_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

546 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp3_gpu
, 1,†.
‹mp2_gpu
, 1);

547 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
o_gpu
, 1,†.
‹mp2_gpu
, 1);

549 
	`g¿d›Á_¬¿y_gpu
(
l
.
‹mp_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
,†.
‹mp2_gpu
);

550 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
, 1,†.
dc_gpu
, 1,†.
‹mp2_gpu
, 1);

552 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
c_gpu
, 1,†.
‹mp_gpu
, 1);

553 
	`aùiv©e_¬¿y_gpu
(
l
.
‹mp_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
);

554 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp3_gpu
, 1,†.
‹mp_gpu
, 1);

555 
	`g¿d›Á_¬¿y_gpu
(
l
.
o_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
,†.
‹mp_gpu
);

556 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
wo
.
d–_gpu
, 1);

557 
s
.
šput_gpu
 = 
l
.
´ev_¡©e_gpu
;

558 
s
.
d–_gpu
 = 
l
.
dh_gpu
;

559 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wo
, 
s
);

561 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
uo
.
d–_gpu
, 1);

562 
s
.
šput_gpu
 = 
¡©e
.input_gpu;

563 
s
.
d–_gpu
 = 
¡©e
.delta_gpu;

564 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
uo
, 
s
);

566 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_gpu
, 1,†.
‹mp_gpu
, 1);

567 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
i_gpu
, 1,†.
‹mp_gpu
, 1);

568 
	`g¿d›Á_¬¿y_gpu
(
l
.
g_gpu
,†.
ouuts
*l.
b©ch
, 
TANH
,†.
‹mp_gpu
);

569 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
wg
.
d–_gpu
, 1);

570 
s
.
šput_gpu
 = 
l
.
´ev_¡©e_gpu
;

571 
s
.
d–_gpu
 = 
l
.
dh_gpu
;

572 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wg
, 
s
);

574 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
ug
.
d–_gpu
, 1);

575 
s
.
šput_gpu
 = 
¡©e
.input_gpu;

576 
s
.
d–_gpu
 = 
¡©e
.delta_gpu;

577 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
ug
, 
s
);

579 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_gpu
, 1,†.
‹mp_gpu
, 1);

580 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
g_gpu
, 1,†.
‹mp_gpu
, 1);

581 
	`g¿d›Á_¬¿y_gpu
(
l
.
i_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
,†.
‹mp_gpu
);

582 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
wi
.
d–_gpu
, 1);

583 
s
.
šput_gpu
 = 
l
.
´ev_¡©e_gpu
;

584 
s
.
d–_gpu
 = 
l
.
dh_gpu
;

585 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wi
, 
s
);

587 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
ui
.
d–_gpu
, 1);

588 
s
.
šput_gpu
 = 
¡©e
.input_gpu;

589 
s
.
d–_gpu
 = 
¡©e
.delta_gpu;

590 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
ui
, 
s
);

592 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_gpu
, 1,†.
‹mp_gpu
, 1);

593 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
´ev_ûÎ_gpu
, 1,†.
‹mp_gpu
, 1);

594 
	`g¿d›Á_¬¿y_gpu
(
l
.
f_gpu
,†.
ouuts
*l.
b©ch
, 
LOGISTIC
,†.
‹mp_gpu
);

595 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
wf
.
d–_gpu
, 1);

596 
s
.
šput_gpu
 = 
l
.
´ev_¡©e_gpu
;

597 
s
.
d–_gpu
 = 
l
.
dh_gpu
;

598 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
wf
, 
s
);

600 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1, 
uf
.
d–_gpu
, 1);

601 
s
.
šput_gpu
 = 
¡©e
.input_gpu;

602 
s
.
d–_gpu
 = 
¡©e
.delta_gpu;

603 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
uf
, 
s
);

605 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp2_gpu
, 1,†.
‹mp_gpu
, 1);

606 
	`mul_gpu
(
l
.
ouuts
*l.
b©ch
,†.
f_gpu
, 1,†.
‹mp_gpu
, 1);

607 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
‹mp_gpu
, 1,†.
dc_gpu
, 1);

609 
¡©e
.
šput_gpu
 -ğ
l
.
šputs
*l.
b©ch
;

610 ià(
¡©e
.
d–_gpu
è¡©e.d–_gpu -ğ
l
.
šputs
*l.
b©ch
;

611 
l
.
ouut_gpu
 -ğl.
ouuts
*l.
b©ch
;

612 
l
.
ûÎ_gpu
 -ğl.
ouuts
*l.
b©ch
;

613 
l
.
d–_gpu
 -ğl.
ouuts
*l.
b©ch
;

615 
	`šüem’t_Ïy”
(&
wf
, -1);

616 
	`šüem’t_Ïy”
(&
wi
, -1);

617 
	`šüem’t_Ïy”
(&
wg
, -1);

618 
	`šüem’t_Ïy”
(&
wo
, -1);

620 
	`šüem’t_Ïy”
(&
uf
, -1);

621 
	`šüem’t_Ïy”
(&
ui
, -1);

622 
	`šüem’t_Ïy”
(&
ug
, -1);

623 
	`šüem’t_Ïy”
(&
uo
, -1);

625 
	}
}

	@host/src/lstm_layer.h

1 #iâdeà
LSTM_LAYER_H


2 
	#LSTM_LAYER_H


	)

4 
	~"aùiv©iÚs.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

7 
	#USET


	)

9 
Ïy”
 
make_l¡m_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
¡•s
, 
b©ch_nÜm®ize
, 
adam
);

11 
fÜw¬d_l¡m_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
upd©e_l¡m_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

14 #ifdeà
GPU


15 
fÜw¬d_l¡m_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_l¡m_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 
upd©e_l¡m_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

	@host/src/matrix.c

1 
	~"m©rix.h
"

2 
	~"uts.h
"

3 
	~"bÏs.h
"

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<¡ršg.h
>

7 
	~<as£¹.h
>

8 
	~<m©h.h
>

10 
	$ä“_m©rix
(
m©rix
 
m
)

12 
i
;

13 
i
 = 0; i < 
m
.
rows
; ++iè
	`ä“
(m.
v®s
[i]);

14 
	`ä“
(
m
.
v®s
);

15 
	}
}

17 
	$m©rix_tİk_accu¿cy
(
m©rix
 
Œuth
, m©rix 
guess
, 
k
)

19 *
šdexes
 = 
	`ÿÎoc
(
k
, ());

20 
n
 = 
Œuth
.
cŞs
;

21 
i
,
j
;

22 
cÜ»ù
 = 0;

23 
i
 = 0; i < 
Œuth
.
rows
; ++i){

24 
	`tİ_k
(
guess
.
v®s
[
i
], 
n
, 
k
, 
šdexes
);

25 
j
 = 0; j < 
k
; ++j){

26 
şass
 = 
šdexes
[
j
];

27 if(
Œuth
.
v®s
[
i
][
şass
]){

28 ++
cÜ»ù
;

33 
	`ä“
(
šdexes
);

34  ()
cÜ»ù
/
Œuth
.
rows
;

35 
	}
}

37 
	$sÿË_m©rix
(
m©rix
 
m
, 
sÿË
)

39 
i
,
j
;

40 
i
 = 0; i < 
m
.
rows
; ++i){

41 
j
 = 0; j < 
m
.
cŞs
; ++j){

42 
m
.
v®s
[
i
][
j
] *ğ
sÿË
;

45 
	}
}

47 
m©rix
 
	$»size_m©rix
(
m©rix
 
m
, 
size
)

49 
i
;

50 ià(
m
.
rows
 =ğ
size
)  m;

51 ià(
m
.
rows
 < 
size
) {

52 
m
.
v®s
 = 
	`»®loc
(m.v®s, 
size
*(*));

53 
i
 = 
m
.
rows
; i < 
size
; ++i) {

54 
m
.
v®s
[
i
] = 
	`ÿÎoc
(m.
cŞs
, ());

56 } ià(
m
.
rows
 > 
size
) {

57 
i
 = 
size
; i < 
m
.
rows
; ++i) {

58 
	`ä“
(
m
.
v®s
[
i
]);

60 
m
.
v®s
 = 
	`»®loc
(m.v®s, 
size
*(*));

62 
m
.
rows
 = 
size
;

63  
m
;

64 
	}
}

66 
	$m©rix_add_m©rix
(
m©rix
 
äom
, m©rix 
to
)

68 
	`as£¹
(
äom
.
rows
 =ğ
to
.row && from.
cŞs
 ==o.cols);

69 
i
,
j
;

70 
i
 = 0; i < 
äom
.
rows
; ++i){

71 
j
 = 0; j < 
äom
.
cŞs
; ++j){

72 
to
.
v®s
[
i
][
j
] +ğ
äom
.vals[i][j];

75 
	}
}

77 
m©rix
 
	$cİy_m©rix
(
m©rix
 
m
)

79 
m©rix
 
c
 = {0};

80 
c
.
rows
 = 
m
.rows;

81 
c
.
cŞs
 = 
m
.cols;

82 
c
.
v®s
 = 
	`ÿÎoc
(c.
rows
, (*));

83 
i
;

84 
i
 = 0; i < 
c
.
rows
; ++i){

85 
c
.
v®s
[
i
] = 
	`ÿÎoc
(c.
cŞs
, ());

86 
	`cİy_ıu
(
c
.
cŞs
, 
m
.
v®s
[
i
], 1, c.vals[i], 1);

88  
c
;

89 
	}
}

91 
m©rix
 
	$make_m©rix
(
rows
, 
cŞs
)

93 
i
;

94 
m©rix
 
m
;

95 
m
.
rows
 =„ows;

96 
m
.
cŞs
 = cols;

97 
m
.
v®s
 = 
	`ÿÎoc
(m.
rows
, (*));

98 
i
 = 0; i < 
m
.
rows
; ++i){

99 
m
.
v®s
[
i
] = 
	`ÿÎoc
(m.
cŞs
, ());

101  
m
;

102 
	}
}

104 
m©rix
 
	$hŞd_out_m©rix
(
m©rix
 *
m
, 
n
)

106 
i
;

107 
m©rix
 
h
;

108 
h
.
rows
 = 
n
;

109 
h
.
cŞs
 = 
m
->cols;

110 
h
.
v®s
 = 
	`ÿÎoc
(h.
rows
, (*));

111 
i
 = 0; i < 
n
; ++i){

112 
šdex
 = 
	`¿nd
()%
m
->
rows
;

113 
h
.
v®s
[
i
] = 
m
->v®s[
šdex
];

114 
m
->
v®s
[
šdex
] = m->v®s[--(m->
rows
)];

116  
h
;

117 
	}
}

119 *
	$pİ_cŞumn
(
m©rix
 *
m
, 
c
)

121 *
cŞ
 = 
	`ÿÎoc
(
m
->
rows
, ());

122 
i
, 
j
;

123 
i
 = 0; i < 
m
->
rows
; ++i){

124 
cŞ
[
i
] = 
m
->
v®s
[i][
c
];

125 
j
 = 
c
; j < 
m
->
cŞs
-1; ++j){

126 
m
->
v®s
[
i
][
j
] = m->vals[i][j+1];

129 --
m
->
cŞs
;

130  
cŞ
;

131 
	}
}

133 
m©rix
 
	$csv_to_m©rix
(*
f’ame
)

135 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "r");

136 if(!
å
è
	`fe_”rÜ
(
f’ame
);

138 
m©rix
 
m
;

139 
m
.
cŞs
 = -1;

141 *
lše
;

143 
n
 = 0;

144 
size
 = 1024;

145 
m
.
v®s
 = 
	`ÿÎoc
(
size
, (*));

146 (
lše
 = 
	`fg‘l
(
å
))){

147 if(
m
.
cŞs
 =ğ-1èm.cŞ ğ
	`couÁ_f›lds
(
lše
);

148 if(
n
 =ğ
size
){

149 
size
 *= 2;

150 
m
.
v®s
 = 
	`»®loc
(m.v®s, 
size
*(*));

152 
m
.
v®s
[
n
] = 
	`·r£_f›lds
(
lše
, m.
cŞs
);

153 
	`ä“
(
lše
);

154 ++
n
;

156 
m
.
v®s
 = 
	`»®loc
(m.v®s, 
n
*(*));

157 
m
.
rows
 = 
n
;

158  
m
;

159 
	}
}

161 
	$m©rix_to_csv
(
m©rix
 
m
)

163 
i
, 
j
;

165 
i
 = 0; i < 
m
.
rows
; ++i){

166 
j
 = 0; j < 
m
.
cŞs
; ++j){

167 if(
j
 > 0è
	`´štf
(",");

168 
	`´štf
("%.17g", 
m
.
v®s
[
i
][
j
]);

170 
	`´štf
("\n");

172 
	}
}

174 
	$´št_m©rix
(
m©rix
 
m
)

176 
i
, 
j
;

177 
	`´štf
("%d X %d M©rix:\n",
m
.
rows
, m.
cŞs
);

178 
	`´štf
(" __");

179 
j
 = 0; j < 16*
m
.
cŞs
-1; ++jè
	`´štf
(" ");

180 
	`´štf
("__ \n");

182 
	`´štf
("| ");

183 
j
 = 0; j < 16*
m
.
cŞs
-1; ++jè
	`´štf
(" ");

184 
	`´štf
(" |\n");

186 
i
 = 0; i < 
m
.
rows
; ++i){

187 
	`´štf
("| ");

188 
j
 = 0; j < 
m
.
cŞs
; ++j){

189 
	`´štf
("%15.7à", 
m
.
v®s
[
i
][
j
]);

191 
	`´štf
(" |\n");

193 
	`´štf
("|__");

194 
j
 = 0; j < 16*
m
.
cŞs
-1; ++jè
	`´štf
(" ");

195 
	`´štf
("__|\n");

196 
	}
}

	@host/src/matrix.h

1 #iâdeà
MATRIX_H


2 
	#MATRIX_H


	)

3 
	~"d¬kÃt.h
"

5 
m©rix
 
cİy_m©rix
(m©rix 
m
);

6 
´št_m©rix
(
m©rix
 
m
);

8 
m©rix
 
hŞd_out_m©rix
(m©rix *
m
, 
n
);

9 
m©rix
 
»size_m©rix
(m©rix 
m
, 
size
);

11 *
pİ_cŞumn
(
m©rix
 *
m
, 
c
);

	@host/src/maxpool_layer.c

1 
	~"maxpoŞ_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~"·r£r.h
"

5 
	~<¡dio.h
>

7 
image
 
	$g‘_maxpoŞ_image
(
maxpoŞ_Ïy”
 
l
)

9 
h
 = 
l
.
out_h
;

10 
w
 = 
l
.
out_w
;

11 
c
 = 
l
.c;

12  
	`æßt_to_image
(
w
,
h
,
c
,
l
.
ouut
);

13 
	}
}

15 
image
 
	$g‘_maxpoŞ_d–
(
maxpoŞ_Ïy”
 
l
)

17 
h
 = 
l
.
out_h
;

18 
w
 = 
l
.
out_w
;

19 
c
 = 
l
.c;

20  
	`æßt_to_image
(
w
,
h
,
c
,
l
.
d–
);

21 
	}
}

23 
maxpoŞ_Ïy”
 
	$make_maxpoŞ_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
)

25 
maxpoŞ_Ïy”
 
l
 = {0};

26 
l
.
ty³
 = 
MAXPOOL
;

27 
l
.
b©ch
 = batch;

28 
l
.
h
 = h;

29 
l
.
w
 = w;

30 
l
.
c
 = c;

31 
l
.
·d
 = 
·ddšg
;

32 
l
.
out_w
 = (
w
 + 
·ddšg
 - 
size
)/
¡ride
 + 1;

33 
l
.
out_h
 = (
h
 + 
·ddšg
 - 
size
)/
¡ride
 + 1;

34 
l
.
out_c
 = 
c
;

35 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

36 
l
.
šputs
 = 
h
*
w
*
c
;

37 
l
.
size
 = size;

38 
l
.
¡ride
 = stride;

39 
ouut_size
 = 
l
.
out_h
 *†.
out_w
 *†.
out_c
 * 
b©ch
;

40 
l
.
šdexes
 = 
	`ÿÎoc
(
ouut_size
, ());

41 
l
.
ouut
 = 
	`ÿÎoc
(
ouut_size
, ());

43 
l
.
fÜw¬d
 = 
fÜw¬d_maxpoŞ_Ïy”
;

44 
l
.
backw¬d
 = 
backw¬d_maxpoŞ_Ïy”
;

45 #ifdeà
GPU


46 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_maxpoŞ_Ïy”_gpu
;

47 
l
.
backw¬d_gpu
 = 
backw¬d_maxpoŞ_Ïy”_gpu
;

48 
l
.
šdexes_gpu
 = 
	`cuda_make_št_¬¿y
(0, 
ouut_size
);

49 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
ouut_size
);

50 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
ouut_size
);

55 
	`årštf
(
¡d”r
, "max %d x %d / %d %4d x%4d x%4d -> %4d x%4d x%4d\n", 
size
, size, 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
);

57 
	`årštf
(
¡d”r
, "max_TA %d x %d / %d %4d x%4d x%4d -> %4d x%4d x%4d\n", 
size
, size, 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
);

59  
l
;

60 
	}
}

62 
	$»size_maxpoŞ_Ïy”
(
maxpoŞ_Ïy”
 *
l
, 
w
, 
h
)

64 
l
->
h
 = h;

65 
l
->
w
 = w;

66 
l
->
šputs
 = 
h
*
w
*l->
c
;

68 
l
->
out_w
 = (
w
 +†->
·d
 -†->
size
)/l->
¡ride
 + 1;

69 
l
->
out_h
 = (
h
 +†->
·d
 -†->
size
)/l->
¡ride
 + 1;

70 
l
->
ouuts
 =†->
out_w
 *†->
out_h
 *†->
c
;

71 
ouut_size
 = 
l
->
ouuts
 *†->
b©ch
;

73 
l
->
šdexes
 = 
	`»®loc
Ö->šdexes, 
ouut_size
 * ());

74 
l
->
ouut
 = 
	`»®loc
Ö->ouut, 
ouut_size
 * ());

75 
l
->
d–
 = 
	`»®loc
Ö->d–, 
ouut_size
 * ());

77 #ifdeà
GPU


78 
	`cuda_ä“
((*)
l
->
šdexes_gpu
);

79 
	`cuda_ä“
(
l
->
ouut_gpu
);

80 
	`cuda_ä“
(
l
->
d–_gpu
);

81 
l
->
šdexes_gpu
 = 
	`cuda_make_št_¬¿y
(0, 
ouut_size
);

82 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
, 
ouut_size
);

83 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
, 
ouut_size
);

85 
	}
}

87 
	$fÜw¬d_maxpoŞ_Ïy”
(cÚ¡ 
maxpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

89 
b
,
i
,
j
,
k
,
m
,
n
;

90 
w_off£t
 = -
l
.
·d
/2;

91 
h_off£t
 = -
l
.
·d
/2;

93 
h
 = 
l
.
out_h
;

94 
w
 = 
l
.
out_w
;

95 
c
 = 
l
.c;

97 
b
 = 0; b < 
l
.
b©ch
; ++b){

98 
k
 = 0; k < 
c
; ++k){

99 
i
 = 0; i < 
h
; ++i){

100 
j
 = 0; j < 
w
; ++j){

101 
out_šdex
 = 
j
 + 
w
*(
i
 + 
h
*(
k
 + 
c
*
b
));

102 
max
 = -
FLT_MAX
;

103 
max_i
 = -1;

104 
n
 = 0;‚ < 
l
.
size
; ++n){

105 
m
 = 0; m < 
l
.
size
; ++m){

106 
cur_h
 = 
h_off£t
 + 
i
*
l
.
¡ride
 + 
n
;

107 
cur_w
 = 
w_off£t
 + 
j
*
l
.
¡ride
 + 
m
;

108 
šdex
 = 
cur_w
 + 
l
.
w
*(
cur_h
 +†.
h
*(
k
 + 
b
*l.
c
));

109 
v®id
 = (
cur_h
 >ğ0 && cur_h < 
l
.
h
 &&

110 
cur_w
 >ğ0 && cur_w < 
l
.
w
);

111 
v®
 = (
v®id
 !ğ0è? 
Ãt
.
šput
[
šdex
] : -
FLT_MAX
;

112 
max_i
 = (
v®
 > 
max
è? 
šdex
 : max_i;

113 
max
 = (
v®
 > max) ? val : max;

116 
l
.
ouut
[
out_šdex
] = 
max
;

117 
l
.
šdexes
[
out_šdex
] = 
max_i
;

122 
	}
}

124 
	$backw¬d_maxpoŞ_Ïy”
(cÚ¡ 
maxpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

126 
i
;

127 
h
 = 
l
.
out_h
;

128 
w
 = 
l
.
out_w
;

129 
c
 = 
l
.c;

130 
i
 = 0; i < 
h
*
w
*
c
*
l
.
b©ch
; ++i){

131 
šdex
 = 
l
.
šdexes
[
i
];

132 
Ãt
.
d–
[
šdex
] +ğ
l
.d–[
i
];

134 
	}
}

	@host/src/maxpool_layer.h

1 #iâdeà
MAXPOOL_LAYER_H


2 
	#MAXPOOL_LAYER_H


	)

4 
	~"image.h
"

5 
	~"cuda.h
"

6 
	~"Ïy”.h
"

7 
	~"ÃtwÜk.h
"

9 
Ïy”
 
	tmaxpoŞ_Ïy”
;

11 
image
 
g‘_maxpoŞ_image
(
maxpoŞ_Ïy”
 
l
);

12 
maxpoŞ_Ïy”
 
make_maxpoŞ_Ïy”
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
);

13 
»size_maxpoŞ_Ïy”
(
maxpoŞ_Ïy”
 *
l
, 
w
, 
h
);

14 
fÜw¬d_maxpoŞ_Ïy”
(cÚ¡ 
maxpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
backw¬d_maxpoŞ_Ïy”
(cÚ¡ 
maxpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

17 #ifdeà
GPU


18 
fÜw¬d_maxpoŞ_Ïy”_gpu
(
maxpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

19 
backw¬d_maxpoŞ_Ïy”_gpu
(
maxpoŞ_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/network.c

2 
	~<¡dio.h
>

3 
	~<time.h
>

4 
	~<as£¹.h
>

5 
	~"ÃtwÜk.h
"

6 
	~"image.h
"

7 
	~"d©a.h
"

8 
	~"uts.h
"

9 
	~"bÏs.h
"

12 
	~"maš.h
"

15 
	~"üİ_Ïy”.h
"

16 
	~"cÚÃùed_Ïy”.h
"

17 
	~"gru_Ïy”.h
"

18 
	~"ºn_Ïy”.h
"

19 
	~"üÂ_Ïy”.h
"

20 
	~"loÿl_Ïy”.h
"

21 
	~"cÚvŞutiÚ®_Ïy”.h
"

22 
	~"aùiv©iÚ_Ïy”.h
"

23 
	~"d‘eùiÚ_Ïy”.h
"

24 
	~"»giÚ_Ïy”.h
"

25 
	~"yŞo_Ïy”.h
"

26 
	~"nÜm®iz©iÚ_Ïy”.h
"

27 
	~"b©chnÜm_Ïy”.h
"

28 
	~"maxpoŞ_Ïy”.h
"

29 
	~"»Üg_Ïy”.h
"

30 
	~"avgpoŞ_Ïy”.h
"

31 
	~"co¡_Ïy”.h
"

32 
	~"soámax_Ïy”.h
"

33 
	~"drİout_Ïy”.h
"

34 
	~"rou‹_Ïy”.h
"

35 
	~"up§m¶e_Ïy”.h
"

36 
	~"shÜtcut_Ïy”.h
"

37 
	~"·r£r.h
"

38 
	~"d©a.h
"

40 
lßd_¬gs
 
	$g‘_ba£_¬gs
(
ÃtwÜk
 *
Ãt
)

42 
lßd_¬gs
 
¬gs
 = {0};

43 
¬gs
.
w
 = 
Ãt
->w;

44 
¬gs
.
h
 = 
Ãt
->h;

45 
¬gs
.
size
 = 
Ãt
->
w
;

47 
¬gs
.
mš
 = 
Ãt
->
mš_üİ
;

48 
¬gs
.
max
 = 
Ãt
->
max_üİ
;

49 
¬gs
.
ªgË
 = 
Ãt
->angle;

50 
¬gs
.
a¥eù
 = 
Ãt
->aspect;

51 
¬gs
.
exposu»
 = 
Ãt
->exposure;

52 
¬gs
.
ûÁ”
 = 
Ãt
->center;

53 
¬gs
.
§tu¿tiÚ
 = 
Ãt
->saturation;

54 
¬gs
.
hue
 = 
Ãt
->hue;

55  
¬gs
;

56 
	}
}

58 
ÃtwÜk
 *
	$lßd_ÃtwÜk
(*
cfg
, *
weights
, 
ş—r
)

60 
ÃtwÜk
 *
Ãt
 = 
	`·r£_ÃtwÜk_cfg
(
cfg
);

61 if(
weights
 && weights[0] != 0){

62 
	`lßd_weights
(
Ãt
, 
weights
);

64 if(
ş—r
è(*
Ãt
->
£’
) = 0;

65  
Ãt
;

66 
	}
}

68 
size_t
 
	$g‘_cu¼’t_b©ch
(
ÃtwÜk
 *
Ãt
)

70 
size_t
 
b©ch_num
 = (*
Ãt
->
£’
)/Ò‘->
b©ch
*Ãt->
subdivisiÚs
);

71  
b©ch_num
;

72 
	}
}

74 
	$»£t_ÃtwÜk_¡©e
(
ÃtwÜk
 *
Ãt
, 
b
)

76 
i
;

77 
i
 = 0; i < 
Ãt
->
n
; ++i) {

78 #ifdeà
GPU


79 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

80 if(
l
.
¡©e_gpu
){

81 
	`fl_gpu
(
l
.
ouuts
, 0,†.
¡©e_gpu
 +†.ouuts*
b
, 1);

83 if(
l
.
h_gpu
){

84 
	`fl_gpu
(
l
.
ouuts
, 0,†.
h_gpu
 +†.ouuts*
b
, 1);

88 
	}
}

90 
	$»£t_ºn
(
ÃtwÜk
 *
Ãt
)

92 
	`»£t_ÃtwÜk_¡©e
(
Ãt
, 0);

93 
	}
}

95 
	$g‘_cu¼’t_¿‹
(
ÃtwÜk
 *
Ãt
)

97 
size_t
 
b©ch_num
 = 
	`g‘_cu¼’t_b©ch
(
Ãt
);

98 
i
;

99 
¿‹
;

100 ià(
b©ch_num
 < 
Ãt
->
buº_š
è‚‘->
Ë¬nšg_¿‹
 * 
	`pow
(()b©ch_num /‚‘->buº_š,‚‘->
pow”
);

101 
Ãt
->
pŞicy
) {

102 
CONSTANT
:

103  
Ãt
->
Ë¬nšg_¿‹
;

104 
STEP
:

105  
Ãt
->
Ë¬nšg_¿‹
 * 
	`pow
Ò‘->
sÿË
, 
b©ch_num
/Ãt->
¡•
);

106 
STEPS
:

107 
¿‹
 = 
Ãt
->
Ë¬nšg_¿‹
;

108 
i
 = 0; i < 
Ãt
->
num_¡•s
; ++i){

109 if(
Ãt
->
¡•s
[
i
] > 
b©ch_num
è 
¿‹
;

110 
¿‹
 *ğ
Ãt
->
sÿËs
[
i
];

112  
¿‹
;

113 
EXP
:

114  
Ãt
->
Ë¬nšg_¿‹
 * 
	`pow
Ò‘->
gamma
, 
b©ch_num
);

115 
POLY
:

116  
Ãt
->
Ë¬nšg_¿‹
 * 
	`pow
(1 - ()
b©ch_num
 /‚‘->
max_b©ches
,‚‘->
pow”
);

117 
RANDOM
:

118  
Ãt
->
Ë¬nšg_¿‹
 * 
	`pow
(
	`¿nd_unifÜm
(0,1),‚‘->
pow”
);

119 
SIG
:

120  
Ãt
->
Ë¬nšg_¿‹
 * (1./(1.+
	`exp
Ò‘->
gamma
*(
b©ch_num
 -‚‘->
¡•
))));

122 
	`årštf
(
¡d”r
, "Policy is weird!\n");

123  
Ãt
->
Ë¬nšg_¿‹
;

125 
	}
}

127 *
	$g‘_Ïy”_¡ršg
(
LAYER_TYPE
 
a
)

129 
a
){

130 
CONVOLUTIONAL
:

132 
ACTIVE
:

134 
LOCAL
:

136 
DECONVOLUTIONAL
:

138 
CONNECTED
:

140 
RNN
:

142 
GRU
:

144 
LSTM
:

146 
CRNN
:

148 
MAXPOOL
:

150 
REORG
:

152 
AVGPOOL
:

154 
SOFTMAX
:

156 
DETECTION
:

158 
REGION
:

160 
YOLO
:

162 
DROPOUT
:

164 
CROP
:

166 
COST
:

168 
ROUTE
:

170 
SHORTCUT
:

172 
NORMALIZATION
:

174 
BATCHNORM
:

180 
	}
}

182 
ÃtwÜk
 *
	$make_ÃtwÜk
(
n
)

184 
ÃtwÜk
 *
Ãt
 = 
	`ÿÎoc
(1, (network));

185 
Ãt
->
n
 =‚;

186 
Ãt
->
Ïy”s
 = 
	`ÿÎoc
Ò‘->
n
, (
Ïy”
));

187 
Ãt
->
£’
 = 
	`ÿÎoc
(1, (
size_t
));

188 
Ãt
->
t
 = 
	`ÿÎoc
(1, ());

189 
Ãt
->
co¡
 = 
	`ÿÎoc
(1, ());

190  
Ãt
;

191 
	}
}

193 
	$wÜk¥aûBOO
(
ÃtwÜk
 
Ãt
)

197 
wÜk¥aû_size
 = 0;

198 
i
 = 0; i < 
Ãt
.
n
; ++i)

200 if(
CONVOLUTIONAL
 =ğ
Ãt
.
Ïy”s
[
i
].
ty³
)

202 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

203 if(
l
.
wÜk¥aû_size
 > workspace_size){

204 
wÜk¥aû_size
 = 
l
.workspace_size;

222  
wÜk¥aû_size
;

225 
	}
}

227 
	gwssize
 = -1;

229 
	$fÜw¬d_ÃtwÜk
(
ÃtwÜk
 *
Ã
)

231 #ifdeà
GPU


232 if(
Ã
->
gpu_šdex
 >= 0){

233 
	`fÜw¬d_ÃtwÜk_gpu
(
Ã
);

237 
ÃtwÜk
 
Ãt
 = *
Ã
;

239 
i
;

240 
i
 = 0; i < 
Ãt
.
n
; ++i){

241 
Ãt
.
šdex
 = 
i
;

242 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

247 
	`fÜw¬d_ÃtwÜk_CA
(
Ãt
.
šput
, 
l
.
šputs
,†.
b©ch
,‚‘.
Œaš
);

248 
i
 = 
Ãt
.
n
;

252 if(
l
.
d–
){

253 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
d–
, 1);

256 
l
.
	`fÜw¬d
Ö, 
Ãt
);

257 
Ãt
.
šput
 = 
l
.
ouut
;

258 if(
l
.
Œuth
) {

259 
Ãt
.
Œuth
 = 
l
.
ouut
;

262 if(
wssize
 == -1) {

263 
wssize
 = 
	`wÜk¥aûBOO
(
Ãt
);

264 if(
wssize
è
	`upd©e_Ãt_agrv_CA_®loÿ‹SM
(wssize, 
Ãt
.
wÜk¥aû
);

266 if(
wssize
è
	`upd©e_Ãt_agrv_CA
(0, wssize, 
Ãt
.
wÜk¥aû
);

270 
	`ÿlc_ÃtwÜk_co¡
(
Ã
);

271 
	}
}

275 
	$upd©e_ÃtwÜk
(
ÃtwÜk
 *
Ã
)

277 #ifdeà
GPU


278 if(
Ã
->
gpu_šdex
 >= 0){

279 
	`upd©e_ÃtwÜk_gpu
(
Ã
);

283 
ÃtwÜk
 
Ãt
 = *
Ã
;

284 
i
;

285 
upd©e_¬gs
 
a
 = {0};

286 
a
.
b©ch
 = 
Ãt
.b©ch*Ãt.
subdivisiÚs
;

287 
a
.
Ë¬nšg_¿‹
 = 
	`g‘_cu¼’t_¿‹
(
Ã
);

288 
a
.
mom’tum
 = 
Ãt
.momentum;

289 
a
.
deÿy
 = 
Ãt
.decay;

290 
a
.
adam
 = 
Ãt
.adam;

291 
a
.
B1
 = 
Ãt
.B1;

292 
a
.
B2
 = 
Ãt
.B2;

293 
a
.
•s
 = 
Ãt
.eps;

294 ++*
Ãt
.
t
;

295 
a
.
t
 = *
Ãt
.t;

297 
i
 = 0; i < 
Ãt
.
n
; ++i){

298 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

299 if(
l
.
upd©e
){

301 if(
i
 > 
·¹™iÚ_pošt
)

303 
	`upd©e_ÃtwÜk_CA
(
a
);

304 
i
 = 
Ãt
.
n
;

307 
l
.
	`upd©e
Ö, 
a
);

311 
	}
}

313 
	$ÿlc_ÃtwÜk_co¡
(
ÃtwÜk
 *
Ã
)

315 
ÃtwÜk
 
Ãt
 = *
Ã
;

316 
i
;

317 
sum
 = 0;

318 
couÁ
 = 0;

319 
i
 = 0; i < 
Ãt
.
n
; ++i){

320 if(
Ãt
.
Ïy”s
[
i
].
co¡
){

321 
sum
 +ğ
Ãt
.
Ïy”s
[
i
].
co¡
[0];

323 ++
couÁ
;

326 *
Ãt
.
co¡
 = 
sum
/
couÁ
;

327 
	}
}

329 
	$g‘_´ediùed_şass_ÃtwÜk
(
ÃtwÜk
 *
Ãt
)

331  
	`max_šdex
(
Ãt
->
ouut
,‚‘->
ouuts
);

332 
	}
}

334 
	$backw¬d_ÃtwÜk
(
ÃtwÜk
 *
Ã
)

336 #ifdeà
GPU


337 if(
Ã
->
gpu_šdex
 >= 0){

338 
	`backw¬d_ÃtwÜk_gpu
(
Ã
);

342 
ÃtwÜk
 
Ãt
 = *
Ã
;

343 
i
;

344 
ÃtwÜk
 
Üig
 = 
Ãt
;

346 
size_´ev
 = 
Ãt
.
Ïy”s
[
·¹™iÚ_pošt
].
ouuts
 *‚‘.
b©ch
;

347 *
ÿ_´evÏy”_šput
 = 
	`m®loc
((è* 
size_´ev
);

348 *
ÿ_´evÏy”_d–
 = 
	`m®loc
((è* 
size_´ev
);

350 
i
 = 
Ãt
.
n
-1; i >= 0; --i){

351 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

353 if(
l
.
¡İbackw¬d
) ;

354 if(
i
 == 0){

355 
Ãt
 = 
Üig
;

357 }if(
i
 =ğ
Ãt
.
n
-1){

358 
Ïy”
 
´ev
 = 
Ãt
.
Ïy”s
[
·¹™iÚ_pošt
];

359 
z
=0; z<
size_´ev
; z++){

360 
ÿ_´evÏy”_šput
[
z
] = 
´ev
.
ouut
[z];

361 
ÿ_´evÏy”_d–
[
z
] = 
´ev
.
d–
[z];

363 
Ãt
.
šput
 = 
´ev
.
ouut
;

364 
Ãt
.
d–
 = 
´ev
.delta;

367 
Ïy”
 
´ev
 = 
Ãt
.
Ïy”s
[
i
-1];

368 
Ãt
.
šput
 = 
´ev
.
ouut
;

369 
Ãt
.
d–
 = 
´ev
.delta;

372 
Ãt
.
šdex
 = 
i
;

374 if(
i
 > 
·¹™iÚ_pošt
)

377 
	`backw¬d_ÃtwÜk_CA
(
ÿ_´evÏy”_šput
, 
Ãt
.
Ïy”s
[
·¹™iÚ_pošt
].
ouuts
,‚‘.
b©ch
, 
ÿ_´evÏy”_d–
,‚‘.
Œaš
);

379 
	`backw¬d_ÃtwÜk_CA_addidiÚ
(
Ãt
.
Ïy”s
[
·¹™iÚ_pošt
].
ouuts
,‚‘.
b©ch
);

381 
z
=0; z<
size_´ev
; z++){

382 
Ãt
.
šput
[
z
] = 
Ãt_šput_back
[z];

383 
Ãt
.
d–
[
z
] = 
Ãt_d–_back
[z];

385 
	`ä“
(
Ãt_šput_back
);

386 
	`ä“
(
Ãt_d–_back
);

388 if(
wssize
è
	`upd©e_Ãt_agrv_CA
(1, wssize, 
Ãt
.
wÜk¥aû
);

390 
i
 = 
·¹™iÚ_pošt
 + 1;

393 
l
.
	`backw¬d
Ö, 
Ãt
);

396 
	`ä“
(
ÿ_´evÏy”_šput
);

397 
	`ä“
(
ÿ_´evÏy”_d–
);

398 
	}
}

400 
	$Œaš_ÃtwÜk_d©um
(
ÃtwÜk
 *
Ãt
)

402 *
Ãt
->
£’
 +ğÃt->
b©ch
;

403 
Ãt
->
Œaš
 = 1;

404 
	`fÜw¬d_ÃtwÜk
(
Ãt
);

405 
	`backw¬d_ÃtwÜk
(
Ãt
);

407 
”rÜ
 = *
Ãt
->
co¡
;

410 if(((*
Ãt
->
£’
)/Ãt->
b©ch
)%Ãt->
subdivisiÚs
 =ğ0è
	`upd©e_ÃtwÜk
(net);

412  
”rÜ
;

413 
	}
}

415 
	$Œaš_ÃtwÜk_sgd
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, 
n
)

417 
b©ch
 = 
Ãt
->batch;

419 
i
;

420 
sum
 = 0;

421 
i
 = 0; i < 
n
; ++i){

422 
	`g‘_¿ndom_b©ch
(
d
, 
b©ch
, 
Ãt
->
šput
,‚‘->
Œuth
);

423 
”r
 = 
	`Œaš_ÃtwÜk_d©um
(
Ãt
);

424 
sum
 +ğ
”r
;

426  ()
sum
/(
n
*
b©ch
);

427 
	}
}

429 
	$Œaš_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
)

431 
	`as£¹
(
d
.
X
.
rows
 % 
Ãt
->
b©ch
 == 0);

432 
b©ch
 = 
Ãt
->batch;

433 
n
 = 
d
.
X
.
rows
 / 
b©ch
;

435 
i
;

436 
sum
 = 0;

437 
i
 = 0; i < 
n
; ++i){

438 
	`g‘_Ãxt_b©ch
(
d
, 
b©ch
, 
i
*b©ch, 
Ãt
->
šput
,‚‘->
Œuth
);

441 
	`Ãt_Œuth_CA
(
Ãt
->
Œuth
,‚‘->
Œuths
,‚‘->
b©ch
);

443 
”r
 = 
	`Œaš_ÃtwÜk_d©um
(
Ãt
);

444 
sum
 +ğ
”r
;

447 
	`ÿlc_ÃtwÜk_loss_CA
(
n
, 
b©ch
);

448  ()
sum
/(
n
*
b©ch
);

449 
	}
}

451 
	$£t_‹mp_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
t
)

453 
i
;

454 
i
 = 0; i < 
Ãt
->
n
; ++i){

455 
Ãt
->
Ïy”s
[
i
].
‹m³¿tu»
 = 
t
;

457 
	}
}

460 
	$£t_b©ch_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
b
)

462 
Ãt
->
b©ch
 = 
b
;

463 
i
;

464 
i
 = 0; i < 
Ãt
->
n
; ++i){

465 
Ãt
->
Ïy”s
[
i
].
b©ch
 = 
b
;

466 #ifdeà
CUDNN


467 if(
Ãt
->
Ïy”s
[
i
].
ty³
 =ğ
CONVOLUTIONAL
){

468 
	`cudÂ_cÚvŞutiÚ®_£tup
(
Ãt
->
Ïy”s
 + 
i
);

470 if(
Ãt
->
Ïy”s
[
i
].
ty³
 =ğ
DECONVOLUTIONAL
){

471 
Ïy”
 *
l
 = 
Ãt
->
Ïy”s
 + 
i
;

472 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†->
out_c
,†->
out_h
,†->
out_w
);

473 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
->
nÜmT’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 1,†->
out_c
, 1, 1);

477 
	}
}

479 
	$»size_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
)

481 #ifdeà
GPU


482 
	`cuda_£t_deviû
(
Ãt
->
gpu_šdex
);

483 
	`cuda_ä“
(
Ãt
->
wÜk¥aû
);

485 
i
;

487 
Ãt
->
w
 = w;

488 
Ãt
->
h
 = h;

489 
šputs
 = 0;

490 
size_t
 
wÜk¥aû_size
 = 0;

493 
i
 = 0; i < 
Ãt
->
n
; ++i){

494 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

495 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

496 
	`»size_cÚvŞutiÚ®_Ïy”
(&
l
, 
w
, 
h
);

497 }if(
l
.
ty³
 =ğ
CROP
){

498 
	`»size_üİ_Ïy”
(&
l
, 
w
, 
h
);

499 }if(
l
.
ty³
 =ğ
MAXPOOL
){

500 
	`»size_maxpoŞ_Ïy”
(&
l
, 
w
, 
h
);

501 }if(
l
.
ty³
 =ğ
REGION
){

502 
	`»size_»giÚ_Ïy”
(&
l
, 
w
, 
h
);

503 }if(
l
.
ty³
 =ğ
YOLO
){

504 
	`»size_yŞo_Ïy”
(&
l
, 
w
, 
h
);

505 }if(
l
.
ty³
 =ğ
ROUTE
){

506 
	`»size_rou‹_Ïy”
(&
l
, 
Ãt
);

507 }if(
l
.
ty³
 =ğ
SHORTCUT
){

508 
	`»size_shÜtcut_Ïy”
(&
l
, 
w
, 
h
);

509 }if(
l
.
ty³
 =ğ
UPSAMPLE
){

510 
	`»size_up§m¶e_Ïy”
(&
l
, 
w
, 
h
);

511 }if(
l
.
ty³
 =ğ
REORG
){

512 
	`»size_»Üg_Ïy”
(&
l
, 
w
, 
h
);

513 }if(
l
.
ty³
 =ğ
AVGPOOL
){

514 
	`»size_avgpoŞ_Ïy”
(&
l
, 
w
, 
h
);

515 }if(
l
.
ty³
 =ğ
NORMALIZATION
){

516 
	`»size_nÜm®iz©iÚ_Ïy”
(&
l
, 
w
, 
h
);

517 }if(
l
.
ty³
 =ğ
COST
){

518 
	`»size_co¡_Ïy”
(&
l
, 
šputs
);

520 
	`”rÜ
("Cannot„esizehisype of†ayer");

522 if(
l
.
wÜk¥aû_size
 > workspace_size) workspace_size =†.workspace_size;

523 if(
l
.
wÜk¥aû_size
 > 2000000000è
	`as£¹
(0);

524 
šputs
 = 
l
.
ouuts
;

525 
Ãt
->
Ïy”s
[
i
] = 
l
;

526 
w
 = 
l
.
out_w
;

527 
h
 = 
l
.
out_h
;

528 if(
l
.
ty³
 =ğ
AVGPOOL
) ;

530 
Ïy”
 
out
 = 
	`g‘_ÃtwÜk_ouut_Ïy”
(
Ãt
);

531 
Ãt
->
šputs
 =‚‘->
Ïy”s
[0].inputs;

532 
Ãt
->
ouuts
 = 
out
.outputs;

533 
Ãt
->
Œuths
 = 
out
.
ouuts
;

534 if(
Ãt
->
Ïy”s
[Ãt->
n
-1].
Œuths
)‚et->truths =‚et->layers[net->n-1].truths;

535 
Ãt
->
ouut
 = 
out
.output;

536 
	`ä“
(
Ãt
->
šput
);

537 
	`ä“
(
Ãt
->
Œuth
);

538 
Ãt
->
šput
 = 
	`ÿÎoc
Ò‘->
šputs
*Ãt->
b©ch
, ());

539 
Ãt
->
Œuth
 = 
	`ÿÎoc
Ò‘->
Œuths
*Ãt->
b©ch
, ());

540 #ifdeà
GPU


541 if(
gpu_šdex
 >= 0){

542 
	`cuda_ä“
(
Ãt
->
šput_gpu
);

543 
	`cuda_ä“
(
Ãt
->
Œuth_gpu
);

544 
Ãt
->
šput_gpu
 = 
	`cuda_make_¬¿y
Ò‘->
šput
,‚‘->
šputs
*Ãt->
b©ch
);

545 
Ãt
->
Œuth_gpu
 = 
	`cuda_make_¬¿y
Ò‘->
Œuth
,‚‘->
Œuths
*Ãt->
b©ch
);

546 if(
wÜk¥aû_size
){

547 
Ãt
->
wÜk¥aû
 = 
	`cuda_make_¬¿y
(0, (
wÜk¥aû_size
-1)/()+1);

550 
	`ä“
(
Ãt
->
wÜk¥aû
);

551 
Ãt
->
wÜk¥aû
 = 
	`ÿÎoc
(1, 
wÜk¥aû_size
);

554 
	`ä“
(
Ãt
->
wÜk¥aû
);

555 
Ãt
->
wÜk¥aû
 = 
	`ÿÎoc
(1, 
wÜk¥aû_size
);

559 
	}
}

561 
Ïy”
 
	$g‘_ÃtwÜk_d‘eùiÚ_Ïy”
(
ÃtwÜk
 *
Ãt
)

563 
i
;

564 
i
 = 0; i < 
Ãt
->
n
; ++i){

565 if(
Ãt
->
Ïy”s
[
i
].
ty³
 =ğ
DETECTION
){

566  
Ãt
->
Ïy”s
[
i
];

569 
	`årštf
(
¡d”r
, "Detection†ayer‚ot found!!\n");

570 
Ïy”
 
l
 = {0};

571  
l
;

572 
	}
}

574 
image
 
	$g‘_ÃtwÜk_image_Ïy”
(
ÃtwÜk
 *
Ãt
, 
i
)

576 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

577 #ifdeà
GPU


580 ià(
l
.
out_w
 &&†.
out_h
 &&†.
out_c
){

581  
	`æßt_to_image
(
l
.
out_w
,†.
out_h
,†.
out_c
,†.
ouut
);

583 
image
 
def
 = {0};

584  
def
;

585 
	}
}

587 
image
 
	$g‘_ÃtwÜk_image
(
ÃtwÜk
 *
Ãt
)

589 
i
;

590 
i
 = 
Ãt
->
n
-1; i >= 0; --i){

591 
image
 
m
 = 
	`g‘_ÃtwÜk_image_Ïy”
(
Ãt
, 
i
);

592 if(
m
.
h
 != 0)  m;

594 
image
 
def
 = {0};

595  
def
;

596 
	}
}

598 
	$visu®ize_ÃtwÜk
(
ÃtwÜk
 *
Ãt
)

600 
image
 *
´ev
 = 0;

601 
i
;

602 
buff
[256];

603 
i
 = 0; i < 
Ãt
->
n
; ++i){

604 
	`¥rštf
(
buff
, "Lay” %d", 
i
);

605 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

606 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
){

607 
´ev
 = 
	`visu®ize_cÚvŞutiÚ®_Ïy”
(
l
, 
buff
,…rev);

610 
	}
}

612 
	$tİ_´ediùiÚs
(
ÃtwÜk
 *
Ãt
, 
k
, *
šdex
)

614 
	`tİ_k
(
Ãt
->
ouut
,‚‘->
ouuts
, 
k
, 
šdex
);

615 
	}
}

618 *
	$ÃtwÜk_´ediù
(
ÃtwÜk
 *
Ãt
, *
šput
)

620 
ÃtwÜk
 
Üig
 = *
Ãt
;

621 
Ãt
->
šput
 = input;

622 
Ãt
->
Œuth
 = 0;

623 
Ãt
->
Œaš
 = 0;

624 
Ãt
->
d–
 = 0;

625 
	`fÜw¬d_ÃtwÜk
(
Ãt
);

627 *
out
;

632 
out
 = 
Ãt
->
ouut
;

635 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 1];

637 
	`Ãt_ouut_»tuº_CA
(
l
.
ouuts
,†.
b©ch
);

638 
out
 = 
Ãt_ouut_back
;

641 *
Ãt
 = 
Üig
;

642  
out
;

643 
	}
}

645 *
	$ÃtwÜk_´ediù_soámax
(*
d©a_fe
)

647 *
out
;

648 *
šput
 = (*)
	`m®loc
((è* 
¦
.
šputs
 * sl.
b©ch
);

650 
	`årštf
(
¡d”r
, "Lßdšg…¬tŸÈouut äom %s...", 
d©a_fe
);

651 
	`fæush
(
¡dout
);

652 
FILE
 *
å
 = 
	`fİ’
(
d©a_fe
, "rb");

653 if(!
å
è
	`fe_”rÜ
(
d©a_fe
);

655 
	`ä—d
(
šput
, (), 
¦
.
šputs
 * sl.
b©ch
, 
å
);

658 
Ãt_»suÉ_back
 = 
	`m®loc
((è* 
¦
.
ouuts
 * sl.
b©ch
);

659 
	`fÜw¬d_soámax_CA
(
šput
, 
¦
.
šputs
, sl.
b©ch
, sl.
ouuts
, 
Ãt_»suÉ_back
);

661 
out
 = 
Ãt_»suÉ_back
;

663 
	`ä“
(
šput
);

664  
out
;

665 
	}
}

667 
	$num_d‘eùiÚs
(
ÃtwÜk
 *
Ãt
, 
th»sh
)

669 
i
;

670 
s
 = 0;

671 
i
 = 0; i < 
Ãt
->
n
; ++i){

672 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

673 if(
l
.
ty³
 =ğ
YOLO
){

674 
s
 +ğ
	`yŞo_num_d‘eùiÚs
(
l
, 
th»sh
);

676 if(
l
.
ty³
 =ğ
DETECTION
 ||†.ty³ =ğ
REGION
){

677 
s
 +ğ
l
.
w
*l.
h
*l.
n
;

680  
s
;

681 
	}
}

683 
d‘eùiÚ
 *
	$make_ÃtwÜk_boxes
(
ÃtwÜk
 *
Ãt
, 
th»sh
, *
num
)

685 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[Ãt->
n
 - 1];

686 
i
;

687 
nboxes
 = 
	`num_d‘eùiÚs
(
Ãt
, 
th»sh
);

688 if(
num
è*num = 
nboxes
;

689 
d‘eùiÚ
 *
d‘s
 = 
	`ÿÎoc
(
nboxes
, (detection));

690 
i
 = 0; i < 
nboxes
; ++i){

691 
d‘s
[
i
].
´ob
 = 
	`ÿÎoc
(
l
.
şas£s
, ());

692 if(
l
.
coÜds
 > 4){

693 
d‘s
[
i
].
mask
 = 
	`ÿÎoc
(
l
.
coÜds
-4, ());

696  
d‘s
;

697 
	}
}

699 
	$fl_ÃtwÜk_boxes
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
, 
th»sh
, 
h›r
, *
m­
, 
»Ïtive
, 
d‘eùiÚ
 *
d‘s
)

701 
j
;

702 
j
 = 0; j < 
Ãt
->
n
; ++j){

703 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
j
];

704 if(
l
.
ty³
 =ğ
YOLO
){

705 
couÁ
 = 
	`g‘_yŞo_d‘eùiÚs
(
l
, 
w
, 
h
, 
Ãt
->w,‚‘->h, 
th»sh
, 
m­
, 
»Ïtive
, 
d‘s
);

706 
d‘s
 +ğ
couÁ
;

708 if(
l
.
ty³
 =ğ
REGION
){

709 
	`g‘_»giÚ_d‘eùiÚs
(
l
, 
w
, 
h
, 
Ãt
->w,‚‘->h, 
th»sh
, 
m­
, 
h›r
, 
»Ïtive
, 
d‘s
);

710 
d‘s
 +ğ
l
.
w
*l.
h
*l.
n
;

712 if(
l
.
ty³
 =ğ
DETECTION
){

713 
	`g‘_d‘eùiÚ_d‘eùiÚs
(
l
, 
w
, 
h
, 
th»sh
, 
d‘s
);

714 
d‘s
 +ğ
l
.
w
*l.
h
*l.
n
;

717 
	}
}

719 
d‘eùiÚ
 *
	$g‘_ÃtwÜk_boxes
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
, 
th»sh
, 
h›r
, *
m­
, 
»Ïtive
, *
num
)

721 
d‘eùiÚ
 *
d‘s
 = 
	`make_ÃtwÜk_boxes
(
Ãt
, 
th»sh
, 
num
);

722 
	`fl_ÃtwÜk_boxes
(
Ãt
, 
w
, 
h
, 
th»sh
, 
h›r
, 
m­
, 
»Ïtive
, 
d‘s
);

723  
d‘s
;

724 
	}
}

726 
	$ä“_d‘eùiÚs
(
d‘eùiÚ
 *
d‘s
, 
n
)

728 
i
;

729 
i
 = 0; i < 
n
; ++i){

730 
	`ä“
(
d‘s
[
i
].
´ob
);

731 if(
d‘s
[
i
].
mask
è
	`ä“
(dets[i].mask);

733 
	`ä“
(
d‘s
);

734 
	}
}

736 *
	$ÃtwÜk_´ediù_image
(
ÃtwÜk
 *
Ãt
, 
image
 
im
)

738 
image
 
imr
 = 
	`Ë‰”box_image
(
im
, 
Ãt
->
w
,‚‘->
h
);

739 
	`£t_b©ch_ÃtwÜk
(
Ãt
, 1);

740 *
p
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
imr
.
d©a
);

741 
	`ä“_image
(
imr
);

742  
p
;

743 
	}
}

745 
	$ÃtwÜk_width
(
ÃtwÜk
 *
Ãt
){‚‘->
w
;
	}
}

746 
	$ÃtwÜk_height
(
ÃtwÜk
 *
Ãt
){‚‘->
h
;
	}
}

748 
m©rix
 
	$ÃtwÜk_´ediù_d©a_muÉi
(
ÃtwÜk
 *
Ãt
, 
d©a
 
‹¡
, 
n
)

750 
i
,
j
,
b
,
m
;

751 
k
 = 
Ãt
->
ouuts
;

752 
m©rix
 
´ed
 = 
	`make_m©rix
(
‹¡
.
X
.
rows
, 
k
);

753 *
X
 = 
	`ÿÎoc
(
Ãt
->
b©ch
*
‹¡
.X.
rows
, ());

754 
i
 = 0; i < 
‹¡
.
X
.
rows
; i +ğ
Ãt
->
b©ch
){

755 
b
 = 0; b < 
Ãt
->
b©ch
; ++b){

756 if(
i
+
b
 =ğ
‹¡
.
X
.
rows
) ;

757 
	`memıy
(
X
+
b
*
‹¡
.X.
cŞs
,e¡.X.
v®s
[
i
+b],est.X.cols*());

759 
m
 = 0; m < 
n
; ++m){

760 *
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

761 
b
 = 0; b < 
Ãt
->
b©ch
; ++b){

762 if(
i
+
b
 =ğ
‹¡
.
X
.
rows
) ;

763 
j
 = 0; j < 
k
; ++j){

764 
´ed
.
v®s
[
i
+
b
][
j
] +ğ
out
[j+b*
k
]/
n
;

769 
	`ä“
(
X
);

770  
´ed
;

771 
	}
}

773 
m©rix
 
	$ÃtwÜk_´ediù_d©a
(
ÃtwÜk
 *
Ãt
, 
d©a
 
‹¡
)

775 
i
,
j
,
b
;

776 
k
 = 
Ãt
->
ouuts
;

777 
m©rix
 
´ed
 = 
	`make_m©rix
(
‹¡
.
X
.
rows
, 
k
);

778 *
X
 = 
	`ÿÎoc
(
Ãt
->
b©ch
*
‹¡
.X.
cŞs
, ());

779 
i
 = 0; i < 
‹¡
.
X
.
rows
; i +ğ
Ãt
->
b©ch
){

780 
b
 = 0; b < 
Ãt
->
b©ch
; ++b){

781 if(
i
+
b
 =ğ
‹¡
.
X
.
rows
) ;

782 
	`memıy
(
X
+
b
*
‹¡
.X.
cŞs
,e¡.X.
v®s
[
i
+b],est.X.cols*());

784 *
out
 = 
	`ÃtwÜk_´ediù
(
Ãt
, 
X
);

785 
b
 = 0; b < 
Ãt
->
b©ch
; ++b){

786 if(
i
+
b
 =ğ
‹¡
.
X
.
rows
) ;

787 
j
 = 0; j < 
k
; ++j){

788 
´ed
.
v®s
[
i
+
b
][
j
] = 
out
[j+b*
k
];

792 
	`ä“
(
X
);

793  
´ed
;

794 
	}
}

796 
	$´št_ÃtwÜk
(
ÃtwÜk
 *
Ãt
)

798 
i
,
j
;

799 
i
 = 0; i < 
Ãt
->
n
; ++i){

800 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

801 *
ouut
 = 
l
.output;

802 
n
 = 
l
.
ouuts
;

803 
m—n
 = 
	`m—n_¬¿y
(
ouut
, 
n
);

804 
v¬i
 = 
	`v¬Ÿnû_¬¿y
(
ouut
, 
n
);

805 
	`årštf
(
¡d”r
, "Lay” %d - M—n: %f, V¬Ÿnû: %f\n",
i
,
m—n
, 
v¬i
);

806 if(
n
 > 100)‚ = 100;

807 
j
 = 0; j < 
n
; ++jè
	`årštf
(
¡d”r
, "%f, ", 
ouut
[j]);

808 if(
n
 =ğ100)
	`årštf
(
¡d”r
,".....\n");

809 
	`årštf
(
¡d”r
, "\n");

811 
	}
}

813 
	$com·»_ÃtwÜks
(
ÃtwÜk
 *
n1
,‚‘wÜk *
n2
, 
d©a
 
‹¡
)

815 
m©rix
 
g1
 = 
	`ÃtwÜk_´ediù_d©a
(
n1
, 
‹¡
);

816 
m©rix
 
g2
 = 
	`ÃtwÜk_´ediù_d©a
(
n2
, 
‹¡
);

817 
i
;

818 
a
,
b
,
c
,
d
;

819 
a
 = 
b
 = 
c
 = 
d
 = 0;

820 
i
 = 0; i < 
g1
.
rows
; ++i){

821 
Œuth
 = 
	`max_šdex
(
‹¡
.
y
.
v®s
[
i
],e¡.y.
cŞs
);

822 
p1
 = 
	`max_šdex
(
g1
.
v®s
[
i
], g1.
cŞs
);

823 
p2
 = 
	`max_šdex
(
g2
.
v®s
[
i
], g2.
cŞs
);

824 if(
p1
 =ğ
Œuth
){

825 if(
p2
 =ğ
Œuth
è++
d
;

826 ++
c
;

828 if(
p2
 =ğ
Œuth
è++
b
;

829 ++
a
;

832 
	`´štf
("%5d %5d\n%5d %5d\n", 
a
, 
b
, 
c
, 
d
);

833 
num
 = 
	`pow
((
	`abs
(
b
 - 
c
) - 1.), 2.);

834 
d’
 = 
b
 + 
c
;

835 
	`´štf
("%f\n", 
num
/
d’
);

836 
	}
}

838 
	$ÃtwÜk_accu¿cy
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
)

840 
m©rix
 
guess
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
d
);

841 
acc
 = 
	`m©rix_tİk_accu¿cy
(
d
.
y
, 
guess
,1);

842 
	`ä“_m©rix
(
guess
);

843  
acc
;

844 
	}
}

846 *
	$ÃtwÜk_accu¿c›s
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, 
n
)

848 
acc
[2];

849 
m©rix
 
guess
 = 
	`ÃtwÜk_´ediù_d©a
(
Ãt
, 
d
);

850 
acc
[0] = 
	`m©rix_tİk_accu¿cy
(
d
.
y
, 
guess
, 1);

851 
acc
[1] = 
	`m©rix_tİk_accu¿cy
(
d
.
y
, 
guess
, 
n
);

852 
	`ä“_m©rix
(
guess
);

853  
acc
;

854 
	}
}

856 
Ïy”
 
	$g‘_ÃtwÜk_ouut_Ïy”
(
ÃtwÜk
 *
Ãt
)

858 
i
;

859 
i
 = 
Ãt
->
n
 - 1; i >= 0; --i){

860 if(
Ãt
->
Ïy”s
[
i
].
ty³
 !ğ
COST
) ;

862  
Ãt
->
Ïy”s
[
i
];

863 
	}
}

865 
	$ÃtwÜk_accu¿cy_muÉi
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, 
n
)

867 
m©rix
 
guess
 = 
	`ÃtwÜk_´ediù_d©a_muÉi
(
Ãt
, 
d
, 
n
);

868 
acc
 = 
	`m©rix_tİk_accu¿cy
(
d
.
y
, 
guess
,1);

869 
	`ä“_m©rix
(
guess
);

870  
acc
;

871 
	}
}

873 
	$ä“_ÃtwÜk
(
ÃtwÜk
 *
Ãt
)

875 
i
;

876 
i
 = 0; i < 
Ãt
->
n
; ++i){

877 
	`ä“_Ïy”
(
Ãt
->
Ïy”s
[
i
]);

879 
	`ä“
(
Ãt
->
Ïy”s
);

880 if(
Ãt
->
šput
è
	`ä“
(net->input);

881 if(
Ãt
->
Œuth
è
	`ä“
(net->truth);

882 #ifdeà
GPU


883 if(
Ãt
->
šput_gpu
è
	`cuda_ä“
(net->input_gpu);

884 if(
Ãt
->
Œuth_gpu
è
	`cuda_ä“
(net->truth_gpu);

886 
	`ä“
(
Ãt
);

887 
	}
}

893 
Ïy”
 
	$ÃtwÜk_ouut_Ïy”
(
ÃtwÜk
 *
Ãt
)

895 
i
;

896 
i
 = 
Ãt
->
n
 - 1; i >= 0; --i){

897 if(
Ãt
->
Ïy”s
[
i
].
ty³
 !ğ
COST
) ;

899  
Ãt
->
Ïy”s
[
i
];

900 
	}
}

902 
	$ÃtwÜk_šputs
(
ÃtwÜk
 *
Ãt
)

904  
Ãt
->
Ïy”s
[0].
šputs
;

905 
	}
}

907 
	$ÃtwÜk_ouuts
(
ÃtwÜk
 *
Ãt
)

909  
	`ÃtwÜk_ouut_Ïy”
(
Ãt
).
ouuts
;

910 
	}
}

912 *
	$ÃtwÜk_ouut
(
ÃtwÜk
 *
Ãt
)

914  
	`ÃtwÜk_ouut_Ïy”
(
Ãt
).
ouut
;

915 
	}
}

917 #ifdeà
GPU


919 
	$fÜw¬d_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ã
)

921 
ÃtwÜk
 
Ãt
 = *
Ã
;

922 
	`cuda_£t_deviû
(
Ãt
.
gpu_šdex
);

923 
	`cuda_push_¬¿y
(
Ãt
.
šput_gpu
,‚‘.
šput
,‚‘.
šputs
*Ãt.
b©ch
);

924 if(
Ãt
.
Œuth
){

925 
	`cuda_push_¬¿y
(
Ãt
.
Œuth_gpu
,‚‘.
Œuth
,‚‘.
Œuths
*Ãt.
b©ch
);

928 
i
;

929 
i
 = 0; i < 
Ãt
.
n
; ++i){

930 
Ãt
.
šdex
 = 
i
;

931 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

932 if(
l
.
d–_gpu
){

933 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
d–_gpu
, 1);

935 
l
.
	`fÜw¬d_gpu
Ö, 
Ãt
);

936 
Ãt
.
šput_gpu
 = 
l
.
ouut_gpu
;

937 
Ãt
.
šput
 = 
l
.
ouut
;

938 if(
l
.
Œuth
) {

939 
Ãt
.
Œuth_gpu
 = 
l
.
ouut_gpu
;

940 
Ãt
.
Œuth
 = 
l
.
ouut
;

943 
	`puÎ_ÃtwÜk_ouut
(
Ã
);

944 
	`ÿlc_ÃtwÜk_co¡
(
Ã
);

945 
	}
}

947 
	$backw¬d_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ã
)

949 
i
;

950 
ÃtwÜk
 
Ãt
 = *
Ã
;

951 
ÃtwÜk
 
Üig
 = 
Ãt
;

952 
	`cuda_£t_deviû
(
Ãt
.
gpu_šdex
);

953 
i
 = 
Ãt
.
n
-1; i >= 0; --i){

954 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

955 if(
l
.
¡İbackw¬d
) ;

956 if(
i
 == 0){

957 
Ãt
 = 
Üig
;

959 
Ïy”
 
´ev
 = 
Ãt
.
Ïy”s
[
i
-1];

960 
Ãt
.
šput
 = 
´ev
.
ouut
;

961 
Ãt
.
d–
 = 
´ev
.delta;

962 
Ãt
.
šput_gpu
 = 
´ev
.
ouut_gpu
;

963 
Ãt
.
d–_gpu
 = 
´ev
.delta_gpu;

965 
Ãt
.
šdex
 = 
i
;

966 
l
.
	`backw¬d_gpu
Ö, 
Ãt
);

968 
	}
}

970 
	$upd©e_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ã
)

972 
ÃtwÜk
 
Ãt
 = *
Ã
;

973 
	`cuda_£t_deviû
(
Ãt
.
gpu_šdex
);

974 
i
;

975 
upd©e_¬gs
 
a
 = {0};

976 
a
.
b©ch
 = 
Ãt
.b©ch*Ãt.
subdivisiÚs
;

977 
a
.
Ë¬nšg_¿‹
 = 
	`g‘_cu¼’t_¿‹
(
Ã
);

978 
a
.
mom’tum
 = 
Ãt
.momentum;

979 
a
.
deÿy
 = 
Ãt
.decay;

980 
a
.
adam
 = 
Ãt
.adam;

981 
a
.
B1
 = 
Ãt
.B1;

982 
a
.
B2
 = 
Ãt
.B2;

983 
a
.
•s
 = 
Ãt
.eps;

984 ++*
Ãt
.
t
;

985 
a
.
t
 = (*
Ãt
.t);

987 
i
 = 0; i < 
Ãt
.
n
; ++i){

988 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

989 if(
l
.
upd©e_gpu
){

990 
l
.
	`upd©e_gpu
Ö, 
a
);

993 
	}
}

995 
	$h¬mËss_upd©e_ÃtwÜk_gpu
(
ÃtwÜk
 *
Ã
)

997 
ÃtwÜk
 
Ãt
 = *
Ã
;

998 
	`cuda_£t_deviû
(
Ãt
.
gpu_šdex
);

999 
i
;

1000 
i
 = 0; i < 
Ãt
.
n
; ++i){

1001 
Ïy”
 
l
 = 
Ãt
.
Ïy”s
[
i
];

1002 if(
l
.
weight_upd©es_gpu
è
	`fl_gpu
Ö.
nweights
, 0,†.weight_updates_gpu, 1);

1003 if(
l
.
bŸs_upd©es_gpu
è
	`fl_gpu
Ö.
nbŸ£s
, 0,†.bias_updates_gpu, 1);

1004 if(
l
.
sÿË_upd©es_gpu
è
	`fl_gpu
Ö.
nbŸ£s
, 0,†.scale_updates_gpu, 1);

1006 
	}
}

1009 
ÃtwÜk
 *
	mÃt
;

1010 
d©a
 
	md
;

1011 *
	m”r
;

1012 } 
	tŒaš_¬gs
;

1014 *
	$Œaš_th»ad
(*
±r
)

1016 
Œaš_¬gs
 
¬gs
 = *Ñ¿š_¬gs*)
±r
;

1017 
	`ä“
(
±r
);

1018 
	`cuda_£t_deviû
(
¬gs
.
Ãt
->
gpu_šdex
);

1019 *
¬gs
.
”r
 = 
	`Œaš_ÃtwÜk
×rgs.
Ãt
,‡rgs.
d
);

1021 
	}
}

1023 
±h»ad_t
 
	$Œaš_ÃtwÜk_š_th»ad
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, *
”r
)

1025 
±h»ad_t
 
th»ad
;

1026 
Œaš_¬gs
 *
±r
 = (Œaš_¬g *)
	`ÿÎoc
(1, (train_args));

1027 
±r
->
Ãt
 =‚et;

1028 
±r
->
d
 = d;

1029 
±r
->
”r
 =ƒrr;

1030 if(
	`±h»ad_ü—‹
(&
th»ad
, 0, 
Œaš_th»ad
, 
±r
)è
	`”rÜ
("Thread creation failed");

1031  
th»ad
;

1032 
	}
}

1034 
	$m”ge_weights
(
Ïy”
 
l
,†ay” 
ba£
)

1036 ià(
l
.
ty³
 =ğ
CONVOLUTIONAL
) {

1037 
	`axpy_ıu
(
l
.
n
, 1,†.
bŸs_upd©es
, 1, 
ba£
.
bŸ£s
, 1);

1038 
	`axpy_ıu
(
l
.
nweights
, 1,†.
weight_upd©es
, 1, 
ba£
.
weights
, 1);

1039 ià(
l
.
sÿËs
) {

1040 
	`axpy_ıu
(
l
.
n
, 1,†.
sÿË_upd©es
, 1, 
ba£
.
sÿËs
, 1);

1042 } if(
l
.
ty³
 =ğ
CONNECTED
) {

1043 
	`axpy_ıu
(
l
.
ouuts
, 1,†.
bŸs_upd©es
, 1, 
ba£
.
bŸ£s
, 1);

1044 
	`axpy_ıu
(
l
.
ouuts
*l.
šputs
, 1,†.
weight_upd©es
, 1, 
ba£
.
weights
, 1);

1046 
	}
}

1048 
	$sÿË_weights
(
Ïy”
 
l
, 
s
)

1050 ià(
l
.
ty³
 =ğ
CONVOLUTIONAL
) {

1051 
	`sÿl_ıu
(
l
.
n
, 
s
,†.
bŸ£s
, 1);

1052 
	`sÿl_ıu
(
l
.
nweights
, 
s
,†.
weights
, 1);

1053 ià(
l
.
sÿËs
) {

1054 
	`sÿl_ıu
(
l
.
n
, 
s
,†.
sÿËs
, 1);

1056 } if(
l
.
ty³
 =ğ
CONNECTED
) {

1057 
	`sÿl_ıu
(
l
.
ouuts
, 
s
,†.
bŸ£s
, 1);

1058 
	`sÿl_ıu
(
l
.
ouuts
*l.
šputs
, 
s
,†.
weights
, 1);

1060 
	}
}

1063 
	$puÎ_weights
(
Ïy”
 
l
)

1065 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
){

1066 
	`cuda_puÎ_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸs_upd©es
,†.
n
);

1067 
	`cuda_puÎ_¬¿y
(
l
.
weights_gpu
,†.
weight_upd©es
,†.
nweights
);

1068 if(
l
.
sÿËs
è
	`cuda_puÎ_¬¿y
Ö.
sÿËs_gpu
,†.
sÿË_upd©es
,†.
n
);

1069 } if(
l
.
ty³
 =ğ
CONNECTED
){

1070 
	`cuda_puÎ_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸs_upd©es
,†.
ouuts
);

1071 
	`cuda_puÎ_¬¿y
(
l
.
weights_gpu
,†.
weight_upd©es
,†.
ouuts
*l.
šputs
);

1073 
	}
}

1075 
	$push_weights
(
Ïy”
 
l
)

1077 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
){

1078 
	`cuda_push_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸ£s
,†.
n
);

1079 
	`cuda_push_¬¿y
(
l
.
weights_gpu
,†.
weights
,†.
nweights
);

1080 if(
l
.
sÿËs
è
	`cuda_push_¬¿y
Ö.
sÿËs_gpu
,†.sÿËs,†.
n
);

1081 } if(
l
.
ty³
 =ğ
CONNECTED
){

1082 
	`cuda_push_¬¿y
(
l
.
bŸ£s_gpu
,†.
bŸ£s
,†.
ouuts
);

1083 
	`cuda_push_¬¿y
(
l
.
weights_gpu
,†.
weights
,†.
ouuts
*l.
šputs
);

1085 
	}
}

1087 
	$di¡ribu‹_weights
(
Ïy”
 
l
,†ay” 
ba£
)

1089 ià(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
) {

1090 
	`cuda_push_¬¿y
(
l
.
bŸ£s_gpu
, 
ba£
.
bŸ£s
,†.
n
);

1091 
	`cuda_push_¬¿y
(
l
.
weights_gpu
, 
ba£
.
weights
,†.
nweights
);

1092 ià(
ba£
.
sÿËs
è
	`cuda_push_¬¿y
(
l
.
sÿËs_gpu
, ba£.sÿËs,†.
n
);

1093 } ià(
l
.
ty³
 =ğ
CONNECTED
) {

1094 
	`cuda_push_¬¿y
(
l
.
bŸ£s_gpu
, 
ba£
.
bŸ£s
,†.
ouuts
);

1095 
	`cuda_push_¬¿y
(
l
.
weights_gpu
, 
ba£
.
weights
,†.
ouuts
*l.
šputs
);

1097 
	}
}

1184 
	$sync_Ïy”
(
ÃtwÜk
 **
Ãts
, 
n
, 
j
)

1186 
i
;

1187 
ÃtwÜk
 *
Ãt
 = 
Ãts
[0];

1188 
Ïy”
 
ba£
 = 
Ãt
->
Ïy”s
[
j
];

1189 
	`sÿË_weights
(
ba£
, 0);

1190 
i
 = 0; i < 
n
; ++i) {

1191 
	`cuda_£t_deviû
(
Ãts
[
i
]->
gpu_šdex
);

1192 
Ïy”
 
l
 = 
Ãts
[
i
]->
Ïy”s
[
j
];

1193 
	`puÎ_weights
(
l
);

1194 
	`m”ge_weights
(
l
, 
ba£
);

1196 
	`sÿË_weights
(
ba£
, 1./
n
);

1197 
i
 = 0; i < 
n
; ++i) {

1198 
	`cuda_£t_deviû
(
Ãts
[
i
]->
gpu_šdex
);

1199 
Ïy”
 
l
 = 
Ãts
[
i
]->
Ïy”s
[
j
];

1200 
	`di¡ribu‹_weights
(
l
, 
ba£
);

1202 
	}
}

1205 
ÃtwÜk
 **
	mÃts
;

1206 
	mn
;

1207 
	mj
;

1208 } 
	tsync_¬gs
;

1210 *
	$sync_Ïy”_th»ad
(*
±r
)

1212 
sync_¬gs
 
¬gs
 = *(sync_¬gs*)
±r
;

1213 
	`sync_Ïy”
(
¬gs
.
Ãts
,‡rgs.
n
,‡rgs.
j
);

1214 
	`ä“
(
±r
);

1216 
	}
}

1218 
±h»ad_t
 
	$sync_Ïy”_š_th»ad
(
ÃtwÜk
 **
Ãts
, 
n
, 
j
)

1220 
±h»ad_t
 
th»ad
;

1221 
sync_¬gs
 *
±r
 = (sync_¬g *)
	`ÿÎoc
(1, (sync_args));

1222 
±r
->
Ãts
 =‚ets;

1223 
±r
->
n
 =‚;

1224 
±r
->
j
 = j;

1225 if(
	`±h»ad_ü—‹
(&
th»ad
, 0, 
sync_Ïy”_th»ad
, 
±r
)è
	`”rÜ
("Thread creation failed");

1226  
th»ad
;

1227 
	}
}

1229 
	$sync_Ãts
(
ÃtwÜk
 **
Ãts
, 
n
, 
š‹rv®
)

1231 
j
;

1232 
Ïy”s
 = 
Ãts
[0]->
n
;

1233 
±h»ad_t
 *
th»ads
 = (±h»ad_ˆ*è
	`ÿÎoc
(
Ïy”s
, (pthread_t));

1235 *(
Ãts
[0]->
£’
è+ğ
š‹rv®
 * (
n
-1è*‚‘s[0]->
b©ch
 *‚‘s[0]->
subdivisiÚs
;

1236 
j
 = 0; j < 
n
; ++j){

1237 *(
Ãts
[
j
]->
£’
) = *(nets[0]->seen);

1239 
j
 = 0; j < 
Ïy”s
; ++j) {

1240 
th»ads
[
j
] = 
	`sync_Ïy”_š_th»ad
(
Ãts
, 
n
, j);

1242 
j
 = 0; j < 
Ïy”s
; ++j) {

1243 
	`±h»ad_još
(
th»ads
[
j
], 0);

1245 
	`ä“
(
th»ads
);

1246 
	}
}

1248 
	$Œaš_ÃtwÜks
(
ÃtwÜk
 **
Ãts
, 
n
, 
d©a
 
d
, 
š‹rv®
)

1250 
i
;

1251 
b©ch
 = 
Ãts
[0]->batch;

1252 
subdivisiÚs
 = 
Ãts
[0]->subdivisions;

1253 
	`as£¹
(
b©ch
 * 
subdivisiÚs
 * 
n
 =ğ
d
.
X
.
rows
);

1254 
±h»ad_t
 *
th»ads
 = (±h»ad_ˆ*è
	`ÿÎoc
(
n
, (pthread_t));

1255 *
”rÜs
 = (*è
	`ÿÎoc
(
n
, ());

1257 
sum
 = 0;

1258 
i
 = 0; i < 
n
; ++i){

1259 
d©a
 
p
 = 
	`g‘_d©a_·¹
(
d
, 
i
, 
n
);

1260 
th»ads
[
i
] = 
	`Œaš_ÃtwÜk_š_th»ad
(
Ãts
[i], 
p
, 
”rÜs
 + i);

1262 
i
 = 0; i < 
n
; ++i){

1263 
	`±h»ad_još
(
th»ads
[
i
], 0);

1265 
sum
 +ğ
”rÜs
[
i
];

1268 ià(
	`g‘_cu¼’t_b©ch
(
Ãts
[0]è% 
š‹rv®
 == 0) {

1269 
	`´štf
("Syncing... ");

1270 
	`fæush
(
¡dout
);

1271 
	`sync_Ãts
(
Ãts
, 
n
, 
š‹rv®
);

1272 
	`´štf
("Done!\n");

1275 
	`ä“
(
th»ads
);

1276 
	`ä“
(
”rÜs
);

1277  ()
sum
/(
n
);

1278 
	}
}

1280 
	$puÎ_ÃtwÜk_ouut
(
ÃtwÜk
 *
Ãt
)

1282 
Ïy”
 
l
 = 
	`g‘_ÃtwÜk_ouut_Ïy”
(
Ãt
);

1283 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
ouuts
*l.
b©ch
);

1284 
	}
}

	@host/src/network.h

2 #iâdeà
NETWORK_H


3 
	#NETWORK_H


	)

4 
	~"d¬kÃt.h
"

6 
	~"image.h
"

7 
	~"Ïy”.h
"

8 
	~"d©a.h
"

9 
	~"Œ“.h
"

11 
Ïy”
 
¦
;

13 
com·»_ÃtwÜks
(
ÃtwÜk
 *
n1
,‚‘wÜk *
n2
, 
d©a
 
d
);

14 *
g‘_Ïy”_¡ršg
(
LAYER_TYPE
 
a
);

16 
ÃtwÜk
 *
make_ÃtwÜk
(
n
);

19 
ÃtwÜk_accu¿cy_muÉi
(
ÃtwÜk
 *
Ãt
, 
d©a
 
d
, 
n
);

20 
g‘_´ediùed_şass_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

21 
´št_ÃtwÜk
(
ÃtwÜk
 *
Ãt
);

22 
»size_ÃtwÜk
(
ÃtwÜk
 *
Ãt
, 
w
, 
h
);

23 
ÿlc_ÃtwÜk_co¡
(
ÃtwÜk
 *
Ãt
);

25 *
ÃtwÜk_´ediù_soámax
(*
d©a_fe
);

	@host/src/normalization_layer.c

1 
	~"nÜm®iz©iÚ_Ïy”.h
"

2 
	~"bÏs.h
"

4 
	~<¡dio.h
>

6 
Ïy”
 
	$make_nÜm®iz©iÚ_Ïy”
(
b©ch
, 
w
, 
h
, 
c
, 
size
, 
®pha
, 
b‘a
, 
k­·
)

8 
	`årštf
(
¡d”r
, "LoÿÈRe¥Ú£ NÜm®iz©iÚ Lay”: %d x %d x %d image, %d size\n", 
w
,
h
,
c
,
size
);

9 
Ïy”
†ayer = {0};

10 
Ïy”
.
ty³
 = 
NORMALIZATION
;

11 
Ïy”
.
b©ch
 = batch;

12 
Ïy”
.
h
 =†ay”.
out_h
 = h;

13 
Ïy”
.
w
 =†ay”.
out_w
 = w;

14 
Ïy”
.
c
 =†ay”.
out_c
 = c;

15 
Ïy”
.
k­·
 = kappa;

16 
Ïy”
.
size
 = size;

17 
Ïy”
.
®pha
 =‡lpha;

18 
Ïy”
.
b‘a
 = beta;

19 
Ïy”
.
ouut
 = 
	`ÿÎoc
(
h
 * 
w
 * 
c
 * 
b©ch
, ());

20 
Ïy”
.
d–
 = 
	`ÿÎoc
(
h
 * 
w
 * 
c
 * 
b©ch
, ());

21 
Ïy”
.
squ¬ed
 = 
	`ÿÎoc
(
h
 * 
w
 * 
c
 * 
b©ch
, ());

22 
Ïy”
.
nÜms
 = 
	`ÿÎoc
(
h
 * 
w
 * 
c
 * 
b©ch
, ());

23 
Ïy”
.
šputs
 = 
w
*
h
*
c
;

24 
Ïy”
.
ouuts
 =†ay”.
šputs
;

26 
Ïy”
.
fÜw¬d
 = 
fÜw¬d_nÜm®iz©iÚ_Ïy”
;

27 
Ïy”
.
backw¬d
 = 
backw¬d_nÜm®iz©iÚ_Ïy”
;

28 #ifdeà
GPU


29 
Ïy”
.
fÜw¬d_gpu
 = 
fÜw¬d_nÜm®iz©iÚ_Ïy”_gpu
;

30 
Ïy”
.
backw¬d_gpu
 = 
backw¬d_nÜm®iz©iÚ_Ïy”_gpu
;

32 
Ïy”
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Öay”.
ouut
, 
h
 * 
w
 * 
c
 * 
b©ch
);

33 
Ïy”
.
d–_gpu
 = 
	`cuda_make_¬¿y
Öay”.
d–
, 
h
 * 
w
 * 
c
 * 
b©ch
);

34 
Ïy”
.
squ¬ed_gpu
 = 
	`cuda_make_¬¿y
Öay”.
squ¬ed
, 
h
 * 
w
 * 
c
 * 
b©ch
);

35 
Ïy”
.
nÜms_gpu
 = 
	`cuda_make_¬¿y
Öay”.
nÜms
, 
h
 * 
w
 * 
c
 * 
b©ch
);

37  
Ïy”
;

38 
	}
}

40 
	$»size_nÜm®iz©iÚ_Ïy”
(
Ïy”
 *Ïy”, 
w
, 
h
)

42 
c
 = 
Ïy”
->c;

43 
b©ch
 = 
Ïy”
->batch;

44 
Ïy”
->
h
 = h;

45 
Ïy”
->
w
 = w;

46 
Ïy”
->
out_h
 = 
h
;

47 
Ïy”
->
out_w
 = 
w
;

48 
Ïy”
->
šputs
 = 
w
*
h
*
c
;

49 
Ïy”
->
ouuts
 =†ay”->
šputs
;

50 
Ïy”
->
ouut
 = 
	`»®loc
Öay”->ouut, 
h
 * 
w
 * 
c
 * 
b©ch
 * ());

51 
Ïy”
->
d–
 = 
	`»®loc
Öay”->d–, 
h
 * 
w
 * 
c
 * 
b©ch
 * ());

52 
Ïy”
->
squ¬ed
 = 
	`»®loc
Öay”->squ¬ed, 
h
 * 
w
 * 
c
 * 
b©ch
 * ());

53 
Ïy”
->
nÜms
 = 
	`»®loc
Öay”->nÜms, 
h
 * 
w
 * 
c
 * 
b©ch
 * ());

54 #ifdeà
GPU


55 
	`cuda_ä“
(
Ïy”
->
ouut_gpu
);

56 
	`cuda_ä“
(
Ïy”
->
d–_gpu
);

57 
	`cuda_ä“
(
Ïy”
->
squ¬ed_gpu
);

58 
	`cuda_ä“
(
Ïy”
->
nÜms_gpu
);

59 
Ïy”
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Öay”->
ouut
, 
h
 * 
w
 * 
c
 * 
b©ch
);

60 
Ïy”
->
d–_gpu
 = 
	`cuda_make_¬¿y
Öay”->
d–
, 
h
 * 
w
 * 
c
 * 
b©ch
);

61 
Ïy”
->
squ¬ed_gpu
 = 
	`cuda_make_¬¿y
Öay”->
squ¬ed
, 
h
 * 
w
 * 
c
 * 
b©ch
);

62 
Ïy”
->
nÜms_gpu
 = 
	`cuda_make_¬¿y
Öay”->
nÜms
, 
h
 * 
w
 * 
c
 * 
b©ch
);

64 
	}
}

66 
	$fÜw¬d_nÜm®iz©iÚ_Ïy”
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
)

68 
k
,
b
;

69 
w
 = 
Ïy”
.w;

70 
h
 = 
Ïy”
.h;

71 
c
 = 
Ïy”
.c;

72 
	`sÿl_ıu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, 0,†ay”.
squ¬ed
, 1);

74 
b
 = 0; b < 
Ïy”
.
b©ch
; ++b){

75 *
squ¬ed
 = 
Ïy”
.squ¬ed + 
w
*
h
*
c
*
b
;

76 *
nÜms
 = 
Ïy”
.nÜm + 
w
*
h
*
c
*
b
;

77 *
šput
 = 
Ãt
.špuˆ+ 
w
*
h
*
c
*
b
;

78 
	`pow_ıu
(
w
*
h
*
c
, 2, 
šput
, 1, 
squ¬ed
, 1);

80 
	`cÚ¡_ıu
(
w
*
h
, 
Ïy”
.
k­·
, 
nÜms
, 1);

81 
k
 = 0; k < 
Ïy”
.
size
/2; ++k){

82 
	`axpy_ıu
(
w
*
h
, 
Ïy”
.
®pha
, 
squ¬ed
 + w*h*
k
, 1, 
nÜms
, 1);

85 
k
 = 1; k < 
Ïy”
.
c
; ++k){

86 
	`cİy_ıu
(
w
*
h
, 
nÜms
 + w*h*(
k
-1), 1,‚orms + w*h*k, 1);

87 
´ev
 = 
k
 - ((
Ïy”
.
size
-1)/2) - 1;

88 
Ãxt
 = 
k
 + (
Ïy”
.
size
/2);

89 if(
´ev
 >ğ0è
	`axpy_ıu
(
w
*
h
, -
Ïy”
.
®pha
, 
squ¬ed
 + w*h*´ev, 1, 
nÜms
 + w*h*
k
, 1);

90 if(
Ãxt
 < 
Ïy”
.
c
è
	`axpy_ıu
(
w
*
h
,†ay”.
®pha
, 
squ¬ed
 + w*h*Ãxt, 1, 
nÜms
 + w*h*
k
, 1);

93 
	`pow_ıu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, -Ïy”.
b‘a
,†ay”.
nÜms
, 1,†ay”.
ouut
, 1);

94 
	`mul_ıu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, 
Ãt
.
šput
, 1,†ay”.
ouut
, 1);

95 
	}
}

97 
	$backw¬d_nÜm®iz©iÚ_Ïy”
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
)

102 
w
 = 
Ïy”
.w;

103 
h
 = 
Ïy”
.h;

104 
c
 = 
Ïy”
.c;

105 
	`pow_ıu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, -Ïy”.
b‘a
,†ay”.
nÜms
, 1, 
Ãt
.
d–
, 1);

106 
	`mul_ıu
(
w
*
h
*
c
*
Ïy”
.
b©ch
,†ay”.
d–
, 1, 
Ãt
.delta, 1);

107 
	}
}

109 #ifdeà
GPU


110 
	$fÜw¬d_nÜm®iz©iÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
)

112 
k
,
b
;

113 
w
 = 
Ïy”
.w;

114 
h
 = 
Ïy”
.h;

115 
c
 = 
Ïy”
.c;

116 
	`sÿl_gpu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, 0,†ay”.
squ¬ed_gpu
, 1);

118 
b
 = 0; b < 
Ïy”
.
b©ch
; ++b){

119 *
squ¬ed
 = 
Ïy”
.
squ¬ed_gpu
 + 
w
*
h
*
c
*
b
;

120 *
nÜms
 = 
Ïy”
.
nÜms_gpu
 + 
w
*
h
*
c
*
b
;

121 *
šput
 = 
Ãt
.
šput_gpu
 + 
w
*
h
*
c
*
b
;

122 
	`pow_gpu
(
w
*
h
*
c
, 2, 
šput
, 1, 
squ¬ed
, 1);

124 
	`cÚ¡_gpu
(
w
*
h
, 
Ïy”
.
k­·
, 
nÜms
, 1);

125 
k
 = 0; k < 
Ïy”
.
size
/2; ++k){

126 
	`axpy_gpu
(
w
*
h
, 
Ïy”
.
®pha
, 
squ¬ed
 + w*h*
k
, 1, 
nÜms
, 1);

129 
k
 = 1; k < 
Ïy”
.
c
; ++k){

130 
	`cİy_gpu
(
w
*
h
, 
nÜms
 + w*h*(
k
-1), 1,‚orms + w*h*k, 1);

131 
´ev
 = 
k
 - ((
Ïy”
.
size
-1)/2) - 1;

132 
Ãxt
 = 
k
 + (
Ïy”
.
size
/2);

133 if(
´ev
 >ğ0è
	`axpy_gpu
(
w
*
h
, -
Ïy”
.
®pha
, 
squ¬ed
 + w*h*´ev, 1, 
nÜms
 + w*h*
k
, 1);

134 if(
Ãxt
 < 
Ïy”
.
c
è
	`axpy_gpu
(
w
*
h
,†ay”.
®pha
, 
squ¬ed
 + w*h*Ãxt, 1, 
nÜms
 + w*h*
k
, 1);

137 
	`pow_gpu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, -Ïy”.
b‘a
,†ay”.
nÜms_gpu
, 1,†ay”.
ouut_gpu
, 1);

138 
	`mul_gpu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, 
Ãt
.
šput_gpu
, 1,†ay”.
ouut_gpu
, 1);

139 
	}
}

141 
	$backw¬d_nÜm®iz©iÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
)

145 
w
 = 
Ïy”
.w;

146 
h
 = 
Ïy”
.h;

147 
c
 = 
Ïy”
.c;

148 
	`pow_gpu
(
w
*
h
*
c
*
Ïy”
.
b©ch
, -Ïy”.
b‘a
,†ay”.
nÜms_gpu
, 1, 
Ãt
.
d–_gpu
, 1);

149 
	`mul_gpu
(
w
*
h
*
c
*
Ïy”
.
b©ch
,†ay”.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

150 
	}
}

	@host/src/normalization_layer.h

1 #iâdeà
NORMALIZATION_LAYER_H


2 
	#NORMALIZATION_LAYER_H


	)

4 
	~"image.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_nÜm®iz©iÚ_Ïy”
(
b©ch
, 
w
, 
h
, 
c
, 
size
, 
®pha
, 
b‘a
, 
k­·
);

9 
»size_nÜm®iz©iÚ_Ïy”
(
Ïy”
 *Ïy”, 
h
, 
w
);

10 
fÜw¬d_nÜm®iz©iÚ_Ïy”
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
);

11 
backw¬d_nÜm®iz©iÚ_Ïy”
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
);

12 
visu®ize_nÜm®iz©iÚ_Ïy”
(
Ïy”
†ay”, *
wšdow
);

14 #ifdeà
GPU


15 
fÜw¬d_nÜm®iz©iÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_nÜm®iz©iÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
†ay”, 
ÃtwÜk
 
Ãt
);

	@host/src/option_list.c

1 
	~<¡dlib.h
>

2 
	~<¡dio.h
>

3 
	~<¡ršg.h
>

4 
	~"İtiÚ_li¡.h
"

5 
	~"uts.h
"

7 
li¡
 *
	$»ad_d©a_cfg
(*
f’ame
)

9 
FILE
 *
fe
 = 
	`fİ’
(
f’ame
, "r");

10 if(
fe
 =ğ0è
	`fe_”rÜ
(
f’ame
);

11 *
lše
;

12 
nu
 = 0;

13 
li¡
 *
İtiÚs
 = 
	`make_li¡
();

14 (
lše
=
	`fg‘l
(
fe
)) != 0){

15 ++ 
nu
;

16 
	`¡r
(
lše
);

17 
lše
[0]){

21 
	`ä“
(
lše
);

24 if(!
	`»ad_İtiÚ
(
lše
, 
İtiÚs
)){

25 
	`årštf
(
¡d”r
, "CÚfig f”rÜ†š%d, could…¬£: %s\n", 
nu
, 
lše
);

26 
	`ä“
(
lše
);

31 
	`fşo£
(
fe
);

32  
İtiÚs
;

33 
	}
}

35 
m‘ad©a
 
	$g‘_m‘ad©a
(*
fe
)

37 
m‘ad©a
 
m
 = {0};

38 
li¡
 *
İtiÚs
 = 
	`»ad_d©a_cfg
(
fe
);

40 *
Çme_li¡
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "names", 0);

41 if(!
Çme_li¡
èÇme_li¡ = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "labels", 0);

42 if(!
Çme_li¡
) {

43 
	`årštf
(
¡d”r
, "No‚ames or†abels found\n");

45 
m
.
Çmes
 = 
	`g‘_Ïb–s
(
Çme_li¡
);

47 
m
.
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 2);

48 
	`ä“_li¡
(
İtiÚs
);

49  
m
;

50 
	}
}

52 
	$»ad_İtiÚ
(*
s
, 
li¡
 *
İtiÚs
)

54 
size_t
 
i
;

55 
size_t
 
Ën
 = 
	`¡¾’
(
s
);

56 *
v®
 = 0;

57 
i
 = 0; i < 
Ën
; ++i){

58 if(
s
[
i
] == '='){

59 
s
[
i
] = '\0';

60 
v®
 = 
s
+
i
+1;

64 if(
i
 =ğ
Ën
-1)  0;

65 *
key
 = 
s
;

66 
	`İtiÚ_š£¹
(
İtiÚs
, 
key
, 
v®
);

68 
	}
}

70 
	$İtiÚ_š£¹
(
li¡
 *
l
, *
key
, *
v®
)

72 
kvp
 *
p
 = 
	`m®loc
((kvp));

73 
p
->
key
 = key;

74 
p
->
v®
 = val;

75 
p
->
u£d
 = 0;

76 
	`li¡_š£¹
(
l
, 
p
);

77 
	}
}

79 
	$İtiÚ_unu£d
(
li¡
 *
l
)

81 
node
 *
n
 = 
l
->
äÚt
;

82 
n
){

83 
kvp
 *
p
 = (kv°*)
n
->
v®
;

84 if(!
p
->
u£d
){

85 
	`årštf
(
¡d”r
, "Unu£d f›ld: '% ğ%s'\n", 
p
->
key
,…->
v®
);

87 
n
 =‚->
Ãxt
;

89 
	}
}

91 *
	$İtiÚ_fšd
(
li¡
 *
l
, *
key
)

93 
node
 *
n
 = 
l
->
äÚt
;

94 
n
){

95 
kvp
 *
p
 = (kv°*)
n
->
v®
;

96 if(
	`¡rcmp
(
p
->
key
, key) == 0){

97 
p
->
u£d
 = 1;

98  
p
->
v®
;

100 
n
 =‚->
Ãxt
;

103 
	}
}

104 *
	$İtiÚ_fšd_¡r
(
li¡
 *
l
, *
key
, *
def
)

106 *
v
 = 
	`İtiÚ_fšd
(
l
, 
key
);

107 if(
v
)  v;

108 if(
def
è
	`årštf
(
¡d”r
, "%s: Usšg deçuÉ '%s'\n", 
key
, def);

109  
def
;

110 
	}
}

112 
	$İtiÚ_fšd_št
(
li¡
 *
l
, *
key
, 
def
)

114 *
v
 = 
	`İtiÚ_fšd
(
l
, 
key
);

115 if(
v
è 
	`©oi
(v);

116 
	`årštf
(
¡d”r
, "%s: Usšg deçuÉ '%d'\n", 
key
, 
def
);

117  
def
;

118 
	}
}

120 
	$İtiÚ_fšd_št_qu›t
(
li¡
 *
l
, *
key
, 
def
)

122 *
v
 = 
	`İtiÚ_fšd
(
l
, 
key
);

123 if(
v
è 
	`©oi
(v);

124  
def
;

125 
	}
}

127 
	$İtiÚ_fšd_æßt_qu›t
(
li¡
 *
l
, *
key
, 
def
)

129 *
v
 = 
	`İtiÚ_fšd
(
l
, 
key
);

130 if(
v
è 
	`©of
(v);

131  
def
;

132 
	}
}

134 
	$İtiÚ_fšd_æßt
(
li¡
 *
l
, *
key
, 
def
)

136 *
v
 = 
	`İtiÚ_fšd
(
l
, 
key
);

137 if(
v
è 
	`©of
(v);

138 
	`årštf
(
¡d”r
, "%s: Usšg deçuÉ '%lf'\n", 
key
, 
def
);

139  
def
;

140 
	}
}

	@host/src/option_list.h

1 #iâdeà
OPTION_LIST_H


2 
	#OPTION_LIST_H


	)

3 
	~"li¡.h
"

6 *
	mkey
;

7 *
	mv®
;

8 
	mu£d
;

9 } 
	tkvp
;

12 
»ad_İtiÚ
(*
s
, 
li¡
 *
İtiÚs
);

13 
İtiÚ_š£¹
(
li¡
 *
l
, *
key
, *
v®
);

14 *
İtiÚ_fšd
(
li¡
 *
l
, *
key
);

15 
İtiÚ_fšd_æßt
(
li¡
 *
l
, *
key
, 
def
);

16 
İtiÚ_fšd_æßt_qu›t
(
li¡
 *
l
, *
key
, 
def
);

17 
İtiÚ_unu£d
(
li¡
 *
l
);

	@host/src/parser.c

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<¡dlib.h
>

4 
	~<as£¹.h
>

6 
	~"aùiv©iÚ_Ïy”.h
"

7 
	~"logi¡ic_Ïy”.h
"

8 
	~"l2nÜm_Ïy”.h
"

9 
	~"aùiv©iÚs.h
"

10 
	~"avgpoŞ_Ïy”.h
"

11 
	~"b©chnÜm_Ïy”.h
"

12 
	~"bÏs.h
"

13 
	~"cÚÃùed_Ïy”.h
"

14 
	~"decÚvŞutiÚ®_Ïy”.h
"

15 
	~"cÚvŞutiÚ®_Ïy”.h
"

16 
	~"co¡_Ïy”.h
"

17 
	~"üÂ_Ïy”.h
"

18 
	~"üİ_Ïy”.h
"

19 
	~"d‘eùiÚ_Ïy”.h
"

20 
	~"drİout_Ïy”.h
"

21 
	~"gru_Ïy”.h
"

22 
	~"li¡.h
"

23 
	~"loÿl_Ïy”.h
"

24 
	~"maxpoŞ_Ïy”.h
"

25 
	~"nÜm®iz©iÚ_Ïy”.h
"

26 
	~"İtiÚ_li¡.h
"

27 
	~"·r£r.h
"

28 
	~"»giÚ_Ïy”.h
"

29 
	~"yŞo_Ïy”.h
"

30 
	~"i£g_Ïy”.h
"

31 
	~"»Üg_Ïy”.h
"

32 
	~"ºn_Ïy”.h
"

33 
	~"rou‹_Ïy”.h
"

34 
	~"up§m¶e_Ïy”.h
"

35 
	~"shÜtcut_Ïy”.h
"

36 
	~"soámax_Ïy”.h
"

37 
	~"l¡m_Ïy”.h
"

38 
	~"uts.h
"

40 
	~"maš.h
"

43 
	gcouÁ_glob®
 = 0;

44 
	g·¹™iÚ_pošt
 = 0;

45 
	gglob®_·¹™iÚ
 = 0;

46 
	gglob®_dp
 = 0;

49 *
	mty³
;

50 
li¡
 *
	mİtiÚs
;

51 }
	t£ùiÚ
;

53 
li¡
 *
»ad_cfg
(*
f’ame
);

55 
LAYER_TYPE
 
	$¡ršg_to_Ïy”_ty³
(* 
ty³
)

58 ià(
	`¡rcmp
(
ty³
, "[shÜtcut]")==0è 
SHORTCUT
;

59 ià(
	`¡rcmp
(
ty³
, "[üİ]")==0è 
CROP
;

60 ià(
	`¡rcmp
(
ty³
, "[co¡]")==0è 
COST
;

61 ià(
	`¡rcmp
(
ty³
, "[d‘eùiÚ]")==0è 
DETECTION
;

62 ià(
	`¡rcmp
(
ty³
, "[»giÚ]")==0è 
REGION
;

63 ià(
	`¡rcmp
(
ty³
, "[yŞo]")==0è 
YOLO
;

64 ià(
	`¡rcmp
(
ty³
, "[i£g]")==0è 
ISEG
;

65 ià(
	`¡rcmp
(
ty³
, "[loÿl]")==0è 
LOCAL
;

66 ià(
	`¡rcmp
(
ty³
, "[conv]")==0

67 || 
	`¡rcmp
(
ty³
, "[cÚvŞutiÚ®]")==0è 
CONVOLUTIONAL
;

68 ià(
	`¡rcmp
(
ty³
, "[deconv]")==0

69 || 
	`¡rcmp
(
ty³
, "[decÚvŞutiÚ®]")==0è 
DECONVOLUTIONAL
;

70 ià(
	`¡rcmp
(
ty³
, "[aùiv©iÚ]")==0è 
ACTIVE
;

71 ià(
	`¡rcmp
(
ty³
, "[logi¡ic]")==0è 
LOGXENT
;

72 ià(
	`¡rcmp
(
ty³
, "[l2nÜm]")==0è 
L2NORM
;

73 ià(
	`¡rcmp
(
ty³
, "[net]")==0

74 || 
	`¡rcmp
(
ty³
, "[ÃtwÜk]")==0è 
NETWORK
;

75 ià(
	`¡rcmp
(
ty³
, "[üÂ]")==0è 
CRNN
;

76 ià(
	`¡rcmp
(
ty³
, "[gru]")==0è 
GRU
;

77 ià(
	`¡rcmp
(
ty³
, "[l¡m]"è=ğ0è 
LSTM
;

78 ià(
	`¡rcmp
(
ty³
, "[ºn]")==0è 
RNN
;

79 ià(
	`¡rcmp
(
ty³
, "[conn]")==0

80 || 
	`¡rcmp
(
ty³
, "[cÚÃùed]")==0è 
CONNECTED
;

81 ià(
	`¡rcmp
(
ty³
, "[max]")==0

82 || 
	`¡rcmp
(
ty³
, "[maxpoŞ]")==0è 
MAXPOOL
;

83 ià(
	`¡rcmp
(
ty³
, "[»Üg]")==0è 
REORG
;

84 ià(
	`¡rcmp
(
ty³
, "[avg]")==0

85 || 
	`¡rcmp
(
ty³
, "[avgpoŞ]")==0è 
AVGPOOL
;

86 ià(
	`¡rcmp
(
ty³
, "[drİout]")==0è 
DROPOUT
;

87 ià(
	`¡rcmp
(
ty³
, "[lrn]")==0

88 || 
	`¡rcmp
(
ty³
, "[nÜm®iz©iÚ]")==0è 
NORMALIZATION
;

89 ià(
	`¡rcmp
(
ty³
, "[b©chnÜm]")==0è 
BATCHNORM
;

90 ià(
	`¡rcmp
(
ty³
, "[soft]")==0

91 || 
	`¡rcmp
(
ty³
, "[soámax]")==0è 
SOFTMAX
;

92 ià(
	`¡rcmp
(
ty³
, "[rou‹]")==0è 
ROUTE
;

93 ià(
	`¡rcmp
(
ty³
, "[up§m¶e]")==0è 
UPSAMPLE
;

94  
BLANK
;

95 
	}
}

97 
	$ä“_£ùiÚ
(
£ùiÚ
 *
s
)

99 
	`ä“
(
s
->
ty³
);

100 
node
 *
n
 = 
s
->
İtiÚs
->
äÚt
;

101 
n
){

102 
kvp
 *
·œ
 = (kv°*)
n
->
v®
;

103 
	`ä“
(
·œ
->
key
);

104 
	`ä“
(
·œ
);

105 
node
 *
Ãxt
 = 
n
->next;

106 
	`ä“
(
n
);

107 
n
 = 
Ãxt
;

109 
	`ä“
(
s
->
İtiÚs
);

110 
	`ä“
(
s
);

111 
	}
}

113 
	$·r£_d©a
(*
d©a
, *
a
, 
n
)

115 
i
;

116 if(!
d©a
) ;

117 *
cu¼
 = 
d©a
;

118 *
Ãxt
 = 
d©a
;

119 
dÚe
 = 0;

120 
i
 = 0; i < 
n
 && !
dÚe
; ++i){

121 *++
Ãxt
 !='\0' && *next != ',');

122 if(*
Ãxt
 =ğ'\0'è
dÚe
 = 1;

123 *
Ãxt
 = '\0';

124 
	`ssÿnf
(
cu¼
, "%g", &
a
[
i
]);

125 
cu¼
 = 
Ãxt
+1;

127 
	}
}

129 
	ssize_·¿ms
{

130 
	mb©ch
;

131 
	mšputs
;

132 
	mh
;

133 
	mw
;

134 
	mc
;

135 
	mšdex
;

136 
	mtime_¡•s
;

137 
ÃtwÜk
 *
	mÃt
;

138 } 
	tsize_·¿ms
;

141 
loÿl_Ïy”
 
	$·r£_loÿl
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

143 
n
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "filters",1);

144 
size
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "size",1);

145 
¡ride
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "stride",1);

146 
·d
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "pad",0);

147 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "logistic");

148 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

150 
b©ch
,
h
,
w
,
c
;

151 
h
 = 
·¿ms
.h;

152 
w
 = 
·¿ms
.w;

153 
c
 = 
·¿ms
.c;

154 
b©ch
=
·¿ms
.batch;

155 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before†ocal†ayer must output image.");

157 
loÿl_Ïy”
 
Ïy”
 = 
	`make_loÿl_Ïy”
(
b©ch
,
h
,
w
,
c
,
n
,
size
,
¡ride
,
·d
,
aùiv©iÚ
);

159  
Ïy”
;

160 
	}
}

162 
Ïy”
 
	$·r£_decÚvŞutiÚ®
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

164 
n
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "filters",1);

165 
size
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "size",1);

166 
¡ride
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "stride",1);

168 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "logistic");

169 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

171 
b©ch
,
h
,
w
,
c
;

172 
h
 = 
·¿ms
.h;

173 
w
 = 
·¿ms
.w;

174 
c
 = 
·¿ms
.c;

175 
b©ch
=
·¿ms
.batch;

176 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before deconvolutional†ayer must output image.");

177 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

178 
·d
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "pad",0);

179 
·ddšg
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "padding",0);

180 if(
·d
è
·ddšg
 = 
size
/2;

182 
Ïy”
 
l
 = 
	`make_decÚvŞutiÚ®_Ïy”
(
b©ch
,
h
,
w
,
c
,
n
,
size
,
¡ride
,
·ddšg
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
·¿ms
.
Ãt
->
adam
);

184  
l
;

185 
	}
}

188 
cÚvŞutiÚ®_Ïy”
 
	$·r£_cÚvŞutiÚ®
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

190 
n
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "filters",1);

191 
size
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "size",1);

192 
¡ride
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "stride",1);

193 
·d
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "pad",0);

194 
·ddšg
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "padding",0);

195 
groups
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "groups", 1);

196 if(
·d
è
·ddšg
 = 
size
/2;

198 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "logistic");

199 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

201 
b©ch
,
h
,
w
,
c
;

202 
h
 = 
·¿ms
.h;

203 
w
 = 
·¿ms
.w;

204 
c
 = 
·¿ms
.c;

205 
b©ch
=
·¿ms
.batch;

206 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before convolutional†ayer must output image.");

207 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

208 
bš¬y
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "binary", 0);

209 
xnÜ
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "xnor", 0);

211 
cÚvŞutiÚ®_Ïy”
 
Ïy”
 = 
	`make_cÚvŞutiÚ®_Ïy”
(
b©ch
,
h
,
w
,
c
,
n
,
groups
,
size
,
¡ride
,
·ddšg
,
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
·¿ms
.
Ãt
->
adam
);

212 
Ïy”
.
æ³d
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "flipped", 0);

213 
Ïy”
.
dÙ
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "dot", 0);

218 
	`make_cÚvŞutiÚ®_Ïy”_CA
(
b©ch
,
h
,
w
,
c
,
n
,
groups
,
size
,
¡ride
,
·ddšg
,
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
·¿ms
.
Ãt
->
adam
, 
Ïy”
.
æ³d
,†ay”.
dÙ
);

221  
Ïy”
;

222 
	}
}

224 
Ïy”
 
	$·r£_üÂ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

226 
ouut_f‹rs
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "output_filters",1);

227 
hidd’_f‹rs
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "hidden_filters",1);

228 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "logistic");

229 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

230 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

232 
Ïy”
 
l
 = 
	`make_üÂ_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
,…¬ams.
c
, 
hidd’_f‹rs
, 
ouut_f‹rs
,…¬ams.
time_¡•s
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
);

234 
l
.
shÜtcut
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "shortcut", 0);

236  
l
;

237 
	}
}

239 
Ïy”
 
	$·r£_ºn
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

241 
ouut
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "output",1);

242 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "logistic");

243 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

244 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

246 
Ïy”
 
l
 = 
	`make_ºn_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ouut
,…¬ams.
time_¡•s
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
,…¬ams.
Ãt
->
adam
);

248 
l
.
shÜtcut
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "shortcut", 0);

250  
l
;

251 
	}
}

253 
Ïy”
 
	$·r£_gru
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

255 
ouut
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "output",1);

256 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

258 
Ïy”
 
l
 = 
	`make_gru_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ouut
,…¬ams.
time_¡•s
, 
b©ch_nÜm®ize
,…¬ams.
Ãt
->
adam
);

259 
l
.
nh
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "tanh", 0);

261  
l
;

262 
	}
}

264 
Ïy”
 
	$·r£_l¡m
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

266 
ouut
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "output", 1);

267 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

269 
Ïy”
 
l
 = 
	`make_l¡m_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ouut
,…¬ams.
time_¡•s
, 
b©ch_nÜm®ize
,…¬ams.
Ãt
->
adam
);

271  
l
;

272 
	}
}

274 
Ïy”
 
	$·r£_cÚÃùed
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

276 
ouut
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "output",1);

277 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "logistic");

278 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

279 
b©ch_nÜm®ize
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "batch_normalize", 0);

281 
Ïy”
 
l
 = 
	`make_cÚÃùed_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ouut
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
,…¬ams.
Ãt
->
adam
);

286 
	`make_cÚÃùed_Ïy”_CA
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ouut
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
,…¬ams.
Ãt
->
adam
);

288  
l
;

289 
	}
}

291 
Ïy”
 
	$·r£_soámax
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

293 
groups
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "groups",1);

294 
Ïy”
 
l
 = 
	`make_soámax_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
groups
);

295 
l
.
‹m³¿tu»
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "temperature", 1);

296 *
Œ“_fe
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "tree", 0);

297 ià(
Œ“_fe
è
l
.
soámax_Œ“
 = 
	`»ad_Œ“
(tree_file);

298 
l
.
w
 = 
·¿ms
.w;

299 
l
.
h
 = 
·¿ms
.h;

300 
l
.
c
 = 
·¿ms
.c;

301 
l
.
¥©Ÿl
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "spatial", 0);

302 
l
.
nŞoss
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "noloss", 0);

306 
	`make_soámax_Ïy”_CA
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
groups
, 
l
.
‹m³¿tu»
,†.
w
,†.
h
,†.
c
,†.
¥©Ÿl
,†.
nŞoss
);

309  
l
;

310 
	}
}

312 *
	$·r£_yŞo_mask
(*
a
, *
num
)

314 *
mask
 = 0;

315 if(
a
){

316 
Ën
 = 
	`¡¾’
(
a
);

317 
n
 = 1;

318 
i
;

319 
i
 = 0; i < 
Ën
; ++i){

320 ià(
a
[
i
] =ğ','è++
n
;

322 
mask
 = 
	`ÿÎoc
(
n
, ());

323 
i
 = 0; i < 
n
; ++i){

324 
v®
 = 
	`©oi
(
a
);

325 
mask
[
i
] = 
v®
;

326 
a
 = 
	`¡rchr
(a, ',')+1;

328 *
num
 = 
n
;

330  
mask
;

331 
	}
}

333 
Ïy”
 
	$·r£_yŞo
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

335 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 20);

336 
tÙ®
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "num", 1);

337 
num
 = 
tÙ®
;

339 *
a
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "mask", 0);

340 *
mask
 = 
	`·r£_yŞo_mask
(
a
, &
num
);

341 
Ïy”
 
l
 = 
	`make_yŞo_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
, 
num
, 
tÙ®
, 
mask
, 
şas£s
);

342 
	`as£¹
(
l
.
ouuts
 =ğ
·¿ms
.
šputs
);

344 
l
.
max_boxes
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "max",90);

345 
l
.
j™‹r
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "jitter", .2);

347 
l
.
ignÜe_th»sh
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "ignore_thresh", .5);

348 
l
.
Œuth_th»sh
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "truth_thresh", 1);

349 
l
.
¿ndom
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "random", 0);

351 *
m­_fe
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "map", 0);

352 ià(
m­_fe
è
l
.
m­
 = 
	`»ad_m­
(map_file);

354 
a
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "anchors", 0);

355 if(
a
){

356 
Ën
 = 
	`¡¾’
(
a
);

357 
n
 = 1;

358 
i
;

359 
i
 = 0; i < 
Ën
; ++i){

360 ià(
a
[
i
] =ğ','è++
n
;

362 
i
 = 0; i < 
n
; ++i){

363 
bŸs
 = 
	`©of
(
a
);

364 
l
.
bŸ£s
[
i
] = 
bŸs
;

365 
a
 = 
	`¡rchr
(a, ',')+1;

368  
l
;

369 
	}
}

371 
Ïy”
 
	$·r£_i£g
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

373 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 20);

374 
ids
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "ids", 32);

375 
Ïy”
 
l
 = 
	`make_i£g_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
, 
şas£s
, 
ids
);

376 
	`as£¹
(
l
.
ouuts
 =ğ
·¿ms
.
šputs
);

377  
l
;

378 
	}
}

380 
Ïy”
 
	$·r£_»giÚ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

382 
coÜds
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "coords", 4);

383 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 20);

384 
num
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "num", 1);

386 
Ïy”
 
l
 = 
	`make_»giÚ_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
, 
num
, 
şas£s
, 
coÜds
);

387 
	`as£¹
(
l
.
ouuts
 =ğ
·¿ms
.
šputs
);

389 
l
.
log
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "log", 0);

390 
l
.
sq¹
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "sqrt", 0);

392 
l
.
soámax
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "softmax", 0);

393 
l
.
background
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "background", 0);

394 
l
.
max_boxes
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "max",30);

395 
l
.
j™‹r
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "jitter", .2);

396 
l
.
»scÜe
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "rescore",0);

398 
l
.
th»sh
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "thresh", .5);

399 
l
.
şassfix
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "classfix", 0);

400 
l
.
absŞu‹
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "absolute", 0);

401 
l
.
¿ndom
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "random", 0);

403 
l
.
coÜd_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "coord_scale", 1);

404 
l
.
objeù_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "object_scale", 1);

405 
l
.
noobjeù_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "noobject_scale", 1);

406 
l
.
mask_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "mask_scale", 1);

407 
l
.
şass_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "class_scale", 1);

408 
l
.
bŸs_m©ch
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "bias_match",0);

410 *
Œ“_fe
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "tree", 0);

411 ià(
Œ“_fe
è
l
.
soámax_Œ“
 = 
	`»ad_Œ“
(tree_file);

412 *
m­_fe
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "map", 0);

413 ià(
m­_fe
è
l
.
m­
 = 
	`»ad_m­
(map_file);

415 *
a
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "anchors", 0);

416 if(
a
){

417 
Ën
 = 
	`¡¾’
(
a
);

418 
n
 = 1;

419 
i
;

420 
i
 = 0; i < 
Ën
; ++i){

421 ià(
a
[
i
] =ğ','è++
n
;

423 
i
 = 0; i < 
n
; ++i){

424 
bŸs
 = 
	`©of
(
a
);

425 
l
.
bŸ£s
[
i
] = 
bŸs
;

426 
a
 = 
	`¡rchr
(a, ',')+1;

429  
l
;

430 
	}
}

432 
d‘eùiÚ_Ïy”
 
	$·r£_d‘eùiÚ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

434 
coÜds
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "coords", 1);

435 
şas£s
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "classes", 1);

436 
»scÜe
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "rescore", 0);

437 
num
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "num", 1);

438 
side
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "side", 7);

439 
d‘eùiÚ_Ïy”
 
Ïy”
 = 
	`make_d‘eùiÚ_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
num
, 
side
, 
şas£s
, 
coÜds
, 
»scÜe
);

441 
Ïy”
.
soámax
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "softmax", 0);

442 
Ïy”
.
sq¹
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "sqrt", 0);

444 
Ïy”
.
max_boxes
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "max",90);

445 
Ïy”
.
coÜd_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "coord_scale", 1);

446 
Ïy”
.
fÜûd
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "forced", 0);

447 
Ïy”
.
objeù_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "object_scale", 1);

448 
Ïy”
.
noobjeù_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "noobject_scale", 1);

449 
Ïy”
.
şass_sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "class_scale", 1);

450 
Ïy”
.
j™‹r
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "jitter", .2);

451 
Ïy”
.
¿ndom
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "random", 0);

452 
Ïy”
.
»Üg
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "reorg", 0);

453  
Ïy”
;

454 
	}
}

456 
co¡_Ïy”
 
	$·r£_co¡
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

458 *
ty³_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "type", "sse");

459 
COST_TYPE
 
ty³
 = 
	`g‘_co¡_ty³
(
ty³_s
);

460 
sÿË
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "scale",1);

461 
co¡_Ïy”
 
Ïy”
 = 
	`make_co¡_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ty³
, 
sÿË
);

462 
Ïy”
.
¿tio
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "ratio",0);

463 
Ïy”
.
noobjeù_sÿË
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "noobj", 1);

464 
Ïy”
.
th»sh
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "thresh",0);

468 
	`make_co¡_Ïy”_CA
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
ty³
, 
sÿË
, 
Ïy”
.
¿tio
,†ay”.
noobjeù_sÿË
,†ay”.
th»sh
);

471  
Ïy”
;

472 
	}
}

474 
üİ_Ïy”
 
	$·r£_üİ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

476 
üİ_height
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "crop_height",1);

477 
üİ_width
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "crop_width",1);

478 
æ
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "flip",0);

479 
ªgË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "angle",0);

480 
§tu¿tiÚ
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "saturation",1);

481 
exposu»
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "exposure",1);

483 
b©ch
,
h
,
w
,
c
;

484 
h
 = 
·¿ms
.h;

485 
w
 = 
·¿ms
.w;

486 
c
 = 
·¿ms
.c;

487 
b©ch
=
·¿ms
.batch;

488 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before crop†ayer must output image.");

490 
nßdju¡
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "noadjust",0);

492 
üİ_Ïy”
 
l
 = 
	`make_üİ_Ïy”
(
b©ch
,
h
,
w
,
c
,
üİ_height
,
üİ_width
,
æ
, 
ªgË
, 
§tu¿tiÚ
, 
exposu»
);

493 
l
.
shiá
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "shift", 0);

494 
l
.
nßdju¡
 =‚oadjust;

495  
l
;

496 
	}
}

498 
Ïy”
 
	$·r£_»Üg
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

500 
¡ride
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "stride",1);

501 
»v”£
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "reverse",0);

502 
æ©‹n
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "flatten",0);

503 
exŒa
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "extra",0);

505 
b©ch
,
h
,
w
,
c
;

506 
h
 = 
·¿ms
.h;

507 
w
 = 
·¿ms
.w;

508 
c
 = 
·¿ms
.c;

509 
b©ch
=
·¿ms
.batch;

510 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before„eorg†ayer must output image.");

512 
Ïy”
†ay” = 
	`make_»Üg_Ïy”
(
b©ch
,
w
,
h
,
c
,
¡ride
,
»v”£
, 
æ©‹n
, 
exŒa
);

513  
Ïy”
;

514 
	}
}

516 
maxpoŞ_Ïy”
 
	$·r£_maxpoŞ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

518 
¡ride
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "stride",1);

519 
size
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "size",
¡ride
);

520 
·ddšg
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "·ddšg", 
size
-1);

522 
b©ch
,
h
,
w
,
c
;

523 
h
 = 
·¿ms
.h;

524 
w
 = 
·¿ms
.w;

525 
c
 = 
·¿ms
.c;

526 
b©ch
=
·¿ms
.batch;

527 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before maxpool†ayer must output image.");

529 
maxpoŞ_Ïy”
 
Ïy”
 = 
	`make_maxpoŞ_Ïy”
(
b©ch
,
h
,
w
,
c
,
size
,
¡ride
,
·ddšg
);

533 
	`make_maxpoŞ_Ïy”_CA
(
b©ch
,
h
,
w
,
c
,
size
,
¡ride
,
·ddšg
);

536  
Ïy”
;

537 
	}
}

539 
avgpoŞ_Ïy”
 
	$·r£_avgpoŞ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

541 
b©ch
,
w
,
h
,
c
;

542 
w
 = 
·¿ms
.w;

543 
h
 = 
·¿ms
.h;

544 
c
 = 
·¿ms
.c;

545 
b©ch
=
·¿ms
.batch;

546 if(!(
h
 && 
w
 && 
c
)è
	`”rÜ
("Layer before‡vgpool†ayer must output image.");

548 
avgpoŞ_Ïy”
 
Ïy”
 = 
	`make_avgpoŞ_Ïy”
(
b©ch
,
w
,
h
,
c
);

549  
Ïy”
;

550 
	}
}

552 
drİout_Ïy”
 
	$·r£_drİout
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
, *
Ãt_´ev_ouut
, *
Ãt_´ev_d–
)

554 
´obab™y
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "probability", .5);

555 
drİout_Ïy”
 
Ïy”
 = 
	`make_drİout_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
´obab™y
);

556 
Ïy”
.
out_w
 = 
·¿ms
.
w
;

557 
Ïy”
.
out_h
 = 
·¿ms
.
h
;

558 
Ïy”
.
out_c
 = 
·¿ms
.
c
;

560 
Ïy”
.
ouut
 = 
Ãt_´ev_ouut
;

561 
Ïy”
.
d–
 = 
Ãt_´ev_d–
;

565 
	`make_drİout_Ïy”_CA
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
´obab™y
,…¬ams.
w
,…¬ams.
h
,…¬ams.
c
, 
Ãt_´ev_ouut
, 
Ãt_´ev_d–
);

568  
Ïy”
;

569 
	}
}

571 
Ïy”
 
	$·r£_nÜm®iz©iÚ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

573 
®pha
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "alpha", .0001);

574 
b‘a
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "beta" , .75);

575 
k­·
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "kappa", 1);

576 
size
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "size", 5);

577 
Ïy”
 
l
 = 
	`make_nÜm®iz©iÚ_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
,…¬ams.
c
, 
size
, 
®pha
, 
b‘a
, 
k­·
);

578  
l
;

579 
	}
}

581 
Ïy”
 
	$·r£_b©chnÜm
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

583 
Ïy”
 
l
 = 
	`make_b©chnÜm_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
,…¬ams.
c
);

584  
l
;

585 
	}
}

587 
Ïy”
 
	$·r£_shÜtcut
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
, 
ÃtwÜk
 *
Ãt
)

589 *
l
 = 
	`İtiÚ_fšd
(
İtiÚs
, "from");

590 
šdex
 = 
	`©oi
(
l
);

591 if(
šdex
 < 0èšdex = 
·¿ms
.index + index;

593 
b©ch
 = 
·¿ms
.batch;

594 
Ïy”
 
äom
 = 
Ãt
->
Ïy”s
[
šdex
];

596 
Ïy”
 
s
 = 
	`make_shÜtcut_Ïy”
(
b©ch
, 
šdex
, 
·¿ms
.
w
,…¬ams.
h
,…¬ams.
c
, 
äom
.
out_w
, from.
out_h
, from.
out_c
);

598 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "linear");

599 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

600 
s
.
aùiv©iÚ
 =‡ctivation;

601 
s
.
®pha
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "alpha", 1);

602 
s
.
b‘a
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "beta", 1);

603  
s
;

604 
	}
}

607 
Ïy”
 
	$·r£_l2nÜm
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

609 
Ïy”
 
l
 = 
	`make_l2nÜm_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
);

610 
l
.
h
 =†.
out_h
 = 
·¿ms
.h;

611 
l
.
w
 =†.
out_w
 = 
·¿ms
.w;

612 
l
.
c
 =†.
out_c
 = 
·¿ms
.c;

613  
l
;

614 
	}
}

617 
Ïy”
 
	$·r£_logi¡ic
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

619 
Ïy”
 
l
 = 
	`make_logi¡ic_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
);

620 
l
.
h
 =†.
out_h
 = 
·¿ms
.h;

621 
l
.
w
 =†.
out_w
 = 
·¿ms
.w;

622 
l
.
c
 =†.
out_c
 = 
·¿ms
.c;

623  
l
;

624 
	}
}

626 
Ïy”
 
	$·r£_aùiv©iÚ
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
)

628 *
aùiv©iÚ_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "activation", "linear");

629 
ACTIVATION
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ
(
aùiv©iÚ_s
);

631 
Ïy”
 
l
 = 
	`make_aùiv©iÚ_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
šputs
, 
aùiv©iÚ
);

633 
l
.
h
 =†.
out_h
 = 
·¿ms
.h;

634 
l
.
w
 =†.
out_w
 = 
·¿ms
.w;

635 
l
.
c
 =†.
out_c
 = 
·¿ms
.c;

637  
l
;

638 
	}
}

640 
Ïy”
 
	$·r£_up§m¶e
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
, 
ÃtwÜk
 *
Ãt
)

643 
¡ride
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "stride",2);

644 
Ïy”
 
l
 = 
	`make_up§m¶e_Ïy”
(
·¿ms
.
b©ch
,…¬ams.
w
,…¬ams.
h
,…¬ams.
c
, 
¡ride
);

645 
l
.
sÿË
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "scale", 1);

646  
l
;

647 
	}
}

649 
rou‹_Ïy”
 
	$·r£_rou‹
(
li¡
 *
İtiÚs
, 
size_·¿ms
 
·¿ms
, 
ÃtwÜk
 *
Ãt
)

651 *
l
 = 
	`İtiÚ_fšd
(
İtiÚs
, "layers");

652 
Ën
 = 
	`¡¾’
(
l
);

653 if(!
l
è
	`”rÜ
("Route Layer must specify input†ayers");

654 
n
 = 1;

655 
i
;

656 
i
 = 0; i < 
Ën
; ++i){

657 ià(
l
[
i
] =ğ','è++
n
;

660 *
Ïy”s
 = 
	`ÿÎoc
(
n
, ());

661 *
sizes
 = 
	`ÿÎoc
(
n
, ());

662 
i
 = 0; i < 
n
; ++i){

663 
šdex
 = 
	`©oi
(
l
);

664 
l
 = 
	`¡rchr
(l, ',')+1;

665 if(
šdex
 < 0èšdex = 
·¿ms
.index + index;

666 
Ïy”s
[
i
] = 
šdex
;

667 
sizes
[
i
] = 
Ãt
->
Ïy”s
[
šdex
].
ouuts
;

669 
b©ch
 = 
·¿ms
.batch;

671 
rou‹_Ïy”
 
Ïy”
 = 
	`make_rou‹_Ïy”
(
b©ch
, 
n
, 
Ïy”s
, 
sizes
);

673 
cÚvŞutiÚ®_Ïy”
 
fœ¡
 = 
Ãt
->
Ïy”s
[layers[0]];

674 
Ïy”
.
out_w
 = 
fœ¡
.out_w;

675 
Ïy”
.
out_h
 = 
fœ¡
.out_h;

676 
Ïy”
.
out_c
 = 
fœ¡
.out_c;

677 
i
 = 1; i < 
n
; ++i){

678 
šdex
 = 
Ïy”s
[
i
];

679 
cÚvŞutiÚ®_Ïy”
 
Ãxt
 = 
Ãt
->
Ïy”s
[
šdex
];

680 if(
Ãxt
.
out_w
 =ğ
fœ¡
.out_w &&‚ext.
out_h
 == first.out_h){

681 
Ïy”
.
out_c
 +ğ
Ãxt
.out_c;

683 
Ïy”
.
out_h
 =†ay”.
out_w
 =†ay”.
out_c
 = 0;

687  
Ïy”
;

688 
	}
}

690 
Ë¬nšg_¿‹_pŞicy
 
	$g‘_pŞicy
(*
s
)

692 ià(
	`¡rcmp
(
s
, "¿ndom")==0è 
RANDOM
;

693 ià(
	`¡rcmp
(
s
, "pŞy")==0è 
POLY
;

694 ià(
	`¡rcmp
(
s
, "cÚ¡ªt")==0è 
CONSTANT
;

695 ià(
	`¡rcmp
(
s
, "¡•")==0è 
STEP
;

696 ià(
	`¡rcmp
(
s
, "exp")==0è 
EXP
;

697 ià(
	`¡rcmp
(
s
, "sigmoid")==0è 
SIG
;

698 ià(
	`¡rcmp
(
s
, "¡•s")==0è 
STEPS
;

699 
	`årštf
(
¡d”r
, "Couldn'ˆfšd…Şicy %s, gošg w™h cÚ¡ªt\n", 
s
);

700  
CONSTANT
;

701 
	}
}

703 
	$·r£_Ãt_İtiÚs
(
li¡
 *
İtiÚs
, 
ÃtwÜk
 *
Ãt
)

705 
Ãt
->
b©ch
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "batch", 1);

706 if(
¡©e
 == 'p'){

707 
Ãt
->
b©ch
 = 1;

709 
Ãt
->
Ë¬nšg_¿‹
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "learning_rate", .001);

710 
Ãt
->
mom’tum
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "momentum", .9);

711 
Ãt
->
deÿy
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "decay", .0001);

712 
subdivs
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "subdivisions",1);

713 
Ãt
->
time_¡•s
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "time_steps",1);

714 
Ãt
->
nÙruth
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "notruth",0);

715 
Ãt
->
b©ch
 /ğ
subdivs
;

716 
Ãt
->
b©ch
 *ğÃt->
time_¡•s
;

717 
Ãt
->
subdivisiÚs
 = 
subdivs
;

718 
Ãt
->
¿ndom
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "random", 0);

720 
Ãt
->
adam
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "adam", 0);

721 if(
Ãt
->
adam
){

722 
Ãt
->
B1
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "B1", .9);

723 
Ãt
->
B2
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "B2", .999);

724 
Ãt
->
•s
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "eps", .0000001);

727 
Ãt
->
h
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "height",0);

728 
Ãt
->
w
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "width",0);

729 
Ãt
->
c
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "channels",0);

730 
Ãt
->
šputs
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "šputs",‚‘->
h
 *‚‘->
w
 *‚‘->
c
);

731 
Ãt
->
max_üİ
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "max_üİ",Ãt->
w
*2);

732 
Ãt
->
mš_üİ
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "mš_üİ",Ãt->
w
);

733 
Ãt
->
max_¿tio
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "max_¿tio", (èÃt->
max_üİ
 /‚‘->
w
);

734 
Ãt
->
mš_¿tio
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "mš_¿tio", (èÃt->
mš_üİ
 /‚‘->
w
);

735 
Ãt
->
ûÁ”
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "center",0);

736 
Ãt
->
ş
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "clip", 0);

738 
Ãt
->
ªgË
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "angle", 0);

739 
Ãt
->
a¥eù
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "aspect", 1);

740 
Ãt
->
§tu¿tiÚ
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "saturation", 1);

741 
Ãt
->
exposu»
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "exposure", 1);

742 
Ãt
->
hue
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "hue", 0);

744 if(!
Ãt
->
šputs
 && !Ò‘->
h
 &&‚‘->
w
 &&‚‘->
c
)è
	`”rÜ
("No input…arameters supplied");

746 *
pŞicy_s
 = 
	`İtiÚ_fšd_¡r
(
İtiÚs
, "policy", "constant");

747 
Ãt
->
pŞicy
 = 
	`g‘_pŞicy
(
pŞicy_s
);

748 
Ãt
->
buº_š
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "burn_in", 0);

749 
Ãt
->
pow”
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "power", 4);

750 if(
Ãt
->
pŞicy
 =ğ
STEP
){

751 
Ãt
->
¡•
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "step", 1);

752 
Ãt
->
sÿË
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "scale", 1);

753 } ià(
Ãt
->
pŞicy
 =ğ
STEPS
){

754 *
l
 = 
	`İtiÚ_fšd
(
İtiÚs
, "steps");

755 *
p
 = 
	`İtiÚ_fšd
(
İtiÚs
, "scales");

756 if(!
l
 || !
p
è
	`”rÜ
("STEPS…olicy must have steps‡nd scales in cfg file");

758 
Ën
 = 
	`¡¾’
(
l
);

759 
n
 = 1;

760 
i
;

761 
i
 = 0; i < 
Ën
; ++i){

762 ià(
l
[
i
] =ğ','è++
n
;

764 *
¡•s
 = 
	`ÿÎoc
(
n
, ());

765 *
sÿËs
 = 
	`ÿÎoc
(
n
, ());

766 
i
 = 0; i < 
n
; ++i){

767 
¡•
 = 
	`©oi
(
l
);

768 
sÿË
 = 
	`©of
(
p
);

769 
l
 = 
	`¡rchr
(l, ',')+1;

770 
p
 = 
	`¡rchr
(p, ',')+1;

771 
¡•s
[
i
] = 
¡•
;

772 
sÿËs
[
i
] = 
sÿË
;

774 
Ãt
->
sÿËs
 = scales;

775 
Ãt
->
¡•s
 = steps;

776 
Ãt
->
num_¡•s
 = 
n
;

777 } ià(
Ãt
->
pŞicy
 =ğ
EXP
){

778 
Ãt
->
gamma
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "gamma", 1);

779 } ià(
Ãt
->
pŞicy
 =ğ
SIG
){

780 
Ãt
->
gamma
 = 
	`İtiÚ_fšd_æßt
(
İtiÚs
, "gamma", 1);

781 
Ãt
->
¡•
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "step", 1);

782 } ià(
Ãt
->
pŞicy
 =ğ
POLY
 ||‚‘->pŞicy =ğ
RANDOM
){

784 
Ãt
->
max_b©ches
 = 
	`İtiÚ_fšd_št
(
İtiÚs
, "max_batches", 0);

786 
	`make_ÃtwÜk_CA
(
Ãt
->
n
,‚‘->
Ë¬nšg_¿‹
,‚‘->
mom’tum
,‚‘->
deÿy
,‚‘->
time_¡•s
,‚‘->
nÙruth
,‚‘->
b©ch
,‚‘->
subdivisiÚs
,‚‘->
¿ndom
,‚‘->
adam
,‚‘->
B1
,‚‘->
B2
,‚‘->
•s
,‚‘->
h
,‚‘->
w
,‚‘->
c
,‚‘->
šputs
,‚‘->
max_üİ
,‚‘->
mš_üİ
,‚‘->
max_¿tio
,‚‘->
mš_¿tio
,‚‘->
ûÁ”
,‚‘->
ş
,‚‘->
ªgË
,‚‘->
a¥eù
,‚‘->
§tu¿tiÚ
,‚‘->
exposu»
,‚‘->
hue
,‚‘->
buº_š
,‚‘->
pow”
,‚‘->
max_b©ches
);

787 
	}
}

789 
	$is_ÃtwÜk
(
£ùiÚ
 *
s
)

791  (
	`¡rcmp
(
s
->
ty³
, "[net]")==0

792 || 
	`¡rcmp
(
s
->
ty³
, "[network]")==0);

793 
	}
}

795 
ÃtwÜk
 *
	$·r£_ÃtwÜk_cfg
(*
f’ame
)

797 
li¡
 *
£ùiÚs
 = 
	`»ad_cfg
(
f’ame
);

798 
node
 *
n
 = 
£ùiÚs
->
äÚt
;

799 if(!
n
è
	`”rÜ
("Config file has‚o sections");

801 
ÃtwÜk
 *
Ãt
 = 
	`make_ÃtwÜk
(
glob®_·¹™iÚ
);

804 
Ãt
->
gpu_šdex
 = -1;

805 
size_·¿ms
 
·¿ms
;

807 
£ùiÚ
 *
s
 = (£ùiÚ *)
n
->
v®
;

808 
li¡
 *
İtiÚs
 = 
s
->options;

809 if(!
	`is_ÃtwÜk
(
s
)è
	`”rÜ
("First section must be [net] or [network]");

810 
	`·r£_Ãt_İtiÚs
(
İtiÚs
, 
Ãt
);

812 
·¿ms
.
h
 = 
Ãt
->h;

813 
·¿ms
.
w
 = 
Ãt
->w;

814 
·¿ms
.
c
 = 
Ãt
->c;

815 
·¿ms
.
šputs
 = 
Ãt
->inputs;

816 
·¿ms
.
b©ch
 = 
Ãt
->batch;

817 
·¿ms
.
time_¡•s
 = 
Ãt
->time_steps;

818 
·¿ms
.
Ãt
 =‚et;

820 
size_t
 
wÜk¥aû_size
 = 0;

821 
n
 =‚->
Ãxt
;

822 
couÁ
 = 0;

823 
	`ä“_£ùiÚ
(
s
);

824 
	`årštf
(
¡d”r
, "layer filters size input output\n");

826 
n
 && (
couÁ
 < 
glob®_·¹™iÚ
)){

827 
·¿ms
.
šdex
 = 
couÁ
;

828 
	`årštf
(
¡d”r
, "%5d ", 
couÁ
);

829 
s
 = (
£ùiÚ
 *)
n
->
v®
;

830 
İtiÚs
 = 
s
->options;

831 
Ïy”
 
l
 = {0};

832 
LAYER_TYPE
 
É
 = 
	`¡ršg_to_Ïy”_ty³
(
s
->
ty³
);

834 if(
É
 =ğ
CONVOLUTIONAL
){

835 
l
 = 
	`·r£_cÚvŞutiÚ®
(
İtiÚs
, 
·¿ms
);

836 }if(
É
 =ğ
DECONVOLUTIONAL
){

837 
l
 = 
	`·r£_decÚvŞutiÚ®
(
İtiÚs
, 
·¿ms
);

838 }if(
É
 =ğ
LOCAL
){

839 
l
 = 
	`·r£_loÿl
(
İtiÚs
, 
·¿ms
);

840 }if(
É
 =ğ
ACTIVE
){

841 
l
 = 
	`·r£_aùiv©iÚ
(
İtiÚs
, 
·¿ms
);

842 }if(
É
 =ğ
LOGXENT
){

843 
l
 = 
	`·r£_logi¡ic
(
İtiÚs
, 
·¿ms
);

844 }if(
É
 =ğ
L2NORM
){

845 
l
 = 
	`·r£_l2nÜm
(
İtiÚs
, 
·¿ms
);

846 }if(
É
 =ğ
RNN
){

847 
l
 = 
	`·r£_ºn
(
İtiÚs
, 
·¿ms
);

848 }if(
É
 =ğ
GRU
){

849 
l
 = 
	`·r£_gru
(
İtiÚs
, 
·¿ms
);

850 }ià(
É
 =ğ
LSTM
) {

851 
l
 = 
	`·r£_l¡m
(
İtiÚs
, 
·¿ms
);

852 }if(
É
 =ğ
CRNN
){

853 
l
 = 
	`·r£_üÂ
(
İtiÚs
, 
·¿ms
);

854 }if(
É
 =ğ
CONNECTED
){

855 
l
 = 
	`·r£_cÚÃùed
(
İtiÚs
, 
·¿ms
);

856 }if(
É
 =ğ
CROP
){

857 
l
 = 
	`·r£_üİ
(
İtiÚs
, 
·¿ms
);

858 }if(
É
 =ğ
COST
){

859 
l
 = 
	`·r£_co¡
(
İtiÚs
, 
·¿ms
);

860 }if(
É
 =ğ
REGION
){

861 
l
 = 
	`·r£_»giÚ
(
İtiÚs
, 
·¿ms
);

862 }if(
É
 =ğ
YOLO
){

863 
l
 = 
	`·r£_yŞo
(
İtiÚs
, 
·¿ms
);

864 }if(
É
 =ğ
ISEG
){

865 
l
 = 
	`·r£_i£g
(
İtiÚs
, 
·¿ms
);

866 }if(
É
 =ğ
DETECTION
){

867 
l
 = 
	`·r£_d‘eùiÚ
(
İtiÚs
, 
·¿ms
);

868 }if(
É
 =ğ
SOFTMAX
){

869 
l
 = 
	`·r£_soámax
(
İtiÚs
, 
·¿ms
);

870 
Ãt
->
h›¿rchy
 = 
l
.
soámax_Œ“
;

871 }if(
É
 =ğ
NORMALIZATION
){

872 
l
 = 
	`·r£_nÜm®iz©iÚ
(
İtiÚs
, 
·¿ms
);

873 }if(
É
 =ğ
BATCHNORM
){

874 
l
 = 
	`·r£_b©chnÜm
(
İtiÚs
, 
·¿ms
);

875 }if(
É
 =ğ
MAXPOOL
){

876 
l
 = 
	`·r£_maxpoŞ
(
İtiÚs
, 
·¿ms
);

877 }if(
É
 =ğ
REORG
){

878 
l
 = 
	`·r£_»Üg
(
İtiÚs
, 
·¿ms
);

879 }if(
É
 =ğ
AVGPOOL
){

880 
l
 = 
	`·r£_avgpoŞ
(
İtiÚs
, 
·¿ms
);

881 }if(
É
 =ğ
ROUTE
){

882 
l
 = 
	`·r£_rou‹
(
İtiÚs
, 
·¿ms
, 
Ãt
);

883 }if(
É
 =ğ
UPSAMPLE
){

884 
l
 = 
	`·r£_up§m¶e
(
İtiÚs
, 
·¿ms
, 
Ãt
);

885 }if(
É
 =ğ
SHORTCUT
){

886 
l
 = 
	`·r£_shÜtcut
(
İtiÚs
, 
·¿ms
, 
Ãt
);

887 }if(
É
 =ğ
DROPOUT
){

888 
l
 = 
	`·r£_drİout
(
İtiÚs
, 
·¿ms
, 
Ãt
->
Ïy”s
[
couÁ
-1].
ouut
,‚‘->Ïy”s[couÁ-1].
d–
);

890 #ifdeà
GPU


891 
l
.
ouut_gpu
 = 
Ãt
->
Ïy”s
[
couÁ
-1].output_gpu;

892 
l
.
d–_gpu
 = 
Ãt
->
Ïy”s
[
couÁ
-1].delta_gpu;

895 
	`årštf
(
¡d”r
, "Ty³‚Ù„ecognized: %s\n", 
s
->
ty³
);

897 
l
.
ş
 = 
Ãt
->clip;

898 
l
.
Œuth
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "truth", 0);

899 
l
.
ÚlyfÜw¬d
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "onlyforward", 0);

900 
l
.
¡İbackw¬d
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "stopbackward", 0);

901 
l
.
dÚt§ve
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "dontsave", 0);

902 
l
.
dÚßd
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "dontload", 0);

903 
l
.
numlßd
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "numload", 0);

904 
l
.
dÚßdsÿËs
 = 
	`İtiÚ_fšd_št_qu›t
(
İtiÚs
, "dontloadscales", 0);

905 
l
.
Ë¬nšg_¿‹_sÿË
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "learning_rate", 1);

906 
l
.
smoÙh
 = 
	`İtiÚ_fšd_æßt_qu›t
(
İtiÚs
, "smooth", 0);

907 
	`İtiÚ_unu£d
(
İtiÚs
);

909 
Ãt
->
Ïy”s
[
couÁ
] = 
l
;

911 ià(
l
.
wÜk¥aû_size
 > workspace_size) workspace_size =†.workspace_size;

912 
	`ä“_£ùiÚ
(
s
);

913 
n
 =‚->
Ãxt
;

914 ++
couÁ
;

915 
couÁ_glob®
 = 
couÁ
;

917 if(
n
){

918 
·¿ms
.
h
 = 
l
.
out_h
;

919 
·¿ms
.
w
 = 
l
.
out_w
;

920 
·¿ms
.
c
 = 
l
.
out_c
;

921 
·¿ms
.
šputs
 = 
l
.
ouuts
;

925 
	`ä“_li¡
(
£ùiÚs
);

926 
Ïy”
 
out
 = 
	`g‘_ÃtwÜk_ouut_Ïy”
(
Ãt
);

927 
Ãt
->
ouuts
 = 
out
.outputs;

928 
Ãt
->
Œuths
 = 
out
.
ouuts
;

929 if(
Ãt
->
Ïy”s
[Ãt->
n
-1].
Œuths
)‚et->truths =‚et->layers[net->n-1].truths;

930 
Ãt
->
ouut
 = 
out
.output;

931 
Ãt
->
šput
 = 
	`ÿÎoc
Ò‘->
šputs
*Ãt->
b©ch
, ());

932 
Ãt
->
Œuth
 = 
	`ÿÎoc
Ò‘->
Œuths
*Ãt->
b©ch
, ());

933 if(
wÜk¥aû_size
){

935 
Ãt
->
wÜk¥aû
 = 
	`ÿÎoc
(1, 
wÜk¥aû_size
);

936 
	`®loÿ‹_wÜk¥aû_CA
(()
wÜk¥aû_size
);

940  
Ãt
;

941 
	}
}

943 
li¡
 *
	$»ad_cfg
(*
f’ame
)

945 
FILE
 *
fe
 = 
	`fİ’
(
f’ame
, "r");

946 if(
fe
 =ğ0è
	`fe_”rÜ
(
f’ame
);

947 *
lše
;

948 
nu
 = 0;

949 
li¡
 *
İtiÚs
 = 
	`make_li¡
();

950 
£ùiÚ
 *
cu¼’t
 = 0;

951 (
lše
=
	`fg‘l
(
fe
)) != 0){

952 ++ 
nu
;

953 
	`¡r
(
lše
);

954 
lše
[0]){

956 
cu¼’t
 = 
	`m®loc
((
£ùiÚ
));

957 
	`li¡_š£¹
(
İtiÚs
, 
cu¼’t
);

958 
cu¼’t
->
İtiÚs
 = 
	`make_li¡
();

959 
cu¼’t
->
ty³
 = 
lše
;

964 
	`ä“
(
lše
);

967 if(!
	`»ad_İtiÚ
(
lše
, 
cu¼’t
->
İtiÚs
)){

968 
	`årštf
(
¡d”r
, "CÚfig f”rÜ†š%d, could…¬£: %s\n", 
nu
, 
lše
);

969 
	`ä“
(
lše
);

974 
	`fşo£
(
fe
);

975  
İtiÚs
;

976 
	}
}

978 
	$§ve_cÚvŞutiÚ®_weights_bš¬y
(
Ïy”
 
l
, 
FILE
 *
å
)

980 #ifdeà
GPU


981 if(
gpu_šdex
 >= 0){

982 
	`puÎ_cÚvŞutiÚ®_Ïy”
(
l
);

985 
	`bš¬ize_weights
(
l
.
weights
,†.
n
,†.
c
*l.
size
*l.size,†.
bš¬y_weights
);

986 
size
 = 
l
.
c
*l.size*l.size;

987 
i
, 
j
, 
k
;

988 
	`fwr™e
(
l
.
bŸ£s
, (),†.
n
, 
å
);

989 ià(
l
.
b©ch_nÜm®ize
){

990 
	`fwr™e
(
l
.
sÿËs
, (),†.
n
, 
å
);

991 
	`fwr™e
(
l
.
rŞlšg_m—n
, (),†.
n
, 
å
);

992 
	`fwr™e
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
n
, 
å
);

994 
i
 = 0; i < 
l
.
n
; ++i){

995 
m—n
 = 
l
.
bš¬y_weights
[
i
*
size
];

996 if(
m—n
 < 0) mean = -mean;

997 
	`fwr™e
(&
m—n
, (), 1, 
å
);

998 
j
 = 0; j < 
size
/8; ++j){

999 
šdex
 = 
i
*
size
 + 
j
*8;

1000 
c
 = 0;

1001 
k
 = 0; k < 8; ++k){

1002 ià(
j
*8 + 
k
 >ğ
size
) ;

1003 ià(
l
.
bš¬y_weights
[
šdex
 + 
k
] > 0è
c
 = (c | 1<<k);

1005 
	`fwr™e
(&
c
, (), 1, 
å
);

1008 
	}
}

1010 
	$§ve_cÚvŞutiÚ®_weights
(
Ïy”
 
l
, 
FILE
 *
å
)

1012 if(
l
.
bš¬y
){

1016 #ifdeà
GPU


1017 if(
gpu_šdex
 >= 0){

1018 
	`puÎ_cÚvŞutiÚ®_Ïy”
(
l
);

1021 
num
 = 
l
.
nweights
;

1022 
	`fwr™e
(
l
.
bŸ£s
, (),†.
n
, 
å
);

1023 ià(
l
.
b©ch_nÜm®ize
){

1024 
	`fwr™e
(
l
.
sÿËs
, (),†.
n
, 
å
);

1025 
	`fwr™e
(
l
.
rŞlšg_m—n
, (),†.
n
, 
å
);

1026 
	`fwr™e
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
n
, 
å
);

1028 
	`fwr™e
(
l
.
weights
, (), 
num
, 
å
);

1029 
	}
}

1031 
	$§ve_cÚvŞutiÚ®_weights_comm
(
Ïy”
 
l
, 
i
)

1033 
num
 = 
l
.
nweights
;

1034 
	`§ve_weights_CA
(
l
.
bŸ£s
,†.
n
, 
i
, 'b');

1035 ià(
l
.
b©ch_nÜm®ize
){

1036 
	`§ve_weights_CA
(
l
.
sÿËs
,†.
n
, 
i
, 's');

1037 
	`§ve_weights_CA
(
l
.
rŞlšg_m—n
,†.
n
, 
i
, 'm');

1038 
	`§ve_weights_CA
(
l
.
rŞlšg_v¬Ÿnû
,†.
n
, 
i
, 'v');

1040 
	`§ve_weights_CA
(
l
.
weights
, 
num
, 
i
, 'w');

1041 
	}
}

1043 
	$§ve_b©chnÜm_weights
(
Ïy”
 
l
, 
FILE
 *
å
)

1045 #ifdeà
GPU


1046 if(
gpu_šdex
 >= 0){

1047 
	`puÎ_b©chnÜm_Ïy”
(
l
);

1050 
	`fwr™e
(
l
.
sÿËs
, (),†.
c
, 
å
);

1051 
	`fwr™e
(
l
.
rŞlšg_m—n
, (),†.
c
, 
å
);

1052 
	`fwr™e
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
c
, 
å
);

1053 
	}
}

1055 
	$§ve_b©chnÜm_weights_comm
(
Ïy”
 
l
, 
i
)

1057 
	`§ve_weights_CA
(
l
.
sÿËs
,†.
c
, 
i
, 's');

1058 
	`§ve_weights_CA
(
l
.
rŞlšg_m—n
,†.
c
, 
i
, 'm');

1059 
	`§ve_weights_CA
(
l
.
rŞlšg_v¬Ÿnû
,†.
c
, 
i
, 'v');

1060 
	}
}

1062 
	$§ve_cÚÃùed_weights
(
Ïy”
 
l
, 
FILE
 *
å
)

1064 #ifdeà
GPU


1065 if(
gpu_šdex
 >= 0){

1066 
	`puÎ_cÚÃùed_Ïy”
(
l
);

1069 
	`fwr™e
(
l
.
bŸ£s
, (),†.
ouuts
, 
å
);

1070 
	`fwr™e
(
l
.
weights
, (),†.
ouuts
*l.
šputs
, 
å
);

1071 ià(
l
.
b©ch_nÜm®ize
){

1072 
	`fwr™e
(
l
.
sÿËs
, (),†.
ouuts
, 
å
);

1073 
	`fwr™e
(
l
.
rŞlšg_m—n
, (),†.
ouuts
, 
å
);

1074 
	`fwr™e
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
ouuts
, 
å
);

1076 
	}
}

1078 
	$§ve_cÚÃùed_weights_comm
(
Ïy”
 
l
, 
i
)

1080 
num
 = 
l
.
nweights
;

1081 
	`§ve_weights_CA
(
l
.
bŸ£s
,†.
ouuts
, 
i
, 'b');

1082 
	`§ve_weights_CA
(
l
.
weights
,†.
ouuts
*l.
šputs
, 
i
, 'w');

1083 ià(
l
.
b©ch_nÜm®ize
){

1084 
	`§ve_weights_CA
(
l
.
sÿËs
,†.
ouuts
, 
i
, 's');

1085 
	`§ve_weights_CA
(
l
.
rŞlšg_m—n
,†.
ouuts
, 
i
, 'm');

1086 
	`§ve_weights_CA
(
l
.
rŞlšg_v¬Ÿnû
,†.
ouuts
, 
i
, 'v');

1088 
	}
}

1090 
	$§ve_weights_u±o
(
ÃtwÜk
 *
Ãt
, *
f’ame
, 
cutoff
)

1092 #ifdeà
GPU


1093 if(
Ãt
->
gpu_šdex
 >= 0){

1094 
	`cuda_£t_deviû
(
Ãt
->
gpu_šdex
);

1097 
	`årštf
(
¡d”r
, "Savšg weight tØ%s\n", 
f’ame
);

1098 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "wb");

1099 if(!
å
è
	`fe_”rÜ
(
f’ame
);

1101 
majÜ
 = 0;

1102 
mšÜ
 = 2;

1103 
»visiÚ
 = 0;

1104 
	`fwr™e
(&
majÜ
, (), 1, 
å
);

1105 
	`fwr™e
(&
mšÜ
, (), 1, 
å
);

1106 
	`fwr™e
(&
»visiÚ
, (), 1, 
å
);

1107 
	`fwr™e
(
Ãt
->
£’
, (
size_t
), 1, 
å
);

1109 
i
;

1110 
i
 = 0; i < 
Ãt
->
n
 && i < 
cutoff
; ++i){

1111 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

1112 ià(
l
.
dÚt§ve
) ;

1114 if(
i
 > 
·¹™iÚ_pošt
){

1115 
Ïy”TA_i
 = 
i
 - 
·¹™iÚ_pošt
 - 1;

1116 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
){

1117 
	`§ve_cÚvŞutiÚ®_weights_comm
(
l
, 
Ïy”TA_i
);

1118 } if(
l
.
ty³
 =ğ
CONNECTED
){

1119 
	`§ve_cÚÃùed_weights_comm
(
l
, 
Ïy”TA_i
);

1120 } if(
l
.
ty³
 =ğ
BATCHNORM
){

1121 
	`§ve_b©chnÜm_weights_comm
(
l
, 
Ïy”TA_i
);

1122 } if(
l
.
ty³
 =ğ
RNN
){

1123 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
šput_Ïy”
), 
Ïy”TA_i
);

1124 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
£lf_Ïy”
), 
Ïy”TA_i
);

1125 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
ouut_Ïy”
), 
Ïy”TA_i
);

1126 } ià(
l
.
ty³
 =ğ
LSTM
) {

1127 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wi
), 
Ïy”TA_i
);

1128 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wf
), 
Ïy”TA_i
);

1129 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wo
), 
Ïy”TA_i
);

1130 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wg
), 
Ïy”TA_i
);

1131 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
ui
), 
Ïy”TA_i
);

1132 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
uf
), 
Ïy”TA_i
);

1133 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
uo
), 
Ïy”TA_i
);

1134 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
ug
), 
Ïy”TA_i
);

1135 } ià(
l
.
ty³
 =ğ
GRU
) {

1136 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wz
), 
Ïy”TA_i
);

1137 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wr
), 
Ïy”TA_i
);

1138 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
wh
), 
Ïy”TA_i
);

1139 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
uz
), 
Ïy”TA_i
);

1140 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
ur
), 
Ïy”TA_i
);

1141 
	`§ve_cÚÃùed_weights_comm
(*(
l
.
uh
), 
Ïy”TA_i
);

1142 } if(
l
.
ty³
 =ğ
CRNN
){

1143 
	`§ve_cÚvŞutiÚ®_weights_comm
(*(
l
.
šput_Ïy”
), 
Ïy”TA_i
);

1144 
	`§ve_cÚvŞutiÚ®_weights_comm
(*(
l
.
£lf_Ïy”
), 
Ïy”TA_i
);

1145 
	`§ve_cÚvŞutiÚ®_weights_comm
(*(
l
.
ouut_Ïy”
), 
Ïy”TA_i
);

1149 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
){

1150 
	`§ve_cÚvŞutiÚ®_weights
(
l
, 
å
);

1151 } if(
l
.
ty³
 =ğ
CONNECTED
){

1152 
	`§ve_cÚÃùed_weights
(
l
, 
å
);

1153 } if(
l
.
ty³
 =ğ
BATCHNORM
){

1154 
	`§ve_b©chnÜm_weights
(
l
, 
å
);

1155 } if(
l
.
ty³
 =ğ
RNN
){

1156 
	`§ve_cÚÃùed_weights
(*(
l
.
šput_Ïy”
), 
å
);

1157 
	`§ve_cÚÃùed_weights
(*(
l
.
£lf_Ïy”
), 
å
);

1158 
	`§ve_cÚÃùed_weights
(*(
l
.
ouut_Ïy”
), 
å
);

1159 } ià(
l
.
ty³
 =ğ
LSTM
) {

1160 
	`§ve_cÚÃùed_weights
(*(
l
.
wi
), 
å
);

1161 
	`§ve_cÚÃùed_weights
(*(
l
.
wf
), 
å
);

1162 
	`§ve_cÚÃùed_weights
(*(
l
.
wo
), 
å
);

1163 
	`§ve_cÚÃùed_weights
(*(
l
.
wg
), 
å
);

1164 
	`§ve_cÚÃùed_weights
(*(
l
.
ui
), 
å
);

1165 
	`§ve_cÚÃùed_weights
(*(
l
.
uf
), 
å
);

1166 
	`§ve_cÚÃùed_weights
(*(
l
.
uo
), 
å
);

1167 
	`§ve_cÚÃùed_weights
(*(
l
.
ug
), 
å
);

1168 } ià(
l
.
ty³
 =ğ
GRU
) {

1170 
	`§ve_cÚÃùed_weights
(*(
l
.
wz
), 
å
);

1171 
	`§ve_cÚÃùed_weights
(*(
l
.
wr
), 
å
);

1172 
	`§ve_cÚÃùed_weights
(*(
l
.
wh
), 
å
);

1173 
	`§ve_cÚÃùed_weights
(*(
l
.
uz
), 
å
);

1174 
	`§ve_cÚÃùed_weights
(*(
l
.
ur
), 
å
);

1175 
	`§ve_cÚÃùed_weights
(*(
l
.
uh
), 
å
);

1177 
	`§ve_cÚÃùed_weights
(*(
l
.
»£t_Ïy”
), 
å
);

1178 
	`§ve_cÚÃùed_weights
(*(
l
.
upd©e_Ïy”
), 
å
);

1179 
	`§ve_cÚÃùed_weights
(*(
l
.
¡©e_Ïy”
), 
å
);

1181 } if(
l
.
ty³
 =ğ
CRNN
){

1182 
	`§ve_cÚvŞutiÚ®_weights
(*(
l
.
šput_Ïy”
), 
å
);

1183 
	`§ve_cÚvŞutiÚ®_weights
(*(
l
.
£lf_Ïy”
), 
å
);

1184 
	`§ve_cÚvŞutiÚ®_weights
(*(
l
.
ouut_Ïy”
), 
å
);

1185 } if(
l
.
ty³
 =ğ
LOCAL
){

1186 #ifdeà
GPU


1187 if(
gpu_šdex
 >= 0){

1188 
	`puÎ_loÿl_Ïy”
(
l
);

1191 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

1192 
size
 = 
l
.size*l.size*l.
c
*l.
n
*
loÿtiÚs
;

1193 
	`fwr™e
(
l
.
bŸ£s
, (),†.
ouuts
, 
å
);

1194 
	`fwr™e
(
l
.
weights
, (), 
size
, 
å
);

1198 
	`fşo£
(
å
);

1199 
	}
}

1202 
	$§ve_weights
(
ÃtwÜk
 *
Ãt
, *
f’ame
)

1204 
	`§ve_weights_u±o
(
Ãt
, 
f’ame
,‚‘->
n
);

1205 
	}
}

1207 
	$Œª¥o£_m©rix
(*
a
, 
rows
, 
cŞs
)

1209 *
Œª¥o£
 = 
	`ÿÎoc
(
rows
*
cŞs
, ());

1210 
x
, 
y
;

1211 
x
 = 0; x < 
rows
; ++x){

1212 
y
 = 0; y < 
cŞs
; ++y){

1213 
Œª¥o£
[
y
*
rows
 + 
x
] = 
a
[x*
cŞs
 + y];

1216 
	`memıy
(
a
, 
Œª¥o£
, 
rows
*
cŞs
*());

1217 
	`ä“
(
Œª¥o£
);

1218 
	}
}

1220 
	$lßd_cÚÃùed_weights
(
Ïy”
 
l
, 
FILE
 *
å
, 
Œª¥o£
)

1222 
	`ä—d
(
l
.
bŸ£s
, (),†.
ouuts
, 
å
);

1223 
	`ä—d
(
l
.
weights
, (),†.
ouuts
*l.
šputs
, 
å
);

1224 if(
Œª¥o£
){

1225 
	`Œª¥o£_m©rix
(
l
.
weights
,†.
šputs
,†.
ouuts
);

1229 ià(
l
.
b©ch_nÜm®ize
 && (!l.
dÚßdsÿËs
)){

1230 
	`ä—d
(
l
.
sÿËs
, (),†.
ouuts
, 
å
);

1231 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
ouuts
, 
å
);

1232 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
ouuts
, 
å
);

1237 #ifdeà
GPU


1238 if(
gpu_šdex
 >= 0){

1239 
	`push_cÚÃùed_Ïy”
(
l
);

1242 
	}
}

1244 
	$lßd_cÚÃùed_weights_comm
(
Ïy”
 
l
, 
FILE
 *
å
, 
i
, 
Œª¥o£
)

1246 
	`ä—d
(
l
.
bŸ£s
, (),†.
ouuts
, 
å
);

1247 
	`ä—d
(
l
.
weights
, (),†.
ouuts
*l.
šputs
, 
å
);

1249 
	`Œªsãr_weights_CA
(
l
.
bŸ£s
,†.
ouuts
, 
i
, 'b', 0);

1250 
	`Œªsãr_weights_CA
(
l
.
weights
,†.
ouuts
*l.
šputs
, 
i
, 'w', 
Œª¥o£
);

1253 ià(
l
.
b©ch_nÜm®ize
 && (!l.
dÚßdsÿËs
)){

1254 
	`ä—d
(
l
.
sÿËs
, (),†.
ouuts
, 
å
);

1255 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
ouuts
, 
å
);

1256 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
ouuts
, 
å
);

1258 
	`Œªsãr_weights_CA
(
l
.
sÿËs
,†.
ouuts
, 
i
, 's', 0);

1259 
	`Œªsãr_weights_CA
(
l
.
rŞlšg_m—n
,†.
ouuts
, 
i
, 'm', 0);

1260 
	`Œªsãr_weights_CA
(
l
.
rŞlšg_v¬Ÿnû
,†.
ouuts
, 
i
, 'v', 0);

1262 
	}
}

1264 
	$lßd_b©chnÜm_weights
(
Ïy”
 
l
, 
FILE
 *
å
)

1266 
	`ä—d
(
l
.
sÿËs
, (),†.
c
, 
å
);

1267 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
c
, 
å
);

1268 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
c
, 
å
);

1269 #ifdeà
GPU


1270 if(
gpu_šdex
 >= 0){

1271 
	`push_b©chnÜm_Ïy”
(
l
);

1274 
	}
}

1276 
	$lßd_b©chnÜm_weights_comm
(
Ïy”
 
l
, 
FILE
 *
å
, 
i
)

1278 
	`ä—d
(
l
.
sÿËs
, (),†.
c
, 
å
);

1279 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
c
, 
å
);

1280 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
c
, 
å
);

1282 
	`Œªsãr_weights_CA
(
l
.
sÿËs
,†.
c
, 
i
, 's', 0);

1283 
	`Œªsãr_weights_CA
(
l
.
rŞlšg_m—n
,†.
c
, 
i
, 'm', 0);

1284 
	`Œªsãr_weights_CA
(
l
.
rŞlšg_v¬Ÿnû
,†.
c
, 
i
, 'v', 0);

1285 
	}
}

1287 
	$lßd_cÚvŞutiÚ®_weights_bš¬y
(
Ïy”
 
l
, 
FILE
 *
å
)

1289 
	`ä—d
(
l
.
bŸ£s
, (),†.
n
, 
å
);

1290 ià(
l
.
b©ch_nÜm®ize
 && (!l.
dÚßdsÿËs
)){

1291 
	`ä—d
(
l
.
sÿËs
, (),†.
n
, 
å
);

1292 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
n
, 
å
);

1293 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
n
, 
å
);

1295 
size
 = 
l
.
c
*l.size*l.size;

1296 
i
, 
j
, 
k
;

1297 
i
 = 0; i < 
l
.
n
; ++i){

1298 
m—n
 = 0;

1299 
	`ä—d
(&
m—n
, (), 1, 
å
);

1300 
j
 = 0; j < 
size
/8; ++j){

1301 
šdex
 = 
i
*
size
 + 
j
*8;

1302 
c
 = 0;

1303 
	`ä—d
(&
c
, (), 1, 
å
);

1304 
k
 = 0; k < 8; ++k){

1305 ià(
j
*8 + 
k
 >ğ
size
) ;

1306 
l
.
weights
[
šdex
 + 
k
] = (
c
 & 1<<kè? 
m—n
 : -mean;

1310 #ifdeà
GPU


1311 if(
gpu_šdex
 >= 0){

1312 
	`push_cÚvŞutiÚ®_Ïy”
(
l
);

1315 
	}
}

1317 
	$lßd_cÚvŞutiÚ®_weights
(
Ïy”
 
l
, 
FILE
 *
å
)

1319 if(
l
.
bš¬y
){

1323 if(
l
.
numlßd
èl.
n
 =†.numload;

1324 
num
 = 
l
.
c
/l.
groups
*l.
n
*l.
size
*l.size;

1325 
	`ä—d
(
l
.
bŸ£s
, (),†.
n
, 
å
);

1326 ià(
l
.
b©ch_nÜm®ize
 && (!l.
dÚßdsÿËs
)){

1327 
	`ä—d
(
l
.
sÿËs
, (),†.
n
, 
å
);

1328 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
n
, 
å
);

1329 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
n
, 
å
);

1331 
i
;

1332 
i
 = 0; i < 
l
.
n
; ++i){

1333 
	`´štf
("%g, ", 
l
.
rŞlšg_m—n
[
i
]);

1335 
	`´štf
("\n");

1336 
i
 = 0; i < 
l
.
n
; ++i){

1337 
	`´štf
("%g, ", 
l
.
rŞlšg_v¬Ÿnû
[
i
]);

1339 
	`´štf
("\n");

1342 
	`fl_ıu
(
l
.
n
, 0,†.
rŞlšg_m—n
, 1);

1343 
	`fl_ıu
(
l
.
n
, 0,†.
rŞlšg_v¬Ÿnû
, 1);

1346 
i
;

1347 
i
 = 0; i < 
l
.
n
; ++i){

1348 
	`´štf
("%g, ", 
l
.
rŞlšg_m—n
[
i
]);

1350 
	`´štf
("\n");

1351 
i
 = 0; i < 
l
.
n
; ++i){

1352 
	`´štf
("%g, ", 
l
.
rŞlšg_v¬Ÿnû
[
i
]);

1354 
	`´štf
("\n");

1357 
	`ä—d
(
l
.
weights
, (), 
num
, 
å
);

1359 ià(
l
.
æ³d
) {

1360 
	`Œª¥o£_m©rix
(
l
.
weights
,†.
c
*l.
size
*l.size,†.
n
);

1363 #ifdeà
GPU


1364 if(
gpu_šdex
 >= 0){

1365 
	`push_cÚvŞutiÚ®_Ïy”
(
l
);

1368 
	}
}

1370 
	$lßd_cÚvŞutiÚ®_weights_comm
(
Ïy”
 
l
, 
FILE
 *
å
, 
i
)

1372 if(
l
.
numlßd
èl.
n
 =†.numload;

1373 
num
 = 
l
.
c
/l.
groups
*l.
n
*l.
size
*l.size;

1375 
	`ä—d
(
l
.
bŸ£s
, (),†.
n
, 
å
);

1376 
	`Œªsãr_weights_CA
(
l
.
bŸ£s
,†.
n
, 
i
, 'b', 0);

1379 ià(
l
.
b©ch_nÜm®ize
 && (!l.
dÚßdsÿËs
)){

1380 
	`ä—d
(
l
.
sÿËs
, (),†.
n
, 
å
);

1381 
	`ä—d
(
l
.
rŞlšg_m—n
, (),†.
n
, 
å
);

1382 
	`ä—d
(
l
.
rŞlšg_v¬Ÿnû
, (),†.
n
, 
å
);

1384 
	`Œªsãr_weights_CA
(
l
.
sÿËs
,†.
n
, 
i
, 's', 0);

1385 
	`Œªsãr_weights_CA
(
l
.
rŞlšg_m—n
,†.
n
, 
i
, 'm', 0);

1386 
	`Œªsãr_weights_CA
(
l
.
rŞlšg_v¬Ÿnû
,†.
n
, 
i
, 'v', 0);

1389 
	`ä—d
(
l
.
weights
, (), 
num
, 
å
);

1390 
	`Œªsãr_weights_CA
(
l
.
weights
, 
num
, 
i
, 'w', 0);

1391 
	}
}

1394 
	$lßd_weights_u±o
(
ÃtwÜk
 *
Ãt
, *
f’ame
, 
¡¬t
, 
cutoff
)

1396 #ifdeà
GPU


1397 if(
Ãt
->
gpu_šdex
 >= 0){

1398 
	`cuda_£t_deviû
(
Ãt
->
gpu_šdex
);

1401 
	`årštf
(
¡d”r
, "Lßdšg weight äom %s...", 
f’ame
);

1402 
	`fæush
(
¡dout
);

1403 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "rb");

1404 if(!
å
è
	`fe_”rÜ
(
f’ame
);

1406 
majÜ
;

1407 
mšÜ
;

1408 
»visiÚ
;

1409 
	`ä—d
(&
majÜ
, (), 1, 
å
);

1410 
	`ä—d
(&
mšÜ
, (), 1, 
å
);

1411 
	`ä—d
(&
»visiÚ
, (), 1, 
å
);

1412 ià((
majÜ
*10 + 
mšÜ
) >= 2 && major < 1000 && minor < 1000){

1413 
	`ä—d
(
Ãt
->
£’
, (
size_t
), 1, 
å
);

1415 
i£’
 = 0;

1416 
	`ä—d
(&
i£’
, (), 1, 
å
);

1417 *
Ãt
->
£’
 = 
i£’
;

1419 
Œª¥o£
 = (
majÜ
 > 1000è|| (
mšÜ
 > 1000);

1421 
i
;

1423 
i
 = 
¡¬t
; i < 
Ãt
->
n
 && i < 
cutoff
; ++i){

1428 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

1429 ià(
l
.
dÚßd
) ;

1430 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
){

1431 
	`lßd_cÚvŞutiÚ®_weights
(
l
, 
å
);

1433 if(
l
.
ty³
 =ğ
CONNECTED
){

1434 
	`lßd_cÚÃùed_weights
(
l
, 
å
, 
Œª¥o£
);

1436 if(
l
.
ty³
 =ğ
BATCHNORM
){

1437 
	`lßd_b©chnÜm_weights
(
l
, 
å
);

1439 if(
l
.
ty³
 =ğ
CRNN
){

1440 
	`lßd_cÚvŞutiÚ®_weights
(*(
l
.
šput_Ïy”
), 
å
);

1441 
	`lßd_cÚvŞutiÚ®_weights
(*(
l
.
£lf_Ïy”
), 
å
);

1442 
	`lßd_cÚvŞutiÚ®_weights
(*(
l
.
ouut_Ïy”
), 
å
);

1444 if(
l
.
ty³
 =ğ
RNN
){

1445 
	`lßd_cÚÃùed_weights
(*(
l
.
šput_Ïy”
), 
å
, 
Œª¥o£
);

1446 
	`lßd_cÚÃùed_weights
(*(
l
.
£lf_Ïy”
), 
å
, 
Œª¥o£
);

1447 
	`lßd_cÚÃùed_weights
(*(
l
.
ouut_Ïy”
), 
å
, 
Œª¥o£
);

1449 ià(
l
.
ty³
 =ğ
LSTM
) {

1450 
	`lßd_cÚÃùed_weights
(*(
l
.
wi
), 
å
, 
Œª¥o£
);

1451 
	`lßd_cÚÃùed_weights
(*(
l
.
wf
), 
å
, 
Œª¥o£
);

1452 
	`lßd_cÚÃùed_weights
(*(
l
.
wo
), 
å
, 
Œª¥o£
);

1453 
	`lßd_cÚÃùed_weights
(*(
l
.
wg
), 
å
, 
Œª¥o£
);

1454 
	`lßd_cÚÃùed_weights
(*(
l
.
ui
), 
å
, 
Œª¥o£
);

1455 
	`lßd_cÚÃùed_weights
(*(
l
.
uf
), 
å
, 
Œª¥o£
);

1456 
	`lßd_cÚÃùed_weights
(*(
l
.
uo
), 
å
, 
Œª¥o£
);

1457 
	`lßd_cÚÃùed_weights
(*(
l
.
ug
), 
å
, 
Œª¥o£
);

1459 ià(
l
.
ty³
 =ğ
GRU
) {

1461 
	`lßd_cÚÃùed_weights
(*(
l
.
wz
), 
å
, 
Œª¥o£
);

1462 
	`lßd_cÚÃùed_weights
(*(
l
.
wr
), 
å
, 
Œª¥o£
);

1463 
	`lßd_cÚÃùed_weights
(*(
l
.
wh
), 
å
, 
Œª¥o£
);

1464 
	`lßd_cÚÃùed_weights
(*(
l
.
uz
), 
å
, 
Œª¥o£
);

1465 
	`lßd_cÚÃùed_weights
(*(
l
.
ur
), 
å
, 
Œª¥o£
);

1466 
	`lßd_cÚÃùed_weights
(*(
l
.
uh
), 
å
, 
Œª¥o£
);

1468 
	`lßd_cÚÃùed_weights
(*(
l
.
»£t_Ïy”
), 
å
, 
Œª¥o£
);

1469 
	`lßd_cÚÃùed_weights
(*(
l
.
upd©e_Ïy”
), 
å
, 
Œª¥o£
);

1470 
	`lßd_cÚÃùed_weights
(*(
l
.
¡©e_Ïy”
), 
å
, 
Œª¥o£
);

1473 if(
l
.
ty³
 =ğ
LOCAL
){

1474 
loÿtiÚs
 = 
l
.
out_w
*l.
out_h
;

1475 
size
 = 
l
.size*l.size*l.
c
*l.
n
*
loÿtiÚs
;

1476 
	`ä—d
(
l
.
bŸ£s
, (),†.
ouuts
, 
å
);

1477 
	`ä—d
(
l
.
weights
, (), 
size
, 
å
);

1478 #ifdeà
GPU


1479 if(
gpu_šdex
 >= 0){

1480 
	`push_loÿl_Ïy”
(
l
);

1488 
Ïy”
 
l
 = 
Ãt
->
Ïy”s
[
i
];

1490 
Ïy”TA_i
 = 
i
;

1492 ià(
l
.
dÚßd
) ;

1493 if(
l
.
ty³
 =ğ
CONVOLUTIONAL
 ||†.ty³ =ğ
DECONVOLUTIONAL
){

1494 
	`lßd_cÚvŞutiÚ®_weights_comm
(
l
, 
å
, 
Ïy”TA_i
);

1496 if(
l
.
ty³
 =ğ
CONNECTED
){

1497 
	`lßd_cÚÃùed_weights_comm
(
l
, 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1499 if(
l
.
ty³
 =ğ
BATCHNORM
){

1500 
	`lßd_b©chnÜm_weights_comm
(
l
, 
å
, 
Ïy”TA_i
);

1502 if(
l
.
ty³
 =ğ
CRNN
){

1503 
	`lßd_cÚvŞutiÚ®_weights_comm
(*(
l
.
šput_Ïy”
), 
å
, 
Ïy”TA_i
);

1504 
	`lßd_cÚvŞutiÚ®_weights_comm
(*(
l
.
£lf_Ïy”
), 
å
, 
Ïy”TA_i
);

1505 
	`lßd_cÚvŞutiÚ®_weights_comm
(*(
l
.
ouut_Ïy”
), 
å
, 
Ïy”TA_i
);

1507 if(
l
.
ty³
 =ğ
RNN
){

1508 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
šput_Ïy”
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1509 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
£lf_Ïy”
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1510 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
ouut_Ïy”
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1512 ià(
l
.
ty³
 =ğ
LSTM
) {

1513 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
wi
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1514 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
wf
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1515 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
wo
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1516 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
wg
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1517 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
ui
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1518 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
uf
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1519 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
uo
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1520 
	`lßd_cÚÃùed_weights_comm
(*(
l
.
ug
), 
å
, 
Ïy”TA_i
, 
Œª¥o£
);

1525 
	`årštf
(
¡d”r
, "Done!\n");

1526 
	`fşo£
(
å
);

1527 
	}
}

1529 
	$lßd_weights
(
ÃtwÜk
 *
Ãt
, *
f’ame
)

1531 
	`lßd_weights_u±o
(
Ãt
, 
f’ame
, 0,‚‘->
n
);

1532 
	}
}

	@host/src/parser.h

1 #iâdeà
PARSER_H


2 
	#PARSER_H


	)

3 
	~"d¬kÃt.h
"

4 
	~"ÃtwÜk.h
"

6 
·¹™iÚ_pošt
;

7 
couÁ_glob®
;

8 
glob®_dp
;

9 
glob®_·¹™iÚ
;

11 
§ve_ÃtwÜk
(
ÃtwÜk
 
Ãt
, *
f’ame
);

12 
§ve_weights_doubË
(
ÃtwÜk
 
Ãt
, *
f’ame
);

	@host/src/region_layer.c

1 
	~"»giÚ_Ïy”.h
"

2 
	~"aùiv©iÚs.h
"

3 
	~"bÏs.h
"

4 
	~"box.h
"

5 
	~"cuda.h
"

6 
	~"uts.h
"

8 
	~<¡dio.h
>

9 
	~<as£¹.h
>

10 
	~<¡ršg.h
>

11 
	~<¡dlib.h
>

13 
Ïy”
 
	$make_»giÚ_Ïy”
(
b©ch
, 
w
, 
h
, 
n
, 
şas£s
, 
coÜds
)

15 
Ïy”
 
l
 = {0};

16 
l
.
ty³
 = 
REGION
;

18 
l
.
n
 =‚;

19 
l
.
b©ch
 = batch;

20 
l
.
h
 = h;

21 
l
.
w
 = w;

22 
l
.
c
 = 
n
*(
şas£s
 + 
coÜds
 + 1);

23 
l
.
out_w
 =†.
w
;

24 
l
.
out_h
 =†.
h
;

25 
l
.
out_c
 =†.
c
;

26 
l
.
şas£s
 = classes;

27 
l
.
coÜds
 = coords;

28 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

29 
l
.
bŸ£s
 = 
	`ÿÎoc
(
n
*2, ());

30 
l
.
bŸs_upd©es
 = 
	`ÿÎoc
(
n
*2, ());

31 
l
.
ouuts
 = 
h
*
w
*
n
*(
şas£s
 + 
coÜds
 + 1);

32 
l
.
šputs
 =†.
ouuts
;

33 
l
.
Œuths
 = 30*Ö.
coÜds
 + 1);

34 
l
.
d–
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

35 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

36 
i
;

37 
i
 = 0; i < 
n
*2; ++i){

38 
l
.
bŸ£s
[
i
] = .5;

41 
l
.
fÜw¬d
 = 
fÜw¬d_»giÚ_Ïy”
;

42 
l
.
backw¬d
 = 
backw¬d_»giÚ_Ïy”
;

43 #ifdeà
GPU


44 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_»giÚ_Ïy”_gpu
;

45 
l
.
backw¬d_gpu
 = 
backw¬d_»giÚ_Ïy”_gpu
;

46 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
b©ch
*l.
ouuts
);

47 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
b©ch
*l.
ouuts
);

50 
	`årštf
(
¡d”r
, "detection\n");

51 
	`¤ªd
(0);

53  
l
;

54 
	}
}

56 
	$»size_»giÚ_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

58 
l
->
w
 = w;

59 
l
->
h
 = h;

61 
l
->
ouuts
 = 
h
*
w
*l->
n
*Ö->
şas£s
 +†->
coÜds
 + 1);

62 
l
->
šputs
 =†->
ouuts
;

64 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
b©ch
*l->
ouuts
*());

65 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
b©ch
*l->
ouuts
*());

67 #ifdeà
GPU


68 
	`cuda_ä“
(
l
->
d–_gpu
);

69 
	`cuda_ä“
(
l
->
ouut_gpu
);

71 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
b©ch
*l->
ouuts
);

72 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

74 
	}
}

76 
box
 
	$g‘_»giÚ_box
(*
x
, *
bŸ£s
, 
n
, 
šdex
, 
i
, 
j
, 
w
, 
h
, 
¡ride
)

78 
box
 
b
;

79 
b
.
x
 = (
i
 + x[
šdex
 + 0*
¡ride
]è/ 
w
;

80 
b
.
y
 = (
j
 + 
x
[
šdex
 + 1*
¡ride
]è/ 
h
;

81 
b
.
w
 = 
	`exp
(
x
[
šdex
 + 2*
¡ride
]è* 
bŸ£s
[2*
n
] / w;

82 
b
.
h
 = 
	`exp
(
x
[
šdex
 + 3*
¡ride
]è* 
bŸ£s
[2*
n
+1] / h;

83  
b
;

84 
	}
}

86 
	$d–_»giÚ_box
(
box
 
Œuth
, *
x
, *
bŸ£s
, 
n
, 
šdex
, 
i
, 
j
, 
w
, 
h
, *
d–
, 
sÿË
, 
¡ride
)

88 
box
 
´ed
 = 
	`g‘_»giÚ_box
(
x
, 
bŸ£s
, 
n
, 
šdex
, 
i
, 
j
, 
w
, 
h
, 
¡ride
);

89 
iou
 = 
	`box_iou
(
´ed
, 
Œuth
);

91 
tx
 = (
Œuth
.
x
*
w
 - 
i
);

92 
ty
 = (
Œuth
.
y
*
h
 - 
j
);

93 
tw
 = 
	`log
(
Œuth
.
w
*w / 
bŸ£s
[2*
n
]);

94 
th
 = 
	`log
(
Œuth
.
h
*h / 
bŸ£s
[2*
n
 + 1]);

96 
d–
[
šdex
 + 0*
¡ride
] = 
sÿË
 * (
tx
 - 
x
[index + 0*stride]);

97 
d–
[
šdex
 + 1*
¡ride
] = 
sÿË
 * (
ty
 - 
x
[index + 1*stride]);

98 
d–
[
šdex
 + 2*
¡ride
] = 
sÿË
 * (
tw
 - 
x
[index + 2*stride]);

99 
d–
[
šdex
 + 3*
¡ride
] = 
sÿË
 * (
th
 - 
x
[index + 3*stride]);

100  
iou
;

101 
	}
}

103 
	$d–_»giÚ_mask
(*
Œuth
, *
x
, 
n
, 
šdex
, *
d–
, 
¡ride
, 
sÿË
)

105 
i
;

106 
i
 = 0; i < 
n
; ++i){

107 
d–
[
šdex
 + 
i
*
¡ride
] = 
sÿË
*(
Œuth
[i] - 
x
[index + i*stride]);

109 
	}
}

112 
	$d–_»giÚ_şass
(*
ouut
, *
d–
, 
šdex
, 
şass
, 
şas£s
, 
Œ“
 *
h›r
, 
sÿË
, 
¡ride
, *
avg_ÿt
, 
g
)

114 
i
, 
n
;

115 if(
h›r
){

116 
´ed
 = 1;

117 
şass
 >= 0){

118 
´ed
 *ğ
ouut
[
šdex
 + 
¡ride
*
şass
];

119 
g
 = 
h›r
->
group
[
şass
];

120 
off£t
 = 
h›r
->
group_off£t
[
g
];

121 
i
 = 0; i < 
h›r
->
group_size
[
g
]; ++i){

122 
d–
[
šdex
 + 
¡ride
*(
off£t
 + 
i
)] = 
sÿË
 * (0 - 
ouut
[index + stride*(offset + i)]);

124 
d–
[
šdex
 + 
¡ride
*
şass
] = 
sÿË
 * (1 - 
ouut
[index + stride*class]);

126 
şass
 = 
h›r
->
·»Á
[class];

128 *
avg_ÿt
 +ğ
´ed
;

130 ià(
d–
[
šdex
] && 
g
){

131 
d–
[
šdex
 + 
¡ride
*
şass
] = 
sÿË
 * (1 - 
ouut
[index + stride*class]);

134 
n
 = 0;‚ < 
şas£s
; ++n){

135 
d–
[
šdex
 + 
¡ride
*
n
] = 
sÿË
 * ((Ò =ğ
şass
)?1 : 0è- 
ouut
[index + stride*n]);

136 if(
n
 =ğ
şass
è*
avg_ÿt
 +ğ
ouut
[
šdex
 + 
¡ride
*n];

139 
	}
}

141 
	$log™
(
x
)

143  
	`log
(
x
/(1.-x));

144 
	}
}

146 
	$ti¢ª
(
x
)

148  (
x
 != x);

149 
	}
}

151 
	$’Œy_šdex
(
Ïy”
 
l
, 
b©ch
, 
loÿtiÚ
, 
’Œy
)

153 
n
 = 
loÿtiÚ
 / (
l
.
w
*l.
h
);

154 
loc
 = 
loÿtiÚ
 % (
l
.
w
*l.
h
);

155  
b©ch
*
l
.
ouuts
 + 
n
*l.
w
*l.
h
*Ö.
coÜds
+l.
şas£s
+1è+ 
’Œy
*l.w*l.h + 
loc
;

156 
	}
}

158 
	$fÜw¬d_»giÚ_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

160 
i
,
j
,
b
,
t
,
n
;

161 
	`memıy
(
l
.
ouut
, 
Ãt
.
šput
,†.
ouuts
*l.
b©ch
*());

163 #iâdeà
GPU


164 
b
 = 0; b < 
l
.
b©ch
; ++b){

165 
n
 = 0;‚ < 
l
.n; ++n){

166 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 0);

167 
	`aùiv©e_¬¿y
(
l
.
ouut
 + 
šdex
, 2*l.
w
*l.
h
, 
LOGISTIC
);

168 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
,†.
coÜds
);

169 if(!
l
.
background
è
	`aùiv©e_¬¿y
Ö.
ouut
 + 
šdex
,†.
w
*l.
h
, 
LOGISTIC
);

170 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
,†.
coÜds
 + 1);

171 if(!
l
.
soámax
 && !l.
soámax_Œ“
è
	`aùiv©e_¬¿y
Ö.
ouut
 + 
šdex
,†.
şas£s
*l.
w
*l.
h
, 
LOGISTIC
);

174 ià(
l
.
soámax_Œ“
){

175 
i
;

176 
couÁ
 = 
l
.
coÜds
 + 1;

177 
i
 = 0; i < 
l
.
soámax_Œ“
->
groups
; ++i) {

178 
group_size
 = 
l
.
soámax_Œ“
->group_size[
i
];

179 
	`soámax_ıu
(
Ãt
.
šput
 + 
couÁ
, 
group_size
, 
l
.
b©ch
,†.
šputs
,†.
n
*l.
w
*l.
h
, 1,†.n*l.w*l.h,†.
‹m³¿tu»
,†.
ouut
 + count);

180 
couÁ
 +ğ
group_size
;

182 } ià(
l
.
soámax
){

183 
šdex
 = 
	`’Œy_šdex
(
l
, 0, 0,†.
coÜds
 + !l.
background
);

184 
	`soámax_ıu
(
Ãt
.
šput
 + 
šdex
, 
l
.
şas£s
 +†.
background
,†.
b©ch
*l.
n
,†.
šputs
/l.n,†.
w
*l.
h
, 1,†.w*l.h, 1,†.
ouut
 + index);

188 
	`mem£t
(
l
.
d–
, 0,†.
ouuts
 *†.
b©ch
 * ());

189 if(!
Ãt
.
Œaš
) ;

190 
avg_iou
 = 0;

191 
»ÿÎ
 = 0;

192 
avg_ÿt
 = 0;

193 
avg_obj
 = 0;

194 
avg_ªyobj
 = 0;

195 
couÁ
 = 0;

196 
şass_couÁ
 = 0;

197 *(
l
.
co¡
) = 0;

198 
b
 = 0; b < 
l
.
b©ch
; ++b) {

199 if(
l
.
soámax_Œ“
){

200 
Úlyşass
 = 0;

201 
t
 = 0; < 30; ++t){

202 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
t
*(
l
.
coÜds
 + 1è+ 
b
*l.
Œuths
, 1);

203 if(!
Œuth
.
x
) ;

204 
şass
 = 
Ãt
.
Œuth
[
t
*(
l
.
coÜds
 + 1è+ 
b
*l.
Œuths
 +†.coords];

205 
maxp
 = 0;

206 
maxi
 = 0;

207 if(
Œuth
.
x
 > 100000 &&ruth.
y
 > 100000){

208 
n
 = 0;‚ < 
l
.n*l.
w
*l.
h
; ++n){

209 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
,†.
coÜds
 + 1);

210 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
,†.
coÜds
);

211 
sÿË
 = 
l
.
ouut
[
obj_šdex
];

212 
l
.
d–
[
obj_šdex
] =†.
noobjeù_sÿË
 * (0 -†.
ouut
[obj_index]);

213 
p
 = 
sÿË
*
	`g‘_h›¿rchy_´obab™y
(
l
.
ouut
 + 
şass_šdex
,†.
soámax_Œ“
, 
şass
,†.
w
*l.
h
);

214 if(
p
 > 
maxp
){

215 
maxp
 = 
p
;

216 
maxi
 = 
n
;

219 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
maxi
,†.
coÜds
 + 1);

220 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
maxi
,†.
coÜds
);

221 
	`d–_»giÚ_şass
(
l
.
ouut
,†.
d–
, 
şass_šdex
, 
şass
,†.
şas£s
,†.
soámax_Œ“
,†.
şass_sÿË
,†.
w
*l.
h
, &
avg_ÿt
, !l.
soámax
);

222 if(
l
.
ouut
[
obj_šdex
] < .3èl.
d–
[obj_šdex] =†.
objeù_sÿË
 * (.3 -†.output[obj_index]);

223 
l
.
d–
[
obj_šdex
] = 0;

224 
l
.
d–
[
obj_šdex
] = 0;

225 ++
şass_couÁ
;

226 
Úlyşass
 = 1;

230 if(
Úlyşass
) ;

232 
j
 = 0; j < 
l
.
h
; ++j) {

233 
i
 = 0; i < 
l
.
w
; ++i) {

234 
n
 = 0;‚ < 
l
.n; ++n) {

235 
box_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 0);

236 
box
 
´ed
 = 
	`g‘_»giÚ_box
(
l
.
ouut
,†.
bŸ£s
, 
n
, 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
,†.w*l.h);

237 
be¡_iou
 = 0;

238 
t
 = 0; < 30; ++t){

239 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
t
*(
l
.
coÜds
 + 1è+ 
b
*l.
Œuths
, 1);

240 if(!
Œuth
.
x
) ;

241 
iou
 = 
	`box_iou
(
´ed
, 
Œuth
);

242 ià(
iou
 > 
be¡_iou
) {

243 
be¡_iou
 = 
iou
;

246 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
 + 
j
*l.w + 
i
,†.
coÜds
);

247 
avg_ªyobj
 +ğ
l
.
ouut
[
obj_šdex
];

248 
l
.
d–
[
obj_šdex
] =†.
noobjeù_sÿË
 * (0 -†.
ouut
[obj_index]);

249 if(
l
.
background
èl.
d–
[
obj_šdex
] =†.
noobjeù_sÿË
 * (1 -†.
ouut
[obj_index]);

250 ià(
be¡_iou
 > 
l
.
th»sh
) {

251 
l
.
d–
[
obj_šdex
] = 0;

254 if(*(
Ãt
.
£’
) < 12800){

255 
box
 
Œuth
 = {0};

256 
Œuth
.
x
 = (
i
 + .5)/
l
.
w
;

257 
Œuth
.
y
 = (
j
 + .5)/
l
.
h
;

258 
Œuth
.
w
 = 
l
.
bŸ£s
[2*
n
]/l.w;

259 
Œuth
.
h
 = 
l
.
bŸ£s
[2*
n
+1]/l.h;

260 
	`d–_»giÚ_box
(
Œuth
, 
l
.
ouut
,†.
bŸ£s
, 
n
, 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
,†.
d–
, .01,†.w*l.h);

265 
t
 = 0; < 30; ++t){

266 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
t
*(
l
.
coÜds
 + 1è+ 
b
*l.
Œuths
, 1);

268 if(!
Œuth
.
x
) ;

269 
be¡_iou
 = 0;

270 
be¡_n
 = 0;

271 
i
 = (
Œuth
.
x
 * 
l
.
w
);

272 
j
 = (
Œuth
.
y
 * 
l
.
h
);

273 
box
 
Œuth_shiá
 = 
Œuth
;

274 
Œuth_shiá
.
x
 = 0;

275 
Œuth_shiá
.
y
 = 0;

276 
n
 = 0;‚ < 
l
.n; ++n){

277 
box_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 0);

278 
box
 
´ed
 = 
	`g‘_»giÚ_box
(
l
.
ouut
,†.
bŸ£s
, 
n
, 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
,†.w*l.h);

279 if(
l
.
bŸs_m©ch
){

280 
´ed
.
w
 = 
l
.
bŸ£s
[2*
n
]/l.w;

281 
´ed
.
h
 = 
l
.
bŸ£s
[2*
n
+1]/l.h;

283 
´ed
.
x
 = 0;

284 
´ed
.
y
 = 0;

285 
iou
 = 
	`box_iou
(
´ed
, 
Œuth_shiá
);

286 ià(
iou
 > 
be¡_iou
){

287 
be¡_iou
 = 
iou
;

288 
be¡_n
 = 
n
;

292 
box_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
be¡_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 0);

293 
iou
 = 
	`d–_»giÚ_box
(
Œuth
, 
l
.
ouut
,†.
bŸ£s
, 
be¡_n
, 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
,†.
d–
,†.
coÜd_sÿË
 * (2 -ruth.w*truth.h),†.w*l.h);

294 if(
l
.
coÜds
 > 4){

295 
mask_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
be¡_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 4);

296 
	`d–_»giÚ_mask
(
Ãt
.
Œuth
 + 
t
*(
l
.
coÜds
 + 1è+ 
b
*l.
Œuths
 + 5,†.
ouut
,†.coÜd - 4, 
mask_šdex
,†.
d–
,†.
w
*l.
h
,†.
mask_sÿË
);

298 if(
iou
 > .5è
»ÿÎ
 += 1;

299 
avg_iou
 +ğ
iou
;

301 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
be¡_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
,†.
coÜds
);

302 
avg_obj
 +ğ
l
.
ouut
[
obj_šdex
];

303 
l
.
d–
[
obj_šdex
] =†.
objeù_sÿË
 * (1 -†.
ouut
[obj_index]);

304 ià(
l
.
»scÜe
) {

305 
l
.
d–
[
obj_šdex
] =†.
objeù_sÿË
 * (
iou
 -†.
ouut
[obj_index]);

307 if(
l
.
background
){

308 
l
.
d–
[
obj_šdex
] =†.
objeù_sÿË
 * (0 -†.
ouut
[obj_index]);

311 
şass
 = 
Ãt
.
Œuth
[
t
*(
l
.
coÜds
 + 1è+ 
b
*l.
Œuths
 +†.coords];

312 ià(
l
.
m­
è
şass
 =†.map[class];

313 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
be¡_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
,†.
coÜds
 + 1);

314 
	`d–_»giÚ_şass
(
l
.
ouut
,†.
d–
, 
şass_šdex
, 
şass
,†.
şas£s
,†.
soámax_Œ“
,†.
şass_sÿË
,†.
w
*l.
h
, &
avg_ÿt
, !l.
soámax
);

315 ++
couÁ
;

316 ++
şass_couÁ
;

319 *(
l
.
co¡
èğ
	`pow
(
	`mag_¬¿y
Ö.
d–
,†.
ouuts
 *†.
b©ch
), 2);

320 
	`´štf
("RegiÚ Avg IOU: %f, CÏss: %f, Obj: %f, NØObj: %f, Avg ReÿÎ: %f, couÁ: %d\n", 
avg_iou
/
couÁ
, 
avg_ÿt
/
şass_couÁ
, 
avg_obj
/couÁ, 
avg_ªyobj
/(
l
.
w
*l.
h
*l.
n
*l.
b©ch
), 
»ÿÎ
/count, count);

321 
	}
}

323 
	$backw¬d_»giÚ_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

334 
	}
}

336 
	$cÜ»ù_»giÚ_boxes
(
d‘eùiÚ
 *
d‘s
, 
n
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
»Ïtive
)

338 
i
;

339 
Ãw_w
=0;

340 
Ãw_h
=0;

341 ià((()
Ãtw
/
w
è< (()
Ãth
/
h
)) {

342 
Ãw_w
 = 
Ãtw
;

343 
Ãw_h
 = (
h
 * 
Ãtw
)/
w
;

345 
Ãw_h
 = 
Ãth
;

346 
Ãw_w
 = (
w
 * 
Ãth
)/
h
;

348 
i
 = 0; i < 
n
; ++i){

349 
box
 
b
 = 
d‘s
[
i
].
bbox
;

350 
b
.
x
 = (b.x - (
Ãtw
 - 
Ãw_w
)/2./netw) / (()new_w/netw);

351 
b
.
y
 = (b.y - (
Ãth
 - 
Ãw_h
)/2./neth) / (()new_h/neth);

352 
b
.
w
 *ğ()
Ãtw
/
Ãw_w
;

353 
b
.
h
 *ğ()
Ãth
/
Ãw_h
;

354 if(!
»Ïtive
){

355 
b
.
x
 *ğ
w
;

356 
b
.
w
 *= w;

357 
b
.
y
 *ğ
h
;

358 
b
.
h
 *= h;

360 
d‘s
[
i
].
bbox
 = 
b
;

362 
	}
}

364 
	$g‘_»giÚ_d‘eùiÚs
(
Ïy”
 
l
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
th»sh
, *
m­
, 
Œ“_th»sh
, 
»Ïtive
, 
d‘eùiÚ
 *
d‘s
)

366 
i
,
j
,
n
,
z
;

367 *
´ediùiÚs
 = 
l
.
ouut
;

368 ià(
l
.
b©ch
 == 2) {

369 *
æ
 = 
l
.
ouut
 +†.
ouuts
;

370 
j
 = 0; j < 
l
.
h
; ++j) {

371 
i
 = 0; i < 
l
.
w
/2; ++i) {

372 
n
 = 0;‚ < 
l
.n; ++n) {

373 
z
 = 0; z < 
l
.
şas£s
 +†.
coÜds
 + 1; ++z){

374 
i1
 = 
z
*
l
.
w
*l.
h
*l.
n
 +‚*l.w*l.h + 
j
*l.w + 
i
;

375 
i2
 = 
z
*
l
.
w
*l.
h
*l.
n
 +‚*l.w*l.h + 
j
*l.w + (l.w - 
i
 - 1);

376 
sw­
 = 
æ
[
i1
];

377 
æ
[
i1
] = fl[
i2
];

378 
æ
[
i2
] = 
sw­
;

379 if(
z
 == 0){

380 
æ
[
i1
] = -flip[i1];

381 
æ
[
i2
] = -flip[i2];

387 
i
 = 0; i < 
l
.
ouuts
; ++i){

388 
l
.
ouut
[
i
] = (l.ouut[i] + 
æ
[i])/2.;

391 
i
 = 0; i < 
l
.
w
*l.
h
; ++i){

392 
row
 = 
i
 / 
l
.
w
;

393 
cŞ
 = 
i
 % 
l
.
w
;

394 
n
 = 0;‚ < 
l
.n; ++n){

395 
šdex
 = 
n
*
l
.
w
*l.
h
 + 
i
;

396 
j
 = 0; j < 
l
.
şas£s
; ++j){

397 
d‘s
[
šdex
].
´ob
[
j
] = 0;

399 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
,†.
coÜds
);

400 
box_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
, 0);

401 
mask_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
, 4);

402 
sÿË
 = 
l
.
background
 ? 1 : 
´ediùiÚs
[
obj_šdex
];

403 
d‘s
[
šdex
].
bbox
 = 
	`g‘_»giÚ_box
(
´ediùiÚs
, 
l
.
bŸ£s
, 
n
, 
box_šdex
, 
cŞ
, 
row
,†.
w
,†.
h
,†.w*l.h);

404 
d‘s
[
šdex
].
objeùÃss
 = 
sÿË
 > 
th»sh
 ? scale : 0;

405 if(
d‘s
[
šdex
].
mask
){

406 
j
 = 0; j < 
l
.
coÜds
 - 4; ++j){

407 
d‘s
[
šdex
].
mask
[
j
] = 
l
.
ouut
[
mask_šdex
 + j*l.
w
*l.
h
];

411 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
,†.
coÜds
 + !l.
background
);

412 if(
l
.
soámax_Œ“
){

414 
	`h›¿rchy_´ediùiÚs
(
´ediùiÚs
 + 
şass_šdex
, 
l
.
şas£s
,†.
soámax_Œ“
, 0,†.
w
*l.
h
);

415 if(
m­
){

416 
j
 = 0; j < 200; ++j){

417 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
,†.
coÜds
 + 1 + 
m­
[
j
]);

418 
´ob
 = 
sÿË
*
´ediùiÚs
[
şass_šdex
];

419 
d‘s
[
šdex
].
´ob
[
j
] = (´ob > 
th»sh
) ?…rob : 0;

422 
j
 = 
	`h›¿rchy_tİ_´ediùiÚ
(
´ediùiÚs
 + 
şass_šdex
, 
l
.
soámax_Œ“
, 
Œ“_th»sh
,†.
w
*l.
h
);

423 
d‘s
[
šdex
].
´ob
[
j
] = (
sÿË
 > 
th»sh
) ? scale : 0;

426 if(
d‘s
[
šdex
].
objeùÃss
){

427 
j
 = 0; j < 
l
.
şas£s
; ++j){

428 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
,†.
coÜds
 + 1 + 
j
);

429 
´ob
 = 
sÿË
*
´ediùiÚs
[
şass_šdex
];

430 
d‘s
[
šdex
].
´ob
[
j
] = (´ob > 
th»sh
) ?…rob : 0;

436 
	`cÜ»ù_»giÚ_boxes
(
d‘s
, 
l
.
w
*l.
h
*l.
n
, w, h, 
Ãtw
, 
Ãth
, 
»Ïtive
);

437 
	}
}

439 #ifdeà
GPU


441 
	$fÜw¬d_»giÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

443 
	`cİy_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

444 
b
, 
n
;

445 
b
 = 0; b < 
l
.
b©ch
; ++b){

446 
n
 = 0;‚ < 
l
.n; ++n){

447 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 0);

448 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
 + 
šdex
, 2*l.
w
*l.
h
, 
LOGISTIC
);

449 if(
l
.
coÜds
 > 4){

450 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 4);

451 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
 + 
šdex
, (l.
coÜds
 - 4)*l.
w
*l.
h
, 
LOGISTIC
);

453 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
,†.
coÜds
);

454 if(!
l
.
background
è
	`aùiv©e_¬¿y_gpu
Ö.
ouut_gpu
 + 
šdex
,†.
w
*l.
h
, 
LOGISTIC
);

455 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
,†.
coÜds
 + 1);

456 if(!
l
.
soámax
 && !l.
soámax_Œ“
è
	`aùiv©e_¬¿y_gpu
Ö.
ouut_gpu
 + 
šdex
,†.
şas£s
*l.
w
*l.
h
, 
LOGISTIC
);

459 ià(
l
.
soámax_Œ“
){

460 
šdex
 = 
	`’Œy_šdex
(
l
, 0, 0,†.
coÜds
 + 1);

461 
	`soámax_Œ“
(
Ãt
.
šput_gpu
 + 
šdex
, 
l
.
w
*l.
h
,†.
b©ch
*l.
n
,†.
šputs
/l.n, 1,†.
ouut_gpu
 + index, *l.
soámax_Œ“
);

462 } ià(
l
.
soámax
) {

463 
šdex
 = 
	`’Œy_šdex
(
l
, 0, 0,†.
coÜds
 + !l.
background
);

464 
	`soámax_gpu
(
Ãt
.
šput_gpu
 + 
šdex
, 
l
.
şas£s
 +†.
background
,†.
b©ch
*l.
n
,†.
šputs
/l.n,†.
w
*l.
h
, 1,†.w*l.h, 1,†.
ouut_gpu
 + index);

466 if(!
Ãt
.
Œaš
 || 
l
.
ÚlyfÜw¬d
){

467 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
b©ch
*l.
ouuts
);

471 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
, 
Ãt
.
šput
,†.
b©ch
*l.
šputs
);

472 
	`fÜw¬d_»giÚ_Ïy”
(
l
, 
Ãt
);

474 if(!
Ãt
.
Œaš
) ;

475 
	`cuda_push_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
ouuts
);

476 
	}
}

478 
	$backw¬d_»giÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

480 
b
, 
n
;

481 
b
 = 0; b < 
l
.
b©ch
; ++b){

482 
n
 = 0;‚ < 
l
.n; ++n){

483 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 0);

484 
	`g¿d›Á_¬¿y_gpu
(
l
.
ouut_gpu
 + 
šdex
, 2*l.
w
*l.
h
, 
LOGISTIC
,†.
d–_gpu
 + index);

485 if(
l
.
coÜds
 > 4){

486 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 4);

487 
	`g¿d›Á_¬¿y_gpu
(
l
.
ouut_gpu
 + 
šdex
, (l.
coÜds
 - 4)*l.
w
*l.
h
, 
LOGISTIC
,†.
d–_gpu
 + index);

489 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
,†.
coÜds
);

490 if(!
l
.
background
è
	`g¿d›Á_¬¿y_gpu
Ö.
ouut_gpu
 + 
šdex
,†.
w
*l.
h
, 
LOGISTIC
,†.
d–_gpu
 + index);

493 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

494 
	}
}

497 
	$z”o_objeùÃss
(
Ïy”
 
l
)

499 
i
, 
n
;

500 
i
 = 0; i < 
l
.
w
*l.
h
; ++i){

501 
n
 = 0;‚ < 
l
.n; ++n){

502 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
,†.
coÜds
);

503 
l
.
ouut
[
obj_šdex
] = 0;

506 
	}
}

	@host/src/region_layer.h

1 #iâdeà
REGION_LAYER_H


2 
	#REGION_LAYER_H


	)

4 
	~"d¬kÃt.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_»giÚ_Ïy”
(
b©ch
, 
w
, 
h
, 
n
, 
şas£s
, 
coÜds
);

9 
fÜw¬d_»giÚ_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 
backw¬d_»giÚ_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
»size_»giÚ_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

13 #ifdeà
GPU


14 
fÜw¬d_»giÚ_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
backw¬d_»giÚ_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/reorg_layer.c

1 
	~"»Üg_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~"bÏs.h
"

5 
	~<¡dio.h
>

8 
Ïy”
 
	$make_»Üg_Ïy”
(
b©ch
, 
w
, 
h
, 
c
, 
¡ride
, 
»v”£
, 
æ©‹n
, 
exŒa
)

10 
Ïy”
 
l
 = {0};

11 
l
.
ty³
 = 
REORG
;

12 
l
.
b©ch
 = batch;

13 
l
.
¡ride
 = stride;

14 
l
.
exŒa
 =ƒxtra;

15 
l
.
h
 = h;

16 
l
.
w
 = w;

17 
l
.
c
 = c;

18 
l
.
æ©‹n
 = flatten;

19 if(
»v”£
){

20 
l
.
out_w
 = 
w
*
¡ride
;

21 
l
.
out_h
 = 
h
*
¡ride
;

22 
l
.
out_c
 = 
c
/(
¡ride
*stride);

24 
l
.
out_w
 = 
w
/
¡ride
;

25 
l
.
out_h
 = 
h
/
¡ride
;

26 
l
.
out_c
 = 
c
*(
¡ride
*stride);

28 
l
.
»v”£
 =„everse;

30 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

31 
l
.
šputs
 = 
h
*
w
*
c
;

32 if(
l
.
exŒa
){

33 
l
.
out_w
 =†.
out_h
 =†.
out_c
 = 0;

34 
l
.
ouuts
 =†.
šputs
 +†.
exŒa
;

37 if(
exŒa
){

38 
	`årštf
(
¡d”r
, "»Üg %4d -> %4d\n", 
l
.
šputs
,†.
ouuts
);

40 
	`årštf
(
¡d”r
, "»Üg /%2d %4d x%4d x%4d -> %4d x%4d x%4d\n", 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
);

42 
ouut_size
 = 
l
.
ouuts
 * 
b©ch
;

43 
l
.
ouut
 = 
	`ÿÎoc
(
ouut_size
, ());

44 
l
.
d–
 = 
	`ÿÎoc
(
ouut_size
, ());

46 
l
.
fÜw¬d
 = 
fÜw¬d_»Üg_Ïy”
;

47 
l
.
backw¬d
 = 
backw¬d_»Üg_Ïy”
;

48 #ifdeà
GPU


49 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_»Üg_Ïy”_gpu
;

50 
l
.
backw¬d_gpu
 = 
backw¬d_»Üg_Ïy”_gpu
;

52 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
ouut_size
);

53 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
ouut_size
);

55  
l
;

56 
	}
}

58 
	$»size_»Üg_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

60 
¡ride
 = 
l
->stride;

61 
c
 = 
l
->c;

63 
l
->
h
 = h;

64 
l
->
w
 = w;

66 if(
l
->
»v”£
){

67 
l
->
out_w
 = 
w
*
¡ride
;

68 
l
->
out_h
 = 
h
*
¡ride
;

69 
l
->
out_c
 = 
c
/(
¡ride
*stride);

71 
l
->
out_w
 = 
w
/
¡ride
;

72 
l
->
out_h
 = 
h
/
¡ride
;

73 
l
->
out_c
 = 
c
*(
¡ride
*stride);

76 
l
->
ouuts
 =†->
out_h
 *†->
out_w
 *†->
out_c
;

77 
l
->
šputs
 =†->
ouuts
;

78 
ouut_size
 = 
l
->
ouuts
 *†->
b©ch
;

80 
l
->
ouut
 = 
	`»®loc
Ö->ouut, 
ouut_size
 * ());

81 
l
->
d–
 = 
	`»®loc
Ö->d–, 
ouut_size
 * ());

83 #ifdeà
GPU


84 
	`cuda_ä“
(
l
->
ouut_gpu
);

85 
	`cuda_ä“
(
l
->
d–_gpu
);

86 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
, 
ouut_size
);

87 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
, 
ouut_size
);

89 
	}
}

91 
	$fÜw¬d_»Üg_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

93 
i
;

94 if(
l
.
æ©‹n
){

95 
	`memıy
(
l
.
ouut
, 
Ãt
.
šput
,†.
ouuts
*l.
b©ch
*());

96 if(
l
.
»v”£
){

97 
	`æ©‹n
(
l
.
ouut
,†.
w
*l.
h
,†.
c
,†.
b©ch
, 0);

99 
	`æ©‹n
(
l
.
ouut
,†.
w
*l.
h
,†.
c
,†.
b©ch
, 1);

101 } ià(
l
.
exŒa
) {

102 
i
 = 0; i < 
l
.
b©ch
; ++i){

103 
	`cİy_ıu
(
l
.
šputs
, 
Ãt
.
šput
 + 
i
*l.šputs, 1,†.
ouut
 + i*l.
ouuts
, 1);

105 } ià(
l
.
»v”£
){

106 
	`»Üg_ıu
(
Ãt
.
šput
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 1,†.
ouut
);

108 
	`»Üg_ıu
(
Ãt
.
šput
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 0,†.
ouut
);

110 
	}
}

112 
	$backw¬d_»Üg_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

114 
i
;

115 if(
l
.
æ©‹n
){

116 
	`memıy
(
Ãt
.
d–
, 
l
.d–,†.
ouuts
*l.
b©ch
*());

117 if(
l
.
»v”£
){

118 
	`æ©‹n
(
Ãt
.
d–
, 
l
.
w
*l.
h
,†.
c
,†.
b©ch
, 1);

120 
	`æ©‹n
(
Ãt
.
d–
, 
l
.
w
*l.
h
,†.
c
,†.
b©ch
, 0);

122 } if(
l
.
»v”£
){

123 
	`»Üg_ıu
(
l
.
d–
,†.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 0, 
Ãt
.delta);

124 } ià(
l
.
exŒa
) {

125 
i
 = 0; i < 
l
.
b©ch
; ++i){

126 
	`cİy_ıu
(
l
.
šputs
,†.
d–
 + 
i
*l.
ouuts
, 1, 
Ãt
.delta + i*l.inputs, 1);

129 
	`»Üg_ıu
(
l
.
d–
,†.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 1, 
Ãt
.delta);

131 
	}
}

133 #ifdeà
GPU


134 
	$fÜw¬d_»Üg_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

136 
i
;

137 if(
l
.
æ©‹n
){

138 if(
l
.
»v”£
){

139 
	`æ©‹n_gpu
(
Ãt
.
šput_gpu
, 
l
.
w
*l.
h
,†.
c
,†.
b©ch
, 0,†.
ouut_gpu
);

141 
	`æ©‹n_gpu
(
Ãt
.
šput_gpu
, 
l
.
w
*l.
h
,†.
c
,†.
b©ch
, 1,†.
ouut_gpu
);

143 } ià(
l
.
exŒa
) {

144 
i
 = 0; i < 
l
.
b©ch
; ++i){

145 
	`cİy_gpu
(
l
.
šputs
, 
Ãt
.
šput_gpu
 + 
i
*l.šputs, 1,†.
ouut_gpu
 + i*l.
ouuts
, 1);

147 } ià(
l
.
»v”£
) {

148 
	`»Üg_gpu
(
Ãt
.
šput_gpu
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 1,†.
ouut_gpu
);

150 
	`»Üg_gpu
(
Ãt
.
šput_gpu
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 0,†.
ouut_gpu
);

152 
	}
}

154 
	$backw¬d_»Üg_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

156 if(
l
.
æ©‹n
){

157 if(
l
.
»v”£
){

158 
	`æ©‹n_gpu
(
l
.
d–_gpu
,†.
w
*l.
h
,†.
c
,†.
b©ch
, 1, 
Ãt
.delta_gpu);

160 
	`æ©‹n_gpu
(
l
.
d–_gpu
,†.
w
*l.
h
,†.
c
,†.
b©ch
, 0, 
Ãt
.delta_gpu);

162 } ià(
l
.
exŒa
) {

163 
i
;

164 
i
 = 0; i < 
l
.
b©ch
; ++i){

165 
	`cİy_gpu
(
l
.
šputs
,†.
d–_gpu
 + 
i
*l.
ouuts
, 1, 
Ãt
.delta_gpu + i*l.inputs, 1);

167 } if(
l
.
»v”£
){

168 
	`»Üg_gpu
(
l
.
d–_gpu
,†.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 0, 
Ãt
.delta_gpu);

170 
	`»Üg_gpu
(
l
.
d–_gpu
,†.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 1, 
Ãt
.delta_gpu);

172 
	}
}

	@host/src/reorg_layer.h

1 #iâdeà
REORG_LAYER_H


2 
	#REORG_LAYER_H


	)

4 
	~"image.h
"

5 
	~"cuda.h
"

6 
	~"Ïy”.h
"

7 
	~"ÃtwÜk.h
"

9 
Ïy”
 
make_»Üg_Ïy”
(
b©ch
, 
w
, 
h
, 
c
, 
¡ride
, 
»v”£
, 
æ©‹n
, 
exŒa
);

10 
»size_»Üg_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

11 
fÜw¬d_»Üg_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_»Üg_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

14 #ifdeà
GPU


15 
fÜw¬d_»Üg_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_»Üg_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/rnn_layer.c

1 
	~"ºn_Ïy”.h
"

2 
	~"cÚÃùed_Ïy”.h
"

3 
	~"uts.h
"

4 
	~"cuda.h
"

5 
	~"bÏs.h
"

6 
	~"gemm.h
"

8 
	~<m©h.h
>

9 
	~<¡dio.h
>

10 
	~<¡dlib.h
>

11 
	~<¡ršg.h
>

13 
	$šüem’t_Ïy”
(
Ïy”
 *
l
, 
¡•s
)

15 
num
 = 
l
->
ouuts
*l->
b©ch
*
¡•s
;

16 
l
->
ouut
 +ğ
num
;

17 
l
->
d–
 +ğ
num
;

18 
l
->
x
 +ğ
num
;

19 
l
->
x_nÜm
 +ğ
num
;

21 #ifdeà
GPU


22 
l
->
ouut_gpu
 +ğ
num
;

23 
l
->
d–_gpu
 +ğ
num
;

24 
l
->
x_gpu
 +ğ
num
;

25 
l
->
x_nÜm_gpu
 +ğ
num
;

27 
	}
}

29 
Ïy”
 
	$make_ºn_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
¡•s
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
)

31 
	`årštf
(
¡d”r
, "RNN Lay”: %d iÅuts, %d ouuts\n", 
šputs
, 
ouuts
);

32 
b©ch
 = b©ch / 
¡•s
;

33 
Ïy”
 
l
 = {0};

34 
l
.
b©ch
 = batch;

35 
l
.
ty³
 = 
RNN
;

36 
l
.
¡•s
 = steps;

37 
l
.
šputs
 = inputs;

39 
l
.
¡©e
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

40 
l
.
´ev_¡©e
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

42 
l
.
šput_Ïy”
 = 
	`m®loc
((
Ïy”
));

43 
	`årštf
(
¡d”r
, "\t\t");

44 *(
l
.
šput_Ïy”
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
šputs
, 
ouuts
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

45 
l
.
šput_Ïy”
->
b©ch
 = batch;

47 
l
.
£lf_Ïy”
 = 
	`m®loc
((
Ïy”
));

48 
	`årštf
(
¡d”r
, "\t\t");

49 *(
l
.
£lf_Ïy”
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

50 
l
.
£lf_Ïy”
->
b©ch
 = batch;

52 
l
.
ouut_Ïy”
 = 
	`m®loc
((
Ïy”
));

53 
	`årštf
(
¡d”r
, "\t\t");

54 *(
l
.
ouut_Ïy”
èğ
	`make_cÚÃùed_Ïy”
(
b©ch
*
¡•s
, 
ouuts
, ouuts, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

55 
l
.
ouut_Ïy”
->
b©ch
 = batch;

57 
l
.
ouuts
 = outputs;

58 
l
.
ouut
 =†.
ouut_Ïy”
->output;

59 
l
.
d–
 =†.
ouut_Ïy”
->delta;

61 
l
.
fÜw¬d
 = 
fÜw¬d_ºn_Ïy”
;

62 
l
.
backw¬d
 = 
backw¬d_ºn_Ïy”
;

63 
l
.
upd©e
 = 
upd©e_ºn_Ïy”
;

64 #ifdeà
GPU


65 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_ºn_Ïy”_gpu
;

66 
l
.
backw¬d_gpu
 = 
backw¬d_ºn_Ïy”_gpu
;

67 
l
.
upd©e_gpu
 = 
upd©e_ºn_Ïy”_gpu
;

68 
l
.
¡©e_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

69 
l
.
´ev_¡©e_gpu
 = 
	`cuda_make_¬¿y
(0, 
b©ch
*
ouuts
);

70 
l
.
ouut_gpu
 =†.
ouut_Ïy”
->output_gpu;

71 
l
.
d–_gpu
 =†.
ouut_Ïy”
->delta_gpu;

72 #ifdeà
CUDNN


73 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
šput_Ïy”
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.šput_Ïy”->
out_c
,†.šput_Ïy”->
out_h
,†.šput_Ïy”->
out_w
);

74 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
£lf_Ïy”
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.£lf_Ïy”->
out_c
,†.£lf_Ïy”->
out_h
,†.£lf_Ïy”->
out_w
);

75 
	`cudÂS‘T’sÜ4dDesütÜ
(
l
.
ouut_Ïy”
->
d¡T’sÜDesc
, 
CUDNN_TENSOR_NCHW
, 
CUDNN_DATA_FLOAT
, 
b©ch
,†.ouut_Ïy”->
out_c
,†.ouut_Ïy”->
out_h
,†.ouut_Ïy”->
out_w
);

79  
l
;

80 
	}
}

82 
	$upd©e_ºn_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

84 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
šput_Ïy”
), 
a
);

85 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
£lf_Ïy”
), 
a
);

86 
	`upd©e_cÚÃùed_Ïy”
(*(
l
.
ouut_Ïy”
), 
a
);

87 
	}
}

89 
	$fÜw¬d_ºn_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

91 
ÃtwÜk
 
s
 = 
Ãt
;

92 
s
.
Œaš
 = 
Ãt
.train;

93 
i
;

94 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

95 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

96 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

98 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ouut_Ïy”
.
d–
, 1);

99 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
£lf_Ïy”
.
d–
, 1);

100 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
šput_Ïy”
.
d–
, 1);

101 if(
Ãt
.
Œaš
è
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
¡©e
, 1);

103 
i
 = 0; i < 
l
.
¡•s
; ++i) {

104 
s
.
šput
 = 
Ãt
.input;

105 
	`fÜw¬d_cÚÃùed_Ïy”
(
šput_Ïy”
, 
s
);

107 
s
.
šput
 = 
l
.
¡©e
;

108 
	`fÜw¬d_cÚÃùed_Ïy”
(
£lf_Ïy”
, 
s
);

110 *
Şd_¡©e
 = 
l
.
¡©e
;

111 if(
Ãt
.
Œaš
è
l
.
¡©e
 +ğl.
ouuts
*l.
b©ch
;

112 if(
l
.
shÜtcut
){

113 
	`cİy_ıu
(
l
.
ouuts
 *†.
b©ch
, 
Şd_¡©e
, 1,†.
¡©e
, 1);

115 
	`fl_ıu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
¡©e
, 1);

117 
	`axpy_ıu
(
l
.
ouuts
 *†.
b©ch
, 1, 
šput_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

118 
	`axpy_ıu
(
l
.
ouuts
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

120 
s
.
šput
 = 
l
.
¡©e
;

121 
	`fÜw¬d_cÚÃùed_Ïy”
(
ouut_Ïy”
, 
s
);

123 
Ãt
.
šput
 +ğ
l
.
šputs
*l.
b©ch
;

124 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 1);

125 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 1);

126 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 1);

128 
	}
}

130 
	$backw¬d_ºn_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

132 
ÃtwÜk
 
s
 = 
Ãt
;

133 
s
.
Œaš
 = 
Ãt
.train;

134 
i
;

135 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

136 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

137 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

139 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 
l
.
¡•s
-1);

140 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 
l
.
¡•s
-1);

141 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 
l
.
¡•s
-1);

143 
l
.
¡©e
 +ğl.
ouuts
*l.
b©ch
*l.
¡•s
;

144 
i
 = 
l
.
¡•s
-1; i >= 0; --i) {

145 
	`cİy_ıu
(
l
.
ouuts
 *†.
b©ch
, 
šput_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

146 
	`axpy_ıu
(
l
.
ouuts
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut
, 1,†.
¡©e
, 1);

148 
s
.
šput
 = 
l
.
¡©e
;

149 
s
.
d–
 = 
£lf_Ïy”
.delta;

150 
	`backw¬d_cÚÃùed_Ïy”
(
ouut_Ïy”
, 
s
);

152 
l
.
¡©e
 -ğl.
ouuts
*l.
b©ch
;

162 
s
.
šput
 = 
l
.
¡©e
;

163 
s
.
d–
 = 
£lf_Ïy”
.d– - 
l
.
ouuts
*l.
b©ch
;

164 ià(
i
 =ğ0è
s
.
d–
 = 0;

165 
	`backw¬d_cÚÃùed_Ïy”
(
£lf_Ïy”
, 
s
);

167 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
£lf_Ïy”
.
d–
, 1, 
šput_Ïy”
.delta, 1);

168 ià(
i
 > 0 && 
l
.
shÜtcut
è
	`axpy_ıu
Ö.
ouuts
*l.
b©ch
, 1, 
£lf_Ïy”
.
d–
, 1, self_layer.delta -†.outputs*l.batch, 1);

169 
s
.
šput
 = 
Ãt
.špuˆ+ 
i
*
l
.
šputs
*l.
b©ch
;

170 if(
Ãt
.
d–
è
s
.d– =‚‘.d– + 
i
*
l
.
šputs
*l.
b©ch
;

171 
s
.
d–
 = 0;

172 
	`backw¬d_cÚÃùed_Ïy”
(
šput_Ïy”
, 
s
);

174 
	`šüem’t_Ïy”
(&
šput_Ïy”
, -1);

175 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, -1);

176 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, -1);

178 
	}
}

180 #ifdeà
GPU


182 
	$puÎ_ºn_Ïy”
(
Ïy”
 
l
)

184 
	`puÎ_cÚÃùed_Ïy”
(*(
l
.
šput_Ïy”
));

185 
	`puÎ_cÚÃùed_Ïy”
(*(
l
.
£lf_Ïy”
));

186 
	`puÎ_cÚÃùed_Ïy”
(*(
l
.
ouut_Ïy”
));

187 
	}
}

189 
	$push_ºn_Ïy”
(
Ïy”
 
l
)

191 
	`push_cÚÃùed_Ïy”
(*(
l
.
šput_Ïy”
));

192 
	`push_cÚÃùed_Ïy”
(*(
l
.
£lf_Ïy”
));

193 
	`push_cÚÃùed_Ïy”
(*(
l
.
ouut_Ïy”
));

194 
	}
}

196 
	$upd©e_ºn_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
)

198 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
šput_Ïy”
), 
a
);

199 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
£lf_Ïy”
), 
a
);

200 
	`upd©e_cÚÃùed_Ïy”_gpu
(*(
l
.
ouut_Ïy”
), 
a
);

201 
	}
}

203 
	$fÜw¬d_ºn_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

205 
ÃtwÜk
 
s
 = {0};

206 
s
.
Œaš
 = 
Ãt
.train;

207 
i
;

208 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

209 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

210 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

212 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
ouut_Ïy”
.
d–_gpu
, 1);

213 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
£lf_Ïy”
.
d–_gpu
, 1);

214 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0, 
šput_Ïy”
.
d–_gpu
, 1);

216 if(
Ãt
.
Œaš
) {

217 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
 *†.
¡•s
, 0,†.
d–_gpu
, 1);

218 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
¡©e_gpu
, 1,†.
´ev_¡©e_gpu
, 1);

221 
i
 = 0; i < 
l
.
¡•s
; ++i) {

222 
s
.
šput_gpu
 = 
Ãt
.input_gpu;

223 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
šput_Ïy”
, 
s
);

225 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

226 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
£lf_Ïy”
, 
s
);

228 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
¡©e_gpu
, 1);

229 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
šput_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

230 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

232 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

233 
	`fÜw¬d_cÚÃùed_Ïy”_gpu
(
ouut_Ïy”
, 
s
);

235 
Ãt
.
šput_gpu
 +ğ
l
.
šputs
*l.
b©ch
;

236 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 1);

237 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 1);

238 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 1);

240 
	}
}

242 
	$backw¬d_ºn_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

244 
ÃtwÜk
 
s
 = {0};

245 
s
.
Œaš
 = 
Ãt
.train;

246 
i
;

247 
Ïy”
 
šput_Ïy”
 = *(
l
.input_layer);

248 
Ïy”
 
£lf_Ïy”
 = *(
l
.self_layer);

249 
Ïy”
 
ouut_Ïy”
 = *(
l
.output_layer);

250 
	`šüem’t_Ïy”
(&
šput_Ïy”
, 
l
.
¡•s
 - 1);

251 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, 
l
.
¡•s
 - 1);

252 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, 
l
.
¡•s
 - 1);

253 *
Ï¡_šput
 = 
šput_Ïy”
.
ouut_gpu
;

254 *
Ï¡_£lf
 = 
£lf_Ïy”
.
ouut_gpu
;

255 
i
 = 
l
.
¡•s
-1; i >= 0; --i) {

256 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
¡©e_gpu
, 1);

257 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
šput_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

258 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut_gpu
, 1,†.
¡©e_gpu
, 1);

260 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

261 
s
.
d–_gpu
 = 
£lf_Ïy”
.delta_gpu;

262 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
ouut_Ïy”
, 
s
);

264 if(
i
 != 0) {

265 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
¡©e_gpu
, 1);

266 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
šput_Ïy”
.
ouut_gpu
 -†.ouuts*l.b©ch, 1,†.
¡©e_gpu
, 1);

267 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
£lf_Ïy”
.
ouut_gpu
 -†.ouuts*l.b©ch, 1,†.
¡©e_gpu
, 1);

269 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
´ev_¡©e_gpu
, 1,†.
¡©e_gpu
, 1);

272 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
£lf_Ïy”
.
d–_gpu
, 1, 
šput_Ïy”
.delta_gpu, 1);

274 
s
.
šput_gpu
 = 
l
.
¡©e_gpu
;

275 
s
.
d–_gpu
 = (
i
 > 0è? 
£lf_Ïy”
.d–_gpu - 
l
.
ouuts
*l.
b©ch
 : 0;

276 ià(
i
 =ğ0è
s
.
d–_gpu
 = 0;

277 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
£lf_Ïy”
, 
s
);

279 
s
.
šput_gpu
 = 
Ãt
.šput_gpu + 
i
*
l
.
šputs
*l.
b©ch
;

280 if(
Ãt
.
d–_gpu
è
s
.d–_gpu =‚‘.d–_gpu + 
i
*
l
.
šputs
*l.
b©ch
;

281 
s
.
d–_gpu
 = 0;

282 
	`backw¬d_cÚÃùed_Ïy”_gpu
(
šput_Ïy”
, 
s
);

284 
	`šüem’t_Ïy”
(&
šput_Ïy”
, -1);

285 
	`šüem’t_Ïy”
(&
£lf_Ïy”
, -1);

286 
	`šüem’t_Ïy”
(&
ouut_Ïy”
, -1);

288 
	`fl_gpu
(
l
.
ouuts
 *†.
b©ch
, 0,†.
¡©e_gpu
, 1);

289 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
Ï¡_šput
, 1,†.
¡©e_gpu
, 1);

290 
	`axpy_gpu
(
l
.
ouuts
 *†.
b©ch
, 1, 
Ï¡_£lf
, 1,†.
¡©e_gpu
, 1);

291 
	}
}

	@host/src/rnn_layer.h

2 #iâdeà
RNN_LAYER_H


3 
	#RNN_LAYER_H


	)

5 
	~"aùiv©iÚs.h
"

6 
	~"Ïy”.h
"

7 
	~"ÃtwÜk.h
"

8 
	#USET


	)

10 
Ïy”
 
make_ºn_Ïy”
(
b©ch
, 
šputs
, 
ouuts
, 
¡•s
, 
ACTIVATION
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

12 
fÜw¬d_ºn_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 
backw¬d_ºn_Ïy”
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

14 
upd©e_ºn_Ïy”
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

16 #ifdeà
GPU


17 
fÜw¬d_ºn_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

18 
backw¬d_ºn_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

19 
upd©e_ºn_Ïy”_gpu
(
Ïy”
 
l
, 
upd©e_¬gs
 
a
);

20 
push_ºn_Ïy”
(
Ïy”
 
l
);

21 
puÎ_ºn_Ïy”
(
Ïy”
 
l
);

	@host/src/route_layer.c

1 
	~"rou‹_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~"bÏs.h
"

5 
	~<¡dio.h
>

7 
rou‹_Ïy”
 
	$make_rou‹_Ïy”
(
b©ch
, 
n
, *
šput_Ïy”s
, *
šput_sizes
)

9 
	`årštf
(
¡d”r
,"route ");

10 
rou‹_Ïy”
 
l
 = {0};

11 
l
.
ty³
 = 
ROUTE
;

12 
l
.
b©ch
 = batch;

13 
l
.
n
 =‚;

14 
l
.
šput_Ïy”s
 = input_layers;

15 
l
.
šput_sizes
 = input_sizes;

16 
i
;

17 
ouuts
 = 0;

18 
i
 = 0; i < 
n
; ++i){

19 
	`årštf
(
¡d”r
," %d", 
šput_Ïy”s
[
i
]);

20 
ouuts
 +ğ
šput_sizes
[
i
];

22 
	`årštf
(
¡d”r
, "\n");

23 
l
.
ouuts
 = outputs;

24 
l
.
šputs
 = 
ouuts
;

25 
l
.
d–
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());

26 
l
.
ouut
 = 
	`ÿÎoc
(
ouuts
*
b©ch
, ());;

28 
l
.
fÜw¬d
 = 
fÜw¬d_rou‹_Ïy”
;

29 
l
.
backw¬d
 = 
backw¬d_rou‹_Ïy”
;

30 #ifdeà
GPU


31 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_rou‹_Ïy”_gpu
;

32 
l
.
backw¬d_gpu
 = 
backw¬d_rou‹_Ïy”_gpu
;

34 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
ouuts
*
b©ch
);

35 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
ouuts
*
b©ch
);

37  
l
;

38 
	}
}

40 
	$»size_rou‹_Ïy”
(
rou‹_Ïy”
 *
l
, 
ÃtwÜk
 *
Ãt
)

42 
i
;

43 
Ïy”
 
fœ¡
 = 
Ãt
->
Ïy”s
[
l
->
šput_Ïy”s
[0]];

44 
l
->
out_w
 = 
fœ¡
.out_w;

45 
l
->
out_h
 = 
fœ¡
.out_h;

46 
l
->
out_c
 = 
fœ¡
.out_c;

47 
l
->
ouuts
 = 
fœ¡
.outputs;

48 
l
->
šput_sizes
[0] = 
fœ¡
.
ouuts
;

49 
i
 = 1; i < 
l
->
n
; ++i){

50 
šdex
 = 
l
->
šput_Ïy”s
[
i
];

51 
Ïy”
 
Ãxt
 = 
Ãt
->
Ïy”s
[
šdex
];

52 
l
->
ouuts
 +ğ
Ãxt
.outputs;

53 
l
->
šput_sizes
[
i
] = 
Ãxt
.
ouuts
;

54 if(
Ãxt
.
out_w
 =ğ
fœ¡
.out_w &&‚ext.
out_h
 == first.out_h){

55 
l
->
out_c
 +ğ
Ãxt
.out_c;

57 
	`´štf
("%d %d, %d %d\n", 
Ãxt
.
out_w
,‚ext.
out_h
, 
fœ¡
.out_w, first.out_h);

58 
l
->
out_h
 =†->
out_w
 =†->
out_c
 = 0;

61 
l
->
šputs
 =†->
ouuts
;

62 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
ouuts
*l->
b©ch
*());

63 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
ouuts
*l->
b©ch
*());

65 #ifdeà
GPU


66 
	`cuda_ä“
(
l
->
ouut_gpu
);

67 
	`cuda_ä“
(
l
->
d–_gpu
);

68 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
ouuts
*l->
b©ch
);

69 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
ouuts
*l->
b©ch
);

72 
	}
}

74 
	$fÜw¬d_rou‹_Ïy”
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

76 
i
, 
j
;

77 
off£t
 = 0;

78 
i
 = 0; i < 
l
.
n
; ++i){

79 
šdex
 = 
l
.
šput_Ïy”s
[
i
];

80 *
šput
 = 
Ãt
.
Ïy”s
[
šdex
].
ouut
;

81 
šput_size
 = 
l
.
šput_sizes
[
i
];

82 
j
 = 0; j < 
l
.
b©ch
; ++j){

83 
	`cİy_ıu
(
šput_size
, 
šput
 + 
j
*šput_size, 1, 
l
.
ouut
 + 
off£t
 + j*l.
ouuts
, 1);

85 
off£t
 +ğ
šput_size
;

87 
	}
}

89 
	$backw¬d_rou‹_Ïy”
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

91 
i
, 
j
;

92 
off£t
 = 0;

93 
i
 = 0; i < 
l
.
n
; ++i){

94 
šdex
 = 
l
.
šput_Ïy”s
[
i
];

95 *
d–
 = 
Ãt
.
Ïy”s
[
šdex
].delta;

96 
šput_size
 = 
l
.
šput_sizes
[
i
];

97 
j
 = 0; j < 
l
.
b©ch
; ++j){

98 
	`axpy_ıu
(
šput_size
, 1, 
l
.
d–
 + 
off£t
 + 
j
*l.
ouuts
, 1, delta + j*input_size, 1);

100 
off£t
 +ğ
šput_size
;

102 
	}
}

104 #ifdeà
GPU


105 
	$fÜw¬d_rou‹_Ïy”_gpu
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

107 
i
, 
j
;

108 
off£t
 = 0;

109 
i
 = 0; i < 
l
.
n
; ++i){

110 
šdex
 = 
l
.
šput_Ïy”s
[
i
];

111 *
šput
 = 
Ãt
.
Ïy”s
[
šdex
].
ouut_gpu
;

112 
šput_size
 = 
l
.
šput_sizes
[
i
];

113 
j
 = 0; j < 
l
.
b©ch
; ++j){

114 
	`cİy_gpu
(
šput_size
, 
šput
 + 
j
*šput_size, 1, 
l
.
ouut_gpu
 + 
off£t
 + j*l.
ouuts
, 1);

116 
off£t
 +ğ
šput_size
;

118 
	}
}

120 
	$backw¬d_rou‹_Ïy”_gpu
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

122 
i
, 
j
;

123 
off£t
 = 0;

124 
i
 = 0; i < 
l
.
n
; ++i){

125 
šdex
 = 
l
.
šput_Ïy”s
[
i
];

126 *
d–
 = 
Ãt
.
Ïy”s
[
šdex
].
d–_gpu
;

127 
šput_size
 = 
l
.
šput_sizes
[
i
];

128 
j
 = 0; j < 
l
.
b©ch
; ++j){

129 
	`axpy_gpu
(
šput_size
, 1, 
l
.
d–_gpu
 + 
off£t
 + 
j
*l.
ouuts
, 1, 
d–
 + j*input_size, 1);

131 
off£t
 +ğ
šput_size
;

133 
	}
}

	@host/src/route_layer.h

1 #iâdeà
ROUTE_LAYER_H


2 
	#ROUTE_LAYER_H


	)

3 
	~"ÃtwÜk.h
"

4 
	~"Ïy”.h
"

6 
Ïy”
 
	trou‹_Ïy”
;

8 
rou‹_Ïy”
 
make_rou‹_Ïy”
(
b©ch
, 
n
, *
šput_Ïy”s
, *
šput_size
);

9 
fÜw¬d_rou‹_Ïy”
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 
backw¬d_rou‹_Ïy”
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
»size_rou‹_Ïy”
(
rou‹_Ïy”
 *
l
, 
ÃtwÜk
 *
Ãt
);

13 #ifdeà
GPU


14 
fÜw¬d_rou‹_Ïy”_gpu
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

15 
backw¬d_rou‹_Ïy”_gpu
(cÚ¡ 
rou‹_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/shortcut_layer.c

1 
	~"shÜtcut_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~"bÏs.h
"

4 
	~"aùiv©iÚs.h
"

6 
	~<¡dio.h
>

7 
	~<as£¹.h
>

9 
Ïy”
 
	$make_shÜtcut_Ïy”
(
b©ch
, 
šdex
, 
w
, 
h
, 
c
, 
w2
, 
h2
, 
c2
)

11 
	`årštf
(
¡d”r
, "»  %3d %4d x%4d x%4d -> %4d x%4d x%4d\n",
šdex
, 
w2
,
h2
,
c2
, 
w
,
h
,
c
);

12 
Ïy”
 
l
 = {0};

13 
l
.
ty³
 = 
SHORTCUT
;

14 
l
.
b©ch
 = batch;

15 
l
.
w
 = 
w2
;

16 
l
.
h
 = 
h2
;

17 
l
.
c
 = 
c2
;

18 
l
.
out_w
 = 
w
;

19 
l
.
out_h
 = 
h
;

20 
l
.
out_c
 = 
c
;

21 
l
.
ouuts
 = 
w
*
h
*
c
;

22 
l
.
šputs
 =†.
ouuts
;

24 
l
.
šdex
 = index;

26 
l
.
d–
 = 
	`ÿÎoc
Ö.
ouuts
*
b©ch
, ());

27 
l
.
ouut
 = 
	`ÿÎoc
Ö.
ouuts
*
b©ch
, ());;

29 
l
.
fÜw¬d
 = 
fÜw¬d_shÜtcut_Ïy”
;

30 
l
.
backw¬d
 = 
backw¬d_shÜtcut_Ïy”
;

31 #ifdeà
GPU


32 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_shÜtcut_Ïy”_gpu
;

33 
l
.
backw¬d_gpu
 = 
backw¬d_shÜtcut_Ïy”_gpu
;

35 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
,†.
ouuts
*
b©ch
);

36 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
ouuts
*
b©ch
);

38  
l
;

39 
	}
}

41 
	$»size_shÜtcut_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

43 
	`as£¹
(
l
->
w
 =ğl->
out_w
);

44 
	`as£¹
(
l
->
h
 =ğl->
out_h
);

45 
l
->
w
 =†->
out_w
 = w;

46 
l
->
h
 =†->
out_h
 = h;

47 
l
->
ouuts
 = 
w
*
h
*l->
out_c
;

48 
l
->
šputs
 =†->
ouuts
;

49 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
ouuts
*l->
b©ch
*());

50 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
ouuts
*l->
b©ch
*());

52 #ifdeà
GPU


53 
	`cuda_ä“
(
l
->
ouut_gpu
);

54 
	`cuda_ä“
(
l
->
d–_gpu
);

55 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
ouuts
*l->
b©ch
);

56 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
ouuts
*l->
b©ch
);

59 
	}
}

62 
	$fÜw¬d_shÜtcut_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

64 
	`cİy_ıu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput
, 1,†.
ouut
, 1);

65 
	`shÜtcut_ıu
(
l
.
b©ch
,†.
w
,†.
h
,†.
c
, 
Ãt
.
Ïy”s
[l.
šdex
].
ouut
,†.
out_w
,†.
out_h
,†.
out_c
,†.
®pha
,†.
b‘a
,†.output);

66 
	`aùiv©e_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

67 
	}
}

69 
	$backw¬d_shÜtcut_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

71 
	`g¿d›Á_¬¿y
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

72 
	`axpy_ıu
(
l
.
ouuts
*l.
b©ch
,†.
®pha
,†.
d–
, 1, 
Ãt
.delta, 1);

73 
	`shÜtcut_ıu
(
l
.
b©ch
,†.
out_w
,†.
out_h
,†.
out_c
,†.
d–
,†.
w
,†.
h
,†.
c
, 1,†.
b‘a
, 
Ãt
.
Ïy”s
[l.
šdex
].delta);

74 
	}
}

76 #ifdeà
GPU


77 
	$fÜw¬d_shÜtcut_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

79 
	`cİy_gpu
(
l
.
ouuts
*l.
b©ch
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

80 
	`shÜtcut_gpu
(
l
.
b©ch
,†.
w
,†.
h
,†.
c
, 
Ãt
.
Ïy”s
[l.
šdex
].
ouut_gpu
,†.
out_w
,†.
out_h
,†.
out_c
,†.
®pha
,†.
b‘a
,†.output_gpu);

81 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

82 
	}
}

84 
	$backw¬d_shÜtcut_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

86 
	`g¿d›Á_¬¿y_gpu
(
l
.
ouut_gpu
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–_gpu
);

87 
	`axpy_gpu
(
l
.
ouuts
*l.
b©ch
,†.
®pha
,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

88 
	`shÜtcut_gpu
(
l
.
b©ch
,†.
out_w
,†.
out_h
,†.
out_c
,†.
d–_gpu
,†.
w
,†.
h
,†.
c
, 1,†.
b‘a
, 
Ãt
.
Ïy”s
[l.
šdex
].delta_gpu);

89 
	}
}

	@host/src/shortcut_layer.h

1 #iâdeà
SHORTCUT_LAYER_H


2 
	#SHORTCUT_LAYER_H


	)

4 
	~"Ïy”.h
"

5 
	~"ÃtwÜk.h
"

7 
Ïy”
 
make_shÜtcut_Ïy”
(
b©ch
, 
šdex
, 
w
, 
h
, 
c
, 
w2
, 
h2
, 
c2
);

8 
fÜw¬d_shÜtcut_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

9 
backw¬d_shÜtcut_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 
»size_shÜtcut_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

12 #ifdeà
GPU


13 
fÜw¬d_shÜtcut_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

14 
backw¬d_shÜtcut_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/socket_client.c

4 
	~"sock‘_­i.h
"

5 
	~<sys/sock‘.h
>

8 
	#MAX
 4096

	)

11 
	$Sock‘C»©e_Cl›Á
()

13 
hSock‘
;

14 
	`´štf
("Createhe socket\n");

15 
hSock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

16  
hSock‘
;

17 
	}
}

20 
	$Sock‘CÚÃù
(
hSock‘
, 
pÜt
)

22 
iR‘v®
=-1;

24 
S”v”PÜt
 = 
pÜt
;

25 
sockaddr_š
 
»mÙe
= {0};

26 
»mÙe
.
sš_addr
.
s_addr
 = 
	`š‘_addr
("169.254.232.175");

27 
»mÙe
.
sš_çmy
 = 
AF_INET
;

28 
»mÙe
.
sš_pÜt
 = 
	`htÚs
(
S”v”PÜt
);

29 
iR‘v®
 = 
	`cÚÃù
(
hSock‘
,(
sockaddr
 *)&
»mÙe
,(
sockaddr_š
));

30  
iR‘v®
;

31 
	}
}

59 
boŞ
 
	$£ndd©a
(
sock
, *
buf
, 
buæ’
)

61 *
pbuf
 = (*)
buf
;

62 
tÙ®_by‹s_£Á
 = 0;

64 
buæ’
 > 0)

66 
num
 = 
	`£nd
(
sock
, 
pbuf
, 
buæ’
, 0);

67 ià(
num
 < 0)

74  
çl£
;

77 
pbuf
 +ğ
num
;

78 
buæ’
 -ğ
num
;

79 
tÙ®_by‹s_£Á
 +ğ
num
;

80 
	`´štf
("TÙ® By‹ S’ˆ: %d\n",
tÙ®_by‹s_£Á
);

82  
Œue
;

83 
	}
}

85 
boŞ
 
	$£ndlÚg
(
sock
, 
v®ue
)

87 
v®ue
 = 
	`htÚl
(value);

88  
	`£ndd©a
(
sock
, &
v®ue
, (value));

89 
	}
}

91 
boŞ
 
	$£ndfe
(
sock
, 
FILE
 *
f
)

93 
	`f£ek
(
f
, 0, 
SEEK_END
);

94 
fesize
 = 
	`á–l
(
f
);

95 
	`»wšd
(
f
);

96 ià(
fesize
 =ğ
EOF
)

97  
çl£
;

98 ià(!
	`£ndlÚg
(
sock
, 
fesize
))

99  
çl£
;

100 ià(
fesize
 > 0)

102 
bufãr
[
MAX
];

105 
size_t
 
num
 = 
	`mš
(
fesize
, (
bufãr
));

106 
num
 = 
	`ä—d
(
bufãr
, 1,‚um, 
f
);

107 ià(
num
 < 1)

108  
çl£
;

109 ià(!
	`£ndd©a
(
sock
, 
bufãr
, 
num
))

110  
çl£
;

111 
fesize
 -ğ
num
;

113 
fesize
 > 0);

115  
Œue
;

116 
	}
}

118 
	$Sock‘_Cl›Á
(*
f’ame
, *
f’ame1
, 
pÜt
, 
mode
)

120 
hSock‘
;

126 if(
f’ame
 =ğ
NULL
 || ((
mode
 =ğ0è&& (
f’ame1
 == NULL)))

128 
	`´štf
("\nIncorrect filename\n\n");

133 
FILE
 *
å
;

134 
å
 = 
	`fİ’
(
f’ame
,"rb");

135 ifĞ
å
 =ğ
NULL
 )

137 
	`´štf
("Error IN Opening File .. \n");

141 
FILE
 *
å1
;

142 if(
mode
 == 0)

145 
å1
 = 
	`fİ’
(
f’ame1
,"rb");

146 ifĞ
å1
 =ğ
NULL
 )

148 
	`´štf
("Error IN Opening File .. \n");

153 
hSock‘
 = 
	`Sock‘C»©e_Cl›Á
();

154 if(
hSock‘
 == -1)

156 
	`´štf
("Could‚ot create socket\n");

159 
	`´štf
("Socket is created\n");

161 
»u£
 = 1;

162 ià(
	`£tsockİt
(
hSock‘
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (cÚ¡ *)&
»u£
, (reuse)) < 0)

163 
	`³¼Ü
("setsockopt(SO_REUSEADDR) failed");

165 ià(
	`£tsockİt
(
hSock‘
, 
SOL_SOCKET
, 
SO_REUSEPORT
, (cÚ¡ *)&
»u£
, (reuse)) < 0)

166 
	`³¼Ü
("setsockopt(SO_REUSEPORT) failed");

177 ià(
	`Sock‘CÚÃù
(
hSock‘
, 
pÜt
) < 0)

179 
	`³¼Ü
("connect failed.\n");

182 
	`´štf
("Sucessfully conected with server\n");

187 if(
	`£ndfe
(
hSock‘
, 
å
è=ğ
çl£
)

189 
	`´štf
("File Send failed\n");

193 if(
mode
 == 0)

196 if(
	`£ndfe
(
hSock‘
, 
å1
è=ğ
çl£
)

198 
	`´štf
("File Send failed\n");

204 
	`şo£
(
hSock‘
);

205 
	`shutdown
(
hSock‘
,0);

206 
	`shutdown
(
hSock‘
,1);

207 
	`shutdown
(
hSock‘
,2);

208 
	`fşo£
 (
å
);

209 if(
mode
 == 0)

211 
	`fşo£
 (
å1
);

213 
	`¦“p
(1);

215 
	}
}

	@host/src/socket_server.c

3 
	~"sock‘_­i.h
"

4 
	~<sys/sock‘.h
>

6 
	$Sock‘C»©e
()

8 
hSock‘
;

9 
	`´štf
("Createhe socket\n");

10 
hSock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0);

11  
hSock‘
;

12 
	}
}

14 
	$BšdC»©edSock‘
(
hSock‘
, 
pÜt
)

16 
iR‘v®
=-1;

18 
Cl›ÁPÜt
 = 
pÜt
;

19 
sockaddr_š
 
»mÙe
= {0};

21 
»mÙe
.
sš_çmy
 = 
AF_INET
;

23 
»mÙe
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

25 
»mÙe
.
sš_çmy
 = 
AF_INET
;

26 
»mÙe
.
sš_pÜt
 = 
	`htÚs
(
Cl›ÁPÜt
);

27 
iR‘v®
 = 
	`bšd
(
hSock‘
,(
sockaddr
 *)&
»mÙe
,(remote));

28  
iR‘v®
;

29 
	}
}

31 
boŞ
 
	$»add©a
(
sock
, *
buf
, 
buæ’
)

33 *
pbuf
 = (*è
buf
;

34 
tÙ®_by‹s_rcvd
 = 0;

36 
buæ’
 > 0)

38 
num
 = 
	`»cv
(
sock
, 
pbuf
, 
buæ’
, 0);

48 ià(
num
 <= 0)

49  
çl£
;

51 
pbuf
 +ğ
num
;

52 
buæ’
 -ğ
num
;

53 
tÙ®_by‹s_rcvd
 +ğ
num
;

54 
	`´štf
("TÙ® By‹ Reûived : %d\n",
tÙ®_by‹s_rcvd
);

57  
Œue
;

58 
	}
}

60 
boŞ
 
	$»adlÚg
(
sock
, *
v®ue
)

62 ià(!
	`»add©a
(
sock
, 
v®ue
, (value)))

63  
çl£
;

64 *
v®ue
 = 
	`Áohl
(*value);

65  
Œue
;

66 
	}
}

68 
boŞ
 
	$»adfe
(
sock
, 
FILE
 *
f
, FILE *
f1
)

70 
fesize
;

71 ià(!
	`»adlÚg
(
sock
, &
fesize
))

72  
çl£
;

73 ià(
fesize
 > 0)

75 
bufãr
[1024];

77 
	`´štf
("Fesizğ%ld\n",
fesize
);

79 
	`årštf
(
f1
, "%ld",
fesize
);

82 
num
 = 
	`mš
(
fesize
, (
bufãr
));

83 ià(!
	`»add©a
(
sock
, 
bufãr
, 
num
))

84  
çl£
;

85 
off£t
 = 0;

88 
size_t
 
wr™‹n
 = 
	`fwr™e
(&
bufãr
[
off£t
], 1, 
num
-off£t, 
f
);

89 ià(
wr™‹n
 < 1)

90  
çl£
;

91 
off£t
 +ğ
wr™‹n
;

93 
off£t
 < 
num
);

94 
fesize
 -ğ
num
;

96 
fesize
 > 0);

98  
Œue
;

99 
	}
}

101 
	$Sock‘_S”v”
(*
f’ame
, *
fesize
, *
g
, *
g_size
, 
şock_t
 *
time
, 
pÜt
, 
mode
)

103 
sock‘_desc
, 
sock
, 
ş›ÁL’
, 
»ad_size
;

104 
sockaddr_š
 
£rv”
, 
ş›Á
;

105 
couÁ
 = 0;

111 if(
f’ame
 =ğ
NULL
 || 
fesize
 =ğNULL || ((
mode
 =ğ0è&& (
g
 =ğNULL || 
g_size
 == NULL)))

113 
	`´štf
("Invalid filename\n");

118 
sock‘_desc
 = 
	`Sock‘C»©e
();

119 ià(
sock‘_desc
 == -1)

121 
	`´štf
("Could‚ot create socket");

124 
	`´štf
("Socket created\n");

126 
»u£
 = 1;

127 ià(
	`£tsockİt
(
sock‘_desc
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (cÚ¡ *)&
»u£
, (reuse)) < 0)

128 
	`³¼Ü
("setsockopt(SO_REUSEADDR) failed");

130 ià(
	`£tsockİt
(
sock‘_desc
, 
SOL_SOCKET
, 
SO_REUSEPORT
, (cÚ¡ *)&
»u£
, (reuse)) < 0)

131 
	`³¼Ü
("setsockopt(SO_REUSEPORT) failed");

142 ifĞ
	`BšdC»©edSock‘
(
sock‘_desc
, 
pÜt
) < 0)

145 
	`³¼Ü
("bind failed.");

148 
	`´štf
("bind done\n");

150 if(
	`li¡’
(
sock‘_desc
, 5) != 0)

153 
	`³¼Ü
("listen failed");

159 
	`´štf
("Waiting for incoming connections...\n");

160 
ş›ÁL’
 = (
sockaddr_š
);

162 
sock
 = 
	`acû±
(
sock‘_desc
,(
sockaddr
 *)&
ş›Á
,(
sockËn_t
*)&
ş›ÁL’
);

163 ià(
sock
 < 0)

165 
	`³¼Ü
("accept failed");

168 
	`´štf
("Connection‡ccepted\n");

170 if(
mode
 == 0)

172 
FILE
 *
å
;

173 
FILE
 *
å1
;

174 
FILE
 *
å2
;

175 
FILE
 *
å3
;

176 
å
 = 
	`fİ’
(
f’ame
, "wb");

177 
å1
 = 
	`fİ’
(
fesize
, "wb");

178 
å2
 = 
	`fİ’
(
g
, "wb");

179 
å3
 = 
	`fİ’
(
g_size
, "wb");

180 *
time
 = 
	`şock
();

181 if(
å
 =ğ
NULL
 || 
å1
 =ğNULL || 
å2
 =ğNULL || 
å3
 == NULL)

183 
	`´štf
("ERROR, could‚ot open file\n");

187 if(
	`»adfe
(
sock
, 
å
, 
å1
è=ğ
çl£
)

189 
	`´štf
("ERROR, could‚ot„eadhe data\n");

193 if(
	`»adfe
(
sock
, 
å2
, 
å3
è=ğ
çl£
)

195 
	`´štf
("ERROR, could‚ot„eadhe data\n");

199 
	`şo£
(
sock
);

200 
	`fşo£
(
å
);

201 
	`fşo£
(
å1
);

202 
	`fşo£
(
å2
);

203 
	`fşo£
(
å3
);

204 
	`¦“p
(1);

208 
FILE
 *
å
;

209 
FILE
 *
å1
;

210 
å
 = 
	`fİ’
(
f’ame
, "wb");

211 
å1
 = 
	`fİ’
(
fesize
, "wb");

212 if(
å
 =ğ
NULL
 || 
å1
 == NULL)

214 
	`´štf
("ERROR, could‚ot open file\n");

217 if(
	`»adfe
(
sock
, 
å
, 
å1
è=ğ
çl£
)

219 
	`´štf
("ERROR, could‚ot„eadhe data\n");

223 
	`şo£
(
sock
);

224 
	`fşo£
(
å
);

225 
	`fşo£
(
å1
);

226 
	`¦“p
(1);

231 
	}
}

	@host/src/softmax_layer.c

1 
	~"soámax_Ïy”.h
"

2 
	~"bÏs.h
"

3 
	~"cuda.h
"

4 
	~"·r£r.h
"

6 
	~<æßt.h
>

7 
	~<m©h.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dio.h
>

10 
	~<as£¹.h
>

12 
soámax_Ïy”
 
	$make_soámax_Ïy”
(
b©ch
, 
šputs
, 
groups
)

14 
	`as£¹
(
šputs
%
groups
 == 0);

18 
	`årštf
(
¡d”r
, "soámax %4d\n", 
šputs
);

20 
	`årštf
(
¡d”r
, "soámax_TA %4d\n", 
šputs
);

22 
soámax_Ïy”
 
l
 = {0};

23 
l
.
ty³
 = 
SOFTMAX
;

24 
l
.
b©ch
 = batch;

25 
l
.
groups
 = groups;

26 
l
.
šputs
 = inputs;

27 
l
.
ouuts
 = 
šputs
;

28 
l
.
loss
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

29 
l
.
ouut
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

30 
l
.
d–
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

31 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

33 
l
.
fÜw¬d
 = 
fÜw¬d_soámax_Ïy”
;

34 
l
.
backw¬d
 = 
backw¬d_soámax_Ïy”
;

35 #ifdeà
GPU


36 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_soámax_Ïy”_gpu
;

37 
l
.
backw¬d_gpu
 = 
backw¬d_soámax_Ïy”_gpu
;

39 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
šputs
*
b©ch
);

40 
l
.
loss_gpu
 = 
	`cuda_make_¬¿y
Ö.
loss
, 
šputs
*
b©ch
);

41 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
šputs
*
b©ch
);

43  
l
;

44 
	}
}

46 
	$fÜw¬d_soámax_Ïy”
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

48 if(
l
.
soámax_Œ“
){

49 
i
;

50 
couÁ
 = 0;

51 
i
 = 0; i < 
l
.
soámax_Œ“
->
groups
; ++i) {

52 
group_size
 = 
l
.
soámax_Œ“
->group_size[
i
];

53 
	`soámax_ıu
(
Ãt
.
šput
 + 
couÁ
, 
group_size
, 
l
.
b©ch
,†.
šputs
, 1, 0, 1,†.
‹m³¿tu»
,†.
ouut
 + count);

54 
couÁ
 +ğ
group_size
;

57 
	`soámax_ıu
(
Ãt
.
šput
, 
l
.
šputs
/l.
groups
,†.
b©ch
,†.šputs,†.groups,†.šputs/l.groups, 1,†.
‹m³¿tu»
,†.
ouut
);

60 if(
Ãt
.
Œuth
 && !
l
.
nŞoss
){

61 
	`soámax_x_’t_ıu
(
l
.
b©ch
*l.
šputs
,†.
ouut
, 
Ãt
.
Œuth
,†.
d–
,†.
loss
);

62 
l
.
co¡
[0] = 
	`sum_¬¿y
Ö.
loss
,†.
b©ch
*l.
šputs
);

64 
	}
}

66 
	$backw¬d_soámax_Ïy”
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

68 
	`axpy_ıu
(
l
.
šputs
*l.
b©ch
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

69 
	}
}

71 #ifdeà
GPU


73 
	$puÎ_soámax_Ïy”_ouut
(cÚ¡ 
soámax_Ïy”
 
Ïy”
)

75 
	`cuda_puÎ_¬¿y
(
Ïy”
.
ouut_gpu
,†ay”.
ouut
,†ay”.
šputs
*Ïy”.
b©ch
);

76 
	}
}

78 
	$fÜw¬d_soámax_Ïy”_gpu
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

80 if(
l
.
soámax_Œ“
){

81 
	`soámax_Œ“
(
Ãt
.
šput_gpu
, 1, 
l
.
b©ch
,†.
šputs
,†.
‹m³¿tu»
,†.
ouut_gpu
, *l.
soámax_Œ“
);

92 if(
l
.
¥©Ÿl
){

93 
	`soámax_gpu
(
Ãt
.
šput_gpu
, 
l
.
c
,†.
b©ch
*l.c,†.
šputs
/l.c,†.
w
*l.
h
, 1,†.w*l.h, 1,†.
ouut_gpu
);

95 
	`soámax_gpu
(
Ãt
.
šput_gpu
, 
l
.
šputs
/l.
groups
,†.
b©ch
,†.šputs,†.groups,†.šputs/l.groups, 1,†.
‹m³¿tu»
,†.
ouut_gpu
);

98 if(
Ãt
.
Œuth
 && !
l
.
nŞoss
){

99 
	`soámax_x_’t_gpu
(
l
.
b©ch
*l.
šputs
,†.
ouut_gpu
, 
Ãt
.
Œuth_gpu
,†.
d–_gpu
,†.
loss_gpu
);

100 if(
l
.
soámax_Œ“
){

101 
	`mask_gpu
(
l
.
b©ch
*l.
šputs
,†.
d–_gpu
, 
SECRET_NUM
, 
Ãt
.
Œuth_gpu
, 0);

102 
	`mask_gpu
(
l
.
b©ch
*l.
šputs
,†.
loss_gpu
, 
SECRET_NUM
, 
Ãt
.
Œuth_gpu
, 0);

104 
	`cuda_puÎ_¬¿y
(
l
.
loss_gpu
,†.
loss
,†.
b©ch
*l.
šputs
);

105 
l
.
co¡
[0] = 
	`sum_¬¿y
Ö.
loss
,†.
b©ch
*l.
šputs
);

107 
	}
}

109 
	$backw¬d_soámax_Ïy”_gpu
(cÚ¡ 
soámax_Ïy”
 
Ïy”
, 
ÃtwÜk
 
Ãt
)

111 
	`axpy_gpu
(
Ïy”
.
b©ch
*Ïy”.
šputs
, 1,†ay”.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

112 
	}
}

	@host/src/softmax_layer.h

1 #iâdeà
SOFTMAX_LAYER_H


2 
	#SOFTMAX_LAYER_H


	)

3 
	~"Ïy”.h
"

4 
	~"ÃtwÜk.h
"

6 
Ïy”
 
	tsoámax_Ïy”
;

8 
soámax_¬¿y
(*
šput
, 
n
, 
‹mp
, *
ouut
);

9 
soámax_Ïy”
 
make_soámax_Ïy”
(
b©ch
, 
šputs
, 
groups
);

10 
fÜw¬d_soámax_Ïy”
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
backw¬d_soámax_Ïy”
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

13 #ifdeà
GPU


14 
puÎ_soámax_Ïy”_ouut
(cÚ¡ 
soámax_Ïy”
 
l
);

15 
fÜw¬d_soámax_Ïy”_gpu
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_soámax_Ïy”_gpu
(cÚ¡ 
soámax_Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/stb_image.h

106 #iâdeà
STBI_INCLUDE_STB_IMAGE_H


107 
	#STBI_INCLUDE_STB_IMAGE_H


	)

306 #iâdeà
STBI_NO_STDIO


307 
	~<¡dio.h
>

310 
	#STBI_VERSION
 1

	)

314 
	mSTBI_deçuÉ
 = 0,

316 
	mSTBI_g»y
 = 1,

317 
	mSTBI_g»y_®pha
 = 2,

318 
	mSTBI_rgb
 = 3,

319 
	mSTBI_rgb_®pha
 = 4

322 
	t¡bi_uc
;

323 
	t¡bi_us
;

325 #ifdeà
__ılu¥lus


329 #ifdeà
STB_IMAGE_STATIC


330 
	#STBIDEF
 

	)

332 
	#STBIDEF
 

	)

346 (*
»ad
è(*
u£r
,*
d©a
,
size
);

347 (*
sk
è(*
u£r
,
n
);

348 (*
eof
è(*
u£r
);

349 } 
	t¡bi_io_ÿÎbacks
;

356 
STBIDEF
 
¡bi_uc
 *
¡bi_lßd_äom_memÜy
 (¡bi_uøcÚ¡ *
bufãr
, 
Ën
 , *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

357 
STBIDEF
 
¡bi_uc
 *
¡bi_lßd_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
 , *
u£r
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

358 #iâdeà
STBI_NO_GIF


359 
STBIDEF
 
¡bi_uc
 *
¡bi_lßd_gif_äom_memÜy
(¡bi_uøcÚ¡ *
bufãr
, 
Ën
, **
d–ays
, *
x
, *
y
, *
z
, *
comp
, 
»q_comp
);

363 #iâdeà
STBI_NO_STDIO


364 
STBIDEF
 
¡bi_uc
 *
¡bi_lßd
 (cÚ¡ *
f’ame
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

365 
STBIDEF
 
¡bi_uc
 *
¡bi_lßd_äom_fe
 (
FILE
 *
f
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

374 
STBIDEF
 
¡bi_us
 *
¡bi_lßd_16_äom_memÜy
 (
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

375 
STBIDEF
 
¡bi_us
 *
¡bi_lßd_16_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

377 #iâdeà
STBI_NO_STDIO


378 
STBIDEF
 
¡bi_us
 *
¡bi_lßd_16
 (cÚ¡ *
f’ame
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

379 
STBIDEF
 
¡bi_us
 *
¡bi_lßd_äom_fe_16
(
FILE
 *
f
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

386 #iâdeà
STBI_NO_LINEAR


387 
STBIDEF
 *
¡bi_lßdf_äom_memÜy
 (
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

388 
STBIDEF
 *
¡bi_lßdf_äom_ÿÎbacks
 (
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

390 #iâdeà
STBI_NO_STDIO


391 
STBIDEF
 *
¡bi_lßdf
 (cÚ¡ *
f’ame
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

392 
STBIDEF
 *
¡bi_lßdf_äom_fe
 (
FILE
 *
f
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
);

396 #iâdeà
STBI_NO_HDR


397 
STBIDEF
 
¡bi_hdr_to_ldr_gamma
(
gamma
);

398 
STBIDEF
 
¡bi_hdr_to_ldr_sÿË
(
sÿË
);

401 #iâdeà
STBI_NO_LINEAR


402 
STBIDEF
 
¡bi_ldr_to_hdr_gamma
(
gamma
);

403 
STBIDEF
 
¡bi_ldr_to_hdr_sÿË
(
sÿË
);

407 
STBIDEF
 
¡bi_is_hdr_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
);

408 
STBIDEF
 
¡bi_is_hdr_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
);

409 #iâdeà
STBI_NO_STDIO


410 
STBIDEF
 
¡bi_is_hdr
 (cÚ¡ *
f’ame
);

411 
STBIDEF
 
¡bi_is_hdr_äom_fe
(
FILE
 *
f
);

417 
STBIDEF
 cÚ¡ *
¡bi_çu»_»asÚ
 ();

420 
STBIDEF
 
¡bi_image_ä“
 (*
»tv®_äom_¡bi_lßd
);

423 
STBIDEF
 
¡bi_šfo_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
comp
);

424 
STBIDEF
 
¡bi_šfo_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
, *
x
, *
y
, *
comp
);

425 
STBIDEF
 
¡bi_is_16_b™_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
);

426 
STBIDEF
 
¡bi_is_16_b™_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
);

428 #iâdeà
STBI_NO_STDIO


429 
STBIDEF
 
¡bi_šfo
 (cÚ¡ *
f’ame
, *
x
, *
y
, *
comp
);

430 
STBIDEF
 
¡bi_šfo_äom_fe
 (
FILE
 *
f
, *
x
, *
y
, *
comp
);

431 
STBIDEF
 
¡bi_is_16_b™
 (cÚ¡ *
f’ame
);

432 
STBIDEF
 
¡bi_is_16_b™_äom_fe
(
FILE
 *
f
);

440 
STBIDEF
 
¡bi_£t_uÅ»muÉly_Ú_lßd
(
æag_Œue_if_should_uÅ»muÉly
);

444 
STBIDEF
 
¡bi_cÚv”t_hÚe_²g_to_rgb
(
æag_Œue_if_should_cÚv”t
);

447 
STBIDEF
 
¡bi_£t_æ_v”tiÿÎy_Ú_lßd
(
æag_Œue_if_should_æ
);

451 
STBIDEF
 *
¡bi_zlib_decode_m®loc_guesssize
(cÚ¡ *
bufãr
, 
Ën
, 
š™Ÿl_size
, *
ou’
);

452 
STBIDEF
 *
¡bi_zlib_decode_m®loc_guesssize_h—d”æag
(cÚ¡ *
bufãr
, 
Ën
, 
š™Ÿl_size
, *
ou’
, 
·r£_h—d”
);

453 
STBIDEF
 *
¡bi_zlib_decode_m®loc
(cÚ¡ *
bufãr
, 
Ën
, *
ou’
);

454 
STBIDEF
 
¡bi_zlib_decode_bufãr
(*
obufãr
, 
Ş’
, cÚ¡ *
ibufãr
, 
’
);

456 
STBIDEF
 *
¡bi_zlib_decode_noh—d”_m®loc
(cÚ¡ *
bufãr
, 
Ën
, *
ou’
);

457 
STBIDEF
 
¡bi_zlib_decode_noh—d”_bufãr
(*
obufãr
, 
Ş’
, cÚ¡ *
ibufãr
, 
’
);

460 #ifdeà
__ılu¥lus


469 #ifdeà
STB_IMAGE_IMPLEMENTATION


471 #ià
defšed
(
STBI_ONLY_JPEG
è|| defšed(
STBI_ONLY_PNG
è|| defšed(
STBI_ONLY_BMP
) \

472 || 
defšed
(
STBI_ONLY_TGA
è|| defšed(
STBI_ONLY_GIF
è|| defšed(
STBI_ONLY_PSD
) \

473 || 
defšed
(
STBI_ONLY_HDR
è|| defšed(
STBI_ONLY_PIC
è|| defšed(
STBI_ONLY_PNM
) \

474 || 
	$defšed
(
STBI_ONLY_ZLIB
)

475 #iâdeà
STBI_ONLY_JPEG


476 
	#STBI_NO_JPEG


	)

478 #iâdeà
STBI_ONLY_PNG


479 
	#STBI_NO_PNG


	)

481 #iâdeà
STBI_ONLY_BMP


482 
	#STBI_NO_BMP


	)

484 #iâdeà
STBI_ONLY_PSD


485 
	#STBI_NO_PSD


	)

487 #iâdeà
STBI_ONLY_TGA


488 
	#STBI_NO_TGA


	)

490 #iâdeà
STBI_ONLY_GIF


491 
	#STBI_NO_GIF


	)

493 #iâdeà
STBI_ONLY_HDR


494 
	#STBI_NO_HDR


	)

496 #iâdeà
STBI_ONLY_PIC


497 
	#STBI_NO_PIC


	)

499 #iâdeà
STBI_ONLY_PNM


500 
	#STBI_NO_PNM


	)

504 #ià
	`defšed
(
STBI_NO_PNG
è&& !defšed(
STBI_SUPPORT_ZLIB
è&& !defšed(
STBI_NO_ZLIB
)

505 
	#STBI_NO_ZLIB


	)

509 
	~<¡d¬g.h
>

510 
	~<¡ddef.h
>

511 
	~<¡dlib.h
>

512 
	~<¡ršg.h
>

513 
	~<lim™s.h
>

515 #ià!
	`defšed
(
STBI_NO_LINEAR
è|| !defšed(
STBI_NO_HDR
)

516 
	~<m©h.h
>

519 #iâdeà
STBI_NO_STDIO


520 
	~<¡dio.h
>

523 #iâdeà
STBI_ASSERT


524 
	~<as£¹.h
>

525 
	#STBI_ASSERT
(
x
è
	`as£¹
(x)

	)

529 #iâdeà
_MSC_VER


530 #ifdeà
__ılu¥lus


531 
	#¡bi_šlše
 
šlše


	)

533 
	#¡bi_šlše


	)

536 
	#¡bi_šlše
 
__fÜûšlše


	)

540 #ifdeà
_MSC_VER


541 
	t¡bi__ušt16
;

542 sigÃd 
	t¡bi__št16
;

543 
	t¡bi__ušt32
;

544 sigÃd 
	t¡bi__št32
;

546 
	~<¡dšt.h
>

547 
ušt16_t
 
	t¡bi__ušt16
;

548 
št16_t
 
	t¡bi__št16
;

549 
ušt32_t
 
	t¡bi__ušt32
;

550 
št32_t
 
	t¡bi__št32
;

554 
	tv®id©e_ušt32
[(
¡bi__ušt32
)==4 ? 1 : -1];

556 #ifdeà
_MSC_VER


557 
	#STBI_NOTUSED
(
v
è()(v)

	)

559 
	#STBI_NOTUSED
(
v
è()(v)

	)

562 #ifdeà
_MSC_VER


563 
	#STBI_HAS_LROTL


	)

566 #ifdeà
STBI_HAS_LROTL


567 
	#¡bi_ÌÙ
(
x
,
y
è
	`_ÌÙl
(x,y)

	)

569 
	#¡bi_ÌÙ
(
x
,
y
è(((xè<< (y)è| ((xè>> (32 - (y))))

	)

572 #ià
	`defšed
(
STBI_MALLOC
è&& defšed(
STBI_FREE
è&& (defšed(
STBI_REALLOC
è|| defšed(
STBI_REALLOC_SIZED
))

574 #–ià!
	`defšed
(
STBI_MALLOC
è&& !defšed(
STBI_FREE
è&& !defšed(
STBI_REALLOC
è&& !defšed(
STBI_REALLOC_SIZED
)

580 #iâdeà
STBI_MALLOC


581 
	#STBI_MALLOC
(
sz
è
	`m®loc
(sz)

	)

582 
	#STBI_REALLOC
(
p
,
Ãwsz
è
	`»®loc
Õ,Ãwsz)

	)

583 
	#STBI_FREE
(
p
è
	`ä“
Õ)

	)

586 #iâdeà
STBI_REALLOC_SIZED


587 
	#STBI_REALLOC_SIZED
(
p
,
Şdsz
,
Ãwsz
è
	`STBI_REALLOC
Õ,Ãwsz)

	)

591 #ià
	`defšed
(
__x86_64__
è|| defšed(
_M_X64
)

592 
	#STBI__X64_TARGET


	)

593 #–ià
	`defšed
(
__i386
è|| defšed(
_M_IX86
)

594 
	#STBI__X86_TARGET


	)

597 #ià
	`defšed
(
__GNUC__
è&& defšed(
STBI__X86_TARGET
è&& !defšed(
__SSE2__
è&& !defšed(
STBI_NO_SIMD
)

605 
	#STBI_NO_SIMD


	)

608 #ià
	`defšed
(
__MINGW32__
è&& defšed(
STBI__X86_TARGET
è&& !defšed(
STBI_MINGW_ENABLE_SSE2
è&& !defšed(
STBI_NO_SIMD
)

620 
	#STBI_NO_SIMD


	)

623 #ià!
	`defšed
(
STBI_NO_SIMD
è&& (defšed(
STBI__X86_TARGET
è|| defšed(
STBI__X64_TARGET
))

624 
	#STBI_SSE2


	)

625 
	~<emmšŒš.h
>

627 #ifdeà
_MSC_VER


629 #ià
_MSC_VER
 >= 1400

630 
	~<šŒš.h
>

631 
	$¡bi__ıuid3
()

633 
šfo
[4];

634 
	`__ıuid
(
šfo
,1);

635  
šfo
[3];

636 
	}
}

638 
	$¡bi__ıuid3
()

640 
»s
;

641 
__asm
 {

642 
mov
 
—x
,1

643 
ıuid


644 
mov
 
»s
,
edx


646  
»s
;

647 
	}
}

650 
	#STBI_SIMD_ALIGN
(
ty³
, 
Çme
è
	`__deş¥ec
(
	`®ign
(16)èty³ 
	)
name

652 
	$¡bi__s£2_avaabË
()

654 
šfo3
 = 
	`¡bi__ıuid3
();

655  ((
šfo3
 >> 26) & 1) != 0;

656 
	}
}

658 
	#STBI_SIMD_ALIGN
(
ty³
, 
Çme
èty³‚am
	`__©Œibu‹__
((
	`®igÃd
(16)))

	)

660 
	$¡bi__s£2_avaabË
()

666 
	}
}

671 #ià
defšed
(
STBI_NO_SIMD
è&& defšed(
STBI_NEON
)

672 #undeà
STBI_NEON


675 #ifdeà
STBI_NEON


676 
	~<¬m_ÃÚ.h
>

678 
	#STBI_SIMD_ALIGN
(
ty³
, 
Çme
èty³‚am
	`__©Œibu‹__
((
	`®igÃd
(16)))

	)

681 #iâdeà
STBI_SIMD_ALIGN


682 
	#STBI_SIMD_ALIGN
(
ty³
, 
Çme
èty³ 
	)
name

693 
¡bi__ušt32
 
	mimg_x
, 
	mimg_y
;

694 
	mimg_n
, 
	mimg_out_n
;

696 
¡bi_io_ÿÎbacks
 
	mio
;

697 *
	mio_u£r_d©a
;

699 
	m»ad_äom_ÿÎbacks
;

700 
	mbuæ’
;

701 
¡bi_uc
 
	mbufãr_¡¬t
[128];

703 
¡bi_uc
 *
	mimg_bufãr
, *
	mimg_bufãr_’d
;

704 
¡bi_uc
 *
	mimg_bufãr_Üigš®
, *
	mimg_bufãr_Üigš®_’d
;

705 } 
	t¡bi__cÚ‹xt
;

708 
¡bi__»fl_bufãr
(
¡bi__cÚ‹xt
 *
s
);

711 
	$¡bi__¡¬t_mem
(
¡bi__cÚ‹xt
 *
s
, 
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
)

713 
s
->
io
.
»ad
 = 
NULL
;

714 
s
->
»ad_äom_ÿÎbacks
 = 0;

715 
s
->
img_bufãr
 = s->
img_bufãr_Üigš®
 = (
¡bi_uc
 *è
bufãr
;

716 
s
->
img_bufãr_’d
 = s->
img_bufãr_Üigš®_’d
 = (
¡bi_uc
 *è
bufãr
+
Ën
;

717 
	}
}

720 
	$¡bi__¡¬t_ÿÎbacks
(
¡bi__cÚ‹xt
 *
s
, 
¡bi_io_ÿÎbacks
 *
c
, *
u£r
)

722 
s
->
io
 = *
c
;

723 
s
->
io_u£r_d©a
 = 
u£r
;

724 
s
->
buæ’
 = (s->
bufãr_¡¬t
);

725 
s
->
»ad_äom_ÿÎbacks
 = 1;

726 
s
->
img_bufãr_Üigš®
 = s->
bufãr_¡¬t
;

727 
	`¡bi__»fl_bufãr
(
s
);

728 
s
->
img_bufãr_Üigš®_’d
 = s->
img_bufãr_’d
;

729 
	}
}

731 #iâdeà
STBI_NO_STDIO


733 
	$¡bi__¡dio_»ad
(*
u£r
, *
d©a
, 
size
)

735  (è
	`ä—d
(
d©a
,1,
size
,(
FILE
*è
u£r
);

736 
	}
}

738 
	$¡bi__¡dio_sk
(*
u£r
, 
n
)

740 
	`f£ek
((
FILE
*è
u£r
, 
n
, 
SEEK_CUR
);

741 
	}
}

743 
	$¡bi__¡dio_eof
(*
u£r
)

745  
	`ãof
((
FILE
*è
u£r
);

746 
	}
}

748 
¡bi_io_ÿÎbacks
 
	g¡bi__¡dio_ÿÎbacks
 =

750 
¡bi__¡dio_»ad
,

751 
¡bi__¡dio_sk
,

752 
¡bi__¡dio_eof
,

755 
	$¡bi__¡¬t_fe
(
¡bi__cÚ‹xt
 *
s
, 
FILE
 *
f
)

757 
	`¡bi__¡¬t_ÿÎbacks
(
s
, &
¡bi__¡dio_ÿÎbacks
, (*è
f
);

758 
	}
}

764 
	$¡bi__»wšd
(
¡bi__cÚ‹xt
 *
s
)

769 
s
->
img_bufãr
 = s->
img_bufãr_Üigš®
;

770 
s
->
img_bufãr_’d
 = s->
img_bufãr_Üigš®_’d
;

771 
	}
}

775 
	mSTBI_ORDER_RGB
,

776 
	mSTBI_ORDER_BGR


781 
	mb™s_³r_chªÃl
;

782 
	mnum_chªÃls
;

783 
	mchªÃl_Üd”
;

784 } 
	t¡bi__»suÉ_šfo
;

786 #iâdeà
STBI_NO_JPEG


787 
¡bi__j³g_‹¡
(
¡bi__cÚ‹xt
 *
s
);

788 *
¡bi__j³g_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

789 
¡bi__j³g_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

792 #iâdeà
STBI_NO_PNG


793 
¡bi__²g_‹¡
(
¡bi__cÚ‹xt
 *
s
);

794 *
¡bi__²g_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

795 
¡bi__²g_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

796 
¡bi__²g_is16
(
¡bi__cÚ‹xt
 *
s
);

799 #iâdeà
STBI_NO_BMP


800 
¡bi__bmp_‹¡
(
¡bi__cÚ‹xt
 *
s
);

801 *
¡bi__bmp_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

802 
¡bi__bmp_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

805 #iâdeà
STBI_NO_TGA


806 
¡bi__tga_‹¡
(
¡bi__cÚ‹xt
 *
s
);

807 *
¡bi__tga_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

808 
¡bi__tga_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

811 #iâdeà
STBI_NO_PSD


812 
¡bi__psd_‹¡
(
¡bi__cÚ‹xt
 *
s
);

813 *
¡bi__psd_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
, 
bpc
);

814 
¡bi__psd_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

815 
¡bi__psd_is16
(
¡bi__cÚ‹xt
 *
s
);

818 #iâdeà
STBI_NO_HDR


819 
¡bi__hdr_‹¡
(
¡bi__cÚ‹xt
 *
s
);

820 *
¡bi__hdr_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

821 
¡bi__hdr_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

824 #iâdeà
STBI_NO_PIC


825 
¡bi__pic_‹¡
(
¡bi__cÚ‹xt
 *
s
);

826 *
¡bi__pic_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

827 
¡bi__pic_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

830 #iâdeà
STBI_NO_GIF


831 
¡bi__gif_‹¡
(
¡bi__cÚ‹xt
 *
s
);

832 *
¡bi__gif_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

833 *
¡bi__lßd_gif_maš
(
¡bi__cÚ‹xt
 *
s
, **
d–ays
, *
x
, *
y
, *
z
, *
comp
, 
»q_comp
);

834 
¡bi__gif_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

837 #iâdeà
STBI_NO_PNM


838 
¡bi__²m_‹¡
(
¡bi__cÚ‹xt
 *
s
);

839 *
¡bi__²m_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
);

840 
¡bi__²m_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
);

844 cÚ¡ *
	g¡bi__g_çu»_»asÚ
;

846 
STBIDEF
 cÚ¡ *
	$¡bi_çu»_»asÚ
()

848  
¡bi__g_çu»_»asÚ
;

849 
	}
}

851 
	$¡bi__”r
(cÚ¡ *
¡r
)

853 
¡bi__g_çu»_»asÚ
 = 
¡r
;

855 
	}
}

857 *
	$¡bi__m®loc
(
size_t
 
size
)

859  
	`STBI_MALLOC
(
size
);

860 
	}
}

874 
	$¡bi__addsizes_v®id
(
a
, 
b
)

876 ià(
b
 < 0)  0;

881  
a
 <ğ
INT_MAX
 - 
b
;

882 
	}
}

886 
	$¡bi__mul2sizes_v®id
(
a
, 
b
)

888 ià(
a
 < 0 || 
b
 < 0)  0;

889 ià(
b
 == 0)  1;

891  
a
 <ğ
INT_MAX
/
b
;

892 
	}
}

895 
	$¡bi__mad2sizes_v®id
(
a
, 
b
, 
add
)

897  
	`¡bi__mul2sizes_v®id
(
a
, 
b
è&& 
	`¡bi__addsizes_v®id
×*b, 
add
);

898 
	}
}

901 
	$¡bi__mad3sizes_v®id
(
a
, 
b
, 
c
, 
add
)

903  
	`¡bi__mul2sizes_v®id
(
a
, 
b
è&& stbi__mul2sizes_v®id×*b, 
c
) &&

904 
	`¡bi__addsizes_v®id
(
a
*
b
*
c
, 
add
);

905 
	}
}

908 #ià!
defšed
(
STBI_NO_LINEAR
è|| !defšed(
STBI_NO_HDR
)

909 
	$¡bi__mad4sizes_v®id
(
a
, 
b
, 
c
, 
d
, 
add
)

911  
	`¡bi__mul2sizes_v®id
(
a
, 
b
è&& stbi__mul2sizes_v®id×*b, 
c
) &&

912 
	`¡bi__mul2sizes_v®id
(
a
*
b
*
c
, 
d
è&& 
	`¡bi__addsizes_v®id
×*b*c*d, 
add
);

913 
	}
}

917 *
	$¡bi__m®loc_mad2
(
a
, 
b
, 
add
)

919 ià(!
	`¡bi__mad2sizes_v®id
(
a
, 
b
, 
add
)è 
NULL
;

920  
	`¡bi__m®loc
(
a
*
b
 + 
add
);

921 
	}
}

923 *
	$¡bi__m®loc_mad3
(
a
, 
b
, 
c
, 
add
)

925 ià(!
	`¡bi__mad3sizes_v®id
(
a
, 
b
, 
c
, 
add
)è 
NULL
;

926  
	`¡bi__m®loc
(
a
*
b
*
c
 + 
add
);

927 
	}
}

929 #ià!
defšed
(
STBI_NO_LINEAR
è|| !defšed(
STBI_NO_HDR
)

930 *
	$¡bi__m®loc_mad4
(
a
, 
b
, 
c
, 
d
, 
add
)

932 ià(!
	`¡bi__mad4sizes_v®id
(
a
, 
b
, 
c
, 
d
, 
add
)è 
NULL
;

933  
	`¡bi__m®loc
(
a
*
b
*
c
*
d
 + 
add
);

934 
	}
}

941 #ifdeà
STBI_NO_FAILURE_STRINGS


942 
	#¡bi__”r
(
x
,
y
è0

	)

943 #–ià
defšed
(
STBI_FAILURE_USERMSG
)

944 
	#¡bi__”r
(
x
,
y
è
	`¡bi__”r
(y)

	)

946 
	#¡bi__”r
(
x
,
y
è
	`¡bi__”r
(x)

	)

949 
	#¡bi__”½f
(
x
,
y
è((*)(
size_t
è(
	`¡bi__”r
(x,y)?
NULL
:NULL))

	)

950 
	#¡bi__”½uc
(
x
,
y
è((*)(
size_t
è(
	`¡bi__”r
(x,y)?
NULL
:NULL))

	)

952 
STBIDEF
 
	$¡bi_image_ä“
(*
»tv®_äom_¡bi_lßd
)

954 
	`STBI_FREE
(
»tv®_äom_¡bi_lßd
);

955 
	}
}

957 #iâdeà
STBI_NO_LINEAR


958 *
¡bi__ldr_to_hdr
(
¡bi_uc
 *
d©a
, 
x
, 
y
, 
comp
);

961 #iâdeà
STBI_NO_HDR


962 
¡bi_uc
 *
¡bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
);

965 
	g¡bi__v”tiÿÎy_æ_Ú_lßd
 = 0;

967 
STBIDEF
 
	$¡bi_£t_æ_v”tiÿÎy_Ú_lßd
(
æag_Œue_if_should_æ
)

969 
¡bi__v”tiÿÎy_æ_Ú_lßd
 = 
æag_Œue_if_should_æ
;

970 
	}
}

972 *
	$¡bi__lßd_maš
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
, 
bpc
)

974 
	`mem£t
(
ri
, 0, (*ri));

975 
ri
->
b™s_³r_chªÃl
 = 8;

976 
ri
->
chªÃl_Üd”
 = 
STBI_ORDER_RGB
;

977 
ri
->
num_chªÃls
 = 0;

979 #iâdeà
STBI_NO_JPEG


980 ià(
	`¡bi__j³g_‹¡
(
s
)è 
	`¡bi__j³g_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
);

982 #iâdeà
STBI_NO_PNG


983 ià(
	`¡bi__²g_‹¡
(
s
)è 
	`¡bi__²g_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
);

985 #iâdeà
STBI_NO_BMP


986 ià(
	`¡bi__bmp_‹¡
(
s
)è 
	`¡bi__bmp_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
);

988 #iâdeà
STBI_NO_GIF


989 ià(
	`¡bi__gif_‹¡
(
s
)è 
	`¡bi__gif_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
);

991 #iâdeà
STBI_NO_PSD


992 ià(
	`¡bi__psd_‹¡
(
s
)è 
	`¡bi__psd_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
, 
bpc
);

994 #iâdeà
STBI_NO_PIC


995 ià(
	`¡bi__pic_‹¡
(
s
)è 
	`¡bi__pic_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
);

997 #iâdeà
STBI_NO_PNM


998 ià(
	`¡bi__²m_‹¡
(
s
)è 
	`¡bi__²m_lßd
(s,
x
,
y
,
comp
,
»q_comp
, 
ri
);

1001 #iâdeà
STBI_NO_HDR


1002 ià(
	`¡bi__hdr_‹¡
(
s
)) {

1003 *
hdr
 = 
	`¡bi__hdr_lßd
(
s
, 
x
,
y
,
comp
,
»q_comp
, 
ri
);

1004  
	`¡bi__hdr_to_ldr
(
hdr
, *
x
, *
y
, 
»q_comp
 ?„eq_com°: *
comp
);

1008 #iâdeà
STBI_NO_TGA


1010 ià(
	`¡bi__tga_‹¡
(
s
))

1011  
	`¡bi__tga_lßd
(
s
,
x
,
y
,
comp
,
»q_comp
, 
ri
);

1014  
	`¡bi__”½uc
("unknown imageype", "Image‚ot of‡ny knownype, or corrupt");

1015 
	}
}

1017 
¡bi_uc
 *
	$¡bi__cÚv”t_16_to_8
(
¡bi__ušt16
 *
Üig
, 
w
, 
h
, 
chªÃls
)

1019 
i
;

1020 
img_Ën
 = 
w
 * 
h
 * 
chªÃls
;

1021 
¡bi_uc
 *
»duûd
;

1023 
»duûd
 = (
¡bi_uc
 *è
	`¡bi__m®loc
(
img_Ën
);

1024 ià(
»duûd
 =ğ
NULL
è 
	`¡bi__”½uc
("outofmem", "Out of memory");

1026 
i
 = 0; i < 
img_Ën
; ++i)

1027 
»duûd
[
i
] = (
¡bi_uc
)((
Üig
[i] >> 8) & 0xFF);

1029 
	`STBI_FREE
(
Üig
);

1030  
»duûd
;

1031 
	}
}

1033 
¡bi__ušt16
 *
	$¡bi__cÚv”t_8_to_16
(
¡bi_uc
 *
Üig
, 
w
, 
h
, 
chªÃls
)

1035 
i
;

1036 
img_Ën
 = 
w
 * 
h
 * 
chªÃls
;

1037 
¡bi__ušt16
 *
’Ïrged
;

1039 
’Ïrged
 = (
¡bi__ušt16
 *è
	`¡bi__m®loc
(
img_Ën
*2);

1040 ià(
’Ïrged
 =ğ
NULL
è (
¡bi__ušt16
 *è
	`¡bi__”½uc
("outofmem", "Out of memory");

1042 
i
 = 0; i < 
img_Ën
; ++i)

1043 
’Ïrged
[
i
] = (
¡bi__ušt16
)((
Üig
[i] << 8) + orig[i]);

1045 
	`STBI_FREE
(
Üig
);

1046  
’Ïrged
;

1047 
	}
}

1049 
	$¡bi__v”tiÿl_æ
(*
image
, 
w
, 
h
, 
by‹s_³r_pix–
)

1051 
row
;

1052 
size_t
 
by‹s_³r_row
 = (size_t)
w
 * 
by‹s_³r_pix–
;

1053 
¡bi_uc
 
‹mp
[2048];

1054 
¡bi_uc
 *
by‹s
 = (¡bi_uø*)
image
;

1056 
row
 = 0;„ow < (
h
>>1);„ow++) {

1057 
¡bi_uc
 *
row0
 = 
by‹s
 + 
row
*
by‹s_³r_row
;

1058 
¡bi_uc
 *
row1
 = 
by‹s
 + (
h
 - 
row
 - 1)*
by‹s_³r_row
;

1060 
size_t
 
by‹s_Ëá
 = 
by‹s_³r_row
;

1061 
by‹s_Ëá
) {

1062 
size_t
 
by‹s_cİy
 = (
by‹s_Ëá
 < (
‹mp
)) ? bytes_left : (temp);

1063 
	`memıy
(
‹mp
, 
row0
, 
by‹s_cİy
);

1064 
	`memıy
(
row0
, 
row1
, 
by‹s_cİy
);

1065 
	`memıy
(
row1
, 
‹mp
, 
by‹s_cİy
);

1066 
row0
 +ğ
by‹s_cİy
;

1067 
row1
 +ğ
by‹s_cİy
;

1068 
by‹s_Ëá
 -ğ
by‹s_cİy
;

1071 
	}
}

1073 
	$¡bi__v”tiÿl_æ_¦iûs
(*
image
, 
w
, 
h
, 
z
, 
by‹s_³r_pix–
)

1075 
¦iû
;

1076 
¦iû_size
 = 
w
 * 
h
 * 
by‹s_³r_pix–
;

1078 
¡bi_uc
 *
by‹s
 = (¡bi_uø*)
image
;

1079 
¦iû
 = 0; sliû < 
z
; ++slice) {

1080 
	`¡bi__v”tiÿl_æ
(
by‹s
, 
w
, 
h
, 
by‹s_³r_pix–
);

1081 
by‹s
 +ğ
¦iû_size
;

1083 
	}
}

1085 *
	$¡bi__lßd_ªd_po¡´oûss_8b™
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
)

1087 
¡bi__»suÉ_šfo
 
ri
;

1088 *
»suÉ
 = 
	`¡bi__lßd_maš
(
s
, 
x
, 
y
, 
comp
, 
»q_comp
, &
ri
, 8);

1090 ià(
»suÉ
 =ğ
NULL
)

1091  
NULL
;

1093 ià(
ri
.
b™s_³r_chªÃl
 != 8) {

1094 
	`STBI_ASSERT
(
ri
.
b™s_³r_chªÃl
 == 16);

1095 
»suÉ
 = 
	`¡bi__cÚv”t_16_to_8
((
¡bi__ušt16
 *è»suÉ, *
x
, *
y
, 
»q_comp
 =ğ0 ? *
comp
 :„eq_comp);

1096 
ri
.
b™s_³r_chªÃl
 = 8;

1101 ià(
¡bi__v”tiÿÎy_æ_Ú_lßd
) {

1102 
chªÃls
 = 
»q_comp
 ?„eq_com°: *
comp
;

1103 
	`¡bi__v”tiÿl_æ
(
»suÉ
, *
x
, *
y
, 
chªÃls
 * (
¡bi_uc
));

1106  (*è
»suÉ
;

1107 
	}
}

1109 
¡bi__ušt16
 *
	$¡bi__lßd_ªd_po¡´oûss_16b™
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
)

1111 
¡bi__»suÉ_šfo
 
ri
;

1112 *
»suÉ
 = 
	`¡bi__lßd_maš
(
s
, 
x
, 
y
, 
comp
, 
»q_comp
, &
ri
, 16);

1114 ià(
»suÉ
 =ğ
NULL
)

1115  
NULL
;

1117 ià(
ri
.
b™s_³r_chªÃl
 != 16) {

1118 
	`STBI_ASSERT
(
ri
.
b™s_³r_chªÃl
 == 8);

1119 
»suÉ
 = 
	`¡bi__cÚv”t_8_to_16
((
¡bi_uc
 *è»suÉ, *
x
, *
y
, 
»q_comp
 =ğ0 ? *
comp
 :„eq_comp);

1120 
ri
.
b™s_³r_chªÃl
 = 16;

1126 ià(
¡bi__v”tiÿÎy_æ_Ú_lßd
) {

1127 
chªÃls
 = 
»q_comp
 ?„eq_com°: *
comp
;

1128 
	`¡bi__v”tiÿl_æ
(
»suÉ
, *
x
, *
y
, 
chªÃls
 * (
¡bi__ušt16
));

1131  (
¡bi__ušt16
 *è
»suÉ
;

1132 
	}
}

1134 #ià!
defšed
(
STBI_NO_HDR
è|| !defšed(
STBI_NO_LINEAR
)

1135 
	$¡bi__æßt_po¡´oûss
(*
»suÉ
, *
x
, *
y
, *
comp
, 
»q_comp
)

1137 ià(
¡bi__v”tiÿÎy_æ_Ú_lßd
 && 
»suÉ
 !ğ
NULL
) {

1138 
chªÃls
 = 
»q_comp
 ?„eq_com°: *
comp
;

1139 
	`¡bi__v”tiÿl_æ
(
»suÉ
, *
x
, *
y
, 
chªÃls
 * ());

1141 
	}
}

1144 #iâdeà
STBI_NO_STDIO


1146 
FILE
 *
	$¡bi__fİ’
(cÚ¡ *
f’ame
, cÚ¡ *
mode
)

1148 
FILE
 *
f
;

1149 #ià
	`defšed
(
_MSC_VER
) && _MSC_VER >= 1400

1150 ià(0 !ğ
	`fİ’_s
(&
f
, 
f’ame
, 
mode
))

1151 
f
=0;

1153 
f
 = 
	`fİ’
(
f’ame
, 
mode
);

1155  
f
;

1156 
	}
}

1159 
STBIDEF
 
¡bi_uc
 *
	$¡bi_lßd
(cÚ¡ *
f’ame
, *
x
, *
y
, *
comp
, 
»q_comp
)

1161 
FILE
 *
f
 = 
	`¡bi__fİ’
(
f’ame
, "rb");

1162 *
»suÉ
;

1163 ià(!
f
è 
	`¡bi__”½uc
("can't fopen", "Unableo open file");

1164 
»suÉ
 = 
	`¡bi_lßd_äom_fe
(
f
,
x
,
y
,
comp
,
»q_comp
);

1165 
	`fşo£
(
f
);

1166  
»suÉ
;

1167 
	}
}

1169 
STBIDEF
 
¡bi_uc
 *
	$¡bi_lßd_äom_fe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
»q_comp
)

1171 *
»suÉ
;

1172 
¡bi__cÚ‹xt
 
s
;

1173 
	`¡bi__¡¬t_fe
(&
s
,
f
);

1174 
»suÉ
 = 
	`¡bi__lßd_ªd_po¡´oûss_8b™
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1175 ià(
»suÉ
) {

1177 
	`f£ek
(
f
, - (è(
s
.
img_bufãr_’d
 - s.
img_bufãr
), 
SEEK_CUR
);

1179  
»suÉ
;

1180 
	}
}

1182 
STBIDEF
 
¡bi__ušt16
 *
	$¡bi_lßd_äom_fe_16
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
»q_comp
)

1184 
¡bi__ušt16
 *
»suÉ
;

1185 
¡bi__cÚ‹xt
 
s
;

1186 
	`¡bi__¡¬t_fe
(&
s
,
f
);

1187 
»suÉ
 = 
	`¡bi__lßd_ªd_po¡´oûss_16b™
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1188 ià(
»suÉ
) {

1190 
	`f£ek
(
f
, - (è(
s
.
img_bufãr_’d
 - s.
img_bufãr
), 
SEEK_CUR
);

1192  
»suÉ
;

1193 
	}
}

1195 
STBIDEF
 
¡bi_us
 *
	$¡bi_lßd_16
(cÚ¡ *
f’ame
, *
x
, *
y
, *
comp
, 
»q_comp
)

1197 
FILE
 *
f
 = 
	`¡bi__fİ’
(
f’ame
, "rb");

1198 
¡bi__ušt16
 *
»suÉ
;

1199 ià(!
f
è (
¡bi_us
 *è
	`¡bi__”½uc
("can't fopen", "Unableo open file");

1200 
»suÉ
 = 
	`¡bi_lßd_äom_fe_16
(
f
,
x
,
y
,
comp
,
»q_comp
);

1201 
	`fşo£
(
f
);

1202  
»suÉ
;

1203 
	}
}

1208 
STBIDEF
 
¡bi_us
 *
	$¡bi_lßd_16_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
)

1210 
¡bi__cÚ‹xt
 
s
;

1211 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

1212  
	`¡bi__lßd_ªd_po¡´oûss_16b™
(&
s
,
x
,
y
,
chªÃls_š_fe
,
desœed_chªÃls
);

1213 
	}
}

1215 
STBIDEF
 
¡bi_us
 *
	$¡bi_lßd_16_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
, *
x
, *
y
, *
chªÃls_š_fe
, 
desœed_chªÃls
)

1217 
¡bi__cÚ‹xt
 
s
;

1218 
	`¡bi__¡¬t_ÿÎbacks
(&
s
, (
¡bi_io_ÿÎbacks
 *)
şbk
, 
u£r
);

1219  
	`¡bi__lßd_ªd_po¡´oûss_16b™
(&
s
,
x
,
y
,
chªÃls_š_fe
,
desœed_chªÃls
);

1220 
	}
}

1222 
STBIDEF
 
¡bi_uc
 *
	$¡bi_lßd_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
comp
, 
»q_comp
)

1224 
¡bi__cÚ‹xt
 
s
;

1225 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

1226  
	`¡bi__lßd_ªd_po¡´oûss_8b™
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1227 
	}
}

1229 
STBIDEF
 
¡bi_uc
 *
	$¡bi_lßd_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
, *
x
, *
y
, *
comp
, 
»q_comp
)

1231 
¡bi__cÚ‹xt
 
s
;

1232 
	`¡bi__¡¬t_ÿÎbacks
(&
s
, (
¡bi_io_ÿÎbacks
 *è
şbk
, 
u£r
);

1233  
	`¡bi__lßd_ªd_po¡´oûss_8b™
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1234 
	}
}

1236 #iâdeà
STBI_NO_GIF


1237 
STBIDEF
 
¡bi_uc
 *
	$¡bi_lßd_gif_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, **
d–ays
, *
x
, *
y
, *
z
, *
comp
, 
»q_comp
)

1239 *
»suÉ
;

1240 
¡bi__cÚ‹xt
 
s
;

1241 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

1243 
»suÉ
 = (*è
	`¡bi__lßd_gif_maš
(&
s
, 
d–ays
, 
x
, 
y
, 
z
, 
comp
, 
»q_comp
);

1244 ià(
¡bi__v”tiÿÎy_æ_Ú_lßd
) {

1245 
	`¡bi__v”tiÿl_æ_¦iûs
Ğ
»suÉ
, *
x
, *
y
, *
z
, *
comp
 );

1248  
»suÉ
;

1249 
	}
}

1252 #iâdeà
STBI_NO_LINEAR


1253 *
	$¡bi__lßdf_maš
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
)

1255 *
d©a
;

1256 #iâdeà
STBI_NO_HDR


1257 ià(
	`¡bi__hdr_‹¡
(
s
)) {

1258 
¡bi__»suÉ_šfo
 
ri
;

1259 *
hdr_d©a
 = 
	`¡bi__hdr_lßd
(
s
,
x
,
y
,
comp
,
»q_comp
, &
ri
);

1260 ià(
hdr_d©a
)

1261 
	`¡bi__æßt_po¡´oûss
(
hdr_d©a
,
x
,
y
,
comp
,
»q_comp
);

1262  
hdr_d©a
;

1265 
d©a
 = 
	`¡bi__lßd_ªd_po¡´oûss_8b™
(
s
, 
x
, 
y
, 
comp
, 
»q_comp
);

1266 ià(
d©a
)

1267  
	`¡bi__ldr_to_hdr
(
d©a
, *
x
, *
y
, 
»q_comp
 ?„eq_com°: *
comp
);

1268  
	`¡bi__”½f
("unknown imageype", "Image‚ot of‡ny knownype, or corrupt");

1269 
	}
}

1271 
STBIDEF
 *
	$¡bi_lßdf_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
comp
, 
»q_comp
)

1273 
¡bi__cÚ‹xt
 
s
;

1274 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

1275  
	`¡bi__lßdf_maš
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1276 
	}
}

1278 
STBIDEF
 *
	$¡bi_lßdf_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
, *
x
, *
y
, *
comp
, 
»q_comp
)

1280 
¡bi__cÚ‹xt
 
s
;

1281 
	`¡bi__¡¬t_ÿÎbacks
(&
s
, (
¡bi_io_ÿÎbacks
 *è
şbk
, 
u£r
);

1282  
	`¡bi__lßdf_maš
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1283 
	}
}

1285 #iâdeà
STBI_NO_STDIO


1286 
STBIDEF
 *
	$¡bi_lßdf
(cÚ¡ *
f’ame
, *
x
, *
y
, *
comp
, 
»q_comp
)

1288 *
»suÉ
;

1289 
FILE
 *
f
 = 
	`¡bi__fİ’
(
f’ame
, "rb");

1290 ià(!
f
è 
	`¡bi__”½f
("can't fopen", "Unableo open file");

1291 
»suÉ
 = 
	`¡bi_lßdf_äom_fe
(
f
,
x
,
y
,
comp
,
»q_comp
);

1292 
	`fşo£
(
f
);

1293  
»suÉ
;

1294 
	}
}

1296 
STBIDEF
 *
	$¡bi_lßdf_äom_fe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
»q_comp
)

1298 
¡bi__cÚ‹xt
 
s
;

1299 
	`¡bi__¡¬t_fe
(&
s
,
f
);

1300  
	`¡bi__lßdf_maš
(&
s
,
x
,
y
,
comp
,
»q_comp
);

1301 
	}
}

1310 
STBIDEF
 
	$¡bi_is_hdr_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
)

1312 #iâdeà
STBI_NO_HDR


1313 
¡bi__cÚ‹xt
 
s
;

1314 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

1315  
	`¡bi__hdr_‹¡
(&
s
);

1317 
	`STBI_NOTUSED
(
bufãr
);

1318 
	`STBI_NOTUSED
(
Ën
);

1321 
	}
}

1323 #iâdeà
STBI_NO_STDIO


1324 
STBIDEF
 
	$¡bi_is_hdr
 (cÚ¡ *
f’ame
)

1326 
FILE
 *
f
 = 
	`¡bi__fİ’
(
f’ame
, "rb");

1327 
»suÉ
=0;

1328 ià(
f
) {

1329 
»suÉ
 = 
	`¡bi_is_hdr_äom_fe
(
f
);

1330 
	`fşo£
(
f
);

1332  
»suÉ
;

1333 
	}
}

1335 
STBIDEF
 
	$¡bi_is_hdr_äom_fe
(
FILE
 *
f
)

1337 #iâdeà
STBI_NO_HDR


1338 
pos
 = 
	`á–l
(
f
);

1339 
»s
;

1340 
¡bi__cÚ‹xt
 
s
;

1341 
	`¡bi__¡¬t_fe
(&
s
,
f
);

1342 
»s
 = 
	`¡bi__hdr_‹¡
(&
s
);

1343 
	`f£ek
(
f
, 
pos
, 
SEEK_SET
);

1344  
»s
;

1346 
	`STBI_NOTUSED
(
f
);

1349 
	}
}

1352 
STBIDEF
 
	$¡bi_is_hdr_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
şbk
, *
u£r
)

1354 #iâdeà
STBI_NO_HDR


1355 
¡bi__cÚ‹xt
 
s
;

1356 
	`¡bi__¡¬t_ÿÎbacks
(&
s
, (
¡bi_io_ÿÎbacks
 *è
şbk
, 
u£r
);

1357  
	`¡bi__hdr_‹¡
(&
s
);

1359 
	`STBI_NOTUSED
(
şbk
);

1360 
	`STBI_NOTUSED
(
u£r
);

1363 
	}
}

1365 #iâdeà
STBI_NO_LINEAR


1366 
	g¡bi__l2h_gamma
=2.2f, 
	g¡bi__l2h_sÿË
=1.0f;

1368 
STBIDEF
 
	$¡bi_ldr_to_hdr_gamma
(
gamma
è{ 
¡bi__l2h_gamma
 = gamma; 
	}
}

1369 
STBIDEF
 
	$¡bi_ldr_to_hdr_sÿË
(
sÿË
è{ 
¡bi__l2h_sÿË
 = sÿË; 
	}
}

1372 
	g¡bi__h2l_gamma_i
=1.0f/2.2f, 
	g¡bi__h2l_sÿË_i
=1.0f;

1374 
STBIDEF
 
	$¡bi_hdr_to_ldr_gamma
(
gamma
è{ 
¡bi__h2l_gamma_i
 = 1/gamma; 
	}
}

1375 
STBIDEF
 
	$¡bi_hdr_to_ldr_sÿË
(
sÿË
è{ 
¡bi__h2l_sÿË_i
 = 1/sÿË; 
	}
}

1385 
	mSTBI__SCAN_lßd
=0,

1386 
	mSTBI__SCAN_ty³
,

1387 
	mSTBI__SCAN_h—d”


1390 
	$¡bi__»fl_bufãr
(
¡bi__cÚ‹xt
 *
s
)

1392 
n
 = (
s
->
io
.
»ad
)(s->
io_u£r_d©a
,(*)s->
bufãr_¡¬t
,s->
buæ’
);

1393 ià(
n
 == 0) {

1396 
s
->
»ad_äom_ÿÎbacks
 = 0;

1397 
s
->
img_bufãr
 = s->
bufãr_¡¬t
;

1398 
s
->
img_bufãr_’d
 = s->
bufãr_¡¬t
+1;

1399 *
s
->
img_bufãr
 = 0;

1401 
s
->
img_bufãr
 = s->
bufãr_¡¬t
;

1402 
s
->
img_bufãr_’d
 = s->
bufãr_¡¬t
 + 
n
;

1404 
	}
}

1406 
¡bi_šlše
 
¡bi_uc
 
	$¡bi__g‘8
(
¡bi__cÚ‹xt
 *
s
)

1408 ià(
s
->
img_bufãr
 < s->
img_bufãr_’d
)

1409  *
s
->
img_bufãr
++;

1410 ià(
s
->
»ad_äom_ÿÎbacks
) {

1411 
	`¡bi__»fl_bufãr
(
s
);

1412  *
s
->
img_bufãr
++;

1415 
	}
}

1417 
¡bi_šlše
 
	$¡bi__©_eof
(
¡bi__cÚ‹xt
 *
s
)

1419 ià(
s
->
io
.
»ad
) {

1420 ià(!(
s
->
io
.
eof
)(s->
io_u£r_d©a
))  0;

1423 ià(
s
->
»ad_äom_ÿÎbacks
 == 0)  1;

1426  
s
->
img_bufãr
 >ğs->
img_bufãr_’d
;

1427 
	}
}

1429 
	$¡bi__sk
(
¡bi__cÚ‹xt
 *
s
, 
n
)

1431 ià(
n
 < 0) {

1432 
s
->
img_bufãr
 = s->
img_bufãr_’d
;

1435 ià(
s
->
io
.
»ad
) {

1436 
bËn
 = (è(
s
->
img_bufãr_’d
 - s->
img_bufãr
);

1437 ià(
bËn
 < 
n
) {

1438 
s
->
img_bufãr
 = s->
img_bufãr_’d
;

1439 (
s
->
io
.
sk
)(s->
io_u£r_d©a
, 
n
 - 
bËn
);

1443 
s
->
img_bufãr
 +ğ
n
;

1444 
	}
}

1446 
	$¡bi__g‘n
(
¡bi__cÚ‹xt
 *
s
, 
¡bi_uc
 *
bufãr
, 
n
)

1448 ià(
s
->
io
.
»ad
) {

1449 
bËn
 = (è(
s
->
img_bufãr_’d
 - s->
img_bufãr
);

1450 ià(
bËn
 < 
n
) {

1451 
»s
, 
couÁ
;

1453 
	`memıy
(
bufãr
, 
s
->
img_bufãr
, 
bËn
);

1455 
couÁ
 = (
s
->
io
.
»ad
)(s->
io_u£r_d©a
, (*è
bufãr
 + 
bËn
, 
n
 - blen);

1456 
»s
 = (
couÁ
 =ğ(
n
-
bËn
));

1457 
s
->
img_bufãr
 = s->
img_bufãr_’d
;

1458  
»s
;

1462 ià(
s
->
img_bufãr
+
n
 <ğs->
img_bufãr_’d
) {

1463 
	`memıy
(
bufãr
, 
s
->
img_bufãr
, 
n
);

1464 
s
->
img_bufãr
 +ğ
n
;

1468 
	}
}

1470 
	$¡bi__g‘16be
(
¡bi__cÚ‹xt
 *
s
)

1472 
z
 = 
	`¡bi__g‘8
(
s
);

1473  (
z
 << 8è+ 
	`¡bi__g‘8
(
s
);

1474 
	}
}

1476 
¡bi__ušt32
 
	$¡bi__g‘32be
(
¡bi__cÚ‹xt
 *
s
)

1478 
¡bi__ušt32
 
z
 = 
	`¡bi__g‘16be
(
s
);

1479  (
z
 << 16è+ 
	`¡bi__g‘16be
(
s
);

1480 
	}
}

1482 #ià
defšed
(
STBI_NO_BMP
è&& defšed(
STBI_NO_TGA
è&& defšed(
STBI_NO_GIF
)

1485 
	$¡bi__g‘16Ë
(
¡bi__cÚ‹xt
 *
s
)

1487 
z
 = 
	`¡bi__g‘8
(
s
);

1488  
z
 + (
	`¡bi__g‘8
(
s
) << 8);

1489 
	}
}

1492 #iâdeà
STBI_NO_BMP


1493 
¡bi__ušt32
 
	$¡bi__g‘32Ë
(
¡bi__cÚ‹xt
 *
s
)

1495 
¡bi__ušt32
 
z
 = 
	`¡bi__g‘16Ë
(
s
);

1496  
z
 + (
	`¡bi__g‘16Ë
(
s
) << 16);

1497 
	}
}

1500 
	#STBI__BYTECAST
(
x
è((
¡bi_uc
) ((x) & 255))

1501 

	)

1514 
¡bi_uc
 
	$¡bi__compu‹_y
(
r
, 
g
, 
b
)

1516  (
¡bi_uc
è(((
r
*77è+ (
g
*150è+ (29*
b
)) >> 8);

1517 
	}
}

1519 *
	$¡bi__cÚv”t_fÜm©
(*
d©a
, 
img_n
, 
»q_comp
, 
x
, 
y
)

1521 
i
,
j
;

1522 *
good
;

1524 ià(
»q_comp
 =ğ
img_n
è 
d©a
;

1525 
	`STBI_ASSERT
(
»q_comp
 >= 1 &&„eq_comp <= 4);

1527 
good
 = (*è
	`¡bi__m®loc_mad3
(
»q_comp
, 
x
, 
y
, 0);

1528 ià(
good
 =ğ
NULL
) {

1529 
	`STBI_FREE
(
d©a
);

1530  
	`¡bi__”½uc
("outofmem", "Out of memory");

1533 
j
=0; j < (è
y
; ++j) {

1534 *
¤c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1535 *
de¡
 = 
good
 + 
j
 * 
x
 * 
»q_comp
;

1537 
	#STBI__COMBO
(
a
,
b
è(×)*8+(b))

	)

1538 
	#STBI__CASE
(
a
,
b
è
	`STBI__COMBO
×,b): 
i
=
x
-1; i >ğ0; --i, 
¤c
 +ğa, 
de¡
 +ğb)

	)

1541 
	`STBI__COMBO
(
img_n
, 
»q_comp
)) {

1542 
	`STBI__CASE
(1,2è{ 
de¡
[0]=
¤c
[0], dest[1]=255; } ;

1543 
	`STBI__CASE
(1,3è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0]; } ;

1544 
	`STBI__CASE
(1,4è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0], dest[3]=255; } ;

1545 
	`STBI__CASE
(2,1è{ 
de¡
[0]=
¤c
[0]; } ;

1546 
	`STBI__CASE
(2,3è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0]; } ;

1547 
	`STBI__CASE
(2,4è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0], dest[3]=src[1]; } ;

1548 
	`STBI__CASE
(3,4è{ 
de¡
[0]=
¤c
[0],dest[1]=src[1],dest[2]=src[2],dest[3]=255; } ;

1549 
	`STBI__CASE
(3,1è{ 
de¡
[0]=
	`¡bi__compu‹_y
(
¤c
[0],src[1],src[2]); } ;

1550 
	`STBI__CASE
(3,2è{ 
de¡
[0]=
	`¡bi__compu‹_y
(
¤c
[0],src[1],src[2]), dest[1] = 255; } ;

1551 
	`STBI__CASE
(4,1è{ 
de¡
[0]=
	`¡bi__compu‹_y
(
¤c
[0],src[1],src[2]); } ;

1552 
	`STBI__CASE
(4,2è{ 
de¡
[0]=
	`¡bi__compu‹_y
(
¤c
[0],src[1],src[2]), dest[1] = src[3]; } ;

1553 
	`STBI__CASE
(4,3è{ 
de¡
[0]=
¤c
[0],dest[1]=src[1],dest[2]=src[2]; } ;

1554 : 
	`STBI_ASSERT
(0);

1556 #undeà
STBI__CASE


1559 
	`STBI_FREE
(
d©a
);

1560  
good
;

1561 
	}
}

1563 
¡bi__ušt16
 
	$¡bi__compu‹_y_16
(
r
, 
g
, 
b
)

1565  (
¡bi__ušt16
è(((
r
*77è+ (
g
*150è+ (29*
b
)) >> 8);

1566 
	}
}

1568 
¡bi__ušt16
 *
	$¡bi__cÚv”t_fÜm©16
(
¡bi__ušt16
 *
d©a
, 
img_n
, 
»q_comp
, 
x
, 
y
)

1570 
i
,
j
;

1571 
¡bi__ušt16
 *
good
;

1573 ià(
»q_comp
 =ğ
img_n
è 
d©a
;

1574 
	`STBI_ASSERT
(
»q_comp
 >= 1 &&„eq_comp <= 4);

1576 
good
 = (
¡bi__ušt16
 *è
	`¡bi__m®loc
(
»q_comp
 * 
x
 * 
y
 * 2);

1577 ià(
good
 =ğ
NULL
) {

1578 
	`STBI_FREE
(
d©a
);

1579  (
¡bi__ušt16
 *è
	`¡bi__”½uc
("outofmem", "Out of memory");

1582 
j
=0; j < (è
y
; ++j) {

1583 
¡bi__ušt16
 *
¤c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1584 
¡bi__ušt16
 *
de¡
 = 
good
 + 
j
 * 
x
 * 
»q_comp
;

1586 
	#STBI__COMBO
(
a
,
b
è(×)*8+(b))

	)

1587 
	#STBI__CASE
(
a
,
b
è
	`STBI__COMBO
×,b): 
i
=
x
-1; i >ğ0; --i, 
¤c
 +ğa, 
de¡
 +ğb)

	)

1590 
	`STBI__COMBO
(
img_n
, 
»q_comp
)) {

1591 
	`STBI__CASE
(1,2è{ 
de¡
[0]=
¤c
[0], dest[1]=0xffff; } ;

1592 
	`STBI__CASE
(1,3è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0]; } ;

1593 
	`STBI__CASE
(1,4è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0], dest[3]=0xffff; } ;

1594 
	`STBI__CASE
(2,1è{ 
de¡
[0]=
¤c
[0]; } ;

1595 
	`STBI__CASE
(2,3è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0]; } ;

1596 
	`STBI__CASE
(2,4è{ 
de¡
[0]=de¡[1]=de¡[2]=
¤c
[0], dest[3]=src[1]; } ;

1597 
	`STBI__CASE
(3,4è{ 
de¡
[0]=
¤c
[0],dest[1]=src[1],dest[2]=src[2],dest[3]=0xffff; } ;

1598 
	`STBI__CASE
(3,1è{ 
de¡
[0]=
	`¡bi__compu‹_y_16
(
¤c
[0],src[1],src[2]); } ;

1599 
	`STBI__CASE
(3,2è{ 
de¡
[0]=
	`¡bi__compu‹_y_16
(
¤c
[0],src[1],src[2]), dest[1] = 0xffff; } ;

1600 
	`STBI__CASE
(4,1è{ 
de¡
[0]=
	`¡bi__compu‹_y_16
(
¤c
[0],src[1],src[2]); } ;

1601 
	`STBI__CASE
(4,2è{ 
de¡
[0]=
	`¡bi__compu‹_y_16
(
¤c
[0],src[1],src[2]), dest[1] = src[3]; } ;

1602 
	`STBI__CASE
(4,3è{ 
de¡
[0]=
¤c
[0],dest[1]=src[1],dest[2]=src[2]; } ;

1603 : 
	`STBI_ASSERT
(0);

1605 #undeà
STBI__CASE


1608 
	`STBI_FREE
(
d©a
);

1609  
good
;

1610 
	}
}

1612 #iâdeà
STBI_NO_LINEAR


1613 *
	$¡bi__ldr_to_hdr
(
¡bi_uc
 *
d©a
, 
x
, 
y
, 
comp
)

1615 
i
,
k
,
n
;

1616 *
ouut
;

1617 ià(!
d©a
è 
NULL
;

1618 
ouut
 = (*è
	`¡bi__m®loc_mad4
(
x
, 
y
, 
comp
, (), 0);

1619 ià(
ouut
 =ğ
NULL
è{ 
	`STBI_FREE
(
d©a
);  
	`¡bi__”½f
("outofmem", "Out of memory"); }

1621 ià(
comp
 & 1è
n
 = comp; n = comp-1;

1622 
i
=0; i < 
x
*
y
; ++i) {

1623 
k
=0; k < 
n
; ++k) {

1624 
ouut
[
i
*
comp
 + 
k
] = (è(
	`pow
(
d©a
[i*comp+k]/255.0f, 
¡bi__l2h_gamma
è* 
¡bi__l2h_sÿË
);

1626 ià(
k
 < 
comp
è
ouut
[
i
*com°+ k] = 
d©a
[i*comp+k]/255.0f;

1628 
	`STBI_FREE
(
d©a
);

1629  
ouut
;

1630 
	}
}

1633 #iâdeà
STBI_NO_HDR


1634 
	#¡bi__æßt2št
(
x
è((è(x))

	)

1635 
¡bi_uc
 *
	$¡bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
)

1637 
i
,
k
,
n
;

1638 
¡bi_uc
 *
ouut
;

1639 ià(!
d©a
è 
NULL
;

1640 
ouut
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
x
, 
y
, 
comp
, 0);

1641 ià(
ouut
 =ğ
NULL
è{ 
	`STBI_FREE
(
d©a
);  
	`¡bi__”½uc
("outofmem", "Out of memory"); }

1643 ià(
comp
 & 1è
n
 = comp; n = comp-1;

1644 
i
=0; i < 
x
*
y
; ++i) {

1645 
k
=0; k < 
n
; ++k) {

1646 
z
 = (è
	`pow
(
d©a
[
i
*
comp
+
k
]*
¡bi__h2l_sÿË_i
, 
¡bi__h2l_gamma_i
) * 255 + 0.5f;

1647 ià(
z
 < 0) z = 0;

1648 ià(
z
 > 255) z = 255;

1649 
ouut
[
i
*
comp
 + 
k
] = (
¡bi_uc
è
	`¡bi__æßt2št
(
z
);

1651 ià(
k
 < 
comp
) {

1652 
z
 = 
d©a
[
i
*
comp
+
k
] * 255 + 0.5f;

1653 ià(
z
 < 0) z = 0;

1654 ià(
z
 > 255) z = 255;

1655 
ouut
[
i
*
comp
 + 
k
] = (
¡bi_uc
è
	`¡bi__æßt2št
(
z
);

1658 
	`STBI_FREE
(
d©a
);

1659  
ouut
;

1660 
	}
}

1684 #iâdeà
STBI_NO_JPEG


1687 
	#FAST_BITS
 9

1688 

	)

1691 
¡bi_uc
 
	mç¡
[1 << 
FAST_BITS
];

1693 
¡bi__ušt16
 
	mcode
[256];

1694 
¡bi_uc
 
	mv®ues
[256];

1695 
¡bi_uc
 
	msize
[257];

1696 
	mmaxcode
[18];

1697 
	md–
[17];

1698 } 
	t¡bi__huffmª
;

1702 
¡bi__cÚ‹xt
 *
	ms
;

1703 
¡bi__huffmª
 
	mhuff_dc
[4];

1704 
¡bi__huffmª
 
	mhuff_ac
[4];

1705 
¡bi__ušt16
 
	mdequªt
[4][64];

1706 
¡bi__št16
 
	mç¡_ac
[4][1 << 
FAST_BITS
];

1709 
	mimg_h_max
, 
	mimg_v_max
;

1710 
	mimg_mcu_x
, 
	mimg_mcu_y
;

1711 
	mimg_mcu_w
, 
	mimg_mcu_h
;

1716 
	mid
;

1717 
	mh
,
	mv
;

1718 
	mtq
;

1719 
	mhd
,
	mha
;

1720 
	mdc_´ed
;

1722 
	mx
,
	my
,
	mw2
,
	mh2
;

1723 
¡bi_uc
 *
	md©a
;

1724 *
	m¿w_d©a
, *
	m¿w_cÛff
;

1725 
¡bi_uc
 *
	mlšebuf
;

1726 *
	mcÛff
;

1727 
	mcÛff_w
, 
	mcÛff_h
;

1728 } 
	mimg_comp
[4];

1730 
¡bi__ušt32
 
	mcode_bufãr
;

1731 
	mcode_b™s
;

1732 
	mm¬k”
;

1733 
	mnomÜe
;

1735 
	m´og»ssive
;

1736 
	m¥ec_¡¬t
;

1737 
	m¥ec_’d
;

1738 
	msucc_high
;

1739 
	msucc_low
;

1740 
	meob_run
;

1741 
	mjfif
;

1742 
	m­p14_cŞÜ_ŒªsfÜm
;

1743 
	mrgb
;

1745 
	msÿn_n
, 
	mÜd”
[4];

1746 
	m»¡¬t_š‹rv®
, 
	mtodo
;

1749 (*
	midù_block_k”Ãl
)(
¡bi_uc
 *
	mout
, 
	mout_¡ride
, 
	md©a
[64]);

1750 (*
	mYCbCr_to_RGB_k”Ãl
)(
¡bi_uc
 *
	mout
, cÚ¡ stbi_uø*
	my
, cÚ¡ stbi_uø*
	mpcb
, cÚ¡ stbi_uø*
	mpü
, 
	mcouÁ
, 
	m¡•
);

1751 
	m¡bi_uc
 *(*
	m»§m¶e_row_hv_2_k”Ãl
)(
¡bi_uc
 *
	mout
, stbi_uø*
	mš_Ã¬
, stbi_uø*
	mš_çr
, 
	mw
, 
	mhs
);

1752 } 
	t¡bi__j³g
;

1754 
	$¡bi__bud_huffmª
(
¡bi__huffmª
 *
h
, *
couÁ
)

1756 
i
,
j
,
k
=0;

1757 
code
;

1759 
i
=0; i < 16; ++i)

1760 
j
=0; j < 
couÁ
[
i
]; ++j)

1761 
h
->
size
[
k
++] = (
¡bi_uc
è(
i
+1);

1762 
h
->
size
[
k
] = 0;

1765 
code
 = 0;

1766 
k
 = 0;

1767 
j
=1; j <= 16; ++j) {

1769 
h
->
d–
[
j
] = 
k
 - 
code
;

1770 ià(
h
->
size
[
k
] =ğ
j
) {

1771 
h
->
size
[
k
] =ğ
j
)

1772 
h
->
code
[
k
++] = (
¡bi__ušt16
) (code++);

1773 ià(
code
-1 >ğ(1u << 
j
)è 
	`¡bi__”r
("bad code†engths","Corrupt JPEG");

1776 
h
->
maxcode
[
j
] = 
code
 << (16-j);

1777 
code
 <<= 1;

1779 
h
->
maxcode
[
j
] = 0xffffffff;

1782 
	`mem£t
(
h
->
ç¡
, 255, 1 << 
FAST_BITS
);

1783 
i
=0; i < 
k
; ++i) {

1784 
s
 = 
h
->
size
[
i
];

1785 ià(
s
 <ğ
FAST_BITS
) {

1786 
c
 = 
h
->
code
[
i
] << (
FAST_BITS
-
s
);

1787 
m
 = 1 << (
FAST_BITS
-
s
);

1788 
j
=0; j < 
m
; ++j) {

1789 
h
->
ç¡
[
c
+
j
] = (
¡bi_uc
è
i
;

1794 
	}
}

1798 
	$¡bi__bud_ç¡_ac
(
¡bi__št16
 *
ç¡_ac
, 
¡bi__huffmª
 *
h
)

1800 
i
;

1801 
i
=0; i < (1 << 
FAST_BITS
); ++i) {

1802 
¡bi_uc
 
ç¡
 = 
h
->ç¡[
i
];

1803 
ç¡_ac
[
i
] = 0;

1804 ià(
ç¡
 < 255) {

1805 
rs
 = 
h
->
v®ues
[
ç¡
];

1806 
run
 = (
rs
 >> 4) & 15;

1807 
magb™s
 = 
rs
 & 15;

1808 
Ën
 = 
h
->
size
[
ç¡
];

1810 ià(
magb™s
 && 
Ën
 + magb™ <ğ
FAST_BITS
) {

1812 
k
 = ((
i
 << 
Ën
è& ((1 << 
FAST_BITS
è- 1)è>> (FAST_BITS - 
magb™s
);

1813 
m
 = 1 << (
magb™s
 - 1);

1814 ià(
k
 < 
m
èk +ğ(~0U << 
magb™s
) + 1;

1816 ià(
k
 >= -128 && k <= 127)

1817 
ç¡_ac
[
i
] = (
¡bi__št16
è((
k
 * 256è+ (
run
 * 16è+ (
Ën
 + 
magb™s
));

1821 
	}
}

1823 
	$¡bi__grow_bufãr_un§ã
(
¡bi__j³g
 *
j
)

1826 
b
 = 
j
->
nomÜe
 ? 0 : 
	`¡bi__g‘8
(j->
s
);

1827 ià(
b
 == 0xff) {

1828 
c
 = 
	`¡bi__g‘8
(
j
->
s
);

1829 
c
 =ğ0xffèøğ
	`¡bi__g‘8
(
j
->
s
);

1830 ià(
c
 != 0) {

1831 
j
->
m¬k”
 = (è
c
;

1832 
j
->
nomÜe
 = 1;

1836 
j
->
code_bufãr
 |ğ
b
 << (24 - j->
code_b™s
);

1837 
j
->
code_b™s
 += 8;

1838 } 
j
->
code_b™s
 <= 24);

1839 
	}
}

1842 cÚ¡ 
¡bi__ušt32
 
	g¡bi__bmask
[17]={0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535};

1845 
¡bi_šlše
 
	$¡bi__j³g_huff_decode
(
¡bi__j³g
 *
j
, 
¡bi__huffmª
 *
h
)

1847 
‹mp
;

1848 
c
,
k
;

1850 ià(
j
->
code_b™s
 < 16è
	`¡bi__grow_bufãr_un§ã
(j);

1854 
c
 = (
j
->
code_bufãr
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

1855 
k
 = 
h
->
ç¡
[
c
];

1856 ià(
k
 < 255) {

1857 
s
 = 
h
->
size
[
k
];

1858 ià(
s
 > 
j
->
code_b™s
)

1860 
j
->
code_bufãr
 <<ğ
s
;

1861 
j
->
code_b™s
 -ğ
s
;

1862  
h
->
v®ues
[
k
];

1871 
‹mp
 = 
j
->
code_bufãr
 >> 16;

1872 
k
=
FAST_BITS
+1 ; ; ++k)

1873 ià(
‹mp
 < 
h
->
maxcode
[
k
])

1875 ià(
k
 == 17) {

1877 
j
->
code_b™s
 -= 16;

1881 ià(
k
 > 
j
->
code_b™s
)

1885 
c
 = ((
j
->
code_bufãr
 >> (32 - 
k
)è& 
¡bi__bmask
[k]è+ 
h
->
d–
[k];

1886 
	`STBI_ASSERT
((((
j
->
code_bufãr
è>> (32 - 
h
->
size
[
c
])è& 
¡bi__bmask
[h->size[c]]è=ğh->
code
[c]);

1889 
j
->
code_b™s
 -ğ
k
;

1890 
j
->
code_bufãr
 <<ğ
k
;

1891  
h
->
v®ues
[
c
];

1892 
	}
}

1895 cÚ¡ 
	g¡bi__jbŸs
[16] = {0,-1,-3,-7,-15,-31,-63,-127,-255,-511,-1023,-2047,-4095,-8191,-16383,-32767};

1899 
¡bi_šlše
 
	$¡bi__ex‹nd_»ûive
(
¡bi__j³g
 *
j
, 
n
)

1901 
k
;

1902 
sgn
;

1903 ià(
j
->
code_b™s
 < 
n
è
	`¡bi__grow_bufãr_un§ã
(j);

1905 
sgn
 = (
¡bi__št32
)
j
->
code_bufãr
 >> 31;

1906 
k
 = 
	`¡bi_ÌÙ
(
j
->
code_bufãr
, 
n
);

1907 
	`STBI_ASSERT
(
n
 >ğ0 &&‚ < (è((
¡bi__bmask
)/(*stbi__bmask)));

1908 
j
->
code_bufãr
 = 
k
 & ~
¡bi__bmask
[
n
];

1909 
k
 &ğ
¡bi__bmask
[
n
];

1910 
j
->
code_b™s
 -ğ
n
;

1911  
k
 + (
¡bi__jbŸs
[
n
] & ~
sgn
);

1912 
	}
}

1915 
¡bi_šlše
 
	$¡bi__j³g_g‘_b™s
(
¡bi__j³g
 *
j
, 
n
)

1917 
k
;

1918 ià(
j
->
code_b™s
 < 
n
è
	`¡bi__grow_bufãr_un§ã
(j);

1919 
k
 = 
	`¡bi_ÌÙ
(
j
->
code_bufãr
, 
n
);

1920 
j
->
code_bufãr
 = 
k
 & ~
¡bi__bmask
[
n
];

1921 
k
 &ğ
¡bi__bmask
[
n
];

1922 
j
->
code_b™s
 -ğ
n
;

1923  
k
;

1924 
	}
}

1926 
¡bi_šlše
 
	$¡bi__j³g_g‘_b™
(
¡bi__j³g
 *
j
)

1928 
k
;

1929 ià(
j
->
code_b™s
 < 1è
	`¡bi__grow_bufãr_un§ã
(j);

1930 
k
 = 
j
->
code_bufãr
;

1931 
j
->
code_bufãr
 <<= 1;

1932 --
j
->
code_b™s
;

1933  
k
 & 0x80000000;

1934 
	}
}

1938 cÚ¡ 
¡bi_uc
 
	g¡bi__j³g_dezigzag
[64+15] =

1954 
	$¡bi__j³g_decode_block
(
¡bi__j³g
 *
j
, 
d©a
[64], 
¡bi__huffmª
 *
hdc
, stbi__huffmª *
hac
, 
¡bi__št16
 *
çc
, 
b
, 
¡bi__ušt16
 *
dequªt
)

1956 
diff
,
dc
,
k
;

1957 
t
;

1959 ià(
j
->
code_b™s
 < 16è
	`¡bi__grow_bufãr_un§ã
(j);

1960 
t
 = 
	`¡bi__j³g_huff_decode
(
j
, 
hdc
);

1961 ià(
t
 < 0è 
	`¡bi__”r
("bad huffman code","Corrupt JPEG");

1964 
	`mem£t
(
d©a
,0,64*(data[0]));

1966 
diff
 = 
t
 ? 
	`¡bi__ex‹nd_»ûive
(
j
,) : 0;

1967 
dc
 = 
j
->
img_comp
[
b
].
dc_´ed
 + 
diff
;

1968 
j
->
img_comp
[
b
].
dc_´ed
 = 
dc
;

1969 
d©a
[0] = (è(
dc
 * 
dequªt
[0]);

1972 
k
 = 1;

1974 
zig
;

1975 
c
,
r
,
s
;

1976 ià(
j
->
code_b™s
 < 16è
	`¡bi__grow_bufãr_un§ã
(j);

1977 
c
 = (
j
->
code_bufãr
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

1978 
r
 = 
çc
[
c
];

1979 ià(
r
) {

1980 
k
 +ğ(
r
 >> 4) & 15;

1981 
s
 = 
r
 & 15;

1982 
j
->
code_bufãr
 <<ğ
s
;

1983 
j
->
code_b™s
 -ğ
s
;

1985 
zig
 = 
¡bi__j³g_dezigzag
[
k
++];

1986 
d©a
[
zig
] = (è((
r
 >> 8è* 
dequªt
[zig]);

1988 
rs
 = 
	`¡bi__j³g_huff_decode
(
j
, 
hac
);

1989 ià(
rs
 < 0è 
	`¡bi__”r
("bad huffman code","Corrupt JPEG");

1990 
s
 = 
rs
 & 15;

1991 
r
 = 
rs
 >> 4;

1992 ià(
s
 == 0) {

1993 ià(
rs
 != 0xf0) ;

1994 
k
 += 16;

1996 
k
 +ğ
r
;

1998 
zig
 = 
¡bi__j³g_dezigzag
[
k
++];

1999 
d©a
[
zig
] = (è(
	`¡bi__ex‹nd_»ûive
(
j
,
s
è* 
dequªt
[zig]);

2002 } 
k
 < 64);

2004 
	}
}

2006 
	$¡bi__j³g_decode_block_´og_dc
(
¡bi__j³g
 *
j
, 
d©a
[64], 
¡bi__huffmª
 *
hdc
, 
b
)

2008 
diff
,
dc
;

2009 
t
;

2010 ià(
j
->
¥ec_’d
 !ğ0è 
	`¡bi__”r
("can't merge dc‡nd‡c", "Corrupt JPEG");

2012 ià(
j
->
code_b™s
 < 16è
	`¡bi__grow_bufãr_un§ã
(j);

2014 ià(
j
->
succ_high
 == 0) {

2016 
	`mem£t
(
d©a
,0,64*(data[0]));

2017 
t
 = 
	`¡bi__j³g_huff_decode
(
j
, 
hdc
);

2018 
diff
 = 
t
 ? 
	`¡bi__ex‹nd_»ûive
(
j
,) : 0;

2020 
dc
 = 
j
->
img_comp
[
b
].
dc_´ed
 + 
diff
;

2021 
j
->
img_comp
[
b
].
dc_´ed
 = 
dc
;

2022 
d©a
[0] = (è(
dc
 << 
j
->
succ_low
);

2025 ià(
	`¡bi__j³g_g‘_b™
(
j
))

2026 
d©a
[0] +ğ(è(1 << 
j
->
succ_low
);

2029 
	}
}

2033 
	$¡bi__j³g_decode_block_´og_ac
(
¡bi__j³g
 *
j
, 
d©a
[64], 
¡bi__huffmª
 *
hac
, 
¡bi__št16
 *
çc
)

2035 
k
;

2036 ià(
j
->
¥ec_¡¬t
 =ğ0è 
	`¡bi__”r
("can't merge dc‡nd‡c", "Corrupt JPEG");

2038 ià(
j
->
succ_high
 == 0) {

2039 
shiá
 = 
j
->
succ_low
;

2041 ià(
j
->
eob_run
) {

2042 --
j
->
eob_run
;

2046 
k
 = 
j
->
¥ec_¡¬t
;

2048 
zig
;

2049 
c
,
r
,
s
;

2050 ià(
j
->
code_b™s
 < 16è
	`¡bi__grow_bufãr_un§ã
(j);

2051 
c
 = (
j
->
code_bufãr
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2052 
r
 = 
çc
[
c
];

2053 ià(
r
) {

2054 
k
 +ğ(
r
 >> 4) & 15;

2055 
s
 = 
r
 & 15;

2056 
j
->
code_bufãr
 <<ğ
s
;

2057 
j
->
code_b™s
 -ğ
s
;

2058 
zig
 = 
¡bi__j³g_dezigzag
[
k
++];

2059 
d©a
[
zig
] = (è((
r
 >> 8è<< 
shiá
);

2061 
rs
 = 
	`¡bi__j³g_huff_decode
(
j
, 
hac
);

2062 ià(
rs
 < 0è 
	`¡bi__”r
("bad huffman code","Corrupt JPEG");

2063 
s
 = 
rs
 & 15;

2064 
r
 = 
rs
 >> 4;

2065 ià(
s
 == 0) {

2066 ià(
r
 < 15) {

2067 
j
->
eob_run
 = (1 << 
r
);

2068 ià(
r
)

2069 
j
->
eob_run
 +ğ
	`¡bi__j³g_g‘_b™s
(j, 
r
);

2070 --
j
->
eob_run
;

2073 
k
 += 16;

2075 
k
 +ğ
r
;

2076 
zig
 = 
¡bi__j³g_dezigzag
[
k
++];

2077 
d©a
[
zig
] = (è(
	`¡bi__ex‹nd_»ûive
(
j
,
s
è<< 
shiá
);

2080 } 
k
 <ğ
j
->
¥ec_’d
);

2084 
b™
 = (è(1 << 
j
->
succ_low
);

2086 ià(
j
->
eob_run
) {

2087 --
j
->
eob_run
;

2088 
k
 = 
j
->
¥ec_¡¬t
; k <ğj->
¥ec_’d
; ++k) {

2089 *
p
 = &
d©a
[
¡bi__j³g_dezigzag
[
k
]];

2090 ià(*
p
 != 0)

2091 ià(
	`¡bi__j³g_g‘_b™
(
j
))

2092 ià((*
p
 & 
b™
)==0) {

2093 ià(*
p
 > 0)

2094 *
p
 +ğ
b™
;

2096 *
p
 -ğ
b™
;

2100 
k
 = 
j
->
¥ec_¡¬t
;

2102 
r
,
s
;

2103 
rs
 = 
	`¡bi__j³g_huff_decode
(
j
, 
hac
);

2104 ià(
rs
 < 0è 
	`¡bi__”r
("bad huffman code","Corrupt JPEG");

2105 
s
 = 
rs
 & 15;

2106 
r
 = 
rs
 >> 4;

2107 ià(
s
 == 0) {

2108 ià(
r
 < 15) {

2109 
j
->
eob_run
 = (1 << 
r
) - 1;

2110 ià(
r
)

2111 
j
->
eob_run
 +ğ
	`¡bi__j³g_g‘_b™s
(j, 
r
);

2112 
r
 = 64;

2119 ià(
s
 !ğ1è 
	`¡bi__”r
("bad huffman code", "Corrupt JPEG");

2121 ià(
	`¡bi__j³g_g‘_b™
(
j
))

2122 
s
 = 
b™
;

2124 
s
 = -
b™
;

2128 
k
 <ğ
j
->
¥ec_’d
) {

2129 *
p
 = &
d©a
[
¡bi__j³g_dezigzag
[
k
++]];

2130 ià(*
p
 != 0) {

2131 ià(
	`¡bi__j³g_g‘_b™
(
j
))

2132 ià((*
p
 & 
b™
)==0) {

2133 ià(*
p
 > 0)

2134 *
p
 +ğ
b™
;

2136 *
p
 -ğ
b™
;

2139 ià(
r
 == 0) {

2140 *
p
 = (è
s
;

2143 --
r
;

2146 } 
k
 <ğ
j
->
¥ec_’d
);

2150 
	}
}

2153 
¡bi_šlše
 
¡bi_uc
 
	$¡bi__şamp
(
x
)

2156 ià((è
x
 > 255) {

2157 ià(
x
 < 0)  0;

2158 ià(
x
 > 255)  255;

2160  (
¡bi_uc
è
x
;

2161 
	}
}

2163 
	#¡bi__f2f
(
x
è((è(((xè* 4096 + 0.5)))

	)

2164 
	#¡bi__fsh
(
x
è((xè* 4096)

	)

2167 
	#STBI__IDCT_1D
(
s0
,
s1
,
s2
,
s3
,
s4
,
s5
,
s6
,
s7
) \

2168 
t0
,
t1
,
t2
,
t3
,
p1
,
p2
,
p3
,
p4
,
p5
,
x0
,
x1
,
x2
,
x3
; \

2169 
p2
 = 
s2
; \

2170 
p3
 = 
s6
; \

2171 
p1
 = (
p2
+
p3
è* 
	`¡bi__f2f
(0.5411961f); \

2172 
t2
 = 
p1
 + 
p3
*
	`¡bi__f2f
(-1.847759065f); \

2173 
t3
 = 
p1
 + 
p2
*
	`¡bi__f2f
( 0.765366865f); \

2174 
p2
 = 
s0
; \

2175 
p3
 = 
s4
; \

2176 
t0
 = 
	`¡bi__fsh
(
p2
+
p3
); \

2177 
t1
 = 
	`¡bi__fsh
(
p2
-
p3
); \

2178 
x0
 = 
t0
+
t3
; \

2179 
x3
 = 
t0
-
t3
; \

2180 
x1
 = 
t1
+
t2
; \

2181 
x2
 = 
t1
-
t2
; \

2182 
t0
 = 
s7
; \

2183 
t1
 = 
s5
; \

2184 
t2
 = 
s3
; \

2185 
t3
 = 
s1
; \

2186 
p3
 = 
t0
+
t2
; \

2187 
p4
 = 
t1
+
t3
; \

2188 
p1
 = 
t0
+
t3
; \

2189 
p2
 = 
t1
+
t2
; \

2190 
p5
 = (
p3
+
p4
)*
	`¡bi__f2f
( 1.175875602f); \

2191 
t0
 =0*
	`¡bi__f2f
( 0.298631336f); \

2192 
t1
 =1*
	`¡bi__f2f
( 2.053119869f); \

2193 
t2
 =2*
	`¡bi__f2f
( 3.072711026f); \

2194 
t3
 =3*
	`¡bi__f2f
( 1.501321110f); \

2195 
p1
 = 
p5
 +…1*
	`¡bi__f2f
(-0.899976223f); \

2196 
p2
 = 
p5
 +…2*
	`¡bi__f2f
(-2.562915447f); \

2197 
p3
 =…3*
	`¡bi__f2f
(-1.961570560f); \

2198 
p4
 =…4*
	`¡bi__f2f
(-0.390180644f); \

2199 
t3
 +ğ
p1
+
p4
; \

2200 
t2
 +ğ
p2
+
p3
; \

2201 
t1
 +ğ
p2
+
p4
; \

2202 
t0
 +ğ
p1
+
p3
;

	)

2204 
	$¡bi__idù_block
(
¡bi_uc
 *
out
, 
out_¡ride
, 
d©a
[64])

2206 
i
,
v®
[64],*
v
=val;

2207 
¡bi_uc
 *
o
;

2208 *
d
 = 
d©a
;

2211 
i
=0; i < 8; ++i,++
d
, ++
v
) {

2213 ià(
d
[ 8]==0 && d[16]==0 && d[24]==0 && d[32]==0

2214 && 
d
[40]==0 && d[48]==0 && d[56]==0) {

2219 
dù”m
 = 
d
[0]*4;

2220 
v
[0] = v[8] = v[16] = v[24] = v[32] = v[40] = v[48] = v[56] = 
dù”m
;

2222 
	`STBI__IDCT_1D
(
d
[ 0],d[ 8],d[16],d[24],d[32],d[40],d[48],d[56])

2225 
x0
 +ğ512; 
x1
 +ğ512; 
x2
 +ğ512; 
x3
 += 512;

2226 
v
[ 0] = (
x0
+
t3
) >> 10;

2227 
v
[56] = (
x0
-
t3
) >> 10;

2228 
v
[ 8] = (
x1
+
t2
) >> 10;

2229 
v
[48] = (
x1
-
t2
) >> 10;

2230 
v
[16] = (
x2
+
t1
) >> 10;

2231 
v
[40] = (
x2
-
t1
) >> 10;

2232 
v
[24] = (
x3
+
t0
) >> 10;

2233 
v
[32] = (
x3
-
t0
) >> 10;

2237 
i
=0, 
v
=
v®
, 
o
=
out
; i < 8; ++i,v+=8,o+=
out_¡ride
) {

2239 
	`STBI__IDCT_1D
(
v
[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7])

2246 
x0
 += 65536 + (128<<17);

2247 
x1
 += 65536 + (128<<17);

2248 
x2
 += 65536 + (128<<17);

2249 
x3
 += 65536 + (128<<17);

2252 
o
[0] = 
	`¡bi__şamp
((
x0
+
t3
) >> 17);

2253 
o
[7] = 
	`¡bi__şamp
((
x0
-
t3
) >> 17);

2254 
o
[1] = 
	`¡bi__şamp
((
x1
+
t2
) >> 17);

2255 
o
[6] = 
	`¡bi__şamp
((
x1
-
t2
) >> 17);

2256 
o
[2] = 
	`¡bi__şamp
((
x2
+
t1
) >> 17);

2257 
o
[5] = 
	`¡bi__şamp
((
x2
-
t1
) >> 17);

2258 
o
[3] = 
	`¡bi__şamp
((
x3
+
t0
) >> 17);

2259 
o
[4] = 
	`¡bi__şamp
((
x3
-
t0
) >> 17);

2261 
	}
}

2263 #ifdeà
STBI_SSE2


2267 
	$¡bi__idù_simd
(
¡bi_uc
 *
out
, 
out_¡ride
, 
d©a
[64])

2270 
__m128i
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2271 
__m128i
 
tmp
;

2274 
	#dù_cÚ¡
(
x
,
y
è
	`_mm_£Œ_•i16
((x),(y),(x),(y),(x),(y),(x),(y))

	)

2278 
	#dù_rÙ
(
out0
,
out1
, 
x
,
y
,
c0
,
c1
) \

2279 
__m128i
 
c0
##
lo
 = 
	`_mm_uÅacklo_•i16
((
x
),(
y
)); \

2280 
__m128i
 
c0
##
hi
 = 
	`_mm_uÅackhi_•i16
((
x
),(
y
)); \

2281 
__m128i
 
out0
##
_l
 = 
	`_mm_madd_•i16
(
c0
##
lo
, c0); \

2282 
__m128i
 
out0
##
_h
 = 
	`_mm_madd_•i16
(
c0
##
hi
, c0); \

2283 
__m128i
 
out1
##
_l
 = 
	`_mm_madd_•i16
(
c0
##
lo
, 
c1
); \

2284 
__m128i
 
out1
##
_h
 = 
	`_mm_madd_•i16
(
c0
##
hi
, 
c1
)

	)

2287 
	#dù_wid’
(
out
, 
š
) \

2288 
__m128i
 
out
##
_l
 = 
	`_mm_¤ai_•i32
(
	`_mm_uÅacklo_•i16
(
	`_mm_£tz”o_si128
(), (
š
)), 4); \

2289 
__m128i
 
out
##
_h
 = 
	`_mm_¤ai_•i32
(
	`_mm_uÅackhi_•i16
(
	`_mm_£tz”o_si128
(), (
š
)), 4)

	)

2292 
	#dù_wadd
(
out
, 
a
, 
b
) \

2293 
__m128i
 
out
##
_l
 = 
	`_mm_add_•i32
(
a
##_l, 
b
##_l); \

2294 
__m128i
 
out
##
_h
 = 
	`_mm_add_•i32
(
a
##_h, 
b
##_h)

	)

2297 
	#dù_wsub
(
out
, 
a
, 
b
) \

2298 
__m128i
 
out
##
_l
 = 
	`_mm_sub_•i32
(
a
##_l, 
b
##_l); \

2299 
__m128i
 
out
##
_h
 = 
	`_mm_sub_•i32
(
a
##_h, 
b
##_h)

	)

2302 
	#dù_bæy32o
(
out0
, 
out1
, 
a
,
b
,
bŸs
,
s
) \

2304 
__m128i
 
abŸ£d_l
 = 
	`_mm_add_•i32
(
a
##
_l
, 
bŸs
); \

2305 
__m128i
 
abŸ£d_h
 = 
	`_mm_add_•i32
(
a
##
_h
, 
bŸs
); \

2306 
	`dù_wadd
(
sum
, 
abŸ£d
, 
b
); \

2307 
	`dù_wsub
(
dif
, 
abŸ£d
, 
b
); \

2308 
out0
 = 
	`_mm_·cks_•i32
(
	`_mm_¤ai_•i32
(
sum_l
, 
s
), _mm_¤ai_•i32(
sum_h
, s)); \

2309 
out1
 = 
	`_mm_·cks_•i32
(
	`_mm_¤ai_•i32
(
dif_l
, 
s
), _mm_¤ai_•i32(
dif_h
, s)); \

2310 }

	)

2313 
	#dù_š‹¾—ve8
(
a
, 
b
) \

2314 
tmp
 = 
a
; \

2315 
a
 = 
	`_mm_uÅacklo_•i8
×, 
b
); \

2316 
b
 = 
	`_mm_uÅackhi_•i8
(
tmp
, b)

	)

2319 
	#dù_š‹¾—ve16
(
a
, 
b
) \

2320 
tmp
 = 
a
; \

2321 
a
 = 
	`_mm_uÅacklo_•i16
×, 
b
); \

2322 
b
 = 
	`_mm_uÅackhi_•i16
(
tmp
, b)

	)

2324 
	#dù_·ss
(
bŸs
,
shiá
) \

2327 
	`dù_rÙ
(
t2e
,
t3e
, 
row2
,
row6
, 
rÙ0_0
,
rÙ0_1
); \

2328 
__m128i
 
sum04
 = 
	`_mm_add_•i16
(
row0
, 
row4
); \

2329 
__m128i
 
dif04
 = 
	`_mm_sub_•i16
(
row0
, 
row4
); \

2330 
	`dù_wid’
(
t0e
, 
sum04
); \

2331 
	`dù_wid’
(
t1e
, 
dif04
); \

2332 
	`dù_wadd
(
x0
, 
t0e
, 
t3e
); \

2333 
	`dù_wsub
(
x3
, 
t0e
, 
t3e
); \

2334 
	`dù_wadd
(
x1
, 
t1e
, 
t2e
); \

2335 
	`dù_wsub
(
x2
, 
t1e
, 
t2e
); \

2337 
	`dù_rÙ
(
y0o
,
y2o
, 
row7
,
row3
, 
rÙ2_0
,
rÙ2_1
); \

2338 
	`dù_rÙ
(
y1o
,
y3o
, 
row5
,
row1
, 
rÙ3_0
,
rÙ3_1
); \

2339 
__m128i
 
sum17
 = 
	`_mm_add_•i16
(
row1
, 
row7
); \

2340 
__m128i
 
sum35
 = 
	`_mm_add_•i16
(
row3
, 
row5
); \

2341 
	`dù_rÙ
(
y4o
,
y5o
, 
sum17
,
sum35
, 
rÙ1_0
,
rÙ1_1
); \

2342 
	`dù_wadd
(
x4
, 
y0o
, 
y4o
); \

2343 
	`dù_wadd
(
x5
, 
y1o
, 
y5o
); \

2344 
	`dù_wadd
(
x6
, 
y2o
, 
y5o
); \

2345 
	`dù_wadd
(
x7
, 
y3o
, 
y4o
); \

2346 
	`dù_bæy32o
(
row0
,
row7
, 
x0
,
x7
,
bŸs
,
shiá
); \

2347 
	`dù_bæy32o
(
row1
,
row6
, 
x1
,
x6
,
bŸs
,
shiá
); \

2348 
	`dù_bæy32o
(
row2
,
row5
, 
x2
,
x5
,
bŸs
,
shiá
); \

2349 
	`dù_bæy32o
(
row3
,
row4
, 
x3
,
x4
,
bŸs
,
shiá
); \

2350 }

	)

2352 
__m128i
 
rÙ0_0
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(0.5411961f), stbi__f2f(0.5411961f) + stbi__f2f(-1.847759065f));

2353 
__m128i
 
rÙ0_1
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(0.5411961f) + stbi__f2f( 0.765366865f), stbi__f2f(0.5411961f));

2354 
__m128i
 
rÙ1_0
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(1.175875602f) + stbi__f2f(-0.899976223f), stbi__f2f(1.175875602f));

2355 
__m128i
 
rÙ1_1
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(1.175875602f), stbi__f2f(1.175875602f) + stbi__f2f(-2.562915447f));

2356 
__m128i
 
rÙ2_0
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(-1.961570560f) + stbi__f2f( 0.298631336f), stbi__f2f(-1.961570560f));

2357 
__m128i
 
rÙ2_1
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(-1.961570560f), stbi__f2f(-1.961570560f) + stbi__f2f( 3.072711026f));

2358 
__m128i
 
rÙ3_0
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(-0.390180644f) + stbi__f2f( 2.053119869f), stbi__f2f(-0.390180644f));

2359 
__m128i
 
rÙ3_1
 = 
	`dù_cÚ¡
(
	`¡bi__f2f
(-0.390180644f), stbi__f2f(-0.390180644f) + stbi__f2f( 1.501321110f));

2362 
__m128i
 
bŸs_0
 = 
	`_mm_£t1_•i32
(512);

2363 
__m128i
 
bŸs_1
 = 
	`_mm_£t1_•i32
(65536 + (128<<17));

2366 
row0
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 0*8));

2367 
row1
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 1*8));

2368 
row2
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 2*8));

2369 
row3
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 3*8));

2370 
row4
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 4*8));

2371 
row5
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 5*8));

2372 
row6
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 6*8));

2373 
row7
 = 
	`_mm_lßd_si128
((cÚ¡ 
__m128i
 *è(
d©a
 + 7*8));

2376 
	`dù_·ss
(
bŸs_0
, 10);

2380 
	`dù_š‹¾—ve16
(
row0
, 
row4
);

2381 
	`dù_š‹¾—ve16
(
row1
, 
row5
);

2382 
	`dù_š‹¾—ve16
(
row2
, 
row6
);

2383 
	`dù_š‹¾—ve16
(
row3
, 
row7
);

2386 
	`dù_š‹¾—ve16
(
row0
, 
row2
);

2387 
	`dù_š‹¾—ve16
(
row1
, 
row3
);

2388 
	`dù_š‹¾—ve16
(
row4
, 
row6
);

2389 
	`dù_š‹¾—ve16
(
row5
, 
row7
);

2392 
	`dù_š‹¾—ve16
(
row0
, 
row1
);

2393 
	`dù_š‹¾—ve16
(
row2
, 
row3
);

2394 
	`dù_š‹¾—ve16
(
row4
, 
row5
);

2395 
	`dù_š‹¾—ve16
(
row6
, 
row7
);

2399 
	`dù_·ss
(
bŸs_1
, 17);

2403 
__m128i
 
p0
 = 
	`_mm_·ckus_•i16
(
row0
, 
row1
);

2404 
__m128i
 
p1
 = 
	`_mm_·ckus_•i16
(
row2
, 
row3
);

2405 
__m128i
 
p2
 = 
	`_mm_·ckus_•i16
(
row4
, 
row5
);

2406 
__m128i
 
p3
 = 
	`_mm_·ckus_•i16
(
row6
, 
row7
);

2409 
	`dù_š‹¾—ve8
(
p0
, 
p2
);

2410 
	`dù_š‹¾—ve8
(
p1
, 
p3
);

2413 
	`dù_š‹¾—ve8
(
p0
, 
p1
);

2414 
	`dù_š‹¾—ve8
(
p2
, 
p3
);

2417 
	`dù_š‹¾—ve8
(
p0
, 
p2
);

2418 
	`dù_š‹¾—ve8
(
p1
, 
p3
);

2421 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
p0
); ouˆ+ğ
out_¡ride
;

2422 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
	`_mm_shufæe_•i32
(
p0
, 0x4e)); ouˆ+ğ
out_¡ride
;

2423 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
p2
); ouˆ+ğ
out_¡ride
;

2424 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
	`_mm_shufæe_•i32
(
p2
, 0x4e)); ouˆ+ğ
out_¡ride
;

2425 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
p1
); ouˆ+ğ
out_¡ride
;

2426 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
	`_mm_shufæe_•i32
(
p1
, 0x4e)); ouˆ+ğ
out_¡ride
;

2427 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
p3
); ouˆ+ğ
out_¡ride
;

2428 
	`_mm_¡Ü–_•i64
((
__m128i
 *è
out
, 
	`_mm_shufæe_•i32
(
p3
, 0x4e));

2431 #undeà
dù_cÚ¡


2432 #undeà
dù_rÙ


2433 #undeà
dù_wid’


2434 #undeà
dù_wadd


2435 #undeà
dù_wsub


2436 #undeà
dù_bæy32o


2437 #undeà
dù_š‹¾—ve8


2438 #undeà
dù_š‹¾—ve16


2439 #undeà
dù_·ss


2440 
	}
}

2444 #ifdeà
STBI_NEON


2448 
	$¡bi__idù_simd
(
¡bi_uc
 *
out
, 
out_¡ride
, 
d©a
[64])

2450 
št16x8_t
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2452 
št16x4_t
 
rÙ0_0
 = 
	`vdup_n_s16
(
	`¡bi__f2f
(0.5411961f));

2453 
št16x4_t
 
rÙ0_1
 = 
	`vdup_n_s16
(
	`¡bi__f2f
(-1.847759065f));

2454 
št16x4_t
 
rÙ0_2
 = 
	`vdup_n_s16
(
	`¡bi__f2f
( 0.765366865f));

2455 
št16x4_t
 
rÙ1_0
 = 
	`vdup_n_s16
(
	`¡bi__f2f
( 1.175875602f));

2456 
št16x4_t
 
rÙ1_1
 = 
	`vdup_n_s16
(
	`¡bi__f2f
(-0.899976223f));

2457 
št16x4_t
 
rÙ1_2
 = 
	`vdup_n_s16
(
	`¡bi__f2f
(-2.562915447f));

2458 
št16x4_t
 
rÙ2_0
 = 
	`vdup_n_s16
(
	`¡bi__f2f
(-1.961570560f));

2459 
št16x4_t
 
rÙ2_1
 = 
	`vdup_n_s16
(
	`¡bi__f2f
(-0.390180644f));

2460 
št16x4_t
 
rÙ3_0
 = 
	`vdup_n_s16
(
	`¡bi__f2f
( 0.298631336f));

2461 
št16x4_t
 
rÙ3_1
 = 
	`vdup_n_s16
(
	`¡bi__f2f
( 2.053119869f));

2462 
št16x4_t
 
rÙ3_2
 = 
	`vdup_n_s16
(
	`¡bi__f2f
( 3.072711026f));

2463 
št16x4_t
 
rÙ3_3
 = 
	`vdup_n_s16
(
	`¡bi__f2f
( 1.501321110f));

2465 
	#dù_lÚg_mul
(
out
, 
šq
, 
cÛff
) \

2466 
št32x4_t
 
out
##
_l
 = 
	`vmuÎ_s16
(
	`vg‘_low_s16
(
šq
), 
cÛff
); \

2467 
št32x4_t
 
out
##
_h
 = 
	`vmuÎ_s16
(
	`vg‘_high_s16
(
šq
), 
cÛff
)

	)

2469 
	#dù_lÚg_mac
(
out
, 
acc
, 
šq
, 
cÛff
) \

2470 
št32x4_t
 
out
##
_l
 = 
	`vmÏl_s16
(
acc
##_l, 
	`vg‘_low_s16
(
šq
), 
cÛff
); \

2471 
št32x4_t
 
out
##
_h
 = 
	`vmÏl_s16
(
acc
##_h, 
	`vg‘_high_s16
(
šq
), 
cÛff
)

	)

2473 
	#dù_wid’
(
out
, 
šq
) \

2474 
št32x4_t
 
out
##
_l
 = 
	`vshÎ_n_s16
(
	`vg‘_low_s16
(
šq
), 12); \

2475 
št32x4_t
 
out
##
_h
 = 
	`vshÎ_n_s16
(
	`vg‘_high_s16
(
šq
), 12)

	)

2478 
	#dù_wadd
(
out
, 
a
, 
b
) \

2479 
št32x4_t
 
out
##
_l
 = 
	`vaddq_s32
(
a
##_l, 
b
##_l); \

2480 
št32x4_t
 
out
##
_h
 = 
	`vaddq_s32
(
a
##_h, 
b
##_h)

	)

2483 
	#dù_wsub
(
out
, 
a
, 
b
) \

2484 
št32x4_t
 
out
##
_l
 = 
	`vsubq_s32
(
a
##_l, 
b
##_l); \

2485 
št32x4_t
 
out
##
_h
 = 
	`vsubq_s32
(
a
##_h, 
b
##_h)

	)

2488 
	#dù_bæy32o
(
out0
,
out1
, 
a
,
b
,
shiáİ
,
s
) \

2490 
	`dù_wadd
(
sum
, 
a
, 
b
); \

2491 
	`dù_wsub
(
dif
, 
a
, 
b
); \

2492 
out0
 = 
	`vcombše_s16
(
	`shiáİ
(
sum_l
, 
s
), shiáİ(
sum_h
, s)); \

2493 
out1
 = 
	`vcombše_s16
(
	`shiáİ
(
dif_l
, 
s
), shiáİ(
dif_h
, s)); \

2494 }

	)

2496 
	#dù_·ss
(
shiáİ
, 
shiá
) \

2499 
št16x8_t
 
sum26
 = 
	`vaddq_s16
(
row2
, 
row6
); \

2500 
	`dù_lÚg_mul
(
p1e
, 
sum26
, 
rÙ0_0
); \

2501 
	`dù_lÚg_mac
(
t2e
, 
p1e
, 
row6
, 
rÙ0_1
); \

2502 
	`dù_lÚg_mac
(
t3e
, 
p1e
, 
row2
, 
rÙ0_2
); \

2503 
št16x8_t
 
sum04
 = 
	`vaddq_s16
(
row0
, 
row4
); \

2504 
št16x8_t
 
dif04
 = 
	`vsubq_s16
(
row0
, 
row4
); \

2505 
	`dù_wid’
(
t0e
, 
sum04
); \

2506 
	`dù_wid’
(
t1e
, 
dif04
); \

2507 
	`dù_wadd
(
x0
, 
t0e
, 
t3e
); \

2508 
	`dù_wsub
(
x3
, 
t0e
, 
t3e
); \

2509 
	`dù_wadd
(
x1
, 
t1e
, 
t2e
); \

2510 
	`dù_wsub
(
x2
, 
t1e
, 
t2e
); \

2512 
št16x8_t
 
sum15
 = 
	`vaddq_s16
(
row1
, 
row5
); \

2513 
št16x8_t
 
sum17
 = 
	`vaddq_s16
(
row1
, 
row7
); \

2514 
št16x8_t
 
sum35
 = 
	`vaddq_s16
(
row3
, 
row5
); \

2515 
št16x8_t
 
sum37
 = 
	`vaddq_s16
(
row3
, 
row7
); \

2516 
št16x8_t
 
sumodd
 = 
	`vaddq_s16
(
sum17
, 
sum35
); \

2517 
	`dù_lÚg_mul
(
p5o
, 
sumodd
, 
rÙ1_0
); \

2518 
	`dù_lÚg_mac
(
p1o
, 
p5o
, 
sum17
, 
rÙ1_1
); \

2519 
	`dù_lÚg_mac
(
p2o
, 
p5o
, 
sum35
, 
rÙ1_2
); \

2520 
	`dù_lÚg_mul
(
p3o
, 
sum37
, 
rÙ2_0
); \

2521 
	`dù_lÚg_mul
(
p4o
, 
sum15
, 
rÙ2_1
); \

2522 
	`dù_wadd
(
sump13o
, 
p1o
, 
p3o
); \

2523 
	`dù_wadd
(
sump24o
, 
p2o
, 
p4o
); \

2524 
	`dù_wadd
(
sump23o
, 
p2o
, 
p3o
); \

2525 
	`dù_wadd
(
sump14o
, 
p1o
, 
p4o
); \

2526 
	`dù_lÚg_mac
(
x4
, 
sump13o
, 
row7
, 
rÙ3_0
); \

2527 
	`dù_lÚg_mac
(
x5
, 
sump24o
, 
row5
, 
rÙ3_1
); \

2528 
	`dù_lÚg_mac
(
x6
, 
sump23o
, 
row3
, 
rÙ3_2
); \

2529 
	`dù_lÚg_mac
(
x7
, 
sump14o
, 
row1
, 
rÙ3_3
); \

2530 
	`dù_bæy32o
(
row0
,
row7
, 
x0
,
x7
,
shiáİ
,
shiá
); \

2531 
	`dù_bæy32o
(
row1
,
row6
, 
x1
,
x6
,
shiáİ
,
shiá
); \

2532 
	`dù_bæy32o
(
row2
,
row5
, 
x2
,
x5
,
shiáİ
,
shiá
); \

2533 
	`dù_bæy32o
(
row3
,
row4
, 
x3
,
x4
,
shiáİ
,
shiá
); \

2534 }

	)

2537 
row0
 = 
	`vld1q_s16
(
d©a
 + 0*8);

2538 
row1
 = 
	`vld1q_s16
(
d©a
 + 1*8);

2539 
row2
 = 
	`vld1q_s16
(
d©a
 + 2*8);

2540 
row3
 = 
	`vld1q_s16
(
d©a
 + 3*8);

2541 
row4
 = 
	`vld1q_s16
(
d©a
 + 4*8);

2542 
row5
 = 
	`vld1q_s16
(
d©a
 + 5*8);

2543 
row6
 = 
	`vld1q_s16
(
d©a
 + 6*8);

2544 
row7
 = 
	`vld1q_s16
(
d©a
 + 7*8);

2547 
row0
 = 
	`vaddq_s16
Ôow0, 
	`v£tq_ÏÃ_s16
(1024, 
	`vdupq_n_s16
(0), 0));

2550 
	`dù_·ss
(
vrshº_n_s32
, 10);

2556 
	#dù_Œn16
(
x
, 
y
è{ 
št16x8x2_t
 
t
 = 
	`vŒnq_s16
(x, y); x =.
v®
[0]; y =.v®[1]; }

	)

2557 
	#dù_Œn32
(
x
, 
y
è{ 
št32x4x2_t
 
t
 = 
	`vŒnq_s32
(
	`v»š‹½»tq_s32_s16
(x), v»š‹½»tq_s32_s16(y)); x = 
	`v»š‹½»tq_s16_s32
Ñ.
v®
[0]); y = v»š‹½»tq_s16_s32Ñ.v®[1]); }

	)

2558 
	#dù_Œn64
(
x
, 
y
è{ 
št16x8_t
 
x0
 = x; iÁ16x8_ˆ
y0
 = y; x = 
	`vcombše_s16
(
	`vg‘_low_s16
(x0), vg‘_low_s16(y0)); y = vcombše_s16(
	`vg‘_high_s16
(x0), vg‘_high_s16(y0)); }

	)

2561 
	`dù_Œn16
(
row0
, 
row1
);

2562 
	`dù_Œn16
(
row2
, 
row3
);

2563 
	`dù_Œn16
(
row4
, 
row5
);

2564 
	`dù_Œn16
(
row6
, 
row7
);

2567 
	`dù_Œn32
(
row0
, 
row2
);

2568 
	`dù_Œn32
(
row1
, 
row3
);

2569 
	`dù_Œn32
(
row4
, 
row6
);

2570 
	`dù_Œn32
(
row5
, 
row7
);

2573 
	`dù_Œn64
(
row0
, 
row4
);

2574 
	`dù_Œn64
(
row1
, 
row5
);

2575 
	`dù_Œn64
(
row2
, 
row6
);

2576 
	`dù_Œn64
(
row3
, 
row7
);

2578 #undeà
dù_Œn16


2579 #undeà
dù_Œn32


2580 #undeà
dù_Œn64


2587 
	`dù_·ss
(
vshº_n_s32
, 16);

2591 
ušt8x8_t
 
p0
 = 
	`vqrshrun_n_s16
(
row0
, 1);

2592 
ušt8x8_t
 
p1
 = 
	`vqrshrun_n_s16
(
row1
, 1);

2593 
ušt8x8_t
 
p2
 = 
	`vqrshrun_n_s16
(
row2
, 1);

2594 
ušt8x8_t
 
p3
 = 
	`vqrshrun_n_s16
(
row3
, 1);

2595 
ušt8x8_t
 
p4
 = 
	`vqrshrun_n_s16
(
row4
, 1);

2596 
ušt8x8_t
 
p5
 = 
	`vqrshrun_n_s16
(
row5
, 1);

2597 
ušt8x8_t
 
p6
 = 
	`vqrshrun_n_s16
(
row6
, 1);

2598 
ušt8x8_t
 
p7
 = 
	`vqrshrun_n_s16
(
row7
, 1);

2601 
	#dù_Œn8_8
(
x
, 
y
è{ 
ušt8x8x2_t
 
t
 = 
	`vŒn_u8
(x, y); x =.
v®
[0]; y =.v®[1]; }

	)

2602 
	#dù_Œn8_16
(
x
, 
y
è{ 
ušt16x4x2_t
 
t
 = 
	`vŒn_u16
(
	`v»š‹½»t_u16_u8
(x), v»š‹½»t_u16_u8(y)); x = 
	`v»š‹½»t_u8_u16
Ñ.
v®
[0]); y = v»š‹½»t_u8_u16Ñ.v®[1]); }

	)

2603 
	#dù_Œn8_32
(
x
, 
y
è{ 
ušt32x2x2_t
 
t
 = 
	`vŒn_u32
(
	`v»š‹½»t_u32_u8
(x), v»š‹½»t_u32_u8(y)); x = 
	`v»š‹½»t_u8_u32
Ñ.
v®
[0]); y = v»š‹½»t_u8_u32Ñ.v®[1]); }

	)

2609 
	`dù_Œn8_8
(
p0
, 
p1
);

2610 
	`dù_Œn8_8
(
p2
, 
p3
);

2611 
	`dù_Œn8_8
(
p4
, 
p5
);

2612 
	`dù_Œn8_8
(
p6
, 
p7
);

2615 
	`dù_Œn8_16
(
p0
, 
p2
);

2616 
	`dù_Œn8_16
(
p1
, 
p3
);

2617 
	`dù_Œn8_16
(
p4
, 
p6
);

2618 
	`dù_Œn8_16
(
p5
, 
p7
);

2621 
	`dù_Œn8_32
(
p0
, 
p4
);

2622 
	`dù_Œn8_32
(
p1
, 
p5
);

2623 
	`dù_Œn8_32
(
p2
, 
p6
);

2624 
	`dù_Œn8_32
(
p3
, 
p7
);

2627 
	`v¡1_u8
(
out
, 
p0
); ouˆ+ğ
out_¡ride
;

2628 
	`v¡1_u8
(
out
, 
p1
); ouˆ+ğ
out_¡ride
;

2629 
	`v¡1_u8
(
out
, 
p2
); ouˆ+ğ
out_¡ride
;

2630 
	`v¡1_u8
(
out
, 
p3
); ouˆ+ğ
out_¡ride
;

2631 
	`v¡1_u8
(
out
, 
p4
); ouˆ+ğ
out_¡ride
;

2632 
	`v¡1_u8
(
out
, 
p5
); ouˆ+ğ
out_¡ride
;

2633 
	`v¡1_u8
(
out
, 
p6
); ouˆ+ğ
out_¡ride
;

2634 
	`v¡1_u8
(
out
, 
p7
);

2636 #undeà
dù_Œn8_8


2637 #undeà
dù_Œn8_16


2638 #undeà
dù_Œn8_32


2641 #undeà
dù_lÚg_mul


2642 #undeà
dù_lÚg_mac


2643 #undeà
dù_wid’


2644 #undeà
dù_wadd


2645 #undeà
dù_wsub


2646 #undeà
dù_bæy32o


2647 #undeà
dù_·ss


2648 
	}
}

2652 
	#STBI__MARKER_nÚe
 0xff

	)

2656 
¡bi_uc
 
	$¡bi__g‘_m¬k”
(
¡bi__j³g
 *
j
)

2658 
¡bi_uc
 
x
;

2659 ià(
j
->
m¬k”
 !ğ
STBI__MARKER_nÚe
è{ 
x
 = j->marker; j->marker = STBI__MARKER_none;  x; }

2660 
x
 = 
	`¡bi__g‘8
(
j
->
s
);

2661 ià(
x
 !ğ0xffè 
STBI__MARKER_nÚe
;

2662 
x
 == 0xff)

2663 
x
 = 
	`¡bi__g‘8
(
j
->
s
);

2664  
x
;

2665 
	}
}

2669 
	#STBI__RESTART
(
x
è((xè>ğ0xd0 && (xè<ğ0xd7)

	)

2673 
	$¡bi__j³g_»£t
(
¡bi__j³g
 *
j
)

2675 
j
->
code_b™s
 = 0;

2676 
j
->
code_bufãr
 = 0;

2677 
j
->
nomÜe
 = 0;

2678 
j
->
img_comp
[0].
dc_´ed
 = j->img_comp[1].dc_pred = j->img_comp[2].dc_pred = j->img_comp[3].dc_pred = 0;

2679 
j
->
m¬k”
 = 
STBI__MARKER_nÚe
;

2680 
j
->
todo
 = j->
»¡¬t_š‹rv®
 ? j->restart_interval : 0x7fffffff;

2681 
j
->
eob_run
 = 0;

2684 
	}
}

2686 
	$¡bi__·r£_’Œİy_coded_d©a
(
¡bi__j³g
 *
z
)

2688 
	`¡bi__j³g_»£t
(
z
);

2689 ià(!
z
->
´og»ssive
) {

2690 ià(
z
->
sÿn_n
 == 1) {

2691 
i
,
j
;

2692 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2693 
n
 = 
z
->
Üd”
[0];

2698 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2699 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2700 
j
=0; j < 
h
; ++j) {

2701 
i
=0; i < 
w
; ++i) {

2702 
ha
 = 
z
->
img_comp
[
n
].ha;

2703 ià(!
	`¡bi__j³g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
ç¡_ac
[ha],‚, z->
dequªt
[z->img_comp[n].
tq
]))  0;

2704 
z
->
	`idù_block_k”Ãl
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2706 ià(--
z
->
todo
 <= 0) {

2707 ià(
z
->
code_b™s
 < 24è
	`¡bi__grow_bufãr_un§ã
(z);

2710 ià(!
	`STBI__RESTART
(
z
->
m¬k”
))  1;

2711 
	`¡bi__j³g_»£t
(
z
);

2717 
i
,
j
,
k
,
x
,
y
;

2718 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2719 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2720 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2722 
k
=0; k < 
z
->
sÿn_n
; ++k) {

2723 
n
 = 
z
->
Üd”
[
k
];

2726 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2727 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2728 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
)*8;

2729 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
)*8;

2730 
ha
 = 
z
->
img_comp
[
n
].ha;

2731 ià(!
	`¡bi__j³g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
ç¡_ac
[ha],‚, z->
dequªt
[z->img_comp[n].
tq
]))  0;

2732 
z
->
	`idù_block_k”Ãl
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
y2
+
x2
, z->img_comp[n].w2, data);

2738 ià(--
z
->
todo
 <= 0) {

2739 ià(
z
->
code_b™s
 < 24è
	`¡bi__grow_bufãr_un§ã
(z);

2740 ià(!
	`STBI__RESTART
(
z
->
m¬k”
))  1;

2741 
	`¡bi__j³g_»£t
(
z
);

2748 ià(
z
->
sÿn_n
 == 1) {

2749 
i
,
j
;

2750 
n
 = 
z
->
Üd”
[0];

2755 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2756 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2757 
j
=0; j < 
h
; ++j) {

2758 
i
=0; i < 
w
; ++i) {

2759 *
d©a
 = 
z
->
img_comp
[
n
].
cÛff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
cÛff_w
);

2760 ià(
z
->
¥ec_¡¬t
 == 0) {

2761 ià(!
	`¡bi__j³g_decode_block_´og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],‚))

2764 
ha
 = 
z
->
img_comp
[
n
].ha;

2765 ià(!
	`¡bi__j³g_decode_block_´og_ac
(
z
, 
d©a
, &z->
huff_ac
[
ha
], z->
ç¡_ac
[ha]))

2769 ià(--
z
->
todo
 <= 0) {

2770 ià(
z
->
code_b™s
 < 24è
	`¡bi__grow_bufãr_un§ã
(z);

2771 ià(!
	`STBI__RESTART
(
z
->
m¬k”
))  1;

2772 
	`¡bi__j³g_»£t
(
z
);

2778 
i
,
j
,
k
,
x
,
y
;

2779 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2780 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2782 
k
=0; k < 
z
->
sÿn_n
; ++k) {

2783 
n
 = 
z
->
Üd”
[
k
];

2786 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2787 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2788 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
);

2789 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
);

2790 *
d©a
 = 
z
->
img_comp
[
n
].
cÛff
 + 64 * (
x2
 + 
y2
 * z->img_comp[n].
cÛff_w
);

2791 ià(!
	`¡bi__j³g_decode_block_´og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],‚))

2798 ià(--
z
->
todo
 <= 0) {

2799 ià(
z
->
code_b™s
 < 24è
	`¡bi__grow_bufãr_un§ã
(z);

2800 ià(!
	`STBI__RESTART
(
z
->
m¬k”
))  1;

2801 
	`¡bi__j³g_»£t
(
z
);

2808 
	}
}

2810 
	$¡bi__j³g_dequªtize
(*
d©a
, 
¡bi__ušt16
 *
dequªt
)

2812 
i
;

2813 
i
=0; i < 64; ++i)

2814 
d©a
[
i
] *ğ
dequªt
[i];

2815 
	}
}

2817 
	$¡bi__j³g_fšish
(
¡bi__j³g
 *
z
)

2819 ià(
z
->
´og»ssive
) {

2821 
i
,
j
,
n
;

2822 
n
=0;‚ < 
z
->
s
->
img_n
; ++n) {

2823 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2824 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2825 
j
=0; j < 
h
; ++j) {

2826 
i
=0; i < 
w
; ++i) {

2827 *
d©a
 = 
z
->
img_comp
[
n
].
cÛff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
cÛff_w
);

2828 
	`¡bi__j³g_dequªtize
(
d©a
, 
z
->
dequªt
[z->
img_comp
[
n
].
tq
]);

2829 
z
->
	`idù_block_k”Ãl
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2834 
	}
}

2836 
	$¡bi__´oûss_m¬k”
(
¡bi__j³g
 *
z
, 
m
)

2838 
L
;

2839 
m
) {

2840 
STBI__MARKER_nÚe
:

2841  
	`¡bi__”r
("expected marker","Corrupt JPEG");

2844 ià(
	`¡bi__g‘16be
(
z
->
s
è!ğ4è 
	`¡bi__”r
("bad DRI†en","Corrupt JPEG");

2845 
z
->
»¡¬t_š‹rv®
 = 
	`¡bi__g‘16be
(z->
s
);

2849 
L
 = 
	`¡bi__g‘16be
(
z
->
s
)-2;

2850 
L
 > 0) {

2851 
q
 = 
	`¡bi__g‘8
(
z
->
s
);

2852 
p
 = 
q
 >> 4, 
six‹’
 = (p != 0);

2853 
t
 = 
q
 & 15,
i
;

2854 ià(
p
 !ğ0 &&… !ğ1è 
	`¡bi__”r
("bad DQType","Corrupt JPEG");

2855 ià(
t
 > 3è 
	`¡bi__”r
("bad DQTable","Corrupt JPEG");

2857 
i
=0; i < 64; ++i)

2858 
z
->
dequªt
[
t
][
¡bi__j³g_dezigzag
[
i
]] = (
¡bi__ušt16
)(
six‹’
 ? 
	`¡bi__g‘16be
(z->
s
è: 
	`¡bi__g‘8
(z->s));

2859 
L
 -ğ(
six‹’
 ? 129 : 65);

2861  
L
==0;

2864 
L
 = 
	`¡bi__g‘16be
(
z
->
s
)-2;

2865 
L
 > 0) {

2866 
¡bi_uc
 *
v
;

2867 
sizes
[16],
i
,
n
=0;

2868 
q
 = 
	`¡bi__g‘8
(
z
->
s
);

2869 
tc
 = 
q
 >> 4;

2870 
th
 = 
q
 & 15;

2871 ià(
tc
 > 1 || 
th
 > 3è 
	`¡bi__”r
("bad DHT header","Corrupt JPEG");

2872 
i
=0; i < 16; ++i) {

2873 
sizes
[
i
] = 
	`¡bi__g‘8
(
z
->
s
);

2874 
n
 +ğ
sizes
[
i
];

2876 
L
 -= 17;

2877 ià(
tc
 == 0) {

2878 ià(!
	`¡bi__bud_huffmª
(
z
->
huff_dc
+
th
, 
sizes
))  0;

2879 
v
 = 
z
->
huff_dc
[
th
].
v®ues
;

2881 ià(!
	`¡bi__bud_huffmª
(
z
->
huff_ac
+
th
, 
sizes
))  0;

2882 
v
 = 
z
->
huff_ac
[
th
].
v®ues
;

2884 
i
=0; i < 
n
; ++i)

2885 
v
[
i
] = 
	`¡bi__g‘8
(
z
->
s
);

2886 ià(
tc
 != 0)

2887 
	`¡bi__bud_ç¡_ac
(
z
->
ç¡_ac
[
th
], z->
huff_ac
 +h);

2888 
L
 -ğ
n
;

2890  
L
==0;

2894 ià((
m
 >= 0xE0 && m <= 0xEF) || m == 0xFE) {

2895 
L
 = 
	`¡bi__g‘16be
(
z
->
s
);

2896 ià(
L
 < 2) {

2897 ià(
m
 == 0xFE)

2898  
	`¡bi__”r
("bad COM†en","Corrupt JPEG");

2900  
	`¡bi__”r
("bad APP†en","Corrupt JPEG");

2902 
L
 -= 2;

2904 ià(
m
 =ğ0xE0 && 
L
 >= 5) {

2905 cÚ¡ 
g
[5] = {'J','F','I','F','\0'};

2906 
ok
 = 1;

2907 
i
;

2908 
i
=0; i < 5; ++i)

2909 ià(
	`¡bi__g‘8
(
z
->
s
è!ğ
g
[
i
])

2910 
ok
 = 0;

2911 
L
 -= 5;

2912 ià(
ok
)

2913 
z
->
jfif
 = 1;

2914 } ià(
m
 =ğ0xEE && 
L
 >= 12) {

2915 cÚ¡ 
g
[6] = {'A','d','o','b','e','\0'};

2916 
ok
 = 1;

2917 
i
;

2918 
i
=0; i < 6; ++i)

2919 ià(
	`¡bi__g‘8
(
z
->
s
è!ğ
g
[
i
])

2920 
ok
 = 0;

2921 
L
 -= 6;

2922 ià(
ok
) {

2923 
	`¡bi__g‘8
(
z
->
s
);

2924 
	`¡bi__g‘16be
(
z
->
s
);

2925 
	`¡bi__g‘16be
(
z
->
s
);

2926 
z
->
­p14_cŞÜ_ŒªsfÜm
 = 
	`¡bi__g‘8
(z->
s
);

2927 
L
 -= 6;

2931 
	`¡bi__sk
(
z
->
s
, 
L
);

2935  
	`¡bi__”r
("unknown marker","Corrupt JPEG");

2936 
	}
}

2939 
	$¡bi__´oûss_sÿn_h—d”
(
¡bi__j³g
 *
z
)

2941 
i
;

2942 
Ls
 = 
	`¡bi__g‘16be
(
z
->
s
);

2943 
z
->
sÿn_n
 = 
	`¡bi__g‘8
(z->
s
);

2944 ià(
z
->
sÿn_n
 < 1 || z->sÿn_À> 4 || z->sÿn_À> (èz->
s
->
img_n
è 
	`¡bi__”r
("bad SOS component count","Corrupt JPEG");

2945 ià(
Ls
 !ğ6+2*
z
->
sÿn_n
è 
	`¡bi__”r
("bad SOS†en","Corrupt JPEG");

2946 
i
=0; i < 
z
->
sÿn_n
; ++i) {

2947 
id
 = 
	`¡bi__g‘8
(
z
->
s
), 
which
;

2948 
q
 = 
	`¡bi__g‘8
(
z
->
s
);

2949 
which
 = 0; which < 
z
->
s
->
img_n
; ++which)

2950 ià(
z
->
img_comp
[
which
].
id
 == id)

2952 ià(
which
 =ğ
z
->
s
->
img_n
)  0;

2953 
z
->
img_comp
[
which
].
hd
 = 
q
 >> 4; ià(z->img_comp[which].hd > 3è 
	`¡bi__”r
("bad DC huff","Corrupt JPEG");

2954 
z
->
img_comp
[
which
].
ha
 = 
q
 & 15; ià(z->img_comp[which].h¨> 3è 
	`¡bi__”r
("bad AC huff","Corrupt JPEG");

2955 
z
->
Üd”
[
i
] = 
which
;

2959 
¯
;

2960 
z
->
¥ec_¡¬t
 = 
	`¡bi__g‘8
(z->
s
);

2961 
z
->
¥ec_’d
 = 
	`¡bi__g‘8
(z->
s
);

2962 
¯
 = 
	`¡bi__g‘8
(
z
->
s
);

2963 
z
->
succ_high
 = (
¯
 >> 4);

2964 
z
->
succ_low
 = (
¯
 & 15);

2965 ià(
z
->
´og»ssive
) {

2966 ià(
z
->
¥ec_¡¬t
 > 63 || z->
¥ec_’d
 > 63 || z->¥ec_¡¬ˆ> z->¥ec_’d || z->
succ_high
 > 13 || z->
succ_low
 > 13)

2967  
	`¡bi__”r
("bad SOS", "Corrupt JPEG");

2969 ià(
z
->
¥ec_¡¬t
 !ğ0è 
	`¡bi__”r
("bad SOS","Corrupt JPEG");

2970 ià(
z
->
succ_high
 !ğ0 || z->
succ_low
 !ğ0è 
	`¡bi__”r
("bad SOS","Corrupt JPEG");

2971 
z
->
¥ec_’d
 = 63;

2976 
	}
}

2978 
	$¡bi__ä“_j³g_compÚ’ts
(
¡bi__j³g
 *
z
, 
ncomp
, 
why
)

2980 
i
;

2981 
i
=0; i < 
ncomp
; ++i) {

2982 ià(
z
->
img_comp
[
i
].
¿w_d©a
) {

2983 
	`STBI_FREE
(
z
->
img_comp
[
i
].
¿w_d©a
);

2984 
z
->
img_comp
[
i
].
¿w_d©a
 = 
NULL
;

2985 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

2987 ià(
z
->
img_comp
[
i
].
¿w_cÛff
) {

2988 
	`STBI_FREE
(
z
->
img_comp
[
i
].
¿w_cÛff
);

2989 
z
->
img_comp
[
i
].
¿w_cÛff
 = 0;

2990 
z
->
img_comp
[
i
].
cÛff
 = 0;

2992 ià(
z
->
img_comp
[
i
].
lšebuf
) {

2993 
	`STBI_FREE
(
z
->
img_comp
[
i
].
lšebuf
);

2994 
z
->
img_comp
[
i
].
lšebuf
 = 
NULL
;

2997  
why
;

2998 
	}
}

3000 
	$¡bi__´oûss_äame_h—d”
(
¡bi__j³g
 *
z
, 
sÿn
)

3002 
¡bi__cÚ‹xt
 *
s
 = 
z
->s;

3003 
Lf
,
p
,
i
,
q
, 
h_max
=1,
v_max
=1,
c
;

3004 
Lf
 = 
	`¡bi__g‘16be
(
s
); ià(Là< 11è 
	`¡bi__”r
("bad SOF†en","Corrupt JPEG");

3005 
p
 = 
	`¡bi__g‘8
(
s
); iàÕ !ğ8è 
	`¡bi__”r
("only 8-bit","JPEG format‚ot supported: 8-bit only");

3006 
s
->
img_y
 = 
	`¡bi__g‘16be
(s); ià(s->img_y =ğ0è 
	`¡bi__”r
("no header height", "JPEG format‚ot supported: delayed height");

3007 
s
->
img_x
 = 
	`¡bi__g‘16be
(s); ià(s->img_x =ğ0è 
	`¡bi__”r
("0 width","Corrupt JPEG");

3008 
c
 = 
	`¡bi__g‘8
(
s
);

3009 ià(
c
 !ğ3 && c !ğ1 && c !ğ4è 
	`¡bi__”r
("bad component count","Corrupt JPEG");

3010 
s
->
img_n
 = 
c
;

3011 
i
=0; i < 
c
; ++i) {

3012 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3013 
z
->
img_comp
[
i
].
lšebuf
 = 
NULL
;

3016 ià(
Lf
 !ğ8+3*
s
->
img_n
è 
	`¡bi__”r
("bad SOF†en","Corrupt JPEG");

3018 
z
->
rgb
 = 0;

3019 
i
=0; i < 
s
->
img_n
; ++i) {

3020 cÚ¡ 
rgb
[3] = { 'R', 'G', 'B' };

3021 
z
->
img_comp
[
i
].
id
 = 
	`¡bi__g‘8
(
s
);

3022 ià(
s
->
img_n
 =ğ3 && 
z
->
img_comp
[
i
].
id
 =ğ
rgb
[i])

3023 ++
z
->
rgb
;

3024 
q
 = 
	`¡bi__g‘8
(
s
);

3025 
z
->
img_comp
[
i
].
h
 = (
q
 >> 4); ià(!z->img_comp[i].h || z->img_comp[i].h > 4è 
	`¡bi__”r
("bad H","Corrupt JPEG");

3026 
z
->
img_comp
[
i
].
v
 = 
q
 & 15; ià(!z->img_comp[i].v || z->img_comp[i].v > 4è 
	`¡bi__”r
("bad V","Corrupt JPEG");

3027 
z
->
img_comp
[
i
].
tq
 = 
	`¡bi__g‘8
(
s
); ià(z->img_comp[i].tq > 3è 
	`¡bi__”r
("bad TQ","Corrupt JPEG");

3030 ià(
sÿn
 !ğ
STBI__SCAN_lßd
)  1;

3032 ià(!
	`¡bi__mad3sizes_v®id
(
s
->
img_x
, s->
img_y
, s->
img_n
, 0)è 
	`¡bi__”r
("too†arge", "Imageoo†argeo decode");

3034 
i
=0; i < 
s
->
img_n
; ++i) {

3035 ià(
z
->
img_comp
[
i
].
h
 > 
h_max
) h_max = z->img_comp[i].h;

3036 ià(
z
->
img_comp
[
i
].
v
 > 
v_max
) v_max = z->img_comp[i].v;

3040 
z
->
img_h_max
 = 
h_max
;

3041 
z
->
img_v_max
 = 
v_max
;

3042 
z
->
img_mcu_w
 = 
h_max
 * 8;

3043 
z
->
img_mcu_h
 = 
v_max
 * 8;

3045 
z
->
img_mcu_x
 = (
s
->
img_x
 + z->
img_mcu_w
-1) / z->img_mcu_w;

3046 
z
->
img_mcu_y
 = (
s
->
img_y
 + z->
img_mcu_h
-1) / z->img_mcu_h;

3048 
i
=0; i < 
s
->
img_n
; ++i) {

3050 
z
->
img_comp
[
i
].
x
 = (
s
->
img_x
 * z->img_comp[i].
h
 + 
h_max
-1) / h_max;

3051 
z
->
img_comp
[
i
].
y
 = (
s
->
img_y
 * z->img_comp[i].
v
 + 
v_max
-1) / v_max;

3059 
z
->
img_comp
[
i
].
w2
 = z->
img_mcu_x
 * z->img_comp[i].
h
 * 8;

3060 
z
->
img_comp
[
i
].
h2
 = z->
img_mcu_y
 * z->img_comp[i].
v
 * 8;

3061 
z
->
img_comp
[
i
].
cÛff
 = 0;

3062 
z
->
img_comp
[
i
].
¿w_cÛff
 = 0;

3063 
z
->
img_comp
[
i
].
lšebuf
 = 
NULL
;

3064 
z
->
img_comp
[
i
].
¿w_d©a
 = 
	`¡bi__m®loc_mad2
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, 15);

3065 ià(
z
->
img_comp
[
i
].
¿w_d©a
 =ğ
NULL
)

3066  
	`¡bi__ä“_j³g_compÚ’ts
(
z
, 
i
+1, 
	`¡bi__”r
("outofmem", "Out of memory"));

3068 
z
->
img_comp
[
i
].
d©a
 = (
¡bi_uc
*è(((
size_t
èz->img_comp[i].
¿w_d©a
 + 15) & ~15);

3069 ià(
z
->
´og»ssive
) {

3071 
z
->
img_comp
[
i
].
cÛff_w
 = z->img_comp[i].
w2
 / 8;

3072 
z
->
img_comp
[
i
].
cÛff_h
 = z->img_comp[i].
h2
 / 8;

3073 
z
->
img_comp
[
i
].
¿w_cÛff
 = 
	`¡bi__m®loc_mad3
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, (), 15);

3074 ià(
z
->
img_comp
[
i
].
¿w_cÛff
 =ğ
NULL
)

3075  
	`¡bi__ä“_j³g_compÚ’ts
(
z
, 
i
+1, 
	`¡bi__”r
("outofmem", "Out of memory"));

3076 
z
->
img_comp
[
i
].
cÛff
 = (*è(((
size_t
èz->img_comp[i].
¿w_cÛff
 + 15) & ~15);

3081 
	}
}

3084 
	#¡bi__DNL
(
x
è((xè=ğ0xdc)

	)

3085 
	#¡bi__SOI
(
x
è((xè=ğ0xd8)

	)

3086 
	#¡bi__EOI
(
x
è((xè=ğ0xd9)

	)

3087 
	#¡bi__SOF
(
x
è((xè=ğ0xc0 || (xè=ğ0xc1 || (xè=ğ0xc2)

	)

3088 
	#¡bi__SOS
(
x
è((xè=ğ0xda)

	)

3090 
	#¡bi__SOF_´og»ssive
(
x
è((xè=ğ0xc2)

	)

3092 
	$¡bi__decode_j³g_h—d”
(
¡bi__j³g
 *
z
, 
sÿn
)

3094 
m
;

3095 
z
->
jfif
 = 0;

3096 
z
->
­p14_cŞÜ_ŒªsfÜm
 = -1;

3097 
z
->
m¬k”
 = 
STBI__MARKER_nÚe
;

3098 
m
 = 
	`¡bi__g‘_m¬k”
(
z
);

3099 ià(!
	`¡bi__SOI
(
m
)è 
	`¡bi__”r
("no SOI","Corrupt JPEG");

3100 ià(
sÿn
 =ğ
STBI__SCAN_ty³
)  1;

3101 
m
 = 
	`¡bi__g‘_m¬k”
(
z
);

3102 !
	`¡bi__SOF
(
m
)) {

3103 ià(!
	`¡bi__´oûss_m¬k”
(
z
,
m
))  0;

3104 
m
 = 
	`¡bi__g‘_m¬k”
(
z
);

3105 
m
 =ğ
STBI__MARKER_nÚe
) {

3107 ià(
	`¡bi__©_eof
(
z
->
s
)è 
	`¡bi__”r
("no SOF", "Corrupt JPEG");

3108 
m
 = 
	`¡bi__g‘_m¬k”
(
z
);

3111 
z
->
´og»ssive
 = 
	`¡bi__SOF_´og»ssive
(
m
);

3112 ià(!
	`¡bi__´oûss_äame_h—d”
(
z
, 
sÿn
))  0;

3114 
	}
}

3117 
	$¡bi__decode_j³g_image
(
¡bi__j³g
 *
j
)

3119 
m
;

3120 
m
 = 0; m < 4; m++) {

3121 
j
->
img_comp
[
m
].
¿w_d©a
 = 
NULL
;

3122 
j
->
img_comp
[
m
].
¿w_cÛff
 = 
NULL
;

3124 
j
->
»¡¬t_š‹rv®
 = 0;

3125 ià(!
	`¡bi__decode_j³g_h—d”
(
j
, 
STBI__SCAN_lßd
))  0;

3126 
m
 = 
	`¡bi__g‘_m¬k”
(
j
);

3127 !
	`¡bi__EOI
(
m
)) {

3128 ià(
	`¡bi__SOS
(
m
)) {

3129 ià(!
	`¡bi__´oûss_sÿn_h—d”
(
j
))  0;

3130 ià(!
	`¡bi__·r£_’Œİy_coded_d©a
(
j
))  0;

3131 ià(
j
->
m¬k”
 =ğ
STBI__MARKER_nÚe
 ) {

3133 !
	`¡bi__©_eof
(
j
->
s
)) {

3134 
x
 = 
	`¡bi__g‘8
(
j
->
s
);

3135 ià(
x
 == 255) {

3136 
j
->
m¬k”
 = 
	`¡bi__g‘8
(j->
s
);

3142 } ià(
	`¡bi__DNL
(
m
)) {

3143 
Ld
 = 
	`¡bi__g‘16be
(
j
->
s
);

3144 
¡bi__ušt32
 
NL
 = 
	`¡bi__g‘16be
(
j
->
s
);

3145 ià(
Ld
 !ğ4è 
	`¡bi__”r
("bad DNL†en", "Corrupt JPEG");

3146 ià(
NL
 !ğ
j
->
s
->
img_y
è 
	`¡bi__”r
("bad DNL height", "Corrupt JPEG");

3148 ià(!
	`¡bi__´oûss_m¬k”
(
j
, 
m
))  0;

3150 
m
 = 
	`¡bi__g‘_m¬k”
(
j
);

3152 ià(
j
->
´og»ssive
)

3153 
	`¡bi__j³g_fšish
(
j
);

3155 
	}
}

3159 
	g¡bi_uc
 *(*
	t»§m¶e_row_func
)(
	t¡bi_uc
 *
	tout
, stbi_uø*
	tš0
, stbi_uø*
	tš1
,

3160 
	tw
, 
	ths
);

3162 
	#¡bi__div4
(
x
è((
¡bi_uc
è((xè>> 2))

	)

3164 
¡bi_uc
 *
	$»§m¶e_row_1
(
¡bi_uc
 *
out
, stbi_uø*
š_Ã¬
, stbi_uø*
š_çr
, 
w
, 
hs
)

3166 
	`STBI_NOTUSED
(
out
);

3167 
	`STBI_NOTUSED
(
š_çr
);

3168 
	`STBI_NOTUSED
(
w
);

3169 
	`STBI_NOTUSED
(
hs
);

3170  
š_Ã¬
;

3171 
	}
}

3173 
¡bi_uc
* 
	$¡bi__»§m¶e_row_v_2
(
¡bi_uc
 *
out
, stbi_uø*
š_Ã¬
, stbi_uø*
š_çr
, 
w
, 
hs
)

3176 
i
;

3177 
	`STBI_NOTUSED
(
hs
);

3178 
i
=0; i < 
w
; ++i)

3179 
out
[
i
] = 
	`¡bi__div4
(3*
š_Ã¬
[i] + 
š_çr
[i] + 2);

3180  
out
;

3181 
	}
}

3183 
¡bi_uc
* 
	$¡bi__»§m¶e_row_h_2
(
¡bi_uc
 *
out
, stbi_uø*
š_Ã¬
, stbi_uø*
š_çr
, 
w
, 
hs
)

3186 
i
;

3187 
¡bi_uc
 *
šput
 = 
š_Ã¬
;

3189 ià(
w
 == 1) {

3191 
out
[0] = out[1] = 
šput
[0];

3192  
out
;

3195 
out
[0] = 
šput
[0];

3196 
out
[1] = 
	`¡bi__div4
(
šput
[0]*3 + input[1] + 2);

3197 
i
=1; i < 
w
-1; ++i) {

3198 
n
 = 3*
šput
[
i
]+2;

3199 
out
[
i
*2+0] = 
	`¡bi__div4
(
n
+
šput
[i-1]);

3200 
out
[
i
*2+1] = 
	`¡bi__div4
(
n
+
šput
[i+1]);

3202 
out
[
i
*2+0] = 
	`¡bi__div4
(
šput
[
w
-2]*3 + input[w-1] + 2);

3203 
out
[
i
*2+1] = 
šput
[
w
-1];

3205 
	`STBI_NOTUSED
(
š_çr
);

3206 
	`STBI_NOTUSED
(
hs
);

3208  
out
;

3209 
	}
}

3211 
	#¡bi__div16
(
x
è((
¡bi_uc
è((xè>> 4))

	)

3213 
¡bi_uc
 *
	$¡bi__»§m¶e_row_hv_2
(
¡bi_uc
 *
out
, stbi_uø*
š_Ã¬
, stbi_uø*
š_çr
, 
w
, 
hs
)

3216 
i
,
t0
,
t1
;

3217 ià(
w
 == 1) {

3218 
out
[0] = out[1] = 
	`¡bi__div4
(3*
š_Ã¬
[0] + 
š_çr
[0] + 2);

3219  
out
;

3222 
t1
 = 3*
š_Ã¬
[0] + 
š_çr
[0];

3223 
out
[0] = 
	`¡bi__div4
(
t1
+2);

3224 
i
=1; i < 
w
; ++i) {

3225 
t0
 = 
t1
;

3226 
t1
 = 3*
š_Ã¬
[
i
]+
š_çr
[i];

3227 
out
[
i
*2-1] = 
	`¡bi__div16
(3*
t0
 + 
t1
 + 8);

3228 
out
[
i
*2 ] = 
	`¡bi__div16
(3*
t1
 + 
t0
 + 8);

3230 
out
[
w
*2-1] = 
	`¡bi__div4
(
t1
+2);

3232 
	`STBI_NOTUSED
(
hs
);

3234  
out
;

3235 
	}
}

3237 #ià
defšed
(
STBI_SSE2
è|| defšed(
STBI_NEON
)

3238 
¡bi_uc
 *
	$¡bi__»§m¶e_row_hv_2_simd
(
¡bi_uc
 *
out
, stbi_uø*
š_Ã¬
, stbi_uø*
š_çr
, 
w
, 
hs
)

3241 
i
=0,
t0
,
t1
;

3243 ià(
w
 == 1) {

3244 
out
[0] = out[1] = 
	`¡bi__div4
(3*
š_Ã¬
[0] + 
š_çr
[0] + 2);

3245  
out
;

3248 
t1
 = 3*
š_Ã¬
[0] + 
š_çr
[0];

3252 ; 
i
 < ((
w
-1) & ~7); i += 8) {

3253 #ià
	`defšed
(
STBI_SSE2
)

3256 
__m128i
 
z”o
 = 
	`_mm_£tz”o_si128
();

3257 
__m128i
 
çrb
 = 
	`_mm_lßdl_•i64
((__m128˜*è(
š_çr
 + 
i
));

3258 
__m128i
 
Ã¬b
 = 
	`_mm_lßdl_•i64
((__m128˜*è(
š_Ã¬
 + 
i
));

3259 
__m128i
 
çrw
 = 
	`_mm_uÅacklo_•i8
(
çrb
, 
z”o
);

3260 
__m128i
 
Ã¬w
 = 
	`_mm_uÅacklo_•i8
(
Ã¬b
, 
z”o
);

3261 
__m128i
 
diff
 = 
	`_mm_sub_•i16
(
çrw
, 
Ã¬w
);

3262 
__m128i
 
Ã¬s
 = 
	`_mm_¦li_•i16
(
Ã¬w
, 2);

3263 
__m128i
 
cu¼
 = 
	`_mm_add_•i16
(
Ã¬s
, 
diff
);

3270 
__m128i
 
´v0
 = 
	`_mm_¦li_si128
(
cu¼
, 2);

3271 
__m128i
 
nxt0
 = 
	`_mm_¤li_si128
(
cu¼
, 2);

3272 
__m128i
 
´ev
 = 
	`_mm_š£¹_•i16
(
´v0
, 
t1
, 0);

3273 
__m128i
 
Ãxt
 = 
	`_mm_š£¹_•i16
(
nxt0
, 3*
š_Ã¬
[
i
+8] + 
š_çr
[i+8], 7);

3279 
__m128i
 
bŸs
 = 
	`_mm_£t1_•i16
(8);

3280 
__m128i
 
curs
 = 
	`_mm_¦li_•i16
(
cu¼
, 2);

3281 
__m128i
 
´vd
 = 
	`_mm_sub_•i16
(
´ev
, 
cu¼
);

3282 
__m128i
 
nxtd
 = 
	`_mm_sub_•i16
(
Ãxt
, 
cu¼
);

3283 
__m128i
 
curb
 = 
	`_mm_add_•i16
(
curs
, 
bŸs
);

3284 
__m128i
 
ev’
 = 
	`_mm_add_•i16
(
´vd
, 
curb
);

3285 
__m128i
 
odd
 = 
	`_mm_add_•i16
(
nxtd
, 
curb
);

3288 
__m128i
 
št0
 = 
	`_mm_uÅacklo_•i16
(
ev’
, 
odd
);

3289 
__m128i
 
št1
 = 
	`_mm_uÅackhi_•i16
(
ev’
, 
odd
);

3290 
__m128i
 
de0
 = 
	`_mm_¤li_•i16
(
št0
, 4);

3291 
__m128i
 
de1
 = 
	`_mm_¤li_•i16
(
št1
, 4);

3294 
__m128i
 
outv
 = 
	`_mm_·ckus_•i16
(
de0
, 
de1
);

3295 
	`_mm_¡Üeu_si128
((
__m128i
 *è(
out
 + 
i
*2), 
outv
);

3296 #–ià
	`defšed
(
STBI_NEON
)

3299 
ušt8x8_t
 
çrb
 = 
	`vld1_u8
(
š_çr
 + 
i
);

3300 
ušt8x8_t
 
Ã¬b
 = 
	`vld1_u8
(
š_Ã¬
 + 
i
);

3301 
št16x8_t
 
diff
 = 
	`v»š‹½»tq_s16_u16
(
	`vsubl_u8
(
çrb
, 
Ã¬b
));

3302 
št16x8_t
 
Ã¬s
 = 
	`v»š‹½»tq_s16_u16
(
	`vshÎ_n_u8
(
Ã¬b
, 2));

3303 
št16x8_t
 
cu¼
 = 
	`vaddq_s16
(
Ã¬s
, 
diff
);

3310 
št16x8_t
 
´v0
 = 
	`vextq_s16
(
cu¼
, curr, 7);

3311 
št16x8_t
 
nxt0
 = 
	`vextq_s16
(
cu¼
, curr, 1);

3312 
št16x8_t
 
´ev
 = 
	`v£tq_ÏÃ_s16
(
t1
, 
´v0
, 0);

3313 
št16x8_t
 
Ãxt
 = 
	`v£tq_ÏÃ_s16
(3*
š_Ã¬
[
i
+8] + 
š_çr
[i+8], 
nxt0
, 7);

3319 
št16x8_t
 
curs
 = 
	`vshlq_n_s16
(
cu¼
, 2);

3320 
št16x8_t
 
´vd
 = 
	`vsubq_s16
(
´ev
, 
cu¼
);

3321 
št16x8_t
 
nxtd
 = 
	`vsubq_s16
(
Ãxt
, 
cu¼
);

3322 
št16x8_t
 
ev’
 = 
	`vaddq_s16
(
curs
, 
´vd
);

3323 
št16x8_t
 
odd
 = 
	`vaddq_s16
(
curs
, 
nxtd
);

3326 
ušt8x8x2_t
 
o
;

3327 
o
.
v®
[0] = 
	`vqrshrun_n_s16
(
ev’
, 4);

3328 
o
.
v®
[1] = 
	`vqrshrun_n_s16
(
odd
, 4);

3329 
	`v¡2_u8
(
out
 + 
i
*2, 
o
);

3333 
t1
 = 3*
š_Ã¬
[
i
+7] + 
š_çr
[i+7];

3336 
t0
 = 
t1
;

3337 
t1
 = 3*
š_Ã¬
[
i
] + 
š_çr
[i];

3338 
out
[
i
*2] = 
	`¡bi__div16
(3*
t1
 + 
t0
 + 8);

3340 ++
i
; i < 
w
; ++i) {

3341 
t0
 = 
t1
;

3342 
t1
 = 3*
š_Ã¬
[
i
]+
š_çr
[i];

3343 
out
[
i
*2-1] = 
	`¡bi__div16
(3*
t0
 + 
t1
 + 8);

3344 
out
[
i
*2 ] = 
	`¡bi__div16
(3*
t1
 + 
t0
 + 8);

3346 
out
[
w
*2-1] = 
	`¡bi__div4
(
t1
+2);

3348 
	`STBI_NOTUSED
(
hs
);

3350  
out
;

3351 
	}
}

3354 
¡bi_uc
 *
	$¡bi__»§m¶e_row_g’”ic
(
¡bi_uc
 *
out
, stbi_uø*
š_Ã¬
, stbi_uø*
š_çr
, 
w
, 
hs
)

3357 
i
,
j
;

3358 
	`STBI_NOTUSED
(
š_çr
);

3359 
i
=0; i < 
w
; ++i)

3360 
j
=0; j < 
hs
; ++j)

3361 
out
[
i
*
hs
+
j
] = 
š_Ã¬
[i];

3362  
out
;

3363 
	}
}

3367 
	#¡bi__æßt2fixed
(
x
è(((è((xè* 4096.0à+ 0.5f)è<< 8)

	)

3368 
	$¡bi__YCbCr_to_RGB_row
(
¡bi_uc
 *
out
, cÚ¡ stbi_uø*
y
, cÚ¡ stbi_uø*
pcb
, cÚ¡ stbi_uø*
pü
, 
couÁ
, 
¡•
)

3370 
i
;

3371 
i
=0; i < 
couÁ
; ++i) {

3372 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3373 
r
,
g
,
b
;

3374 
ü
 = 
pü
[
i
] - 128;

3375 
cb
 = 
pcb
[
i
] - 128;

3376 
r
 = 
y_fixed
 + 
ü
* 
	`¡bi__æßt2fixed
(1.40200f);

3377 
g
 = 
y_fixed
 + (
ü
*-
	`¡bi__æßt2fixed
(0.71414f)è+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3378 
b
 = 
y_fixed
 + 
cb
* 
	`¡bi__æßt2fixed
(1.77200f);

3379 
r
 >>= 20;

3380 
g
 >>= 20;

3381 
b
 >>= 20;

3382 ià((è
r
 > 255) { if (r < 0)„ = 0; r = 255; }

3383 ià((è
g
 > 255) { if (g < 0) g = 0; g = 255; }

3384 ià((è
b
 > 255) { if (b < 0) b = 0; b = 255; }

3385 
out
[0] = (
¡bi_uc
)
r
;

3386 
out
[1] = (
¡bi_uc
)
g
;

3387 
out
[2] = (
¡bi_uc
)
b
;

3388 
out
[3] = 255;

3389 
out
 +ğ
¡•
;

3391 
	}
}

3393 #ià
defšed
(
STBI_SSE2
è|| defšed(
STBI_NEON
)

3394 
	$¡bi__YCbCr_to_RGB_simd
(
¡bi_uc
 *
out
, stbi_uøcÚ¡ *
y
, stbi_uøcÚ¡ *
pcb
, stbi_uøcÚ¡ *
pü
, 
couÁ
, 
¡•
)

3396 
i
 = 0;

3398 #ifdeà
STBI_SSE2


3402 ià(
¡•
 == 4) {

3404 
__m128i
 
signæ
 = 
	`_mm_£t1_•i8
(-0x80);

3405 
__m128i
 
ü_cÚ¡0
 = 
	`_mm_£t1_•i16
( () ( 1.40200f*4096.0f+0.5f));

3406 
__m128i
 
ü_cÚ¡1
 = 
	`_mm_£t1_•i16
( - () ( 0.71414f*4096.0f+0.5f));

3407 
__m128i
 
cb_cÚ¡0
 = 
	`_mm_£t1_•i16
( - () ( 0.34414f*4096.0f+0.5f));

3408 
__m128i
 
cb_cÚ¡1
 = 
	`_mm_£t1_•i16
( () ( 1.77200f*4096.0f+0.5f));

3409 
__m128i
 
y_bŸs
 = 
	`_mm_£t1_•i8
(() () 128);

3410 
__m128i
 
xw
 = 
	`_mm_£t1_•i16
(255);

3412 ; 
i
+7 < 
couÁ
; i += 8) {

3414 
__m128i
 
y_by‹s
 = 
	`_mm_lßdl_•i64
((__m128˜*è(
y
+
i
));

3415 
__m128i
 
ü_by‹s
 = 
	`_mm_lßdl_•i64
((__m128˜*è(
pü
+
i
));

3416 
__m128i
 
cb_by‹s
 = 
	`_mm_lßdl_•i64
((__m128˜*è(
pcb
+
i
));

3417 
__m128i
 
ü_bŸ£d
 = 
	`_mm_xÜ_si128
(
ü_by‹s
, 
signæ
);

3418 
__m128i
 
cb_bŸ£d
 = 
	`_mm_xÜ_si128
(
cb_by‹s
, 
signæ
);

3421 
__m128i
 
yw
 = 
	`_mm_uÅacklo_•i8
(
y_bŸs
, 
y_by‹s
);

3422 
__m128i
 
üw
 = 
	`_mm_uÅacklo_•i8
(
	`_mm_£tz”o_si128
(), 
ü_bŸ£d
);

3423 
__m128i
 
cbw
 = 
	`_mm_uÅacklo_•i8
(
	`_mm_£tz”o_si128
(), 
cb_bŸ£d
);

3426 
__m128i
 
yws
 = 
	`_mm_¤li_•i16
(
yw
, 4);

3427 
__m128i
 
ü0
 = 
	`_mm_mulhi_•i16
(
ü_cÚ¡0
, 
üw
);

3428 
__m128i
 
cb0
 = 
	`_mm_mulhi_•i16
(
cb_cÚ¡0
, 
cbw
);

3429 
__m128i
 
cb1
 = 
	`_mm_mulhi_•i16
(
cbw
, 
cb_cÚ¡1
);

3430 
__m128i
 
ü1
 = 
	`_mm_mulhi_•i16
(
üw
, 
ü_cÚ¡1
);

3431 
__m128i
 
rws
 = 
	`_mm_add_•i16
(
ü0
, 
yws
);

3432 
__m128i
 
gwt
 = 
	`_mm_add_•i16
(
cb0
, 
yws
);

3433 
__m128i
 
bws
 = 
	`_mm_add_•i16
(
yws
, 
cb1
);

3434 
__m128i
 
gws
 = 
	`_mm_add_•i16
(
gwt
, 
ü1
);

3437 
__m128i
 
rw
 = 
	`_mm_¤ai_•i16
(
rws
, 4);

3438 
__m128i
 
bw
 = 
	`_mm_¤ai_•i16
(
bws
, 4);

3439 
__m128i
 
gw
 = 
	`_mm_¤ai_•i16
(
gws
, 4);

3442 
__m128i
 
brb
 = 
	`_mm_·ckus_•i16
(
rw
, 
bw
);

3443 
__m128i
 
gxb
 = 
	`_mm_·ckus_•i16
(
gw
, 
xw
);

3446 
__m128i
 
t0
 = 
	`_mm_uÅacklo_•i8
(
brb
, 
gxb
);

3447 
__m128i
 
t1
 = 
	`_mm_uÅackhi_•i8
(
brb
, 
gxb
);

3448 
__m128i
 
o0
 = 
	`_mm_uÅacklo_•i16
(
t0
, 
t1
);

3449 
__m128i
 
o1
 = 
	`_mm_uÅackhi_•i16
(
t0
, 
t1
);

3452 
	`_mm_¡Üeu_si128
((
__m128i
 *è(
out
 + 0), 
o0
);

3453 
	`_mm_¡Üeu_si128
((
__m128i
 *è(
out
 + 16), 
o1
);

3454 
out
 += 32;

3459 #ifdeà
STBI_NEON


3461 ià(
¡•
 == 4) {

3463 
ušt8x8_t
 
signæ
 = 
	`vdup_n_u8
(0x80);

3464 
št16x8_t
 
ü_cÚ¡0
 = 
	`vdupq_n_s16
( () ( 1.40200f*4096.0f+0.5f));

3465 
št16x8_t
 
ü_cÚ¡1
 = 
	`vdupq_n_s16
( - () ( 0.71414f*4096.0f+0.5f));

3466 
št16x8_t
 
cb_cÚ¡0
 = 
	`vdupq_n_s16
( - () ( 0.34414f*4096.0f+0.5f));

3467 
št16x8_t
 
cb_cÚ¡1
 = 
	`vdupq_n_s16
( () ( 1.77200f*4096.0f+0.5f));

3469 ; 
i
+7 < 
couÁ
; i += 8) {

3471 
ušt8x8_t
 
y_by‹s
 = 
	`vld1_u8
(
y
 + 
i
);

3472 
ušt8x8_t
 
ü_by‹s
 = 
	`vld1_u8
(
pü
 + 
i
);

3473 
ušt8x8_t
 
cb_by‹s
 = 
	`vld1_u8
(
pcb
 + 
i
);

3474 
št8x8_t
 
ü_bŸ£d
 = 
	`v»š‹½»t_s8_u8
(
	`vsub_u8
(
ü_by‹s
, 
signæ
));

3475 
št8x8_t
 
cb_bŸ£d
 = 
	`v»š‹½»t_s8_u8
(
	`vsub_u8
(
cb_by‹s
, 
signæ
));

3478 
št16x8_t
 
yws
 = 
	`v»š‹½»tq_s16_u16
(
	`vshÎ_n_u8
(
y_by‹s
, 4));

3479 
št16x8_t
 
üw
 = 
	`vshÎ_n_s8
(
ü_bŸ£d
, 7);

3480 
št16x8_t
 
cbw
 = 
	`vshÎ_n_s8
(
cb_bŸ£d
, 7);

3483 
št16x8_t
 
ü0
 = 
	`vqdmulhq_s16
(
üw
, 
ü_cÚ¡0
);

3484 
št16x8_t
 
cb0
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_cÚ¡0
);

3485 
št16x8_t
 
ü1
 = 
	`vqdmulhq_s16
(
üw
, 
ü_cÚ¡1
);

3486 
št16x8_t
 
cb1
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_cÚ¡1
);

3487 
št16x8_t
 
rws
 = 
	`vaddq_s16
(
yws
, 
ü0
);

3488 
št16x8_t
 
gws
 = 
	`vaddq_s16
(vaddq_s16(
yws
, 
cb0
), 
ü1
);

3489 
št16x8_t
 
bws
 = 
	`vaddq_s16
(
yws
, 
cb1
);

3492 
ušt8x8x4_t
 
o
;

3493 
o
.
v®
[0] = 
	`vqrshrun_n_s16
(
rws
, 4);

3494 
o
.
v®
[1] = 
	`vqrshrun_n_s16
(
gws
, 4);

3495 
o
.
v®
[2] = 
	`vqrshrun_n_s16
(
bws
, 4);

3496 
o
.
v®
[3] = 
	`vdup_n_u8
(255);

3499 
	`v¡4_u8
(
out
, 
o
);

3500 
out
 += 8*4;

3505 ; 
i
 < 
couÁ
; ++i) {

3506 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3507 
r
,
g
,
b
;

3508 
ü
 = 
pü
[
i
] - 128;

3509 
cb
 = 
pcb
[
i
] - 128;

3510 
r
 = 
y_fixed
 + 
ü
* 
	`¡bi__æßt2fixed
(1.40200f);

3511 
g
 = 
y_fixed
 + 
ü
*-
	`¡bi__æßt2fixed
(0.71414fè+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3512 
b
 = 
y_fixed
 + 
cb
* 
	`¡bi__æßt2fixed
(1.77200f);

3513 
r
 >>= 20;

3514 
g
 >>= 20;

3515 
b
 >>= 20;

3516 ià((è
r
 > 255) { if (r < 0)„ = 0; r = 255; }

3517 ià((è
g
 > 255) { if (g < 0) g = 0; g = 255; }

3518 ià((è
b
 > 255) { if (b < 0) b = 0; b = 255; }

3519 
out
[0] = (
¡bi_uc
)
r
;

3520 
out
[1] = (
¡bi_uc
)
g
;

3521 
out
[2] = (
¡bi_uc
)
b
;

3522 
out
[3] = 255;

3523 
out
 +ğ
¡•
;

3525 
	}
}

3529 
	$¡bi__£tup_j³g
(
¡bi__j³g
 *
j
)

3531 
j
->
idù_block_k”Ãl
 = 
¡bi__idù_block
;

3532 
j
->
YCbCr_to_RGB_k”Ãl
 = 
¡bi__YCbCr_to_RGB_row
;

3533 
j
->
»§m¶e_row_hv_2_k”Ãl
 = 
¡bi__»§m¶e_row_hv_2
;

3535 #ifdeà
STBI_SSE2


3536 ià(
	`¡bi__s£2_avaabË
()) {

3537 
j
->
idù_block_k”Ãl
 = 
¡bi__idù_simd
;

3538 
j
->
YCbCr_to_RGB_k”Ãl
 = 
¡bi__YCbCr_to_RGB_simd
;

3539 
j
->
»§m¶e_row_hv_2_k”Ãl
 = 
¡bi__»§m¶e_row_hv_2_simd
;

3543 #ifdeà
STBI_NEON


3544 
j
->
idù_block_k”Ãl
 = 
¡bi__idù_simd
;

3545 
j
->
YCbCr_to_RGB_k”Ãl
 = 
¡bi__YCbCr_to_RGB_simd
;

3546 
j
->
»§m¶e_row_hv_2_k”Ãl
 = 
¡bi__»§m¶e_row_hv_2_simd
;

3548 
	}
}

3551 
	$¡bi__ş—nup_j³g
(
¡bi__j³g
 *
j
)

3553 
	`¡bi__ä“_j³g_compÚ’ts
(
j
, j->
s
->
img_n
, 0);

3554 
	}
}

3558 
»§m¶e_row_func
 
	m»§m¶e
;

3559 
¡bi_uc
 *
	mlše0
,*
	mlše1
;

3560 
	mhs
,
	mvs
;

3561 
	mw_lÜes
;

3562 
	my¡•
;

3563 
	mypos
;

3564 } 
	t¡bi__»§m¶e
;

3567 
¡bi_uc
 
	$¡bi__blšn_8x8
(
¡bi_uc
 
x
, stbi_uø
y
)

3569 
t
 = 
x
*
y
 + 128;

3570  (
¡bi_uc
è((
t
 + (t >>8)) >> 8);

3571 
	}
}

3573 
¡bi_uc
 *
	$lßd_j³g_image
(
¡bi__j³g
 *
z
, *
out_x
, *
out_y
, *
comp
, 
»q_comp
)

3575 
n
, 
decode_n
, 
is_rgb
;

3576 
z
->
s
->
img_n
 = 0;

3579 ià(
»q_comp
 < 0 ||„eq_com°> 4è 
	`¡bi__”½uc
("bad„eq_comp", "Internalƒrror");

3582 ià(!
	`¡bi__decode_j³g_image
(
z
)è{ 
	`¡bi__ş—nup_j³g
(z);  
NULL
; }

3585 
n
 = 
»q_comp
 ?„eq_com°: 
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3587 
is_rgb
 = 
z
->
s
->
img_n
 =ğ3 && (z->
rgb
 =ğ3 || (z->
­p14_cŞÜ_ŒªsfÜm
 =ğ0 && !z->
jfif
));

3589 ià(
z
->
s
->
img_n
 =ğ3 && 
n
 < 3 && !
is_rgb
)

3590 
decode_n
 = 1;

3592 
decode_n
 = 
z
->
s
->
img_n
;

3596 
k
;

3597 
i
,
j
;

3598 
¡bi_uc
 *
ouut
;

3599 
¡bi_uc
 *
couut
[4];

3601 
¡bi__»§m¶e
 
»s_comp
[4];

3603 
k
=0; k < 
decode_n
; ++k) {

3604 
¡bi__»§m¶e
 *
r
 = &
»s_comp
[
k
];

3608 
z
->
img_comp
[
k
].
lšebuf
 = (
¡bi_uc
 *è
	`¡bi__m®loc
(z->
s
->
img_x
 + 3);

3609 ià(!
z
->
img_comp
[
k
].
lšebuf
è{ 
	`¡bi__ş—nup_j³g
(z);  
	`¡bi__”½uc
("outofmem", "Out of memory"); }

3611 
r
->
hs
 = 
z
->
img_h_max
 / z->
img_comp
[
k
].
h
;

3612 
r
->
vs
 = 
z
->
img_v_max
 / z->
img_comp
[
k
].
v
;

3613 
r
->
y¡•
 =„->
vs
 >> 1;

3614 
r
->
w_lÜes
 = (
z
->
s
->
img_x
 +„->
hs
-1) /„->hs;

3615 
r
->
ypos
 = 0;

3616 
r
->
lše0
 =„->
lše1
 = 
z
->
img_comp
[
k
].
d©a
;

3618 ià(
r
->
hs
 =ğ1 &&„->
vs
 =ğ1èr->
»§m¶e
 = 
»§m¶e_row_1
;

3619 ià(
r
->
hs
 =ğ1 &&„->
vs
 =ğ2èr->
»§m¶e
 = 
¡bi__»§m¶e_row_v_2
;

3620 ià(
r
->
hs
 =ğ2 &&„->
vs
 =ğ1èr->
»§m¶e
 = 
¡bi__»§m¶e_row_h_2
;

3621 ià(
r
->
hs
 =ğ2 &&„->
vs
 =ğ2èr->
»§m¶e
 = 
z
->
»§m¶e_row_hv_2_k”Ãl
;

3622 
r
->
»§m¶e
 = 
¡bi__»§m¶e_row_g’”ic
;

3626 
ouut
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
n
, 
z
->
s
->
img_x
, z->s->
img_y
, 1);

3627 ià(!
ouut
è{ 
	`¡bi__ş—nup_j³g
(
z
);  
	`¡bi__”½uc
("outofmem", "Out of memory"); }

3630 
j
=0; j < 
z
->
s
->
img_y
; ++j) {

3631 
¡bi_uc
 *
out
 = 
ouut
 + 
n
 * 
z
->
s
->
img_x
 * 
j
;

3632 
k
=0; k < 
decode_n
; ++k) {

3633 
¡bi__»§m¶e
 *
r
 = &
»s_comp
[
k
];

3634 
y_bÙ
 = 
r
->
y¡•
 >ğÔ->
vs
 >> 1);

3635 
couut
[
k
] = 
r
->
	`»§m¶e
(
z
->
img_comp
[k].
lšebuf
,

3636 
y_bÙ
 ? 
r
->
lše1
 :„->
lše0
,

3637 
y_bÙ
 ? 
r
->
lše0
 :„->
lše1
,

3638 
r
->
w_lÜes
,„->
hs
);

3639 ià(++
r
->
y¡•
 >ğr->
vs
) {

3640 
r
->
y¡•
 = 0;

3641 
r
->
lše0
 =„->
lše1
;

3642 ià(++
r
->
ypos
 < 
z
->
img_comp
[
k
].
y
)

3643 
r
->
lše1
 +ğ
z
->
img_comp
[
k
].
w2
;

3646 ià(
n
 >= 3) {

3647 
¡bi_uc
 *
y
 = 
couut
[0];

3648 ià(
z
->
s
->
img_n
 == 3) {

3649 ià(
is_rgb
) {

3650 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3651 
out
[0] = 
y
[
i
];

3652 
out
[1] = 
couut
[1][
i
];

3653 
out
[2] = 
couut
[2][
i
];

3654 
out
[3] = 255;

3655 
out
 +ğ
n
;

3658 
z
->
	`YCbCr_to_RGB_k”Ãl
(
out
, 
y
, 
couut
[1], couut[2], z->
s
->
img_x
, 
n
);

3660 } ià(
z
->
s
->
img_n
 == 4) {

3661 ià(
z
->
­p14_cŞÜ_ŒªsfÜm
 == 0) {

3662 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3663 
¡bi_uc
 
m
 = 
couut
[3][
i
];

3664 
out
[0] = 
	`¡bi__blšn_8x8
(
couut
[0][
i
], 
m
);

3665 
out
[1] = 
	`¡bi__blšn_8x8
(
couut
[1][
i
], 
m
);

3666 
out
[2] = 
	`¡bi__blšn_8x8
(
couut
[2][
i
], 
m
);

3667 
out
[3] = 255;

3668 
out
 +ğ
n
;

3670 } ià(
z
->
­p14_cŞÜ_ŒªsfÜm
 == 2) {

3671 
z
->
	`YCbCr_to_RGB_k”Ãl
(
out
, 
y
, 
couut
[1], couut[2], z->
s
->
img_x
, 
n
);

3672 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3673 
¡bi_uc
 
m
 = 
couut
[3][
i
];

3674 
out
[0] = 
	`¡bi__blšn_8x8
(255 - out[0], 
m
);

3675 
out
[1] = 
	`¡bi__blšn_8x8
(255 - out[1], 
m
);

3676 
out
[2] = 
	`¡bi__blšn_8x8
(255 - out[2], 
m
);

3677 
out
 +ğ
n
;

3680 
z
->
	`YCbCr_to_RGB_k”Ãl
(
out
, 
y
, 
couut
[1], couut[2], z->
s
->
img_x
, 
n
);

3683 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3684 
out
[0] = out[1] = out[2] = 
y
[
i
];

3685 
out
[3] = 255;

3686 
out
 +ğ
n
;

3689 ià(
is_rgb
) {

3690 ià(
n
 == 1)

3691 
i
=0; i < 
z
->
s
->
img_x
; ++i)

3692 *
out
++ = 
	`¡bi__compu‹_y
(
couut
[0][
i
], coutput[1][i], coutput[2][i]);

3694 
i
=0; i < 
z
->
s
->
img_x
; ++i, 
out
 += 2) {

3695 
out
[0] = 
	`¡bi__compu‹_y
(
couut
[0][
i
], coutput[1][i], coutput[2][i]);

3696 
out
[1] = 255;

3699 } ià(
z
->
s
->
img_n
 =ğ4 && z->
­p14_cŞÜ_ŒªsfÜm
 == 0) {

3700 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3701 
¡bi_uc
 
m
 = 
couut
[3][
i
];

3702 
¡bi_uc
 
r
 = 
	`¡bi__blšn_8x8
(
couut
[0][
i
], 
m
);

3703 
¡bi_uc
 
g
 = 
	`¡bi__blšn_8x8
(
couut
[1][
i
], 
m
);

3704 
¡bi_uc
 
b
 = 
	`¡bi__blšn_8x8
(
couut
[2][
i
], 
m
);

3705 
out
[0] = 
	`¡bi__compu‹_y
(
r
, 
g
, 
b
);

3706 
out
[1] = 255;

3707 
out
 +ğ
n
;

3709 } ià(
z
->
s
->
img_n
 =ğ4 && z->
­p14_cŞÜ_ŒªsfÜm
 == 2) {

3710 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3711 
out
[0] = 
	`¡bi__blšn_8x8
(255 - 
couut
[0][
i
], coutput[3][i]);

3712 
out
[1] = 255;

3713 
out
 +ğ
n
;

3716 
¡bi_uc
 *
y
 = 
couut
[0];

3717 ià(
n
 == 1)

3718 
i
=0; i < 
z
->
s
->
img_x
; ++iè
out
[i] = 
y
[i];

3720 
i
=0; i < 
z
->
s
->
img_x
; ++iè*
out
++ = 
y
[i], *out++ = 255;

3724 
	`¡bi__ş—nup_j³g
(
z
);

3725 *
out_x
 = 
z
->
s
->
img_x
;

3726 *
out_y
 = 
z
->
s
->
img_y
;

3727 ià(
comp
è*com°ğ
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3728  
ouut
;

3730 
	}
}

3732 *
	$¡bi__j³g_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

3734 * 
»suÉ
;

3735 
¡bi__j³g
* 
j
 = (¡bi__j³g*è
	`¡bi__m®loc
((stbi__jpeg));

3736 
	`STBI_NOTUSED
(
ri
);

3737 
j
->
s
 = s;

3738 
	`¡bi__£tup_j³g
(
j
);

3739 
»suÉ
 = 
	`lßd_j³g_image
(
j
, 
x
,
y
,
comp
,
»q_comp
);

3740 
	`STBI_FREE
(
j
);

3741  
»suÉ
;

3742 
	}
}

3744 
	$¡bi__j³g_‹¡
(
¡bi__cÚ‹xt
 *
s
)

3746 
r
;

3747 
¡bi__j³g
* 
j
 = (¡bi__j³g*)
	`¡bi__m®loc
((stbi__jpeg));

3748 
j
->
s
 = s;

3749 
	`¡bi__£tup_j³g
(
j
);

3750 
r
 = 
	`¡bi__decode_j³g_h—d”
(
j
, 
STBI__SCAN_ty³
);

3751 
	`¡bi__»wšd
(
s
);

3752 
	`STBI_FREE
(
j
);

3753  
r
;

3754 
	}
}

3756 
	$¡bi__j³g_šfo_¿w
(
¡bi__j³g
 *
j
, *
x
, *
y
, *
comp
)

3758 ià(!
	`¡bi__decode_j³g_h—d”
(
j
, 
STBI__SCAN_h—d”
)) {

3759 
	`¡bi__»wšd
Ğ
j
->
s
 );

3762 ià(
x
è*x = 
j
->
s
->
img_x
;

3763 ià(
y
è*y = 
j
->
s
->
img_y
;

3764 ià(
comp
è*com°ğ
j
->
s
->
img_n
 >= 3 ? 3 : 1;

3766 
	}
}

3768 
	$¡bi__j³g_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

3770 
»suÉ
;

3771 
¡bi__j³g
* 
j
 = (¡bi__j³g*è(
	`¡bi__m®loc
((stbi__jpeg)));

3772 
j
->
s
 = s;

3773 
»suÉ
 = 
	`¡bi__j³g_šfo_¿w
(
j
, 
x
, 
y
, 
comp
);

3774 
	`STBI_FREE
(
j
);

3775  
»suÉ
;

3776 
	}
}

3786 #iâdeà
STBI_NO_ZLIB


3789 
	#STBI__ZFAST_BITS
 9

3790 
	#STBI__ZFAST_MASK
 ((1 << 
STBI__ZFAST_BITS
è- 1)

	)

3796 
¡bi__ušt16
 
	mç¡
[1 << 
STBI__ZFAST_BITS
];

3797 
¡bi__ušt16
 
	mfœ¡code
[16];

3798 
	mmaxcode
[17];

3799 
¡bi__ušt16
 
	mfœ¡symbŞ
[16];

3800 
¡bi_uc
 
	msize
[288];

3801 
¡bi__ušt16
 
	mv®ue
[288];

3802 } 
	t¡bi__zhuffmª
;

3804 
¡bi_šlše
 
	$¡bi__b™»v”£16
(
n
)

3806 
n
 = ((n & 0xAAAA) >> 1) | ((n & 0x5555) << 1);

3807 
n
 = ((n & 0xCCCC) >> 2) | ((n & 0x3333) << 2);

3808 
n
 = ((n & 0xF0F0) >> 4) | ((n & 0x0F0F) << 4);

3809 
n
 = ((n & 0xFF00) >> 8) | ((n & 0x00FF) << 8);

3810  
n
;

3811 
	}
}

3813 
¡bi_šlše
 
	$¡bi__b™_»v”£
(
v
, 
b™s
)

3815 
	`STBI_ASSERT
(
b™s
 <= 16);

3818  
	`¡bi__b™»v”£16
(
v
è>> (16-
b™s
);

3819 
	}
}

3821 
	$¡bi__zbud_huffmª
(
¡bi__zhuffmª
 *
z
, cÚ¡ 
¡bi_uc
 *
siz–i¡
, 
num
)

3823 
i
,
k
=0;

3824 
code
, 
Ãxt_code
[16], 
sizes
[17];

3827 
	`mem£t
(
sizes
, 0, (sizes));

3828 
	`mem£t
(
z
->
ç¡
, 0, (z->fast));

3829 
i
=0; i < 
num
; ++i)

3830 ++
sizes
[
siz–i¡
[
i
]];

3831 
sizes
[0] = 0;

3832 
i
=1; i < 16; ++i)

3833 ià(
sizes
[
i
] > (1 << i))

3834  
	`¡bi__”r
("bad sizes", "Corrupt PNG");

3835 
code
 = 0;

3836 
i
=1; i < 16; ++i) {

3837 
Ãxt_code
[
i
] = 
code
;

3838 
z
->
fœ¡code
[
i
] = (
¡bi__ušt16
è
code
;

3839 
z
->
fœ¡symbŞ
[
i
] = (
¡bi__ušt16
è
k
;

3840 
code
 = (cod+ 
sizes
[
i
]);

3841 ià(
sizes
[
i
])

3842 ià(
code
-1 >ğ(1 << 
i
)è 
	`¡bi__”r
("bad codelengths","Corrupt PNG");

3843 
z
->
maxcode
[
i
] = 
code
 << (16-i);

3844 
code
 <<= 1;

3845 
k
 +ğ
sizes
[
i
];

3847 
z
->
maxcode
[16] = 0x10000;

3848 
i
=0; i < 
num
; ++i) {

3849 
s
 = 
siz–i¡
[
i
];

3850 ià(
s
) {

3851 
c
 = 
Ãxt_code
[
s
] - 
z
->
fœ¡code
[s] + z->
fœ¡symbŞ
[s];

3852 
¡bi__ušt16
 
ç¡v
 = (¡bi__ušt16è((
s
 << 9è| 
i
);

3853 
z
->
size
 [
c
] = (
¡bi_uc
 ) 
s
;

3854 
z
->
v®ue
[
c
] = (
¡bi__ušt16
è
i
;

3855 ià(
s
 <ğ
STBI__ZFAST_BITS
) {

3856 
j
 = 
	`¡bi__b™_»v”£
(
Ãxt_code
[
s
],s);

3857 
j
 < (1 << 
STBI__ZFAST_BITS
)) {

3858 
z
->
ç¡
[
j
] = 
ç¡v
;

3859 
j
 +ğ(1 << 
s
);

3862 ++
Ãxt_code
[
s
];

3866 
	}
}

3876 
¡bi_uc
 *
	mzbufãr
, *
	mzbufãr_’d
;

3877 
	mnum_b™s
;

3878 
¡bi__ušt32
 
	mcode_bufãr
;

3880 *
	mzout
;

3881 *
	mzout_¡¬t
;

3882 *
	mzout_’d
;

3883 
	mz_ex·ndabË
;

3885 
¡bi__zhuffmª
 
	mz_Ëngth
, 
	mz_di¡ªû
;

3886 } 
	t¡bi__zbuf
;

3888 
¡bi_šlše
 
¡bi_uc
 
	$¡bi__zg‘8
(
¡bi__zbuf
 *
z
)

3890 ià(
z
->
zbufãr
 >ğz->
zbufãr_’d
)  0;

3891  *
z
->
zbufãr
++;

3892 
	}
}

3894 
	$¡bi__fl_b™s
(
¡bi__zbuf
 *
z
)

3897 
	`STBI_ASSERT
(
z
->
code_bufãr
 < (1U << z->
num_b™s
));

3898 
z
->
code_bufãr
 |ğ(è
	`¡bi__zg‘8
(zè<< z->
num_b™s
;

3899 
z
->
num_b™s
 += 8;

3900 } 
z
->
num_b™s
 <= 24);

3901 
	}
}

3903 
¡bi_šlše
 
	$¡bi__z»ûive
(
¡bi__zbuf
 *
z
, 
n
)

3905 
k
;

3906 ià(
z
->
num_b™s
 < 
n
è
	`¡bi__fl_b™s
(z);

3907 
k
 = 
z
->
code_bufãr
 & ((1 << 
n
) - 1);

3908 
z
->
code_bufãr
 >>ğ
n
;

3909 
z
->
num_b™s
 -ğ
n
;

3910  
k
;

3911 
	}
}

3913 
	$¡bi__zhuffmª_decode_¦ow·th
(
¡bi__zbuf
 *
a
, 
¡bi__zhuffmª
 *
z
)

3915 
b
,
s
,
k
;

3918 
k
 = 
	`¡bi__b™_»v”£
(
a
->
code_bufãr
, 16);

3919 
s
=
STBI__ZFAST_BITS
+1; ; ++s)

3920 ià(
k
 < 
z
->
maxcode
[
s
])

3922 ià(
s
 == 16)  -1;

3924 
b
 = (
k
 >> (16-
s
)è- 
z
->
fœ¡code
[s] + z->
fœ¡symbŞ
[s];

3925 
	`STBI_ASSERT
(
z
->
size
[
b
] =ğ
s
);

3926 
a
->
code_bufãr
 >>ğ
s
;

3927 
a
->
num_b™s
 -ğ
s
;

3928  
z
->
v®ue
[
b
];

3929 
	}
}

3931 
¡bi_šlše
 
	$¡bi__zhuffmª_decode
(
¡bi__zbuf
 *
a
, 
¡bi__zhuffmª
 *
z
)

3933 
b
,
s
;

3934 ià(
a
->
num_b™s
 < 16è
	`¡bi__fl_b™s
(a);

3935 
b
 = 
z
->
ç¡
[
a
->
code_bufãr
 & 
STBI__ZFAST_MASK
];

3936 ià(
b
) {

3937 
s
 = 
b
 >> 9;

3938 
a
->
code_bufãr
 >>ğ
s
;

3939 
a
->
num_b™s
 -ğ
s
;

3940  
b
 & 511;

3942  
	`¡bi__zhuffmª_decode_¦ow·th
(
a
, 
z
);

3943 
	}
}

3945 
	$¡bi__zex·nd
(
¡bi__zbuf
 *
z
, *
zout
, 
n
)

3947 *
q
;

3948 
cur
, 
lim™
, 
Şd_lim™
;

3949 
z
->
zout
 = zout;

3950 ià(!
z
->
z_ex·ndabË
è 
	`¡bi__”r
("output buffer†imit","Corrupt PNG");

3951 
cur
 = (è(
z
->
zout
 - z->
zout_¡¬t
);

3952 
lim™
 = 
Şd_lim™
 = (è(
z
->
zout_’d
 - z->
zout_¡¬t
);

3953 
cur
 + 
n
 > 
lim™
)

3954 
lim™
 *= 2;

3955 
q
 = (*è
	`STBI_REALLOC_SIZED
(
z
->
zout_¡¬t
, 
Şd_lim™
, 
lim™
);

3956 
	`STBI_NOTUSED
(
Şd_lim™
);

3957 ià(
q
 =ğ
NULL
è 
	`¡bi__”r
("outofmem", "Out of memory");

3958 
z
->
zout_¡¬t
 = 
q
;

3959 
z
->
zout
 = 
q
 + 
cur
;

3960 
z
->
zout_’d
 = 
q
 + 
lim™
;

3962 
	}
}

3964 cÚ¡ 
	g¡bi__zËngth_ba£
[31] = {

3969 cÚ¡ 
	g¡bi__zËngth_exŒa
[31]=

3972 cÚ¡ 
	g¡bi__zdi¡_ba£
[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,

3975 cÚ¡ 
	g¡bi__zdi¡_exŒa
[32] =

3978 
	$¡bi__·r£_huffmª_block
(
¡bi__zbuf
 *
a
)

3980 *
zout
 = 
a
->zout;

3982 
z
 = 
	`¡bi__zhuffmª_decode
(
a
, &a->
z_Ëngth
);

3983 ià(
z
 < 256) {

3984 ià(
z
 < 0è 
	`¡bi__”r
("bad huffman code","Corrupt PNG");

3985 ià(
zout
 >ğ
a
->
zout_’d
) {

3986 ià(!
	`¡bi__zex·nd
(
a
, 
zout
, 1))  0;

3987 
zout
 = 
a
->zout;

3989 *
zout
++ = (è
z
;

3991 
¡bi_uc
 *
p
;

3992 
Ën
,
di¡
;

3993 ià(
z
 == 256) {

3994 
a
->
zout
 = zout;

3997 
z
 -= 257;

3998 
Ën
 = 
¡bi__zËngth_ba£
[
z
];

3999 ià(
¡bi__zËngth_exŒa
[
z
]è
Ën
 +ğ
	`¡bi__z»ûive
(
a
, stbi__zlength_extra[z]);

4000 
z
 = 
	`¡bi__zhuffmª_decode
(
a
, &a->
z_di¡ªû
);

4001 ià(
z
 < 0è 
	`¡bi__”r
("bad huffman code","Corrupt PNG");

4002 
di¡
 = 
¡bi__zdi¡_ba£
[
z
];

4003 ià(
¡bi__zdi¡_exŒa
[
z
]è
di¡
 +ğ
	`¡bi__z»ûive
(
a
, stbi__zdist_extra[z]);

4004 ià(
zout
 - 
a
->
zout_¡¬t
 < 
di¡
è 
	`¡bi__”r
("bad dist","Corrupt PNG");

4005 ià(
zout
 + 
Ën
 > 
a
->
zout_’d
) {

4006 ià(!
	`¡bi__zex·nd
(
a
, 
zout
, 
Ën
))  0;

4007 
zout
 = 
a
->zout;

4009 
p
 = (
¡bi_uc
 *è(
zout
 - 
di¡
);

4010 ià(
di¡
 == 1) {

4011 
¡bi_uc
 
v
 = *
p
;

4012 ià(
Ën
è{ dØ*
zout
++ = 
v
; --len); }

4014 ià(
Ën
è{ dØ*
zout
++ = *
p
++; --len); }

4018 
	}
}

4020 
	$¡bi__compu‹_huffmª_codes
(
¡bi__zbuf
 *
a
)

4022 cÚ¡ 
¡bi_uc
 
Ëngth_dezigzag
[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };

4023 
¡bi__zhuffmª
 
z_cod–’gth
;

4024 
¡bi_uc
 
Ëncodes
[286+32+137];

4025 
¡bi_uc
 
cod–’gth_sizes
[19];

4026 
i
,
n
;

4028 
hl™
 = 
	`¡bi__z»ûive
(
a
,5) + 257;

4029 
hdi¡
 = 
	`¡bi__z»ûive
(
a
,5) + 1;

4030 
hş’
 = 
	`¡bi__z»ûive
(
a
,4) + 4;

4031 
ÁÙ
 = 
hl™
 + 
hdi¡
;

4033 
	`mem£t
(
cod–’gth_sizes
, 0, (codelength_sizes));

4034 
i
=0; i < 
hş’
; ++i) {

4035 
s
 = 
	`¡bi__z»ûive
(
a
,3);

4036 
cod–’gth_sizes
[
Ëngth_dezigzag
[
i
]] = (
¡bi_uc
è
s
;

4038 ià(!
	`¡bi__zbud_huffmª
(&
z_cod–’gth
, 
cod–’gth_sizes
, 19))  0;

4040 
n
 = 0;

4041 
n
 < 
ÁÙ
) {

4042 
c
 = 
	`¡bi__zhuffmª_decode
(
a
, &
z_cod–’gth
);

4043 ià(
c
 < 0 || c >ğ19è 
	`¡bi__”r
("bad codelengths", "Corrupt PNG");

4044 ià(
c
 < 16)

4045 
Ëncodes
[
n
++] = (
¡bi_uc
è
c
;

4047 
¡bi_uc
 
fl
 = 0;

4048 ià(
c
 == 16) {

4049 
c
 = 
	`¡bi__z»ûive
(
a
,2)+3;

4050 ià(
n
 =ğ0è 
	`¡bi__”r
("bad codelengths", "Corrupt PNG");

4051 
fl
 = 
Ëncodes
[
n
-1];

4052 } ià(
c
 == 17)

4053 
c
 = 
	`¡bi__z»ûive
(
a
,3)+3;

4055 
	`STBI_ASSERT
(
c
 == 18);

4056 
c
 = 
	`¡bi__z»ûive
(
a
,7)+11;

4058 ià(
ÁÙ
 - 
n
 < 
c
è 
	`¡bi__”r
("bad codelengths", "Corrupt PNG");

4059 
	`mem£t
(
Ëncodes
+
n
, 
fl
, 
c
);

4060 
n
 +ğ
c
;

4063 ià(
n
 !ğ
ÁÙ
è 
	`¡bi__”r
("bad codelengths","Corrupt PNG");

4064 ià(!
	`¡bi__zbud_huffmª
(&
a
->
z_Ëngth
, 
Ëncodes
, 
hl™
))  0;

4065 ià(!
	`¡bi__zbud_huffmª
(&
a
->
z_di¡ªû
, 
Ëncodes
+
hl™
, 
hdi¡
))  0;

4067 
	}
}

4069 
	$¡bi__·r£_uncom´es£d_block
(
¡bi__zbuf
 *
a
)

4071 
¡bi_uc
 
h—d”
[4];

4072 
Ën
,
Æ’
,
k
;

4073 ià(
a
->
num_b™s
 & 7)

4074 
	`¡bi__z»ûive
(
a
,‡->
num_b™s
 & 7);

4076 
k
 = 0;

4077 
a
->
num_b™s
 > 0) {

4078 
h—d”
[
k
++] = (
¡bi_uc
è(
a
->
code_bufãr
 & 255);

4079 
a
->
code_bufãr
 >>= 8;

4080 
a
->
num_b™s
 -= 8;

4082 
	`STBI_ASSERT
(
a
->
num_b™s
 == 0);

4084 
k
 < 4)

4085 
h—d”
[
k
++] = 
	`¡bi__zg‘8
(
a
);

4086 
Ën
 = 
h—d”
[1] * 256 + header[0];

4087 
Æ’
 = 
h—d”
[3] * 256 + header[2];

4088 ià(
Æ’
 !ğ(
Ën
 ^ 0xffff)è 
	`¡bi__”r
("zlib corrupt","Corrupt PNG");

4089 ià(
a
->
zbufãr
 + 
Ën
 >‡->
zbufãr_’d
è 
	`¡bi__”r
("read…ast buffer","Corrupt PNG");

4090 ià(
a
->
zout
 + 
Ën
 >‡->
zout_’d
)

4091 ià(!
	`¡bi__zex·nd
(
a
,‡->
zout
, 
Ën
))  0;

4092 
	`memıy
(
a
->
zout
,‡->
zbufãr
, 
Ën
);

4093 
a
->
zbufãr
 +ğ
Ën
;

4094 
a
->
zout
 +ğ
Ën
;

4096 
	}
}

4098 
	$¡bi__·r£_zlib_h—d”
(
¡bi__zbuf
 *
a
)

4100 
cmf
 = 
	`¡bi__zg‘8
(
a
);

4101 
cm
 = 
cmf
 & 15;

4103 
æg
 = 
	`¡bi__zg‘8
(
a
);

4104 ià((
cmf
*256+
æg
è% 31 !ğ0è 
	`¡bi__”r
("bad zlib header","Corrupt PNG");

4105 ià(
æg
 & 32è 
	`¡bi__”r
("no…reset dict","Corrupt PNG");

4106 ià(
cm
 !ğ8è 
	`¡bi__”r
("bad compression","Corrupt PNG");

4109 
	}
}

4111 cÚ¡ 
¡bi_uc
 
	g¡bi__zdeçuÉ_Ëngth
[288] =

4123 cÚ¡ 
¡bi_uc
 
	g¡bi__zdeçuÉ_di¡ªû
[32] =

4140 
	$¡bi__·r£_zlib
(
¡bi__zbuf
 *
a
, 
·r£_h—d”
)

4142 
fš®
, 
ty³
;

4143 ià(
·r£_h—d”
)

4144 ià(!
	`¡bi__·r£_zlib_h—d”
(
a
))  0;

4145 
a
->
num_b™s
 = 0;

4146 
a
->
code_bufãr
 = 0;

4148 
fš®
 = 
	`¡bi__z»ûive
(
a
,1);

4149 
ty³
 = 
	`¡bi__z»ûive
(
a
,2);

4150 ià(
ty³
 == 0) {

4151 ià(!
	`¡bi__·r£_uncom´es£d_block
(
a
))  0;

4152 } ià(
ty³
 == 3) {

4155 ià(
ty³
 == 1) {

4157 ià(!
	`¡bi__zbud_huffmª
(&
a
->
z_Ëngth
 , 
¡bi__zdeçuÉ_Ëngth
 , 288))  0;

4158 ià(!
	`¡bi__zbud_huffmª
(&
a
->
z_di¡ªû
, 
¡bi__zdeçuÉ_di¡ªû
, 32))  0;

4160 ià(!
	`¡bi__compu‹_huffmª_codes
(
a
))  0;

4162 ià(!
	`¡bi__·r£_huffmª_block
(
a
))  0;

4164 } !
fš®
);

4166 
	}
}

4168 
	$¡bi__do_zlib
(
¡bi__zbuf
 *
a
, *
obuf
, 
Ş’
, 
exp
, 
·r£_h—d”
)

4170 
a
->
zout_¡¬t
 = 
obuf
;

4171 
a
->
zout
 = 
obuf
;

4172 
a
->
zout_’d
 = 
obuf
 + 
Ş’
;

4173 
a
->
z_ex·ndabË
 = 
exp
;

4175  
	`¡bi__·r£_zlib
(
a
, 
·r£_h—d”
);

4176 
	}
}

4178 
STBIDEF
 *
	$¡bi_zlib_decode_m®loc_guesssize
(cÚ¡ *
bufãr
, 
Ën
, 
š™Ÿl_size
, *
ou’
)

4180 
¡bi__zbuf
 
a
;

4181 *
p
 = (*è
	`¡bi__m®loc
(
š™Ÿl_size
);

4182 ià(
p
 =ğ
NULL
)  NULL;

4183 
a
.
zbufãr
 = (
¡bi_uc
 *è
bufãr
;

4184 
a
.
zbufãr_’d
 = (
¡bi_uc
 *è
bufãr
 + 
Ën
;

4185 ià(
	`¡bi__do_zlib
(&
a
, 
p
, 
š™Ÿl_size
, 1, 1)) {

4186 ià(
ou’
è*ou’ = (è(
a
.
zout
 -‡.
zout_¡¬t
);

4187  
a
.
zout_¡¬t
;

4189 
	`STBI_FREE
(
a
.
zout_¡¬t
);

4190  
NULL
;

4192 
	}
}

4194 
STBIDEF
 *
	$¡bi_zlib_decode_m®loc
(cÚ¡ *
bufãr
, 
Ën
, *
ou’
)

4196  
	`¡bi_zlib_decode_m®loc_guesssize
(
bufãr
, 
Ën
, 16384, 
ou’
);

4197 
	}
}

4199 
STBIDEF
 *
	$¡bi_zlib_decode_m®loc_guesssize_h—d”æag
(cÚ¡ *
bufãr
, 
Ën
, 
š™Ÿl_size
, *
ou’
, 
·r£_h—d”
)

4201 
¡bi__zbuf
 
a
;

4202 *
p
 = (*è
	`¡bi__m®loc
(
š™Ÿl_size
);

4203 ià(
p
 =ğ
NULL
)  NULL;

4204 
a
.
zbufãr
 = (
¡bi_uc
 *è
bufãr
;

4205 
a
.
zbufãr_’d
 = (
¡bi_uc
 *è
bufãr
 + 
Ën
;

4206 ià(
	`¡bi__do_zlib
(&
a
, 
p
, 
š™Ÿl_size
, 1, 
·r£_h—d”
)) {

4207 ià(
ou’
è*ou’ = (è(
a
.
zout
 -‡.
zout_¡¬t
);

4208  
a
.
zout_¡¬t
;

4210 
	`STBI_FREE
(
a
.
zout_¡¬t
);

4211  
NULL
;

4213 
	}
}

4215 
STBIDEF
 
	$¡bi_zlib_decode_bufãr
(*
obufãr
, 
Ş’
, cÚ¡ *
ibufãr
, 
’
)

4217 
¡bi__zbuf
 
a
;

4218 
a
.
zbufãr
 = (
¡bi_uc
 *è
ibufãr
;

4219 
a
.
zbufãr_’d
 = (
¡bi_uc
 *è
ibufãr
 + 
’
;

4220 ià(
	`¡bi__do_zlib
(&
a
, 
obufãr
, 
Ş’
, 0, 1))

4221  (è(
a
.
zout
 -‡.
zout_¡¬t
);

4224 
	}
}

4226 
STBIDEF
 *
	$¡bi_zlib_decode_noh—d”_m®loc
(cÚ¡ *
bufãr
, 
Ën
, *
ou’
)

4228 
¡bi__zbuf
 
a
;

4229 *
p
 = (*è
	`¡bi__m®loc
(16384);

4230 ià(
p
 =ğ
NULL
)  NULL;

4231 
a
.
zbufãr
 = (
¡bi_uc
 *è
bufãr
;

4232 
a
.
zbufãr_’d
 = (
¡bi_uc
 *è
bufãr
+
Ën
;

4233 ià(
	`¡bi__do_zlib
(&
a
, 
p
, 16384, 1, 0)) {

4234 ià(
ou’
è*ou’ = (è(
a
.
zout
 -‡.
zout_¡¬t
);

4235  
a
.
zout_¡¬t
;

4237 
	`STBI_FREE
(
a
.
zout_¡¬t
);

4238  
NULL
;

4240 
	}
}

4242 
STBIDEF
 
	$¡bi_zlib_decode_noh—d”_bufãr
(*
obufãr
, 
Ş’
, cÚ¡ *
ibufãr
, 
’
)

4244 
¡bi__zbuf
 
a
;

4245 
a
.
zbufãr
 = (
¡bi_uc
 *è
ibufãr
;

4246 
a
.
zbufãr_’d
 = (
¡bi_uc
 *è
ibufãr
 + 
’
;

4247 ià(
	`¡bi__do_zlib
(&
a
, 
obufãr
, 
Ş’
, 0, 0))

4248  (è(
a
.
zout
 -‡.
zout_¡¬t
);

4251 
	}
}

4264 #iâdeà
STBI_NO_PNG


4267 
¡bi__ušt32
 
	mËngth
;

4268 
¡bi__ušt32
 
	mty³
;

4269 } 
	t¡bi__²gchunk
;

4271 
¡bi__²gchunk
 
	$¡bi__g‘_chunk_h—d”
(
¡bi__cÚ‹xt
 *
s
)

4273 
¡bi__²gchunk
 
c
;

4274 
c
.
Ëngth
 = 
	`¡bi__g‘32be
(
s
);

4275 
c
.
ty³
 = 
	`¡bi__g‘32be
(
s
);

4276  
c
;

4277 
	}
}

4279 
	$¡bi__check_²g_h—d”
(
¡bi__cÚ‹xt
 *
s
)

4281 cÚ¡ 
¡bi_uc
 
²g_sig
[8] = { 137,80,78,71,13,10,26,10 };

4282 
i
;

4283 
i
=0; i < 8; ++i)

4284 ià(
	`¡bi__g‘8
(
s
è!ğ
²g_sig
[
i
]è 
	`¡bi__”r
("bad…ng sig","Not‡ PNG");

4286 
	}
}

4290 
¡bi__cÚ‹xt
 *
	ms
;

4291 
¡bi_uc
 *
	mid©a
, *
	mex·nded
, *
	mout
;

4292 
	md•th
;

4293 } 
	t¡bi__²g
;

4297 
	mSTBI__F_nÚe
=0,

4298 
	mSTBI__F_sub
=1,

4299 
	mSTBI__F_up
=2,

4300 
	mSTBI__F_avg
=3,

4301 
	mSTBI__F_·‘h
=4,

4303 
	mSTBI__F_avg_fœ¡
,

4304 
	mSTBI__F_·‘h_fœ¡


4307 
¡bi_uc
 
	gfœ¡_row_f‹r
[5] =

4309 
STBI__F_nÚe
,

4310 
STBI__F_sub
,

4311 
STBI__F_nÚe
,

4312 
STBI__F_avg_fœ¡
,

4313 
STBI__F_·‘h_fœ¡


4316 
	$¡bi__·‘h
(
a
, 
b
, 
c
)

4318 
p
 = 
a
 + 
b
 - 
c
;

4319 
·
 = 
	`abs
(
p
-
a
);

4320 
pb
 = 
	`abs
(
p
-
b
);

4321 
pc
 = 
	`abs
(
p
-
c
);

4322 ià(
·
 <ğ
pb
 &&…¨<ğ
pc
è 
a
;

4323 ià(
pb
 <ğ
pc
è 
b
;

4324  
c
;

4325 
	}
}

4327 cÚ¡ 
¡bi_uc
 
	g¡bi__d•th_sÿË_bË
[9] = { 0, 0xff, 0x55, 0, 0x11, 0,0,0, 0x01 };

4330 
	$¡bi__ü—‹_²g_image_¿w
(
¡bi__²g
 *
a
, 
¡bi_uc
 *
¿w
, 
¡bi__ušt32
 
¿w_Ën
, 
out_n
, stbi__ušt32 
x
, stbi__ušt32 
y
, 
d•th
, 
cŞÜ
)

4332 
by‹s
 = (
d•th
 == 16? 2 : 1);

4333 
¡bi__cÚ‹xt
 *
s
 = 
a
->s;

4334 
¡bi__ušt32
 
i
,
j
,
¡ride
 = 
x
*
out_n
*
by‹s
;

4335 
¡bi__ušt32
 
img_Ën
, 
img_width_by‹s
;

4336 
k
;

4337 
img_n
 = 
s
->img_n;

4339 
ouut_by‹s
 = 
out_n
*
by‹s
;

4340 
f‹r_by‹s
 = 
img_n
*
by‹s
;

4341 
width
 = 
x
;

4343 
	`STBI_ASSERT
(
out_n
 =ğ
s
->
img_n
 || out_n == s->img_n+1);

4344 
a
->
out
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
x
, 
y
, 
ouut_by‹s
, 0);

4345 ià(!
a
->
out
è 
	`¡bi__”r
("outofmem", "Out of memory");

4347 ià(!
	`¡bi__mad3sizes_v®id
(
img_n
, 
x
, 
d•th
, 7)è 
	`¡bi__”r
("too†arge", "Corrupt PNG");

4348 
img_width_by‹s
 = (((
img_n
 * 
x
 * 
d•th
) + 7) >> 3);

4349 
img_Ën
 = (
img_width_by‹s
 + 1è* 
y
;

4354 ià(
¿w_Ën
 < 
img_Ën
è 
	`¡bi__”r
("notƒnough…ixels","Corrupt PNG");

4356 
j
=0; j < 
y
; ++j) {

4357 
¡bi_uc
 *
cur
 = 
a
->
out
 + 
¡ride
*
j
;

4358 
¡bi_uc
 *
´iÜ
;

4359 
f‹r
 = *
¿w
++;

4361 ià(
f‹r
 > 4)

4362  
	`¡bi__”r
("invalid filter","Corrupt PNG");

4364 ià(
d•th
 < 8) {

4365 
	`STBI_ASSERT
(
img_width_by‹s
 <ğ
x
);

4366 
cur
 +ğ
x
*
out_n
 - 
img_width_by‹s
;

4367 
f‹r_by‹s
 = 1;

4368 
width
 = 
img_width_by‹s
;

4370 
´iÜ
 = 
cur
 - 
¡ride
;

4373 ià(
j
 =ğ0è
f‹r
 = 
fœ¡_row_f‹r
[filter];

4376 
k
=0; k < 
f‹r_by‹s
; ++k) {

4377 
f‹r
) {

4378 
STBI__F_nÚe
 : 
cur
[
k
] = 
¿w
[k]; ;

4379 
STBI__F_sub
 : 
cur
[
k
] = 
¿w
[k]; ;

4380 
STBI__F_up
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
´iÜ
[k]); ;

4381 
STBI__F_avg
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + (
´iÜ
[k]>>1)); ;

4382 
STBI__F_·‘h
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
	`¡bi__·‘h
(0,
´iÜ
[k],0)); ;

4383 
STBI__F_avg_fœ¡
 : 
cur
[
k
] = 
¿w
[k]; ;

4384 
STBI__F_·‘h_fœ¡
: 
cur
[
k
] = 
¿w
[k]; ;

4388 ià(
d•th
 == 8) {

4389 ià(
img_n
 !ğ
out_n
)

4390 
cur
[
img_n
] = 255;

4391 
¿w
 +ğ
img_n
;

4392 
cur
 +ğ
out_n
;

4393 
´iÜ
 +ğ
out_n
;

4394 } ià(
d•th
 == 16) {

4395 ià(
img_n
 !ğ
out_n
) {

4396 
cur
[
f‹r_by‹s
] = 255;

4397 
cur
[
f‹r_by‹s
+1] = 255;

4399 
¿w
 +ğ
f‹r_by‹s
;

4400 
cur
 +ğ
ouut_by‹s
;

4401 
´iÜ
 +ğ
ouut_by‹s
;

4403 
¿w
 += 1;

4404 
cur
 += 1;

4405 
´iÜ
 += 1;

4409 ià(
d•th
 < 8 || 
img_n
 =ğ
out_n
) {

4410 
nk
 = (
width
 - 1)*
f‹r_by‹s
;

4411 
	#STBI__CASE
(
f
) \

4412 
f
: \

4413 
k
=0; k < 
nk
; ++k)

	)

4414 
f‹r
) {

4416 
STBI__F_nÚe
: 
	`memıy
(
cur
, 
¿w
, 
nk
); ;

4417 
	`STBI__CASE
(
STBI__F_sub
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + cur[k-
f‹r_by‹s
]); } ;

4418 
	`STBI__CASE
(
STBI__F_up
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
´iÜ
[k]); } ;

4419 
	`STBI__CASE
(
STBI__F_avg
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + ((
´iÜ
[k] + cur[k-
f‹r_by‹s
])>>1)); } ;

4420 
	`STBI__CASE
(
STBI__F_·‘h
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
	`¡bi__·‘h
(cur[k-
f‹r_by‹s
],
´iÜ
[k],prior[k-filter_bytes])); } ;

4421 
	`STBI__CASE
(
STBI__F_avg_fœ¡
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + (cur[k-
f‹r_by‹s
] >> 1)); } ;

4422 
	`STBI__CASE
(
STBI__F_·‘h_fœ¡
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
	`¡bi__·‘h
(cur[k-
f‹r_by‹s
],0,0)); } ;

4424 #undeà
STBI__CASE


4425 
¿w
 +ğ
nk
;

4427 
	`STBI_ASSERT
(
img_n
+1 =ğ
out_n
);

4428 
	#STBI__CASE
(
f
) \

4429 
f
: \

4430 
i
=
x
-1; i >ğ1; --i, 
cur
[
f‹r_by‹s
]=255,
¿w
+=f‹r_by‹s,cur+=
ouut_by‹s
,
´iÜ
+=output_bytes) \

4431 
k
=0; k < 
f‹r_by‹s
; ++k)

	)

4432 
f‹r
) {

4433 
	`STBI__CASE
(
STBI__F_nÚe
è{ 
cur
[
k
] = 
¿w
[k]; } ;

4434 
	`STBI__CASE
(
STBI__F_sub
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + cur[k- 
ouut_by‹s
]); } ;

4435 
	`STBI__CASE
(
STBI__F_up
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
´iÜ
[k]); } ;

4436 
	`STBI__CASE
(
STBI__F_avg
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + ((
´iÜ
[k] + cur[k- 
ouut_by‹s
])>>1)); } ;

4437 
	`STBI__CASE
(
STBI__F_·‘h
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
	`¡bi__·‘h
(cur[k- 
ouut_by‹s
],
´iÜ
[k],prior[k- output_bytes])); } ;

4438 
	`STBI__CASE
(
STBI__F_avg_fœ¡
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + (cur[k- 
ouut_by‹s
] >> 1)); } ;

4439 
	`STBI__CASE
(
STBI__F_·‘h_fœ¡
è{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
¿w
[k] + 
	`¡bi__·‘h
(cur[k- 
ouut_by‹s
],0,0)); } ;

4441 #undeà
STBI__CASE


4445 ià(
d•th
 == 16) {

4446 
cur
 = 
a
->
out
 + 
¡ride
*
j
;

4447 
i
=0; i < 
x
; ++i,
cur
+=
ouut_by‹s
) {

4448 
cur
[
f‹r_by‹s
+1] = 255;

4457 ià(
d•th
 < 8) {

4458 
j
=0; j < 
y
; ++j) {

4459 
¡bi_uc
 *
cur
 = 
a
->
out
 + 
¡ride
*
j
;

4460 
¡bi_uc
 *
š
 = 
a
->
out
 + 
¡ride
*
j
 + 
x
*
out_n
 - 
img_width_by‹s
;

4463 
¡bi_uc
 
sÿË
 = (
cŞÜ
 =ğ0è? 
¡bi__d•th_sÿË_bË
[
d•th
] : 1;

4471 ià(
d•th
 == 4) {

4472 
k
=
x
*
img_n
; k >ğ2; k-=2, ++
š
) {

4473 *
cur
++ = 
sÿË
 * ((*
š
 >> 4) );

4474 *
cur
++ = 
sÿË
 * ((*
š
 ) & 0x0f);

4476 ià(
k
 > 0è*
cur
++ = 
sÿË
 * ((*
š
 >> 4) );

4477 } ià(
d•th
 == 2) {

4478 
k
=
x
*
img_n
; k >ğ4; k-=4, ++
š
) {

4479 *
cur
++ = 
sÿË
 * ((*
š
 >> 6) );

4480 *
cur
++ = 
sÿË
 * ((*
š
 >> 4) & 0x03);

4481 *
cur
++ = 
sÿË
 * ((*
š
 >> 2) & 0x03);

4482 *
cur
++ = 
sÿË
 * ((*
š
 ) & 0x03);

4484 ià(
k
 > 0è*
cur
++ = 
sÿË
 * ((*
š
 >> 6) );

4485 ià(
k
 > 1è*
cur
++ = 
sÿË
 * ((*
š
 >> 4) & 0x03);

4486 ià(
k
 > 2è*
cur
++ = 
sÿË
 * ((*
š
 >> 2) & 0x03);

4487 } ià(
d•th
 == 1) {

4488 
k
=
x
*
img_n
; k >ğ8; k-=8, ++
š
) {

4489 *
cur
++ = 
sÿË
 * ((*
š
 >> 7) );

4490 *
cur
++ = 
sÿË
 * ((*
š
 >> 6) & 0x01);

4491 *
cur
++ = 
sÿË
 * ((*
š
 >> 5) & 0x01);

4492 *
cur
++ = 
sÿË
 * ((*
š
 >> 4) & 0x01);

4493 *
cur
++ = 
sÿË
 * ((*
š
 >> 3) & 0x01);

4494 *
cur
++ = 
sÿË
 * ((*
š
 >> 2) & 0x01);

4495 *
cur
++ = 
sÿË
 * ((*
š
 >> 1) & 0x01);

4496 *
cur
++ = 
sÿË
 * ((*
š
 ) & 0x01);

4498 ià(
k
 > 0è*
cur
++ = 
sÿË
 * ((*
š
 >> 7) );

4499 ià(
k
 > 1è*
cur
++ = 
sÿË
 * ((*
š
 >> 6) & 0x01);

4500 ià(
k
 > 2è*
cur
++ = 
sÿË
 * ((*
š
 >> 5) & 0x01);

4501 ià(
k
 > 3è*
cur
++ = 
sÿË
 * ((*
š
 >> 4) & 0x01);

4502 ià(
k
 > 4è*
cur
++ = 
sÿË
 * ((*
š
 >> 3) & 0x01);

4503 ià(
k
 > 5è*
cur
++ = 
sÿË
 * ((*
š
 >> 2) & 0x01);

4504 ià(
k
 > 6è*
cur
++ = 
sÿË
 * ((*
š
 >> 1) & 0x01);

4506 ià(
img_n
 !ğ
out_n
) {

4507 
q
;

4509 
cur
 = 
a
->
out
 + 
¡ride
*
j
;

4510 ià(
img_n
 == 1) {

4511 
q
=
x
-1; q >= 0; --q) {

4512 
cur
[
q
*2+1] = 255;

4513 
cur
[
q
*2+0] = cur[q];

4516 
	`STBI_ASSERT
(
img_n
 == 3);

4517 
q
=
x
-1; q >= 0; --q) {

4518 
cur
[
q
*4+3] = 255;

4519 
cur
[
q
*4+2] = cur[q*3+2];

4520 
cur
[
q
*4+1] = cur[q*3+1];

4521 
cur
[
q
*4+0] = cur[q*3+0];

4526 } ià(
d•th
 == 16) {

4531 
¡bi_uc
 *
cur
 = 
a
->
out
;

4532 
¡bi__ušt16
 *
cur16
 = (¡bi__ušt16*)
cur
;

4534 
i
=0; i < 
x
*
y
*
out_n
; ++i,
cur16
++,
cur
+=2) {

4535 *
cur16
 = (
cur
[0] << 8) | cur[1];

4540 
	}
}

4542 
	$¡bi__ü—‹_²g_image
(
¡bi__²g
 *
a
, 
¡bi_uc
 *
image_d©a
, 
¡bi__ušt32
 
image_d©a_Ën
, 
out_n
, 
d•th
, 
cŞÜ
, 
š‹¾aûd
)

4544 
by‹s
 = (
d•th
 == 16 ? 2 : 1);

4545 
out_by‹s
 = 
out_n
 * 
by‹s
;

4546 
¡bi_uc
 *
fš®
;

4547 
p
;

4548 ià(!
š‹¾aûd
)

4549  
	`¡bi__ü—‹_²g_image_¿w
(
a
, 
image_d©a
, 
image_d©a_Ën
, 
out_n
,‡->
s
->
img_x
,‡->s->
img_y
, 
d•th
, 
cŞÜ
);

4552 
fš®
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
a
->
s
->
img_x
,‡->s->
img_y
, 
out_by‹s
, 0);

4553 
p
=0;… < 7; ++p) {

4554 
xÜig
[] = { 0,4,0,2,0,1,0 };

4555 
yÜig
[] = { 0,0,4,0,2,0,1 };

4556 
x¥c
[] = { 8,8,4,4,2,2,1 };

4557 
y¥c
[] = { 8,8,8,4,4,2,2 };

4558 
i
,
j
,
x
,
y
;

4560 
x
 = (
a
->
s
->
img_x
 - 
xÜig
[
p
] + 
x¥c
[p]-1) / xspc[p];

4561 
y
 = (
a
->
s
->
img_y
 - 
yÜig
[
p
] + 
y¥c
[p]-1) / yspc[p];

4562 ià(
x
 && 
y
) {

4563 
¡bi__ušt32
 
img_Ën
 = ((((
a
->
s
->
img_n
 * 
x
 * 
d•th
è+ 7è>> 3è+ 1è* 
y
;

4564 ià(!
	`¡bi__ü—‹_²g_image_¿w
(
a
, 
image_d©a
, 
image_d©a_Ën
, 
out_n
, 
x
, 
y
, 
d•th
, 
cŞÜ
)) {

4565 
	`STBI_FREE
(
fš®
);

4568 
j
=0; j < 
y
; ++j) {

4569 
i
=0; i < 
x
; ++i) {

4570 
out_y
 = 
j
*
y¥c
[
p
]+
yÜig
[p];

4571 
out_x
 = 
i
*
x¥c
[
p
]+
xÜig
[p];

4572 
	`memıy
(
fš®
 + 
out_y
*
a
->
s
->
img_x
*
out_by‹s
 + 
out_x
*out_bytes,

4573 
a
->
out
 + (
j
*
x
+
i
)*
out_by‹s
, out_bytes);

4576 
	`STBI_FREE
(
a
->
out
);

4577 
image_d©a
 +ğ
img_Ën
;

4578 
image_d©a_Ën
 -ğ
img_Ën
;

4581 
a
->
out
 = 
fš®
;

4584 
	}
}

4586 
	$¡bi__compu‹_Œª¥¬’cy
(
¡bi__²g
 *
z
, 
¡bi_uc
 
tc
[3], 
out_n
)

4588 
¡bi__cÚ‹xt
 *
s
 = 
z
->s;

4589 
¡bi__ušt32
 
i
, 
pix–_couÁ
 = 
s
->
img_x
 * s->
img_y
;

4590 
¡bi_uc
 *
p
 = 
z
->
out
;

4594 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4596 ià(
out_n
 == 2) {

4597 
i
=0; i < 
pix–_couÁ
; ++i) {

4598 
p
[1] = (p[0] =ğ
tc
[0] ? 0 : 255);

4599 
p
 += 2;

4602 
i
=0; i < 
pix–_couÁ
; ++i) {

4603 ià(
p
[0] =ğ
tc
[0] &&…[1] ==c[1] &&…[2] ==c[2])

4604 
p
[3] = 0;

4605 
p
 += 4;

4609 
	}
}

4611 
	$¡bi__compu‹_Œª¥¬’cy16
(
¡bi__²g
 *
z
, 
¡bi__ušt16
 
tc
[3], 
out_n
)

4613 
¡bi__cÚ‹xt
 *
s
 = 
z
->s;

4614 
¡bi__ušt32
 
i
, 
pix–_couÁ
 = 
s
->
img_x
 * s->
img_y
;

4615 
¡bi__ušt16
 *
p
 = (¡bi__ušt16*è
z
->
out
;

4619 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4621 ià(
out_n
 == 2) {

4622 
i
 = 0; i < 
pix–_couÁ
; ++i) {

4623 
p
[1] = (p[0] =ğ
tc
[0] ? 0 : 65535);

4624 
p
 += 2;

4627 
i
 = 0; i < 
pix–_couÁ
; ++i) {

4628 ià(
p
[0] =ğ
tc
[0] &&…[1] ==c[1] &&…[2] ==c[2])

4629 
p
[3] = 0;

4630 
p
 += 4;

4634 
	}
}

4636 
	$¡bi__ex·nd_²g_·Ë‰e
(
¡bi__²g
 *
a
, 
¡bi_uc
 *
·Ë‰e
, 
Ën
, 
·l_img_n
)

4638 
¡bi__ušt32
 
i
, 
pix–_couÁ
 = 
a
->
s
->
img_x
 *‡->s->
img_y
;

4639 
¡bi_uc
 *
p
, *
‹mp_out
, *
Üig
 = 
a
->
out
;

4641 
p
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad2
(
pix–_couÁ
, 
·l_img_n
, 0);

4642 ià(
p
 =ğ
NULL
è 
	`¡bi__”r
("outofmem", "Out of memory");

4645 
‹mp_out
 = 
p
;

4647 ià(
·l_img_n
 == 3) {

4648 
i
=0; i < 
pix–_couÁ
; ++i) {

4649 
n
 = 
Üig
[
i
]*4;

4650 
p
[0] = 
·Ë‰e
[
n
 ];

4651 
p
[1] = 
·Ë‰e
[
n
+1];

4652 
p
[2] = 
·Ë‰e
[
n
+2];

4653 
p
 += 3;

4656 
i
=0; i < 
pix–_couÁ
; ++i) {

4657 
n
 = 
Üig
[
i
]*4;

4658 
p
[0] = 
·Ë‰e
[
n
 ];

4659 
p
[1] = 
·Ë‰e
[
n
+1];

4660 
p
[2] = 
·Ë‰e
[
n
+2];

4661 
p
[3] = 
·Ë‰e
[
n
+3];

4662 
p
 += 4;

4665 
	`STBI_FREE
(
a
->
out
);

4666 
a
->
out
 = 
‹mp_out
;

4668 
	`STBI_NOTUSED
(
Ën
);

4671 
	}
}

4673 
	g¡bi__uÅ»muÉly_Ú_lßd
 = 0;

4674 
	g¡bi__de_hÚe_æag
 = 0;

4676 
STBIDEF
 
	$¡bi_£t_uÅ»muÉly_Ú_lßd
(
æag_Œue_if_should_uÅ»muÉly
)

4678 
¡bi__uÅ»muÉly_Ú_lßd
 = 
æag_Œue_if_should_uÅ»muÉly
;

4679 
	}
}

4681 
STBIDEF
 
	$¡bi_cÚv”t_hÚe_²g_to_rgb
(
æag_Œue_if_should_cÚv”t
)

4683 
¡bi__de_hÚe_æag
 = 
æag_Œue_if_should_cÚv”t
;

4684 
	}
}

4686 
	$¡bi__de_hÚe
(
¡bi__²g
 *
z
)

4688 
¡bi__cÚ‹xt
 *
s
 = 
z
->s;

4689 
¡bi__ušt32
 
i
, 
pix–_couÁ
 = 
s
->
img_x
 * s->
img_y
;

4690 
¡bi_uc
 *
p
 = 
z
->
out
;

4692 ià(
s
->
img_out_n
 == 3) {

4693 
i
=0; i < 
pix–_couÁ
; ++i) {

4694 
¡bi_uc
 
t
 = 
p
[0];

4695 
p
[0] =…[2];

4696 
p
[2] = 
t
;

4697 
p
 += 3;

4700 
	`STBI_ASSERT
(
s
->
img_out_n
 == 4);

4701 ià(
¡bi__uÅ»muÉly_Ú_lßd
) {

4703 
i
=0; i < 
pix–_couÁ
; ++i) {

4704 
¡bi_uc
 
a
 = 
p
[3];

4705 
¡bi_uc
 
t
 = 
p
[0];

4706 ià(
a
) {

4707 
¡bi_uc
 
h®f
 = 
a
 / 2;

4708 
p
[0] = (p[2] * 255 + 
h®f
è/ 
a
;

4709 
p
[1] = (p[1] * 255 + 
h®f
è/ 
a
;

4710 
p
[2] = ( 
t
 * 255 + 
h®f
è/ 
a
;

4712 
p
[0] =…[2];

4713 
p
[2] = 
t
;

4715 
p
 += 4;

4719 
i
=0; i < 
pix–_couÁ
; ++i) {

4720 
¡bi_uc
 
t
 = 
p
[0];

4721 
p
[0] =…[2];

4722 
p
[2] = 
t
;

4723 
p
 += 4;

4727 
	}
}

4729 
	#STBI__PNG_TYPE
(
a
,
b
,
c
,
d
è(((è×è<< 24è+ ((è(bè<< 16è+ ((è(cè<< 8è+ (è(d))

	)

4731 
	$¡bi__·r£_²g_fe
(
¡bi__²g
 *
z
, 
sÿn
, 
»q_comp
)

4733 
¡bi_uc
 
·Ë‰e
[1024], 
·l_img_n
=0;

4734 
¡bi_uc
 
has_Œªs
=0, 
tc
[3];

4735 
¡bi__ušt16
 
tc16
[3];

4736 
¡bi__ušt32
 
ioff
=0, 
id©a_lim™
=0, 
i
, 
·l_Ën
=0;

4737 
fœ¡
=1,
k
,
š‹¾aû
=0, 
cŞÜ
=0, 
is_hÚe
=0;

4738 
¡bi__cÚ‹xt
 *
s
 = 
z
->s;

4740 
z
->
ex·nded
 = 
NULL
;

4741 
z
->
id©a
 = 
NULL
;

4742 
z
->
out
 = 
NULL
;

4744 ià(!
	`¡bi__check_²g_h—d”
(
s
))  0;

4746 ià(
sÿn
 =ğ
STBI__SCAN_ty³
)  1;

4749 
¡bi__²gchunk
 
c
 = 
	`¡bi__g‘_chunk_h—d”
(
s
);

4750 
c
.
ty³
) {

4751 
	`STBI__PNG_TYPE
('C','g','B','I'):

4752 
is_hÚe
 = 1;

4753 
	`¡bi__sk
(
s
, 
c
.
Ëngth
);

4755 
	`STBI__PNG_TYPE
('I','H','D','R'): {

4756 
comp
,
f‹r
;

4757 ià(!
fœ¡
è 
	`¡bi__”r
("multiple IHDR","Corrupt PNG");

4758 
fœ¡
 = 0;

4759 ià(
c
.
Ëngth
 !ğ13è 
	`¡bi__”r
("bad IHDR†en","Corrupt PNG");

4760 
s
->
img_x
 = 
	`¡bi__g‘32be
(s); ià(s->img_x > (1 << 24)è 
	`¡bi__”r
("too†arge","Very†arge image (corrupt?)");

4761 
s
->
img_y
 = 
	`¡bi__g‘32be
(s); ià(s->img_y > (1 << 24)è 
	`¡bi__”r
("too†arge","Very†arge image (corrupt?)");

4762 
z
->
d•th
 = 
	`¡bi__g‘8
(
s
); ià(z->d•th !ğ1 && z->d•th !ğ2 && z->d•th !ğ4 && z->d•th !ğ8 && z->d•th !ğ16è 
	`¡bi__”r
("1/2/4/8/16-bit only","PNG‚ot supported: 1/2/4/8/16-bit only");

4763 
cŞÜ
 = 
	`¡bi__g‘8
(
s
); ià(cŞÜ > 6è 
	`¡bi__”r
("bad ctype","Corrupt PNG");

4764 ià(
cŞÜ
 =ğ3 && 
z
->
d•th
 =ğ16è 
	`¡bi__”r
("bad ctype","Corrupt PNG");

4765 ià(
cŞÜ
 =ğ3è
·l_img_n
 = 3; ià(cŞÜ & 1è 
	`¡bi__”r
("bad ctype","Corrupt PNG");

4766 
comp
 = 
	`¡bi__g‘8
(
s
); ià(compè 
	`¡bi__”r
("bad comp method","Corrupt PNG");

4767 
f‹r
ğ
	`¡bi__g‘8
(
s
); ià(f‹rè 
	`¡bi__”r
("bad filter method","Corrupt PNG");

4768 
š‹¾aû
 = 
	`¡bi__g‘8
(
s
); ià(š‹¾aû>1è 
	`¡bi__”r
("bad interlace method","Corrupt PNG");

4769 ià(!
s
->
img_x
 || !s->
img_y
è 
	`¡bi__”r
("0-pixel image","Corrupt PNG");

4770 ià(!
·l_img_n
) {

4771 
s
->
img_n
 = (
cŞÜ
 & 2 ? 3 : 1) + (color & 4 ? 1 : 0);

4772 ià((1 << 30è/ 
s
->
img_x
 / s->
img_n
 < s->
img_y
è 
	`¡bi__”r
("too†arge", "Imageoo†argeo decode");

4773 ià(
sÿn
 =ğ
STBI__SCAN_h—d”
)  1;

4777 
s
->
img_n
 = 1;

4778 ià((1 << 30è/ 
s
->
img_x
 / 4 < s->
img_y
è 
	`¡bi__”r
("too†arge","Corrupt PNG");

4784 
	`STBI__PNG_TYPE
('P','L','T','E'): {

4785 ià(
fœ¡
è 
	`¡bi__”r
("first‚ot IHDR", "Corrupt PNG");

4786 ià(
c
.
Ëngth
 > 256*3è 
	`¡bi__”r
("invalid PLTE","Corrupt PNG");

4787 
·l_Ën
 = 
c
.
Ëngth
 / 3;

4788 ià(
·l_Ën
 * 3 !ğ
c
.
Ëngth
è 
	`¡bi__”r
("invalid PLTE","Corrupt PNG");

4789 
i
=0; i < 
·l_Ën
; ++i) {

4790 
·Ë‰e
[
i
*4+0] = 
	`¡bi__g‘8
(
s
);

4791 
·Ë‰e
[
i
*4+1] = 
	`¡bi__g‘8
(
s
);

4792 
·Ë‰e
[
i
*4+2] = 
	`¡bi__g‘8
(
s
);

4793 
·Ë‰e
[
i
*4+3] = 255;

4798 
	`STBI__PNG_TYPE
('t','R','N','S'): {

4799 ià(
fœ¡
è 
	`¡bi__”r
("first‚ot IHDR", "Corrupt PNG");

4800 ià(
z
->
id©a
è 
	`¡bi__”r
("tRNS‡fter IDAT","Corrupt PNG");

4801 ià(
·l_img_n
) {

4802 ià(
sÿn
 =ğ
STBI__SCAN_h—d”
è{ 
s
->
img_n
 = 4;  1; }

4803 ià(
·l_Ën
 =ğ0è 
	`¡bi__”r
("tRNS before PLTE","Corrupt PNG");

4804 ià(
c
.
Ëngth
 > 
·l_Ën
è 
	`¡bi__”r
("badRNS†en","Corrupt PNG");

4805 
·l_img_n
 = 4;

4806 
i
=0; i < 
c
.
Ëngth
; ++i)

4807 
·Ë‰e
[
i
*4+3] = 
	`¡bi__g‘8
(
s
);

4809 ià(!(
s
->
img_n
 & 1)è 
	`¡bi__”r
("tRNS with‡lpha","Corrupt PNG");

4810 ià(
c
.
Ëngth
 !ğ(
¡bi__ušt32
è
s
->
img_n
*2è 
	`¡bi__”r
("badRNS†en","Corrupt PNG");

4811 
has_Œªs
 = 1;

4812 ià(
z
->
d•th
 == 16) {

4813 
k
 = 0; k < 
s
->
img_n
; ++kè
tc16
[k] = (
¡bi__ušt16
)
	`¡bi__g‘16be
(s);

4815 
k
 = 0; k < 
s
->
img_n
; ++kè
tc
[k] = (
¡bi_uc
)(
	`¡bi__g‘16be
(sè& 255è* 
¡bi__d•th_sÿË_bË
[
z
->
d•th
];

4821 
	`STBI__PNG_TYPE
('I','D','A','T'): {

4822 ià(
fœ¡
è 
	`¡bi__”r
("first‚ot IHDR", "Corrupt PNG");

4823 ià(
·l_img_n
 && !
·l_Ën
è 
	`¡bi__”r
("no PLTE","Corrupt PNG");

4824 ià(
sÿn
 =ğ
STBI__SCAN_h—d”
è{ 
s
->
img_n
 = 
·l_img_n
;  1; }

4825 ià(()(
ioff
 + 
c
.
Ëngth
) < ()ioff)  0;

4826 ià(
ioff
 + 
c
.
Ëngth
 > 
id©a_lim™
) {

4827 
¡bi__ušt32
 
id©a_lim™_Şd
 = 
id©a_lim™
;

4828 
¡bi_uc
 *
p
;

4829 ià(
id©a_lim™
 =ğ0èid©a_lim™ = 
c
.
Ëngth
 > 4096 ? c.length : 4096;

4830 
ioff
 + 
c
.
Ëngth
 > 
id©a_lim™
)

4831 
id©a_lim™
 *= 2;

4832 
	`STBI_NOTUSED
(
id©a_lim™_Şd
);

4833 
p
 = (
¡bi_uc
 *è
	`STBI_REALLOC_SIZED
(
z
->
id©a
, 
id©a_lim™_Şd
, 
id©a_lim™
); iàÕ =ğ
NULL
è 
	`¡bi__”r
("outofmem", "Out of memory");

4834 
z
->
id©a
 = 
p
;

4836 ià(!
	`¡bi__g‘n
(
s
, 
z
->
id©a
+
ioff
,
c
.
Ëngth
)è 
	`¡bi__”r
("outofdata","Corrupt PNG");

4837 
ioff
 +ğ
c
.
Ëngth
;

4841 
	`STBI__PNG_TYPE
('I','E','N','D'): {

4842 
¡bi__ušt32
 
¿w_Ën
, 
b¶
;

4843 ià(
fœ¡
è 
	`¡bi__”r
("first‚ot IHDR", "Corrupt PNG");

4844 ià(
sÿn
 !ğ
STBI__SCAN_lßd
)  1;

4845 ià(
z
->
id©a
 =ğ
NULL
è 
	`¡bi__”r
("no IDAT","Corrupt PNG");

4847 
b¶
 = (
s
->
img_x
 * 
z
->
d•th
 + 7) / 8;

4848 
¿w_Ën
 = 
b¶
 * 
s
->
img_y
 * s->
img_n
 + s->img_y ;

4849 
z
->
ex·nded
 = (
¡bi_uc
 *è
	`¡bi_zlib_decode_m®loc_guesssize_h—d”æag
((*èz->
id©a
, 
ioff
, 
¿w_Ën
, (*è&¿w_Ën, !
is_hÚe
);

4850 ià(
z
->
ex·nded
 =ğ
NULL
)  0;

4851 
	`STBI_FREE
(
z
->
id©a
); z->id©¨ğ
NULL
;

4852 ià((
»q_comp
 =ğ
s
->
img_n
+1 &&„eq_com°!ğ3 && !
·l_img_n
è|| 
has_Œªs
)

4853 
s
->
img_out_n
 = s->
img_n
+1;

4855 
s
->
img_out_n
 = s->
img_n
;

4856 ià(!
	`¡bi__ü—‹_²g_image
(
z
, z->
ex·nded
, 
¿w_Ën
, 
s
->
img_out_n
, z->
d•th
, 
cŞÜ
, 
š‹¾aû
))  0;

4857 ià(
has_Œªs
) {

4858 ià(
z
->
d•th
 == 16) {

4859 ià(!
	`¡bi__compu‹_Œª¥¬’cy16
(
z
, 
tc16
, 
s
->
img_out_n
))  0;

4861 ià(!
	`¡bi__compu‹_Œª¥¬’cy
(
z
, 
tc
, 
s
->
img_out_n
))  0;

4864 ià(
is_hÚe
 && 
¡bi__de_hÚe_æag
 && 
s
->
img_out_n
 > 2)

4865 
	`¡bi__de_hÚe
(
z
);

4866 ià(
·l_img_n
) {

4868 
s
->
img_n
 = 
·l_img_n
;

4869 
s
->
img_out_n
 = 
·l_img_n
;

4870 ià(
»q_comp
 >ğ3è
s
->
img_out_n
 =„eq_comp;

4871 ià(!
	`¡bi__ex·nd_²g_·Ë‰e
(
z
, 
·Ë‰e
, 
·l_Ën
, 
s
->
img_out_n
))

4873 } ià(
has_Œªs
) {

4875 ++
s
->
img_n
;

4877 
	`STBI_FREE
(
z
->
ex·nded
); z->ex·nded = 
NULL
;

4883 ià(
fœ¡
è 
	`¡bi__”r
("first‚ot IHDR", "Corrupt PNG");

4884 ià((
c
.
ty³
 & (1 << 29)) == 0) {

4885 #iâdeà
STBI_NO_FAILURE_STRINGS


4887 
šv®id_chunk
[] = "XXXX PNG chunk‚ot known";

4888 
šv®id_chunk
[0] = 
	`STBI__BYTECAST
(
c
.
ty³
 >> 24);

4889 
šv®id_chunk
[1] = 
	`STBI__BYTECAST
(
c
.
ty³
 >> 16);

4890 
šv®id_chunk
[2] = 
	`STBI__BYTECAST
(
c
.
ty³
 >> 8);

4891 
šv®id_chunk
[3] = 
	`STBI__BYTECAST
(
c
.
ty³
 >> 0);

4893  
	`¡bi__”r
(
šv®id_chunk
, "PNG‚ot supported: unknown PNG chunkype");

4895 
	`¡bi__sk
(
s
, 
c
.
Ëngth
);

4899 
	`¡bi__g‘32be
(
s
);

4901 
	}
}

4903 *
	$¡bi__do_²g
(
¡bi__²g
 *
p
, *
x
, *
y
, *
n
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

4905 *
»suÉ
=
NULL
;

4906 ià(
»q_comp
 < 0 ||„eq_com°> 4è 
	`¡bi__”½uc
("bad„eq_comp", "Internalƒrror");

4907 ià(
	`¡bi__·r£_²g_fe
(
p
, 
STBI__SCAN_lßd
, 
»q_comp
)) {

4908 ià(
p
->
d•th
 < 8)

4909 
ri
->
b™s_³r_chªÃl
 = 8;

4911 
ri
->
b™s_³r_chªÃl
 = 
p
->
d•th
;

4912 
»suÉ
 = 
p
->
out
;

4913 
p
->
out
 = 
NULL
;

4914 ià(
»q_comp
 &&„eq_com°!ğ
p
->
s
->
img_out_n
) {

4915 ià(
ri
->
b™s_³r_chªÃl
 == 8)

4916 
»suÉ
 = 
	`¡bi__cÚv”t_fÜm©
((*è»suÉ, 
p
->
s
->
img_out_n
, 
»q_comp
,…->s->
img_x
,…->s->
img_y
);

4918 
»suÉ
 = 
	`¡bi__cÚv”t_fÜm©16
((
¡bi__ušt16
 *è»suÉ, 
p
->
s
->
img_out_n
, 
»q_comp
,…->s->
img_x
,…->s->
img_y
);

4919 
p
->
s
->
img_out_n
 = 
»q_comp
;

4920 ià(
»suÉ
 =ğ
NULL
) „esult;

4922 *
x
 = 
p
->
s
->
img_x
;

4923 *
y
 = 
p
->
s
->
img_y
;

4924 ià(
n
è*Àğ
p
->
s
->
img_n
;

4926 
	`STBI_FREE
(
p
->
out
);…->ouˆğ
NULL
;

4927 
	`STBI_FREE
(
p
->
ex·nded
);…->ex·nded = 
NULL
;

4928 
	`STBI_FREE
(
p
->
id©a
);…->id©¨ğ
NULL
;

4930  
»suÉ
;

4931 
	}
}

4933 *
	$¡bi__²g_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

4935 
¡bi__²g
 
p
;

4936 
p
.
s
 = s;

4937  
	`¡bi__do_²g
(&
p
, 
x
,
y
,
comp
,
»q_comp
, 
ri
);

4938 
	}
}

4940 
	$¡bi__²g_‹¡
(
¡bi__cÚ‹xt
 *
s
)

4942 
r
;

4943 
r
 = 
	`¡bi__check_²g_h—d”
(
s
);

4944 
	`¡bi__»wšd
(
s
);

4945  
r
;

4946 
	}
}

4948 
	$¡bi__²g_šfo_¿w
(
¡bi__²g
 *
p
, *
x
, *
y
, *
comp
)

4950 ià(!
	`¡bi__·r£_²g_fe
(
p
, 
STBI__SCAN_h—d”
, 0)) {

4951 
	`¡bi__»wšd
Ğ
p
->
s
 );

4954 ià(
x
è*x = 
p
->
s
->
img_x
;

4955 ià(
y
è*y = 
p
->
s
->
img_y
;

4956 ià(
comp
è*com°ğ
p
->
s
->
img_n
;

4958 
	}
}

4960 
	$¡bi__²g_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

4962 
¡bi__²g
 
p
;

4963 
p
.
s
 = s;

4964  
	`¡bi__²g_šfo_¿w
(&
p
, 
x
, 
y
, 
comp
);

4965 
	}
}

4967 
	$¡bi__²g_is16
(
¡bi__cÚ‹xt
 *
s
)

4969 
¡bi__²g
 
p
;

4970 
p
.
s
 = s;

4971 ià(!
	`¡bi__²g_šfo_¿w
(&
p
, 
NULL
, NULL, NULL))

4973 ià(
p
.
d•th
 != 16) {

4974 
	`¡bi__»wšd
(
p
.
s
);

4978 
	}
}

4983 #iâdeà
STBI_NO_BMP


4984 
	$¡bi__bmp_‹¡_¿w
(
¡bi__cÚ‹xt
 *
s
)

4986 
r
;

4987 
sz
;

4988 ià(
	`¡bi__g‘8
(
s
) != 'B')  0;

4989 ià(
	`¡bi__g‘8
(
s
) != 'M')  0;

4990 
	`¡bi__g‘32Ë
(
s
);

4991 
	`¡bi__g‘16Ë
(
s
);

4992 
	`¡bi__g‘16Ë
(
s
);

4993 
	`¡bi__g‘32Ë
(
s
);

4994 
sz
 = 
	`¡bi__g‘32Ë
(
s
);

4995 
r
 = (
sz
 == 12 || sz == 40 || sz == 56 || sz == 108 || sz == 124);

4996  
r
;

4997 
	}
}

4999 
	$¡bi__bmp_‹¡
(
¡bi__cÚ‹xt
 *
s
)

5001 
r
 = 
	`¡bi__bmp_‹¡_¿w
(
s
);

5002 
	`¡bi__»wšd
(
s
);

5003  
r
;

5004 
	}
}

5008 
	$¡bi__high_b™
(
z
)

5010 
n
=0;

5011 ià(
z
 == 0)  -1;

5012 ià(
z
 >ğ0x10000è
n
 += 16, z >>= 16;

5013 ià(
z
 >ğ0x00100è
n
 += 8, z >>= 8;

5014 ià(
z
 >ğ0x00010è
n
 += 4, z >>= 4;

5015 ià(
z
 >ğ0x00004è
n
 += 2, z >>= 2;

5016 ià(
z
 >ğ0x00002è
n
 += 1, z >>= 1;

5017  
n
;

5018 
	}
}

5020 
	$¡bi__b™couÁ
(
a
)

5022 
a
 = (a & 0x55555555) + ((a >> 1) & 0x55555555);

5023 
a
 = (a & 0x33333333) + ((a >> 2) & 0x33333333);

5024 
a
 = (a + (a >> 4)) & 0x0f0f0f0f;

5025 
a
 = (a + (a >> 8));

5026 
a
 = (a + (a >> 16));

5027  
a
 & 0xff;

5028 
	}
}

5033 
	$¡bi__shiásigÃd
(
v
, 
shiá
, 
b™s
)

5035 
mul_bË
[9] = {

5040 
shiá_bË
[9] = {

5043 ià(
shiá
 < 0)

5044 
v
 <<ğ-
shiá
;

5046 
v
 >>ğ
shiá
;

5047 
	`STBI_ASSERT
(
v
 >= 0 && v < 256);

5048 
v
 >>ğ(8-
b™s
);

5049 
	`STBI_ASSERT
(
b™s
 >= 0 && bits <= 8);

5050  (è((è
v
 * 
mul_bË
[
b™s
]è>> 
shiá_bË
[bits];

5051 
	}
}

5055 
	mbµ
, 
	moff£t
, 
	mhsz
;

5056 
	mmr
,
	mmg
,
	mmb
,
	mma
, 
	m®l_a
;

5057 } 
	t¡bi__bmp_d©a
;

5059 *
	$¡bi__bmp_·r£_h—d”
(
¡bi__cÚ‹xt
 *
s
, 
¡bi__bmp_d©a
 *
šfo
)

5061 
hsz
;

5062 ià(
	`¡bi__g‘8
(
s
è!ğ'B' || stbi__g‘8(sè!ğ'M'è 
	`¡bi__”½uc
("not BMP", "Corrupt BMP");

5063 
	`¡bi__g‘32Ë
(
s
);

5064 
	`¡bi__g‘16Ë
(
s
);

5065 
	`¡bi__g‘16Ë
(
s
);

5066 
šfo
->
off£t
 = 
	`¡bi__g‘32Ë
(
s
);

5067 
šfo
->
hsz
 = hsz = 
	`¡bi__g‘32Ë
(
s
);

5068 
šfo
->
mr
 = info->
mg
 = info->
mb
 = info->
ma
 = 0;

5070 ià(
hsz
 !ğ12 && hsz !ğ40 && hsz !ğ56 && hsz !ğ108 && hsz !ğ124è 
	`¡bi__”½uc
("unknown BMP", "BMPype‚ot supported: unknown");

5071 ià(
hsz
 == 12) {

5072 
s
->
img_x
 = 
	`¡bi__g‘16Ë
(s);

5073 
s
->
img_y
 = 
	`¡bi__g‘16Ë
(s);

5075 
s
->
img_x
 = 
	`¡bi__g‘32Ë
(s);

5076 
s
->
img_y
 = 
	`¡bi__g‘32Ë
(s);

5078 ià(
	`¡bi__g‘16Ë
(
s
è!ğ1è 
	`¡bi__”½uc
("bad BMP", "bad BMP");

5079 
šfo
->
bµ
 = 
	`¡bi__g‘16Ë
(
s
);

5080 ià(
hsz
 != 12) {

5081 
com´ess
 = 
	`¡bi__g‘32Ë
(
s
);

5082 ià(
com´ess
 =ğ1 || com´es =ğ2è 
	`¡bi__”½uc
("BMP RLE", "BMPype‚ot supported: RLE");

5083 
	`¡bi__g‘32Ë
(
s
);

5084 
	`¡bi__g‘32Ë
(
s
);

5085 
	`¡bi__g‘32Ë
(
s
);

5086 
	`¡bi__g‘32Ë
(
s
);

5087 
	`¡bi__g‘32Ë
(
s
);

5088 ià(
hsz
 == 40 || hsz == 56) {

5089 ià(
hsz
 == 56) {

5090 
	`¡bi__g‘32Ë
(
s
);

5091 
	`¡bi__g‘32Ë
(
s
);

5092 
	`¡bi__g‘32Ë
(
s
);

5093 
	`¡bi__g‘32Ë
(
s
);

5095 ià(
šfo
->
bµ
 == 16 || info->bpp == 32) {

5096 ià(
com´ess
 == 0) {

5097 ià(
šfo
->
bµ
 == 32) {

5098 
šfo
->
mr
 = 0xffu << 16;

5099 
šfo
->
mg
 = 0xffu << 8;

5100 
šfo
->
mb
 = 0xffu << 0;

5101 
šfo
->
ma
 = 0xffu << 24;

5102 
šfo
->
®l_a
 = 0;

5104 
šfo
->
mr
 = 31u << 10;

5105 
šfo
->
mg
 = 31u << 5;

5106 
šfo
->
mb
 = 31u << 0;

5108 } ià(
com´ess
 == 3) {

5109 
šfo
->
mr
 = 
	`¡bi__g‘32Ë
(
s
);

5110 
šfo
->
mg
 = 
	`¡bi__g‘32Ë
(
s
);

5111 
šfo
->
mb
 = 
	`¡bi__g‘32Ë
(
s
);

5113 ià(
šfo
->
mr
 =ğšfo->
mg
 && info->mg =ğšfo->
mb
) {

5115  
	`¡bi__”½uc
("bad BMP", "bad BMP");

5118  
	`¡bi__”½uc
("bad BMP", "bad BMP");

5121 
i
;

5122 ià(
hsz
 != 108 && hsz != 124)

5123  
	`¡bi__”½uc
("bad BMP", "bad BMP");

5124 
šfo
->
mr
 = 
	`¡bi__g‘32Ë
(
s
);

5125 
šfo
->
mg
 = 
	`¡bi__g‘32Ë
(
s
);

5126 
šfo
->
mb
 = 
	`¡bi__g‘32Ë
(
s
);

5127 
šfo
->
ma
 = 
	`¡bi__g‘32Ë
(
s
);

5128 
	`¡bi__g‘32Ë
(
s
);

5129 
i
=0; i < 12; ++i)

5130 
	`¡bi__g‘32Ë
(
s
);

5131 ià(
hsz
 == 124) {

5132 
	`¡bi__g‘32Ë
(
s
);

5133 
	`¡bi__g‘32Ë
(
s
);

5134 
	`¡bi__g‘32Ë
(
s
);

5135 
	`¡bi__g‘32Ë
(
s
);

5140 
	}
}

5143 *
	$¡bi__bmp_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

5145 
¡bi_uc
 *
out
;

5146 
mr
=0,
mg
=0,
mb
=0,
ma
=0, 
®l_a
;

5147 
¡bi_uc
 
·l
[256][4];

5148 
psize
=0,
i
,
j
,
width
;

5149 
æ_v”tiÿÎy
, 
·d
, 
rg‘
;

5150 
¡bi__bmp_d©a
 
šfo
;

5151 
	`STBI_NOTUSED
(
ri
);

5153 
šfo
.
®l_a
 = 255;

5154 ià(
	`¡bi__bmp_·r£_h—d”
(
s
, &
šfo
è=ğ
NULL
)

5155  
NULL
;

5157 
æ_v”tiÿÎy
 = ((è
s
->
img_y
) > 0;

5158 
s
->
img_y
 = 
	`abs
(() s->img_y);

5160 
mr
 = 
šfo
.mr;

5161 
mg
 = 
šfo
.mg;

5162 
mb
 = 
šfo
.mb;

5163 
ma
 = 
šfo
.ma;

5164 
®l_a
 = 
šfo
.all_a;

5166 ià(
šfo
.
hsz
 == 12) {

5167 ià(
šfo
.
bµ
 < 24)

5168 
psize
 = (
šfo
.
off£t
 - 14 - 24) / 3;

5170 ià(
šfo
.
bµ
 < 16)

5171 
psize
 = (
šfo
.
off£t
 - 14 - info.
hsz
) >> 2;

5174 
s
->
img_n
 = 
ma
 ? 4 : 3;

5175 ià(
»q_comp
 &&„eq_comp >= 3)

5176 
rg‘
 = 
»q_comp
;

5178 
rg‘
 = 
s
->
img_n
;

5181 ià(!
	`¡bi__mad3sizes_v®id
(
rg‘
, 
s
->
img_x
, s->
img_y
, 0))

5182  
	`¡bi__”½uc
("too†arge", "Corrupt BMP");

5184 
out
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
rg‘
, 
s
->
img_x
, s->
img_y
, 0);

5185 ià(!
out
è 
	`¡bi__”½uc
("outofmem", "Out of memory");

5186 ià(
šfo
.
bµ
 < 16) {

5187 
z
=0;

5188 ià(
psize
 =ğ0 ||…siz> 256è{ 
	`STBI_FREE
(
out
);  
	`¡bi__”½uc
("invalid", "Corrupt BMP"); }

5189 
i
=0; i < 
psize
; ++i) {

5190 
·l
[
i
][2] = 
	`¡bi__g‘8
(
s
);

5191 
·l
[
i
][1] = 
	`¡bi__g‘8
(
s
);

5192 
·l
[
i
][0] = 
	`¡bi__g‘8
(
s
);

5193 ià(
šfo
.
hsz
 !ğ12è
	`¡bi__g‘8
(
s
);

5194 
·l
[
i
][3] = 255;

5196 
	`¡bi__sk
(
s
, 
šfo
.
off£t
 - 14 - info.
hsz
 - 
psize
 * (info.hsz == 12 ? 3 : 4));

5197 ià(
šfo
.
bµ
 =ğ1è
width
 = (
s
->
img_x
 + 7) >> 3;

5198 ià(
šfo
.
bµ
 =ğ4è
width
 = (
s
->
img_x
 + 1) >> 1;

5199 ià(
šfo
.
bµ
 =ğ8è
width
 = 
s
->
img_x
;

5200 { 
	`STBI_FREE
(
out
);  
	`¡bi__”½uc
("bad bpp", "Corrupt BMP"); }

5201 
·d
 = (-
width
)&3;

5202 ià(
šfo
.
bµ
 == 1) {

5203 
j
=0; j < (è
s
->
img_y
; ++j) {

5204 
b™_off£t
 = 7, 
v
 = 
	`¡bi__g‘8
(
s
);

5205 
i
=0; i < (è
s
->
img_x
; ++i) {

5206 
cŞÜ
 = (
v
>>
b™_off£t
)&0x1;

5207 
out
[
z
++] = 
·l
[
cŞÜ
][0];

5208 
out
[
z
++] = 
·l
[
cŞÜ
][1];

5209 
out
[
z
++] = 
·l
[
cŞÜ
][2];

5210 if((--
b™_off£t
) < 0) {

5211 
b™_off£t
 = 7;

5212 
v
 = 
	`¡bi__g‘8
(
s
);

5215 
	`¡bi__sk
(
s
, 
·d
);

5218 
j
=0; j < (è
s
->
img_y
; ++j) {

5219 
i
=0; i < (è
s
->
img_x
; i += 2) {

5220 
v
=
	`¡bi__g‘8
(
s
),
v2
=0;

5221 ià(
šfo
.
bµ
 == 4) {

5222 
v2
 = 
v
 & 15;

5223 
v
 >>= 4;

5225 
out
[
z
++] = 
·l
[
v
][0];

5226 
out
[
z
++] = 
·l
[
v
][1];

5227 
out
[
z
++] = 
·l
[
v
][2];

5228 ià(
rg‘
 =ğ4è
out
[
z
++] = 255;

5229 ià(
i
+1 =ğ(è
s
->
img_x
) ;

5230 
v
 = (
šfo
.
bµ
 =ğ8è? 
	`¡bi__g‘8
(
s
è: 
v2
;

5231 
out
[
z
++] = 
·l
[
v
][0];

5232 
out
[
z
++] = 
·l
[
v
][1];

5233 
out
[
z
++] = 
·l
[
v
][2];

5234 ià(
rg‘
 =ğ4è
out
[
z
++] = 255;

5236 
	`¡bi__sk
(
s
, 
·d
);

5240 
rshiá
=0,
gshiá
=0,
bshiá
=0,
ashiá
=0,
rcouÁ
=0,
gcouÁ
=0,
bcouÁ
=0,
acouÁ
=0;

5241 
z
 = 0;

5242 
—sy
=0;

5243 
	`¡bi__sk
(
s
, 
šfo
.
off£t
 - 14 - info.
hsz
);

5244 ià(
šfo
.
bµ
 =ğ24è
width
 = 3 * 
s
->
img_x
;

5245 ià(
šfo
.
bµ
 =ğ16è
width
 = 2*
s
->
img_x
;

5246 
width
=0;

5247 
·d
 = (-
width
) & 3;

5248 ià(
šfo
.
bµ
 == 24) {

5249 
—sy
 = 1;

5250 } ià(
šfo
.
bµ
 == 32) {

5251 ià(
mb
 =ğ0xfà&& 
mg
 =ğ0xff00 && 
mr
 =ğ0x00ff0000 && 
ma
 == 0xff000000)

5252 
—sy
 = 2;

5254 ià(!
—sy
) {

5255 ià(!
mr
 || !
mg
 || !
mb
è{ 
	`STBI_FREE
(
out
);  
	`¡bi__”½uc
("bad masks", "Corrupt BMP"); }

5257 
rshiá
 = 
	`¡bi__high_b™
(
mr
)-7; 
rcouÁ
 = 
	`¡bi__b™couÁ
(mr);

5258 
gshiá
 = 
	`¡bi__high_b™
(
mg
)-7; 
gcouÁ
 = 
	`¡bi__b™couÁ
(mg);

5259 
bshiá
 = 
	`¡bi__high_b™
(
mb
)-7; 
bcouÁ
 = 
	`¡bi__b™couÁ
(mb);

5260 
ashiá
 = 
	`¡bi__high_b™
(
ma
)-7; 
acouÁ
 = 
	`¡bi__b™couÁ
(ma);

5262 
j
=0; j < (è
s
->
img_y
; ++j) {

5263 ià(
—sy
) {

5264 
i
=0; i < (è
s
->
img_x
; ++i) {

5265 
a
;

5266 
out
[
z
+2] = 
	`¡bi__g‘8
(
s
);

5267 
out
[
z
+1] = 
	`¡bi__g‘8
(
s
);

5268 
out
[
z
+0] = 
	`¡bi__g‘8
(
s
);

5269 
z
 += 3;

5270 
a
 = (
—sy
 =ğ2 ? 
	`¡bi__g‘8
(
s
) : 255);

5271 
®l_a
 |ğ
a
;

5272 ià(
rg‘
 =ğ4è
out
[
z
++] = 
a
;

5275 
bµ
 = 
šfo
.bpp;

5276 
i
=0; i < (è
s
->
img_x
; ++i) {

5277 
¡bi__ušt32
 
v
 = (
bµ
 =ğ16 ? (¡bi__ušt32è
	`¡bi__g‘16Ë
(
s
è: 
	`¡bi__g‘32Ë
(s));

5278 
a
;

5279 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`¡bi__shiásigÃd
(
v
 & 
mr
, 
rshiá
, 
rcouÁ
));

5280 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`¡bi__shiásigÃd
(
v
 & 
mg
, 
gshiá
, 
gcouÁ
));

5281 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`¡bi__shiásigÃd
(
v
 & 
mb
, 
bshiá
, 
bcouÁ
));

5282 
a
 = (
ma
 ? 
	`¡bi__shiásigÃd
(
v
 & ma, 
ashiá
, 
acouÁ
) : 255);

5283 
®l_a
 |ğ
a
;

5284 ià(
rg‘
 =ğ4è
out
[
z
++] = 
	`STBI__BYTECAST
(
a
);

5287 
	`¡bi__sk
(
s
, 
·d
);

5292 ià(
rg‘
 =ğ4 && 
®l_a
 == 0)

5293 
i
=4*
s
->
img_x
*s->
img_y
-1; i >= 0; i -= 4)

5294 
out
[
i
] = 255;

5296 ià(
æ_v”tiÿÎy
) {

5297 
¡bi_uc
 
t
;

5298 
j
=0; j < (è
s
->
img_y
>>1; ++j) {

5299 
¡bi_uc
 *
p1
 = 
out
 + 
j
 *
s
->
img_x
*
rg‘
;

5300 
¡bi_uc
 *
p2
 = 
out
 + (
s
->
img_y
-1-
j
)*s->
img_x
*
rg‘
;

5301 
i
=0; i < (è
s
->
img_x
*
rg‘
; ++i) {

5302 
t
 = 
p1
[
i
],…1[i] = 
p2
[i],…2[i] =;

5307 ià(
»q_comp
 &&„eq_com°!ğ
rg‘
) {

5308 
out
 = 
	`¡bi__cÚv”t_fÜm©
(out, 
rg‘
, 
»q_comp
, 
s
->
img_x
, s->
img_y
);

5309 ià(
out
 =ğ
NULL
)  out;

5312 *
x
 = 
s
->
img_x
;

5313 *
y
 = 
s
->
img_y
;

5314 ià(
comp
è*com°ğ
s
->
img_n
;

5315  
out
;

5316 
	}
}

5321 #iâdeà
STBI_NO_TGA


5323 
	$¡bi__tga_g‘_comp
(
b™s_³r_pix–
, 
is_g»y
, * 
is_rgb16
)

5326 ià(
is_rgb16
) *is_rgb16 = 0;

5327 
b™s_³r_pix–
) {

5328 8:  
STBI_g»y
;

5329 16: if(
is_g»y
è 
STBI_g»y_®pha
;

5331 15: if(
is_rgb16
) *is_rgb16 = 1;

5332  
STBI_rgb
;

5334 32:  
b™s_³r_pix–
/8;

5337 
	}
}

5339 
	$¡bi__tga_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

5341 
tga_w
, 
tga_h
, 
tga_comp
, 
tga_image_ty³
, 
tga_b™s_³r_pix–
, 
tga_cŞÜm­_bµ
;

5342 
sz
, 
tga_cŞÜm­_ty³
;

5343 
	`¡bi__g‘8
(
s
);

5344 
tga_cŞÜm­_ty³
 = 
	`¡bi__g‘8
(
s
);

5345 ifĞ
tga_cŞÜm­_ty³
 > 1 ) {

5346 
	`¡bi__»wšd
(
s
);

5349 
tga_image_ty³
 = 
	`¡bi__g‘8
(
s
);

5350 iàĞ
tga_cŞÜm­_ty³
 == 1 ) {

5351 ià(
tga_image_ty³
 != 1 &&ga_image_type != 9) {

5352 
	`¡bi__»wšd
(
s
);

5355 
	`¡bi__sk
(
s
,4);

5356 
sz
 = 
	`¡bi__g‘8
(
s
);

5357 iàĞ(
sz
 != 8) && (sz != 15) && (sz != 16) && (sz != 24) && (sz != 32) ) {

5358 
	`¡bi__»wšd
(
s
);

5361 
	`¡bi__sk
(
s
,4);

5362 
tga_cŞÜm­_bµ
 = 
sz
;

5364 iàĞ(
tga_image_ty³
 != 2) && (tga_image_type != 3) && (tga_image_type != 10) && (tga_image_type != 11) ) {

5365 
	`¡bi__»wšd
(
s
);

5368 
	`¡bi__sk
(
s
,9);

5369 
tga_cŞÜm­_bµ
 = 0;

5371 
tga_w
 = 
	`¡bi__g‘16Ë
(
s
);

5372 ifĞ
tga_w
 < 1 ) {

5373 
	`¡bi__»wšd
(
s
);

5376 
tga_h
 = 
	`¡bi__g‘16Ë
(
s
);

5377 ifĞ
tga_h
 < 1 ) {

5378 
	`¡bi__»wšd
(
s
);

5381 
tga_b™s_³r_pix–
 = 
	`¡bi__g‘8
(
s
);

5382 
	`¡bi__g‘8
(
s
);

5383 ià(
tga_cŞÜm­_bµ
 != 0) {

5384 if((
tga_b™s_³r_pix–
 != 8) && (tga_bits_per_pixel != 16)) {

5387 
	`¡bi__»wšd
(
s
);

5390 
tga_comp
 = 
	`¡bi__tga_g‘_comp
(
tga_cŞÜm­_bµ
, 0, 
NULL
);

5392 
tga_comp
 = 
	`¡bi__tga_g‘_comp
(
tga_b™s_³r_pix–
, (
tga_image_ty³
 =ğ3è|| (tga_image_ty³ =ğ11), 
NULL
);

5394 if(!
tga_comp
) {

5395 
	`¡bi__»wšd
(
s
);

5398 ià(
x
è*x = 
tga_w
;

5399 ià(
y
è*y = 
tga_h
;

5400 ià(
comp
è*com°ğ
tga_comp
;

5402 
	}
}

5404 
	$¡bi__tga_‹¡
(
¡bi__cÚ‹xt
 *
s
)

5406 
»s
 = 0;

5407 
sz
, 
tga_cŞÜ_ty³
;

5408 
	`¡bi__g‘8
(
s
);

5409 
tga_cŞÜ_ty³
 = 
	`¡bi__g‘8
(
s
);

5410 iàĞ
tga_cŞÜ_ty³
 > 1 ) 
”rÜEnd
;

5411 
sz
 = 
	`¡bi__g‘8
(
s
);

5412 iàĞ
tga_cŞÜ_ty³
 == 1 ) {

5413 ià(
sz
 !ğ1 && sz !ğ9è
”rÜEnd
;

5414 
	`¡bi__sk
(
s
,4);

5415 
sz
 = 
	`¡bi__g‘8
(
s
);

5416 iàĞ(
sz
 !ğ8è&& (sz !ğ15è&& (sz !ğ16è&& (sz !ğ24è&& (sz !ğ32èè
”rÜEnd
;

5417 
	`¡bi__sk
(
s
,4);

5419 iàĞ(
sz
 !ğ2è&& (sz !ğ3è&& (sz !ğ10è&& (sz !ğ11èè
”rÜEnd
;

5420 
	`¡bi__sk
(
s
,9);

5422 iàĞ
	`¡bi__g‘16Ë
(
s
è< 1 ) 
”rÜEnd
;

5423 iàĞ
	`¡bi__g‘16Ë
(
s
è< 1 ) 
”rÜEnd
;

5424 
sz
 = 
	`¡bi__g‘8
(
s
);

5425 iàĞ(
tga_cŞÜ_ty³
 =ğ1è&& (
sz
 !ğ8è&& (sz !ğ16èè
”rÜEnd
;

5426 iàĞ(
sz
 !ğ8è&& (sz !ğ15è&& (sz !ğ16è&& (sz !ğ24è&& (sz !ğ32èè
”rÜEnd
;

5428 
»s
 = 1;

5430 
”rÜEnd
:

5431 
	`¡bi__»wšd
(
s
);

5432  
»s
;

5433 
	}
}

5436 
	$¡bi__tga_»ad_rgb16
(
¡bi__cÚ‹xt
 *
s
, 
¡bi_uc
* 
out
)

5438 
¡bi__ušt16
 
px
 = (¡bi__ušt16)
	`¡bi__g‘16Ë
(
s
);

5439 
¡bi__ušt16
 
fiveB™Mask
 = 31;

5441 
r
 = (
px
 >> 10è& 
fiveB™Mask
;

5442 
g
 = (
px
 >> 5è& 
fiveB™Mask
;

5443 
b
 = 
px
 & 
fiveB™Mask
;

5445 
out
[0] = (
¡bi_uc
)((
r
 * 255)/31);

5446 
out
[1] = (
¡bi_uc
)((
g
 * 255)/31);

5447 
out
[2] = (
¡bi_uc
)((
b
 * 255)/31);

5453 
	}
}

5455 *
	$¡bi__tga_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

5458 
tga_off£t
 = 
	`¡bi__g‘8
(
s
);

5459 
tga_šdexed
 = 
	`¡bi__g‘8
(
s
);

5460 
tga_image_ty³
 = 
	`¡bi__g‘8
(
s
);

5461 
tga_is_RLE
 = 0;

5462 
tga_·Ë‰e_¡¬t
 = 
	`¡bi__g‘16Ë
(
s
);

5463 
tga_·Ë‰e_Ën
 = 
	`¡bi__g‘16Ë
(
s
);

5464 
tga_·Ë‰e_b™s
 = 
	`¡bi__g‘8
(
s
);

5465 
tga_x_Üigš
 = 
	`¡bi__g‘16Ë
(
s
);

5466 
tga_y_Üigš
 = 
	`¡bi__g‘16Ë
(
s
);

5467 
tga_width
 = 
	`¡bi__g‘16Ë
(
s
);

5468 
tga_height
 = 
	`¡bi__g‘16Ë
(
s
);

5469 
tga_b™s_³r_pix–
 = 
	`¡bi__g‘8
(
s
);

5470 
tga_comp
, 
tga_rgb16
=0;

5471 
tga_šv”‹d
 = 
	`¡bi__g‘8
(
s
);

5474 *
tga_d©a
;

5475 *
tga_·Ë‰e
 = 
NULL
;

5476 
i
, 
j
;

5477 
¿w_d©a
[4] = {0};

5478 
RLE_couÁ
 = 0;

5479 
RLE_»³©šg
 = 0;

5480 
»ad_Ãxt_pix–
 = 1;

5481 
	`STBI_NOTUSED
(
ri
);

5484 iàĞ
tga_image_ty³
 >= 8 )

5486 
tga_image_ty³
 -= 8;

5487 
tga_is_RLE
 = 1;

5489 
tga_šv”‹d
 = 1 - ((tga_inverted >> 5) & 1);

5492 iàĞ
tga_šdexed
 ) 
tga_comp
 = 
	`¡bi__tga_g‘_comp
(
tga_·Ë‰e_b™s
, 0, &
tga_rgb16
);

5493 
tga_comp
 = 
	`¡bi__tga_g‘_comp
(
tga_b™s_³r_pix–
, (
tga_image_ty³
 =ğ3), &
tga_rgb16
);

5495 if(!
tga_comp
)

5496  
	`¡bi__”½uc
("bad format", "Can't find out TGA…ixelformat");

5499 *
x
 = 
tga_width
;

5500 *
y
 = 
tga_height
;

5501 ià(
comp
è*com°ğ
tga_comp
;

5503 ià(!
	`¡bi__mad3sizes_v®id
(
tga_width
, 
tga_height
, 
tga_comp
, 0))

5504  
	`¡bi__”½uc
("too†arge", "Corrupt TGA");

5506 
tga_d©a
 = (*)
	`¡bi__m®loc_mad3
(
tga_width
, 
tga_height
, 
tga_comp
, 0);

5507 ià(!
tga_d©a
è 
	`¡bi__”½uc
("outofmem", "Out of memory");

5510 
	`¡bi__sk
(
s
, 
tga_off£t
 );

5512 iàĞ!
tga_šdexed
 && !
tga_is_RLE
 && !
tga_rgb16
 ) {

5513 
i
=0; i < 
tga_height
; ++i) {

5514 
row
 = 
tga_šv”‹d
 ? 
tga_height
 -
i
 - 1 : i;

5515 
¡bi_uc
 *
tga_row
 = 
tga_d©a
 + 
row
*
tga_width
*
tga_comp
;

5516 
	`¡bi__g‘n
(
s
, 
tga_row
, 
tga_width
 * 
tga_comp
);

5520 iàĞ
tga_šdexed
)

5523 
	`¡bi__sk
(
s
, 
tga_·Ë‰e_¡¬t
 );

5525 
tga_·Ë‰e
 = (*)
	`¡bi__m®loc_mad2
(
tga_·Ë‰e_Ën
, 
tga_comp
, 0);

5526 ià(!
tga_·Ë‰e
) {

5527 
	`STBI_FREE
(
tga_d©a
);

5528  
	`¡bi__”½uc
("outofmem", "Out of memory");

5530 ià(
tga_rgb16
) {

5531 
¡bi_uc
 *
·l_’Œy
 = 
tga_·Ë‰e
;

5532 
	`STBI_ASSERT
(
tga_comp
 =ğ
STBI_rgb
);

5533 
i
=0; i < 
tga_·Ë‰e_Ën
; ++i) {

5534 
	`¡bi__tga_»ad_rgb16
(
s
, 
·l_’Œy
);

5535 
·l_’Œy
 +ğ
tga_comp
;

5537 } ià(!
	`¡bi__g‘n
(
s
, 
tga_·Ë‰e
, 
tga_·Ë‰e_Ën
 * 
tga_comp
)) {

5538 
	`STBI_FREE
(
tga_d©a
);

5539 
	`STBI_FREE
(
tga_·Ë‰e
);

5540  
	`¡bi__”½uc
("bad…alette", "Corrupt TGA");

5544 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5547 iàĞ
tga_is_RLE
 )

5549 iàĞ
RLE_couÁ
 == 0 )

5552 
RLE_cmd
 = 
	`¡bi__g‘8
(
s
);

5553 
RLE_couÁ
 = 1 + (
RLE_cmd
 & 127);

5554 
RLE_»³©šg
 = 
RLE_cmd
 >> 7;

5555 
»ad_Ãxt_pix–
 = 1;

5556 } iàĞ!
RLE_»³©šg
 )

5558 
»ad_Ãxt_pix–
 = 1;

5562 
»ad_Ãxt_pix–
 = 1;

5565 iàĞ
»ad_Ãxt_pix–
 )

5568 iàĞ
tga_šdexed
 )

5571 
·l_idx
 = (
tga_b™s_³r_pix–
 =ğ8è? 
	`¡bi__g‘8
(
s
è: 
	`¡bi__g‘16Ë
(s);

5572 iàĞ
·l_idx
 >ğ
tga_·Ë‰e_Ën
 ) {

5574 
·l_idx
 = 0;

5576 
·l_idx
 *ğ
tga_comp
;

5577 
j
 = 0; j < 
tga_comp
; ++j) {

5578 
¿w_d©a
[
j
] = 
tga_·Ë‰e
[
·l_idx
+j];

5580 } if(
tga_rgb16
) {

5581 
	`STBI_ASSERT
(
tga_comp
 =ğ
STBI_rgb
);

5582 
	`¡bi__tga_»ad_rgb16
(
s
, 
¿w_d©a
);

5585 
j
 = 0; j < 
tga_comp
; ++j) {

5586 
¿w_d©a
[
j
] = 
	`¡bi__g‘8
(
s
);

5590 
»ad_Ãxt_pix–
 = 0;

5594 
j
 = 0; j < 
tga_comp
; ++j)

5595 
tga_d©a
[
i
*
tga_comp
+
j
] = 
¿w_d©a
[j];

5598 --
RLE_couÁ
;

5601 iàĞ
tga_šv”‹d
 )

5603 
j
 = 0; j*2 < 
tga_height
; ++j)

5605 
šdex1
 = 
j
 * 
tga_width
 * 
tga_comp
;

5606 
šdex2
 = (
tga_height
 - 1 - 
j
è* 
tga_width
 * 
tga_comp
;

5607 
i
 = 
tga_width
 * 
tga_comp
; i > 0; --i)

5609 
‹mp
 = 
tga_d©a
[
šdex1
];

5610 
tga_d©a
[
šdex1
] =ga_d©a[
šdex2
];

5611 
tga_d©a
[
šdex2
] = 
‹mp
;

5612 ++
šdex1
;

5613 ++
šdex2
;

5618 iàĞ
tga_·Ë‰e
 !ğ
NULL
 )

5620 
	`STBI_FREE
Ğ
tga_·Ë‰e
 );

5625 ià(
tga_comp
 >ğ3 && !
tga_rgb16
)

5627 * 
tga_pix–
 = 
tga_d©a
;

5628 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5630 
‹mp
 = 
tga_pix–
[0];

5631 
tga_pix–
[0] =ga_pixel[2];

5632 
tga_pix–
[2] = 
‹mp
;

5633 
tga_pix–
 +ğ
tga_comp
;

5638 ià(
»q_comp
 &&„eq_com°!ğ
tga_comp
)

5639 
tga_d©a
 = 
	`¡bi__cÚv”t_fÜm©
Ñga_d©a, 
tga_comp
, 
»q_comp
, 
tga_width
, 
tga_height
);

5643 
tga_·Ë‰e_¡¬t
 = 
tga_·Ë‰e_Ën
 = 
tga_·Ë‰e_b™s
 =

5644 
tga_x_Üigš
 = 
tga_y_Üigš
 = 0;

5646  
tga_d©a
;

5647 
	}
}

5653 #iâdeà
STBI_NO_PSD


5654 
	$¡bi__psd_‹¡
(
¡bi__cÚ‹xt
 *
s
)

5656 
r
 = (
	`¡bi__g‘32be
(
s
) == 0x38425053);

5657 
	`¡bi__»wšd
(
s
);

5658  
r
;

5659 
	}
}

5661 
	$¡bi__psd_decode_¾e
(
¡bi__cÚ‹xt
 *
s
, 
¡bi_uc
 *
p
, 
pix–CouÁ
)

5663 
couÁ
, 
Æeá
, 
Ën
;

5665 
couÁ
 = 0;

5666 (
Æeá
 = 
pix–CouÁ
 - 
couÁ
) > 0) {

5667 
Ën
 = 
	`¡bi__g‘8
(
s
);

5668 ià(
Ën
 == 128) {

5670 } ià(
Ën
 < 128) {

5672 
Ën
++;

5673 ià(
Ën
 > 
Æeá
)  0;

5674 
couÁ
 +ğ
Ën
;

5675 
Ën
) {

5676 *
p
 = 
	`¡bi__g‘8
(
s
);

5677 
p
 += 4;

5678 
Ën
--;

5680 } ià(
Ën
 > 128) {

5681 
¡bi_uc
 
v®
;

5684 
Ën
 = 257 -†en;

5685 ià(
Ën
 > 
Æeá
)  0;

5686 
v®
 = 
	`¡bi__g‘8
(
s
);

5687 
couÁ
 +ğ
Ën
;

5688 
Ën
) {

5689 *
p
 = 
v®
;

5690 
p
 += 4;

5691 
Ën
--;

5697 
	}
}

5699 *
	$¡bi__psd_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
, 
bpc
)

5701 
pix–CouÁ
;

5702 
chªÃlCouÁ
, 
com´essiÚ
;

5703 
chªÃl
, 
i
;

5704 
b™d•th
;

5705 
w
,
h
;

5706 
¡bi_uc
 *
out
;

5707 
	`STBI_NOTUSED
(
ri
);

5710 ià(
	`¡bi__g‘32be
(
s
) != 0x38425053)

5711  
	`¡bi__”½uc
("not PSD", "Corrupt PSD image");

5714 ià(
	`¡bi__g‘16be
(
s
) != 1)

5715  
	`¡bi__”½uc
("wrong version", "Unsupported version of PSD image");

5718 
	`¡bi__sk
(
s
, 6 );

5721 
chªÃlCouÁ
 = 
	`¡bi__g‘16be
(
s
);

5722 ià(
chªÃlCouÁ
 < 0 || channelCount > 16)

5723  
	`¡bi__”½uc
("wrong channel count", "Unsupported‚umber of channels in PSD image");

5726 
h
 = 
	`¡bi__g‘32be
(
s
);

5727 
w
 = 
	`¡bi__g‘32be
(
s
);

5730 
b™d•th
 = 
	`¡bi__g‘16be
(
s
);

5731 ià(
b™d•th
 != 8 && bitdepth != 16)

5732  
	`¡bi__”½uc
("unsupported bit depth", "PSD bit depth is‚ot 8 or 16 bit");

5744 ià(
	`¡bi__g‘16be
(
s
) != 3)

5745  
	`¡bi__”½uc
("wrong color format", "PSD is‚ot in RGB color format");

5748 
	`¡bi__sk
(
s
,
	`¡bi__g‘32be
(s) );

5751 
	`¡bi__sk
(
s
, 
	`¡bi__g‘32be
(s) );

5754 
	`¡bi__sk
(
s
, 
	`¡bi__g‘32be
(s) );

5760 
com´essiÚ
 = 
	`¡bi__g‘16be
(
s
);

5761 ià(
com´essiÚ
 > 1)

5762  
	`¡bi__”½uc
("bad compression", "PSD has‡n unknown compression format");

5765 ià(!
	`¡bi__mad3sizes_v®id
(4, 
w
, 
h
, 0))

5766  
	`¡bi__”½uc
("too†arge", "Corrupt PSD");

5770 ià(!
com´essiÚ
 && 
b™d•th
 =ğ16 && 
bpc
 == 16) {

5771 
out
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(8, 
w
, 
h
, 0);

5772 
ri
->
b™s_³r_chªÃl
 = 16;

5774 
out
 = (
¡bi_uc
 *è
	`¡bi__m®loc
(4 * 
w
*
h
);

5776 ià(!
out
è 
	`¡bi__”½uc
("outofmem", "Out of memory");

5777 
pix–CouÁ
 = 
w
*
h
;

5783 ià(
com´essiÚ
) {

5794 
	`¡bi__sk
(
s
, 
h
 * 
chªÃlCouÁ
 * 2 );

5797 
chªÃl
 = 0; channel < 4; channel++) {

5798 
¡bi_uc
 *
p
;

5800 
p
 = 
out
+
chªÃl
;

5801 ià(
chªÃl
 >ğ
chªÃlCouÁ
) {

5803 
i
 = 0; i < 
pix–CouÁ
; i++, 
p
 += 4)

5804 *
p
 = (
chªÃl
 == 3 ? 255 : 0);

5807 ià(!
	`¡bi__psd_decode_¾e
(
s
, 
p
, 
pix–CouÁ
)) {

5808 
	`STBI_FREE
(
out
);

5809  
	`¡bi__”½uc
("corrupt", "bad RLE data");

5819 
chªÃl
 = 0; channel < 4; channel++) {

5820 ià(
chªÃl
 >ğ
chªÃlCouÁ
) {

5822 ià(
b™d•th
 =ğ16 && 
bpc
 == 16) {

5823 
¡bi__ušt16
 *
q
 = ((¡bi__ušt16 *è
out
è+ 
chªÃl
;

5824 
¡bi__ušt16
 
v®
 = 
chªÃl
 == 3 ? 65535 : 0;

5825 
i
 = 0; i < 
pix–CouÁ
; i++, 
q
 += 4)

5826 *
q
 = 
v®
;

5828 
¡bi_uc
 *
p
 = 
out
+
chªÃl
;

5829 
¡bi_uc
 
v®
 = 
chªÃl
 == 3 ? 255 : 0;

5830 
i
 = 0; i < 
pix–CouÁ
; i++, 
p
 += 4)

5831 *
p
 = 
v®
;

5834 ià(
ri
->
b™s_³r_chªÃl
 == 16) {

5835 
¡bi__ušt16
 *
q
 = ((¡bi__ušt16 *è
out
è+ 
chªÃl
;

5836 
i
 = 0; i < 
pix–CouÁ
; i++, 
q
 += 4)

5837 *
q
 = (
¡bi__ušt16
è
	`¡bi__g‘16be
(
s
);

5839 
¡bi_uc
 *
p
 = 
out
+
chªÃl
;

5840 ià(
b™d•th
 == 16) {

5841 
i
 = 0; i < 
pix–CouÁ
; i++, 
p
 += 4)

5842 *
p
 = (
¡bi_uc
è(
	`¡bi__g‘16be
(
s
) >> 8);

5844 
i
 = 0; i < 
pix–CouÁ
; i++, 
p
 += 4)

5845 *
p
 = 
	`¡bi__g‘8
(
s
);

5853 ià(
chªÃlCouÁ
 >= 4) {

5854 ià(
ri
->
b™s_³r_chªÃl
 == 16) {

5855 
i
=0; i < 
w
*
h
; ++i) {

5856 
¡bi__ušt16
 *
pix–
 = (¡bi__ušt16 *è
out
 + 4*
i
;

5857 ià(
pix–
[3] != 0 &&…ixel[3] != 65535) {

5858 
a
 = 
pix–
[3] / 65535.0f;

5859 
¿
 = 1.0à/ 
a
;

5860 
šv_a
 = 65535.0à* (1 - 
¿
);

5861 
pix–
[0] = (
¡bi__ušt16
èÕix–[0]*
¿
 + 
šv_a
);

5862 
pix–
[1] = (
¡bi__ušt16
èÕix–[1]*
¿
 + 
šv_a
);

5863 
pix–
[2] = (
¡bi__ušt16
èÕix–[2]*
¿
 + 
šv_a
);

5867 
i
=0; i < 
w
*
h
; ++i) {

5868 *
pix–
 = 
out
 + 4*
i
;

5869 ià(
pix–
[3] != 0 &&…ixel[3] != 255) {

5870 
a
 = 
pix–
[3] / 255.0f;

5871 
¿
 = 1.0à/ 
a
;

5872 
šv_a
 = 255.0à* (1 - 
¿
);

5873 
pix–
[0] = (èÕix–[0]*
¿
 + 
šv_a
);

5874 
pix–
[1] = (èÕix–[1]*
¿
 + 
šv_a
);

5875 
pix–
[2] = (èÕix–[2]*
¿
 + 
šv_a
);

5882 ià(
»q_comp
 &&„eq_comp != 4) {

5883 ià(
ri
->
b™s_³r_chªÃl
 == 16)

5884 
out
 = (
¡bi_uc
 *è
	`¡bi__cÚv”t_fÜm©16
((
¡bi__ušt16
 *èout, 4, 
»q_comp
, 
w
, 
h
);

5886 
out
 = 
	`¡bi__cÚv”t_fÜm©
(out, 4, 
»q_comp
, 
w
, 
h
);

5887 ià(
out
 =ğ
NULL
)  out;

5890 ià(
comp
) *comp = 4;

5891 *
y
 = 
h
;

5892 *
x
 = 
w
;

5894  
out
;

5895 
	}
}

5905 #iâdeà
STBI_NO_PIC


5906 
	$¡bi__pic_is4
(
¡bi__cÚ‹xt
 *
s
,cÚ¡ *
¡r
)

5908 
i
;

5909 
i
=0; i<4; ++i)

5910 ià(
	`¡bi__g‘8
(
s
è!ğ(
¡bi_uc
)
¡r
[
i
])

5914 
	}
}

5916 
	$¡bi__pic_‹¡_cÜe
(
¡bi__cÚ‹xt
 *
s
)

5918 
i
;

5920 ià(!
	`¡bi__pic_is4
(
s
,"\x53\x80\xF6\x34"))

5923 
i
=0;i<84;++i)

5924 
	`¡bi__g‘8
(
s
);

5926 ià(!
	`¡bi__pic_is4
(
s
,"PICT"))

5930 
	}
}

5934 
¡bi_uc
 
	msize
,
	mty³
,
	mchªÃl
;

5935 } 
	t¡bi__pic_·ck‘
;

5937 
¡bi_uc
 *
	$¡bi__»adv®
(
¡bi__cÚ‹xt
 *
s
, 
chªÃl
, 
¡bi_uc
 *
de¡
)

5939 
mask
=0x80, 
i
;

5941 
i
=0; i<4; ++i, 
mask
>>=1) {

5942 ià(
chªÃl
 & 
mask
) {

5943 ià(
	`¡bi__©_eof
(
s
)è 
	`¡bi__”½uc
("bad file","PIC fileoo short");

5944 
de¡
[
i
]=
	`¡bi__g‘8
(
s
);

5948  
de¡
;

5949 
	}
}

5951 
	$¡bi__cİyv®
(
chªÃl
,
¡bi_uc
 *
de¡
,cÚ¡ stbi_uø*
¤c
)

5953 
mask
=0x80,
i
;

5955 
i
=0;i<4; ++i, 
mask
>>=1)

5956 ià(
chªÃl
&
mask
)

5957 
de¡
[
i
]=
¤c
[i];

5958 
	}
}

5960 
¡bi_uc
 *
	$¡bi__pic_lßd_cÜe
(
¡bi__cÚ‹xt
 *
s
,
width
,
height
,*
comp
, 
¡bi_uc
 *
»suÉ
)

5962 
aù_comp
=0,
num_·ck‘s
=0,
y
,
chašed
;

5963 
¡bi__pic_·ck‘
 
·ck‘s
[10];

5968 
¡bi__pic_·ck‘
 *
·ck‘
;

5970 ià(
num_·ck‘s
==(
·ck‘s
)/(packets[0]))

5971  
	`¡bi__”½uc
("bad format","too many…ackets");

5973 
·ck‘
 = &
·ck‘s
[
num_·ck‘s
++];

5975 
chašed
 = 
	`¡bi__g‘8
(
s
);

5976 
·ck‘
->
size
 = 
	`¡bi__g‘8
(
s
);

5977 
·ck‘
->
ty³
 = 
	`¡bi__g‘8
(
s
);

5978 
·ck‘
->
chªÃl
 = 
	`¡bi__g‘8
(
s
);

5980 
aù_comp
 |ğ
·ck‘
->
chªÃl
;

5982 ià(
	`¡bi__©_eof
(
s
)è 
	`¡bi__”½uc
("bad file","fileoo short (reading…ackets)");

5983 ià(
·ck‘
->
size
 !ğ8è 
	`¡bi__”½uc
("bad format","packet isn't 8bpp");

5984 } 
chašed
);

5986 *
comp
 = (
aù_comp
 & 0x10 ? 4 : 3);

5988 
y
=0; y<
height
; ++y) {

5989 
·ck‘_idx
;

5991 
·ck‘_idx
=0;…ack‘_idx < 
num_·ck‘s
; ++packet_idx) {

5992 
¡bi__pic_·ck‘
 *
·ck‘
 = &
·ck‘s
[
·ck‘_idx
];

5993 
¡bi_uc
 *
de¡
 = 
»suÉ
+
y
*
width
*4;

5995 
·ck‘
->
ty³
) {

5997  
	`¡bi__”½uc
("bad format","packet has bad compressionype");

6000 
x
;

6002 
x
=0;x<
width
;++x, 
de¡
+=4)

6003 ià(!
	`¡bi__»adv®
(
s
,
·ck‘
->
chªÃl
,
de¡
))

6010 
Ëá
=
width
, 
i
;

6012 
Ëá
>0) {

6013 
¡bi_uc
 
couÁ
,
v®ue
[4];

6015 
couÁ
=
	`¡bi__g‘8
(
s
);

6016 ià(
	`¡bi__©_eof
(
s
)è 
	`¡bi__”½uc
("bad file","fileoo short (pure„ead count)");

6018 ià(
couÁ
 > 
Ëá
)

6019 
couÁ
 = (
¡bi_uc
è
Ëá
;

6021 ià(!
	`¡bi__»adv®
(
s
,
·ck‘
->
chªÃl
,
v®ue
))  0;

6023 
i
=0; i<
couÁ
; ++i,
de¡
+=4)

6024 
	`¡bi__cİyv®
(
·ck‘
->
chªÃl
,
de¡
,
v®ue
);

6025 
Ëá
 -ğ
couÁ
;

6031 
Ëá
=
width
;

6032 
Ëá
>0) {

6033 
couÁ
 = 
	`¡bi__g‘8
(
s
), 
i
;

6034 ià(
	`¡bi__©_eof
(
s
)è 
	`¡bi__”½uc
("bad file","fileoo short (mixed„ead count)");

6036 ià(
couÁ
 >= 128) {

6037 
¡bi_uc
 
v®ue
[4];

6039 ià(
couÁ
==128)

6040 
couÁ
 = 
	`¡bi__g‘16be
(
s
);

6042 
couÁ
 -= 127;

6043 ià(
couÁ
 > 
Ëá
)

6044  
	`¡bi__”½uc
("bad file","scanline overrun");

6046 ià(!
	`¡bi__»adv®
(
s
,
·ck‘
->
chªÃl
,
v®ue
))

6049 
i
=0;i<
couÁ
;++i, 
de¡
 += 4)

6050 
	`¡bi__cİyv®
(
·ck‘
->
chªÃl
,
de¡
,
v®ue
);

6052 ++
couÁ
;

6053 ià(
couÁ
>
Ëá
è 
	`¡bi__”½uc
("bad file","scanline overrun");

6055 
i
=0;i<
couÁ
;++i, 
de¡
+=4)

6056 ià(!
	`¡bi__»adv®
(
s
,
·ck‘
->
chªÃl
,
de¡
))

6059 
Ëá
-=
couÁ
;

6067  
»suÉ
;

6068 
	}
}

6070 *
	$¡bi__pic_lßd
(
¡bi__cÚ‹xt
 *
s
,*
px
,*
py
,*
comp
,
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

6072 
¡bi_uc
 *
»suÉ
;

6073 
i
, 
x
,
y
, 
š‹º®_comp
;

6074 
	`STBI_NOTUSED
(
ri
);

6076 ià(!
comp
ècom°ğ&
š‹º®_comp
;

6078 
i
=0; i<92; ++i)

6079 
	`¡bi__g‘8
(
s
);

6081 
x
 = 
	`¡bi__g‘16be
(
s
);

6082 
y
 = 
	`¡bi__g‘16be
(
s
);

6083 ià(
	`¡bi__©_eof
(
s
)è 
	`¡bi__”½uc
("bad file","fileoo short (pic header)");

6084 ià(!
	`¡bi__mad3sizes_v®id
(
x
, 
y
, 4, 0)è 
	`¡bi__”½uc
("too†arge", "PIC imageoo†argeo decode");

6086 
	`¡bi__g‘32be
(
s
);

6087 
	`¡bi__g‘16be
(
s
);

6088 
	`¡bi__g‘16be
(
s
);

6091 
»suÉ
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
x
, 
y
, 4, 0);

6092 
	`mem£t
(
»suÉ
, 0xff, 
x
*
y
*4);

6094 ià(!
	`¡bi__pic_lßd_cÜe
(
s
,
x
,
y
,
comp
, 
»suÉ
)) {

6095 
	`STBI_FREE
(
»suÉ
);

6096 
»suÉ
=0;

6098 *
px
 = 
x
;

6099 *
py
 = 
y
;

6100 ià(
»q_comp
 =ğ0è»q_com°ğ*
comp
;

6101 
»suÉ
=
	`¡bi__cÚv”t_fÜm©
ÔesuÉ,4,
»q_comp
,
x
,
y
);

6103  
»suÉ
;

6104 
	}
}

6106 
	$¡bi__pic_‹¡
(
¡bi__cÚ‹xt
 *
s
)

6108 
r
 = 
	`¡bi__pic_‹¡_cÜe
(
s
);

6109 
	`¡bi__»wšd
(
s
);

6110  
r
;

6111 
	}
}

6117 #iâdeà
STBI_NO_GIF


6120 
¡bi__št16
 
	m´efix
;

6121 
¡bi_uc
 
	mfœ¡
;

6122 
¡bi_uc
 
	msuffix
;

6123 } 
	t¡bi__gif_lzw
;

6127 
	mw
,
	mh
;

6128 
¡bi_uc
 *
	mout
;

6129 
¡bi_uc
 *
	mbackground
;

6130 
¡bi_uc
 *
	mhi¡Üy
;

6131 
	mæags
, 
	mbgšdex
, 
	m¿tio
, 
	mŒª¥¬’t
, 
	meæags
;

6132 
¡bi_uc
 
	m·l
[256][4];

6133 
¡bi_uc
 
	mÍ®
[256][4];

6134 
¡bi__gif_lzw
 
	mcodes
[8192];

6135 
¡bi_uc
 *
	mcŞÜ_bË
;

6136 
	m·r£
, 
	m¡•
;

6137 
	mlæags
;

6138 
	m¡¬t_x
, 
	m¡¬t_y
;

6139 
	mmax_x
, 
	mmax_y
;

6140 
	mcur_x
, 
	mcur_y
;

6141 
	mlše_size
;

6142 
	md–ay
;

6143 } 
	t¡bi__gif
;

6145 
	$¡bi__gif_‹¡_¿w
(
¡bi__cÚ‹xt
 *
s
)

6147 
sz
;

6148 ià(
	`¡bi__g‘8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')  0;

6149 
sz
 = 
	`¡bi__g‘8
(
s
);

6150 ià(
sz
 != '9' && sz != '7')  0;

6151 ià(
	`¡bi__g‘8
(
s
) != 'a')  0;

6153 
	}
}

6155 
	$¡bi__gif_‹¡
(
¡bi__cÚ‹xt
 *
s
)

6157 
r
 = 
	`¡bi__gif_‹¡_¿w
(
s
);

6158 
	`¡bi__»wšd
(
s
);

6159  
r
;

6160 
	}
}

6162 
	$¡bi__gif_·r£_cŞÜbË
(
¡bi__cÚ‹xt
 *
s
, 
¡bi_uc
 
·l
[256][4], 
num_’Œ›s
, 
Œª¥
)

6164 
i
;

6165 
i
=0; i < 
num_’Œ›s
; ++i) {

6166 
·l
[
i
][2] = 
	`¡bi__g‘8
(
s
);

6167 
·l
[
i
][1] = 
	`¡bi__g‘8
(
s
);

6168 
·l
[
i
][0] = 
	`¡bi__g‘8
(
s
);

6169 
·l
[
i
][3] = 
Œª¥
 == i ? 0 : 255;

6171 
	}
}

6173 
	$¡bi__gif_h—d”
(
¡bi__cÚ‹xt
 *
s
, 
¡bi__gif
 *
g
, *
comp
, 
is_šfo
)

6175 
¡bi_uc
 
v”siÚ
;

6176 ià(
	`¡bi__g‘8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')

6177  
	`¡bi__”r
("not GIF", "Corrupt GIF");

6179 
v”siÚ
 = 
	`¡bi__g‘8
(
s
);

6180 ià(
v”siÚ
 !ğ'7' && v”siÚ !ğ'9'è 
	`¡bi__”r
("not GIF", "Corrupt GIF");

6181 ià(
	`¡bi__g‘8
(
s
è!ğ'a'è 
	`¡bi__”r
("not GIF", "Corrupt GIF");

6183 
¡bi__g_çu»_»asÚ
 = "";

6184 
g
->
w
 = 
	`¡bi__g‘16Ë
(
s
);

6185 
g
->
h
 = 
	`¡bi__g‘16Ë
(
s
);

6186 
g
->
æags
 = 
	`¡bi__g‘8
(
s
);

6187 
g
->
bgšdex
 = 
	`¡bi__g‘8
(
s
);

6188 
g
->
¿tio
 = 
	`¡bi__g‘8
(
s
);

6189 
g
->
Œª¥¬’t
 = -1;

6191 ià(
comp
 != 0) *comp = 4;

6193 ià(
is_šfo
)  1;

6195 ià(
g
->
æags
 & 0x80)

6196 
	`¡bi__gif_·r£_cŞÜbË
(
s
,
g
->
·l
, 2 << (g->
æags
 & 7), -1);

6199 
	}
}

6201 
	$¡bi__gif_šfo_¿w
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

6203 
¡bi__gif
* 
g
 = (¡bi__gif*è
	`¡bi__m®loc
((stbi__gif));

6204 ià(!
	`¡bi__gif_h—d”
(
s
, 
g
, 
comp
, 1)) {

6205 
	`STBI_FREE
(
g
);

6206 
	`¡bi__»wšd
Ğ
s
 );

6209 ià(
x
è*x = 
g
->
w
;

6210 ià(
y
è*y = 
g
->
h
;

6211 
	`STBI_FREE
(
g
);

6213 
	}
}

6215 
	$¡bi__out_gif_code
(
¡bi__gif
 *
g
, 
¡bi__ušt16
 
code
)

6217 
¡bi_uc
 *
p
, *
c
;

6218 
idx
;

6222 ià(
g
->
codes
[
code
].
´efix
 >= 0)

6223 
	`¡bi__out_gif_code
(
g
, g->
codes
[
code
].
´efix
);

6225 ià(
g
->
cur_y
 >ğg->
max_y
) ;

6227 
idx
 = 
g
->
cur_x
 + g->
cur_y
;

6228 
p
 = &
g
->
out
[
idx
];

6229 
g
->
hi¡Üy
[
idx
 / 4] = 1;

6231 
c
 = &
g
->
cŞÜ_bË
[g->
codes
[
code
].
suffix
 * 4];

6232 ià(
c
[3] > 128) {

6233 
p
[0] = 
c
[2];

6234 
p
[1] = 
c
[1];

6235 
p
[2] = 
c
[0];

6236 
p
[3] = 
c
[3];

6238 
g
->
cur_x
 += 4;

6240 ià(
g
->
cur_x
 >ğg->
max_x
) {

6241 
g
->
cur_x
 = g->
¡¬t_x
;

6242 
g
->
cur_y
 +ğg->
¡•
;

6244 
g
->
cur_y
 >ğg->
max_y
 && g->
·r£
 > 0) {

6245 
g
->
¡•
 = (1 << g->
·r£
è* g->
lše_size
;

6246 
g
->
cur_y
 = g->
¡¬t_y
 + (g->
¡•
 >> 1);

6247 --
g
->
·r£
;

6250 
	}
}

6252 
¡bi_uc
 *
	$¡bi__´oûss_gif_¿¡”
(
¡bi__cÚ‹xt
 *
s
, 
¡bi__gif
 *
g
)

6254 
¡bi_uc
 
lzw_cs
;

6255 
¡bi__št32
 
Ën
, 
š™_code
;

6256 
¡bi__ušt32
 
fœ¡
;

6257 
¡bi__št32
 
codesize
, 
codemask
, 
ava
, 
Şdcode
, 
b™s
, 
v®id_b™s
, 
ş—r
;

6258 
¡bi__gif_lzw
 *
p
;

6260 
lzw_cs
 = 
	`¡bi__g‘8
(
s
);

6261 ià(
lzw_cs
 > 12è 
NULL
;

6262 
ş—r
 = 1 << 
lzw_cs
;

6263 
fœ¡
 = 1;

6264 
codesize
 = 
lzw_cs
 + 1;

6265 
codemask
 = (1 << 
codesize
) - 1;

6266 
b™s
 = 0;

6267 
v®id_b™s
 = 0;

6268 
š™_code
 = 0; in™_cod< 
ş—r
; init_code++) {

6269 
g
->
codes
[
š™_code
].
´efix
 = -1;

6270 
g
->
codes
[
š™_code
].
fœ¡
 = (
¡bi_uc
) init_code;

6271 
g
->
codes
[
š™_code
].
suffix
 = (
¡bi_uc
) init_code;

6275 
ava
 = 
ş—r
+2;

6276 
Şdcode
 = -1;

6278 
Ën
 = 0;

6280 ià(
v®id_b™s
 < 
codesize
) {

6281 ià(
Ën
 == 0) {

6282 
Ën
 = 
	`¡bi__g‘8
(
s
);

6283 ià(
Ën
 == 0)

6284  
g
->
out
;

6286 --
Ën
;

6287 
b™s
 |ğ(
¡bi__št32
è
	`¡bi__g‘8
(
s
è<< 
v®id_b™s
;

6288 
v®id_b™s
 += 8;

6290 
¡bi__št32
 
code
 = 
b™s
 & 
codemask
;

6291 
b™s
 >>ğ
codesize
;

6292 
v®id_b™s
 -ğ
codesize
;

6294 ià(
code
 =ğ
ş—r
) {

6295 
codesize
 = 
lzw_cs
 + 1;

6296 
codemask
 = (1 << 
codesize
) - 1;

6297 
ava
 = 
ş—r
 + 2;

6298 
Şdcode
 = -1;

6299 
fœ¡
 = 0;

6300 } ià(
code
 =ğ
ş—r
 + 1) {

6301 
	`¡bi__sk
(
s
, 
Ën
);

6302 (
Ën
 = 
	`¡bi__g‘8
(
s
)) > 0)

6303 
	`¡bi__sk
(
s
,
Ën
);

6304  
g
->
out
;

6305 } ià(
code
 <ğ
ava
) {

6306 ià(
fœ¡
) {

6307  
	`¡bi__”½uc
("no clear code", "Corrupt GIF");

6310 ià(
Şdcode
 >= 0) {

6311 
p
 = &
g
->
codes
[
ava
++];

6312 ià(
ava
 > 8192) {

6313  
	`¡bi__”½uc
("too many codes", "Corrupt GIF");

6316 
p
->
´efix
 = (
¡bi__št16
è
Şdcode
;

6317 
p
->
fœ¡
 = 
g
->
codes
[
Şdcode
].first;

6318 
p
->
suffix
 = (
code
 =ğ
ava
è?…->
fœ¡
 : 
g
->
codes
[code].first;

6319 } ià(
code
 =ğ
ava
)

6320  
	`¡bi__”½uc
("illegal code in„aster", "Corrupt GIF");

6322 
	`¡bi__out_gif_code
(
g
, (
¡bi__ušt16
è
code
);

6324 ià((
ava
 & 
codemask
) == 0 &&‡vail <= 0x0FFF) {

6325 
codesize
++;

6326 
codemask
 = (1 << 
codesize
) - 1;

6329 
Şdcode
 = 
code
;

6331  
	`¡bi__”½uc
("illegal code in„aster", "Corrupt GIF");

6335 
	}
}

6339 
¡bi_uc
 *
	$¡bi__gif_lßd_Ãxt
(
¡bi__cÚ‹xt
 *
s
, 
¡bi__gif
 *
g
, *
comp
, 
»q_comp
, 
¡bi_uc
 *
two_back
)

6341 
di¥o£
;

6342 
fœ¡_äame
;

6343 
pi
;

6344 
pcouÁ
;

6347 
fœ¡_äame
 = 0;

6348 ià(
g
->
out
 == 0) {

6349 ià(!
	`¡bi__gif_h—d”
(
s
, 
g
, 
comp
,0))  0;

6350 
g
->
out
 = (
¡bi_uc
 *è
	`¡bi__m®loc
(4 * g->
w
 * g->
h
);

6351 
g
->
background
 = (
¡bi_uc
 *è
	`¡bi__m®loc
(4 * g->
w
 * g->
h
);

6352 
g
->
hi¡Üy
 = (
¡bi_uc
 *è
	`¡bi__m®loc
(g->
w
 * g->
h
);

6353 ià(
g
->
out
 =ğ0è 
	`¡bi__”½uc
("outofmem", "Out of memory");

6358 
	`mem£t
Ğ
g
->
out
, 0x00, 4 * g->
w
 * g->
h
 );

6359 
	`mem£t
Ğ
g
->
background
, 0x00, 4 * g->
w
 * g->
h
 );

6360 
	`mem£t
Ğ
g
->
hi¡Üy
, 0x00, g->
w
 * g->
h
 );

6361 
fœ¡_äame
 = 1;

6364 
di¥o£
 = (
g
->
eæags
 & 0x1C) >> 2;

6365 
pcouÁ
 = 
g
->
w
 * g->
h
;

6367 ià((
di¥o£
 =ğ3è&& (
two_back
 == 0)) {

6368 
di¥o£
 = 2;

6371 ià(
di¥o£
 == 3) {

6372 
pi
 = 0;…˜< 
pcouÁ
; ++pi) {

6373 ià(
g
->
hi¡Üy
[
pi
]) {

6374 
	`memıy
Ğ&
g
->
out
[
pi
 * 4], &
two_back
[pi * 4], 4 );

6377 } ià(
di¥o£
 == 2) {

6379 
pi
 = 0;…˜< 
pcouÁ
; ++pi) {

6380 ià(
g
->
hi¡Üy
[
pi
]) {

6381 
	`memıy
Ğ&
g
->
out
[
pi
 * 4], &g->
background
[pi * 4], 4 );

6392 
	`memıy
Ğ
g
->
background
, g->
out
, 4 * g->
w
 * g->
h
 );

6396 
	`mem£t
Ğ
g
->
hi¡Üy
, 0x00, g->
w
 * g->
h
 );

6399 
g
 = 
	`¡bi__g‘8
(
s
);

6400 
g
) {

6403 
¡bi__št32
 
x
, 
y
, 
w
, 
h
;

6404 
¡bi_uc
 *
o
;

6406 
x
 = 
	`¡bi__g‘16Ë
(
s
);

6407 
y
 = 
	`¡bi__g‘16Ë
(
s
);

6408 
w
 = 
	`¡bi__g‘16Ë
(
s
);

6409 
h
 = 
	`¡bi__g‘16Ë
(
s
);

6410 ià(((
x
 + 
w
è> (
g
->w)è|| ((
y
 + 
h
) > (g->h)))

6411  
	`¡bi__”½uc
("bad Image Descriptor", "Corrupt GIF");

6413 
g
->
lše_size
 = g->
w
 * 4;

6414 
g
->
¡¬t_x
 = 
x
 * 4;

6415 
g
->
¡¬t_y
 = 
y
 * g->
lše_size
;

6416 
g
->
max_x
 = g->
¡¬t_x
 + 
w
 * 4;

6417 
g
->
max_y
 = g->
¡¬t_y
 + 
h
 * g->
lše_size
;

6418 
g
->
cur_x
 = g->
¡¬t_x
;

6419 
g
->
cur_y
 = g->
¡¬t_y
;

6421 
g
->
læags
 = 
	`¡bi__g‘8
(
s
);

6423 ià(
g
->
læags
 & 0x40) {

6424 
g
->
¡•
 = 8 * g->
lše_size
;

6425 
g
->
·r£
 = 3;

6427 
g
->
¡•
 = g->
lše_size
;

6428 
g
->
·r£
 = 0;

6431 ià(
g
->
læags
 & 0x80) {

6432 
	`¡bi__gif_·r£_cŞÜbË
(
s
,
g
->
Í®
, 2 << (g->
læags
 & 7), g->
eæags
 & 0x01 ? g->
Œª¥¬’t
 : -1);

6433 
g
->
cŞÜ_bË
 = (
¡bi_uc
 *èg->
Í®
;

6434 } ià(
g
->
æags
 & 0x80) {

6435 
g
->
cŞÜ_bË
 = (
¡bi_uc
 *èg->
·l
;

6437  
	`¡bi__”½uc
("missing colorable", "Corrupt GIF");

6439 
o
 = 
	`¡bi__´oûss_gif_¿¡”
(
s
, 
g
);

6440 ià(
o
 =ğ
NULL
)  NULL;

6443 
pcouÁ
 = 
g
->
w
 * g->
h
;

6444 ià(
fœ¡_äame
 && (
g
->
bgšdex
 > 0)) {

6446 
pi
 = 0;…˜< 
pcouÁ
; ++pi) {

6447 ià(
g
->
hi¡Üy
[
pi
] == 0) {

6448 
g
->
·l
[g->
bgšdex
][3] = 255;

6449 
	`memıy
Ğ&
g
->
out
[
pi
 * 4], &g->
·l
[g->
bgšdex
], 4 );

6454  
o
;

6459 
Ën
;

6460 
ext
 = 
	`¡bi__g‘8
(
s
);

6461 ià(
ext
 == 0xF9) {

6462 
Ën
 = 
	`¡bi__g‘8
(
s
);

6463 ià(
Ën
 == 4) {

6464 
g
->
eæags
 = 
	`¡bi__g‘8
(
s
);

6465 
g
->
d–ay
 = 10 * 
	`¡bi__g‘16Ë
(
s
);

6468 ià(
g
->
Œª¥¬’t
 >= 0) {

6469 
g
->
·l
[g->
Œª¥¬’t
][3] = 255;

6471 ià(
g
->
eæags
 & 0x01) {

6472 
g
->
Œª¥¬’t
 = 
	`¡bi__g‘8
(
s
);

6473 ià(
g
->
Œª¥¬’t
 >= 0) {

6474 
g
->
·l
[g->
Œª¥¬’t
][3] = 0;

6478 
	`¡bi__sk
(
s
, 1);

6479 
g
->
Œª¥¬’t
 = -1;

6482 
	`¡bi__sk
(
s
, 
Ën
);

6486 (
Ën
 = 
	`¡bi__g‘8
(
s
)) != 0) {

6487 
	`¡bi__sk
(
s
, 
Ën
);

6493  (
¡bi_uc
 *è
s
;

6496  
	`¡bi__”½uc
("unknown code", "Corrupt GIF");

6499 
	}
}

6501 *
	$¡bi__lßd_gif_maš
(
¡bi__cÚ‹xt
 *
s
, **
d–ays
, *
x
, *
y
, *
z
, *
comp
, 
»q_comp
)

6503 ià(
	`¡bi__gif_‹¡
(
s
)) {

6504 
Ïy”s
 = 0;

6505 
¡bi_uc
 *
u
 = 0;

6506 
¡bi_uc
 *
out
 = 0;

6507 
¡bi_uc
 *
two_back
 = 0;

6508 
¡bi__gif
 
g
;

6509 
¡ride
;

6510 
	`mem£t
(&
g
, 0, (g));

6511 ià(
d–ays
) {

6512 *
d–ays
 = 0;

6516 
u
 = 
	`¡bi__gif_lßd_Ãxt
(
s
, &
g
, 
comp
, 
»q_comp
, 
two_back
);

6517 ià(
u
 =ğ(
¡bi_uc
 *è
s
) u = 0;

6519 ià(
u
) {

6520 *
x
 = 
g
.
w
;

6521 *
y
 = 
g
.
h
;

6522 ++
Ïy”s
;

6523 
¡ride
 = 
g
.
w
 * g.
h
 * 4;

6525 ià(
out
) {

6526 
out
 = (
¡bi_uc
*è
	`STBI_REALLOC
Ğout, 
Ïy”s
 * 
¡ride
 );

6527 ià(
d–ays
) {

6528 *
d–ays
 = (*è
	`STBI_REALLOC
Ğ*d–ays, (è* 
Ïy”s
 );

6531 
out
 = (
¡bi_uc
*)
	`¡bi__m®loc
Ğ
Ïy”s
 * 
¡ride
 );

6532 ià(
d–ays
) {

6533 *
d–ays
 = (*è
	`¡bi__m®loc
Ğ
Ïy”s
 * () );

6536 
	`memıy
Ğ
out
 + ((
Ïy”s
 - 1è* 
¡ride
), 
u
, stride );

6537 ià(
Ïy”s
 >= 2) {

6538 
two_back
 = 
out
 - 2 * 
¡ride
;

6541 ià(
d–ays
) {

6542 (*
d–ays
)[
Ïy”s
 - 1U] = 
g
.
d–ay
;

6545 } 
u
 != 0);

6548 
	`STBI_FREE
(
g
.
out
);

6549 
	`STBI_FREE
(
g
.
hi¡Üy
);

6550 
	`STBI_FREE
(
g
.
background
);

6553 ià(
»q_comp
 &&„eq_comp != 4)

6554 
out
 = 
	`¡bi__cÚv”t_fÜm©
(out, 4, 
»q_comp
, 
Ïy”s
 * 
g
.
w
, g.
h
);

6556 *
z
 = 
Ïy”s
;

6557  
out
;

6559  
	`¡bi__”½uc
("not GIF", "Image was‚ot‡s‡ gifype.");

6561 
	}
}

6563 *
	$¡bi__gif_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

6565 
¡bi_uc
 *
u
 = 0;

6566 
¡bi__gif
 
g
;

6567 
	`mem£t
(&
g
, 0, (g));

6569 
u
 = 
	`¡bi__gif_lßd_Ãxt
(
s
, &
g
, 
comp
, 
»q_comp
, 0);

6570 ià(
u
 =ğ(
¡bi_uc
 *è
s
) u = 0;

6571 ià(
u
) {

6572 *
x
 = 
g
.
w
;

6573 *
y
 = 
g
.
h
;

6577 ià(
»q_comp
 &&„eq_comp != 4)

6578 
u
 = 
	`¡bi__cÚv”t_fÜm©
(u, 4, 
»q_comp
, 
g
.
w
, g.
h
);

6582 
	`STBI_FREE
(
g
.
hi¡Üy
);

6583 
	`STBI_FREE
(
g
.
background
);

6585  
u
;

6586 
	}
}

6588 
	$¡bi__gif_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

6590  
	`¡bi__gif_šfo_¿w
(
s
,
x
,
y
,
comp
);

6591 
	}
}

6597 #iâdeà
STBI_NO_HDR


6598 
	$¡bi__hdr_‹¡_cÜe
(
¡bi__cÚ‹xt
 *
s
, cÚ¡ *
sigÇtu»
)

6600 
i
;

6601 
i
=0; 
sigÇtu»
[i]; ++i)

6602 ià(
	`¡bi__g‘8
(
s
è!ğ
sigÇtu»
[
i
])

6604 
	`¡bi__»wšd
(
s
);

6606 
	}
}

6608 
	$¡bi__hdr_‹¡
(
¡bi__cÚ‹xt
* 
s
)

6610 
r
 = 
	`¡bi__hdr_‹¡_cÜe
(
s
, "#?RADIANCE\n");

6611 
	`¡bi__»wšd
(
s
);

6612 if(!
r
) {

6613 
r
 = 
	`¡bi__hdr_‹¡_cÜe
(
s
, "#?RGBE\n");

6614 
	`¡bi__»wšd
(
s
);

6616  
r
;

6617 
	}
}

6619 
	#STBI__HDR_BUFLEN
 1024

	)

6620 *
	$¡bi__hdr_g‘tok’
(
¡bi__cÚ‹xt
 *
z
, *
bufãr
)

6622 
Ën
=0;

6623 
c
 = '\0';

6625 
c
 = (è
	`¡bi__g‘8
(
z
);

6627 !
	`¡bi__©_eof
(
z
è&& 
c
 != '\n') {

6628 
bufãr
[
Ën
++] = 
c
;

6629 ià(
Ën
 =ğ
STBI__HDR_BUFLEN
-1) {

6631 !
	`¡bi__©_eof
(
z
è&& 
	`¡bi__g‘8
(z) != '\n')

6635 
c
 = (è
	`¡bi__g‘8
(
z
);

6638 
bufãr
[
Ën
] = 0;

6639  
bufãr
;

6640 
	}
}

6642 
	$¡bi__hdr_cÚv”t
(*
ouut
, 
¡bi_uc
 *
šput
, 
»q_comp
)

6644 iàĞ
šput
[3] != 0 ) {

6645 
f1
;

6647 
f1
 = (è
	`ldexp
(1.0f, 
šput
[3] - ()(128 + 8));

6648 ià(
»q_comp
 <= 2)

6649 
ouut
[0] = (
šput
[0] + iÅut[1] + iÅut[2]è* 
f1
 / 3;

6651 
ouut
[0] = 
šput
[0] * 
f1
;

6652 
ouut
[1] = 
šput
[1] * 
f1
;

6653 
ouut
[2] = 
šput
[2] * 
f1
;

6655 ià(
»q_comp
 =ğ2è
ouut
[1] = 1;

6656 ià(
»q_comp
 =ğ4è
ouut
[3] = 1;

6658 
»q_comp
) {

6659 4: 
ouut
[3] = 1;

6660 3: 
ouut
[0] = output[1] = output[2] = 0;

6662 2: 
ouut
[1] = 1;

6663 1: 
ouut
[0] = 0;

6667 
	}
}

6669 *
	$¡bi__hdr_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

6671 
bufãr
[
STBI__HDR_BUFLEN
];

6672 *
tok’
;

6673 
v®id
 = 0;

6674 
width
, 
height
;

6675 
¡bi_uc
 *
sÿÆše
;

6676 *
hdr_d©a
;

6677 
Ën
;

6678 
couÁ
, 
v®ue
;

6679 
i
, 
j
, 
k
, 
c1
,
c2
, 
z
;

6680 cÚ¡ *
h—d”Tok’
;

6681 
	`STBI_NOTUSED
(
ri
);

6684 
h—d”Tok’
 = 
	`¡bi__hdr_g‘tok’
(
s
,
bufãr
);

6685 ià(
	`¡rcmp
(
h—d”Tok’
, "#?RADIANCE") != 0 && strcmp(headerToken, "#?RGBE") != 0)

6686  
	`¡bi__”½f
("not HDR", "Corrupt HDR image");

6690 
tok’
 = 
	`¡bi__hdr_g‘tok’
(
s
,
bufãr
);

6691 ià(
tok’
[0] == 0) ;

6692 ià(
	`¡rcmp
(
tok’
, "FORMAT=32-b™_¾e_rgbe"è=ğ0è
v®id
 = 1;

6695 ià(!
v®id
è 
	`¡bi__”½f
("unsupported format", "Unsupported HDR format");

6699 
tok’
 = 
	`¡bi__hdr_g‘tok’
(
s
,
bufãr
);

6700 ià(
	`¡ºcmp
(
tok’
, "-Y ", 3)è 
	`¡bi__”½f
("unsupported data†ayout", "Unsupported HDR format");

6701 
tok’
 += 3;

6702 
height
 = (è
	`¡¹Ş
(
tok’
, &token, 10);

6703 *
tok’
 == ' ') ++token;

6704 ià(
	`¡ºcmp
(
tok’
, "+X ", 3)è 
	`¡bi__”½f
("unsupported data†ayout", "Unsupported HDR format");

6705 
tok’
 += 3;

6706 
width
 = (è
	`¡¹Ş
(
tok’
, 
NULL
, 10);

6708 *
x
 = 
width
;

6709 *
y
 = 
height
;

6711 ià(
comp
) *comp = 3;

6712 ià(
»q_comp
 == 0)„eq_comp = 3;

6714 ià(!
	`¡bi__mad4sizes_v®id
(
width
, 
height
, 
»q_comp
, (), 0))

6715  
	`¡bi__”½f
("too†arge", "HDR image isoo†arge");

6718 
hdr_d©a
 = (*è
	`¡bi__m®loc_mad4
(
width
, 
height
, 
»q_comp
, (), 0);

6719 ià(!
hdr_d©a
)

6720  
	`¡bi__”½f
("outofmem", "Out of memory");

6724 iàĞ
width
 < 8 || width >= 32768) {

6726 
j
=0; j < 
height
; ++j) {

6727 
i
=0; i < 
width
; ++i) {

6728 
¡bi_uc
 
rgbe
[4];

6729 
maš_decode_loİ
:

6730 
	`¡bi__g‘n
(
s
, 
rgbe
, 4);

6731 
	`¡bi__hdr_cÚv”t
(
hdr_d©a
 + 
j
 * 
width
 * 
»q_comp
 + 
i
 *„eq_comp, 
rgbe
,„eq_comp);

6736 
sÿÆše
 = 
NULL
;

6738 
j
 = 0; j < 
height
; ++j) {

6739 
c1
 = 
	`¡bi__g‘8
(
s
);

6740 
c2
 = 
	`¡bi__g‘8
(
s
);

6741 
Ën
 = 
	`¡bi__g‘8
(
s
);

6742 ià(
c1
 !ğ2 || 
c2
 !ğ2 || (
Ën
 & 0x80)) {

6745 
¡bi_uc
 
rgbe
[4];

6746 
rgbe
[0] = (
¡bi_uc
è
c1
;

6747 
rgbe
[1] = (
¡bi_uc
è
c2
;

6748 
rgbe
[2] = (
¡bi_uc
è
Ën
;

6749 
rgbe
[3] = (
¡bi_uc
è
	`¡bi__g‘8
(
s
);

6750 
	`¡bi__hdr_cÚv”t
(
hdr_d©a
, 
rgbe
, 
»q_comp
);

6751 
i
 = 1;

6752 
j
 = 0;

6753 
	`STBI_FREE
(
sÿÆše
);

6754 
maš_decode_loİ
;

6756 
Ën
 <<= 8;

6757 
Ën
 |ğ
	`¡bi__g‘8
(
s
);

6758 ià(
Ën
 !ğ
width
è{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sÿÆše
);  
	`¡bi__”½f
("invalid decoded scanline†ength", "corrupt HDR"); }

6759 ià(
sÿÆše
 =ğ
NULL
) {

6760 
sÿÆše
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad2
(
width
, 4, 0);

6761 ià(!
sÿÆše
) {

6762 
	`STBI_FREE
(
hdr_d©a
);

6763  
	`¡bi__”½f
("outofmem", "Out of memory");

6767 
k
 = 0; k < 4; ++k) {

6768 
Æeá
;

6769 
i
 = 0;

6770 (
Æeá
 = 
width
 - 
i
) > 0) {

6771 
couÁ
 = 
	`¡bi__g‘8
(
s
);

6772 ià(
couÁ
 > 128) {

6774 
v®ue
 = 
	`¡bi__g‘8
(
s
);

6775 
couÁ
 -= 128;

6776 ià(
couÁ
 > 
Æeá
è{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sÿÆše
);  
	`¡bi__”½f
("corrupt", "bad RLE data in HDR"); }

6777 
z
 = 0; z < 
couÁ
; ++z)

6778 
sÿÆše
[
i
++ * 4 + 
k
] = 
v®ue
;

6781 ià(
couÁ
 > 
Æeá
è{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sÿÆše
);  
	`¡bi__”½f
("corrupt", "bad RLE data in HDR"); }

6782 
z
 = 0; z < 
couÁ
; ++z)

6783 
sÿÆše
[
i
++ * 4 + 
k
] = 
	`¡bi__g‘8
(
s
);

6787 
i
=0; i < 
width
; ++i)

6788 
	`¡bi__hdr_cÚv”t
(
hdr_d©a
+(
j
*
width
 + 
i
)*
»q_comp
, 
sÿÆše
 + i*4,„eq_comp);

6790 ià(
sÿÆše
)

6791 
	`STBI_FREE
(
sÿÆše
);

6794  
hdr_d©a
;

6795 
	}
}

6797 
	$¡bi__hdr_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

6799 
bufãr
[
STBI__HDR_BUFLEN
];

6800 *
tok’
;

6801 
v®id
 = 0;

6802 
dummy
;

6804 ià(!
x
èx = &
dummy
;

6805 ià(!
y
èy = &
dummy
;

6806 ià(!
comp
ècom°ğ&
dummy
;

6808 ià(
	`¡bi__hdr_‹¡
(
s
) == 0) {

6809 
	`¡bi__»wšd
Ğ
s
 );

6814 
tok’
 = 
	`¡bi__hdr_g‘tok’
(
s
,
bufãr
);

6815 ià(
tok’
[0] == 0) ;

6816 ià(
	`¡rcmp
(
tok’
, "FORMAT=32-b™_¾e_rgbe"è=ğ0è
v®id
 = 1;

6819 ià(!
v®id
) {

6820 
	`¡bi__»wšd
Ğ
s
 );

6823 
tok’
 = 
	`¡bi__hdr_g‘tok’
(
s
,
bufãr
);

6824 ià(
	`¡ºcmp
(
tok’
, "-Y ", 3)) {

6825 
	`¡bi__»wšd
Ğ
s
 );

6828 
tok’
 += 3;

6829 *
y
 = (è
	`¡¹Ş
(
tok’
, &token, 10);

6830 *
tok’
 == ' ') ++token;

6831 ià(
	`¡ºcmp
(
tok’
, "+X ", 3)) {

6832 
	`¡bi__»wšd
Ğ
s
 );

6835 
tok’
 += 3;

6836 *
x
 = (è
	`¡¹Ş
(
tok’
, 
NULL
, 10);

6837 *
comp
 = 3;

6839 
	}
}

6842 #iâdeà
STBI_NO_BMP


6843 
	$¡bi__bmp_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

6845 *
p
;

6846 
¡bi__bmp_d©a
 
šfo
;

6848 
šfo
.
®l_a
 = 255;

6849 
p
 = 
	`¡bi__bmp_·r£_h—d”
(
s
, &
šfo
);

6850 
	`¡bi__»wšd
Ğ
s
 );

6851 ià(
p
 =ğ
NULL
)

6853 ià(
x
è*x = 
s
->
img_x
;

6854 ià(
y
è*y = 
s
->
img_y
;

6855 ià(
comp
è*com°ğ
šfo
.
ma
 ? 4 : 3;

6857 
	}
}

6860 #iâdeà
STBI_NO_PSD


6861 
	$¡bi__psd_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

6863 
chªÃlCouÁ
, 
dummy
, 
d•th
;

6864 ià(!
x
èx = &
dummy
;

6865 ià(!
y
èy = &
dummy
;

6866 ià(!
comp
ècom°ğ&
dummy
;

6867 ià(
	`¡bi__g‘32be
(
s
) != 0x38425053) {

6868 
	`¡bi__»wšd
Ğ
s
 );

6871 ià(
	`¡bi__g‘16be
(
s
) != 1) {

6872 
	`¡bi__»wšd
Ğ
s
 );

6875 
	`¡bi__sk
(
s
, 6);

6876 
chªÃlCouÁ
 = 
	`¡bi__g‘16be
(
s
);

6877 ià(
chªÃlCouÁ
 < 0 || channelCount > 16) {

6878 
	`¡bi__»wšd
Ğ
s
 );

6881 *
y
 = 
	`¡bi__g‘32be
(
s
);

6882 *
x
 = 
	`¡bi__g‘32be
(
s
);

6883 
d•th
 = 
	`¡bi__g‘16be
(
s
);

6884 ià(
d•th
 != 8 && depth != 16) {

6885 
	`¡bi__»wšd
Ğ
s
 );

6888 ià(
	`¡bi__g‘16be
(
s
) != 3) {

6889 
	`¡bi__»wšd
Ğ
s
 );

6892 *
comp
 = 4;

6894 
	}
}

6896 
	$¡bi__psd_is16
(
¡bi__cÚ‹xt
 *
s
)

6898 
chªÃlCouÁ
, 
d•th
;

6899 ià(
	`¡bi__g‘32be
(
s
) != 0x38425053) {

6900 
	`¡bi__»wšd
Ğ
s
 );

6903 ià(
	`¡bi__g‘16be
(
s
) != 1) {

6904 
	`¡bi__»wšd
Ğ
s
 );

6907 
	`¡bi__sk
(
s
, 6);

6908 
chªÃlCouÁ
 = 
	`¡bi__g‘16be
(
s
);

6909 ià(
chªÃlCouÁ
 < 0 || channelCount > 16) {

6910 
	`¡bi__»wšd
Ğ
s
 );

6913 (è
	`¡bi__g‘32be
(
s
);

6914 (è
	`¡bi__g‘32be
(
s
);

6915 
d•th
 = 
	`¡bi__g‘16be
(
s
);

6916 ià(
d•th
 != 16) {

6917 
	`¡bi__»wšd
Ğ
s
 );

6921 
	}
}

6924 #iâdeà
STBI_NO_PIC


6925 
	$¡bi__pic_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

6927 
aù_comp
=0,
num_·ck‘s
=0,
chašed
,
dummy
;

6928 
¡bi__pic_·ck‘
 
·ck‘s
[10];

6930 ià(!
x
èx = &
dummy
;

6931 ià(!
y
èy = &
dummy
;

6932 ià(!
comp
ècom°ğ&
dummy
;

6934 ià(!
	`¡bi__pic_is4
(
s
,"\x53\x80\xF6\x34")) {

6935 
	`¡bi__»wšd
(
s
);

6939 
	`¡bi__sk
(
s
, 88);

6941 *
x
 = 
	`¡bi__g‘16be
(
s
);

6942 *
y
 = 
	`¡bi__g‘16be
(
s
);

6943 ià(
	`¡bi__©_eof
(
s
)) {

6944 
	`¡bi__»wšd
Ğ
s
);

6947 iàĞ(*
x
è!ğ0 && (1 << 28è/ (*xè< (*
y
)) {

6948 
	`¡bi__»wšd
Ğ
s
 );

6952 
	`¡bi__sk
(
s
, 8);

6955 
¡bi__pic_·ck‘
 *
·ck‘
;

6957 ià(
num_·ck‘s
==(
·ck‘s
)/(packets[0]))

6960 
·ck‘
 = &
·ck‘s
[
num_·ck‘s
++];

6961 
chašed
 = 
	`¡bi__g‘8
(
s
);

6962 
·ck‘
->
size
 = 
	`¡bi__g‘8
(
s
);

6963 
·ck‘
->
ty³
 = 
	`¡bi__g‘8
(
s
);

6964 
·ck‘
->
chªÃl
 = 
	`¡bi__g‘8
(
s
);

6965 
aù_comp
 |ğ
·ck‘
->
chªÃl
;

6967 ià(
	`¡bi__©_eof
(
s
)) {

6968 
	`¡bi__»wšd
Ğ
s
 );

6971 ià(
·ck‘
->
size
 != 8) {

6972 
	`¡bi__»wšd
Ğ
s
 );

6975 } 
chašed
);

6977 *
comp
 = (
aù_comp
 & 0x10 ? 4 : 3);

6980 
	}
}

6995 #iâdeà
STBI_NO_PNM


6997 
	$¡bi__²m_‹¡
(
¡bi__cÚ‹xt
 *
s
)

6999 
p
, 
t
;

7000 
p
 = (è
	`¡bi__g‘8
(
s
);

7001 
t
 = (è
	`¡bi__g‘8
(
s
);

7002 ià(
p
 !ğ'P' || (
t
 != '5' && != '6')) {

7003 
	`¡bi__»wšd
Ğ
s
 );

7007 
	}
}

7009 *
	$¡bi__²m_lßd
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
, 
»q_comp
, 
¡bi__»suÉ_šfo
 *
ri
)

7011 
¡bi_uc
 *
out
;

7012 
	`STBI_NOTUSED
(
ri
);

7014 ià(!
	`¡bi__²m_šfo
(
s
, (*)&s->
img_x
, (*)&s->
img_y
, (*)&s->
img_n
))

7017 *
x
 = 
s
->
img_x
;

7018 *
y
 = 
s
->
img_y
;

7019 ià(
comp
è*com°ğ
s
->
img_n
;

7021 ià(!
	`¡bi__mad3sizes_v®id
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0))

7022  
	`¡bi__”½uc
("too†arge", "PNMoo†arge");

7024 
out
 = (
¡bi_uc
 *è
	`¡bi__m®loc_mad3
(
s
->
img_n
, s->
img_x
, s->
img_y
, 0);

7025 ià(!
out
è 
	`¡bi__”½uc
("outofmem", "Out of memory");

7026 
	`¡bi__g‘n
(
s
, 
out
, s->
img_n
 * s->
img_x
 * s->
img_y
);

7028 ià(
»q_comp
 &&„eq_com°!ğ
s
->
img_n
) {

7029 
out
 = 
	`¡bi__cÚv”t_fÜm©
(out, 
s
->
img_n
, 
»q_comp
, s->
img_x
, s->
img_y
);

7030 ià(
out
 =ğ
NULL
)  out;

7032  
out
;

7033 
	}
}

7035 
	$¡bi__²m_is¥aû
(
c
)

7037  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

7038 
	}
}

7040 
	$¡bi__²m_sk_wh™e¥aû
(
¡bi__cÚ‹xt
 *
s
, *
c
)

7043 !
	`¡bi__©_eof
(
s
è&& 
	`¡bi__²m_is¥aû
(*
c
))

7044 *
c
 = (è
	`¡bi__g‘8
(
s
);

7046 ià(
	`¡bi__©_eof
(
s
è|| *
c
 != '#')

7049 !
	`¡bi__©_eof
(
s
è&& *
c
 != '\n' && *c != '\r' )

7050 *
c
 = (è
	`¡bi__g‘8
(
s
);

7052 
	}
}

7054 
	$¡bi__²m_isdig™
(
c
)

7056  
c
 >= '0' && c <= '9';

7057 
	}
}

7059 
	$¡bi__²m_g‘š‹g”
(
¡bi__cÚ‹xt
 *
s
, *
c
)

7061 
v®ue
 = 0;

7063 !
	`¡bi__©_eof
(
s
è&& 
	`¡bi__²m_isdig™
(*
c
)) {

7064 
v®ue
 = v®ue*10 + (*
c
 - '0');

7065 *
c
 = (è
	`¡bi__g‘8
(
s
);

7068  
v®ue
;

7069 
	}
}

7071 
	$¡bi__²m_šfo
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

7073 
maxv
, 
dummy
;

7074 
c
, 
p
, 
t
;

7076 ià(!
x
èx = &
dummy
;

7077 ià(!
y
èy = &
dummy
;

7078 ià(!
comp
ècom°ğ&
dummy
;

7080 
	`¡bi__»wšd
(
s
);

7083 
p
 = (è
	`¡bi__g‘8
(
s
);

7084 
t
 = (è
	`¡bi__g‘8
(
s
);

7085 ià(
p
 !ğ'P' || (
t
 != '5' && != '6')) {

7086 
	`¡bi__»wšd
(
s
);

7090 *
comp
 = (
t
 == '6') ? 3 : 1;

7092 
c
 = (è
	`¡bi__g‘8
(
s
);

7093 
	`¡bi__²m_sk_wh™e¥aû
(
s
, &
c
);

7095 *
x
 = 
	`¡bi__²m_g‘š‹g”
(
s
, &
c
);

7096 
	`¡bi__²m_sk_wh™e¥aû
(
s
, &
c
);

7098 *
y
 = 
	`¡bi__²m_g‘š‹g”
(
s
, &
c
);

7099 
	`¡bi__²m_sk_wh™e¥aû
(
s
, &
c
);

7101 
maxv
 = 
	`¡bi__²m_g‘š‹g”
(
s
, &
c
);

7103 ià(
maxv
 > 255)

7104  
	`¡bi__”r
("max value > 255", "PPM image‚ot 8-bit");

7107 
	}
}

7110 
	$¡bi__šfo_maš
(
¡bi__cÚ‹xt
 *
s
, *
x
, *
y
, *
comp
)

7112 #iâdeà
STBI_NO_JPEG


7113 ià(
	`¡bi__j³g_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7116 #iâdeà
STBI_NO_PNG


7117 ià(
	`¡bi__²g_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7120 #iâdeà
STBI_NO_GIF


7121 ià(
	`¡bi__gif_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7124 #iâdeà
STBI_NO_BMP


7125 ià(
	`¡bi__bmp_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7128 #iâdeà
STBI_NO_PSD


7129 ià(
	`¡bi__psd_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7132 #iâdeà
STBI_NO_PIC


7133 ià(
	`¡bi__pic_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7136 #iâdeà
STBI_NO_PNM


7137 ià(
	`¡bi__²m_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7140 #iâdeà
STBI_NO_HDR


7141 ià(
	`¡bi__hdr_šfo
(
s
, 
x
, 
y
, 
comp
))  1;

7145 #iâdeà
STBI_NO_TGA


7146 ià(
	`¡bi__tga_šfo
(
s
, 
x
, 
y
, 
comp
))

7149  
	`¡bi__”r
("unknown imageype", "Image‚ot of‡ny knownype, or corrupt");

7150 
	}
}

7152 
	$¡bi__is_16_maš
(
¡bi__cÚ‹xt
 *
s
)

7154 #iâdeà
STBI_NO_PNG


7155 ià(
	`¡bi__²g_is16
(
s
))  1;

7158 #iâdeà
STBI_NO_PSD


7159 ià(
	`¡bi__psd_is16
(
s
))  1;

7163 
	}
}

7165 #iâdeà
STBI_NO_STDIO


7166 
STBIDEF
 
	$¡bi_šfo
(cÚ¡ *
f’ame
, *
x
, *
y
, *
comp
)

7168 
FILE
 *
f
 = 
	`¡bi__fİ’
(
f’ame
, "rb");

7169 
»suÉ
;

7170 ià(!
f
è 
	`¡bi__”r
("can't fopen", "Unableo open file");

7171 
»suÉ
 = 
	`¡bi_šfo_äom_fe
(
f
, 
x
, 
y
, 
comp
);

7172 
	`fşo£
(
f
);

7173  
»suÉ
;

7174 
	}
}

7176 
STBIDEF
 
	$¡bi_šfo_äom_fe
(
FILE
 *
f
, *
x
, *
y
, *
comp
)

7178 
r
;

7179 
¡bi__cÚ‹xt
 
s
;

7180 
pos
 = 
	`á–l
(
f
);

7181 
	`¡bi__¡¬t_fe
(&
s
, 
f
);

7182 
r
 = 
	`¡bi__šfo_maš
(&
s
,
x
,
y
,
comp
);

7183 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7184  
r
;

7185 
	}
}

7187 
STBIDEF
 
	$¡bi_is_16_b™
(cÚ¡ *
f’ame
)

7189 
FILE
 *
f
 = 
	`¡bi__fİ’
(
f’ame
, "rb");

7190 
»suÉ
;

7191 ià(!
f
è 
	`¡bi__”r
("can't fopen", "Unableo open file");

7192 
»suÉ
 = 
	`¡bi_is_16_b™_äom_fe
(
f
);

7193 
	`fşo£
(
f
);

7194  
»suÉ
;

7195 
	}
}

7197 
STBIDEF
 
	$¡bi_is_16_b™_äom_fe
(
FILE
 *
f
)

7199 
r
;

7200 
¡bi__cÚ‹xt
 
s
;

7201 
pos
 = 
	`á–l
(
f
);

7202 
	`¡bi__¡¬t_fe
(&
s
, 
f
);

7203 
r
 = 
	`¡bi__is_16_maš
(&
s
);

7204 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7205  
r
;

7206 
	}
}

7209 
STBIDEF
 
	$¡bi_šfo_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
, *
x
, *
y
, *
comp
)

7211 
¡bi__cÚ‹xt
 
s
;

7212 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

7213  
	`¡bi__šfo_maš
(&
s
,
x
,
y
,
comp
);

7214 
	}
}

7216 
STBIDEF
 
	$¡bi_šfo_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
c
, *
u£r
, *
x
, *
y
, *
comp
)

7218 
¡bi__cÚ‹xt
 
s
;

7219 
	`¡bi__¡¬t_ÿÎbacks
(&
s
, (
¡bi_io_ÿÎbacks
 *è
c
, 
u£r
);

7220  
	`¡bi__šfo_maš
(&
s
,
x
,
y
,
comp
);

7221 
	}
}

7223 
STBIDEF
 
	$¡bi_is_16_b™_äom_memÜy
(
¡bi_uc
 cÚ¡ *
bufãr
, 
Ën
)

7225 
¡bi__cÚ‹xt
 
s
;

7226 
	`¡bi__¡¬t_mem
(&
s
,
bufãr
,
Ën
);

7227  
	`¡bi__is_16_maš
(&
s
);

7228 
	}
}

7230 
STBIDEF
 
	$¡bi_is_16_b™_äom_ÿÎbacks
(
¡bi_io_ÿÎbacks
 cÚ¡ *
c
, *
u£r
)

7232 
¡bi__cÚ‹xt
 
s
;

7233 
	`¡bi__¡¬t_ÿÎbacks
(&
s
, (
¡bi_io_ÿÎbacks
 *è
c
, 
u£r
);

7234  
	`¡bi__is_16_maš
(&
s
);

7235 
	}
}

	@host/src/stb_image_write.h

148 #iâdeà
INCLUDE_STB_IMAGE_WRITE_H


149 
	#INCLUDE_STB_IMAGE_WRITE_H


	)

152 #iâdeà
STBIWDEF


153 #ifdeà
STB_IMAGE_WRITE_STATIC


154 
	#STBIWDEF
 

	)

156 #ifdeà
__ılu¥lus


157 
	#STBIWDEF
 "C"

	)

159 
	#STBIWDEF
 

	)

164 #iâdeà
STB_IMAGE_WRITE_STATIC


165 
¡bi_wr™e_tga_w™h_¾e
;

166 
¡bi_wr™e_²g_com´essiÚ_Ëv–
;

167 
¡bi_wr™e_fÜû_²g_f‹r
;

170 #iâdeà
STBI_WRITE_NO_STDIO


171 
STBIWDEF
 
¡bi_wr™e_²g
(cÚ¡ *
f’ame
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
, 
¡ride_š_by‹s
);

172 
STBIWDEF
 
¡bi_wr™e_bmp
(cÚ¡ *
f’ame
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
);

173 
STBIWDEF
 
¡bi_wr™e_tga
(cÚ¡ *
f’ame
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
);

174 
STBIWDEF
 
¡bi_wr™e_hdr
(cÚ¡ *
f’ame
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
);

175 
STBIWDEF
 
¡bi_wr™e_jpg
(cÚ¡ *
f’ame
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
, 
qu®™y
);

178 
	t¡bi_wr™e_func
(*
	tcÚ‹xt
, *
	td©a
, 
	tsize
);

180 
STBIWDEF
 
¡bi_wr™e_²g_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
, 
¡ride_š_by‹s
);

181 
STBIWDEF
 
¡bi_wr™e_bmp_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
);

182 
STBIWDEF
 
¡bi_wr™e_tga_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
);

183 
STBIWDEF
 
¡bi_wr™e_hdr_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
w
, 
h
, 
comp
, cÚ¡ *
d©a
);

184 
STBIWDEF
 
¡bi_wr™e_jpg_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
, 
qu®™y
);

186 
STBIWDEF
 
¡bi_æ_v”tiÿÎy_Ú_wr™e
(
æ_boŞ—n
);

190 #ifdeà
STB_IMAGE_WRITE_IMPLEMENTATION


192 #ifdeà
_WIN32


193 #iâdeà
_CRT_SECURE_NO_WARNINGS


194 
	#_CRT_SECURE_NO_WARNINGS


	)

196 #iâdeà
_CRT_NONSTDC_NO_DEPRECATE


197 
	#_CRT_NONSTDC_NO_DEPRECATE


	)

201 #iâdeà
STBI_WRITE_NO_STDIO


202 
	~<¡dio.h
>

205 
	~<¡d¬g.h
>

206 
	~<¡dlib.h
>

207 
	~<¡ršg.h
>

208 
	~<m©h.h
>

210 #ià
defšed
(
STBIW_MALLOC
è&& defšed(
STBIW_FREE
è&& (defšed(
STBIW_REALLOC
è|| defšed(
STBIW_REALLOC_SIZED
))

212 #–ià!
defšed
(
STBIW_MALLOC
è&& !defšed(
STBIW_FREE
è&& !defšed(
STBIW_REALLOC
è&& !defšed(
STBIW_REALLOC_SIZED
)

218 #iâdeà
STBIW_MALLOC


219 
	#STBIW_MALLOC
(
sz
è
	`m®loc
(sz)

	)

220 
	#STBIW_REALLOC
(
p
,
Ãwsz
è
	`»®loc
Õ,Ãwsz)

	)

221 
	#STBIW_FREE
(
p
è
	`ä“
Õ)

	)

224 #iâdeà
STBIW_REALLOC_SIZED


225 
	#STBIW_REALLOC_SIZED
(
p
,
Şdsz
,
Ãwsz
è
	`STBIW_REALLOC
Õ,Ãwsz)

	)

229 #iâdeà
STBIW_MEMMOVE


230 
	#STBIW_MEMMOVE
(
a
,
b
,
sz
è
	`memmove
×,b,sz)

	)

234 #iâdeà
STBIW_ASSERT


235 
	~<as£¹.h
>

236 
	#STBIW_ASSERT
(
x
è
	`as£¹
(x)

	)

239 
	#STBIW_UCHAR
(
x
è(è((xè& 0xff)

	)

241 #ifdeà
STB_IMAGE_WRITE_STATIC


242 
	g¡bi__æ_v”tiÿÎy_Ú_wr™e
=0;

243 
	g¡bi_wr™e_²g_com´essiÚ_Ëv–
 = 8;

244 
	g¡bi_wr™e_tga_w™h_¾e
 = 1;

245 
	g¡bi_wr™e_fÜû_²g_f‹r
 = -1;

247 
	g¡bi_wr™e_²g_com´essiÚ_Ëv–
 = 8;

248 
	g¡bi__æ_v”tiÿÎy_Ú_wr™e
=0;

249 
	g¡bi_wr™e_tga_w™h_¾e
 = 1;

250 
	g¡bi_wr™e_fÜû_²g_f‹r
 = -1;

253 
STBIWDEF
 
	$¡bi_æ_v”tiÿÎy_Ú_wr™e
(
æag
)

255 
¡bi__æ_v”tiÿÎy_Ú_wr™e
 = 
æag
;

256 
	}
}

260 
¡bi_wr™e_func
 *
	mfunc
;

261 *
	mcÚ‹xt
;

262 } 
	t¡bi__wr™e_cÚ‹xt
;

265 
	$¡bi__¡¬t_wr™e_ÿÎbacks
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
¡bi_wr™e_func
 *
c
, *
cÚ‹xt
)

267 
s
->
func
 = 
c
;

268 
s
->
cÚ‹xt
 = context;

269 
	}
}

271 #iâdeà
STBI_WRITE_NO_STDIO


273 
	$¡bi__¡dio_wr™e
(*
cÚ‹xt
, *
d©a
, 
size
)

275 
	`fwr™e
(
d©a
,1,
size
,(
FILE
*è
cÚ‹xt
);

276 
	}
}

278 
	$¡bi__¡¬t_wr™e_fe
(
¡bi__wr™e_cÚ‹xt
 *
s
, cÚ¡ *
f’ame
)

280 
FILE
 *
f
;

281 #ifdeà
STBI_MSC_SECURE_CRT


282 ià(
	`fİ’_s
(&
f
, 
f’ame
, "wb"))

283 
f
 = 
NULL
;

285 
f
 = 
	`fİ’
(
f’ame
, "wb");

287 
	`¡bi__¡¬t_wr™e_ÿÎbacks
(
s
, 
¡bi__¡dio_wr™e
, (*è
f
);

288  
f
 !ğ
NULL
;

289 
	}
}

291 
	$¡bi__’d_wr™e_fe
(
¡bi__wr™e_cÚ‹xt
 *
s
)

293 
	`fşo£
((
FILE
 *)
s
->
cÚ‹xt
);

294 
	}
}

298 
	t¡biw_ušt32
;

299 
	t¡b_image_wr™e_‹¡
[(
¡biw_ušt32
)==4 ? 1 : -1];

301 
	$¡biw__wr™efv
(
¡bi__wr™e_cÚ‹xt
 *
s
, cÚ¡ *
fmt
, 
va_li¡
 
v
)

303 *
fmt
) {

304 *
fmt
++) {

306 '1': { 
x
 = 
	`STBIW_UCHAR
(
	`va_¬g
(
v
, ));

307 
s
->
	`func
(s->
cÚ‹xt
,&
x
,1);

309 '2': { 
x
 = 
	`va_¬g
(
v
,);

310 
b
[2];

311 
b
[0] = 
	`STBIW_UCHAR
(
x
);

312 
b
[1] = 
	`STBIW_UCHAR
(
x
>>8);

313 
s
->
	`func
(s->
cÚ‹xt
,
b
,2);

315 '4': { 
¡biw_ušt32
 
x
 = 
	`va_¬g
(
v
,);

316 
b
[4];

317 
b
[0]=
	`STBIW_UCHAR
(
x
);

318 
b
[1]=
	`STBIW_UCHAR
(
x
>>8);

319 
b
[2]=
	`STBIW_UCHAR
(
x
>>16);

320 
b
[3]=
	`STBIW_UCHAR
(
x
>>24);

321 
s
->
	`func
(s->
cÚ‹xt
,
b
,4);

324 
	`STBIW_ASSERT
(0);

328 
	}
}

330 
	$¡biw__wr™ef
(
¡bi__wr™e_cÚ‹xt
 *
s
, cÚ¡ *
fmt
, ...)

332 
va_li¡
 
v
;

333 
	`va_¡¬t
(
v
, 
fmt
);

334 
	`¡biw__wr™efv
(
s
, 
fmt
, 
v
);

335 
	`va_’d
(
v
);

336 
	}
}

338 
	$¡biw__putc
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
c
)

340 
s
->
	`func
(s->
cÚ‹xt
, &
c
, 1);

341 
	}
}

343 
	$¡biw__wr™e3
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
a
, 
b
, 
c
)

345 
¬r
[3];

346 
¬r
[0] = 
a
,‡¼[1] = 
b
,‡¼[2] = 
c
;

347 
s
->
	`func
(s->
cÚ‹xt
, 
¬r
, 3);

348 
	}
}

350 
	$¡biw__wr™e_pix–
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
rgb_dœ
, 
comp
, 
wr™e_®pha
, 
ex·nd_mÚo
, *
d
)

352 
bg
[3] = { 255, 0, 255}, 
px
[3];

353 
k
;

355 ià(
wr™e_®pha
 < 0)

356 
s
->
	`func
(s->
cÚ‹xt
, &
d
[
comp
 - 1], 1);

358 
comp
) {

361 ià(
ex·nd_mÚo
)

362 
	`¡biw__wr™e3
(
s
, 
d
[0], d[0], d[0]);

364 
s
->
	`func
(s->
cÚ‹xt
, 
d
, 1);

367 ià(!
wr™e_®pha
) {

369 
k
 = 0; k < 3; ++k)

370 
px
[
k
] = 
bg
[k] + ((
d
[k] - bg[k]) * d[3]) / 255;

371 
	`¡biw__wr™e3
(
s
, 
px
[1 - 
rgb_dœ
],…x[1],…x[1 +„gb_dir]);

376 
	`¡biw__wr™e3
(
s
, 
d
[1 - 
rgb_dœ
], d[1], d[1 +„gb_dir]);

379 ià(
wr™e_®pha
 > 0)

380 
s
->
	`func
(s->
cÚ‹xt
, &
d
[
comp
 - 1], 1);

381 
	}
}

383 
	$¡biw__wr™e_pix–s
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
rgb_dœ
, 
vdœ
, 
x
, 
y
, 
comp
, *
d©a
, 
wr™e_®pha
, 
sÿÆše_·d
, 
ex·nd_mÚo
)

385 
¡biw_ušt32
 
z”o
 = 0;

386 
i
,
j
, 
j_’d
;

388 ià(
y
 <= 0)

391 ià(
¡bi__æ_v”tiÿÎy_Ú_wr™e
)

392 
vdœ
 *= -1;

394 ià(
vdœ
 < 0)

395 
j_’d
 = -1, 
j
 = 
y
-1;

397 
j_’d
 = 
y
, 
j
 = 0;

399 ; 
j
 !ğ
j_’d
; j +ğ
vdœ
) {

400 
i
=0; i < 
x
; ++i) {

401 *
d
 = (*è
d©a
 + (
j
*
x
+
i
)*
comp
;

402 
	`¡biw__wr™e_pix–
(
s
, 
rgb_dœ
, 
comp
, 
wr™e_®pha
, 
ex·nd_mÚo
, 
d
);

404 
s
->
	`func
(s->
cÚ‹xt
, &
z”o
, 
sÿÆše_·d
);

406 
	}
}

408 
	$¡biw__outfe
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
rgb_dœ
, 
vdœ
, 
x
, 
y
, 
comp
, 
ex·nd_mÚo
, *
d©a
, 
®pha
, 
·d
, cÚ¡ *
fmt
, ...)

410 ià(
y
 < 0 || 
x
 < 0) {

413 
va_li¡
 
v
;

414 
	`va_¡¬t
(
v
, 
fmt
);

415 
	`¡biw__wr™efv
(
s
, 
fmt
, 
v
);

416 
	`va_’d
(
v
);

417 
	`¡biw__wr™e_pix–s
(
s
,
rgb_dœ
,
vdœ
,
x
,
y
,
comp
,
d©a
,
®pha
,
·d
, 
ex·nd_mÚo
);

420 
	}
}

422 
	$¡bi_wr™e_bmp_cÜe
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

424 
·d
 = (-
x
*3) & 3;

425  
	`¡biw__outfe
(
s
,-1,-1,
x
,
y
,
comp
,1,(*è
d©a
,0,
·d
,

427 'B', 'M', 14+40+(
x
*3+
·d
)*
y
, 0,0, 14+40,

428 40, 
x
,
y
, 1,24, 0,0,0,0,0,0);

429 
	}
}

431 
STBIWDEF
 
	$¡bi_wr™e_bmp_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

433 
¡bi__wr™e_cÚ‹xt
 
s
;

434 
	`¡bi__¡¬t_wr™e_ÿÎbacks
(&
s
, 
func
, 
cÚ‹xt
);

435  
	`¡bi_wr™e_bmp_cÜe
(&
s
, 
x
, 
y
, 
comp
, 
d©a
);

436 
	}
}

438 #iâdeà
STBI_WRITE_NO_STDIO


439 
STBIWDEF
 
	$¡bi_wr™e_bmp
(cÚ¡ *
f’ame
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

441 
¡bi__wr™e_cÚ‹xt
 
s
;

442 ià(
	`¡bi__¡¬t_wr™e_fe
(&
s
,
f’ame
)) {

443 
r
 = 
	`¡bi_wr™e_bmp_cÜe
(&
s
, 
x
, 
y
, 
comp
, 
d©a
);

444 
	`¡bi__’d_wr™e_fe
(&
s
);

445  
r
;

448 
	}
}

451 
	$¡bi_wr™e_tga_cÜe
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
x
, 
y
, 
comp
, *
d©a
)

453 
has_®pha
 = (
comp
 == 2 || comp == 4);

454 
cŞÜby‹s
 = 
has_®pha
 ? 
comp
-1 : comp;

455 
fÜm©
 = 
cŞÜby‹s
 < 2 ? 3 : 2;

457 ià(
y
 < 0 || 
x
 < 0)

460 ià(!
¡bi_wr™e_tga_w™h_¾e
) {

461  
	`¡biw__outfe
(
s
, -1, -1, 
x
, 
y
, 
comp
, 0, (*è
d©a
, 
has_®pha
, 0,

462 "111 221 2222 11", 0, 0, 
fÜm©
, 0, 0, 0, 0, 0, 
x
, 
y
, (
cŞÜby‹s
 + 
has_®pha
) * 8, has_alpha * 8);

464 
i
,
j
,
k
;

465 
j’d
, 
jdœ
;

467 
	`¡biw__wr™ef
(
s
, "111 221 2222 11", 0,0,
fÜm©
+8, 0,0,0, 0,0,
x
,
y
, (
cŞÜby‹s
 + 
has_®pha
) * 8, has_alpha * 8);

469 ià(
¡bi__æ_v”tiÿÎy_Ú_wr™e
) {

470 
j
 = 0;

471 
j’d
 = 
y
;

472 
jdœ
 = 1;

474 
j
 = 
y
-1;

475 
j’d
 = -1;

476 
jdœ
 = -1;

478 ; 
j
 !ğ
j’d
; j +ğ
jdœ
) {

479 *
row
 = (*è
d©a
 + 
j
 * 
x
 * 
comp
;

480 
Ën
;

482 
i
 = 0; i < 
x
; i +ğ
Ën
) {

483 *
begš
 = 
row
 + 
i
 * 
comp
;

484 
diff
 = 1;

485 
Ën
 = 1;

487 ià(
i
 < 
x
 - 1) {

488 ++
Ën
;

489 
diff
 = 
	`memcmp
(
begš
, 
row
 + (
i
 + 1è* 
comp
, comp);

490 ià(
diff
) {

491 cÚ¡ *
´ev
 = 
begš
;

492 
k
 = 
i
 + 2; k < 
x
 && 
Ën
 < 128; ++k) {

493 ià(
	`memcmp
(
´ev
, 
row
 + 
k
 * 
comp
, comp)) {

494 
´ev
 +ğ
comp
;

495 ++
Ën
;

497 --
Ën
;

502 
k
 = 
i
 + 2; k < 
x
 && 
Ën
 < 128; ++k) {

503 ià(!
	`memcmp
(
begš
, 
row
 + 
k
 * 
comp
, comp)) {

504 ++
Ën
;

512 ià(
diff
) {

513 
h—d”
 = 
	`STBIW_UCHAR
(
Ën
 - 1);

514 
s
->
	`func
(s->
cÚ‹xt
, &
h—d”
, 1);

515 
k
 = 0; k < 
Ën
; ++k) {

516 
	`¡biw__wr™e_pix–
(
s
, -1, 
comp
, 
has_®pha
, 0, 
begš
 + 
k
 * comp);

519 
h—d”
 = 
	`STBIW_UCHAR
(
Ën
 - 129);

520 
s
->
	`func
(s->
cÚ‹xt
, &
h—d”
, 1);

521 
	`¡biw__wr™e_pix–
(
s
, -1, 
comp
, 
has_®pha
, 0, 
begš
);

527 
	}
}

529 
STBIWDEF
 
	$¡bi_wr™e_tga_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

531 
¡bi__wr™e_cÚ‹xt
 
s
;

532 
	`¡bi__¡¬t_wr™e_ÿÎbacks
(&
s
, 
func
, 
cÚ‹xt
);

533  
	`¡bi_wr™e_tga_cÜe
(&
s
, 
x
, 
y
, 
comp
, (*è
d©a
);

534 
	}
}

536 #iâdeà
STBI_WRITE_NO_STDIO


537 
STBIWDEF
 
	$¡bi_wr™e_tga
(cÚ¡ *
f’ame
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

539 
¡bi__wr™e_cÚ‹xt
 
s
;

540 ià(
	`¡bi__¡¬t_wr™e_fe
(&
s
,
f’ame
)) {

541 
r
 = 
	`¡bi_wr™e_tga_cÜe
(&
s
, 
x
, 
y
, 
comp
, (*è
d©a
);

542 
	`¡bi__’d_wr™e_fe
(&
s
);

543  
r
;

546 
	}
}

553 
	#¡biw__max
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

555 
	$¡biw__lš—r_to_rgbe
(*
rgbe
, *
lš—r
)

557 
expÚ’t
;

558 
maxcomp
 = 
	`¡biw__max
(
lš—r
[0], stbiw__max(linear[1],†inear[2]));

560 ià(
maxcomp
 < 1e-32f) {

561 
rgbe
[0] =„gbe[1] =„gbe[2] =„gbe[3] = 0;

563 
nÜm®ize
 = (è
	`äexp
(
maxcomp
, &
expÚ’t
) * 256.0f/maxcomp;

565 
rgbe
[0] = ()(
lš—r
[0] * 
nÜm®ize
);

566 
rgbe
[1] = ()(
lš—r
[1] * 
nÜm®ize
);

567 
rgbe
[2] = ()(
lš—r
[2] * 
nÜm®ize
);

568 
rgbe
[3] = ()(
expÚ’t
 + 128);

570 
	}
}

572 
	$¡biw__wr™e_run_d©a
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
Ëngth
, 
d©aby‹
)

574 
Ëngthby‹
 = 
	`STBIW_UCHAR
(
Ëngth
+128);

575 
	`STBIW_ASSERT
(
Ëngth
+128 <= 255);

576 
s
->
	`func
(s->
cÚ‹xt
, &
Ëngthby‹
, 1);

577 
s
->
	`func
(s->
cÚ‹xt
, &
d©aby‹
, 1);

578 
	}
}

580 
	$¡biw__wr™e_dump_d©a
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
Ëngth
, *
d©a
)

582 
Ëngthby‹
 = 
	`STBIW_UCHAR
(
Ëngth
);

583 
	`STBIW_ASSERT
(
Ëngth
 <= 128);

584 
s
->
	`func
(s->
cÚ‹xt
, &
Ëngthby‹
, 1);

585 
s
->
	`func
(s->
cÚ‹xt
, 
d©a
, 
Ëngth
);

586 
	}
}

588 
	$¡biw__wr™e_hdr_sÿÆše
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
width
, 
ncomp
, *
sü©ch
, *
sÿÆše
)

590 
sÿÆšeh—d”
[4] = { 2, 2, 0, 0 };

591 
rgbe
[4];

592 
lš—r
[3];

593 
x
;

595 
sÿÆšeh—d”
[2] = (
width
&0xff00)>>8;

596 
sÿÆšeh—d”
[3] = (
width
&0x00ff);

599 ià(
width
 < 8 || width >= 32768) {

600 
x
=0; x < 
width
; x++) {

601 
ncomp
) {

603 3: 
lš—r
[2] = 
sÿÆše
[
x
*
ncomp
 + 2];

604 
lš—r
[1] = 
sÿÆše
[
x
*
ncomp
 + 1];

605 
lš—r
[0] = 
sÿÆše
[
x
*
ncomp
 + 0];

608 
lš—r
[0] =†š—r[1] =†š—r[2] = 
sÿÆše
[
x
*
ncomp
 + 0];

611 
	`¡biw__lš—r_to_rgbe
(
rgbe
, 
lš—r
);

612 
s
->
	`func
(s->
cÚ‹xt
, 
rgbe
, 4);

615 
c
,
r
;

617 
x
=0; x < 
width
; x++) {

618 
ncomp
) {

620 3: 
lš—r
[2] = 
sÿÆše
[
x
*
ncomp
 + 2];

621 
lš—r
[1] = 
sÿÆše
[
x
*
ncomp
 + 1];

622 
lš—r
[0] = 
sÿÆše
[
x
*
ncomp
 + 0];

625 
lš—r
[0] =†š—r[1] =†š—r[2] = 
sÿÆše
[
x
*
ncomp
 + 0];

628 
	`¡biw__lš—r_to_rgbe
(
rgbe
, 
lš—r
);

629 
sü©ch
[
x
 + 
width
*0] = 
rgbe
[0];

630 
sü©ch
[
x
 + 
width
*1] = 
rgbe
[1];

631 
sü©ch
[
x
 + 
width
*2] = 
rgbe
[2];

632 
sü©ch
[
x
 + 
width
*3] = 
rgbe
[3];

635 
s
->
	`func
(s->
cÚ‹xt
, 
sÿÆšeh—d”
, 4);

638 
c
=0; c < 4; c++) {

639 *
comp
 = &
sü©ch
[
width
*
c
];

641 
x
 = 0;

642 
x
 < 
width
) {

644 
r
 = 
x
;

645 
r
+2 < 
width
) {

646 ià(
comp
[
r
] == comp[r+1] && comp[r] == comp[r+2])

648 ++
r
;

650 ià(
r
+2 >ğ
width
)

651 
r
 = 
width
;

653 
x
 < 
r
) {

654 
Ën
 = 
r
-
x
;

655 ià(
Ën
 > 128)†en = 128;

656 
	`¡biw__wr™e_dump_d©a
(
s
, 
Ën
, &
comp
[
x
]);

657 
x
 +ğ
Ën
;

660 ià(
r
+2 < 
width
) {

662 
r
 < 
width
 && 
comp
[r] =ğcomp[
x
])

663 ++
r
;

665 
x
 < 
r
) {

666 
Ën
 = 
r
-
x
;

667 ià(
Ën
 > 127)†en = 127;

668 
	`¡biw__wr™e_run_d©a
(
s
, 
Ën
, 
comp
[
x
]);

669 
x
 +ğ
Ën
;

675 
	}
}

677 
	$¡bi_wr™e_hdr_cÜe
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
x
, 
y
, 
comp
, *
d©a
)

679 ià(
y
 <ğ0 || 
x
 <ğ0 || 
d©a
 =ğ
NULL
)

683 *
sü©ch
 = (*è
	`STBIW_MALLOC
(
x
*4);

684 
i
, 
Ën
;

685 
bufãr
[128];

686 
h—d”
[] = "#?RADIANCE\n# Written by stb_image_write.h\nFORMAT=32-bit_rle_rgbe\n";

687 
s
->
	`func
(s->
cÚ‹xt
, 
h—d”
, (header)-1);

689 #ifdeà
STBI_MSC_SECURE_CRT


690 
Ën
 = 
	`¥rštf_s
(
bufãr
, "EXPOSUREğ 1.0000000000000\n\n-Y %d +X %d\n", 
y
, 
x
);

692 
Ën
 = 
	`¥rštf
(
bufãr
, "EXPOSUREğ 1.0000000000000\n\n-Y %d +X %d\n", 
y
, 
x
);

694 
s
->
	`func
(s->
cÚ‹xt
, 
bufãr
, 
Ën
);

696 
i
=0; i < 
y
; i++)

697 
	`¡biw__wr™e_hdr_sÿÆše
(
s
, 
x
, 
comp
, 
sü©ch
, 
d©a
 + comp*x*(
¡bi__æ_v”tiÿÎy_Ú_wr™e
 ? 
y
-1-
i
 : i)*x);

698 
	`STBIW_FREE
(
sü©ch
);

701 
	}
}

703 
STBIWDEF
 
	$¡bi_wr™e_hdr_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

705 
¡bi__wr™e_cÚ‹xt
 
s
;

706 
	`¡bi__¡¬t_wr™e_ÿÎbacks
(&
s
, 
func
, 
cÚ‹xt
);

707  
	`¡bi_wr™e_hdr_cÜe
(&
s
, 
x
, 
y
, 
comp
, (*è
d©a
);

708 
	}
}

710 #iâdeà
STBI_WRITE_NO_STDIO


711 
STBIWDEF
 
	$¡bi_wr™e_hdr
(cÚ¡ *
f’ame
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
)

713 
¡bi__wr™e_cÚ‹xt
 
s
;

714 ià(
	`¡bi__¡¬t_wr™e_fe
(&
s
,
f’ame
)) {

715 
r
 = 
	`¡bi_wr™e_hdr_cÜe
(&
s
, 
x
, 
y
, 
comp
, (*è
d©a
);

716 
	`¡bi__’d_wr™e_fe
(&
s
);

717  
r
;

720 
	}
}

729 #iâdeà
STBIW_ZLIB_COMPRESS


731 
	#¡biw__sb¿w
(
a
è((*è×è- 2)

	)

732 
	#¡biw__sbm
(
a
è
	`¡biw__sb¿w
×)[0]

	)

733 
	#¡biw__sbn
(
a
è
	`¡biw__sb¿w
×)[1]

	)

735 
	#¡biw__sbÃedgrow
(
a
,
n
è(×)==0 || 
	`¡biw__sbn
×)+À>ğ
	`¡biw__sbm
×))

	)

736 
	#¡biw__sbmaybegrow
(
a
,
n
è(
	`¡biw__sbÃedgrow
×,Ò)è? 
	`¡biw__sbgrow
×,nè: 0)

	)

737 
	#¡biw__sbgrow
(
a
,
n
è
	`¡biw__sbgrowf
((**è&×), (n), (*×)))

	)

739 
	#¡biw__sbpush
(
a
, 
v
è(
	`¡biw__sbmaybegrow
×,1), (a)[
	`¡biw__sbn
×)++] = (v))

	)

740 
	#¡biw__sbcouÁ
(
a
è(×è? 
	`¡biw__sbn
×è: 0)

	)

741 
	#¡biw__sbä“
(
a
è(×è? 
	`STBIW_FREE
(
	`¡biw__sb¿w
×)),0 : 0)

	)

743 *
	$¡biw__sbgrowf
(**
¬r
, 
šüem’t
, 
™emsize
)

745 
m
 = *
¬r
 ? 2*
	`¡biw__sbm
(*¬r)+
šüem’t
 : increment+1;

746 *
p
 = 
	`STBIW_REALLOC_SIZED
(*
¬r
 ? 
	`¡biw__sb¿w
(*¬rè: 0, *¬¸? (
	`¡biw__sbm
(*¬r)*
™emsize
 + ()*2è: 0, i‹msiz* 
m
 + ()*2);

747 
	`STBIW_ASSERT
(
p
);

748 ià(
p
) {

749 ià(!*
¬r
è((*è
p
)[1] = 0;

750 *
¬r
 = (*è((*è
p
 + 2);

751 
	`¡biw__sbm
(*
¬r
èğ
m
;

753  *
¬r
;

754 
	}
}

756 *
	$¡biw__zlib_æushf
(*
d©a
, *
b™bufãr
, *
b™couÁ
)

758 *
b™couÁ
 >= 8) {

759 
	`¡biw__sbpush
(
d©a
, 
	`STBIW_UCHAR
(*
b™bufãr
));

760 *
b™bufãr
 >>= 8;

761 *
b™couÁ
 -= 8;

763  
d©a
;

764 
	}
}

766 
	$¡biw__zlib_b™»v
(
code
, 
codeb™s
)

768 
»s
=0;

769 
codeb™s
--) {

770 
»s
 = (» << 1è| (
code
 & 1);

771 
code
 >>= 1;

773  
»s
;

774 
	}
}

776 
	$¡biw__zlib_couÁm
(*
a
, *
b
, 
lim™
)

778 
i
;

779 
i
=0; i < 
lim™
 && i < 258; ++i)

780 ià(
a
[
i
] !ğ
b
[i]) ;

781  
i
;

782 
	}
}

784 
	$¡biw__zhash
(*
d©a
)

786 
¡biw_ušt32
 
hash
 = 
d©a
[0] + (data[1] << 8) + (data[2] << 16);

787 
hash
 ^= hash << 3;

788 
hash
 += hash >> 5;

789 
hash
 ^= hash << 4;

790 
hash
 += hash >> 17;

791 
hash
 ^= hash << 25;

792 
hash
 += hash >> 6;

793  
hash
;

794 
	}
}

796 
	#¡biw__zlib_æush
(è(
out
 = 
	`¡biw__zlib_æushf
(out, &
b™buf
, &
b™couÁ
))

	)

797 
	#¡biw__zlib_add
(
code
,
codeb™s
) \

798 (
b™buf
 |ğ(
code
è<< 
b™couÁ
, b™couÁ +ğ(
codeb™s
), 
	`¡biw__zlib_æush
())

	)

799 
	#¡biw__zlib_hufç
(
b
,
c
è
	`¡biw__zlib_add
(
	`¡biw__zlib_b™»v
(b,c),c)

	)

801 
	#¡biw__zlib_huff1
(
n
è
	`¡biw__zlib_hufç
(0x30 + (n), 8)

	)

802 
	#¡biw__zlib_huff2
(
n
è
	`¡biw__zlib_hufç
(0x190 + (n)-144, 9)

	)

803 
	#¡biw__zlib_huff3
(
n
è
	`¡biw__zlib_hufç
(0 + (n)-256,7)

	)

804 
	#¡biw__zlib_huff4
(
n
è
	`¡biw__zlib_hufç
(0xc0 + (n)-280,8)

	)

805 
	#¡biw__zlib_huff
(
n
è(Òè<ğ143 ? 
	`¡biw__zlib_huff1
Òè: (nè<ğ255 ? 
	`¡biw__zlib_huff2
Òè: (nè<ğ279 ? 
	`¡biw__zlib_huff3
Òè: 
	`¡biw__zlib_huff4
Ò))

	)

806 
	#¡biw__zlib_huffb
(
n
è(Òè<ğ143 ? 
	`¡biw__zlib_huff1
Òè: 
	`¡biw__zlib_huff2
Ò))

	)

808 
	#¡biw__ZHASH
 16384

	)

812 * 
	$¡bi_zlib_com´ess
(*
d©a
, 
d©a_Ën
, *
out_Ën
, 
qu®™y
)

814 #ifdeà
STBIW_ZLIB_COMPRESS


816  
	`STBIW_ZLIB_COMPRESS
(
d©a
, 
d©a_Ën
, 
out_Ën
, 
qu®™y
);

818 
Ëngthc
[] = { 3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258, 259 };

819 
Ëngtheb
[]= { 0,0,0,0,0,0,0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0 };

820 
di¡c
[] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577, 32768 };

821 
di¡eb
[] = { 0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13 };

822 
b™buf
=0;

823 
i
,
j
, 
b™couÁ
=0;

824 *
out
 = 
NULL
;

825 ***
hash_bË
 = (***è
	`STBIW_MALLOC
(
¡biw__ZHASH
 * (**));

826 ià(
hash_bË
 =ğ
NULL
)

827  
NULL
;

828 ià(
qu®™y
 < 5) quality = 5;

830 
	`¡biw__sbpush
(
out
, 0x78);

831 
	`¡biw__sbpush
(
out
, 0x5e);

832 
	`¡biw__zlib_add
(1,1);

833 
	`¡biw__zlib_add
(1,2);

835 
i
=0; i < 
¡biw__ZHASH
; ++i)

836 
hash_bË
[
i
] = 
NULL
;

838 
i
=0;

839 
i
 < 
d©a_Ën
-3) {

841 
h
 = 
	`¡biw__zhash
(
d©a
+
i
)&(
¡biw__ZHASH
-1), 
be¡
=3;

842 *
be¡loc
 = 0;

843 **
hli¡
 = 
hash_bË
[
h
];

844 
n
 = 
	`¡biw__sbcouÁ
(
hli¡
);

845 
j
=0; j < 
n
; ++j) {

846 ià(
hli¡
[
j
]-
d©a
 > 
i
-32768) {

847 
d
 = 
	`¡biw__zlib_couÁm
(
hli¡
[
j
], 
d©a
+
i
, 
d©a_Ën
-i);

848 ià(
d
 >ğ
be¡
èbe¡=d,
be¡loc
=
hli¡
[
j
];

852 ià(
hash_bË
[
h
] && 
	`¡biw__sbn
(hash_bË[h]è=ğ2*
qu®™y
) {

853 
	`STBIW_MEMMOVE
(
hash_bË
[
h
], hash_bË[h]+
qu®™y
, (hash_table[h][0])*quality);

854 
	`¡biw__sbn
(
hash_bË
[
h
]èğ
qu®™y
;

856 
	`¡biw__sbpush
(
hash_bË
[
h
],
d©a
+
i
);

858 ià(
be¡loc
) {

860 
h
 = 
	`¡biw__zhash
(
d©a
+
i
+1)&(
¡biw__ZHASH
-1);

861 
hli¡
 = 
hash_bË
[
h
];

862 
n
 = 
	`¡biw__sbcouÁ
(
hli¡
);

863 
j
=0; j < 
n
; ++j) {

864 ià(
hli¡
[
j
]-
d©a
 > 
i
-32767) {

865 
e
 = 
	`¡biw__zlib_couÁm
(
hli¡
[
j
], 
d©a
+
i
+1, 
d©a_Ën
-i-1);

866 ià(
e
 > 
be¡
) {

867 
be¡loc
 = 
NULL
;

874 ià(
be¡loc
) {

875 
d
 = (è(
d©a
+
i
 - 
be¡loc
);

876 
	`STBIW_ASSERT
(
d
 <ğ32767 && 
be¡
 <= 258);

877 
j
=0; 
be¡
 > 
Ëngthc
[j+1]-1; ++j);

878 
	`¡biw__zlib_huff
(
j
+257);

879 ià(
Ëngtheb
[
j
]è
	`¡biw__zlib_add
(
be¡
 - 
Ëngthc
[j],†engtheb[j]);

880 
j
=0; 
d
 > 
di¡c
[j+1]-1; ++j);

881 
	`¡biw__zlib_add
(
	`¡biw__zlib_b™»v
(
j
,5),5);

882 ià(
di¡eb
[
j
]è
	`¡biw__zlib_add
(
d
 - 
di¡c
[j], disteb[j]);

883 
i
 +ğ
be¡
;

885 
	`¡biw__zlib_huffb
(
d©a
[
i
]);

886 ++
i
;

890 ;
i
 < 
d©a_Ën
; ++i)

891 
	`¡biw__zlib_huffb
(
d©a
[
i
]);

892 
	`¡biw__zlib_huff
(256);

894 
b™couÁ
)

895 
	`¡biw__zlib_add
(0,1);

897 
i
=0; i < 
¡biw__ZHASH
; ++i)

898 (è
	`¡biw__sbä“
(
hash_bË
[
i
]);

899 
	`STBIW_FREE
(
hash_bË
);

903 
s1
=1, 
s2
=0;

904 
blockËn
 = (è(
d©a_Ën
 % 5552);

905 
j
=0;

906 
j
 < 
d©a_Ën
) {

907 
i
=0; i < 
blockËn
; ++iè
s1
 +ğ
d©a
[
j
+i], 
s2
 += s1;

908 
s1
 %ğ65521, 
s2
 %= 65521;

909 
j
 +ğ
blockËn
;

910 
blockËn
 = 5552;

912 
	`¡biw__sbpush
(
out
, 
	`STBIW_UCHAR
(
s2
 >> 8));

913 
	`¡biw__sbpush
(
out
, 
	`STBIW_UCHAR
(
s2
));

914 
	`¡biw__sbpush
(
out
, 
	`STBIW_UCHAR
(
s1
 >> 8));

915 
	`¡biw__sbpush
(
out
, 
	`STBIW_UCHAR
(
s1
));

917 *
out_Ën
 = 
	`¡biw__sbn
(
out
);

919 
	`STBIW_MEMMOVE
(
	`¡biw__sb¿w
(
out
), out, *
out_Ën
);

920  (*è
	`¡biw__sb¿w
(
out
);

922 
	}
}

924 
	$¡biw__üc32
(*
bufãr
, 
Ën
)

926 
üc_bË
[256] =

962 
üc
 = ~0u;

963 
i
;

964 
i
=0; i < 
Ën
; ++i)

965 
üc
 = (üø>> 8è^ 
üc_bË
[
bufãr
[
i
] ^ (crc & 0xff)];

966  ~
üc
;

967 
	}
}

969 
	#¡biw__w²g4
(
o
,
a
,
b
,
c
,
d
è((o)[0]=
	`STBIW_UCHAR
×),(o)[1]=STBIW_UCHAR(b),(o)[2]=STBIW_UCHAR(c),(o)[3]=STBIW_UCHAR(d),(o)+=4)

	)

970 
	#¡biw__wp32
(
d©a
,
v
è
	`¡biw__w²g4
(d©a, (v)>>24,(v)>>16,(v)>>8,(v));

	)

971 
	#¡biw__w±ag
(
d©a
,
s
è
	`¡biw__w²g4
(d©a, s[0],s[1],s[2],s[3])

	)

973 
	$¡biw__wpüc
(**
d©a
, 
Ën
)

975 
üc
 = 
	`¡biw__üc32
(*
d©a
 - 
Ën
 - 4,†en+4);

976 
	`¡biw__wp32
(*
d©a
, 
üc
);

977 
	}
}

979 
	$¡biw__·‘h
(
a
, 
b
, 
c
)

981 
p
 = 
a
 + 
b
 - 
c
, 
·
 = 
	`abs
Õ-a), 
pb
 =‡bsÕ-b), 
pc
 =‡bs(p-c);

982 ià(
·
 <ğ
pb
 &&…¨<ğ
pc
è 
	`STBIW_UCHAR
(
a
);

983 ià(
pb
 <ğ
pc
è 
	`STBIW_UCHAR
(
b
);

984  
	`STBIW_UCHAR
(
c
);

985 
	}
}

988 
	$¡biw__’code_²g_lše
(*
pix–s
, 
¡ride_by‹s
, 
width
, 
height
, 
y
, 
n
, 
f‹r_ty³
, sigÃd *
lše_bufãr
)

990 
m­pšg
[] = { 0,1,2,3,4 };

991 
fœ¡m­
[] = { 0,1,0,5,6 };

992 *
mym­
 = (
y
 !ğ0è? 
m­pšg
 : 
fœ¡m­
;

993 
i
;

994 
ty³
 = 
mym­
[
f‹r_ty³
];

995 *
z
 = 
pix–s
 + 
¡ride_by‹s
 * (
¡bi__æ_v”tiÿÎy_Ú_wr™e
 ? 
height
-1-
y
 : y);

996 
sigÃd_¡ride
 = 
¡bi__æ_v”tiÿÎy_Ú_wr™e
 ? -
¡ride_by‹s
 : stride_bytes;

997 
i
 = 0; i < 
n
; ++i) {

998 
ty³
) {

999 0: 
lše_bufãr
[
i
] = 
z
[i]; ;

1000 1: 
lše_bufãr
[
i
] = 
z
[i]; ;

1001 2: 
lše_bufãr
[
i
] = 
z
[i] - z[i-
sigÃd_¡ride
]; ;

1002 3: 
lše_bufãr
[
i
] = 
z
[i] - (z[i-
sigÃd_¡ride
]>>1); ;

1003 4: 
lše_bufãr
[
i
] = (sigÃd è(
z
[i] - 
	`¡biw__·‘h
(0,z[i-
sigÃd_¡ride
],0)); ;

1004 5: 
lše_bufãr
[
i
] = 
z
[i]; ;

1005 6: 
lše_bufãr
[
i
] = 
z
[i]; ;

1008 
i
=
n
; i < 
width
*n; ++i) {

1009 
ty³
) {

1010 0: 
lše_bufãr
[
i
] = 
z
[i]; ;

1011 1: 
lše_bufãr
[
i
] = 
z
[i] - z[i-
n
]; ;

1012 2: 
lše_bufãr
[
i
] = 
z
[i] - z[i-
sigÃd_¡ride
]; ;

1013 3: 
lše_bufãr
[
i
] = 
z
[i] - ((z[i-
n
] + z[i-
sigÃd_¡ride
])>>1); ;

1014 4: 
lše_bufãr
[
i
] = 
z
[i] - 
	`¡biw__·‘h
(z[i-
n
], z[i-
sigÃd_¡ride
], z[i-signed_stride-n]); ;

1015 5: 
lše_bufãr
[
i
] = 
z
[i] - (z[i-
n
]>>1); ;

1016 6: 
lše_bufãr
[
i
] = 
z
[i] - 
	`¡biw__·‘h
(z[i-
n
], 0,0); ;

1019 
	}
}

1021 *
	$¡bi_wr™e_²g_to_mem
(*
pix–s
, 
¡ride_by‹s
, 
x
, 
y
, 
n
, *
out_Ën
)

1023 
fÜû_f‹r
 = 
¡bi_wr™e_fÜû_²g_f‹r
;

1024 
ùy³
[5] = { -1, 0, 4, 2, 6 };

1025 
sig
[8] = { 137,80,78,71,13,10,26,10 };

1026 *
out
,*
o
, *
ft
, *
zlib
;

1027 sigÃd *
lše_bufãr
;

1028 
j
,
zËn
;

1030 ià(
¡ride_by‹s
 == 0)

1031 
¡ride_by‹s
 = 
x
 * 
n
;

1033 ià(
fÜû_f‹r
 >= 5) {

1034 
fÜû_f‹r
 = -1;

1037 
ft
 = (*è
	`STBIW_MALLOC
((
x
*
n
+1è* 
y
); if (!filt)  0;

1038 
lše_bufãr
 = (sigÃd *è
	`STBIW_MALLOC
(
x
 * 
n
); ià(!lše_bufãrè{ 
	`STBIW_FREE
(
ft
);  0; }

1039 
j
=0; j < 
y
; ++j) {

1040 
f‹r_ty³
;

1041 ià(
fÜû_f‹r
 > -1) {

1042 
f‹r_ty³
 = 
fÜû_f‹r
;

1043 
	`¡biw__’code_²g_lše
(
pix–s
, 
¡ride_by‹s
, 
x
, 
y
, 
j
, 
n
, 
fÜû_f‹r
, 
lše_bufãr
);

1045 
be¡_f‹r
 = 0, 
be¡_f‹r_v®
 = 0x7fffffff, 
e¡
, 
i
;

1046 
f‹r_ty³
 = 0; filter_type < 5; filter_type++) {

1047 
	`¡biw__’code_²g_lše
(
pix–s
, 
¡ride_by‹s
, 
x
, 
y
, 
j
, 
n
, 
f‹r_ty³
, 
lše_bufãr
);

1050 
e¡
 = 0;

1051 
i
 = 0; i < 
x
*
n
; ++i) {

1052 
e¡
 +ğ
	`abs
((sigÃd è
lše_bufãr
[
i
]);

1054 ià(
e¡
 < 
be¡_f‹r_v®
) {

1055 
be¡_f‹r_v®
 = 
e¡
;

1056 
be¡_f‹r
 = 
f‹r_ty³
;

1059 ià(
f‹r_ty³
 !ğ
be¡_f‹r
) {

1060 
	`¡biw__’code_²g_lše
(
pix–s
, 
¡ride_by‹s
, 
x
, 
y
, 
j
, 
n
, 
be¡_f‹r
, 
lše_bufãr
);

1061 
f‹r_ty³
 = 
be¡_f‹r
;

1065 
ft
[
j
*(
x
*
n
+1)] = (è
f‹r_ty³
;

1066 
	`STBIW_MEMMOVE
(
ft
+
j
*(
x
*
n
+1)+1, 
lše_bufãr
, x*n);

1068 
	`STBIW_FREE
(
lše_bufãr
);

1069 
zlib
 = 
	`¡bi_zlib_com´ess
(
ft
, 
y
*Ğ
x
*
n
+1), &
zËn
, 
¡bi_wr™e_²g_com´essiÚ_Ëv–
);

1070 
	`STBIW_FREE
(
ft
);

1071 ià(!
zlib
)  0;

1074 
out
 = (*è
	`STBIW_MALLOC
(8 + 12+13 + 12+
zËn
 + 12);

1075 ià(!
out
)  0;

1076 *
out_Ën
 = 8 + 12+13 + 12+
zËn
 + 12;

1078 
o
=
out
;

1079 
	`STBIW_MEMMOVE
(
o
,
sig
,8); o+= 8;

1080 
	`¡biw__wp32
(
o
, 13);

1081 
	`¡biw__w±ag
(
o
, "IHDR");

1082 
	`¡biw__wp32
(
o
, 
x
);

1083 
	`¡biw__wp32
(
o
, 
y
);

1084 *
o
++ = 8;

1085 *
o
++ = 
	`STBIW_UCHAR
(
ùy³
[
n
]);

1086 *
o
++ = 0;

1087 *
o
++ = 0;

1088 *
o
++ = 0;

1089 
	`¡biw__wpüc
(&
o
,13);

1091 
	`¡biw__wp32
(
o
, 
zËn
);

1092 
	`¡biw__w±ag
(
o
, "IDAT");

1093 
	`STBIW_MEMMOVE
(
o
, 
zlib
, 
zËn
);

1094 
o
 +ğ
zËn
;

1095 
	`STBIW_FREE
(
zlib
);

1096 
	`¡biw__wpüc
(&
o
, 
zËn
);

1098 
	`¡biw__wp32
(
o
,0);

1099 
	`¡biw__w±ag
(
o
, "IEND");

1100 
	`¡biw__wpüc
(&
o
,0);

1102 
	`STBIW_ASSERT
(
o
 =ğ
out
 + *
out_Ën
);

1104  
out
;

1105 
	}
}

1107 #iâdeà
STBI_WRITE_NO_STDIO


1108 
STBIWDEF
 
	$¡bi_wr™e_²g
(cÚ¡ *
f’ame
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
, 
¡ride_by‹s
)

1110 
FILE
 *
f
;

1111 
Ën
;

1112 *
²g
 = 
	`¡bi_wr™e_²g_to_mem
((*è
d©a
, 
¡ride_by‹s
, 
x
, 
y
, 
comp
, &
Ën
);

1113 ià(
²g
 =ğ
NULL
)  0;

1114 #ifdeà
STBI_MSC_SECURE_CRT


1115 ià(
	`fİ’_s
(&
f
, 
f’ame
, "wb"))

1116 
f
 = 
NULL
;

1118 
f
 = 
	`fİ’
(
f’ame
, "wb");

1120 ià(!
f
è{ 
	`STBIW_FREE
(
²g
);  0; }

1121 
	`fwr™e
(
²g
, 1, 
Ën
, 
f
);

1122 
	`fşo£
(
f
);

1123 
	`STBIW_FREE
(
²g
);

1125 
	}
}

1128 
STBIWDEF
 
	$¡bi_wr™e_²g_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
, 
¡ride_by‹s
)

1130 
Ën
;

1131 *
²g
 = 
	`¡bi_wr™e_²g_to_mem
((*è
d©a
, 
¡ride_by‹s
, 
x
, 
y
, 
comp
, &
Ën
);

1132 ià(
²g
 =ğ
NULL
)  0;

1133 
	`func
(
cÚ‹xt
, 
²g
, 
Ën
);

1134 
	`STBIW_FREE
(
²g
);

1136 
	}
}

1147 cÚ¡ 
	g¡biw__jpg_ZigZag
[] = { 0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,

1150 
	$¡biw__jpg_wr™eB™s
(
¡bi__wr™e_cÚ‹xt
 *
s
, *
b™BufP
, *
b™CÁP
, cÚ¡ *
bs
) {

1151 
b™Buf
 = *
b™BufP
, 
b™CÁ
 = *
b™CÁP
;

1152 
b™CÁ
 +ğ
bs
[1];

1153 
b™Buf
 |ğ
bs
[0] << (24 - 
b™CÁ
);

1154 
b™CÁ
 >= 8) {

1155 
c
 = (
b™Buf
 >> 16) & 255;

1156 
	`¡biw__putc
(
s
, 
c
);

1157 if(
c
 == 255) {

1158 
	`¡biw__putc
(
s
, 0);

1160 
b™Buf
 <<= 8;

1161 
b™CÁ
 -= 8;

1163 *
b™BufP
 = 
b™Buf
;

1164 *
b™CÁP
 = 
b™CÁ
;

1165 
	}
}

1167 
	$¡biw__jpg_DCT
(*
d0p
, *
d1p
, *
d2p
, *
d3p
, *
d4p
, *
d5p
, *
d6p
, *
d7p
) {

1168 
d0
 = *
d0p
, 
d1
 = *
d1p
, 
d2
 = *
d2p
, 
d3
 = *
d3p
, 
d4
 = *
d4p
, 
d5
 = *
d5p
, 
d6
 = *
d6p
, 
d7
 = *
d7p
;

1169 
z1
, 
z2
, 
z3
, 
z4
, 
z5
, 
z11
, 
z13
;

1171 
tmp0
 = 
d0
 + 
d7
;

1172 
tmp7
 = 
d0
 - 
d7
;

1173 
tmp1
 = 
d1
 + 
d6
;

1174 
tmp6
 = 
d1
 - 
d6
;

1175 
tmp2
 = 
d2
 + 
d5
;

1176 
tmp5
 = 
d2
 - 
d5
;

1177 
tmp3
 = 
d3
 + 
d4
;

1178 
tmp4
 = 
d3
 - 
d4
;

1181 
tmp10
 = 
tmp0
 + 
tmp3
;

1182 
tmp13
 = 
tmp0
 - 
tmp3
;

1183 
tmp11
 = 
tmp1
 + 
tmp2
;

1184 
tmp12
 = 
tmp1
 - 
tmp2
;

1186 
d0
 = 
tmp10
 + 
tmp11
;

1187 
d4
 = 
tmp10
 - 
tmp11
;

1189 
z1
 = (
tmp12
 + 
tmp13
) * 0.707106781f;

1190 
d2
 = 
tmp13
 + 
z1
;

1191 
d6
 = 
tmp13
 - 
z1
;

1194 
tmp10
 = 
tmp4
 + 
tmp5
;

1195 
tmp11
 = 
tmp5
 + 
tmp6
;

1196 
tmp12
 = 
tmp6
 + 
tmp7
;

1199 
z5
 = (
tmp10
 - 
tmp12
) * 0.382683433f;

1200 
z2
 = 
tmp10
 * 0.541196100à+ 
z5
;

1201 
z4
 = 
tmp12
 * 1.306562965à+ 
z5
;

1202 
z3
 = 
tmp11
 * 0.707106781f;

1204 
z11
 = 
tmp7
 + 
z3
;

1205 
z13
 = 
tmp7
 - 
z3
;

1207 *
d5p
 = 
z13
 + 
z2
;

1208 *
d3p
 = 
z13
 - 
z2
;

1209 *
d1p
 = 
z11
 + 
z4
;

1210 *
d7p
 = 
z11
 - 
z4
;

1212 *
d0p
 = 
d0
; *
d2p
 = 
d2
; *
d4p
 = 
d4
; *
d6p
 = 
d6
;

1213 
	}
}

1215 
	$¡biw__jpg_ÿlcB™s
(
v®
, 
b™s
[2]) {

1216 
tmp1
 = 
v®
 < 0 ? -val : val;

1217 
v®
 = val < 0 ? val-1 : val;

1218 
b™s
[1] = 1;

1219 
tmp1
 >>= 1) {

1220 ++
b™s
[1];

1222 
b™s
[0] = 
v®
 & ((1<<bits[1])-1);

1223 
	}
}

1225 
	$¡biw__jpg_´oûssDU
(
¡bi__wr™e_cÚ‹xt
 *
s
, *
b™Buf
, *
b™CÁ
, *
CDU
, *
fdtbl
, 
DC
, cÚ¡ 
HTDC
[256][2], cÚ¡ 
HTAC
[256][2]) {

1226 cÚ¡ 
EOB
[2] = { 
HTAC
[0x00][0], HTAC[0x00][1] };

1227 cÚ¡ 
M16z”Ûs
[2] = { 
HTAC
[0xF0][0], HTAC[0xF0][1] };

1228 
d©aOff
, 
i
, 
diff
, 
’d0pos
;

1229 
DU
[64];

1232 
d©aOff
=0; dataOff<64; dataOff+=8) {

1233 
	`¡biw__jpg_DCT
(&
CDU
[
d©aOff
], &CDU[dataOff+1], &CDU[dataOff+2], &CDU[dataOff+3], &CDU[dataOff+4], &CDU[dataOff+5], &CDU[dataOff+6], &CDU[dataOff+7]);

1236 
d©aOff
=0; dataOff<8; ++dataOff) {

1237 
	`¡biw__jpg_DCT
(&
CDU
[
d©aOff
], &CDU[dataOff+8], &CDU[dataOff+16], &CDU[dataOff+24], &CDU[dataOff+32], &CDU[dataOff+40], &CDU[dataOff+48], &CDU[dataOff+56]);

1240 
i
=0; i<64; ++i) {

1241 
v
 = 
CDU
[
i
]*
fdtbl
[i];

1244 
DU
[
¡biw__jpg_ZigZag
[
i
]] = ()(
v
 < 0 ? v - 0.5f : v + 0.5f);

1248 
diff
 = 
DU
[0] - 
DC
;

1249 ià(
diff
 == 0) {

1250 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
HTDC
[0]);

1252 
b™s
[2];

1253 
	`¡biw__jpg_ÿlcB™s
(
diff
, 
b™s
);

1254 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
HTDC
[
b™s
[1]]);

1255 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
b™s
);

1258 
’d0pos
 = 63;

1259 ; (
’d0pos
>0)&&(
DU
[end0pos]==0); --end0pos) {

1262 if(
’d0pos
 == 0) {

1263 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
EOB
);

1264  
DU
[0];

1266 
i
 = 1; i <ğ
’d0pos
; ++i) {

1267 
¡¬os
 = 
i
;

1268 
Äz”Ûs
;

1269 
b™s
[2];

1270 ; 
DU
[
i
]==0 && i<=
’d0pos
; ++i) {

1272 
Äz”Ûs
 = 
i
-
¡¬os
;

1273 iàĞ
Äz”Ûs
 >= 16 ) {

1274 
Êg
 = 
Äz”Ûs
>>4;

1275 
Äm¬k”
;

1276 
Äm¬k”
=1;‚rm¬k” <ğ
Êg
; ++nrmarker)

1277 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
M16z”Ûs
);

1278 
Äz”Ûs
 &= 15;

1280 
	`¡biw__jpg_ÿlcB™s
(
DU
[
i
], 
b™s
);

1281 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
HTAC
[(
Äz”Ûs
<<4)+
b™s
[1]]);

1282 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
b™s
);

1284 if(
’d0pos
 != 63) {

1285 
	`¡biw__jpg_wr™eB™s
(
s
, 
b™Buf
, 
b™CÁ
, 
EOB
);

1287  
DU
[0];

1288 
	}
}

1290 
	$¡bi_wr™e_jpg_cÜe
(
¡bi__wr™e_cÚ‹xt
 *
s
, 
width
, 
height
, 
comp
, cÚ¡ * 
d©a
, 
qu®™y
) {

1292 cÚ¡ 
¡d_dc_lumšªû_Äcodes
[] = {0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0};

1293 cÚ¡ 
¡d_dc_lumšªû_v®ues
[] = {0,1,2,3,4,5,6,7,8,9,10,11};

1294 cÚ¡ 
¡d_ac_lumšªû_Äcodes
[] = {0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d};

1295 cÚ¡ 
¡d_ac_lumšªû_v®ues
[] = {

1304 cÚ¡ 
¡d_dc_chromšªû_Äcodes
[] = {0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0};

1305 cÚ¡ 
¡d_dc_chromšªû_v®ues
[] = {0,1,2,3,4,5,6,7,8,9,10,11};

1306 cÚ¡ 
¡d_ac_chromšªû_Äcodes
[] = {0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77};

1307 cÚ¡ 
¡d_ac_chromšªû_v®ues
[] = {

1317 cÚ¡ 
YDC_HT
[256][2] = { {0,2},{2,3},{3,3},{4,3},{5,3},{6,3},{14,4},{30,5},{62,6},{126,7},{254,8},{510,9}};

1318 cÚ¡ 
UVDC_HT
[256][2] = { {0,2},{1,2},{2,2},{6,3},{14,4},{30,5},{62,6},{126,7},{254,8},{510,9},{1022,10},{2046,11}};

1319 cÚ¡ 
YAC_HT
[256][2] = {

1337 cÚ¡ 
UVAC_HT
[256][2] = {

1355 cÚ¡ 
YQT
[] = {16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,

1357 cÚ¡ 
UVQT
[] = {17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,

1359 cÚ¡ 
¯sf
[] = { 1.0f * 2.828427125f, 1.387039845f * 2.828427125f, 1.306562965f * 2.828427125f, 1.175875602f * 2.828427125f,

1362 
row
, 
cŞ
, 
i
, 
k
;

1363 
fdtbl_Y
[64], 
fdtbl_UV
[64];

1364 
YTabË
[64], 
UVTabË
[64];

1366 if(!
d©a
 || !
width
 || !
height
 || 
comp
 > 4 || comp < 1) {

1370 
qu®™y
 = quality ? quality : 90;

1371 
qu®™y
 = quality < 1 ? 1 : quality > 100 ? 100 : quality;

1372 
qu®™y
 = quality < 50 ? 5000 / quality : 200 - quality * 2;

1374 
i
 = 0; i < 64; ++i) {

1375 
uvti
, 
yti
 = (
YQT
[
i
]*
qu®™y
+50)/100;

1376 
YTabË
[
¡biw__jpg_ZigZag
[
i
]] = (è(
yti
 < 1 ? 1 : yti > 255 ? 255 : yti);

1377 
uvti
 = (
UVQT
[
i
]*
qu®™y
+50)/100;

1378 
UVTabË
[
¡biw__jpg_ZigZag
[
i
]] = (è(
uvti
 < 1 ? 1 : uvti > 255 ? 255 : uvti);

1381 
row
 = 0, 
k
 = 0;„ow < 8; ++row) {

1382 
cŞ
 = 0; cŞ < 8; ++cŞ, ++
k
) {

1383 
fdtbl_Y
[
k
] = 1 / (
YTabË
 [
¡biw__jpg_ZigZag
[k]] * 
¯sf
[
row
] *‡asf[
cŞ
]);

1384 
fdtbl_UV
[
k
] = 1 / (
UVTabË
[
¡biw__jpg_ZigZag
[k]] * 
¯sf
[
row
] *‡asf[
cŞ
]);

1390 cÚ¡ 
h—d0
[] = { 0xFF,0xD8,0xFF,0xE0,0,0x10,'J','F','I','F',0,1,1,0,0,1,0,1,0,0,0xFF,0xDB,0,0x84,0 };

1391 cÚ¡ 
h—d2
[] = { 0xFF,0xDA,0,0xC,3,1,0,2,0x11,3,0x11,0,0x3F,0 };

1392 cÚ¡ 
h—d1
[] = { 0xFF,0xC0,0,0x11,8,()(
height
>>8),
	`STBIW_UCHAR
(height),()(
width
>>8),STBIW_UCHAR(width),

1394 
s
->
	`func
(s->
cÚ‹xt
, (*)
h—d0
, (head0));

1395 
s
->
	`func
(s->
cÚ‹xt
, (*)
YTabË
, (YTable));

1396 
	`¡biw__putc
(
s
, 1);

1397 
s
->
	`func
(s->
cÚ‹xt
, 
UVTabË
, (UVTable));

1398 
s
->
	`func
(s->
cÚ‹xt
, (*)
h—d1
, (head1));

1399 
s
->
	`func
(s->
cÚ‹xt
, (*)(
¡d_dc_lumšªû_Äcodes
+1), (std_dc_luminance_nrcodes)-1);

1400 
s
->
	`func
(s->
cÚ‹xt
, (*)
¡d_dc_lumšªû_v®ues
, (std_dc_luminance_values));

1401 
	`¡biw__putc
(
s
, 0x10);

1402 
s
->
	`func
(s->
cÚ‹xt
, (*)(
¡d_ac_lumšªû_Äcodes
+1), (std_ac_luminance_nrcodes)-1);

1403 
s
->
	`func
(s->
cÚ‹xt
, (*)
¡d_ac_lumšªû_v®ues
, (std_ac_luminance_values));

1404 
	`¡biw__putc
(
s
, 1);

1405 
s
->
	`func
(s->
cÚ‹xt
, (*)(
¡d_dc_chromšªû_Äcodes
+1), (std_dc_chrominance_nrcodes)-1);

1406 
s
->
	`func
(s->
cÚ‹xt
, (*)
¡d_dc_chromšªû_v®ues
, (std_dc_chrominance_values));

1407 
	`¡biw__putc
(
s
, 0x11);

1408 
s
->
	`func
(s->
cÚ‹xt
, (*)(
¡d_ac_chromšªû_Äcodes
+1), (std_ac_chrominance_nrcodes)-1);

1409 
s
->
	`func
(s->
cÚ‹xt
, (*)
¡d_ac_chromšªû_v®ues
, (std_ac_chrominance_values));

1410 
s
->
	`func
(s->
cÚ‹xt
, (*)
h—d2
, (head2));

1415 cÚ¡ 
flB™s
[] = {0x7F, 7};

1416 cÚ¡ *
imageD©a
 = (cÚ¡ *)
d©a
;

1417 
DCY
=0, 
DCU
=0, 
DCV
=0;

1418 
b™Buf
=0, 
b™CÁ
=0;

1420 
ofsG
 = 
comp
 > 2 ? 1 : 0, 
ofsB
 = comp > 2 ? 2 : 0;

1421 
x
, 
y
, 
pos
;

1422 
y
 = 0; y < 
height
; y += 8) {

1423 
x
 = 0; x < 
width
; x += 8) {

1424 
YDU
[64], 
UDU
[64], 
VDU
[64];

1425 
row
 = 
y
, 
pos
 = 0;„ow < y+8; ++row) {

1426 
cŞ
 = 
x
; cŞ < x+8; ++cŞ, ++
pos
) {

1427 
p
 = (
¡bi__æ_v”tiÿÎy_Ú_wr™e
 ? 
height
-1-
row
 :„ow)*
width
*
comp
 + 
cŞ
*comp;

1428 
r
, 
g
, 
b
;

1429 if(
row
 >ğ
height
) {

1430 
p
 -ğ
width
*
comp
*(
row
+1 - 
height
);

1432 if(
cŞ
 >ğ
width
) {

1433 
p
 -ğ
comp
*(
cŞ
+1 - 
width
);

1436 
r
 = 
imageD©a
[
p
+0];

1437 
g
 = 
imageD©a
[
p
+
ofsG
];

1438 
b
 = 
imageD©a
[
p
+
ofsB
];

1439 
YDU
[
pos
]=+0.29900f*
r
+0.58700f*
g
+0.11400f*
b
-128;

1440 
UDU
[
pos
]=-0.16874f*
r
-0.33126f*
g
+0.50000f*
b
;

1441 
VDU
[
pos
]=+0.50000f*
r
-0.41869f*
g
-0.08131f*
b
;

1445 
DCY
 = 
	`¡biw__jpg_´oûssDU
(
s
, &
b™Buf
, &
b™CÁ
, 
YDU
, 
fdtbl_Y
, DCY, 
YDC_HT
, 
YAC_HT
);

1446 
DCU
 = 
	`¡biw__jpg_´oûssDU
(
s
, &
b™Buf
, &
b™CÁ
, 
UDU
, 
fdtbl_UV
, DCU, 
UVDC_HT
, 
UVAC_HT
);

1447 
DCV
 = 
	`¡biw__jpg_´oûssDU
(
s
, &
b™Buf
, &
b™CÁ
, 
VDU
, 
fdtbl_UV
, DCV, 
UVDC_HT
, 
UVAC_HT
);

1452 
	`¡biw__jpg_wr™eB™s
(
s
, &
b™Buf
, &
b™CÁ
, 
flB™s
);

1456 
	`¡biw__putc
(
s
, 0xFF);

1457 
	`¡biw__putc
(
s
, 0xD9);

1460 
	}
}

1462 
STBIWDEF
 
	$¡bi_wr™e_jpg_to_func
(
¡bi_wr™e_func
 *
func
, *
cÚ‹xt
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
, 
qu®™y
)

1464 
¡bi__wr™e_cÚ‹xt
 
s
;

1465 
	`¡bi__¡¬t_wr™e_ÿÎbacks
(&
s
, 
func
, 
cÚ‹xt
);

1466  
	`¡bi_wr™e_jpg_cÜe
(&
s
, 
x
, 
y
, 
comp
, (*è
d©a
, 
qu®™y
);

1467 
	}
}

1470 #iâdeà
STBI_WRITE_NO_STDIO


1471 
STBIWDEF
 
	$¡bi_wr™e_jpg
(cÚ¡ *
f’ame
, 
x
, 
y
, 
comp
, cÚ¡ *
d©a
, 
qu®™y
)

1473 
¡bi__wr™e_cÚ‹xt
 
s
;

1474 ià(
	`¡bi__¡¬t_wr™e_fe
(&
s
,
f’ame
)) {

1475 
r
 = 
	`¡bi_wr™e_jpg_cÜe
(&
s
, 
x
, 
y
, 
comp
, 
d©a
, 
qu®™y
);

1476 
	`¡bi__’d_wr™e_fe
(&
s
);

1477  
r
;

1480 
	}
}

	@host/src/tree.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~"Œ“.h
"

4 
	~"uts.h
"

5 
	~"d©a.h
"

7 
	$chªge_Ëaves
(
Œ“
 *
t
, *
Ëaf_li¡
)

9 
li¡
 *
Îi¡
 = 
	`g‘_·ths
(
Ëaf_li¡
);

10 **
Ëaves
 = (**)
	`li¡_to_¬¿y
(
Îi¡
);

11 
n
 = 
Îi¡
->
size
;

12 
i
,
j
;

13 
found
 = 0;

14 
i
 = 0; i < 
t
->
n
; ++i){

15 
t
->
Ëaf
[
i
] = 0;

16 
j
 = 0; j < 
n
; ++j){

17 ià(0==
	`¡rcmp
(
t
->
Çme
[
i
], 
Ëaves
[
j
])){

18 
t
->
Ëaf
[
i
] = 1;

19 ++
found
;

24 
	`årštf
(
¡d”r
, "Found %d†—ves.\n", 
found
);

25 
	}
}

27 
	$g‘_h›¿rchy_´obab™y
(*
x
, 
Œ“
 *
h›r
, 
c
, 
¡ride
)

29 
p
 = 1;

30 
c
 >= 0){

31 
p
 =… * 
x
[
c
*
¡ride
];

32 
c
 = 
h›r
->
·»Á
[c];

34  
p
;

35 
	}
}

37 
	$h›¿rchy_´ediùiÚs
(*
´ediùiÚs
, 
n
, 
Œ“
 *
h›r
, 
Úly_Ëaves
, 
¡ride
)

39 
j
;

40 
j
 = 0; j < 
n
; ++j){

41 
·»Á
 = 
h›r
->·»Á[
j
];

42 if(
·»Á
 >= 0){

43 
´ediùiÚs
[
j
*
¡ride
] *ğ´ediùiÚs[
·»Á
*stride];

46 if(
Úly_Ëaves
){

47 
j
 = 0; j < 
n
; ++j){

48 if(!
h›r
->
Ëaf
[
j
]è
´ediùiÚs
[j*
¡ride
] = 0;

51 
	}
}

53 
	$h›¿rchy_tİ_´ediùiÚ
(*
´ediùiÚs
, 
Œ“
 *
h›r
, 
th»sh
, 
¡ride
)

55 
p
 = 1;

56 
group
 = 0;

57 
i
;

59 
max
 = 0;

60 
max_i
 = 0;

62 
i
 = 0; i < 
h›r
->
group_size
[
group
]; ++i){

63 
šdex
 = 
i
 + 
h›r
->
group_off£t
[
group
];

64 
v®
 = 
´ediùiÚs
[(
i
 + 
h›r
->
group_off£t
[
group
])*
¡ride
];

65 if(
v®
 > 
max
){

66 
max_i
 = 
šdex
;

67 
max
 = 
v®
;

70 if(
p
*
max
 > 
th»sh
){

71 
p
 =…*
max
;

72 
group
 = 
h›r
->
chd
[
max_i
];

73 if(
h›r
->
chd
[
max_i
] < 0)  max_i;

74 } ià(
group
 == 0){

75  
max_i
;

77  
h›r
->
·»Á
[h›r->
group_off£t
[
group
]];

81 
	}
}

83 
Œ“
 *
	$»ad_Œ“
(*
f’ame
)

85 
Œ“
 
t
 = {0};

86 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "r");

88 *
lše
;

89 
Ï¡_·»Á
 = -1;

90 
group_size
 = 0;

91 
groups
 = 0;

92 
n
 = 0;

93 (
lše
=
	`fg‘l
(
å
)) != 0){

94 *
id
 = 
	`ÿÎoc
(256, ());

95 
·»Á
 = -1;

96 
	`ssÿnf
(
lše
, "% %d", 
id
, &
·»Á
);

97 
t
.
·»Á
 = 
	`»®loc
Ñ.·»Á, (
n
+1)*());

98 
t
.
·»Á
[
n
] =…arent;

100 
t
.
chd
 = 
	`»®loc
Ñ.chd, (
n
+1)*());

101 
t
.
chd
[
n
] = -1;

103 
t
.
Çme
 = 
	`»®loc
Ñ.Çme, (
n
+1)*(*));

104 
t
.
Çme
[
n
] = 
id
;

105 if(
·»Á
 !ğ
Ï¡_·»Á
){

106 ++
groups
;

107 
t
.
group_off£t
 = 
	`»®loc
Ñ.group_off£t, 
groups
 * ());

108 
t
.
group_off£t
[
groups
 - 1] = 
n
 - 
group_size
;

109 
t
.
group_size
 = 
	`»®loc
Ñ.group_size, 
groups
 * ());

110 
t
.
group_size
[
groups
 - 1] = group_size;

111 
group_size
 = 0;

112 
Ï¡_·»Á
 = 
·»Á
;

114 
t
.
group
 = 
	`»®loc
Ñ.group, (
n
+1)*());

115 
t
.
group
[
n
] = 
groups
;

116 ià(
·»Á
 >= 0) {

117 
t
.
chd
[
·»Á
] = 
groups
;

119 ++
n
;

120 ++
group_size
;

122 ++
groups
;

123 
t
.
group_off£t
 = 
	`»®loc
Ñ.group_off£t, 
groups
 * ());

124 
t
.
group_off£t
[
groups
 - 1] = 
n
 - 
group_size
;

125 
t
.
group_size
 = 
	`»®loc
Ñ.group_size, 
groups
 * ());

126 
t
.
group_size
[
groups
 - 1] = group_size;

127 
t
.
n
 =‚;

128 
t
.
groups
 = groups;

129 
t
.
Ëaf
 = 
	`ÿÎoc
(
n
, ());

130 
i
;

131 
i
 = 0; i < 
n
; ++iè
t
.
Ëaf
[i] = 1;

132 
i
 = 0; i < 
n
; ++ièif(
t
.
·»Á
[i] >ğ0èt.
Ëaf
[t.parent[i]] = 0;

134 
	`fşo£
(
å
);

135 
Œ“
 *
Œ“_±r
 = 
	`ÿÎoc
(1, (tree));

136 *
Œ“_±r
 = 
t
;

138  
Œ“_±r
;

139 
	}
}

	@host/src/tree.h

1 #iâdeà
TREE_H


2 
	#TREE_H


	)

3 
	~"d¬kÃt.h
"

5 
h›¿rchy_tİ_´ediùiÚ
(*
´ediùiÚs
, 
Œ“
 *
h›r
, 
th»sh
, 
¡ride
);

6 
g‘_h›¿rchy_´obab™y
(*
x
, 
Œ“
 *
h›r
, 
c
, 
¡ride
);

	@host/src/upsample_layer.c

1 
	~"up§m¶e_Ïy”.h
"

2 
	~"cuda.h
"

3 
	~"bÏs.h
"

5 
	~<¡dio.h
>

7 
Ïy”
 
	$make_up§m¶e_Ïy”
(
b©ch
, 
w
, 
h
, 
c
, 
¡ride
)

9 
Ïy”
 
l
 = {0};

10 
l
.
ty³
 = 
UPSAMPLE
;

11 
l
.
b©ch
 = batch;

12 
l
.
w
 = w;

13 
l
.
h
 = h;

14 
l
.
c
 = c;

15 
l
.
out_w
 = 
w
*
¡ride
;

16 
l
.
out_h
 = 
h
*
¡ride
;

17 
l
.
out_c
 = 
c
;

18 if(
¡ride
 < 0){

19 
¡ride
 = -stride;

20 
l
.
»v”£
=1;

21 
l
.
out_w
 = 
w
/
¡ride
;

22 
l
.
out_h
 = 
h
/
¡ride
;

24 
l
.
¡ride
 = stride;

25 
l
.
ouuts
 =†.
out_w
*l.
out_h
*l.
out_c
;

26 
l
.
šputs
 =†.
w
*l.
h
*l.
c
;

27 
l
.
d–
 = 
	`ÿÎoc
Ö.
ouuts
*
b©ch
, ());

28 
l
.
ouut
 = 
	`ÿÎoc
Ö.
ouuts
*
b©ch
, ());;

30 
l
.
fÜw¬d
 = 
fÜw¬d_up§m¶e_Ïy”
;

31 
l
.
backw¬d
 = 
backw¬d_up§m¶e_Ïy”
;

32 #ifdeà
GPU


33 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_up§m¶e_Ïy”_gpu
;

34 
l
.
backw¬d_gpu
 = 
backw¬d_up§m¶e_Ïy”_gpu
;

36 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
,†.
ouuts
*
b©ch
);

37 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
,†.
ouuts
*
b©ch
);

39 if(
l
.
»v”£
è
	`årštf
(
¡d”r
, "down§m¶ %2dx %4d x%4d x%4d -> %4d x%4d x%4d\n", 
¡ride
, 
w
, 
h
, 
c
,†.
out_w
,†.
out_h
,†.
out_c
);

40 
	`årštf
(
¡d”r
, "up§m¶ %2dx %4d x%4d x%4d -> %4d x%4d x%4d\n", 
¡ride
, 
w
, 
h
, 
c
, 
l
.
out_w
,†.
out_h
,†.
out_c
);

41  
l
;

42 
	}
}

44 
	$»size_up§m¶e_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

46 
l
->
w
 = w;

47 
l
->
h
 = h;

48 
l
->
out_w
 = 
w
*l->
¡ride
;

49 
l
->
out_h
 = 
h
*l->
¡ride
;

50 if(
l
->
»v”£
){

51 
l
->
out_w
 = 
w
/l->
¡ride
;

52 
l
->
out_h
 = 
h
/l->
¡ride
;

54 
l
->
ouuts
 =†->
out_w
*l->
out_h
*l->
out_c
;

55 
l
->
šputs
 =†->
h
*l->
w
*l->
c
;

56 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
ouuts
*l->
b©ch
*());

57 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
ouuts
*l->
b©ch
*());

59 #ifdeà
GPU


60 
	`cuda_ä“
(
l
->
ouut_gpu
);

61 
	`cuda_ä“
(
l
->
d–_gpu
);

62 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
ouuts
*l->
b©ch
);

63 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
ouuts
*l->
b©ch
);

66 
	}
}

68 
	$fÜw¬d_up§m¶e_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

70 
	`fl_ıu
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut
, 1);

71 if(
l
.
»v”£
){

72 
	`up§m¶e_ıu
(
l
.
ouut
,†.
out_w
,†.
out_h
,†.
c
,†.
b©ch
,†.
¡ride
, 0,†.
sÿË
, 
Ãt
.
šput
);

74 
	`up§m¶e_ıu
(
Ãt
.
šput
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 1,†.
sÿË
,†.
ouut
);

76 
	}
}

78 
	$backw¬d_up§m¶e_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

80 if(
l
.
»v”£
){

81 
	`up§m¶e_ıu
(
l
.
d–
,†.
out_w
,†.
out_h
,†.
c
,†.
b©ch
,†.
¡ride
, 1,†.
sÿË
, 
Ãt
.delta);

83 
	`up§m¶e_ıu
(
Ãt
.
d–
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 0,†.
sÿË
,†.delta);

85 
	}
}

87 #ifdeà
GPU


88 
	$fÜw¬d_up§m¶e_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

90 
	`fl_gpu
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut_gpu
, 1);

91 if(
l
.
»v”£
){

92 
	`up§m¶e_gpu
(
l
.
ouut_gpu
,†.
out_w
,†.
out_h
,†.
c
,†.
b©ch
,†.
¡ride
, 0,†.
sÿË
, 
Ãt
.
šput_gpu
);

94 
	`up§m¶e_gpu
(
Ãt
.
šput_gpu
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 1,†.
sÿË
,†.
ouut_gpu
);

96 
	}
}

98 
	$backw¬d_up§m¶e_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

100 if(
l
.
»v”£
){

101 
	`up§m¶e_gpu
(
l
.
d–_gpu
,†.
out_w
,†.
out_h
,†.
c
,†.
b©ch
,†.
¡ride
, 1,†.
sÿË
, 
Ãt
.delta_gpu);

103 
	`up§m¶e_gpu
(
Ãt
.
d–_gpu
, 
l
.
w
,†.
h
,†.
c
,†.
b©ch
,†.
¡ride
, 0,†.
sÿË
,†.delta_gpu);

105 
	}
}

	@host/src/upsample_layer.h

1 #iâdeà
UPSAMPLE_LAYER_H


2 
	#UPSAMPLE_LAYER_H


	)

3 
	~"d¬kÃt.h
"

5 
Ïy”
 
make_up§m¶e_Ïy”
(
b©ch
, 
w
, 
h
, 
c
, 
¡ride
);

6 
fÜw¬d_up§m¶e_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

7 
backw¬d_up§m¶e_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

8 
»size_up§m¶e_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

10 #ifdeà
GPU


11 
fÜw¬d_up§m¶e_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

12 
backw¬d_up§m¶e_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@host/src/utils.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<¡ršg.h
>

4 
	~<m©h.h
>

5 
	~<as£¹.h
>

6 
	~<uni¡d.h
>

7 
	~<æßt.h
>

8 
	~<lim™s.h
>

9 
	~<time.h
>

10 
	~<sys/time.h
>

12 
	~"uts.h
"

27 
	$wh©_time_is_™_now
()

29 
timev®
 
time
;

30 ià(
	`g‘timeofday
(&
time
,
NULL
)){

33  ()
time
.
tv_£c
 + (éime.
tv_u£c
 * .000001;

34 
	}
}

36 *
	$»ad_ši¡
(*
gpu_li¡
, *
ngpus
, 
d
)

38 *
gpus
 = 0;

39 if(
gpu_li¡
){

40 
Ën
 = 
	`¡¾’
(
gpu_li¡
);

41 *
ngpus
 = 1;

42 
i
;

43 
i
 = 0; i < 
Ën
; ++i){

44 ià(
gpu_li¡
[
i
] =ğ','è++*
ngpus
;

46 
gpus
 = 
	`ÿÎoc
(*
ngpus
, ());

47 
i
 = 0; i < *
ngpus
; ++i){

48 
gpus
[
i
] = 
	`©oi
(
gpu_li¡
);

49 
gpu_li¡
 = 
	`¡rchr
(gpu_list, ',')+1;

52 
gpus
 = 
	`ÿÎoc
(1, ());

53 *
gpus
 = 
d
;

54 *
ngpus
 = 1;

56  
gpus
;

57 
	}
}

59 *
	$»ad_m­
(*
f’ame
)

61 
n
 = 0;

62 *
m­
 = 0;

63 *
¡r
;

64 
FILE
 *
fe
 = 
	`fİ’
(
f’ame
, "r");

65 if(!
fe
è
	`fe_”rÜ
(
f’ame
);

66 (
¡r
=
	`fg‘l
(
fe
))){

67 ++
n
;

68 
m­
 = 
	`»®loc
(m­, 
n
*());

69 
m­
[
n
-1] = 
	`©oi
(
¡r
);

71  
m­
;

72 
	}
}

74 
	$sÜ_shufæe
(*
¬r
, 
size_t
 
n
, size_ˆ
size
, size_ˆ
£ùiÚs
)

76 
size_t
 
i
;

77 
i
 = 0; i < 
£ùiÚs
; ++i){

78 
size_t
 
¡¬t
 = 
n
*
i
/
£ùiÚs
;

79 
size_t
 
’d
 = 
n
*(
i
+1)/
£ùiÚs
;

80 
size_t
 
num
 = 
’d
-
¡¬t
;

81 
	`shufæe
(
¬r
+(
¡¬t
*
size
), 
num
, size);

83 
	}
}

85 
	$shufæe
(*
¬r
, 
size_t
 
n
, size_ˆ
size
)

87 
size_t
 
i
;

88 *
swp
 = 
	`ÿÎoc
(1, 
size
);

89 
i
 = 0; i < 
n
-1; ++i){

90 
size_t
 
j
 = 
i
 + 
	`¿nd
()/(
RAND_MAX
 / (
n
-i)+1);

91 
	`memıy
(
swp
, 
¬r
+(
j
*
size
), size);

92 
	`memıy
(
¬r
+(
j
*
size
),‡¼+(
i
*size), size);

93 
	`memıy
(
¬r
+(
i
*
size
), 
swp
, size);

95 
	}
}

97 *
	$¿ndom_šdex_Üd”
(
mš
, 
max
)

99 *
šds
 = 
	`ÿÎoc
(
max
-
mš
, ());

100 
i
;

101 
i
 = 
mš
; i < 
max
; ++i){

102 
šds
[
i
] = i;

104 
i
 = 
mš
; i < 
max
-1; ++i){

105 
sw­
 = 
šds
[
i
];

106 
šdex
 = 
i
 + 
	`¿nd
()%(
max
-i);

107 
šds
[
i
] = inds[
šdex
];

108 
šds
[
šdex
] = 
sw­
;

110  
šds
;

111 
	}
}

113 
	$d–_¬g
(
¬gc
, **
¬gv
, 
šdex
)

115 
i
;

116 
i
 = 
šdex
; i < 
¬gc
-1; ++iè
¬gv
[i] =‡rgv[i+1];

117 
¬gv
[
i
] = 0;

118 
	}
}

120 
	$fšd_¬g
(
¬gc
, * 
¬gv
[], *
¬g
)

122 
i
;

123 
i
 = 0; i < 
¬gc
; ++i) {

124 if(!
¬gv
[
i
]) ;

125 if(0==
	`¡rcmp
(
¬gv
[
i
], 
¬g
)) {

126 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

131 
	}
}

133 
	$fšd_št_¬g
(
¬gc
, **
¬gv
, *
¬g
, 
def
)

135 
i
;

136 
i
 = 0; i < 
¬gc
-1; ++i){

137 if(!
¬gv
[
i
]) ;

138 if(0==
	`¡rcmp
(
¬gv
[
i
], 
¬g
)){

139 
def
 = 
	`©oi
(
¬gv
[
i
+1]);

140 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

141 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

145  
def
;

146 
	}
}

148 
	$fšd_æßt_¬g
(
¬gc
, **
¬gv
, *
¬g
, 
def
)

150 
i
;

151 
i
 = 0; i < 
¬gc
-1; ++i){

152 if(!
¬gv
[
i
]) ;

153 if(0==
	`¡rcmp
(
¬gv
[
i
], 
¬g
)){

154 
def
 = 
	`©of
(
¬gv
[
i
+1]);

155 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

156 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

160  
def
;

161 
	}
}

163 *
	$fšd_ch¬_¬g
(
¬gc
, **
¬gv
, *
¬g
, *
def
)

165 
i
;

166 
i
 = 0; i < 
¬gc
-1; ++i){

167 if(!
¬gv
[
i
]) ;

168 if(0==
	`¡rcmp
(
¬gv
[
i
], 
¬g
)){

169 
def
 = 
¬gv
[
i
+1];

170 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

171 
	`d–_¬g
(
¬gc
, 
¬gv
, 
i
);

175  
def
;

176 
	}
}

179 *
	$ba£cfg
(*
cfgfe
)

181 *
c
 = 
cfgfe
;

182 *
Ãxt
;

183 (
Ãxt
 = 
	`¡rchr
(
c
, '/')))

185 
c
 = 
Ãxt
+1;

187 
c
 = 
	`cİy_¡ršg
(c);

188 
Ãxt
 = 
	`¡rchr
(
c
, '.');

189 ià(
Ãxt
) *next = 0;

190  
c
;

191 
	}
}

193 
	$®phªum_to_št
(
c
)

195  (
c
 < 58) ? c - 48 : c-87;

196 
	}
}

197 
	$št_to_®phªum
(
i
)

199 ià(
i
 == 36)  '.';

200  (
i
 < 10) ? i + 48 : i + 87;

201 
	}
}

203 
	$pm
(
M
, 
N
, *
A
)

205 
i
,
j
;

206 
i
 =0 ; i < 
M
; ++i){

207 
	`´štf
("%d ", 
i
+1);

208 
j
 = 0; j < 
N
; ++j){

209 
	`´štf
("%2.4f, ", 
A
[
i
*
N
+
j
]);

211 
	`´štf
("\n");

213 
	`´štf
("\n");

214 
	}
}

216 
	$fšd_»¶aû
(*
¡r
, *
Üig
, *
»p
, *
ouut
)

218 
bufãr
[4096] = {0};

219 *
p
;

221 
	`¥rštf
(
bufãr
, "%s", 
¡r
);

222 if(!(
p
 = 
	`¡r¡r
(
bufãr
, 
Üig
))){

223 
	`¥rštf
(
ouut
, "%s", 
¡r
);

227 *
p
 = '\0';

229 
	`¥rštf
(
ouut
, "%s%s%s", 
bufãr
, 
»p
, 
p
+
	`¡¾’
(
Üig
));

230 
	}
}

232 
	$£c
(
şock_t
 
şocks
)

234  ()
şocks
/
CLOCKS_PER_SEC
;

235 
	}
}

237 
	$tİ_k
(*
a
, 
n
, 
k
, *
šdex
)

239 
i
,
j
;

240 
j
 = 0; j < 
k
; ++jè
šdex
[j] = -1;

241 
i
 = 0; i < 
n
; ++i){

242 
cu¼
 = 
i
;

243 
j
 = 0; j < 
k
; ++j){

244 if((
šdex
[
j
] < 0è|| 
a
[
cu¼
] >‡[index[j]]){

245 
sw­
 = 
cu¼
;

246 
cu¼
 = 
šdex
[
j
];

247 
šdex
[
j
] = 
sw­
;

251 
	}
}

253 
	$”rÜ
(cÚ¡ *
s
)

255 
	`³¼Ü
(
s
);

256 
	`as£¹
(0);

257 
	`ex™
(-1);

258 
	}
}

260 *
	$»ad_fe
(*
f’ame
)

262 
FILE
 *
å
 = 
	`fİ’
(
f’ame
, "rb");

263 
size_t
 
size
;

265 
	`f£ek
(
å
, 0, 
SEEK_END
);

266 
size
 = 
	`á–l
(
å
);

267 
	`f£ek
(
å
, 0, 
SEEK_SET
);

269 *
‹xt
 = 
	`ÿÎoc
(
size
+1, ());

270 
	`ä—d
(
‹xt
, 1, 
size
, 
å
);

271 
	`fşo£
(
å
);

272  
‹xt
;

273 
	}
}

275 
	$m®loc_”rÜ
()

277 
	`årštf
(
¡d”r
, "Mallocƒrror\n");

278 
	`ex™
(-1);

279 
	}
}

281 
	$fe_”rÜ
(*
s
)

283 
	`årštf
(
¡d”r
, "Couldn'ˆİ’ fe: %s\n", 
s
);

284 
	`ex™
(0);

285 
	}
}

287 
li¡
 *
	$¥l™_¡r
(*
s
, 
d–im
)

289 
size_t
 
i
;

290 
size_t
 
Ën
 = 
	`¡¾’
(
s
);

291 
li¡
 *
l
 = 
	`make_li¡
();

292 
	`li¡_š£¹
(
l
, 
s
);

293 
i
 = 0; i < 
Ën
; ++i){

294 if(
s
[
i
] =ğ
d–im
){

295 
s
[
i
] = '\0';

296 
	`li¡_š£¹
(
l
, &(
s
[
i
+1]));

299  
l
;

300 
	}
}

302 
	$¡r
(*
s
)

304 
size_t
 
i
;

305 
size_t
 
Ën
 = 
	`¡¾’
(
s
);

306 
size_t
 
off£t
 = 0;

307 
i
 = 0; i < 
Ën
; ++i){

308 
c
 = 
s
[
i
];

309 if(
c
==' '||c=='\t'||c=='\n'è++
off£t
;

310 
s
[
i
-
off£t
] = 
c
;

312 
s
[
Ën
-
off£t
] = '\0';

313 
	}
}

315 
	$¡r_ch¬
(*
s
, 
bad
)

317 
size_t
 
i
;

318 
size_t
 
Ën
 = 
	`¡¾’
(
s
);

319 
size_t
 
off£t
 = 0;

320 
i
 = 0; i < 
Ën
; ++i){

321 
c
 = 
s
[
i
];

322 if(
c
==
bad
è++
off£t
;

323 
s
[
i
-
off£t
] = 
c
;

325 
s
[
Ën
-
off£t
] = '\0';

326 
	}
}

328 
	$ä“_±rs
(**
±rs
, 
n
)

330 
i
;

331 
i
 = 0; i < 
n
; ++iè
	`ä“
(
±rs
[i]);

332 
	`ä“
(
±rs
);

333 
	}
}

335 *
	$fg‘l
(
FILE
 *
å
)

337 if(
	`ãof
(
å
))  0;

338 
size_t
 
size
 = 512;

339 *
lše
 = 
	`m®loc
(
size
*());

340 if(!
	`fg‘s
(
lše
, 
size
, 
å
)){

341 
	`ä“
(
lše
);

345 
size_t
 
cu¼
 = 
	`¡¾’
(
lše
);

347 (
lše
[
cu¼
-1] !ğ'\n'è&& !
	`ãof
(
å
)){

348 if(
cu¼
 =ğ
size
-1){

349 
size
 *= 2;

350 
lše
 = 
	`»®loc
Öše, 
size
*());

351 if(!
lše
) {

352 
	`´štf
("%ld\n", 
size
);

353 
	`m®loc_”rÜ
();

356 
size_t
 
»adsize
 = 
size
-
cu¼
;

357 if(
»adsize
 > 
INT_MAX
)„eadsize = INT_MAX-1;

358 
	`fg‘s
(&
lše
[
cu¼
], 
»adsize
, 
å
);

359 
cu¼
 = 
	`¡¾’
(
lše
);

361 if(
lše
[
cu¼
-1] == '\n')†ine[curr-1] = '\0';

363  
lše
;

364 
	}
}

366 
	$»ad_št
(
fd
)

368 
n
 = 0;

369 
Ãxt
 = 
	`»ad
(
fd
, &
n
, ());

370 if(
Ãxt
 <= 0)  -1;

371  
n
;

372 
	}
}

374 
	$wr™e_št
(
fd
, 
n
)

376 
Ãxt
 = 
	`wr™e
(
fd
, &
n
, ());

377 if(
Ãxt
 <ğ0è
	`”rÜ
("read failed");

378 
	}
}

380 
	$»ad_®l_ç
(
fd
, *
bufãr
, 
size_t
 
by‹s
)

382 
size_t
 
n
 = 0;

383 
n
 < 
by‹s
){

384 
Ãxt
 = 
	`»ad
(
fd
, 
bufãr
 + 
n
, 
by‹s
-n);

385 if(
Ãxt
 <= 0)  1;

386 
n
 +ğ
Ãxt
;

389 
	}
}

391 
	$wr™e_®l_ç
(
fd
, *
bufãr
, 
size_t
 
by‹s
)

393 
size_t
 
n
 = 0;

394 
n
 < 
by‹s
){

395 
size_t
 
Ãxt
 = 
	`wr™e
(
fd
, 
bufãr
 + 
n
, 
by‹s
-n);

396 if(
Ãxt
 <= 0)  1;

397 
n
 +ğ
Ãxt
;

400 
	}
}

402 
	$»ad_®l
(
fd
, *
bufãr
, 
size_t
 
by‹s
)

404 
size_t
 
n
 = 0;

405 
n
 < 
by‹s
){

406 
Ãxt
 = 
	`»ad
(
fd
, 
bufãr
 + 
n
, 
by‹s
-n);

407 if(
Ãxt
 <ğ0è
	`”rÜ
("read failed");

408 
n
 +ğ
Ãxt
;

410 
	}
}

412 
	$wr™e_®l
(
fd
, *
bufãr
, 
size_t
 
by‹s
)

414 
size_t
 
n
 = 0;

415 
n
 < 
by‹s
){

416 
size_t
 
Ãxt
 = 
	`wr™e
(
fd
, 
bufãr
 + 
n
, 
by‹s
-n);

417 if(
Ãxt
 <ğ0è
	`”rÜ
("write failed");

418 
n
 +ğ
Ãxt
;

420 
	}
}

423 *
	$cİy_¡ršg
(*
s
)

425 *
cİy
 = 
	`m®loc
(
	`¡¾’
(
s
)+1);

426 
	`¡ºıy
(
cİy
, 
s
, 
	`¡¾’
(s)+1);

427  
cİy
;

428 
	}
}

430 
li¡
 *
	$·r£_csv_lše
(*
lše
)

432 
li¡
 *
l
 = 
	`make_li¡
();

433 *
c
, *
p
;

434 
š
 = 0;

435 
c
 = 
lše
, 
p
 =†ine; *c != '\0'; ++c){

436 if(*
c
 =ğ'"'è
š
 = !in;

437 if(*
c
 =ğ',' && !
š
){

438 *
c
 = '\0';

439 
	`li¡_š£¹
(
l
, 
	`cİy_¡ršg
(
p
));

440 
p
 = 
c
+1;

443 
	`li¡_š£¹
(
l
, 
	`cİy_¡ršg
(
p
));

444  
l
;

445 
	}
}

447 
	$couÁ_f›lds
(*
lše
)

449 
couÁ
 = 0;

450 
dÚe
 = 0;

451 *
c
;

452 
c
 = 
lše
; !
dÚe
; ++c){

453 
dÚe
 = (*
c
 == '\0');

454 if(*
c
 =ğ',' || 
dÚe
è++
couÁ
;

456  
couÁ
;

457 
	}
}

459 *
	$·r£_f›lds
(*
lše
, 
n
)

461 *
f›ld
 = 
	`ÿÎoc
(
n
, ());

462 *
c
, *
p
, *
’d
;

463 
couÁ
 = 0;

464 
dÚe
 = 0;

465 
c
 = 
lše
, 
p
 =†še; !
dÚe
; ++c){

466 
dÚe
 = (*
c
 == '\0');

467 if(*
c
 =ğ',' || 
dÚe
){

468 *
c
 = '\0';

469 
f›ld
[
couÁ
] = 
	`¡¹od
(
p
, &
’d
);

470 if(
p
 =ğ
c
è
f›ld
[
couÁ
] = 
	`Çn
("");

471 if(
’d
 !ğ
c
 && (’d !ğc-1 || *’d !ğ'\r')è
f›ld
[
couÁ
] = 
	`Çn
("");

472 
p
 = 
c
+1;

473 ++
couÁ
;

476  
f›ld
;

477 
	}
}

479 
	$sum_¬¿y
(*
a
, 
n
)

481 
i
;

482 
sum
 = 0;

483 
i
 = 0; i < 
n
; ++iè
sum
 +ğ
a
[i];

484  
sum
;

485 
	}
}

487 
	$m—n_¬¿y
(*
a
, 
n
)

489  
	`sum_¬¿y
(
a
,
n
)/n;

490 
	}
}

492 
	$m—n_¬¿ys
(**
a
, 
n
, 
–s
, *
avg
)

494 
i
;

495 
j
;

496 
	`mem£t
(
avg
, 0, 
–s
*());

497 
j
 = 0; j < 
n
; ++j){

498 
i
 = 0; i < 
–s
; ++i){

499 
avg
[
i
] +ğ
a
[
j
][i];

502 
i
 = 0; i < 
–s
; ++i){

503 
avg
[
i
] /ğ
n
;

505 
	}
}

507 
	$´št_¡©i¡ics
(*
a
, 
n
)

509 
m
 = 
	`m—n_¬¿y
(
a
, 
n
);

510 
v
 = 
	`v¬Ÿnû_¬¿y
(
a
, 
n
);

511 
	`´štf
("MSE: %.6f, M—n: %.6f, V¬Ÿnû: %.6f\n", 
	`m£_¬¿y
(
a
, 
n
), 
m
, 
v
);

512 
	}
}

514 
	$v¬Ÿnû_¬¿y
(*
a
, 
n
)

516 
i
;

517 
sum
 = 0;

518 
m—n
 = 
	`m—n_¬¿y
(
a
, 
n
);

519 
i
 = 0; i < 
n
; ++iè
sum
 +ğ(
a
[i] - 
m—n
)*(a[i]-mean);

520 
v¬Ÿnû
 = 
sum
/
n
;

521  
v¬Ÿnû
;

522 
	}
}

524 
	$cÚ¡¿š_št
(
a
, 
mš
, 
max
)

526 ià(
a
 < 
mš
)  min;

527 ià(
a
 > 
max
)  max;

528  
a
;

529 
	}
}

531 
	$cÚ¡¿š
(
mš
, 
max
, 
a
)

533 ià(
a
 < 
mš
)  min;

534 ià(
a
 > 
max
)  max;

535  
a
;

536 
	}
}

538 
	$di¡_¬¿y
(*
a
, *
b
, 
n
, 
sub
)

540 
i
;

541 
sum
 = 0;

542 
i
 = 0; i < 
n
; i +ğ
sub
è
sum
 +ğ
	`pow
(
a
[i]-
b
[i], 2);

543  
	`sq¹
(
sum
);

544 
	}
}

546 
	$m£_¬¿y
(*
a
, 
n
)

548 
i
;

549 
sum
 = 0;

550 
i
 = 0; i < 
n
; ++iè
sum
 +ğ
a
[i]*a[i];

551  
	`sq¹
(
sum
/
n
);

552 
	}
}

554 
	$nÜm®ize_¬¿y
(*
a
, 
n
)

556 
i
;

557 
mu
 = 
	`m—n_¬¿y
(
a
,
n
);

558 
sigma
 = 
	`sq¹
(
	`v¬Ÿnû_¬¿y
(
a
,
n
));

559 
i
 = 0; i < 
n
; ++i){

560 
a
[
i
] = (a[i] - 
mu
)/
sigma
;

562 
mu
 = 
	`m—n_¬¿y
(
a
,
n
);

563 
sigma
 = 
	`sq¹
(
	`v¬Ÿnû_¬¿y
(
a
,
n
));

564 
	}
}

566 
	$Œª¦©e_¬¿y
(*
a
, 
n
, 
s
)

568 
i
;

569 
i
 = 0; i < 
n
; ++i){

570 
a
[
i
] +ğ
s
;

572 
	}
}

574 
	$mag_¬¿y
(*
a
, 
n
)

576 
i
;

577 
sum
 = 0;

578 
i
 = 0; i < 
n
; ++i){

579 
sum
 +ğ
a
[
i
]*a[i];

581  
	`sq¹
(
sum
);

582 
	}
}

584 
	$sÿË_¬¿y
(*
a
, 
n
, 
s
)

586 
i
;

587 
i
 = 0; i < 
n
; ++i){

588 
a
[
i
] *ğ
s
;

590 
	}
}

592 
	$§m¶e_¬¿y
(*
a
, 
n
)

594 
sum
 = 
	`sum_¬¿y
(
a
, 
n
);

595 
	`sÿË_¬¿y
(
a
, 
n
, 1./
sum
);

596 
r
 = 
	`¿nd_unifÜm
(0, 1);

597 
i
;

598 
i
 = 0; i < 
n
; ++i){

599 
r
 =„ - 
a
[
i
];

600 ià(
r
 <ğ0è 
i
;

602  
n
-1;

603 
	}
}

605 
	$max_št_šdex
(*
a
, 
n
)

607 if(
n
 <= 0)  -1;

608 
i
, 
max_i
 = 0;

609 
max
 = 
a
[0];

610 
i
 = 1; i < 
n
; ++i){

611 if(
a
[
i
] > 
max
){

612 
max
 = 
a
[
i
];

613 
max_i
 = 
i
;

616  
max_i
;

617 
	}
}

619 
	$max_šdex
(*
a
, 
n
)

621 if(
n
 <= 0)  -1;

622 
i
, 
max_i
 = 0;

623 
max
 = 
a
[0];

624 
i
 = 1; i < 
n
; ++i){

625 if(
a
[
i
] > 
max
){

626 
max
 = 
a
[
i
];

627 
max_i
 = 
i
;

630  
max_i
;

631 
	}
}

633 
	$št_šdex
(*
a
, 
v®
, 
n
)

635 
i
;

636 
i
 = 0; i < 
n
; ++i){

637 if(
a
[
i
] =ğ
v®
)  i;

640 
	}
}

642 
	$¿nd_št
(
mš
, 
max
)

644 ià(
max
 < 
mš
){

645 
s
 = 
mš
;

646 
mš
 = 
max
;

647 
max
 = 
s
;

649 
r
 = (
	`¿nd
()%(
max
 - 
mš
 + 1)) + min;

650  
r
;

651 
	}
}

654 
	$¿nd_nÜm®
()

656 
haveS·»
 = 0;

657 
¿nd1
, 
¿nd2
;

659 if(
haveS·»
)

661 
haveS·»
 = 0;

662  
	`sq¹
(
¿nd1
è* 
	`sš
(
¿nd2
);

665 
haveS·»
 = 1;

667 
¿nd1
 = 
	`¿nd
(è/ ((è
RAND_MAX
);

668 if(
¿nd1
 < 1e-100)„and1 = 1e-100;

669 
¿nd1
 = -2 * 
	`log
(rand1);

670 
¿nd2
 = (
	`¿nd
(è/ ((è
RAND_MAX
)è* 
TWO_PI
;

672  
	`sq¹
(
¿nd1
è* 
	`cos
(
¿nd2
);

673 
	}
}

675 
	$¿nd_nÜm®_ms
(
mu
, 
sigma
){

676 
U1
, 
U2
, 
W
, 
muÉ
;

677 
X1
, 
X2
;

678 
ÿÎ
 = 0;

680 ià(
ÿÎ
 == 1)

682 
ÿÎ
 = !call;

683  (
mu
 + 
sigma
 * (è
X2
);

688 
U1
 = -1 + (è
	`¿nd
 ()/
RAND_MAX
 * 2;

689 
U2
 = -1 + (è
	`¿nd
 ()/
RAND_MAX
 * 2;

690 
W
 = 
	`pow
 (
U1
, 2è+…ow (
U2
, 2);

692 
W
 >= 1 || W == 0);

694 
muÉ
 = 
	`sq¹
 ((-2 * 
	`log
 (
W
)) / W);

695 
X1
 = 
U1
 * 
muÉ
;

696 
X2
 = 
U2
 * 
muÉ
;

698 
ÿÎ
 = !call;

700  (
mu
 + 
sigma
 * (è
X1
);

701 
	}
}

714 
size_t
 
	$¿nd_size_t
()

716  ((
size_t
)(
	`¿nd
()&0xff) << 56) |

717 ((
size_t
)(
	`¿nd
()&0xff) << 48) |

718 ((
size_t
)(
	`¿nd
()&0xff) << 40) |

719 ((
size_t
)(
	`¿nd
()&0xff) << 32) |

720 ((
size_t
)(
	`¿nd
()&0xff) << 24) |

721 ((
size_t
)(
	`¿nd
()&0xff) << 16) |

722 ((
size_t
)(
	`¿nd
()&0xff) << 8) |

723 ((
size_t
)(
	`¿nd
()&0xff) << 0);

724 
	}
}

726 
	$¿nd_unifÜm
(
mš
, 
max
)

728 if(
max
 < 
mš
){

729 
sw­
 = 
mš
;

730 
mš
 = 
max
;

731 
max
 = 
sw­
;

733  (()
	`¿nd
()/
RAND_MAX
 * (
max
 - 
mš
)) + min;

734 
	}
}

736 
	$¿nd_sÿË
(
s
)

738 
sÿË
 = 
	`¿nd_unifÜm
(1, 
s
);

739 if(
	`¿nd
()%2è 
sÿË
;

740  1./
sÿË
;

741 
	}
}

743 **
	$Úe_hÙ_’code
(*
a
, 
n
, 
k
)

745 
i
;

746 **
t
 = 
	`ÿÎoc
(
n
, (*));

747 
i
 = 0; i < 
n
; ++i){

748 
t
[
i
] = 
	`ÿÎoc
(
k
, ());

749 
šdex
 = ()
a
[
i
];

750 
t
[
i
][
šdex
] = 1;

752  
t
;

753 
	}
}

	@host/src/utils.h

1 #iâdeà
UTILS_H


2 
	#UTILS_H


	)

3 
	~<¡dio.h
>

4 
	~<time.h
>

5 
	~"d¬kÃt.h
"

6 
	~"li¡.h
"

8 
	#TIME
(
a
) \

10 
¡¬t
 = 
	`wh©_time_is_™_now
(); \

11 
a
; \

12 
	`´štf
("% took: %à£cÚds\n", #a, 
	`wh©_time_is_™_now
(è- 
¡¬t
); \

13 } 0)

	)

15 
	#TWO_PI
 6.2831853071795864769252866f

	)

17 
wh©_time_is_™_now
();

18 
shufæe
(*
¬r
, 
size_t
 
n
, size_ˆ
size
);

19 
sÜ_shufæe
(*
¬r
, 
size_t
 
n
, size_ˆ
size
, size_ˆ
£ùiÚs
);

20 
ä“_±rs
(**
±rs
, 
n
);

21 
®phªum_to_št
(
c
);

22 
št_to_®phªum
(
i
);

23 
»ad_št
(
fd
);

24 
wr™e_št
(
fd
, 
n
);

25 
»ad_®l
(
fd
, *
bufãr
, 
size_t
 
by‹s
);

26 
wr™e_®l
(
fd
, *
bufãr
, 
size_t
 
by‹s
);

27 
»ad_®l_ç
(
fd
, *
bufãr
, 
size_t
 
by‹s
);

28 
wr™e_®l_ç
(
fd
, *
bufãr
, 
size_t
 
by‹s
);

29 
fšd_»¶aû
(*
¡r
, *
Üig
, *
»p
, *
ouut
);

30 
m®loc_”rÜ
();

31 
fe_”rÜ
(*
s
);

32 
¡r
(*
s
);

33 
¡r_ch¬
(*
s
, 
bad
);

34 
li¡
 *
¥l™_¡r
(*
s
, 
d–im
);

35 *
fg‘l
(
FILE
 *
å
);

36 
li¡
 *
·r£_csv_lše
(*
lše
);

37 *
cİy_¡ršg
(*
s
);

38 
couÁ_f›lds
(*
lše
);

39 *
·r£_f›lds
(*
lše
, 
n
);

40 
Œª¦©e_¬¿y
(*
a
, 
n
, 
s
);

41 
cÚ¡¿š
(
mš
, 
max
, 
a
);

42 
cÚ¡¿š_št
(
a
, 
mš
, 
max
);

43 
¿nd_sÿË
(
s
);

44 
¿nd_št
(
mš
, 
max
);

45 
m—n_¬¿ys
(**
a
, 
n
, 
–s
, *
avg
);

46 
di¡_¬¿y
(*
a
, *
b
, 
n
, 
sub
);

47 **
Úe_hÙ_’code
(*
a
, 
n
, 
k
);

48 
£c
(
şock_t
 
şocks
);

49 
´št_¡©i¡ics
(*
a
, 
n
);

50 
št_šdex
(*
a
, 
v®
, 
n
);

52 
¿nd_nÜm®_ms
(
mu
, 
sigma
);

	@host/src/yolo_layer.c

1 
	~"yŞo_Ïy”.h
"

2 
	~"aùiv©iÚs.h
"

3 
	~"bÏs.h
"

4 
	~"box.h
"

5 
	~"cuda.h
"

6 
	~"uts.h
"

8 
	~<¡dio.h
>

9 
	~<as£¹.h
>

10 
	~<¡ršg.h
>

11 
	~<¡dlib.h
>

13 
Ïy”
 
	$make_yŞo_Ïy”
(
b©ch
, 
w
, 
h
, 
n
, 
tÙ®
, *
mask
, 
şas£s
)

15 
i
;

16 
Ïy”
 
l
 = {0};

17 
l
.
ty³
 = 
YOLO
;

19 
l
.
n
 =‚;

20 
l
.
tÙ®
 =otal;

21 
l
.
b©ch
 = batch;

22 
l
.
h
 = h;

23 
l
.
w
 = w;

24 
l
.
c
 = 
n
*(
şas£s
 + 4 + 1);

25 
l
.
out_w
 =†.
w
;

26 
l
.
out_h
 =†.
h
;

27 
l
.
out_c
 =†.
c
;

28 
l
.
şas£s
 = classes;

29 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

30 
l
.
bŸ£s
 = 
	`ÿÎoc
(
tÙ®
*2, ());

31 if(
mask
è
l
.mask = mask;

33 
l
.
mask
 = 
	`ÿÎoc
(
n
, ());

34 
i
 = 0; i < 
n
; ++i){

35 
l
.
mask
[
i
] = i;

38 
l
.
bŸs_upd©es
 = 
	`ÿÎoc
(
n
*2, ());

39 
l
.
ouuts
 = 
h
*
w
*
n
*(
şas£s
 + 4 + 1);

40 
l
.
šputs
 =†.
ouuts
;

41 
l
.
Œuths
 = 90*(4 + 1);

42 
l
.
d–
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

43 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*l.
ouuts
, ());

44 
i
 = 0; i < 
tÙ®
*2; ++i){

45 
l
.
bŸ£s
[
i
] = .5;

48 
l
.
fÜw¬d
 = 
fÜw¬d_yŞo_Ïy”
;

49 
l
.
backw¬d
 = 
backw¬d_yŞo_Ïy”
;

50 #ifdeà
GPU


51 
l
.
fÜw¬d_gpu
 = 
fÜw¬d_yŞo_Ïy”_gpu
;

52 
l
.
backw¬d_gpu
 = 
backw¬d_yŞo_Ïy”_gpu
;

53 
l
.
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö.
ouut
, 
b©ch
*l.
ouuts
);

54 
l
.
d–_gpu
 = 
	`cuda_make_¬¿y
Ö.
d–
, 
b©ch
*l.
ouuts
);

57 
	`årštf
(
¡d”r
, "yolo\n");

58 
	`¤ªd
(0);

60  
l
;

61 
	}
}

63 
	$»size_yŞo_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
)

65 
l
->
w
 = w;

66 
l
->
h
 = h;

68 
l
->
ouuts
 = 
h
*
w
*l->
n
*Ö->
şas£s
 + 4 + 1);

69 
l
->
šputs
 =†->
ouuts
;

71 
l
->
ouut
 = 
	`»®loc
Ö->ouut,†->
b©ch
*l->
ouuts
*());

72 
l
->
d–
 = 
	`»®loc
Ö->d–,†->
b©ch
*l->
ouuts
*());

74 #ifdeà
GPU


75 
	`cuda_ä“
(
l
->
d–_gpu
);

76 
	`cuda_ä“
(
l
->
ouut_gpu
);

78 
l
->
d–_gpu
 = 
	`cuda_make_¬¿y
Ö->
d–
,†->
b©ch
*l->
ouuts
);

79 
l
->
ouut_gpu
 = 
	`cuda_make_¬¿y
Ö->
ouut
,†->
b©ch
*l->
ouuts
);

81 
	}
}

83 
box
 
	$g‘_yŞo_box
(*
x
, *
bŸ£s
, 
n
, 
šdex
, 
i
, 
j
, 
lw
, 
lh
, 
w
, 
h
, 
¡ride
)

85 
box
 
b
;

86 
b
.
x
 = (
i
 + x[
šdex
 + 0*
¡ride
]è/ 
lw
;

87 
b
.
y
 = (
j
 + 
x
[
šdex
 + 1*
¡ride
]è/ 
lh
;

88 
b
.
w
 = 
	`exp
(
x
[
šdex
 + 2*
¡ride
]è* 
bŸ£s
[2*
n
] / w;

89 
b
.
h
 = 
	`exp
(
x
[
šdex
 + 3*
¡ride
]è* 
bŸ£s
[2*
n
+1] / h;

90  
b
;

91 
	}
}

93 
	$d–_yŞo_box
(
box
 
Œuth
, *
x
, *
bŸ£s
, 
n
, 
šdex
, 
i
, 
j
, 
lw
, 
lh
, 
w
, 
h
, *
d–
, 
sÿË
, 
¡ride
)

95 
box
 
´ed
 = 
	`g‘_yŞo_box
(
x
, 
bŸ£s
, 
n
, 
šdex
, 
i
, 
j
, 
lw
, 
lh
, 
w
, 
h
, 
¡ride
);

96 
iou
 = 
	`box_iou
(
´ed
, 
Œuth
);

98 
tx
 = (
Œuth
.
x
*
lw
 - 
i
);

99 
ty
 = (
Œuth
.
y
*
lh
 - 
j
);

100 
tw
 = 
	`log
(
Œuth
.
w
*w / 
bŸ£s
[2*
n
]);

101 
th
 = 
	`log
(
Œuth
.
h
*h / 
bŸ£s
[2*
n
 + 1]);

103 
d–
[
šdex
 + 0*
¡ride
] = 
sÿË
 * (
tx
 - 
x
[index + 0*stride]);

104 
d–
[
šdex
 + 1*
¡ride
] = 
sÿË
 * (
ty
 - 
x
[index + 1*stride]);

105 
d–
[
šdex
 + 2*
¡ride
] = 
sÿË
 * (
tw
 - 
x
[index + 2*stride]);

106 
d–
[
šdex
 + 3*
¡ride
] = 
sÿË
 * (
th
 - 
x
[index + 3*stride]);

107  
iou
;

108 
	}
}

111 
	$d–_yŞo_şass
(*
ouut
, *
d–
, 
šdex
, 
şass
, 
şas£s
, 
¡ride
, *
avg_ÿt
)

113 
n
;

114 ià(
d–
[
šdex
]){

115 
d–
[
šdex
 + 
¡ride
*
şass
] = 1 - 
ouut
[index + stride*class];

116 if(
avg_ÿt
è*avg_ÿˆ+ğ
ouut
[
šdex
 + 
¡ride
*
şass
];

119 
n
 = 0;‚ < 
şas£s
; ++n){

120 
d–
[
šdex
 + 
¡ride
*
n
] = (Ò =ğ
şass
)?1 : 0è- 
ouut
[index + stride*n];

121 if(
n
 =ğ
şass
 && 
avg_ÿt
è*avg_ÿˆ+ğ
ouut
[
šdex
 + 
¡ride
*n];

123 
	}
}

125 
	$’Œy_šdex
(
Ïy”
 
l
, 
b©ch
, 
loÿtiÚ
, 
’Œy
)

127 
n
 = 
loÿtiÚ
 / (
l
.
w
*l.
h
);

128 
loc
 = 
loÿtiÚ
 % (
l
.
w
*l.
h
);

129  
b©ch
*
l
.
ouuts
 + 
n
*l.
w
*l.
h
*(4+l.
şas£s
+1è+ 
’Œy
*l.w*l.h + 
loc
;

130 
	}
}

132 
	$fÜw¬d_yŞo_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

134 
i
,
j
,
b
,
t
,
n
;

135 
	`memıy
(
l
.
ouut
, 
Ãt
.
šput
,†.
ouuts
*l.
b©ch
*());

137 #iâdeà
GPU


138 
b
 = 0; b < 
l
.
b©ch
; ++b){

139 
n
 = 0;‚ < 
l
.n; ++n){

140 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 0);

141 
	`aùiv©e_¬¿y
(
l
.
ouut
 + 
šdex
, 2*l.
w
*l.
h
, 
LOGISTIC
);

142 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 4);

143 
	`aùiv©e_¬¿y
(
l
.
ouut
 + 
šdex
, (1+l.
şas£s
)*l.
w
*l.
h
, 
LOGISTIC
);

148 
	`mem£t
(
l
.
d–
, 0,†.
ouuts
 *†.
b©ch
 * ());

149 if(!
Ãt
.
Œaš
) ;

150 
avg_iou
 = 0;

151 
»ÿÎ
 = 0;

152 
»ÿÎ75
 = 0;

153 
avg_ÿt
 = 0;

154 
avg_obj
 = 0;

155 
avg_ªyobj
 = 0;

156 
couÁ
 = 0;

157 
şass_couÁ
 = 0;

158 *(
l
.
co¡
) = 0;

159 
b
 = 0; b < 
l
.
b©ch
; ++b) {

160 
j
 = 0; j < 
l
.
h
; ++j) {

161 
i
 = 0; i < 
l
.
w
; ++i) {

162 
n
 = 0;‚ < 
l
.n; ++n) {

163 
box_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 0);

164 
box
 
´ed
 = 
	`g‘_yŞo_box
(
l
.
ouut
,†.
bŸ£s
,†.
mask
[
n
], 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
, 
Ãt
.w,‚et.h,†.w*l.h);

165 
be¡_iou
 = 0;

166 
be¡_t
 = 0;

167 
t
 = 0; < 
l
.
max_boxes
; ++t){

168 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
t
*(4 + 1è+ 
b
*
l
.
Œuths
, 1);

169 if(!
Œuth
.
x
) ;

170 
iou
 = 
	`box_iou
(
´ed
, 
Œuth
);

171 ià(
iou
 > 
be¡_iou
) {

172 
be¡_iou
 = 
iou
;

173 
be¡_t
 = 
t
;

176 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 4);

177 
avg_ªyobj
 +ğ
l
.
ouut
[
obj_šdex
];

178 
l
.
d–
[
obj_šdex
] = 0 -†.
ouut
[obj_index];

179 ià(
be¡_iou
 > 
l
.
ignÜe_th»sh
) {

180 
l
.
d–
[
obj_šdex
] = 0;

182 ià(
be¡_iou
 > 
l
.
Œuth_th»sh
) {

183 
l
.
d–
[
obj_šdex
] = 1 -†.
ouut
[obj_index];

185 
şass
 = 
Ãt
.
Œuth
[
be¡_t
*(4 + 1è+ 
b
*
l
.
Œuths
 + 4];

186 ià(
l
.
m­
è
şass
 =†.map[class];

187 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 4 + 1);

188 
	`d–_yŞo_şass
(
l
.
ouut
,†.
d–
, 
şass_šdex
, 
şass
,†.
şas£s
,†.
w
*l.
h
, 0);

189 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
be¡_t
*(4 + 1è+ 
b
*
l
.
Œuths
, 1);

190 
	`d–_yŞo_box
(
Œuth
, 
l
.
ouut
,†.
bŸ£s
,†.
mask
[
n
], 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
, 
Ãt
.w,‚‘.h,†.
d–
, (2-truth.w*truth.h),†.w*l.h);

195 
t
 = 0; < 
l
.
max_boxes
; ++t){

196 
box
 
Œuth
 = 
	`æßt_to_box
(
Ãt
.Œuth + 
t
*(4 + 1è+ 
b
*
l
.
Œuths
, 1);

198 if(!
Œuth
.
x
) ;

199 
be¡_iou
 = 0;

200 
be¡_n
 = 0;

201 
i
 = (
Œuth
.
x
 * 
l
.
w
);

202 
j
 = (
Œuth
.
y
 * 
l
.
h
);

203 
box
 
Œuth_shiá
 = 
Œuth
;

204 
Œuth_shiá
.
x
 =ruth_shiá.
y
 = 0;

205 
n
 = 0;‚ < 
l
.
tÙ®
; ++n){

206 
box
 
´ed
 = {0};

207 
´ed
.
w
 = 
l
.
bŸ£s
[2*
n
]/
Ãt
.w;

208 
´ed
.
h
 = 
l
.
bŸ£s
[2*
n
+1]/
Ãt
.h;

209 
iou
 = 
	`box_iou
(
´ed
, 
Œuth_shiá
);

210 ià(
iou
 > 
be¡_iou
){

211 
be¡_iou
 = 
iou
;

212 
be¡_n
 = 
n
;

216 
mask_n
 = 
	`št_šdex
(
l
.
mask
, 
be¡_n
,†.
n
);

217 if(
mask_n
 >= 0){

218 
box_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
mask_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 0);

219 
iou
 = 
	`d–_yŞo_box
(
Œuth
, 
l
.
ouut
,†.
bŸ£s
, 
be¡_n
, 
box_šdex
, 
i
, 
j
,†.
w
,†.
h
, 
Ãt
.w,‚‘.h,†.
d–
, (2-truth.w*truth.h),†.w*l.h);

221 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
mask_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 4);

222 
avg_obj
 +ğ
l
.
ouut
[
obj_šdex
];

223 
l
.
d–
[
obj_šdex
] = 1 -†.
ouut
[obj_index];

225 
şass
 = 
Ãt
.
Œuth
[
t
*(4 + 1è+ 
b
*
l
.
Œuths
 + 4];

226 ià(
l
.
m­
è
şass
 =†.map[class];

227 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
mask_n
*l.
w
*l.
h
 + 
j
*l.w + 
i
, 4 + 1);

228 
	`d–_yŞo_şass
(
l
.
ouut
,†.
d–
, 
şass_šdex
, 
şass
,†.
şas£s
,†.
w
*l.
h
, &
avg_ÿt
);

230 ++
couÁ
;

231 ++
şass_couÁ
;

232 if(
iou
 > .5è
»ÿÎ
 += 1;

233 if(
iou
 > .75è
»ÿÎ75
 += 1;

234 
avg_iou
 +ğ
iou
;

238 *(
l
.
co¡
èğ
	`pow
(
	`mag_¬¿y
Ö.
d–
,†.
ouuts
 *†.
b©ch
), 2);

239 
	`´štf
("RegiÚ %d Avg IOU: %f, CÏss: %f, Obj: %f, NØObj: %f, .5R: %f, .75R: %f, couÁ: %d\n", 
Ãt
.
šdex
, 
avg_iou
/
couÁ
, 
avg_ÿt
/
şass_couÁ
, 
avg_obj
/couÁ, 
avg_ªyobj
/(
l
.
w
*l.
h
*l.
n
*l.
b©ch
), 
»ÿÎ
/couÁ, 
»ÿÎ75
/count, count);

240 
	}
}

242 
	$backw¬d_yŞo_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

244 
	`axpy_ıu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

245 
	}
}

247 
	$cÜ»ù_yŞo_boxes
(
d‘eùiÚ
 *
d‘s
, 
n
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
»Ïtive
)

249 
i
;

250 
Ãw_w
=0;

251 
Ãw_h
=0;

252 ià((()
Ãtw
/
w
è< (()
Ãth
/
h
)) {

253 
Ãw_w
 = 
Ãtw
;

254 
Ãw_h
 = (
h
 * 
Ãtw
)/
w
;

256 
Ãw_h
 = 
Ãth
;

257 
Ãw_w
 = (
w
 * 
Ãth
)/
h
;

259 
i
 = 0; i < 
n
; ++i){

260 
box
 
b
 = 
d‘s
[
i
].
bbox
;

261 
b
.
x
 = (b.x - (
Ãtw
 - 
Ãw_w
)/2./netw) / (()new_w/netw);

262 
b
.
y
 = (b.y - (
Ãth
 - 
Ãw_h
)/2./neth) / (()new_h/neth);

263 
b
.
w
 *ğ()
Ãtw
/
Ãw_w
;

264 
b
.
h
 *ğ()
Ãth
/
Ãw_h
;

265 if(!
»Ïtive
){

266 
b
.
x
 *ğ
w
;

267 
b
.
w
 *= w;

268 
b
.
y
 *ğ
h
;

269 
b
.
h
 *= h;

271 
d‘s
[
i
].
bbox
 = 
b
;

273 
	}
}

275 
	$yŞo_num_d‘eùiÚs
(
Ïy”
 
l
, 
th»sh
)

277 
i
, 
n
;

278 
couÁ
 = 0;

279 
i
 = 0; i < 
l
.
w
*l.
h
; ++i){

280 
n
 = 0;‚ < 
l
.n; ++n){

281 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
, 4);

282 if(
l
.
ouut
[
obj_šdex
] > 
th»sh
){

283 ++
couÁ
;

287  
couÁ
;

288 
	}
}

290 
	$avg_æ³d_yŞo
(
Ïy”
 
l
)

292 
i
,
j
,
n
,
z
;

293 *
æ
 = 
l
.
ouut
 +†.
ouuts
;

294 
j
 = 0; j < 
l
.
h
; ++j) {

295 
i
 = 0; i < 
l
.
w
/2; ++i) {

296 
n
 = 0;‚ < 
l
.n; ++n) {

297 
z
 = 0; z < 
l
.
şas£s
 + 4 + 1; ++z){

298 
i1
 = 
z
*
l
.
w
*l.
h
*l.
n
 +‚*l.w*l.h + 
j
*l.w + 
i
;

299 
i2
 = 
z
*
l
.
w
*l.
h
*l.
n
 +‚*l.w*l.h + 
j
*l.w + (l.w - 
i
 - 1);

300 
sw­
 = 
æ
[
i1
];

301 
æ
[
i1
] = fl[
i2
];

302 
æ
[
i2
] = 
sw­
;

303 if(
z
 == 0){

304 
æ
[
i1
] = -flip[i1];

305 
æ
[
i2
] = -flip[i2];

311 
i
 = 0; i < 
l
.
ouuts
; ++i){

312 
l
.
ouut
[
i
] = (l.ouut[i] + 
æ
[i])/2.;

314 
	}
}

316 
	$g‘_yŞo_d‘eùiÚs
(
Ïy”
 
l
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
th»sh
, *
m­
, 
»Ïtive
, 
d‘eùiÚ
 *
d‘s
)

318 
i
,
j
,
n
;

319 *
´ediùiÚs
 = 
l
.
ouut
;

320 ià(
l
.
b©ch
 =ğ2è
	`avg_æ³d_yŞo
(l);

321 
couÁ
 = 0;

322 
i
 = 0; i < 
l
.
w
*l.
h
; ++i){

323 
row
 = 
i
 / 
l
.
w
;

324 
cŞ
 = 
i
 % 
l
.
w
;

325 
n
 = 0;‚ < 
l
.n; ++n){

326 
obj_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
, 4);

327 
objeùÃss
 = 
´ediùiÚs
[
obj_šdex
];

328 if(
objeùÃss
 <ğ
th»sh
) ;

329 
box_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
, 0);

330 
d‘s
[
couÁ
].
bbox
 = 
	`g‘_yŞo_box
(
´ediùiÚs
, 
l
.
bŸ£s
,†.
mask
[
n
], 
box_šdex
, 
cŞ
, 
row
,†.
w
,†.
h
, 
Ãtw
, 
Ãth
,†.w*l.h);

331 
d‘s
[
couÁ
].
objeùÃss
 = objectness;

332 
d‘s
[
couÁ
].
şas£s
 = 
l
.classes;

333 
j
 = 0; j < 
l
.
şas£s
; ++j){

334 
şass_šdex
 = 
	`’Œy_šdex
(
l
, 0, 
n
*l.
w
*l.
h
 + 
i
, 4 + 1 + 
j
);

335 
´ob
 = 
objeùÃss
*
´ediùiÚs
[
şass_šdex
];

336 
d‘s
[
couÁ
].
´ob
[
j
] = (´ob > 
th»sh
) ?…rob : 0;

338 ++
couÁ
;

341 
	`cÜ»ù_yŞo_boxes
(
d‘s
, 
couÁ
, 
w
, 
h
, 
Ãtw
, 
Ãth
, 
»Ïtive
);

342  
couÁ
;

343 
	}
}

345 #ifdeà
GPU


347 
	$fÜw¬d_yŞo_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

349 
	`cİy_gpu
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput_gpu
, 1,†.
ouut_gpu
, 1);

350 
b
, 
n
;

351 
b
 = 0; b < 
l
.
b©ch
; ++b){

352 
n
 = 0;‚ < 
l
.n; ++n){

353 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 0);

354 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
 + 
šdex
, 2*l.
w
*l.
h
, 
LOGISTIC
);

355 
šdex
 = 
	`’Œy_šdex
(
l
, 
b
, 
n
*l.
w
*l.
h
, 4);

356 
	`aùiv©e_¬¿y_gpu
(
l
.
ouut_gpu
 + 
šdex
, (1+l.
şas£s
)*l.
w
*l.
h
, 
LOGISTIC
);

359 if(!
Ãt
.
Œaš
 || 
l
.
ÚlyfÜw¬d
){

360 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
,†.
ouut
,†.
b©ch
*l.
ouuts
);

364 
	`cuda_puÎ_¬¿y
(
l
.
ouut_gpu
, 
Ãt
.
šput
,†.
b©ch
*l.
šputs
);

365 
	`fÜw¬d_yŞo_Ïy”
(
l
, 
Ãt
);

366 
	`cuda_push_¬¿y
(
l
.
d–_gpu
,†.
d–
,†.
b©ch
*l.
ouuts
);

367 
	}
}

369 
	$backw¬d_yŞo_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
)

371 
	`axpy_gpu
(
l
.
b©ch
*l.
šputs
, 1,†.
d–_gpu
, 1, 
Ãt
.delta_gpu, 1);

372 
	}
}

	@host/src/yolo_layer.h

1 #iâdeà
YOLO_LAYER_H


2 
	#YOLO_LAYER_H


	)

4 
	~"d¬kÃt.h
"

5 
	~"Ïy”.h
"

6 
	~"ÃtwÜk.h
"

8 
Ïy”
 
make_yŞo_Ïy”
(
b©ch
, 
w
, 
h
, 
n
, 
tÙ®
, *
mask
, 
şas£s
);

9 
fÜw¬d_yŞo_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

10 
backw¬d_yŞo_Ïy”
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

11 
»size_yŞo_Ïy”
(
Ïy”
 *
l
, 
w
, 
h
);

12 
yŞo_num_d‘eùiÚs
(
Ïy”
 
l
, 
th»sh
);

14 #ifdeà
GPU


15 
fÜw¬d_yŞo_Ïy”_gpu
(cÚ¡ 
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

16 
backw¬d_yŞo_Ïy”_gpu
(
Ïy”
 
l
, 
ÃtwÜk
 
Ãt
);

	@ta/activations_TA.c

1 
	~"aùiv©iÚs_TA.h
"

3 
	~<¡dio.h
>

4 
	~<¡dlib.h
>

5 
	~<¡ršg.h
>

7 *
	$g‘_aùiv©iÚ_¡ršg_TA
(
ACTIVATION_TA
 
a
)

9 
a
){

10 
LOGISTIC_TA
:

12 
LOGGY_TA
:

14 
RELU_TA
:

16 
ELU_TA
:

18 
SELU_TA
:

20 
RELIE_TA
:

22 
RAMP_TA
:

24 
LINEAR_TA
:

26 
TANH_TA
:

28 
PLSE_TA
:

30 
LEAKY_TA
:

32 
STAIR_TA
:

34 
HARDTAN_TA
:

36 
LHTAN_TA
:

42 
	}
}

44 
ACTIVATION_TA
 
	$g‘_aùiv©iÚ_TA
(*
s
)

46 ià(
	`¡rcmp
(
s
, "logi¡ic")==0è 
LOGISTIC_TA
;

47 ià(
	`¡rcmp
(
s
, "loggy")==0è 
LOGGY_TA
;

48 ià(
	`¡rcmp
(
s
, "»lu")==0è 
RELU_TA
;

49 ià(
	`¡rcmp
(
s
, "–u")==0è 
ELU_TA
;

50 ià(
	`¡rcmp
(
s
, "£lu")==0è 
SELU_TA
;

51 ià(
	`¡rcmp
(
s
, "»l›")==0è 
RELIE_TA
;

52 ià(
	`¡rcmp
(
s
, "¶£")==0è 
PLSE_TA
;

53 ià(
	`¡rcmp
(
s
, "h¬dn")==0è 
HARDTAN_TA
;

54 ià(
	`¡rcmp
(
s
, "lhn")==0è 
LHTAN_TA
;

55 ià(
	`¡rcmp
(
s
, "lš—r")==0è 
LINEAR_TA
;

56 ià(
	`¡rcmp
(
s
, "¿mp")==0è 
RAMP_TA
;

57 ià(
	`¡rcmp
(
s
, "Ëaky")==0è 
LEAKY_TA
;

58 ià(
	`¡rcmp
(
s
, "nh")==0è 
TANH_TA
;

59 ià(
	`¡rcmp
(
s
, "¡aœ")==0è 
STAIR_TA
;

61  
RELU_TA
;

62 
	}
}

66 
	$aùiv©e_TA
(
x
, 
ACTIVATION_TA
 
a
)

68 
a
){

69 
LINEAR_TA
:

70  
	`lš—r_aùiv©e_TA
(
x
);

71 
LOGISTIC_TA
:

72  
	`logi¡ic_aùiv©e_TA
(
x
);

73 
LOGGY_TA
:

74  
	`loggy_aùiv©e_TA
(
x
);

75 
RELU_TA
:

76  
	`»lu_aùiv©e_TA
(
x
);

77 
ELU_TA
:

78  
	`–u_aùiv©e_TA
(
x
);

79 
SELU_TA
:

80  
	`£lu_aùiv©e_TA
(
x
);

81 
RELIE_TA
:

82  
	`»l›_aùiv©e_TA
(
x
);

83 
RAMP_TA
:

84  
	`¿mp_aùiv©e_TA
(
x
);

85 
LEAKY_TA
:

86  
	`Ëaky_aùiv©e_TA
(
x
);

87 
TANH_TA
:

88  
	`nh_aùiv©e_TA
(
x
);

89 
PLSE_TA
:

90  
	`¶£_aùiv©e_TA
(
x
);

91 
STAIR_TA
:

92  
	`¡aœ_aùiv©e_TA
(
x
);

93 
HARDTAN_TA
:

94  
	`h¬dn_aùiv©e_TA
(
x
);

95 
LHTAN_TA
:

96  
	`lhn_aùiv©e_TA
(
x
);

99 
	}
}

101 * 
	$aùiv©e_¬¿y_TA
(*
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION_TA
 
a
)

103 
i
;

104 
i
 = 0; i < 
n
; ++i){

105 
x
[
i
] = 
	`aùiv©e_TA
(x[i], 
a
);

107  
x
;

108 
	}
}

111 
	$g¿d›Á_TA
(
x
, 
ACTIVATION_TA
 
a
)

113 
a
){

114 
LINEAR_TA
:

115  
	`lš—r_g¿d›Á_TA
(
x
);

116 
LOGISTIC_TA
:

117  
	`logi¡ic_g¿d›Á_TA
(
x
);

118 
LOGGY_TA
:

119  
	`loggy_g¿d›Á_TA
(
x
);

120 
RELU_TA
:

121  
	`»lu_g¿d›Á_TA
(
x
);

122 
ELU_TA
:

123  
	`–u_g¿d›Á_TA
(
x
);

124 
SELU_TA
:

125  
	`£lu_g¿d›Á_TA
(
x
);

126 
RELIE_TA
:

127  
	`»l›_g¿d›Á_TA
(
x
);

128 
RAMP_TA
:

129  
	`¿mp_g¿d›Á_TA
(
x
);

130 
LEAKY_TA
:

131  
	`Ëaky_g¿d›Á_TA
(
x
);

132 
TANH_TA
:

133  
	`nh_g¿d›Á_TA
(
x
);

134 
PLSE_TA
:

135  
	`¶£_g¿d›Á_TA
(
x
);

136 
STAIR_TA
:

137  
	`¡aœ_g¿d›Á_TA
(
x
);

138 
HARDTAN_TA
:

139  
	`h¬dn_g¿d›Á_TA
(
x
);

140 
LHTAN_TA
:

141  
	`lhn_g¿d›Á_TA
(
x
);

144 
	}
}

146 * 
	$g¿d›Á_¬¿y_TA
(cÚ¡ *
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION_TA
 
a
, *
d–
)

148 
i
;

149 
i
 = 0; i < 
n
; ++i){

150 
d–
[
i
] *ğ
	`g¿d›Á_TA
(
x
[i], 
a
);

152  
d–
;

153 
	}
}

	@ta/aes-gcm-entry.c

5 
	#AES_DEBUG


	)

7 
	~"«s.h
"

9 cÚ¡ 
	gt3_key
[] = {

12 cÚ¡ 
	gt3_iv
[] = {

15 cÚ¡ 
	gt3_¯d
[] = {};

24 cÚ¡ 
	gt3_g
[] = {

29 
	$«s_gcm_’Œy
(*
xüy±
, 
ušt8_t
 *
g¿d›Á
, ušt8_ˆ*
g_bufãr
, 
size
)

31 
»suÉ
;

35 
size
 = siz* (
ušt8_t
);

36 *
t3_¶aš
 = (*)
g¿d›Á
;

38 * 
g_buf
 = (*)
g_bufãr
;

40 if(
	`¡ºcmp
(
xüy±
, "encrypt", 2) == 0)

42 * 
üy±_buf
 = 
	`ÿÎoc
(1,
size
);

43 
»suÉ
 = 
	`«s_gcm_«
(
t3_key
, (t3_key),

44 
t3_iv
, (t3_iv),

45 
t3_¶aš
, 
size
,

46 
t3_¯d
, (t3_aad),

47 
üy±_buf
, 
g_buf
);

48 
	`memıy
(
g¿d›Á
, (
ušt8_t
 *)
üy±_buf
, 
size
);

49 
	`ä“
(
üy±_buf
);

51 if(
	`¡ºcmp
(
xüy±
, "decrypt", 2) == 0)

53 * 
¶aš_buf
 = 
	`ÿÎoc
(1,
size
);

54 
»suÉ
 = 
	`«s_gcm_ad
(
t3_key
, (t3_key),

55 
t3_iv
, (t3_iv),

56 
t3_¶aš
, 
size
,

57 
t3_¯d
, (t3_aad),

58 
g_buf
, 
¶aš_buf
);

59 
	`memıy
(
g¿d›Á
, (
ušt8_t
 *)
¶aš_buf
, 
size
);

60 
	`ä“
(
¶aš_buf
);

64 
	`´štf
("\n Incorrect‡rgument for AES_GCM\n");

65 
»suÉ
 = -1;

68  
»suÉ
;

69 
	}
}

	@ta/aes-gcm.c

10 
	~"«s.h
"

12 
	$šc32
(
«s_uch¬
 *
block
)

14 
«s_ušt
 
v®
;

15 
v®
 = 
	`AES_GET_BE32
(
block
 + 
AES_BLOCK_SIZE
 - 4);

16 
v®
++;

17 
	`AES_PUT_BE32
(
block
 + 
AES_BLOCK_SIZE
 - 4, 
v®
);

18 
	}
}

21 
	$xÜ_block
(
«s_uch¬
 *
d¡
, cÚ¡‡es_uch¬ *
¤c
)

23 
«s_ušt
 *
d
 = («s_ušˆ*è
d¡
;

24 
«s_ušt
 *
s
 = («s_ušˆ*è
¤c
;

25 *
d
++ ^ğ*
s
++;

26 *
d
++ ^ğ*
s
++;

27 *
d
++ ^ğ*
s
++;

28 *
d
++ ^ğ*
s
++;

29 
	}
}

32 
	$shiá_right_block
(
«s_uch¬
 *
v
)

34 
«s_ušt
 
v®
;

36 
v®
 = 
	`AES_GET_BE32
(
v
 + 12);

37 
v®
 >>= 1;

38 ià(
v
[11] & 0x01)

39 
v®
 |= 0x80000000;

40 
	`AES_PUT_BE32
(
v
 + 12, 
v®
);

42 
v®
 = 
	`AES_GET_BE32
(
v
 + 8);

43 
v®
 >>= 1;

44 ià(
v
[7] & 0x01)

45 
v®
 |= 0x80000000;

46 
	`AES_PUT_BE32
(
v
 + 8, 
v®
);

48 
v®
 = 
	`AES_GET_BE32
(
v
 + 4);

49 
v®
 >>= 1;

50 ià(
v
[3] & 0x01)

51 
v®
 |= 0x80000000;

52 
	`AES_PUT_BE32
(
v
 + 4, 
v®
);

54 
v®
 = 
	`AES_GET_BE32
(
v
);

55 
v®
 >>= 1;

56 
	`AES_PUT_BE32
(
v
, 
v®
);

57 
	}
}

61 
	$gf_muÉ
(cÚ¡ 
«s_uch¬
 *
x
, cÚ¡‡es_uch¬ *
y
,‡es_uch¬ *
z
)

63 
«s_uch¬
 
v
[16];

64 
i
, 
j
;

66 
	`mem£t
(
z
, 0, 16);

67 
	`memıy
(
v
, 
y
, 16);

69 
i
 = 0; i < 16; i++) {

70 
j
 = 0; j < 8; j++) {

71 ià(
x
[
i
] & 1 << (7 - 
j
)) {

73 
	`xÜ_block
(
z
, 
v
);

78 ià(
v
[15] & 0x01) {

80 
	`shiá_right_block
(
v
);

82 
v
[0] ^= 0xe1;

85 
	`shiá_right_block
(
v
);

89 
	}
}

92 
	$ghash_¡¬t
(
«s_uch¬
 *
y
)

95 
	`mem£t
(
y
, 0, 16);

96 
	}
}

99 
	$ghash
(cÚ¡ 
«s_uch¬
 *
h
, cÚ¡‡es_uch¬ *
x
, 
size_t
 
xËn
,‡es_uch¬ *
y
)

101 
size_t
 
m
, 
i
;

102 cÚ¡ 
«s_uch¬
 *
xpos
 = 
x
;

103 
«s_uch¬
 
tmp
[16];

105 
m
 = 
xËn
 / 16;

107 
i
 = 0; i < 
m
; i++) {

109 
	`xÜ_block
(
y
, 
xpos
);

110 
xpos
 += 16;

115 
	`gf_muÉ
(
y
, 
h
, 
tmp
);

116 
	`memıy
(
y
, 
tmp
, 16);

119 ià(
x
 + 
xËn
 > 
xpos
) {

121 
size_t
 
Ï¡
 = 
x
 + 
xËn
 - 
xpos
;

122 
	`memıy
(
tmp
, 
xpos
, 
Ï¡
);

123 
	`mem£t
(
tmp
 + 
Ï¡
, 0, (tmp) -†ast);

126 
	`xÜ_block
(
y
, 
tmp
);

131 
	`gf_muÉ
(
y
, 
h
, 
tmp
);

132 
	`memıy
(
y
, 
tmp
, 16);

136 
	}
}

139 
	$«s_gùr
(*
«s
, cÚ¡ 
«s_uch¬
 *
icb
, cÚ¡‡es_uch¬ *
x
, 
size_t
 
xËn
,‡es_uch¬ *
y
)

141 
size_t
 
i
, 
n
, 
Ï¡
;

142 
«s_uch¬
 
cb
[
AES_BLOCK_SIZE
], 
tmp
[AES_BLOCK_SIZE];

143 cÚ¡ 
«s_uch¬
 *
xpos
 = 
x
;

144 
«s_uch¬
 *
ypos
 = 
y
;

146 ià(
xËn
 == 0)

149 
n
 = 
xËn
 / 16;

151 
	`memıy
(
cb
, 
icb
, 
AES_BLOCK_SIZE
);

153 
i
 = 0; i < 
n
; i++) {

154 
	`«s_’üy±
(
«s
, 
cb
, 
ypos
);

155 
	`xÜ_block
(
ypos
, 
xpos
);

156 
xpos
 +ğ
AES_BLOCK_SIZE
;

157 
ypos
 +ğ
AES_BLOCK_SIZE
;

158 
	`šc32
(
cb
);

161 
Ï¡
 = 
x
 + 
xËn
 - 
xpos
;

162 ià(
Ï¡
) {

164 
	`«s_’üy±
(
«s
, 
cb
, 
tmp
);

165 
i
 = 0; i < 
Ï¡
; i++)

166 *
ypos
++ = *
xpos
++ ^ 
tmp
[
i
];

168 
	}
}

171 * 
	$«s_gcm_š™_hash_subkey
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
,‡es_uch¬ *
H
)

173 *
«s
;

175 
«s
 = 
	`«s_’üy±_š™
(
key
, 
key_Ën
);

176 ià(
«s
 =ğ
NULL
)

177  
NULL
;

180 
	`mem£t
(
H
, 0, 
AES_BLOCK_SIZE
);

181 
	`«s_’üy±
(
«s
, 
H
, H);

183  
«s
;

184 
	}
}

187 
	$«s_gcm_´•¬e_j0
(cÚ¡ 
«s_uch¬
 *
iv
, 
size_t
 
iv_Ën
, cÚ¡‡es_uch¬ *
H
,‡es_uch¬ *
J0
)

189 
«s_uch¬
 
Ën_buf
[16];

191 ià(
iv_Ën
 == 12) {

193 
	`memıy
(
J0
, 
iv
, 
iv_Ën
);

194 
	`mem£t
(
J0
 + 
iv_Ën
, 0, 
AES_BLOCK_SIZE
 - iv_len);

195 
J0
[
AES_BLOCK_SIZE
 - 1] = 0x01;

201 
	`ghash_¡¬t
(
J0
);

202 
	`ghash
(
H
, 
iv
, 
iv_Ën
, 
J0
);

203 
	`AES_PUT_BE64
(
Ën_buf
, 0);

204 
	`AES_PUT_BE64
(
Ën_buf
 + 8, 
iv_Ën
 * 8);

205 
	`ghash
(
H
, 
Ën_buf
, Ö’_buf), 
J0
);

207 
	}
}

210 
	$«s_gcm_gùr
(*
«s
, cÚ¡ 
«s_uch¬
 *
J0
, cÚ¡‡es_uch¬ *
š
, 
size_t
 
Ën
,

211 
«s_uch¬
 *
out
)

213 
«s_uch¬
 
J0šc
[
AES_BLOCK_SIZE
];

215 ià(
Ën
 == 0)

218 
	`memıy
(
J0šc
, 
J0
, 
AES_BLOCK_SIZE
);

219 
	`šc32
(
J0šc
);

220 
	`«s_gùr
(
«s
, 
J0šc
, 
š
, 
Ën
, 
out
);

221 
	}
}

224 
	$«s_gcm_ghash
(cÚ¡ 
«s_uch¬
 *
H
, cÚ¡‡es_uch¬ *
¯d
, 
size_t
 
¯d_Ën
,

225 cÚ¡ 
«s_uch¬
 *
üy±
, 
size_t
 
üy±_Ën
,‡es_uch¬ *
S
)

227 
«s_uch¬
 
Ën_buf
[16];

235 
	`ghash_¡¬t
(
S
);

236 
	`ghash
(
H
, 
¯d
, 
¯d_Ën
, 
S
);

237 
	`ghash
(
H
, 
üy±
, 
üy±_Ën
, 
S
);

238 
	`AES_PUT_BE64
(
Ën_buf
, 
¯d_Ën
 * 8);

239 
	`AES_PUT_BE64
(
Ën_buf
 + 8, 
üy±_Ën
 * 8);

240 
	`ghash
(
H
, 
Ën_buf
, Ö’_buf), 
S
);

243 
	}
}

249 
	$«s_gcm_«
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
, cÚ¡‡es_uch¬ *
iv
, size_ˆ
iv_Ën
,

250 cÚ¡ 
«s_uch¬
 *
¶aš
, 
size_t
 
¶aš_Ën
,

251 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
,‡es_uch¬ *
üy±
,‡es_uch¬ *
g
)

253 
«s_uch¬
 
H
[
AES_BLOCK_SIZE
];

254 
«s_uch¬
 
J0
[
AES_BLOCK_SIZE
];

255 
«s_uch¬
 
S
[16];

256 *
«s
;

258 
«s
 = 
	`«s_gcm_š™_hash_subkey
(
key
, 
key_Ën
, 
H
);

259 ià(
«s
 =ğ
NULL
)

262 
	`«s_gcm_´•¬e_j0
(
iv
, 
iv_Ën
, 
H
, 
J0
);

265 
	`«s_gcm_gùr
(
«s
, 
J0
, 
¶aš
, 
¶aš_Ën
, 
üy±
);

267 
	`«s_gcm_ghash
(
H
, 
¯d
, 
¯d_Ën
, 
üy±
, 
¶aš_Ën
, 
S
);

270 
	`«s_gùr
(
«s
, 
J0
, 
S
, (S), 
g
);

274 
	`«s_’üy±_deš™
(
«s
);

277 
	}
}

283 
	$«s_gcm_ad
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
, cÚ¡‡es_uch¬ *
iv
, size_ˆ
iv_Ën
,

284 cÚ¡ 
«s_uch¬
 *
üy±
, 
size_t
 
üy±_Ën
,

285 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
, cÚ¡‡es_uch¬ *
g
,‡es_uch¬ *
¶aš
)

287 
«s_uch¬
 
H
[
AES_BLOCK_SIZE
];

288 
«s_uch¬
 
J0
[
AES_BLOCK_SIZE
];

289 
«s_uch¬
 
S
[16], 
T
[16];

290 *
«s
;

292 
«s
 = 
	`«s_gcm_š™_hash_subkey
(
key
, 
key_Ën
, 
H
);

293 ià(
«s
 =ğ
NULL
)

296 
	`«s_gcm_´•¬e_j0
(
iv
, 
iv_Ën
, 
H
, 
J0
);

299 
	`«s_gcm_gùr
(
«s
, 
J0
, 
üy±
, 
üy±_Ën
, 
¶aš
);

301 
	`«s_gcm_ghash
(
H
, 
¯d
, 
¯d_Ën
, 
üy±
, 
üy±_Ën
, 
S
);

304 
	`«s_gùr
(
«s
, 
J0
, 
S
, (S), 
T
);

306 
	`«s_’üy±_deš™
(
«s
);

308 ià(
	`memcmp
(
g
, 
T
, 16) != 0) {

310 
	`EMSG
("\nGCM: Tag mismatch\n");

315 
	}
}

318 
	$«s_gmac
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
, cÚ¡‡es_uch¬ *
iv
, size_ˆ
iv_Ën
,

319 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
,‡es_uch¬ *
g
)

321  
	`«s_gcm_«
(
key
, 
key_Ën
, 
iv
, 
iv_Ën
, 
NULL
, 0, 
¯d
, 
¯d_Ën
, NULL, 
g
);

322 
	}
}

	@ta/aes-internal-enc.c

17 
	~"«s.h
"

18 
	~"«s-š‹º®.h
"

25 
	$«s_rijnd«l_key_£tup_’c
(
«s_ušt
 
rk
[], cÚ¡ 
«s_uch¬
 
ch”Key
[], 
size_t
 
keyB™s
)

27 
i
;

28 
«s_ušt
 
‹mp
;

30 
rk
[0] = 
	`GETU32
(
ch”Key
 );

31 
rk
[1] = 
	`GETU32
(
ch”Key
 + 4);

32 
rk
[2] = 
	`GETU32
(
ch”Key
 + 8);

33 
rk
[3] = 
	`GETU32
(
ch”Key
 + 12);

35 ià(
keyB™s
 == 128) {

36 
i
 = 0; i < 10; i++) {

37 
‹mp
 = 
rk
[3];

38 
rk
[4] =„k[0] ^ 
	`TE421
(
‹mp
è^ 
	`TE432
(temp) ^

39 
	`TE443
(
‹mp
è^ 
	`TE414
Ñempè^ 
	`RCON
(
i
);

40 
rk
[5] =„k[1] ^„k[4];

41 
rk
[6] =„k[2] ^„k[5];

42 
rk
[7] =„k[3] ^„k[6];

43 
rk
 += 4;

48 
rk
[4] = 
	`GETU32
(
ch”Key
 + 16);

49 
rk
[5] = 
	`GETU32
(
ch”Key
 + 20);

51 ià(
keyB™s
 == 192) {

52 
i
 = 0; i < 8; i++) {

53 
‹mp
 = 
rk
[5];

54 
rk
[6] =„k[0] ^ 
	`TE421
(
‹mp
è^ 
	`TE432
(temp) ^

55 
	`TE443
(
‹mp
è^ 
	`TE414
Ñempè^ 
	`RCON
(
i
);

56 
rk
[7] =„k[1] ^„k[6];

57 
rk
[8] =„k[2] ^„k[7];

58 
rk
[9] =„k[3] ^„k[8];

59 ià(
i
 == 7)

61 
rk
[10] =„k[4] ^„k[9];

62 
rk
[11] =„k[5] ^„k[10];

63 
rk
 += 6;

67 
rk
[6] = 
	`GETU32
(
ch”Key
 + 24);

68 
rk
[7] = 
	`GETU32
(
ch”Key
 + 28);

70 ià(
keyB™s
 == 256) {

71 
i
 = 0; i < 7; i++) {

72 
‹mp
 = 
rk
[7];

73 
rk
[8] =„k[0] ^ 
	`TE421
(
‹mp
è^ 
	`TE432
(temp) ^

74 
	`TE443
(
‹mp
è^ 
	`TE414
Ñempè^ 
	`RCON
(
i
);

75 
rk
[9] =„k[1] ^„k[8];

76 
rk
[10] =„k[2] ^„k[9];

77 
rk
[11] =„k[3] ^„k[10];

78 ià(
i
 == 6)

80 
‹mp
 = 
rk
[11];

81 
rk
[12] =„k[4] ^ 
	`TE411
(
‹mp
è^ 
	`TE422
(temp) ^

82 
	`TE433
(
‹mp
è^ 
	`TE444
(temp);

83 
rk
[13] =„k[5] ^„k[12];

84 
rk
[14] =„k[6] ^„k[13];

85 
rk
[15] =„k[7] ^„k[14];

86 
rk
 += 8;

91 
	}
}

93 
	$«s_rijnd«l_’üy±
(cÚ¡ 
«s_ušt
 
rk
[], 
Nr
, cÚ¡ 
«s_uch¬
 
±
[16],‡es_uch¬ 
ù
[16])

95 
«s_ušt
 
s0
, 
s1
, 
s2
, 
s3
, 
t0
, 
t1
, 
t2
, 
t3
;

96 #iâdeà
AES_FULL_UNROLL


97 
r
;

104 
s0
 = 
	`GETU32
(
±
 ) ^ 
rk
[0];

105 
s1
 = 
	`GETU32
(
±
 + 4è^ 
rk
[1];

106 
s2
 = 
	`GETU32
(
±
 + 8è^ 
rk
[2];

107 
s3
 = 
	`GETU32
(
±
 + 12è^ 
rk
[3];

109 
	#ROUND
(
i
,
d
,
s
) \

110 
d
##0 = 
	`TE0
(
s
##0è^ 
	`TE1
(s##1è^ 
	`TE2
(s##2è^ 
	`TE3
(s##3è^ 
rk
[4 * 
i
]; \

111 
d
##1 = 
	`TE0
(
s
##1è^ 
	`TE1
(s##2è^ 
	`TE2
(s##3è^ 
	`TE3
(s##0è^ 
rk
[4 * 
i
 + 1]; \

112 
d
##2 = 
	`TE0
(
s
##2è^ 
	`TE1
(s##3è^ 
	`TE2
(s##0è^ 
	`TE3
(s##1è^ 
rk
[4 * 
i
 + 2]; \

113 
d
##3 = 
	`TE0
(
s
##3è^ 
	`TE1
(s##0è^ 
	`TE2
(s##1è^ 
	`TE3
(s##2è^ 
rk
[4 * 
i
 + 3]

	)

115 #ifdeà
AES_FULL_UNROLL


117 
	`ROUND
(1,
t
,
s
);

118 
	`ROUND
(2,
s
,
t
);

119 
	`ROUND
(3,
t
,
s
);

120 
	`ROUND
(4,
s
,
t
);

121 
	`ROUND
(5,
t
,
s
);

122 
	`ROUND
(6,
s
,
t
);

123 
	`ROUND
(7,
t
,
s
);

124 
	`ROUND
(8,
s
,
t
);

125 
	`ROUND
(9,
t
,
s
);

126 ià(
Nr
 > 10) {

127 
	`ROUND
(10,
s
,
t
);

128 
	`ROUND
(11,
t
,
s
);

129 ià(
Nr
 > 12) {

130 
	`ROUND
(12,
s
,
t
);

131 
	`ROUND
(13,
t
,
s
);

135 
rk
 +ğ
Nr
 << 2;

140 
r
 = 
Nr
 >> 1;

142 
	`ROUND
(1,
t
,
s
);

143 
rk
 += 8;

144 ià(--
r
 == 0)

146 
	`ROUND
(0,
s
,
t
);

151 #undeà
ROUND


157 
s0
 = 
	`TE41
(
t0
è^ 
	`TE42
(
t1
è^ 
	`TE43
(
t2
è^ 
	`TE44
(
t3
è^ 
rk
[0];

158 
	`PUTU32
(
ù
 , 
s0
);

159 
s1
 = 
	`TE41
(
t1
è^ 
	`TE42
(
t2
è^ 
	`TE43
(
t3
è^ 
	`TE44
(
t0
è^ 
rk
[1];

160 
	`PUTU32
(
ù
 + 4, 
s1
);

161 
s2
 = 
	`TE41
(
t2
è^ 
	`TE42
(
t3
è^ 
	`TE43
(
t0
è^ 
	`TE44
(
t1
è^ 
rk
[2];

162 
	`PUTU32
(
ù
 + 8, 
s2
);

163 
s3
 = 
	`TE41
(
t3
è^ 
	`TE42
(
t0
è^ 
	`TE43
(
t1
è^ 
	`TE44
(
t2
è^ 
rk
[3];

164 
	`PUTU32
(
ù
 + 12, 
s3
);

165 
	}
}

170 * 
	$«s_’üy±_š™
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
Ën
)

172 
«s_ušt
 *
rk
;

173 
»s
;

174 
rk
 = 
	`m®loc
(
AES_PRIV_SIZE
);

175 ià(
rk
 =ğ
NULL
)

176  
NULL
;

177 
»s
 = 
	`«s_rijnd«l_key_£tup_’c
(
rk
, 
key
, 
Ën
 * 8);

178 ià(
»s
 < 0) {

179 
	`ä“
(
rk
);

180  
NULL
;

182 
rk
[
AES_PRIV_NR_POS
] = 
»s
;

183  
rk
;

184 
	}
}

187 
	$«s_’üy±
(*
ùx
, cÚ¡ 
«s_uch¬
 *
¶aš
,‡es_uch¬ *
üy±
)

189 
«s_ušt
 *
rk
 = («s_ušˆ*)
ùx
;

190 
	`«s_rijnd«l_’üy±
((
«s_ušt
 *)
ùx
, 
rk
[
AES_PRIV_NR_POS
], 
¶aš
, 
üy±
);

191 
	}
}

194 
	$«s_’üy±_deš™
(*
ùx
)

196 
	`mem£t
(
ùx
, 0, 
AES_PRIV_SIZE
);

197 
	`ä“
(
ùx
);

198 
	}
}

	@ta/aes-internal.c

17 
	~"«s.h
"

18 
	~"«s-š‹º®.h
"

61 cÚ¡ 
«s_ušt
 
	gTe0
[256] = {

127 #iâdeà
AES_SMALL_TABLES


128 cÚ¡ 
«s_ušt
 
	gTe1
[256] = {

194 cÚ¡ 
«s_ušt
 
	gTe2
[256] = {

260 cÚ¡ 
«s_ušt
 
	gTe3
[256] = {

326 cÚ¡ 
«s_ušt
 
	gTe4
[256] = {

393 cÚ¡ 
«s_ušt
 
	gTd0
[256] = {

459 #iâdeà
AES_SMALL_TABLES


460 cÚ¡ 
«s_ušt
 
	gTd1
[256] = {

526 cÚ¡ 
«s_ušt
 
	gTd2
[256] = {

592 cÚ¡ 
«s_ušt
 
	gTd3
[256] = {

658 cÚ¡ 
«s_ušt
 
	gTd4
[256] = {

724 cÚ¡ 
«s_ušt
 
	grcÚ
[] = {

730 cÚ¡ 
«s_uch¬
 
	gTd4s
[256] = {

764 cÚ¡ 
«s_uch¬
 
	grcÚs
[] = {

	@ta/aes_TA.c

38 
	~<¡dšt.h
>

39 
	~<¡ršg.h
>

40 
	~"«s_TA.h
"

46 
	#Nb
 4

	)

48 #ià
defšed
(
AES256
) && (AES256 == 1)

49 
	#Nk
 8

	)

50 
	#Nr
 14

	)

51 #–ià
defšed
(
AES192
) && (AES192 == 1)

52 
	#Nk
 6

	)

53 
	#Nr
 12

	)

55 
	#Nk
 4

56 
	#Nr
 10

58 

	)

62 #iâdeà
MULTIPLY_AS_A_FUNCTION


63 
	#MULTIPLY_AS_A_FUNCTION
 0

	)

73 
ušt8_t
 
	t¡©e_t
[4][4];

80 cÚ¡ 
ušt8_t
 
	gsbox
[256] = {

99 cÚ¡ 
ušt8_t
 
	grsbox
[256] = {

119 cÚ¡ 
ušt8_t
 
	gRcÚ
[11] = {

142 
	#g‘SBoxV®ue
(
num
è(
sbox
[Òum)])

	)

149 
	#g‘SBoxInv”t
(
num
è(
rsbox
[Òum)])

	)

152 
	$KeyEx·nsiÚ
(
ušt8_t
* 
RoundKey
, cÚ¡ ušt8_t* 
Key
)

154 
i
, 
j
, 
k
;

155 
ušt8_t
 
‹m·
[4];

158 
i
 = 0; i < 
Nk
; ++i)

160 
RoundKey
[(
i
 * 4è+ 0] = 
Key
[(i * 4) + 0];

161 
RoundKey
[(
i
 * 4è+ 1] = 
Key
[(i * 4) + 1];

162 
RoundKey
[(
i
 * 4è+ 2] = 
Key
[(i * 4) + 2];

163 
RoundKey
[(
i
 * 4è+ 3] = 
Key
[(i * 4) + 3];

167 
i
 = 
Nk
; i < 
Nb
 * (
Nr
 + 1); ++i)

170 
k
 = (
i
 - 1) * 4;

171 
‹m·
[0]=
RoundKey
[
k
 + 0];

172 
‹m·
[1]=
RoundKey
[
k
 + 1];

173 
‹m·
[2]=
RoundKey
[
k
 + 2];

174 
‹m·
[3]=
RoundKey
[
k
 + 3];

178 ià(
i
 % 
Nk
 == 0)

185 cÚ¡ 
ušt8_t
 
u8tmp
 = 
‹m·
[0];

186 
‹m·
[0] =empa[1];

187 
‹m·
[1] =empa[2];

188 
‹m·
[2] =empa[3];

189 
‹m·
[3] = 
u8tmp
;

197 
‹m·
[0] = 
	`g‘SBoxV®ue
(tempa[0]);

198 
‹m·
[1] = 
	`g‘SBoxV®ue
(tempa[1]);

199 
‹m·
[2] = 
	`g‘SBoxV®ue
(tempa[2]);

200 
‹m·
[3] = 
	`g‘SBoxV®ue
(tempa[3]);

203 
‹m·
[0] =em·[0] ^ 
RcÚ
[
i
/
Nk
];

205 #ià
	`defšed
(
AES256
) && (AES256 == 1)

206 ià(
i
 % 
Nk
 == 4)

210 
‹m·
[0] = 
	`g‘SBoxV®ue
(tempa[0]);

211 
‹m·
[1] = 
	`g‘SBoxV®ue
(tempa[1]);

212 
‹m·
[2] = 
	`g‘SBoxV®ue
(tempa[2]);

213 
‹m·
[3] = 
	`g‘SBoxV®ue
(tempa[3]);

217 
j
 = 
i
 * 4; 
k
=(˜- 
Nk
) * 4;

218 
RoundKey
[
j
 + 0] = RoundKey[
k
 + 0] ^ 
‹m·
[0];

219 
RoundKey
[
j
 + 1] = RoundKey[
k
 + 1] ^ 
‹m·
[1];

220 
RoundKey
[
j
 + 2] = RoundKey[
k
 + 2] ^ 
‹m·
[2];

221 
RoundKey
[
j
 + 3] = RoundKey[
k
 + 3] ^ 
‹m·
[3];

223 
	}
}

225 
	$AES_š™_ùx
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
key
)

227 
	`KeyEx·nsiÚ
(
ùx
->
RoundKey
, 
key
);

228 
	}
}

229 #ià(
defšed
(
CBC
è&& (CBC =ğ1)è|| (defšed(
CTR
) && (CTR == 1))

230 
	$AES_š™_ùx_iv
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
key
, cÚ¡ ušt8_t* 
iv
)

232 
	`KeyEx·nsiÚ
(
ùx
->
RoundKey
, 
key
);

233 
	`memıy
 (
ùx
->
Iv
, 
iv
, 
AES_BLOCKLEN
);

234 
	}
}

235 
	$AES_ùx_£t_iv
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
iv
)

237 
	`memıy
 (
ùx
->
Iv
, 
iv
, 
AES_BLOCKLEN
);

238 
	}
}

243 
	$AddRoundKey
(
ušt8_t
 
round
, 
¡©e_t
* 
¡©e
, cÚ¡ ušt8_t* 
RoundKey
)

245 
ušt8_t
 
i
,
j
;

246 
i
 = 0; i < 4; ++i)

248 
j
 = 0; j < 4; ++j)

250 (*
¡©e
)[
i
][
j
] ^ğ
RoundKey
[(
round
 * 
Nb
 * 4) + (i * Nb) + j];

253 
	}
}

257 
	$SubBy‹s
(
¡©e_t
* 
¡©e
)

259 
ušt8_t
 
i
, 
j
;

260 
i
 = 0; i < 4; ++i)

262 
j
 = 0; j < 4; ++j)

264 (*
¡©e
)[
j
][
i
] = 
	`g‘SBoxV®ue
((*state)[j][i]);

267 
	}
}

272 
	$ShiáRows
(
¡©e_t
* 
¡©e
)

274 
ušt8_t
 
‹mp
;

277 
‹mp
 = (*
¡©e
)[0][1];

278 (*
¡©e
)[0][1] = (*state)[1][1];

279 (*
¡©e
)[1][1] = (*state)[2][1];

280 (*
¡©e
)[2][1] = (*state)[3][1];

281 (*
¡©e
)[3][1] = 
‹mp
;

284 
‹mp
 = (*
¡©e
)[0][2];

285 (*
¡©e
)[0][2] = (*state)[2][2];

286 (*
¡©e
)[2][2] = 
‹mp
;

288 
‹mp
 = (*
¡©e
)[1][2];

289 (*
¡©e
)[1][2] = (*state)[3][2];

290 (*
¡©e
)[3][2] = 
‹mp
;

293 
‹mp
 = (*
¡©e
)[0][3];

294 (*
¡©e
)[0][3] = (*state)[3][3];

295 (*
¡©e
)[3][3] = (*state)[2][3];

296 (*
¡©e
)[2][3] = (*state)[1][3];

297 (*
¡©e
)[1][3] = 
‹mp
;

298 
	}
}

300 
ušt8_t
 
	$xtime
(
ušt8_t
 
x
)

302  ((
x
<<1) ^ (((x>>7) & 1) * 0x1b));

303 
	}
}

306 
	$MixCŞumns
(
¡©e_t
* 
¡©e
)

308 
ušt8_t
 
i
;

309 
ušt8_t
 
Tmp
, 
Tm
, 
t
;

310 
i
 = 0; i < 4; ++i)

312 
t
 = (*
¡©e
)[
i
][0];

313 
Tmp
 = (*
¡©e
)[
i
][0] ^ (*state)[i][1] ^ (*state)[i][2] ^ (*state)[i][3] ;

314 
Tm
 = (*
¡©e
)[
i
][0] ^ (*¡©e)[i][1] ; Tm = 
	`xtime
(Tm); (*¡©e)[i][0] ^ğTm ^ 
Tmp
 ;

315 
Tm
 = (*
¡©e
)[
i
][1] ^ (*¡©e)[i][2] ; Tm = 
	`xtime
(Tm); (*¡©e)[i][1] ^ğTm ^ 
Tmp
 ;

316 
Tm
 = (*
¡©e
)[
i
][2] ^ (*¡©e)[i][3] ; Tm = 
	`xtime
(Tm); (*¡©e)[i][2] ^ğTm ^ 
Tmp
 ;

317 
Tm
 = (*
¡©e
)[
i
][3] ^ 
t
 ; Tm = 
	`xtime
(Tm); (*¡©e)[i][3] ^ğTm ^ 
Tmp
 ;

319 
	}
}

325 #ià
MULTIPLY_AS_A_FUNCTION


326 
ušt8_t
 
	$MuÉly
(
ušt8_t
 
x
, ušt8_ˆ
y
)

328  (((
y
 & 1è* 
x
) ^

329 ((
y
>>1 & 1è* 
	`xtime
(
x
)) ^

330 ((
y
>>2 & 1è* 
	`xtime
(xtime(
x
))) ^

331 ((
y
>>3 & 1è* 
	`xtime
(xtime(xtime(
x
)))) ^

332 ((
y
>>4 & 1è* 
	`xtime
(xtime(xtime(xtime(
x
))))));

333 
	}
}

335 
	#MuÉly
(
x
, 
y
) \

336 Ğ((
y
 & 1è* 
x
) ^ \

337 ((
y
>>1 & 1è* 
	`xtime
(
x
)) ^ \

338 ((
y
>>2 & 1è* 
	`xtime
(xtime(
x
))) ^ \

339 ((
y
>>3 & 1è* 
	`xtime
(xtime(xtime(
x
)))) ^ \

340 ((
y
>>4 & 1è* 
	`xtime
(xtime(xtime(xtime(
x
)))))) \

341 

	)

344 #ià(
defšed
(
CBC
è&& CBC =ğ1è|| (defšed(
ECB
) && ECB == 1)

348 
	$InvMixCŞumns
(
¡©e_t
* 
¡©e
)

350 
i
;

351 
ušt8_t
 
a
, 
b
, 
c
, 
d
;

352 
i
 = 0; i < 4; ++i)

354 
a
 = (*
¡©e
)[
i
][0];

355 
b
 = (*
¡©e
)[
i
][1];

356 
c
 = (*
¡©e
)[
i
][2];

357 
d
 = (*
¡©e
)[
i
][3];

359 (*
¡©e
)[
i
][0] = 
	`MuÉly
(
a
, 0x0eè^ MuÉly(
b
, 0x0bè^ MuÉly(
c
, 0x0dè^ MuÉly(
d
, 0x09);

360 (*
¡©e
)[
i
][1] = 
	`MuÉly
(
a
, 0x09è^ MuÉly(
b
, 0x0eè^ MuÉly(
c
, 0x0bè^ MuÉly(
d
, 0x0d);

361 (*
¡©e
)[
i
][2] = 
	`MuÉly
(
a
, 0x0dè^ MuÉly(
b
, 0x09è^ MuÉly(
c
, 0x0eè^ MuÉly(
d
, 0x0b);

362 (*
¡©e
)[
i
][3] = 
	`MuÉly
(
a
, 0x0bè^ MuÉly(
b
, 0x0dè^ MuÉly(
c
, 0x09è^ MuÉly(
d
, 0x0e);

364 
	}
}

369 
	$InvSubBy‹s
(
¡©e_t
* 
¡©e
)

371 
ušt8_t
 
i
, 
j
;

372 
i
 = 0; i < 4; ++i)

374 
j
 = 0; j < 4; ++j)

376 (*
¡©e
)[
j
][
i
] = 
	`g‘SBoxInv”t
((*state)[j][i]);

379 
	}
}

381 
	$InvShiáRows
(
¡©e_t
* 
¡©e
)

383 
ušt8_t
 
‹mp
;

386 
‹mp
 = (*
¡©e
)[3][1];

387 (*
¡©e
)[3][1] = (*state)[2][1];

388 (*
¡©e
)[2][1] = (*state)[1][1];

389 (*
¡©e
)[1][1] = (*state)[0][1];

390 (*
¡©e
)[0][1] = 
‹mp
;

393 
‹mp
 = (*
¡©e
)[0][2];

394 (*
¡©e
)[0][2] = (*state)[2][2];

395 (*
¡©e
)[2][2] = 
‹mp
;

397 
‹mp
 = (*
¡©e
)[1][2];

398 (*
¡©e
)[1][2] = (*state)[3][2];

399 (*
¡©e
)[3][2] = 
‹mp
;

402 
‹mp
 = (*
¡©e
)[0][3];

403 (*
¡©e
)[0][3] = (*state)[1][3];

404 (*
¡©e
)[1][3] = (*state)[2][3];

405 (*
¡©e
)[2][3] = (*state)[3][3];

406 (*
¡©e
)[3][3] = 
‹mp
;

407 
	}
}

411 
	$Ch”
(
¡©e_t
* 
¡©e
, cÚ¡ 
ušt8_t
* 
RoundKey
)

413 
ušt8_t
 
round
 = 0;

416 
	`AddRoundKey
(0, 
¡©e
, 
RoundKey
);

421 
round
 = 1;„ound < 
Nr
; ++round)

423 
	`SubBy‹s
(
¡©e
);

424 
	`ShiáRows
(
¡©e
);

425 
	`MixCŞumns
(
¡©e
);

426 
	`AddRoundKey
(
round
, 
¡©e
, 
RoundKey
);

431 
	`SubBy‹s
(
¡©e
);

432 
	`ShiáRows
(
¡©e
);

433 
	`AddRoundKey
(
Nr
, 
¡©e
, 
RoundKey
);

434 
	}
}

436 #ià(
defšed
(
CBC
è&& CBC =ğ1è|| (defšed(
ECB
) && ECB == 1)

437 
	$InvCh”
(
¡©e_t
* 
¡©e
, cÚ¡ 
ušt8_t
* 
RoundKey
)

439 
ušt8_t
 
round
 = 0;

442 
	`AddRoundKey
(
Nr
, 
¡©e
, 
RoundKey
);

447 
round
 = (
Nr
 - 1);„ound > 0; --round)

449 
	`InvShiáRows
(
¡©e
);

450 
	`InvSubBy‹s
(
¡©e
);

451 
	`AddRoundKey
(
round
, 
¡©e
, 
RoundKey
);

452 
	`InvMixCŞumns
(
¡©e
);

457 
	`InvShiáRows
(
¡©e
);

458 
	`InvSubBy‹s
(
¡©e
);

459 
	`AddRoundKey
(0, 
¡©e
, 
RoundKey
);

460 
	}
}

466 #ià
defšed
(
ECB
) && (ECB == 1)

469 
	$AES_ECB_’üy±
(cÚ¡ 
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
)

472 
	`Ch”
((
¡©e_t
*)
buf
, 
ùx
->
RoundKey
);

473 
	}
}

475 
	$AES_ECB_deüy±
(cÚ¡ 
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
)

478 
	`InvCh”
((
¡©e_t
*)
buf
, 
ùx
->
RoundKey
);

479 
	}
}

488 #ià
defšed
(
CBC
) && (CBC == 1)

491 
	$XÜW™hIv
(
ušt8_t
* 
buf
, cÚ¡ ušt8_t* 
Iv
)

493 
ušt8_t
 
i
;

494 
i
 = 0; i < 
AES_BLOCKLEN
; ++i)

496 
buf
[
i
] ^ğ
Iv
[i];

498 
	}
}

500 
	$AES_CBC_’üy±_bufãr
(
AES_ùx
 *
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
)

502 
ušŒ_t
 
i
;

503 
ušt8_t
 *
Iv
 = 
ùx
->Iv;

504 
i
 = 0; i < 
Ëngth
; i +ğ
AES_BLOCKLEN
)

506 
	`XÜW™hIv
(
buf
, 
Iv
);

507 
	`Ch”
((
¡©e_t
*)
buf
, 
ùx
->
RoundKey
);

508 
Iv
 = 
buf
;

509 
buf
 +ğ
AES_BLOCKLEN
;

513 
	`memıy
(
ùx
->
Iv
, Iv, 
AES_BLOCKLEN
);

514 
	}
}

516 
	$AES_CBC_deüy±_bufãr
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
)

518 
ušŒ_t
 
i
;

519 
ušt8_t
 
¡ÜeNextIv
[
AES_BLOCKLEN
];

520 
i
 = 0; i < 
Ëngth
; i +ğ
AES_BLOCKLEN
)

522 
	`memıy
(
¡ÜeNextIv
, 
buf
, 
AES_BLOCKLEN
);

523 
	`InvCh”
((
¡©e_t
*)
buf
, 
ùx
->
RoundKey
);

524 
	`XÜW™hIv
(
buf
, 
ùx
->
Iv
);

525 
	`memıy
(
ùx
->
Iv
, 
¡ÜeNextIv
, 
AES_BLOCKLEN
);

526 
buf
 +ğ
AES_BLOCKLEN
;

529 
	}
}

535 #ià
defšed
(
CTR
) && (CTR == 1)

538 
	$AES_CTR_xüy±_bufãr
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
)

540 
ušt8_t
 
bufãr
[
AES_BLOCKLEN
];

542 
i
;

543 
bi
;

544 
i
 = 0, 
bi
 = 
AES_BLOCKLEN
; i < 
Ëngth
; ++i, ++bi)

546 ià(
bi
 =ğ
AES_BLOCKLEN
)

549 
	`memıy
(
bufãr
, 
ùx
->
Iv
, 
AES_BLOCKLEN
);

550 
	`Ch”
((
¡©e_t
*)
bufãr
,
ùx
->
RoundKey
);

553 
bi
 = (
AES_BLOCKLEN
 - 1); bi >= 0; --bi)

556 ià(
ùx
->
Iv
[
bi
] == 255)

558 
ùx
->
Iv
[
bi
] = 0;

561 
ùx
->
Iv
[
bi
] += 1;

564 
bi
 = 0;

567 
buf
[
i
] = (buf[i] ^ 
bufãr
[
bi
]);

569 
	}
}

	@ta/batchnorm_layer_TA.c

1 
	~"d¬kÃt_TA.h
"

3 
	~"b©chnÜm_Ïy”_TA.h
"

4 
	~"bÏs_TA.h
"

5 
	~"m©h_TA.h
"

6 
	~"cÚvŞutiÚ®_Ïy”_TA.h
"

9 
	$fÜw¬d_b©chnÜm_Ïy”_TA
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

11 if(
l
.
ty³
 =ğ
BATCHNORM_TA
è
	`cİy_ıu_TA
Ö.
ouuts
*l.
b©ch
, 
Ãt
.
šput
, 1,†.
ouut
, 1);

12 
	`cİy_ıu_TA
(
l
.
ouuts
*l.
b©ch
,†.
ouut
, 1,†.
x
, 1);

13 if(
Ãt
.
Œaš
){

14 
	`m—n_ıu_TA
(
l
.
ouut
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
,†.
m—n
);

15 
	`v¬Ÿnû_ıu_TA
(
l
.
ouut
,†.
m—n
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
,†.
v¬Ÿnû
);

17 
	`sÿl_ıu_TA
(
l
.
out_c
, .99,†.
rŞlšg_m—n
, 1);

18 
	`axpy_ıu_TA
(
l
.
out_c
, .01,†.
m—n
, 1,†.
rŞlšg_m—n
, 1);

19 
	`sÿl_ıu_TA
(
l
.
out_c
, .99,†.
rŞlšg_v¬Ÿnû
, 1);

20 
	`axpy_ıu_TA
(
l
.
out_c
, .01,†.
v¬Ÿnû
, 1,†.
rŞlšg_v¬Ÿnû
, 1);

22 
	`nÜm®ize_ıu_TA
(
l
.
ouut
,†.
m—n
,†.
v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

23 
	`cİy_ıu_TA
(
l
.
ouuts
*l.
b©ch
,†.
ouut
, 1,†.
x_nÜm
, 1);

25 
	`nÜm®ize_ıu_TA
(
l
.
ouut
,†.
rŞlšg_m—n
,†.
rŞlšg_v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

27 
	`sÿË_bŸs_TA
(
l
.
ouut
,†.
sÿËs
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

28 
	`add_bŸs_TA
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

29 
	}
}

31 
	$backw¬d_sÿË_ıu_TA
(*
x_nÜm
, *
d–
, 
b©ch
, 
n
, 
size
, *
sÿË_upd©es
)

33 
i
,
b
,
f
;

34 
f
 = 0; f < 
n
; ++f){

35 
sum
 = 0;

36 
b
 = 0; b < 
b©ch
; ++b){

37 
i
 = 0; i < 
size
; ++i){

38 
šdex
 = 
i
 + 
size
*(
f
 + 
n
*
b
);

39 
sum
 +ğ
d–
[
šdex
] * 
x_nÜm
[index];

42 
sÿË_upd©es
[
f
] +ğ
sum
;

44 
	}
}

46 
	$m—n_d–_ıu_TA
(*
d–
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n_d–
)

49 
i
,
j
,
k
;

50 
i
 = 0; i < 
f‹rs
; ++i){

51 
m—n_d–
[
i
] = 0;

52 
j
 = 0; j < 
b©ch
; ++j) {

53 
k
 = 0; k < 
¥©Ÿl
; ++k) {

54 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

55 
m—n_d–
[
i
] +ğ
d–
[
šdex
];

58 
m—n_d–
[
i
] *ğ(-1./
	`_sq¹
(
v¬Ÿnû
[i] + .00001f));

60 
	}
}

63 
	$v¬Ÿnû_d–_ıu_TA
(*
x
, *
d–
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû_d–
)

66 
i
,
j
,
k
;

67 
i
 = 0; i < 
f‹rs
; ++i){

68 
v¬Ÿnû_d–
[
i
] = 0;

69 
j
 = 0; j < 
b©ch
; ++j){

70 
k
 = 0; k < 
¥©Ÿl
; ++k){

71 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

72 
v¬Ÿnû_d–
[
i
] +ğ
d–
[
šdex
]*(
x
[šdex] - 
m—n
[i]);

76 
v¬Ÿnû_d–
[
i
] *ğ-.5 * 
	`_pow
(
v¬Ÿnû
[i] + .00001f, ()(-3./2.));

78 
	}
}

80 
	$nÜm®ize_d–_ıu_TA
(*
x
, *
m—n
, *
v¬Ÿnû
, *
m—n_d–
, *
v¬Ÿnû_d–
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
d–
)

82 
f
, 
j
, 
k
;

83 
j
 = 0; j < 
b©ch
; ++j){

84 
f
 = 0; f < 
f‹rs
; ++f){

85 
k
 = 0; k < 
¥©Ÿl
; ++k){

86 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
f
*¥©ŸÈ+ 
k
;

87 
d–
[
šdex
] = d–[šdex] * 1./(
	`_sq¹
(
v¬Ÿnû
[
f
] + .00001f)è+ 
v¬Ÿnû_d–
[f] * 2. * (
x
[šdex] - 
m—n
[f]è/ (
¥©Ÿl
 * 
b©ch
è+ 
m—n_d–
[f]/(spatial*batch);

91 
	}
}

94 
	$backw¬d_b©chnÜm_Ïy”_TA
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

96 if(!
Ãt
.
Œaš
){

97 
l
.
m—n
 =†.
rŞlšg_m—n
;

98 
l
.
v¬Ÿnû
 =†.
rŞlšg_v¬Ÿnû
;

100 
	`backw¬d_bŸs_TA
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
);

101 
	`backw¬d_sÿË_ıu_TA
(
l
.
x_nÜm
,†.
d–
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
sÿË_upd©es
);

103 
	`sÿË_bŸs_TA
(
l
.
d–
,†.
sÿËs
,†.
b©ch
,†.
out_c
,†.
out_h
*l.
out_w
);

105 
	`m—n_d–_ıu_TA
(
l
.
d–
,†.
v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
m—n_d–
);

106 
	`v¬Ÿnû_d–_ıu_TA
(
l
.
x
,†.
d–
,†.
m—n
,†.
v¬Ÿnû
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
v¬Ÿnû_d–
);

107 
	`nÜm®ize_d–_ıu_TA
(
l
.
x
,†.
m—n
,†.
v¬Ÿnû
,†.
m—n_d–
,†.
v¬Ÿnû_d–
,†.
b©ch
,†.
out_c
,†.
out_w
*l.
out_h
,†.
d–
);

108 if(
l
.
ty³
 =ğ
BATCHNORM_TA
è
	`cİy_ıu_TA
Ö.
ouuts
*l.
b©ch
,†.
d–
, 1, 
Ãt
.delta, 1);

109 
	}
}

	@ta/blas_TA.c

1 
	~"bÏs_TA.h
"

2 
	~"m©h_TA.h
"

4 
	~<as£¹.h
>

5 
	~<¡dio.h
>

6 
	~<¡dlib.h
>

7 
	~<¡ršg.h
>

9 
	$fl_ıu_TA
(
N
, 
ALPHA
, *
X
, 
INCX
)

11 
i
;

12 
i
 = 0; i < 
N
; ++iè
X
[i*
INCX
] = 
ALPHA
;

13 
	}
}

15 
	$cİy_ıu_TA
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
)

17 
i
;

18 
i
 = 0; i < 
N
; ++i) {

19 
Y
[
i
*
INCY
] = 
X
[i*
INCX
];

21 
	}
}

23 
	$m—n_ıu_TA
(*
x
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n
)

25 
sÿË
 = 1./(
b©ch
 * 
¥©Ÿl
);

26 
i
,
j
,
k
;

27 
i
 = 0; i < 
f‹rs
; ++i){

28 
m—n
[
i
] = 0;

29 
j
 = 0; j < 
b©ch
; ++j){

30 
k
 = 0; k < 
¥©Ÿl
; ++k){

31 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

32 
m—n
[
i
] +ğ
x
[
šdex
];

35 
m—n
[
i
] *ğ
sÿË
;

37 
	}
}

39 
	$v¬Ÿnû_ıu_TA
(*
x
, *
m—n
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû
)

41 
sÿË
 = 1./(
b©ch
 * 
¥©Ÿl
 - 1);

42 
i
,
j
,
k
;

43 
i
 = 0; i < 
f‹rs
; ++i){

44 
v¬Ÿnû
[
i
] = 0;

45 
j
 = 0; j < 
b©ch
; ++j){

46 
k
 = 0; k < 
¥©Ÿl
; ++k){

47 
šdex
 = 
j
*
f‹rs
*
¥©Ÿl
 + 
i
*¥©ŸÈ+ 
k
;

48 
v¬Ÿnû
[
i
] +ğ
	`_pow
((
x
[
šdex
] - 
m—n
[i]), 2);

51 
v¬Ÿnû
[
i
] *ğ
sÿË
;

53 
	}
}

55 
	$sÿl_ıu_TA
(
N
, 
ALPHA
, *
X
, 
INCX
)

57 
i
;

58 
i
 = 0; i < 
N
; ++iè
X
[i*
INCX
] *ğ
ALPHA
;

59 
	}
}

61 
	$axpy_ıu_TA
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
)

63 
i
;

64 
i
 = 0; i < 
N
; ++iè
Y
[i*
INCY
] +ğ
ALPHA
*
X
[i*
INCX
];

65 
	}
}

68 
	$nÜm®ize_ıu_TA
(*
x
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
)

70 
b
, 
f
, 
i
;

71 
b
 = 0; b < 
b©ch
; ++b){

72 
f
 = 0; f < 
f‹rs
; ++f){

73 
i
 = 0; i < 
¥©Ÿl
; ++i){

74 
šdex
 = 
b
*
f‹rs
*
¥©Ÿl
 + 
f
*¥©ŸÈ+ 
i
;

75 
x
[
šdex
] = (x[šdex] - 
m—n
[
f
])/(
	`_sq¹
(
v¬Ÿnû
[f]) + .000001f);

79 
	}
}

82 
	$soámax_TA
(*
šput
, 
n
, 
‹mp
, 
¡ride
, *
ouut
)

84 
i
;

85 
sum
 = 0;

86 
Ïrge¡
 = -
fœ¡_aim_mÚey
;

87 
i
 = 0; i < 
n
; ++i){

88 if(
šput
[
i
*
¡ride
] > 
Ïrge¡
)†argest = input[i*stride];

90 
i
 = 0; i < 
n
; ++i){

91 
e_
 = 
	`_exp
(
šput
[
i
*
¡ride
]/
‹mp
 - 
Ïrge¡
/temp);

92 
sum
 +ğ
e_
;

93 
ouut
[
i
*
¡ride
] = 
e_
;

95 
i
 = 0; i < 
n
; ++i){

96 
ouut
[
i
*
¡ride
] /ğ
sum
;

101 
	}
}

104 
	$soámax_ıu_TA
(*
šput
, 
n
, 
b©ch
, 
b©ch_off£t
, 
groups
, 
group_off£t
, 
¡ride
, 
‹mp
, *
ouut
)

106 
g
, 
b
;

107 
b
 = 0; b < 
b©ch
; ++b){

108 
g
 = 0; g < 
groups
; ++g){

109 
	`soámax_TA
(
šput
 + 
b
*
b©ch_off£t
 + 
g
*
group_off£t
, 
n
, 
‹mp
, 
¡ride
, 
ouut
 + b*batch_offset + g*group_offset);

112 
	}
}

116 
	$soámax_x_’t_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

118 
i
;

119 
i
 = 0; i < 
n
; ++i){

120 
t
 = 
Œuth
[
i
];

121 
p
 = 
´ed
[
i
];

122 
”rÜ
[
i
] = (
t
è? -
	`_Ê
(
p
) : 0;

123 
d–
[
i
] = 
t
-
p
;

128 
	}
}

132 
	$smoÙh_l1_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

134 
i
;

135 
i
 = 0; i < 
n
; ++i){

136 
diff
 = 
Œuth
[
i
] - 
´ed
[i];

137 
abs_v®
 = 
	`çbs
(
diff
);

138 if(
abs_v®
 < 1) {

139 
”rÜ
[
i
] = 
diff
 * diff;

140 
d–
[
i
] = 
diff
;

143 
”rÜ
[
i
] = 2*
abs_v®
 - 1;

144 
d–
[
i
] = (
diff
 < 0) ? 1 : -1;

149 
gGlob®BufãrT¿ck”
 +ğ(2*
n
*()+());

150 
	}
}

153 
	$l1_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

155 
i
;

156 
i
 = 0; i < 
n
; ++i){

157 
diff
 = 
Œuth
[
i
] - 
´ed
[i];

158 
”rÜ
[
i
] = 
	`çbs
(
diff
);

159 
d–
[
i
] = 
diff
 > 0 ? 1 : -1;

163 
gGlob®BufãrT¿ck”
 +ğ(
n
*()+());

164 
	}
}

166 
	$l2_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
)

168 
i
;

169 
i
 = 0; i < 
n
; ++i){

170 
diff
 = 
Œuth
[
i
] - 
´ed
[i];

171 
”rÜ
[
i
] = 
diff
 * diff;

172 
d–
[
i
] = 
diff
;

176 
gGlob®BufãrT¿ck”
 +ğ(
n
*()+());

177 
	}
}

	@ta/col2im_TA.c

1 
	~<¡dio.h
>

2 
	~"m©h_TA.h
"

4 
	$cŞ2im_add_pix–_TA
(*
im
, 
height
, 
width
, 
chªÃls
,

5 
row
, 
cŞ
, 
chªÃl
, 
·d
, 
v®
)

7 
row
 -ğ
·d
;

8 
cŞ
 -ğ
·d
;

10 ià(
row
 < 0 || 
cŞ
 < 0 ||

11 
row
 >ğ
height
 || 
cŞ
 >ğ
width
) ;

12 
im
[
cŞ
 + 
width
*(
row
 + 
height
*
chªÃl
)] +ğ
v®
;

13 
	}
}

15 
	$cŞ2im_ıu_TA
(* 
d©a_cŞ
,

16 
chªÃls
, 
height
, 
width
,

17 
ksize
, 
¡ride
, 
·d
, * 
d©a_im
)

19 
c
,
h
,
w
;

20 
height_cŞ
 = (
height
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

21 
width_cŞ
 = (
width
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

23 
chªÃls_cŞ
 = 
chªÃls
 * 
ksize
 * ksize;

24 
c
 = 0; c < 
chªÃls_cŞ
; ++c) {

25 
w_off£t
 = 
c
 % 
ksize
;

26 
h_off£t
 = (
c
 / 
ksize
) % ksize;

27 
c_im
 = 
c
 / 
ksize
 / ksize;

28 
h
 = 0; h < 
height_cŞ
; ++h) {

29 
w
 = 0; w < 
width_cŞ
; ++w) {

30 
im_row
 = 
h_off£t
 + 
h
 * 
¡ride
;

31 
im_cŞ
 = 
w_off£t
 + 
w
 * 
¡ride
;

32 
cŞ_šdex
 = (
c
 * 
height_cŞ
 + 
h
è* 
width_cŞ
 + 
w
;

33 
v®
 = 
d©a_cŞ
[
cŞ_šdex
];

34 
	`cŞ2im_add_pix–_TA
(
d©a_im
, 
height
, 
width
, 
chªÃls
,

35 
im_row
, 
im_cŞ
, 
c_im
, 
·d
, 
v®
);

39 
	}
}

	@ta/connected_layer_TA.c

1 
	~<¡dio.h
>

2 
	~<time.h
>

3 
	~<as£¹.h
>

5 
	~"uts_TA.h
"

6 
	~"d¬kÃt_TA.h
"

7 
	~"gemm_TA.h
"

8 
	~"m©h_TA.h
"

9 
	~"bÏs_TA.h
"

10 
	~"aùiv©iÚs_TA.h
"

11 
	~"b©chnÜm_Ïy”_TA.h
"

12 
	~"cÚÃùed_Ïy”_TA.h
"

13 
	~"cÚvŞutiÚ®_Ïy”_TA.h
"

15 
	~<‹e_š‹º®_­i.h
>

16 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

18 
	$fÜw¬d_cÚÃùed_Ïy”_TA_Ãw
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

20 
	`fl_ıu_TA
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut
, 1);

22 
m
 = 
l
.
b©ch
;

23 
k
 = 
l
.
šputs
;

24 
n
 = 
l
.
ouuts
;

25 *
a
 = 
Ãt
.
šput
;

26 *
b
 = 
l
.
weights
;

27 *
c
 = 
l
.
ouut
;

30 
gGlob®BufãrT¿ck”
 += (3*() + 12);

32 
	`gemm_TA
(0,1,
m
,
n
,
k
,1,
a
,k,
b
,k,1,
c
,n);

34 if(
l
.
b©ch_nÜm®ize
){

35 
	`fÜw¬d_b©chnÜm_Ïy”_TA
(
l
, 
Ãt
);

37 
	`add_bŸs_TA
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
ouuts
, 1);

39 
	`aùiv©e_¬¿y_TA
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

40 
	}
}

42 
	$backw¬d_cÚÃùed_Ïy”_TA_Ãw
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

44 
	`g¿d›Á_¬¿y_TA
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

46 if(
l
.
b©ch_nÜm®ize
){

47 
	`backw¬d_b©chnÜm_Ïy”_TA
(
l
, 
Ãt
);

49 
	`backw¬d_bŸs_TA
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
ouuts
, 1);

52 
m
 = 
l
.
ouuts
;

53 
k
 = 
l
.
b©ch
;

54 
n
 = 
l
.
šputs
;

55 *
a
 = 
l
.
d–
;

56 *
b
 = 
Ãt
.
šput
;

57 *
c
 = 
l
.
weight_upd©es
;

59 
	`gemm_TA
(1,0,
m
,
n
,
k
,1,
a
,m,
b
,n,1,
c
,n);

64 
m
 = 
l
.
b©ch
;

65 
k
 = 
l
.
ouuts
;

66 
n
 = 
l
.
šputs
;

68 
a
 = 
l
.
d–
;

69 
b
 = 
l
.
weights
;

70 
c
 = 
Ãt
.
d–
;

72 if(
c
è
	`gemm_TA
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,n,1,c,n);

74 
	}
}

77 
	$upd©e_cÚÃùed_Ïy”_TA_Ãw
(
Ïy”_TA
 
l
, 
upd©e_¬gs_TA
 
a
)

79 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

80 
mom’tum
 = 
a
.momentum;

81 
deÿy
 = 
a
.decay;

82 
b©ch
 = 
a
.batch;

84 
	`axpy_ıu_TA
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es
, 1,†.
bŸ£s
, 1);

86 
	`sÿl_ıu_TA
(
l
.
ouuts
, 
mom’tum
,†.
bŸs_upd©es
, 1);

88 if(
l
.
b©ch_nÜm®ize
){

89 
	`axpy_ıu_TA
(
l
.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
sÿË_upd©es
, 1,†.
sÿËs
, 1);

90 
	`sÿl_ıu_TA
(
l
.
ouuts
, 
mom’tum
,†.
sÿË_upd©es
, 1);

93 
	`axpy_ıu_TA
(
l
.
šputs
*l.
ouuts
, -
deÿy
*
b©ch
,†.
weights
, 1,†.
weight_upd©es
, 1);

94 
	`axpy_ıu_TA
(
l
.
šputs
*l.
ouuts
, 
Ë¬nšg_¿‹
/
b©ch
,†.
weight_upd©es
, 1,†.
weights
, 1);

95 
	`sÿl_ıu_TA
(
l
.
šputs
*l.
ouuts
, 
mom’tum
,†.
weight_upd©es
, 1);

96 
	}
}

98 
Ïy”_TA
 
	$make_cÚÃùed_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
ouuts
, 
ACTIVATION_TA
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
)

100 
i
;

101 
Ïy”_TA
 
l
 = {0};

102 
l
.
Ë¬nšg_¿‹_sÿË
 = 1;

103 
l
.
ty³
 = 
CONNECTED_TA
;

106 
gGlob®BufãrT¿ck”
 +ğ(
Ïy”_TA
);

108 
l
.
šputs
 = inputs;

109 
l
.
ouuts
 = outputs;

110 
l
.
b©ch
 = batch;

111 
l
.
b©ch_nÜm®ize
 = batch_normalize;

112 
l
.
h
 = 1;

113 
l
.
w
 = 1;

114 
l
.
c
 = 
šputs
;

115 
l
.
out_h
 = 1;

116 
l
.
out_w
 = 1;

117 
l
.
out_c
 = 
ouuts
;

119 
l
.
ouut
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

120 
l
.
d–
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

122 
l
.
weight_upd©es
 = 
	`ÿÎoc
(
šputs
*
ouuts
, ());

123 
l
.
bŸs_upd©es
 = 
	`ÿÎoc
(
ouuts
, ());

125 
l
.
weights
 = 
	`ÿÎoc
(
ouuts
*
šputs
, ());

126 
l
.
bŸ£s
 = 
	`ÿÎoc
(
ouuts
, ());

128 
l
.
fÜw¬d_TA
 = 
fÜw¬d_cÚÃùed_Ïy”_TA_Ãw
;

129 
l
.
backw¬d_TA
 = 
backw¬d_cÚÃùed_Ïy”_TA_Ãw
;

130 
l
.
upd©e_TA
 = 
upd©e_cÚÃùed_Ïy”_TA_Ãw
;

133 
gGlob®BufãrT¿ck”
 +ğ((2*
b©ch
*
ouuts
 * ()è+ (2*
šputs
*outputs * ()) + (2*outputs*()));

136 
sÿË
 = 
	`_sq¹
(2./
šputs
);

137 
i
 = 0; i < 
ouuts
*
šputs
; ++i){

139 
l
.
weights
[
i
] = 
sÿË
 * 
	`¿nd_unifÜm_TA
(-1, 1);

142 
i
 = 0; i < 
ouuts
; ++i){

143 
l
.
bŸ£s
[
i
] = 0;

146 if(
adam
){

147 
l
.
m
 = 
	`ÿÎoc
Ö.
šputs
*l.
ouuts
, ());

148 
l
.
v
 = 
	`ÿÎoc
Ö.
šputs
*l.
ouuts
, ());

149 
l
.
bŸs_m
 = 
	`ÿÎoc
Ö.
ouuts
, ());

150 
l
.
sÿË_m
 = 
	`ÿÎoc
Ö.
ouuts
, ());

151 
l
.
bŸs_v
 = 
	`ÿÎoc
Ö.
ouuts
, ());

152 
l
.
sÿË_v
 = 
	`ÿÎoc
Ö.
ouuts
, ());

154 
gGlob®BufãrT¿ck”
 +ğ((2*
l
.
šputs
*l.
ouuts
*()) + (4*l.outputs*()));

157 if(
b©ch_nÜm®ize
){

158 
l
.
sÿËs
 = 
	`ÿÎoc
(
ouuts
, ());

159 
l
.
sÿË_upd©es
 = 
	`ÿÎoc
(
ouuts
, ());

160 
i
 = 0; i < 
ouuts
; ++i){

161 
l
.
sÿËs
[
i
] = 1;

164 
l
.
m—n
 = 
	`ÿÎoc
(
ouuts
, ());

165 
l
.
m—n_d–
 = 
	`ÿÎoc
(
ouuts
, ());

166 
l
.
v¬Ÿnû
 = 
	`ÿÎoc
(
ouuts
, ());

167 
l
.
v¬Ÿnû_d–
 = 
	`ÿÎoc
(
ouuts
, ());

169 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
ouuts
, ());

170 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
ouuts
, ());

172 
l
.
x
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

173 
l
.
x_nÜm
 = 
	`ÿÎoc
(
b©ch
*
ouuts
, ());

175 
gGlob®BufãrT¿ck”
 +ğ((2*
b©ch
*
ouuts
*()) + (8*outputs*()));

178 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

185 
l
.
aùiv©iÚ
 =‡ctivation;

188  
l
;

189 
	}
}

	@ta/convolutional_layer_TA.c

1 
	~"cÚvŞutiÚ®_Ïy”_TA.h
"

2 
	~"b©chnÜm_Ïy”_TA.h
"

4 
	~"uts_TA.h
"

5 
	~"gemm_TA.h
"

6 
	~"m©h_TA.h
"

7 
	~"bÏs_TA.h
"

8 
	~"im2cŞ_TA.h
"

9 
	~"cŞ2im_TA.h
"

10 
	~"d¬kÃt_TA.h
"

11 
	~"aùiv©iÚs_TA.h
"

13 
	~<¡dio.h
>

14 
	~<time.h
>

16 
	~<‹e_š‹º®_­i.h
>

17 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

19 
	$sw­_bš¬y_TA
(
cÚvŞutiÚ®_Ïy”_TA
 *
l
)

21 *
sw­
 = 
l
->
weights
;

22 
l
->
weights
 =†->
bš¬y_weights
;

23 
l
->
bš¬y_weights
 = 
sw­
;

24 
	}
}

26 
	$add_bŸs_TA
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
)

28 
i
,
j
,
b
;

29 
b
 = 0; b < 
b©ch
; ++b){

30 
i
 = 0; i < 
n
; ++i){

31 
j
 = 0; j < 
size
; ++j){

32 
ouut
[(
b
*
n
 + 
i
)*
size
 + 
j
] +ğ
bŸ£s
[i];

36 
	}
}

39 
	$sÿË_bŸs_TA
(*
ouut
, *
sÿËs
, 
b©ch
, 
n
, 
size
)

41 
i
,
j
,
b
;

42 
b
 = 0; b < 
b©ch
; ++b){

43 
i
 = 0; i < 
n
; ++i){

44 
j
 = 0; j < 
size
; ++j){

45 
ouut
[(
b
*
n
 + 
i
)*
size
 + 
j
] *ğ
sÿËs
[i];

49 
	}
}

51 
	$backw¬d_bŸs_TA
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
)

53 
i
,
b
;

54 
b
 = 0; b < 
b©ch
; ++b){

55 
i
 = 0; i < 
n
; ++i){

56 
bŸs_upd©es
[
i
] +ğ
	`sum_¬¿y_TA
(
d–
+
size
*(i+
b
*
n
), size);

59 
	}
}

61 
	$cÚvŞutiÚ®_out_height_TA
(
cÚvŞutiÚ®_Ïy”_TA
 
l
)

63  (
l
.
h
 + 2*l.
·d
 -†.
size
è/†.
¡ride
 + 1;

64 
	}
}

66 
	$cÚvŞutiÚ®_out_width_TA
(
cÚvŞutiÚ®_Ïy”_TA
 
l
)

68  (
l
.
w
 + 2*l.
·d
 -†.
size
è/†.
¡ride
 + 1;

69 
	}
}

71 
size_t
 
	$g‘_wÜk¥aû_size_TA
(
Ïy”_TA
 
l
){

72  (
size_t
)
l
.
out_h
*l.
out_w
*l.
size
*l.size*l.
c
/l.
groups
*();

73 
	}
}

75 
	$bš¬ize_weights_TA
(*
weights
, 
n
, 
size
, *
bš¬y
)

77 
i
, 
f
;

78 
f
 = 0; f < 
n
; ++f){

79 
m—n
 = 0;

80 
i
 = 0; i < 
size
; ++i){

81 
m—n
 +ğ
	`çbs
(
weights
[
f
*
size
 + 
i
]);

83 
m—n
 = m—À/ 
size
;

84 
i
 = 0; i < 
size
; ++i){

85 
bš¬y
[
f
*
size
 + 
i
] = (
weights
[f*siz+ i] > 0è? 
m—n
 : -mean;

90 
gGlob®BufãrT¿ck”
 +ğ(
n
*());

91 
	}
}

93 
	$bš¬ize_ıu_TA
(*
šput
, 
n
, *
bš¬y
)

95 
i
;

96 
i
 = 0; i < 
n
; ++i){

97 
bš¬y
[
i
] = (
šput
[i] > 0) ? 1 : -1;

99 
	}
}

101 
cÚvŞutiÚ®_Ïy”_TA
 
	$make_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION_TA
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
, 
æ³d
, 
dÙ
)

103 
i
;

104 
cÚvŞutiÚ®_Ïy”_TA
 
l
 = {0};

105 
l
.
ty³
 = 
CONVOLUTIONAL_TA
;

108 
gGlob®BufãrT¿ck”
 +ğ(
cÚvŞutiÚ®_Ïy”_TA
);

110 
l
.
groups
 = groups;

111 
l
.
h
 = h;

112 
l
.
w
 = w;

113 
l
.
c
 = c;

114 
l
.
n
 =‚;

115 
l
.
bš¬y
 = binary;

116 
l
.
xnÜ
 = xnor;

117 
l
.
b©ch
 = batch;

118 
l
.
¡ride
 = stride;

119 
l
.
size
 = size;

120 
l
.
·d
 = 
·ddšg
;

121 
l
.
b©ch_nÜm®ize
 = batch_normalize;

123 
l
.
weights
 = 
	`ÿÎoc
(
c
/
groups
*
n
*
size
*size, ());

126 
l
.
bŸ£s
 = 
	`ÿÎoc
(
n
, ());

130 
gGlob®BufãrT¿ck”
 +ğ((
c
/
groups
*
n
*
size
*size) * ());

131 
gGlob®BufãrT¿ck”
 +ğ(
n
 * ());

133 
l
.
nweights
 = 
c
/
groups
*
n
*
size
*size;

134 
l
.
nbŸ£s
 = 
n
;

137 
sÿË
 = 
	`_sq¹
(2./(
size
*size*
c
/
l
.
groups
));

147 
out_w
 = 
	`cÚvŞutiÚ®_out_width_TA
(
l
);

148 
out_h
 = 
	`cÚvŞutiÚ®_out_height_TA
(
l
);

151 
gGlob®BufãrT¿ck”
 += (2 * () + ());

153 
l
.
out_h
 = out_h;

154 
l
.
out_w
 = out_w;

155 
l
.
out_c
 = 
n
;

156 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

157 
l
.
šputs
 =†.
w
 *†.
h
 *†.
c
;

159 
l
.
ouut
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

160 
l
.
d–
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

165 
l
.
fÜw¬d_TA
 = 
fÜw¬d_cÚvŞutiÚ®_Ïy”_TA_Ãw
;

166 
l
.
backw¬d_TA
 = 
backw¬d_cÚvŞutiÚ®_Ïy”_TA_Ãw
;

167 
l
.
upd©e_TA
 = 
upd©e_cÚvŞutiÚ®_Ïy”_TA_Ãw
;

168 if(
bš¬y
){

169 
l
.
bš¬y_weights
 = 
	`ÿÎoc
Ö.
nweights
, ());

170 
l
.
cweights
 = 
	`ÿÎoc
Ö.
nweights
, ());

171 
l
.
sÿËs
 = 
	`ÿÎoc
(
n
, ());

173 
gGlob®BufãrT¿ck”
 +ğ((
l
.
nweights
 * ()è+ (l.nweight * ()è+ (
n
 * ()));

175 if(
xnÜ
){

176 
l
.
bš¬y_weights
 = 
	`ÿÎoc
Ö.
nweights
, ());

177 
l
.
bš¬y_šput
 = 
	`ÿÎoc
Ö.
šputs
*l.
b©ch
, ());

179 
gGlob®BufãrT¿ck”
 +ğ((
l
.
nweights
 * ()è+ (l.
šputs
 *†.
b©ch
 * ()));

182 if(
b©ch_nÜm®ize
){

183 
l
.
sÿËs
 = 
	`ÿÎoc
(
n
, ());

185 
i
 = 0; i < 
n
; ++i){

186 
l
.
sÿËs
[
i
] = 1;

189 
l
.
m—n
 = 
	`ÿÎoc
(
n
, ());

190 
l
.
v¬Ÿnû
 = 
	`ÿÎoc
(
n
, ());

195 
l
.
rŞlšg_m—n
 = 
	`ÿÎoc
(
n
, ());

196 
l
.
rŞlšg_v¬Ÿnû
 = 
	`ÿÎoc
(
n
, ());

197 
l
.
x
 = 
	`ÿÎoc
Ö.
b©ch
*l.
ouuts
, ());

200 
gGlob®BufãrT¿ck”
 +ğ((5 * 
n
 * ()è+ (
l
.
b©ch
*l.
ouuts
 * ()));

202 if(
adam
){

203 
l
.
m
 = 
	`ÿÎoc
Ö.
nweights
, ());

204 
l
.
v
 = 
	`ÿÎoc
Ö.
nweights
, ());

205 
l
.
bŸs_m
 = 
	`ÿÎoc
(
n
, ());

206 
l
.
sÿË_m
 = 
	`ÿÎoc
(
n
, ());

207 
l
.
bŸs_v
 = 
	`ÿÎoc
(
n
, ());

208 
l
.
sÿË_v
 = 
	`ÿÎoc
(
n
, ());

210 
gGlob®BufãrT¿ck”
 +ğ((4 * 
n
 * ()è+ (2 * 
l
.
nweights
 * ()));

213 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

220 
l
.
wÜk¥aû_size
 = 
	`g‘_wÜk¥aû_size_TA
(l);

221 
l
.
aùiv©iÚ
 =‡ctivation;

223 
l
.
æ³d
 = flipped;

224 
l
.
dÙ
 = dot;

228  
l
;

229 
	}
}

232 
	$fÜw¬d_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
cÚvŞutiÚ®_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

234 
i
, 
j
;

236 
	`fl_ıu_TA
(
l
.
ouuts
*l.
b©ch
, 0,†.
ouut
, 1);

238 if(
l
.
xnÜ
){

239 
	`bš¬ize_weights_TA
(
l
.
weights
,†.
n
,†.
c
/l.
groups
*l.
size
*l.size,†.
bš¬y_weights
);

240 
	`sw­_bš¬y_TA
(&
l
);

241 
	`bš¬ize_ıu_TA
(
Ãt
.
šput
, 
l
.
c
*l.
h
*l.
w
*l.
b©ch
,†.
bš¬y_šput
);

242 
Ãt
.
šput
 = 
l
.
bš¬y_šput
;

247 
m
 = 
l
.
n
/l.
groups
;

248 
k
 = 
l
.
size
*l.size*l.
c
/l.
groups
;

249 
n
 = 
l
.
out_w
*l.
out_h
;

251 
i
 = 0; i < 
l
.
b©ch
; ++i){

252 
j
 = 0; j < 
l
.
groups
; ++j){

253 *
a
 = 
l
.
weights
 + 
j
*l.
nweights
/l.
groups
;

254 *
b
 = 
Ãt
.
wÜk¥aû
;

255 *
c
 = 
l
.
ouut
 + (
i
*l.
groups
 + 
j
)*
n
*
m
;

256 *
im
 = 
Ãt
.
šput
 + (
i
*
l
.
groups
 + 
j
)*l.
c
/l.groups*l.
h
*l.
w
;

258 ià(
l
.
size
 == 1) {

259 
b
 = 
im
;

261 
	`im2cŞ_ıu_TA
(
im
, 
l
.
c
/l.
groups
,†.
h
,†.
w
,†.
size
,†.
¡ride
,†.
·d
, 
b
);

263 
	`gemm_TA
(0,0,
m
,
n
,
k
,1,
a
,k,
b
,n,1,
c
,n);

270 if(
l
.
b©ch_nÜm®ize
){

271 
	`fÜw¬d_b©chnÜm_Ïy”_TA
(
l
, 
Ãt
);

273 
	`add_bŸs_TA
(
l
.
ouut
,†.
bŸ£s
,†.
b©ch
,†.
n
,†.
out_h
*l.
out_w
);

276 
	`aùiv©e_¬¿y_TA
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
);

277 if(
l
.
bš¬y
 ||†.
xnÜ
è
	`sw­_bš¬y_TA
(&l);

279 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

285 
	}
}

287 
	$backw¬d_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
cÚvŞutiÚ®_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

289 
i
, 
j
;

290 
m
 = 
l
.
n
/l.
groups
;

291 
n
 = 
l
.
size
*l.size*l.
c
/l.
groups
;

292 
k
 = 
l
.
out_w
*l.
out_h
;

294 
	`g¿d›Á_¬¿y_TA
(
l
.
ouut
,†.
ouuts
*l.
b©ch
,†.
aùiv©iÚ
,†.
d–
);

296 if(
l
.
b©ch_nÜm®ize
){

297 
	`backw¬d_b©chnÜm_Ïy”_TA
(
l
, 
Ãt
);

299 
	`backw¬d_bŸs_TA
(
l
.
bŸs_upd©es
,†.
d–
,†.
b©ch
,†.
n
, 
k
);

302 
i
 = 0; i < 
l
.
b©ch
; ++i){

303 
j
 = 0; j < 
l
.
groups
; ++j){

304 *
a
 = 
l
.
d–
 + (
i
*l.
groups
 + 
j
)*
m
*
k
;

305 *
b
 = 
Ãt
.
wÜk¥aû
;

306 *
c
 = 
l
.
weight_upd©es
 + 
j
*l.
nweights
/l.
groups
;

308 *
im
 = 
Ãt
.
šput
 + (
i
*
l
.
groups
 + 
j
)*l.
c
/l.groups*l.
h
*l.
w
;

309 *
imd
 = 
Ãt
.
d–
 + (
i
*
l
.
groups
 + 
j
)*l.
c
/l.groups*l.
h
*l.
w
;

311 if(
l
.
size
 == 1){

312 
b
 = 
im
;

314 
	`im2cŞ_ıu_TA
(
im
, 
l
.
c
/l.
groups
,†.
h
,†.
w
,

315 
l
.
size
,†.
¡ride
,†.
·d
, 
b
);

318 
	`gemm_TA
(0,1,
m
,
n
,
k
,1,
a
,k,
b
,k,1,
c
,n);

320 ià(
Ãt
.
d–
) {

321 
a
 = 
l
.
weights
 + 
j
*l.
nweights
/l.
groups
;

322 
b
 = 
l
.
d–
 + (
i
*l.
groups
 + 
j
)*
m
*
k
;

323 
c
 = 
Ãt
.
wÜk¥aû
;

324 ià(
l
.
size
 == 1) {

325 
c
 = 
imd
;

328 
	`gemm_TA
(1,0,
n
,
k
,
m
,1,
a
,n,
b
,k,0,
c
,k);

330 ià(
l
.
size
 != 1) {

331 
	`cŞ2im_ıu_TA
(
Ãt
.
wÜk¥aû
, 
l
.
c
/l.
groups
,†.
h
,†.
w
,†.
size
,†.
¡ride
,†.
·d
, 
imd
);

336 
	}
}

338 
	$upd©e_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
cÚvŞutiÚ®_Ïy”_TA
 
l
, 
upd©e_¬gs_TA
 
a
)

340 
Ë¬nšg_¿‹
 = 
a
.Ë¬nšg_¿‹*
l
.
Ë¬nšg_¿‹_sÿË
;

341 
mom’tum
 = 
a
.momentum;

342 
deÿy
 = 
a
.decay;

343 
b©ch
 = 
a
.batch;

345 
	`axpy_ıu_TA
(
l
.
n
, 
Ë¬nšg_¿‹
/
b©ch
,†.
bŸs_upd©es
, 1,†.
bŸ£s
, 1);

346 
	`sÿl_ıu_TA
(
l
.
n
, 
mom’tum
,†.
bŸs_upd©es
, 1);

348 if(
l
.
sÿËs
){

349 
	`axpy_ıu_TA
(
l
.
n
, 
Ë¬nšg_¿‹
/
b©ch
,†.
sÿË_upd©es
, 1,†.
sÿËs
, 1);

350 
	`sÿl_ıu_TA
(
l
.
n
, 
mom’tum
,†.
sÿË_upd©es
, 1);

353 
	`axpy_ıu_TA
(
l
.
nweights
, -
deÿy
*
b©ch
,†.
weights
, 1,†.
weight_upd©es
, 1);

354 
	`axpy_ıu_TA
(
l
.
nweights
, 
Ë¬nšg_¿‹
/
b©ch
,†.
weight_upd©es
, 1,†.
weights
, 1);

355 
	`sÿl_ıu_TA
(
l
.
nweights
, 
mom’tum
,†.
weight_upd©es
, 1);

356 
	}
}

	@ta/cost_layer_TA.c

1 
	~"co¡_Ïy”_TA.h
"

3 
	~"uts_TA.h
"

4 
	~"bÏs_TA.h
"

5 
	~"m©h_TA.h
"

7 
	~<¡ršg.h
>

8 
	~<¡dlib.h
>

9 
	~<¡dio.h
>

11 
	~<‹e_š‹º®_­i.h
>

12 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

14 
COST_TYPE_TA
 
	$g‘_co¡_ty³_TA
(*
s
)

16 ià(
	`¡rcmp
(
s
, "£g")==0è 
SEG_TA
;

17 ià(
	`¡rcmp
(
s
, "s£")==0è 
SSE_TA
;

18 ià(
	`¡rcmp
(
s
, "masked")==0è 
MASKED_TA
;

19 ià(
	`¡rcmp
(
s
, "smoÙh")==0è 
SMOOTH_TA
;

20 ià(
	`¡rcmp
(
s
, "L1")==0è 
L1_TA
;

21 ià(
	`¡rcmp
(
s
, "wgª")==0è 
WGAN_TA
;

22 
	`IMSG
("Couldn'ˆfšd co¡y³ %s, gošg w™h SSE\n", 
s
);

23  
SSE_TA
;

24 
	}
}

27 *
	$g‘_co¡_¡ršg_TA
(
COST_TYPE_TA
 
a
)

29 
a
){

30 
SEG_TA
:

32 
SSE_TA
:

34 
MASKED_TA
:

36 
SMOOTH_TA
:

38 
L1_TA
:

40 
WGAN_TA
:

44 
	}
}

47 
co¡_Ïy”_TA
 
	$make_co¡_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
COST_TYPE_TA
 
co¡_ty³
, 
sÿË
, 
¿tio
, 
noobjeù_sÿË
, 
th»sh
)

50 
co¡_Ïy”_TA
 
l
 = {0};

51 
l
.
ty³
 = 
COST_TA
;

54 
gGlob®BufãrT¿ck”
 +ğ(
co¡_Ïy”_TA
);

56 
l
.
sÿË
 = scale;

57 
l
.
b©ch
 = batch;

58 
l
.
šputs
 = inputs;

59 
l
.
ouuts
 = 
šputs
;

60 
l
.
co¡_ty³
 = cost_type;

61 
l
.
d–
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

62 
l
.
ouut
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

63 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

65 
l
.
sÿË
 = scale;

66 
l
.
¿tio
 =„atio;

67 
l
.
noobjeù_sÿË
 =‚oobject_scale;

68 
l
.
th»sh
 =hresh;

70 
l
.
fÜw¬d_TA
 = 
fÜw¬d_co¡_Ïy”_TA
;

71 
l
.
backw¬d_TA
 = 
backw¬d_co¡_Ïy”_TA
;

74 
gGlob®BufãrT¿ck”
 +ğ((2*
šputs
*
b©ch
*()) + ());

76 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

81  
l
;

82 
	}
}

86 
	$fÜw¬d_co¡_Ïy”_TA
(
co¡_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

88 ià(!
Ãt
.
Œuth
) ;

89 if(
l
.
co¡_ty³
 =ğ
MASKED_TA
){

90 
i
;

91 
i
 = 0; i < 
l
.
b©ch
*l.
šputs
; ++i){

92 if(
Ãt
.
Œuth
[
i
] =ğ
SECRET_NUM_TA
èÃt.
šput
[i] = SECRET_NUM_TA;

95 if(
l
.
co¡_ty³
 =ğ
SMOOTH_TA
){

96 
	`smoÙh_l1_ıu_TA
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput
,‚‘.
Œuth
,†.
d–
,†.
ouut
);

97 }if(
l
.
co¡_ty³
 =ğ
L1_TA
){

98 
	`l1_ıu_TA
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput
,‚‘.
Œuth
,†.
d–
,†.
ouut
);

100 
	`l2_ıu_TA
(
l
.
b©ch
*l.
šputs
, 
Ãt
.
šput
,‚‘.
Œuth
,†.
d–
,†.
ouut
);

102 
l
.
co¡
[0] = 
	`sum_¬¿y_TA
Ö.
ouut
,†.
b©ch
*l.
šputs
);

104 
	}
}

108 
	$backw¬d_co¡_Ïy”_TA
(cÚ¡ 
co¡_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

110 
	`axpy_ıu_TA
(
l
.
b©ch
*l.
šputs
,†.
sÿË
,†.
d–
, 1, 
Ãt
.delta, 1);

111 
	}
}

	@ta/darknetp_ta.c

1 
	~<‹e_š‹º®_­i.h
>

2 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

4 
	~"d¬kÃ_.h
"

6 
	~"cÚvŞutiÚ®_Ïy”_TA.h
"

7 
	~"maxpoŞ_Ïy”_TA.h
"

8 
	~"drİout_Ïy”_TA.h
"

10 
	~"cÚÃùed_Ïy”_TA.h
"

11 
	~"soámax_Ïy”_TA.h
"

12 
	~"co¡_Ïy”_TA.h
"

13 
	~"ÃtwÜk_TA.h
"

15 
	~"aùiv©iÚs_TA.h
"

16 
	~"d¬kÃt_TA.h
"

17 
	~"difåriv©e_TA.h
"

18 
	~"·r£r_TA.h
"

19 
	~"m©h_TA.h
"

20 
	~"«s_TA.h
"

22 
	#LOOKUP_SIZE
 4096

	)

24 *
	gÃ‰a_Œuth
;

25 
	gÃŠum
 = 0;

26 
Ïy”_TA
 
	gsoámax_Éa
;

28 
ušt32_t
 
	ggGlob®BufãrT¿ck”
 = 8;

32 
	gUID
[46] = "b8734d20-832e-43a9-bf9f-17f3e9e041e2";

34 
TEE_ResuÉ
 
	$TA_C»©eEÁryPošt
()

38  
TEE_SUCCESS
;

39 
	}
}

41 
	$TA_De¡royEÁryPošt
()

44 
	}
}

46 
TEE_ResuÉ
 
	$TA_O³nSessiÚEÁryPošt
(
ušt32_t
 
·¿m_ty³s
,

47 
TEE_P¬am
 
__maybe_unu£d
 
·¿ms
[4],

48 
__maybe_unu£d
 **
£ss_ùx
)

50 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_NONE
,

51 
TEE_PARAM_TYPE_NONE
,

52 
TEE_PARAM_TYPE_NONE
,

53 
TEE_PARAM_TYPE_NONE
);

55 
	`DMSG
("has been called");

57 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

58  
TEE_ERROR_BAD_PARAMETERS
;

61 ()&
·¿ms
;

62 ()&
£ss_ùx
;

64 
	`IMSG
("I'm Vincent, from secure world!\n");

65  
TEE_SUCCESS
;

66 
	}
}

69 
	$TA_Clo£SessiÚEÁryPošt
(
__maybe_unu£d
 *
£ss_ùx
)

71 ()&
£ss_ùx
;

72 
	`IMSG
("Goodbye!\n");

73 
	}
}

75 
TEE_ResuÉ
 
	$make_ÃtowÜk_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

76 
TEE_P¬am
 
·¿ms
[4])

78 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

79 
TEE_PARAM_TYPE_MEMREF_INPUT
,

80 
TEE_PARAM_TYPE_NONE
,

81 
TEE_PARAM_TYPE_NONE
 );

84 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

85  
TEE_ERROR_BAD_PARAMETERS
;

87 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

88 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

90 
n
 = 
·¿ms0
[0];

91 
time_¡•s
 = 
·¿ms0
[1];

92 
nÙruth
 = 
·¿ms0
[2];

93 
b©ch
 = 
·¿ms0
[3];

94 
subdivisiÚs
 = 
·¿ms0
[4];

95 
¿ndom
 = 
·¿ms0
[5];

96 
adam
 = 
·¿ms0
[6];

97 
h
 = 
·¿ms0
[7];

98 
w
 = 
·¿ms0
[8];

99 
c
 = 
·¿ms0
[9];

100 
šputs
 = 
·¿ms0
[10];

101 
max_üİ
 = 
·¿ms0
[11];

102 
mš_üİ
 = 
·¿ms0
[12];

103 
ûÁ”
 = 
·¿ms0
[13];

104 
buº_š
 = 
·¿ms0
[14];

105 
max_b©ches
 = 
·¿ms0
[15];

107 
Ë¬nšg_¿‹
 = 
·¿ms1
[0];

108 
mom’tum
 = 
·¿ms1
[1];

109 
deÿy
 = 
·¿ms1
[2];

110 
B1
 = 
·¿ms1
[3];

111 
B2
 = 
·¿ms1
[4];

112 
•s
 = 
·¿ms1
[5];

113 
max_¿tio
 = 
·¿ms1
[6];

114 
mš_¿tio
 = 
·¿ms1
[7];

115 
ş
 = 
·¿ms1
[8];

116 
ªgË
 = 
·¿ms1
[9];

117 
a¥eù
 = 
·¿ms1
[10];

118 
§tu¿tiÚ
 = 
·¿ms1
[11];

119 
exposu»
 = 
·¿ms1
[12];

120 
hue
 = 
·¿ms1
[13];

121 
pow”
 = 
·¿ms1
[14];

124 
gGlob®BufãrT¿ck”
 += (16 * ());

125 
gGlob®BufãrT¿ck”
 += (15 * ());

127 
	`make_ÃtwÜk_TA
(
n
, 
Ë¬nšg_¿‹
, 
mom’tum
, 
deÿy
, 
time_¡•s
, 
nÙruth
, 
b©ch
, 
subdivisiÚs
, 
¿ndom
, 
adam
, 
B1
, 
B2
, 
•s
, 
h
, 
w
, 
c
, 
šputs
, 
max_üİ
, 
mš_üİ
, 
max_¿tio
, 
mš_¿tio
, 
ûÁ”
, 
ş
, 
ªgË
, 
a¥eù
, 
§tu¿tiÚ
, 
exposu»
, 
hue
, 
buº_š
, 
pow”
, 
max_b©ches
);

129 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

136  
TEE_SUCCESS
;

137 
	}
}

139 
TEE_ResuÉ
 
	$upd©e_Ãt_agrv_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

140 
TEE_P¬am
 
·¿ms
[4])

142 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_VALUE_INPUT
,

143 
TEE_PARAM_TYPE_MEMREF_INOUT
,

144 
TEE_PARAM_TYPE_NONE
,

145 
TEE_PARAM_TYPE_NONE
);

148 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

149  
TEE_ERROR_BAD_PARAMETERS
;

151 
Ã‰a
.
wÜk¥aû
 = 
·¿ms
[1].
mem»f
.
bufãr
;

154 
gGlob®BufãrT¿ck”
 +ğ(
ušt32_t
)
·¿ms
[1].
mem»f
.
size
;

156 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

163  
TEE_SUCCESS
;

164 
	}
}

167 
TEE_ResuÉ
 
	$make_cÚvŞutiÚ®_Ïy”_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

168 
TEE_P¬am
 
·¿ms
[4])

170 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

171 
TEE_PARAM_TYPE_VALUE_INPUT
,

172 
TEE_PARAM_TYPE_MEMREF_INPUT
,

173 
TEE_PARAM_TYPE_NONE
);

176 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

177  
TEE_ERROR_BAD_PARAMETERS
;

179 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

180 
·¿ms1
 = 
·¿ms
[1].
v®ue
.
a
;

181 *
·¿ms2
 = 
·¿ms
[2].
mem»f
.
bufãr
;

183 
b©ch
 = 
·¿ms0
[0];

184 
h
 = 
·¿ms0
[1];

185 
w
 = 
·¿ms0
[2];

186 
c
 = 
·¿ms0
[3];

187 
n
 = 
·¿ms0
[4];

188 
groups
 = 
·¿ms0
[5];

189 
size
 = 
·¿ms0
[6];

190 
¡ride
 = 
·¿ms0
[7];

191 
·ddšg
 = 
·¿ms0
[8];

192 
b©ch_nÜm®ize
 = 
·¿ms0
[9];

193 
bš¬y
 = 
·¿ms0
[10];

194 
xnÜ
 = 
·¿ms0
[11];

195 
adam
 = 
·¿ms0
[12];

196 
æ³d
 = 
·¿ms0
[13];

197 
dÙ
 = 
·¿ms1
;

198 *
aùi
 = 
·¿ms2
;

200 
ACTIVATION_TA
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ_TA
(
aùi
);

202 
gGlob®BufãrT¿ck”
 += (12 + 14 * () + 2 * ());

204 
Ïy”_TA
 
Éa
 = 
	`make_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
, 
æ³d
, 
dÙ
);

205 
Ã‰a
.
Ïy”s
[
ÃŠum
] = 
Éa
;

206 
ÃŠum
++;

208 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

214  
TEE_SUCCESS
;

215 
	}
}

217 
TEE_ResuÉ
 
	$make_maxpoŞ_Ïy”_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

218 
TEE_P¬am
 
·¿ms
[4])

220 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

221 
TEE_PARAM_TYPE_NONE
,

222 
TEE_PARAM_TYPE_NONE
,

223 
TEE_PARAM_TYPE_NONE
);

226 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

227  
TEE_ERROR_BAD_PARAMETERS
;

229 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

231 
b©ch
 = 
·¿ms0
[0];

232 
h
 = 
·¿ms0
[1];

233 
w
 = 
·¿ms0
[2];

234 
c
 = 
·¿ms0
[3];

235 
size
 = 
·¿ms0
[4];

236 
¡ride
 = 
·¿ms0
[5];

237 
·ddšg
 = 
·¿ms0
[6];

239 
gGlob®BufãrT¿ck”
 += (4 + 7 * ());

241 
Ïy”_TA
 
Éa
 = 
	`make_maxpoŞ_Ïy”_TA
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
);

242 
Ã‰a
.
Ïy”s
[
ÃŠum
] = 
Éa
;

243 
ÃŠum
++;

245 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

251  
TEE_SUCCESS
;

252 
	}
}

254 
TEE_ResuÉ
 
	$make_drİout_Ïy”_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

255 
TEE_P¬am
 
·¿ms
[4])

257 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

258 
TEE_PARAM_TYPE_MEMREF_INPUT
,

259 
TEE_PARAM_TYPE_MEMREF_INPUT
,

260 
TEE_PARAM_TYPE_MEMREF_INPUT
);

263 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

264  
TEE_ERROR_BAD_PARAMETERS
;

266 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

267 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

268 *
·¿ms2
 = 
·¿ms
[2].
mem»f
.
bufãr
;

269 *
·¿ms3
 = 
·¿ms
[3].
mem»f
.
bufãr
;

270 
bufãrsize
 = 
·¿ms
[2].
mem»f
.
size
 / ();

272 *
·ssšt
;

273 
·ssšt
 = 
·¿ms0
;

274 
b©ch
 = 
·ssšt
[0];

275 
šputs
 = 
·ssšt
[1];

276 
w
 = 
·ssšt
[2];

277 
h
 = 
·ssšt
[3];

278 
c
 = 
·ssšt
[4];

279 
´obab™y
 = 
·¿ms1
[0];

281 *
Ãt_´ev_ouut
 = 
·¿ms2
;

282 *
Ãt_´ev_d–
 = 
·¿ms3
;

285 
gGlob®BufãrT¿ck”
 += (28 + (6*()) + ());

287 
Ïy”_TA
 
Éa
 = 
	`make_drİout_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
´obab™y
, 
w
, 
h
, 
c
, 
ÃŠum
);

289 if(
ÃŠum
 == 0){

290 
z
=0; z<
bufãrsize
; z++){

291 
Éa
.
ouut
[
z
] = 
Ãt_´ev_ouut
[z];

292 
Éa
.
d–
[
z
] = 
Ãt_´ev_d–
[z];

295 
Éa
.
ouut
 = 
Ã‰a
.
Ïy”s
[
ÃŠum
-1].output;

296 
Éa
.
d–
 = 
Ã‰a
.
Ïy”s
[
ÃŠum
-1].delta;

299 
Ã‰a
.
Ïy”s
[
ÃŠum
] = 
Éa
;

300 
ÃŠum
++;

302 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

309  
TEE_SUCCESS
;

310 
	}
}

313 
TEE_ResuÉ
 
	$make_cÚÃùed_Ïy”_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

314 
TEE_P¬am
 
·¿ms
[4])

316 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

317 
TEE_PARAM_TYPE_MEMREF_INPUT
,

318 
TEE_PARAM_TYPE_NONE
,

319 
TEE_PARAM_TYPE_NONE
);

323 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

324  
TEE_ERROR_BAD_PARAMETERS
;

326 *
·s§rg
;

327 
·s§rg
 = 
·¿ms
[0].
mem»f
.
bufãr
;

328 
b©ch
 = 
·s§rg
[0];

329 
šputs
 = 
·s§rg
[1];

330 
ouuts
 = 
·s§rg
[2];

331 
b©ch_nÜm®ize
 = 
·s§rg
[3];

332 
adam
 = 
·s§rg
[4];

334 *
aùi
;

335 
aùi
 = 
·¿ms
[1].
mem»f
.
bufãr
;

336 
ACTIVATION_TA
 
aùiv©iÚ
 = 
	`g‘_aùiv©iÚ_TA
(
aùi
);

339 
gGlob®BufãrT¿ck”
 += (8 + 5 * ());

341 
Ïy”_TA
 
Éa
 = 
	`make_cÚÃùed_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
ouuts
, 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

342 
Ã‰a
.
Ïy”s
[
ÃŠum
] = 
Éa
;

343 
ÃŠum
++;

345 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

352  
TEE_SUCCESS
;

353 
	}
}

355 
TEE_ResuÉ
 
	$make_soámax_Ïy”_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

356 
TEE_P¬am
 
·¿ms
[4])

358 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

359 
TEE_PARAM_TYPE_VALUE_INPUT
,

360 
TEE_PARAM_TYPE_NONE
,

361 
TEE_PARAM_TYPE_NONE
);

365 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

366  
TEE_ERROR_BAD_PARAMETERS
;

368 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

369 
b©ch
 = 
·¿ms0
[0];

370 
šputs
 = 
·¿ms0
[1];

371 
groups
 = 
·¿ms0
[2];

372 
w
 = 
·¿ms0
[3];

373 
h
 = 
·¿ms0
[4];

374 
c
 = 
·¿ms0
[5];

375 
¥©Ÿl
 = 
·¿ms0
[6];

376 
nŞoss
 = 
·¿ms0
[7];

377 
‹m³¿tu»
 = 
·¿ms
[1].
v®ue
.
a
;

382 
soámax_Éa
 = 
	`make_soámax_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
groups
, 
‹m³¿tu»
, 
w
, 
h
, 
c
, 
¥©Ÿl
, 
nŞoss
);

393  
TEE_SUCCESS
;

394 
	}
}

396 
TEE_ResuÉ
 
	$make_co¡_Ïy”_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

397 
TEE_P¬am
 
·¿ms
[4])

399 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

400 
TEE_PARAM_TYPE_MEMREF_INPUT
,

401 
TEE_PARAM_TYPE_MEMREF_INPUT
,

402 
TEE_PARAM_TYPE_NONE
);

406 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

407  
TEE_ERROR_BAD_PARAMETERS
;

409 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

410 
b©ch
 = 
·¿ms0
[0];

411 
šputs
 = 
·¿ms0
[1];

413 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

414 
sÿË
 = 
·¿ms1
[0];

415 
¿tio
 = 
·¿ms1
[1];

416 
noobjeù_sÿË
 = 
·¿ms1
[2];

417 
th»sh
 = 
·¿ms1
[3];

419 *
co¡_t
;

420 
co¡_t
 = 
·¿ms
[2].
mem»f
.
bufãr
;

421 
COST_TYPE_TA
 
co¡_ty³
 = 
	`g‘_co¡_ty³_TA
(
co¡_t
);

424 
gGlob®BufãrT¿ck”
 += (12 + (2*()) + (4*()));

426 
Ïy”_TA
 
Éa
 = 
	`make_co¡_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
co¡_ty³
, 
sÿË
, 
¿tio
, 
noobjeù_sÿË
, 
th»sh
);

427 
Ã‰a
.
Ïy”s
[
ÃŠum
] = 
Éa
;

428 
ÃŠum
++;

430 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

436  
TEE_SUCCESS
;

437 
	}
}

440 
TEE_ResuÉ
 
	$Œªsãr_weights_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

441 
TEE_P¬am
 
·¿ms
[4])

443 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_INPUT
,

444 
TEE_PARAM_TYPE_MEMREF_INPUT
,

445 
TEE_PARAM_TYPE_VALUE_INPUT
,

446 
TEE_PARAM_TYPE_NONE
);

450 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

451  
TEE_ERROR_BAD_PARAMETERS
;

453 *
vec
 = 
·¿ms
[0].
mem»f
.
bufãr
;

455 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

456 
Ëngth
 = 
·¿ms1
[0];

457 
Ïy”_i
 = 
·¿ms1
[1];

458 
add™iÚ®
 = 
·¿ms1
[2];

460 
ty³
 = 
·¿ms
[2].
v®ue
.
a
;

463 
gGlob®BufãrT¿ck”
 += (8 + () + (3*()));

465 
	`lßd_weights_TA
(
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
, 
add™iÚ®
);

467 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

473  
TEE_SUCCESS
;

474 
	}
}

476 
TEE_ResuÉ
 
	$§ve_weights_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

477 
TEE_P¬am
 
·¿ms
[4])

479 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
(
TEE_PARAM_TYPE_MEMREF_OUTPUT
,

480 
TEE_PARAM_TYPE_MEMREF_INPUT
,

481 
TEE_PARAM_TYPE_VALUE_INPUT
,

482 
TEE_PARAM_TYPE_NONE
);

486 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

487  
TEE_ERROR_BAD_PARAMETERS
;

489 *
vec
 = 
·¿ms
[0].
mem»f
.
bufãr
;

491 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

492 
Ëngth
 = 
·¿ms1
[0];

493 
Ïy”_i
 = 
·¿ms1
[1];

495 
ty³
 = 
·¿ms
[2].
v®ue
.
a
;

497 *
weights_’üy±ed
 = 
	`m®loc
(()*
Ëngth
);

498 
	`§ve_weights_TA
(
weights_’üy±ed
, 
Ëngth
, 
Ïy”_i
, 
ty³
);

500 
z
=0; z<
Ëngth
; z++){

501 
vec
[
z
] = 
weights_’üy±ed
[z];

504 
	`ä“
(
weights_’üy±ed
);

505  
TEE_SUCCESS
;

506 
	}
}

509 
TEE_ResuÉ
 
	$fÜw¬d_ÃtwÜk_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

510 
TEE_P¬am
 
·¿ms
[4])

512 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

513 
TEE_PARAM_TYPE_VALUE_INPUT
,

514 
TEE_PARAM_TYPE_NONE
,

515 
TEE_PARAM_TYPE_NONE
);

520 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

521  
TEE_ERROR_BAD_PARAMETERS
;

523 *
Ãt_šput
 = 
·¿ms
[0].
mem»f
.
bufãr
;

524 
Ãt_Œaš
 = 
·¿ms
[1].
v®ue
.
a
;

526 
Ã‰a
.
šput
 = 
Ãt_šput
;

527 
Ã‰a
.
Œaš
 = 
Ãt_Œaš
;

529 
	`fÜw¬d_ÃtwÜk_TA
();

535  
TEE_SUCCESS
;

536 
	}
}

538 
TEE_ResuÉ
 
	$fÜw¬d_soámax_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

539 
TEE_P¬am
 
·¿ms
[4])

541 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

542 
TEE_PARAM_TYPE_MEMREF_INPUT
,

543 
TEE_PARAM_TYPE_MEMREF_OUTPUT
,

544 
TEE_PARAM_TYPE_NONE
);

549 
TEE_ResuÉ
 
¡©us
 = 
TEE_SUCCESS
;

550 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

551  
TEE_ERROR_BAD_PARAMETERS
;

553 *
Ãt_šput
 = 
·¿ms
[0].
mem»f
.
bufãr
;

554 
ušt8_t
 *
g_bufãr
 = 
·¿ms
[1].
mem»f
.
bufãr
;

555 *
Ãt_ouut
 = 
·¿ms
[2].
mem»f
.
bufãr
;

557 
	`memıy
(
_g_bufãr
, 
g_bufãr
, 16);

558 
	`EMSG
("\nDeüy±h·¹ŸÈ»suÉ sizğ%d\n", 
soámax_Éa
.
šputs
);

560 
»suÉ
 = 
	`«s_cbc_TA
((*)"deüy±", 
Ãt_šput
, 
soámax_Éa
.
šputs
, 1);

561 
	`EMSG
("\nDone...\n");

562 if(
»suÉ
 != 0)

564 
	`EMSG
("\n Decryption failed...!!!\n");

565 
¡©us
 = 
TEE_ERROR_GENERIC
;

570 
	`fÜw¬d_soámax_Ïy”_TA
(
Ãt_šput
);

572 
z
 = 0; z < 
soámax_Éa
.
ouuts
 * soámax_Éa.
b©ch
; z++){

573 
Ãt_ouut
[
z
] = 
soámax_Éa
.
ouut
[z];

577 
	`ä“
(
_g_bufãr
);

578  
¡©us
;

579 
	}
}

581 
TEE_ResuÉ
 
	$backw¬d_ÃtwÜk_back_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

582 
TEE_P¬am
 
·¿ms
[4])

584 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_OUTPUT
,

585 
TEE_PARAM_TYPE_MEMREF_OUTPUT
,

586 
TEE_PARAM_TYPE_NONE
,

587 
TEE_PARAM_TYPE_NONE
);

588 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

589  
TEE_ERROR_BAD_PARAMETERS
;

595 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

596 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

597 *
bufãrsize
 = 
·¿ms
[0].
mem»f
.
size
 / ();

598 
z
=0; z<
bufãrsize
; z++){

599 
·¿ms0
[
z
] = 
_Ãt_šput
[z];

600 
·¿ms1
[
z
] = 
_Ãt_d–
[z];

605  
TEE_SUCCESS
;

606 
	}
}

610 
TEE_ResuÉ
 
	$backw¬d_ÃtwÜk_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

611 
TEE_P¬am
 
·¿ms
[4])

615 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

616 
TEE_PARAM_TYPE_MEMREF_INPUT
,

617 
TEE_PARAM_TYPE_VALUE_INPUT
,

618 
TEE_PARAM_TYPE_NONE
);

623 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

624  
TEE_ERROR_BAD_PARAMETERS
;

626 *
ÿ_Ãt_šput
 = 
·¿ms
[0].
mem»f
.
bufãr
;

627 *
ÿ_Ãt_d–
 = 
·¿ms
[1].
mem»f
.
bufãr
;

628 
Ãt_Œaš
 = 
·¿ms
[2].
v®ue
.
a
;

630 
Ã‰a
.
Œaš
 = 
Ãt_Œaš
;

632 
	`backw¬d_ÃtwÜk_TA
(
ÿ_Ãt_šput
, 
ÿ_Ãt_d–
);

634  
TEE_SUCCESS
;

635 
	}
}

637 
TEE_ResuÉ
 
	$upd©e_ÃtwÜk_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

638 
TEE_P¬am
 
·¿ms
[4])

640 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

641 
TEE_PARAM_TYPE_MEMREF_INPUT
,

642 
TEE_PARAM_TYPE_NONE
,

643 
TEE_PARAM_TYPE_NONE
);

648 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

649  
TEE_ERROR_BAD_PARAMETERS
;

651 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

652 *
·¿ms1
 = 
·¿ms
[1].
mem»f
.
bufãr
;

654 
upd©e_¬gs_TA
 
a
;

655 
a
.
b©ch
 = 
·¿ms0
[0];

656 
a
.
adam
 = 
·¿ms0
[1];

657 
a
.
t
 = 
·¿ms0
[2];

658 
a
.
Ë¬nšg_¿‹
 = 
·¿ms1
[0];

659 
a
.
mom’tum
 = 
·¿ms1
[1];

660 
a
.
deÿy
 = 
·¿ms1
[2];

661 
a
.
B1
 = 
·¿ms1
[3];

662 
a
.
B2
 = 
·¿ms1
[4];

663 
a
.
•s
 = 
·¿ms1
[5];

665 
	`upd©e_ÃtwÜk_TA
(
a
);

667 
	`ä“
(
_Ãt_šput
);

668 
	`ä“
(
_Ãt_d–
);

670  
TEE_SUCCESS
;

671 
	}
}

673 
TEE_ResuÉ
 
	$Ãt_Œuth_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

674 
TEE_P¬am
 
·¿ms
[4])

676 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

677 
TEE_PARAM_TYPE_NONE
,

678 
TEE_PARAM_TYPE_NONE
,

679 
TEE_PARAM_TYPE_NONE
);

684 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

685  
TEE_ERROR_BAD_PARAMETERS
;

687 
size_Œuth
 = 
·¿ms
[0].
mem»f
.
size
;

688 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

690 
Ã‰a_Œuth
 = 
	`m®loc
(
size_Œuth
);

691 
z
=0; z<
size_Œuth
/(); z++){

692 
Ã‰a_Œuth
[
z
] = 
·¿ms0
[z];

694 
Ã‰a
.
Œuth
 = 
Ã‰a_Œuth
;

696  
TEE_SUCCESS
;

697 
	}
}

699 
TEE_ResuÉ
 
	$ÿlc_ÃtwÜk_loss_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

700 
TEE_P¬am
 
·¿ms
[4])

702 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

703 
TEE_PARAM_TYPE_NONE
,

704 
TEE_PARAM_TYPE_NONE
,

705 
TEE_PARAM_TYPE_NONE
);

707 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

708 
n
 = 
·¿ms0
[0];

709 
b©ch
 = 
·¿ms0
[1];

711 
	`ÿlc_ÃtwÜk_loss_TA
(
n
, 
b©ch
);

713  
TEE_SUCCESS
;

714 
	}
}

717 
TEE_ResuÉ
 
	$Ãt_ouut_»tuº_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

718 
TEE_P¬am
 
·¿ms
[4])

720 
TEE_ResuÉ
 
¡©us
 = 
TEE_SUCCESS
;

721 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_OUTPUT
,

722 
TEE_PARAM_TYPE_MEMREF_OUTPUT
,

723 
TEE_PARAM_TYPE_NONE
,

724 
TEE_PARAM_TYPE_NONE
);

726 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

727  
TEE_ERROR_BAD_PARAMETERS
;

729 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

730 
bufãrsize
 = 
·¿ms
[0].
mem»f
.
size
 / ();

732 
ušt8_t
 *
gbufãr
 = 
·¿ms
[1].
mem»f
.
bufãr
;

733 
g_Ëngth
 = 
·¿ms
[1].
mem»f
.
size
;

754 
_g_bufãr
 = (
ušt8_t
 *)
	`ÿÎoc
(1, 
g_Ëngth
);

755 
	`EMSG
("\nEnüy±h·¹ŸÈ»suÉ sizğ%d\n",
bufãrsize
);

757 
»suÉ
 = 
	`«s_cbc_TA
((*)"’üy±", 
_Ãt_ouut
, 
bufãrsize
, 1);

758 
	`EMSG
("\nDone...\n");

760 if(
»suÉ
 == 0)

762 
z
=0; z<
bufãrsize
; z++){

763 
·¿ms0
[
z
] = 
_Ãt_ouut
[z];

765 
z
=0; z<
g_Ëngth
; z++){

766 
gbufãr
[
z
] = 
_g_bufãr
[z];

771 
¡©us
 = 
TEE_ERROR_GENERIC
;

774 
	`ä“
(
_Ãt_ouut
);

776 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

782  
¡©us
;

783 
	}
}

785 
TEE_ResuÉ
 
	$®loÿ‹_wÜk¥aû_TA_·¿ms
(
ušt32_t
 
·¿m_ty³s
,

786 
TEE_P¬am
 
·¿ms
[4])

788 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INPUT
,

789 
TEE_PARAM_TYPE_NONE
,

790 
TEE_PARAM_TYPE_NONE
,

791 
TEE_PARAM_TYPE_NONE
);

793 *
·¿ms0
 = 
·¿ms
[0].
mem»f
.
bufãr
;

794 
ušt32_t
 
wzsize
 = 
·¿ms0
[0];

796 
Ã‰a
.
wÜk¥aû
 = (*)
	`ÿÎoc
(
wzsize
, ());

797 
gGlob®BufãrT¿ck”
 +ğ
wzsize
;

798 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

804  
TEE_SUCCESS
;

805 
	}
}

807 
TEE_ResuÉ
 
	$g’”©e_£cu»_¿ndom_numb”
(
ušt32_t
 
·¿m_ty³s
,

808 
TEE_P¬am
 
·¿ms
[4])

810 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_VALUE_OUTPUT
,

811 
TEE_PARAM_TYPE_NONE
,

812 
TEE_PARAM_TYPE_NONE
,

813 
TEE_PARAM_TYPE_NONE
);

814 
TEE_ResuÉ
 
¡©us
 = 
TEE_SUCCESS
;

815 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

816  
TEE_ERROR_BAD_PARAMETERS
;

821 
_¿ndom_numb”
 = (
ušt32_t
)
	`¿nd
();

822 
	`EMSG
("\nRªdom‚umb”: %d\n",
_¿ndom_numb”
);

825 
·¿ms
[0].
v®ue
.
a
 = 
_¿ndom_numb”
;

827  
TEE_SUCCESS
;

828 
	}
}

830 
	$g‘DecSŒ
(* 
¡r
, 
ušt8_t
 
Ën
, ušt8_ˆ
tÙ®_couÁ
, 
ušt32_t
 
v®
)

832 
ušt8_t
 
i
;

833 
i
 = 1; i <ğ
Ën
; i++)

835 
¡r
[
Ën
-
i
] = ()((
v®
 % 10UL) + '0');

836 
v®
/=10;

838 ; 
i
 <ğ
tÙ®_couÁ
; i++)

840 
¡r
[
i
] = '0';

843 
	}
}

845 
	$num_of_dig™s_št
(
a
)

847 
x
;

848 
x
 = 1; 
a
 >= 10; x++)

850 
a
 =‡ / 10;

852  
x
;

853 
	}
}

855 
TEE_ResuÉ
 
	$v”ify_sgx_©‹¡©iÚ_tok’
(
ušt32_t
 
·¿m_ty³s
,

856 
TEE_P¬am
 
·¿ms
[4])

858 
ušt32_t
 
exp_·¿m_ty³s
 = 
	`TEE_PARAM_TYPES
Ğ
TEE_PARAM_TYPE_MEMREF_INOUT
,

859 
TEE_PARAM_TYPE_MEMREF_INPUT
,

860 
TEE_PARAM_TYPE_NONE
,

861 
TEE_PARAM_TYPE_NONE
);

862 
TEE_ResuÉ
 
¡©us
 = 
TEE_SUCCESS
;

863 ià(
·¿m_ty³s
 !ğ
exp_·¿m_ty³s
)

864  
TEE_ERROR_BAD_PARAMETERS
;

866 *
©‹¡©iÚ_bufãr
 = 
·¿ms
[0].
mem»f
.
bufãr
;

867 
©‹¡_size
 = 
·¿ms
[0].
mem»f
.
size
;

868 
ušt8_t
 *
g_bufãr
 = 
·¿ms
[1].
mem»f
.
bufãr
;

869 
g_size
 = 
·¿ms
[1].
mem»f
.
size
;

871 
_g_bufãr
 = (
ušt8_t
 *)
	`ÿÎoc
(1,
g_size
);

872 
	`memıy
(
_g_bufãr
, 
g_bufãr
, 
g_size
);

874 
	`EMSG
("\nDeüy±huuidok’ sizğ%d\n", 
©‹¡_size
);

875 
»suÉ
 = 
	`«s_cbc_TA_tok’
((*)"deüy±", 
©‹¡©iÚ_bufãr
, 
©‹¡_size
);

876 
	`EMSG
("\nDone...\n");

877 if(
»suÉ
 != 0)

879 
	`EMSG
("\n Decryption failed...!!!\n");

880 
¡©us
 = 
TEE_ERROR_GENERIC
;

884 
tÙ®_couÁ
 = 10;

885 
num_of_dig™s
 = 
	`num_of_dig™s_št
(
_¿ndom_numb”
);

888 
tok’
[10];

890 
	`g‘DecSŒ
(
tok’
, 
num_of_dig™s
, 
tÙ®_couÁ
, 
_¿ndom_numb”
);

891 
	`EMSG
("Ex³ùedok’: %s", 
tok’
);

893 
	`EMSG
("A‰e¡©iÚ sŒšg: %s\n", 
©‹¡©iÚ_bufãr
);

895 if(
	`¡ºcmp
(
©‹¡©iÚ_bufãr
, 
UID
, 36) != 0)

897 
	`EMSG
("\nUUID comparison failed...\n");

898 
¡©us
 = 
TEE_ERROR_GENERIC
;

902 
	`EMSG
("\nUUID comparison…assed...");

906 if(
	`¡ºcmp
(
©‹¡©iÚ_bufãr
+36, 
tok’
, 
num_of_dig™s
) != 0)

908 
	`EMSG
("\nToken comparison failed...\n");

909 
¡©us
 = 
TEE_ERROR_GENERIC
;

913 
	`EMSG
("\nToken comparison…assed...\n");

918 
	`ä“
(
_g_bufãr
);

919  
¡©us
;

920 
	}
}

922 
TEE_ResuÉ
 
	$TA_InvokeCommªdEÁryPošt
(
__maybe_unu£d
 *
£ss_ùx
,

923 
ušt32_t
 
cmd_id
,

924 
ušt32_t
 
·¿m_ty³s
, 
TEE_P¬am
 
·¿ms
[4])

926 ()&
£ss_ùx
;

928 
cmd_id
) {

929 
MAKE_NETWORK_CMD
:

930  
	`make_ÃtowÜk_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

932 
WORKSPACE_NETWORK_CMD
:

933  
	`upd©e_Ãt_agrv_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

935 
MAKE_CONV_CMD
:

936  
	`make_cÚvŞutiÚ®_Ïy”_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

938 
MAKE_MAX_CMD
:

939  
	`make_maxpoŞ_Ïy”_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

941 
MAKE_DROP_CMD
:

942  
	`make_drİout_Ïy”_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

944 
MAKE_CONNECTED_CMD
:

945  
	`make_cÚÃùed_Ïy”_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

947 
MAKE_SOFTMAX_CMD
:

948  
	`make_soámax_Ïy”_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

950 
MAKE_COST_CMD
:

951  
	`make_co¡_Ïy”_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

953 
TRANS_WEI_CMD
:

954  
	`Œªsãr_weights_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

956 
SAVE_WEI_CMD
:

957  
	`§ve_weights_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

959 
FORWARD_CMD
:

960  
	`fÜw¬d_ÃtwÜk_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

962 
BACKWARD_CMD
:

963  
	`backw¬d_ÃtwÜk_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

965 
BACKWARD_ADD_CMD
:

966  
	`backw¬d_ÃtwÜk_back_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

968 
UPDATE_CMD
:

969  
	`upd©e_ÃtwÜk_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

971 
NET_TRUTH_CMD
:

972  
	`Ãt_Œuth_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

974 
CALC_LOSS_CMD
:

975  
	`ÿlc_ÃtwÜk_loss_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

977 
OUTPUT_RETURN_CMD
:

978  
	`Ãt_ouut_»tuº_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

980 
ALLOCATE_WORKSPACE_CMD
:

981  
	`®loÿ‹_wÜk¥aû_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

983 
FORWARD_SOFTMAX_CMD
:

984  
	`fÜw¬d_soámax_TA_·¿ms
(
·¿m_ty³s
, 
·¿ms
);

986 
RAND_NUMBER_GENERATOR
:

987  
	`g’”©e_£cu»_¿ndom_numb”
(
·¿m_ty³s
, 
·¿ms
);

989 
VERIFY_ATTESTATION_TOKEN
:

990  
	`v”ify_sgx_©‹¡©iÚ_tok’
(
·¿m_ty³s
, 
·¿ms
);

993  
TEE_ERROR_BAD_PARAMETERS
;

995 
	}
}

	@ta/diffprivate_TA.c

1 
	~"m©h_TA.h
"

2 
	~"uts_TA.h
"

3 
	~"difåriv©e_TA.h
"

5 *
	$diff_´iv©e_SGD
(*
šput
, 
Ën_šput
)

8 
bound
 = 4;

9 
•sÚ
 = 4;

10 
d–
 = 0.00001;

12 
sum
 = 0;

13 
i
=0; i<
Ën_šput
; i++){

14 
sum
 +ğ
šput
[
i
] * input[i];

16 
squm
 = 
	`_sq¹
(
sum
)/
bound
;

18 if(
squm
 < 1){

19 
squm
 = 1;

22 
sigma
 = 
	`_sq¹
((2*
bound
*bound)/ (
•sÚ
*•sÚè* 
	`_log
(10, 1.25/
d–
));

24 
i
=0; i<
Ën_šput
; i++){

25 
šput
[
i
] = iÅut[i]/
squm
 + 
	`¿nd_nÜm®_TA
(0.0f, 
sigma
);

28 
	}
}

	@ta/dropout_layer_TA.c

1 
	~"drİout_Ïy”_TA.h
"

2 
	~"uts_TA.h
"

3 
	~"m©h_TA.h
"

5 
	~<¡dlib.h
>

6 
	~<¡dio.h
>

8 
	~<‹e_š‹º®_­i.h
>

9 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

11 
drİout_Ïy”_TA
 
	$make_drİout_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
´obab™y
, 
w
, 
h
, 
c
, 
ÃŠum
)

13 
drİout_Ïy”_TA
 
l
 = {0};

16 
gGlob®BufãrT¿ck”
 +ğ(
drİout_Ïy”_TA
);

18 
l
.
ty³
 = 
DROPOUT_TA
;

19 
l
.
´obab™y
 =…robability;

20 
l
.
šputs
 = inputs;

21 
l
.
ouuts
 = 
šputs
;

22 
l
.
b©ch
 = batch;

23 
l
.
¿nd
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

24 
l
.
sÿË
 = 1./(1.-
´obab™y
);

26 
l
.
ÃŠum
 =‚etnum;

28 
l
.
ouut
 = 
	`m®loc
((è* 
šputs
*
b©ch
);

29 
l
.
d–
 = 
	`m®loc
((è* 
šputs
*
b©ch
);

31 
l
.
fÜw¬d_TA
 = 
fÜw¬d_drİout_Ïy”_TA_Ãw
;

32 
l
.
backw¬d_TA
 = 
backw¬d_drİout_Ïy”_TA_Ãw
;

33 
l
.
w
 = w;

34 
l
.
h
 = h;

35 
l
.
c
 = c;

37 
´ob
[20];

38 
	`áß
(
´obab™y
,
´ob
,3);

42 
gGlob®BufãrT¿ck”
 +ğ((3*
šputs
*
b©ch
*()) + (20*()));

44  
l
;

45 
	}
}

47 
	$»size_drİout_Ïy”_TA
(
drİout_Ïy”_TA
 *
l
, 
šputs
)

49 
l
->
¿nd
 = 
	`»®loc
Ö->¿nd,†->
šputs
*l->
b©ch
*());

50 
	}
}

52 
	$fÜw¬d_drİout_Ïy”_TA_Ãw
(
drİout_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

54 
i
;

55 ià(!
Ãt
.
Œaš
) ;

57 *
±”
;

58 if(
l
.
ÃŠum
 == 0){

59 
i
 = 0; i < 
l
.
b©ch
 *†.
šputs
; ++i){

60 
l
.
ouut
[
i
] = 
Ãt
.
šput
[i];

63 
±”
 = 
l
.
ouut
;

65 
±”
 = 
Ãt
.
šput
;

68 
i
 = 0; i < 
l
.
b©ch
 *†.
šputs
; ++i){

70 
r
 = 
	`¿nd_unifÜm_TA
(0, 1);

71 
l
.
¿nd
[
i
] = 
r
;

72 if(
r
 < 
l
.
´obab™y
è
±”
[
i
] = 0;

73 
±”
[
i
] *ğ
l
.
sÿË
;

77 
gGlob®BufãrT¿ck”
 +ğ((
l
.
b©ch
 *†.
šputs
 * ()) + () + 4);

78 
	}
}

80 
	$backw¬d_drİout_Ïy”_TA_Ãw
(
drİout_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

82 
i
;

83 if(!
Ãt
.
d–
) ;

85 *
±”
;

86 if(
l
.
ÃŠum
 == 0){

87 
±”
 = 
l
.
d–
;

89 
±”
 = 
Ãt
.
d–
;

92 
i
 = 0; i < 
l
.
b©ch
 *†.
šputs
; ++i){

93 
r
 = 
l
.
¿nd
[
i
];

94 if(
r
 < 
l
.
´obab™y
è
±”
[
i
] = 0;

95 
±”
[
i
] *ğ
l
.
sÿË
;

97 
	}
}

	@ta/gemm_TA.c

1 
	~"gemm_TA.h
"

2 
	~"uts_TA.h
"

3 
	~"ÃtwÜk_TA.h
"

4 
	~"m©h_TA.h
"

5 
	~"d¬kÃt_TA.h
"

7 
	~<¡dlib.h
>

8 
	~<¡dio.h
>

10 
	$gemm_TA
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

11 *
A
, 
lda
,

12 *
B
, 
ldb
,

13 
BETA
,

14 *
C
, 
ldc
)

16 
	`gemm_ıu_TA
Ğ
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
BETA
,
C
,
ldc
);

17 
	}
}

19 
	$gemm_Â_TA
(
M
, 
N
, 
K
, 
ALPHA
,

20 *
A
, 
lda
,

21 *
B
, 
ldb
,

22 *
C
, 
ldc
)

24 
i
,
j
,
k
;

25 #´agm¨
omp
 
·¿Î–
 

26 
i
 = 0; i < 
M
; ++i){

27 
k
 = 0; k < 
K
; ++k){

28 
A_PART
 = 
ALPHA
*
A
[
i
*
lda
+
k
];

29 
j
 = 0; j < 
N
; ++j){

30 
C
[
i
*
ldc
+
j
] +ğ
A_PART
*
B
[
k
*
ldb
+j];

34 
	}
}

36 
	$gemm_Á_TA
(
M
, 
N
, 
K
, 
ALPHA
,

37 *
A
, 
lda
,

38 *
B
, 
ldb
,

39 *
C
, 
ldc
)

49 
i
,
j
,
k
;

50 
i
 = 0; i < 
M
; ++i){

51 
j
 = 0; j < 
N
; ++j){

52 
sum
 = 0;

55 
k
 = 0; k < 
K
; ++k){

60 
sum
 +ğ
ALPHA
*
A
[
i
*
lda
+
k
]*
B
[
j
*
ldb
 + k];

66 
C
[
i
*
ldc
+
j
] +ğ
sum
;

69 
	}
}

71 
	$gemm_Š_TA
(
M
, 
N
, 
K
, 
ALPHA
,

72 *
A
, 
lda
,

73 *
B
, 
ldb
,

74 *
C
, 
ldc
)

76 
i
,
j
,
k
;

77 
i
 = 0; i < 
M
; ++i){

78 
k
 = 0; k < 
K
; ++k){

79 
A_PART
 = 
ALPHA
*
A
[
k
*
lda
+
i
];

80 
j
 = 0; j < 
N
; ++j){

82 
C
[
i
*
ldc
+
j
] +ğ
A_PART
*
B
[
k
*
ldb
+j];

86 
	}
}

88 
	$gemm_‰_TA
(
M
, 
N
, 
K
, 
ALPHA
,

89 *
A
, 
lda
,

90 *
B
, 
ldb
,

91 *
C
, 
ldc
)

93 
i
,
j
,
k
;

94 
i
 = 0; i < 
M
; ++i){

95 
j
 = 0; j < 
N
; ++j){

96 
sum
 = 0;

97 
k
 = 0; k < 
K
; ++k){

98 
sum
 +ğ
ALPHA
*
A
[
i
+
k
*
lda
]*
B
[k+
j
*
ldb
];

100 
C
[
i
*
ldc
+
j
] +ğ
sum
;

103 
	}
}

106 
	$gemm_ıu_TA
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

107 *
A
, 
lda
,

108 *
B
, 
ldb
,

109 
BETA
,

110 *
C
, 
ldc
)

113 
i
, 
j
;

114 
i
 = 0; i < 
M
; ++i){

115 
j
 = 0; j < 
N
; ++j){

116 
C
[
i
*
ldc
 + 
j
] *ğ
BETA
;

120 if(!
TA
 && !
TB
)

121 
	`gemm_Â_TA
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

122 if(
TA
 && !
TB
)

123 
	`gemm_Š_TA
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

124 if(!
TA
 && 
TB
)

125 
	`gemm_Á_TA
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

127 
	`gemm_‰_TA
(
M
, 
N
, 
K
, 
ALPHA
,
A
,
lda
, 
B
, 
ldb
,
C
,
ldc
);

128 
	}
}

	@ta/im2col_TA.c

1 
	~"im2cŞ_TA.h
"

2 
	~<¡dio.h
>

4 
	$im2cŞ_g‘_pix–_TA
(*
im
, 
height
, 
width
, 
chªÃls
,

5 
row
, 
cŞ
, 
chªÃl
, 
·d
)

7 
row
 -ğ
·d
;

8 
cŞ
 -ğ
·d
;

10 ià(
row
 < 0 || 
cŞ
 < 0 ||

11 
row
 >ğ
height
 || 
cŞ
 >ğ
width
)  0;

12  
im
[
cŞ
 + 
width
*(
row
 + 
height
*
chªÃl
)];

13 
	}
}

17 
	$im2cŞ_ıu_TA
(* 
d©a_im
,

18 
chªÃls
, 
height
, 
width
,

19 
ksize
, 
¡ride
, 
·d
, * 
d©a_cŞ
)

21 
c
,
h
,
w
;

22 
height_cŞ
 = (
height
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

23 
width_cŞ
 = (
width
 + 2*
·d
 - 
ksize
è/ 
¡ride
 + 1;

25 
chªÃls_cŞ
 = 
chªÃls
 * 
ksize
 * ksize;

26 
c
 = 0; c < 
chªÃls_cŞ
; ++c) {

27 
w_off£t
 = 
c
 % 
ksize
;

28 
h_off£t
 = (
c
 / 
ksize
) % ksize;

29 
c_im
 = 
c
 / 
ksize
 / ksize;

30 
h
 = 0; h < 
height_cŞ
; ++h) {

31 
w
 = 0; w < 
width_cŞ
; ++w) {

32 
im_row
 = 
h_off£t
 + 
h
 * 
¡ride
;

33 
im_cŞ
 = 
w_off£t
 + 
w
 * 
¡ride
;

34 
cŞ_šdex
 = (
c
 * 
height_cŞ
 + 
h
è* 
width_cŞ
 + 
w
;

35 
d©a_cŞ
[
cŞ_šdex
] = 
	`im2cŞ_g‘_pix–_TA
(
d©a_im
, 
height
, 
width
, 
chªÃls
,

36 
im_row
, 
im_cŞ
, 
c_im
, 
·d
);

42 
gGlob®BufãrT¿ck”
 +ğ((6*()è+ (3*
height_cŞ
*
width_cŞ
*
chªÃls_cŞ
*()) + (3*channels_col*()));

43 
	}
}

	@ta/include/activations_TA.h

1 #iâdeà
ACTIVATIONS_TA_H


2 
	#ACTIVATIONS_TA_H


	)

3 
	~"d¬kÃt_TA.h
"

4 
	~"m©h_TA.h
"

5 
	~<¡dio.h
>

7 *
g‘_aùiv©iÚ_¡ršg_TA
(
ACTIVATION_TA
 
a
);

9 
ACTIVATION_TA
 
g‘_aùiv©iÚ_TA
(*
s
);

11 
aùiv©e_TA
(
x
, 
ACTIVATION_TA
 
a
);

13 * 
aùiv©e_¬¿y_TA
(*
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION_TA
 
a
);

15 
g¿d›Á_TA
(
x
, 
ACTIVATION_TA
 
a
);

17 * 
g¿d›Á_¬¿y_TA
(cÚ¡ *
x
, cÚ¡ 
n
, cÚ¡ 
ACTIVATION_TA
 
a
, *
d–
);

20 
šlše
 
	$¡aœ_aùiv©e_TA
(
x
)

22 
n
 = 
	`_æoÜ
(
x
);

23 ià(
n
%2 =ğ0è 
	`_æoÜ
(
x
/2.);

24  (
x
 - 
n
è+ 
	`_æoÜ
(x/2.);

25 
	}
}

26 
šlše
 
	$h¬dn_aùiv©e_TA
(
x
)

28 ià(
x
 < -1)  -1;

29 ià(
x
 > 1)  1;

30  
x
;

31 
	}
}

32 
šlše
 
	$lš—r_aùiv©e_TA
(
x
){ x;
	}
}

33 
šlše
 
	$logi¡ic_aùiv©e_TA
(
x
){ 1./(1. + 
	`_exp
(-x));
	}
}

34 
šlše
 
	$loggy_aùiv©e_TA
(
x
){ 2./(1. + 
	`_exp
(-x)è- 1;
	}
}

35 
šlše
 
	$»lu_aùiv©e_TA
(
x
){ x*(x>0);
	}
}

36 
šlše
 
	$–u_aùiv©e_TA
(
x
){ (x >ğ0)*x + (x < 0)*(
	`_exp
(x)-1);
	}
}

37 
šlše
 
	$£lu_aùiv©e_TA
(
x
){ (x >ğ0)*1.0507*x + (x < 0)*1.0507*1.6732*(
	`_exp
(x)-1);
	}
}

38 
šlše
 
	$»l›_aùiv©e_TA
(
x
){ (x>0è? x : .01*x;
	}
}

39 
šlše
 
	$¿mp_aùiv©e_TA
(
x
){ x*(x>0)+.1*x;
	}
}

40 
šlše
 
	$Ëaky_aùiv©e_TA
(
x
){ (x>0è? x : .1*x;
	}
}

41 
šlše
 
	$nh_aùiv©e_TA
(
x
){ (
	`_exp
(2*x)-1)/Ña_exp(2*x)+1);
	}
}

42 
šlše
 
	$¶£_aùiv©e_TA
(
x
)

44 if(
x
 < -4)  .01 * (x + 4);

45 if(
x
 > 4)  .01 * (x - 4) + 1;

46  .125*
x
 + .5;

47 
	}
}

49 
šlše
 
	$lhn_aùiv©e_TA
(
x
)

51 if(
x
 < 0)  .001*x;

52 if(
x
 > 1)  .001*(x-1) + 1;

53  
x
;

54 
	}
}

57 
šlše
 
	$lhn_g¿d›Á_TA
(
x
)

59 if(
x
 > 0 && x < 1)  1;

61 
	}
}

63 
šlše
 
	$h¬dn_g¿d›Á_TA
(
x
)

65 ià(
x
 > -1 && x < 1)  1;

67 
	}
}

68 
šlše
 
	$lš—r_g¿d›Á_TA
(
x
){ 1;
	}
}

69 
šlše
 
	$logi¡ic_g¿d›Á_TA
(
x
){ (1-x)*x;
	}
}

70 
šlše
 
	$loggy_g¿d›Á_TA
(
x
)

72 
y
 = (
x
+1.)/2.;

73  2*(1-
y
)*y;

74 
	}
}

75 
šlše
 
	$¡aœ_g¿d›Á_TA
(
x
)

77 ià(
	`_æoÜ
(
x
) == x)  0;

79 
	}
}

80 
šlše
 
	$»lu_g¿d›Á_TA
(
x
){ (x>0);
	}
}

81 
šlše
 
	$–u_g¿d›Á_TA
(
x
){ (x >ğ0è+ (x < 0)*(x + 1);
	}
}

82 
šlše
 
	$£lu_g¿d›Á_TA
(
x
){ (x >ğ0)*1.0507 + (x < 0)*(x + 1.0507*1.6732);
	}
}

83 
šlše
 
	$»l›_g¿d›Á_TA
(
x
){ (x>0è? 1 : .01;
	}
}

84 
šlše
 
	$¿mp_g¿d›Á_TA
(
x
){ (x>0)+.1;
	}
}

85 
šlše
 
	$Ëaky_g¿d›Á_TA
(
x
){ (x>0è? 1 : .1;
	}
}

86 
šlše
 
	$nh_g¿d›Á_TA
(
x
){ 1-x*x;
	}
}

87 
šlše
 
	$¶£_g¿d›Á_TA
(
x
){ (x < 0 || x > 1è? .01 : .125;
	}
}

	@ta/include/aes-common.h

13 #iâdeà
AES_COMMON_H


14 
	#AES_COMMON_H


	)

16 
	~<ùy³.h
>

17 
	~<¡dlib.h
>

18 
	~<¡dio.h
>

19 
	~<¡d¬g.h
>

20 
	~<¡ršg.h
>

25 
	t«s_uch¬
;

26 
	t«s_ushÜt
;

27 
	t«s_ušt
;

28 
	t«s_ulÚg
;

29 sigÃd 
	t«s_ch¬
;

30 sigÃd 
	t«s_shÜt
;

31 sigÃd 
	t«s_št
;

32 sigÃd 
	t«s_lÚg
;

44 #ià
defšed
(
__F»eBSD__
è|| defšed(
__N‘BSD__
) || \

45 
defšed
(
__D¿gÚFly__
è|| 
	$defšed
(
__O³nBSD__
)

46 
	~<sys/ty³s.h
>

47 
	~<sys/’dŸn.h
>

48 
	#__BYTE_ORDER
 
_BYTE_ORDER


	)

49 
	#__LITTLE_ENDIAN
 
_LITTLE_ENDIAN


	)

50 
	#__BIG_ENDIAN
 
_BIG_ENDIAN


	)

52 * 
	`defšed
(
__D¿gÚFly__
è|| defšed(
__O³nBSD__
) */

54 #ifdeà
sun


55 
	~<sys/i§_defs.h
>

56 
	#__LITTLE_ENDIAN
 1234

	)

57 
	#__BIG_ENDIAN
 4321

	)

58 #ifdeà
_LITTLE_ENDIAN


59 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

61 
	#__BYTE_ORDER
 
__BIG_ENDIAN


	)

65 #ifdeà
_MSC_VER


66 
	#šlše
 
__šlše


	)

67 
	#__LITTLE_ENDIAN
 1234

	)

68 
	#__BIG_ENDIAN
 4321

	)

69 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

72 #ifdeà
__APPLE__


73 
	~<sys/ty³s.h
>

74 
	~<machše/’dŸn.h
>

75 
	#__BYTE_ORDER
 
BYTE_ORDER


	)

76 
	#__LITTLE_ENDIAN
 
LITTLE_ENDIAN


	)

77 
	#__BIG_ENDIAN
 
BIG_ENDIAN


	)

83 #iâdeà
bsw­_16


84 
	#bsw­_16
(
a
è((((
«s_ushÜt
) (a) & 0xff00) >> 8) | \

85 (((
«s_ushÜt
è(
a
è& 0x00ffè<< 8))

	)

88 #iâdeà
bsw­_32


89 #ià
defšed
 
__GNUC__


90 
	#bsw­_32
(
a
è
	`__butš_bsw­32
×)

	)

92 
	#bsw­_32
(
a
è((((
«s_ušt
) (a) & 0xff000000) >> 24) | \

93 (((
«s_ušt
è(
a
) & 0x00ff0000) >> 8) | \

94 (((
«s_ušt
è(
a
) & 0x0000ff00) << 8) | \

95 (((
«s_ušt
è(
a
è& 0x000000ffè<< 24))

	)

99 #iâdeà
bsw­_64


100 #ià
defšed
 
__GNUC__


101 
	#bsw­_64
(
a
è
	`__butš_bsw­64
×)

	)

103 
	#bsw­_64
(
a
è((((
«s_ulÚg
) (a) & 0xff00000000000000ull) >> 56) | \

104 (((
«s_ulÚg
è(
a
) & 0x00ff000000000000ull) >> 40) | \

105 (((
«s_ulÚg
è(
a
) & 0x0000ff0000000000ull) >> 24) | \

106 (((
«s_ulÚg
è(
a
) & 0x000000ff00000000ull) >> 8) | \

107 (((
«s_ulÚg
è(
a
) & 0x00000000ff000000ull) << 8) | \

108 (((
«s_ulÚg
è(
a
) & 0x0000000000ff0000ull) << 24) | \

109 (((
«s_ulÚg
è(
a
) & 0x000000000000ff00ull) << 40) | \

110 (((
«s_ulÚg
è(
a
è& 0x00000000000000ffuÎè<< 56))

	)

149 
šlše
 
«s_ushÜt
 
	$AES_GET_BE16
(cÚ¡ 
«s_uch¬
 *
a
)

151  (
a
[0] << 8) |‡[1];

152 
	}
}

154 
šlše
 
	$AES_PUT_BE16
(
«s_uch¬
 *
a
, 
«s_ushÜt
 
v®
)

156 
a
[0] = 
v®
 >> 8;

157 
a
[1] = 
v®
 & 0xff;

158 
	}
}

160 
šlše
 
«s_ushÜt
 
	$AES_GET_LE16
(cÚ¡ 
«s_uch¬
 *
a
)

162  (
a
[1] << 8) |‡[0];

163 
	}
}

165 
šlše
 
	$AES_PUT_LE16
(
«s_uch¬
 *
a
, 
«s_ushÜt
 
v®
)

167 
a
[1] = 
v®
 >> 8;

168 
a
[0] = 
v®
 & 0xff;

169 
	}
}

171 
šlše
 
«s_ušt
 
	$AES_GET_BE24
(cÚ¡ 
«s_uch¬
 *
a
)

173  (
a
[0] << 16) | (a[1] << 8) |‡[2];

174 
	}
}

176 
šlše
 
	$AES_PUT_BE24
(
«s_uch¬
 *
a
, 
«s_ušt
 
v®
)

178 
a
[0] = (
v®
 >> 16) & 0xff;

179 
a
[1] = (
v®
 >> 8) & 0xff;

180 
a
[2] = 
v®
 & 0xff;

181 
	}
}

183 
šlše
 
«s_ušt
 
	$AES_GET_BE32
(cÚ¡ 
«s_uch¬
 *
a
)

185  (
a
[0] << 24) | (a[1] << 16) | (a[2] << 8) |‡[3];

186 
	}
}

188 
šlše
 
	$AES_PUT_BE32
(
«s_uch¬
 *
a
, 
«s_ušt
 
v®
)

190 
a
[0] = (
v®
 >> 24) & 0xff;

191 
a
[1] = (
v®
 >> 16) & 0xff;

192 
a
[2] = (
v®
 >> 8) & 0xff;

193 
a
[3] = 
v®
 & 0xff;

194 
	}
}

196 
šlše
 
«s_ušt
 
	$AES_GET_LE32
(cÚ¡ 
«s_uch¬
 *
a
)

198  (
a
[3] << 24) | (a[2] << 16) | (a[1] << 8) |‡[0];

199 
	}
}

201 
šlše
 
	$AES_PUT_LE32
(
«s_uch¬
 *
a
, 
«s_ušt
 
v®
)

203 
a
[3] = (
v®
 >> 24) & 0xff;

204 
a
[2] = (
v®
 >> 16) & 0xff;

205 
a
[1] = (
v®
 >> 8) & 0xff;

206 
a
[0] = 
v®
 & 0xff;

207 
	}
}

209 
šlše
 
«s_ulÚg
 
	$AES_GET_BE64
(cÚ¡ 
«s_uch¬
 *
a
)

211  (((
«s_ulÚg
è
a
[0]) << 56) | (((aes_ulong)‡[1]) << 48) |

212 (((
«s_ulÚg
è
a
[2]) << 40) | (((aes_ulong)‡[3]) << 32) |

213 (((
«s_ulÚg
è
a
[4]) << 24) | (((aes_ulong)‡[5]) << 16) |

214 (((
«s_ulÚg
è
a
[6]) << 8) | ((aes_ulong)‡[7]);

215 
	}
}

217 
šlše
 
	$AES_PUT_BE64
(
«s_uch¬
 *
a
, 
«s_ulÚg
 
v®
)

219 
a
[0] = 
v®
 >> 56;

220 
a
[1] = 
v®
 >> 48;

221 
a
[2] = 
v®
 >> 40;

222 
a
[3] = 
v®
 >> 32;

223 
a
[4] = 
v®
 >> 24;

224 
a
[5] = 
v®
 >> 16;

225 
a
[6] = 
v®
 >> 8;

226 
a
[7] = 
v®
 & 0xff;

227 
	}
}

229 
šlše
 
«s_ulÚg
 
	$AES_GET_LE64
(cÚ¡ 
«s_uch¬
 *
a
)

231  (((
«s_ulÚg
è
a
[7]) << 56) | (((aes_ulong)‡[6]) << 48) |

232 (((
«s_ulÚg
è
a
[5]) << 40) | (((aes_ulong)‡[4]) << 32) |

233 (((
«s_ulÚg
è
a
[3]) << 24) | (((aes_ulong)‡[2]) << 16) |

234 (((
«s_ulÚg
è
a
[1]) << 8) | ((aes_ulong)‡[0]);

235 
	}
}

237 
šlše
 
	$AES_PUT_LE64
(
«s_uch¬
 *
a
, 
«s_ulÚg
 
v®
)

239 
a
[7] = 
v®
 >> 56;

240 
a
[6] = 
v®
 >> 48;

241 
a
[5] = 
v®
 >> 40;

242 
a
[4] = 
v®
 >> 32;

243 
a
[3] = 
v®
 >> 24;

244 
a
[2] = 
v®
 >> 16;

245 
a
[1] = 
v®
 >> 8;

246 
a
[0] = 
v®
 & 0xff;

247 
	}
}

252 #iâdeà
AES_WARN_UNUSED_RESULT


253 #ià
defšed
 
__GNUC__


254 
	#AES_WARN_UNUSED_RESULT
 
	`__©Œibu‹__
((
__w¬n_unu£d_»suÉ__
))

	)

256 
	#AES_WARN_UNUSED_RESULT


	)

	@ta/include/aes-internal.h

9 #iâdeà
AES_INTERNAL_H


10 
	#AES_INTERNAL_H


	)

12 cÚ¡ 
«s_ušt
 
Te0
[256];

13 cÚ¡ 
«s_ušt
 
Te1
[256];

14 cÚ¡ 
«s_ušt
 
Te2
[256];

15 cÚ¡ 
«s_ušt
 
Te3
[256];

16 cÚ¡ 
«s_ušt
 
Te4
[256];

17 cÚ¡ 
«s_ušt
 
Td0
[256];

18 cÚ¡ 
«s_ušt
 
Td1
[256];

19 cÚ¡ 
«s_ušt
 
Td2
[256];

20 cÚ¡ 
«s_ušt
 
Td3
[256];

21 cÚ¡ 
«s_ušt
 
Td4
[256];

22 cÚ¡ 
«s_ušt
 
rcÚ
[10];

23 cÚ¡ 
«s_uch¬
 
Td4s
[256];

24 cÚ¡ 
«s_uch¬
 
rcÚs
[10];

26 #iâdeà
AES_SMALL_TABLES


28 
	#RCON
(
i
è
rcÚ
[(i)]

	)

30 
	#TE0
(
i
è
Te0
[((iè>> 24è& 0xff]

	)

31 
	#TE1
(
i
è
Te1
[((iè>> 16è& 0xff]

	)

32 
	#TE2
(
i
è
Te2
[((iè>> 8è& 0xff]

	)

33 
	#TE3
(
i
è
Te3
[(iè& 0xff]

	)

34 
	#TE41
(
i
è(
Te4
[((iè>> 24è& 0xff] & 0xff000000)

	)

35 
	#TE42
(
i
è(
Te4
[((iè>> 16è& 0xff] & 0x00ff0000)

	)

36 
	#TE43
(
i
è(
Te4
[((iè>> 8è& 0xff] & 0x0000ff00)

	)

37 
	#TE44
(
i
è(
Te4
[(iè& 0xff] & 0x000000ff)

	)

38 
	#TE421
(
i
è(
Te4
[((iè>> 16è& 0xff] & 0xff000000)

	)

39 
	#TE432
(
i
è(
Te4
[((iè>> 8è& 0xff] & 0x00ff0000)

	)

40 
	#TE443
(
i
è(
Te4
[(iè& 0xff] & 0x0000ff00)

	)

41 
	#TE414
(
i
è(
Te4
[((iè>> 24è& 0xff] & 0x000000ff)

	)

42 
	#TE411
(
i
è(
Te4
[((iè>> 24è& 0xff] & 0xff000000)

	)

43 
	#TE422
(
i
è(
Te4
[((iè>> 16è& 0xff] & 0x00ff0000)

	)

44 
	#TE433
(
i
è(
Te4
[((iè>> 8è& 0xff] & 0x0000ff00)

	)

45 
	#TE444
(
i
è(
Te4
[(iè& 0xff] & 0x000000ff)

	)

46 
	#TE4
(
i
è(
Te4
[(i)] & 0x000000ff)

	)

48 
	#TD0
(
i
è
Td0
[((iè>> 24è& 0xff]

	)

49 
	#TD1
(
i
è
Td1
[((iè>> 16è& 0xff]

	)

50 
	#TD2
(
i
è
Td2
[((iè>> 8è& 0xff]

	)

51 
	#TD3
(
i
è
Td3
[(iè& 0xff]

	)

52 
	#TD41
(
i
è(
Td4
[((iè>> 24è& 0xff] & 0xff000000)

	)

53 
	#TD42
(
i
è(
Td4
[((iè>> 16è& 0xff] & 0x00ff0000)

	)

54 
	#TD43
(
i
è(
Td4
[((iè>> 8è& 0xff] & 0x0000ff00)

	)

55 
	#TD44
(
i
è(
Td4
[(iè& 0xff] & 0x000000ff)

	)

56 
	#TD0_
(
i
è
Td0
[(iè& 0xff]

	)

57 
	#TD1_
(
i
è
Td1
[(iè& 0xff]

	)

58 
	#TD2_
(
i
è
Td2
[(iè& 0xff]

	)

59 
	#TD3_
(
i
è
Td3
[(iè& 0xff]

	)

63 
	#RCON
(
i
è(
rcÚs
[(i)] << 24)

	)

65 
šlše
 
«s_ušt
 
	$rÙr
(
«s_ušt
 
v®
, 
b™s
)

67  (
v®
 >> 
b™s
) | (val << (32 - bits));

68 
	}
}

70 
	#TE0
(
i
è
Te0
[((iè>> 24è& 0xff]

	)

71 
	#TE1
(
i
è
	`rÙr
(
Te0
[((iè>> 16è& 0xff], 8)

	)

72 
	#TE2
(
i
è
	`rÙr
(
Te0
[((iè>> 8è& 0xff], 16)

	)

73 
	#TE3
(
i
è
	`rÙr
(
Te0
[(iè& 0xff], 24)

	)

74 
	#TE41
(
i
è((
Te0
[((iè>> 24è& 0xff] << 8è& 0xff000000)

	)

75 
	#TE42
(
i
è(
Te0
[((iè>> 16è& 0xff] & 0x00ff0000)

	)

76 
	#TE43
(
i
è(
Te0
[((iè>> 8è& 0xff] & 0x0000ff00)

	)

77 
	#TE44
(
i
è((
Te0
[(iè& 0xff] >> 8è& 0x000000ff)

	)

78 
	#TE421
(
i
è((
Te0
[((iè>> 16è& 0xff] << 8è& 0xff000000)

	)

79 
	#TE432
(
i
è(
Te0
[((iè>> 8è& 0xff] & 0x00ff0000)

	)

80 
	#TE443
(
i
è(
Te0
[(iè& 0xff] & 0x0000ff00)

	)

81 
	#TE414
(
i
è((
Te0
[((iè>> 24è& 0xff] >> 8è& 0x000000ff)

	)

82 
	#TE411
(
i
è((
Te0
[((iè>> 24è& 0xff] << 8è& 0xff000000)

	)

83 
	#TE422
(
i
è(
Te0
[((iè>> 16è& 0xff] & 0x00ff0000)

	)

84 
	#TE433
(
i
è(
Te0
[((iè>> 8è& 0xff] & 0x0000ff00)

	)

85 
	#TE444
(
i
è((
Te0
[(iè& 0xff] >> 8è& 0x000000ff)

	)

86 
	#TE4
(
i
è((
Te0
[(i)] >> 8è& 0x000000ff)

	)

88 
	#TD0
(
i
è
Td0
[((iè>> 24è& 0xff]

	)

89 
	#TD1
(
i
è
	`rÙr
(
Td0
[((iè>> 16è& 0xff], 8)

	)

90 
	#TD2
(
i
è
	`rÙr
(
Td0
[((iè>> 8è& 0xff], 16)

	)

91 
	#TD3
(
i
è
	`rÙr
(
Td0
[(iè& 0xff], 24)

	)

92 
	#TD41
(
i
è(
Td4s
[((iè>> 24è& 0xff] << 24)

	)

93 
	#TD42
(
i
è(
Td4s
[((iè>> 16è& 0xff] << 16)

	)

94 
	#TD43
(
i
è(
Td4s
[((iè>> 8è& 0xff] << 8)

	)

95 
	#TD44
(
i
è(
Td4s
[(iè& 0xff])

	)

96 
	#TD0_
(
i
è
Td0
[(iè& 0xff]

	)

97 
	#TD1_
(
i
è
	`rÙr
(
Td0
[(iè& 0xff], 8)

	)

98 
	#TD2_
(
i
è
	`rÙr
(
Td0
[(iè& 0xff], 16)

	)

99 
	#TD3_
(
i
è
	`rÙr
(
Td0
[(iè& 0xff], 24)

	)

103 
	#GETU32
(
±
è(((
«s_ušt
)(pt)[0] << 24) ^ \

104 ((
«s_ušt
)(
±
)[1] << 16) ^ \

105 ((
«s_ušt
)(
±
)[2] << 8) ^ \

106 ((
«s_ušt
)(
±
)[3]))

	)

107 
	#PUTU32
(
ù
, 
¡
) { \

108 (
ù
)[0] = (
«s_uch¬
)((
¡
) >> 24); \

109 (
ù
)[1] = (
«s_uch¬
)((
¡
) >> 16); \

110 (
ù
)[2] = (
«s_uch¬
)((
¡
) >> 8); \

111 (
ù
)[3] = (
«s_uch¬
)(
¡
); }

	)

113 
	#AES_PRIV_SIZE
 (4 * 4 * 15 + 4)

	)

114 
	#AES_PRIV_NR_POS
 (4 * 15)

	)

116 
«s_rijnd«l_’üy±
(cÚ¡ 
«s_ušt
 
rk
[], 
Nr
, cÚ¡ 
«s_uch¬
 
±
[16],‡es_uch¬ 
ù
[16]);

117 
«s_rijnd«l_deüy±
(cÚ¡ 
«s_ušt
 
rk
[], 
Nr
, cÚ¡ 
«s_uch¬
 
ù
[16],‡es_uch¬ 
±
[16]);

118 
«s_rijnd«l_key_£tup_dec
(
«s_ušt
 
rk
[], cÚ¡ 
«s_uch¬
 
ch”Key
[], 
size_t
 
keyB™s
);

119 
«s_rijnd«l_key_£tup_’c
(
«s_ušt
 
rk
[], cÚ¡ 
«s_uch¬
 
ch”Key
[], 
size_t
 
keyB™s
);

	@ta/include/aes.h

9 #iâdeà
AES_H


10 
	#AES_H


	)

12 #ifdeà
__ılu¥lus


16 
	#AES_FULL_UNROLL


	)

17 
	#AES_SMALL_TABLES


	)

18 
	#AES_BLOCK_SIZE
 16

	)

20 
	~"d¬kÃ_.h
"

21 
	~"«s-commÚ.h
"

22 
	~"«s-š‹º®.h
"

24 
«s_gcm_’Œy
(*
xüy±
, 
ušt8_t
 *
g¿d›Á
, ušt8_ˆ*
g_bufãr
, 
size
);

25 * 
«s_’üy±_š™
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
Ën
);

26 
«s_’üy±
(*
ùx
, cÚ¡ 
«s_uch¬
 *
¶aš
,‡es_uch¬ *
üy±
);

27 
«s_’üy±_deš™
(*
ùx
);

28 * 
«s_deüy±_š™
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
Ën
);

29 
«s_deüy±
(*
ùx
, cÚ¡ 
«s_uch¬
 *
üy±
,‡es_uch¬ *
¶aš
);

30 
«s_deüy±_deš™
(*
ùx
);

32 
AES_WARN_UNUSED_RESULT
 
«s_w¿p
(cÚ¡ 
«s_uch¬
 *
kek
, 
n
, cÚ¡‡es_uch¬ *
¶aš
,‡es_uch¬ *
ch”
);

33 
AES_WARN_UNUSED_RESULT
 
«s_unw¿p
(cÚ¡ 
«s_uch¬
 *
kek
, 
n
, cÚ¡‡es_uch¬ *
ch”
,‡es_uch¬ *
¶aš
);

34 
AES_WARN_UNUSED_RESULT
 
omac1_«s_128_veùÜ
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
num_–em
,

35 cÚ¡ 
«s_uch¬
 *
addr
[], cÚ¡ 
size_t
 *
Ën
,

36 
«s_uch¬
 *
mac
);

37 
AES_WARN_UNUSED_RESULT
 
omac1_«s_128
(cÚ¡ 
«s_uch¬
 *
key
, cÚ¡‡es_uch¬ *
d©a
, 
size_t
 
d©a_Ën
,

38 
«s_uch¬
 *
mac
);

39 
AES_WARN_UNUSED_RESULT
 
«s_128_’üy±_block
(cÚ¡ 
«s_uch¬
 *
key
, cÚ¡‡es_uch¬ *
š
,‡es_uch¬ *
out
);

40 
AES_WARN_UNUSED_RESULT
 
«s_128_ùr_’üy±
(cÚ¡ 
«s_uch¬
 *
key
, cÚ¡‡es_uch¬ *
nÚû
,

41 
«s_uch¬
 *
d©a
, 
size_t
 
d©a_Ën
);

42 
AES_WARN_UNUSED_RESULT
 
«s_128_—x_’üy±
(cÚ¡ 
«s_uch¬
 *
key
,

43 cÚ¡ 
«s_uch¬
 *
nÚû
, 
size_t
 
nÚû_Ën
,

44 cÚ¡ 
«s_uch¬
 *
hdr
, 
size_t
 
hdr_Ën
,

45 
«s_uch¬
 *
d©a
, 
size_t
 
d©a_Ën
,‡es_uch¬ *
g
);

46 
AES_WARN_UNUSED_RESULT
 
«s_128_—x_deüy±
(cÚ¡ 
«s_uch¬
 *
key
,

47 cÚ¡ 
«s_uch¬
 *
nÚû
, 
size_t
 
nÚû_Ën
,

48 cÚ¡ 
«s_uch¬
 *
hdr
, 
size_t
 
hdr_Ën
,

49 
«s_uch¬
 *
d©a
, 
size_t
 
d©a_Ën
, cÚ¡‡es_uch¬ *
g
);

50 
AES_WARN_UNUSED_RESULT
 
«s_128_cbc_’üy±
(cÚ¡ 
«s_uch¬
 *
key
, cÚ¡‡es_uch¬ *
iv
,‡es_uch¬ *
d©a
,

51 
size_t
 
d©a_Ën
);

52 
AES_WARN_UNUSED_RESULT
 
«s_128_cbc_deüy±
(cÚ¡ 
«s_uch¬
 *
key
, cÚ¡‡es_uch¬ *
iv
,‡es_uch¬ *
d©a
,

53 
size_t
 
d©a_Ën
);

54 
AES_WARN_UNUSED_RESULT
 
«s_gcm_«
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
,

55 cÚ¡ 
«s_uch¬
 *
iv
, 
size_t
 
iv_Ën
,

56 cÚ¡ 
«s_uch¬
 *
¶aš
, 
size_t
 
¶aš_Ën
,

57 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
,

58 
«s_uch¬
 *
üy±
,‡es_uch¬ *
g
);

59 
AES_WARN_UNUSED_RESULT
 
«s_gcm_ad
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
,

60 cÚ¡ 
«s_uch¬
 *
iv
, 
size_t
 
iv_Ën
,

61 cÚ¡ 
«s_uch¬
 *
üy±
, 
size_t
 
üy±_Ën
,

62 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
, cÚ¡‡es_uch¬ *
g
,

63 
«s_uch¬
 *
¶aš
);

64 
AES_WARN_UNUSED_RESULT
 
«s_gmac
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
,

65 cÚ¡ 
«s_uch¬
 *
iv
, 
size_t
 
iv_Ën
,

66 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
,‡es_uch¬ *
g
);

67 
AES_WARN_UNUSED_RESULT
 
«s_ccm_«
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
, cÚ¡‡es_uch¬ *
nÚû
,

68 
size_t
 
M
, cÚ¡ 
«s_uch¬
 *
¶aš
, size_ˆ
¶aš_Ën
,

69 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
,‡es_uch¬ *
üy±
,‡es_uch¬ *
auth
);

70 
AES_WARN_UNUSED_RESULT
 
«s_ccm_ad
(cÚ¡ 
«s_uch¬
 *
key
, 
size_t
 
key_Ën
, cÚ¡‡es_uch¬ *
nÚû
,

71 
size_t
 
M
, cÚ¡ 
«s_uch¬
 *
üy±
, size_ˆ
üy±_Ën
,

72 cÚ¡ 
«s_uch¬
 *
¯d
, 
size_t
 
¯d_Ën
, cÚ¡‡es_uch¬ *
auth
,

73 
«s_uch¬
 *
¶aš
);

75 #ifdeà
__ılu¥lus


	@ta/include/aes_TA.h

1 #iâdeà
_AES_H_


2 
	#_AES_H_


	)

4 
	~<¡dšt.h
>

13 #iâdeà
CBC


14 
	#CBC
 1

	)

17 #iâdeà
ECB


18 
	#ECB
 1

	)

21 #iâdeà
CTR


22 
	#CTR
 1

	)

26 
	#AES128
 1

	)

30 
	#AES_BLOCKLEN
 16

31 

	)

32 #ià
defšed
(
AES256
) && (AES256 == 1)

33 
	#AES_KEYLEN
 32

	)

34 
	#AES_keyExpSize
 240

	)

35 #–ià
defšed
(
AES192
) && (AES192 == 1)

36 
	#AES_KEYLEN
 24

	)

37 
	#AES_keyExpSize
 208

	)

39 
	#AES_KEYLEN
 16

40 
	#AES_keyExpSize
 176

	)

43 
	sAES_ùx


45 
ušt8_t
 
	mRoundKey
[
AES_keyExpSize
];

46 #ià(
defšed
(
CBC
è&& (CBC =ğ1)è|| (defšed(
CTR
) && (CTR == 1))

47 
ušt8_t
 
	mIv
[
AES_BLOCKLEN
];

51 
«s_cbc_TA
(* 
xüy±
, * 
g¿d›Á
, 
Üg_Ën
, 
mode
);

52 
«s_cbc_TA_tok’
(* 
xüy±
, * 
©‹¡©iÚ_bufãr
, 
Ën
);

53 
AES_š™_ùx
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
key
);

54 #ià(
defšed
(
CBC
è&& (CBC =ğ1)è|| (defšed(
CTR
) && (CTR == 1))

55 
AES_š™_ùx_iv
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
key
, cÚ¡ ušt8_t* 
iv
);

56 
AES_ùx_£t_iv
(
AES_ùx
* 
ùx
, cÚ¡ 
ušt8_t
* 
iv
);

59 #ià
defšed
(
ECB
) && (ECB == 1)

63 
AES_ECB_’üy±
(cÚ¡ 
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
);

64 
AES_ECB_deüy±
(cÚ¡ 
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
);

69 #ià
defšed
(
CBC
) && (CBC == 1)

74 
AES_CBC_’üy±_bufãr
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
);

75 
AES_CBC_deüy±_bufãr
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
);

80 #ià
defšed
(
CTR
) && (CTR == 1)

87 
AES_CTR_xüy±_bufãr
(
AES_ùx
* 
ùx
, 
ušt8_t
* 
buf
, 
ušt32_t
 
Ëngth
);

	@ta/include/batchnorm_layer_TA.h

1 #iâdeà
BATCHNORM_LAYER_TA_H


2 
	#BATCHNORM_LAYER_TA_H


	)

4 
fÜw¬d_b©chnÜm_Ïy”_TA
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

6 
backw¬d_sÿË_ıu_TA
(*
x_nÜm
, *
d–
, 
b©ch
, 
n
, 
size
, *
sÿË_upd©es
);

8 
m—n_d–_ıu_TA
(*
d–
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n_d–
);

10 
v¬Ÿnû_d–_ıu_TA
(*
x
, *
d–
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû_d–
);

12 
nÜm®ize_d–_ıu_TA
(*
x
, *
m—n
, *
v¬Ÿnû
, *
m—n_d–
, *
v¬Ÿnû_d–
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
d–
);

14 
backw¬d_b©chnÜm_Ïy”_TA
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

	@ta/include/blas_TA.h

1 #iâdeà
BLAS_TA_H


2 
	#BLAS_TA_H


	)

3 
	~"d¬kÃt_TA.h
"

5 
fl_ıu_TA
(
N
, 
ALPHA
, *
X
, 
INCX
);

7 
cİy_ıu_TA
(
N
, *
X
, 
INCX
, *
Y
, 
INCY
);

9 
m—n_ıu_TA
(*
x
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
m—n
);

11 
v¬Ÿnû_ıu_TA
(*
x
, *
m—n
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
, *
v¬Ÿnû
);

13 
sÿl_ıu_TA
(
N
, 
ALPHA
, *
X
, 
INCX
);

15 
axpy_ıu_TA
(
N
, 
ALPHA
, *
X
, 
INCX
, *
Y
, 
INCY
);

17 
nÜm®ize_ıu_TA
(*
x
, *
m—n
, *
v¬Ÿnû
, 
b©ch
, 
f‹rs
, 
¥©Ÿl
);

19 
soámax_TA
(*
šput
, 
n
, 
‹mp
, 
¡ride
, *
ouut
);

21 
soámax_ıu_TA
(*
šput
, 
n
, 
b©ch
, 
b©ch_off£t
, 
groups
, 
group_off£t
, 
¡ride
, 
‹mp
, *
ouut
);

23 
soámax_x_’t_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

25 
smoÙh_l1_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

27 
l1_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

29 
l2_ıu_TA
(
n
, *
´ed
, *
Œuth
, *
d–
, *
”rÜ
);

	@ta/include/col2im_TA.h

1 #iâdeà
COL2IM_TA_H


2 
	#COL2IM_TA_H


	)

4 
cŞ2im_ıu_TA
(* 
d©a_cŞ
,

5 
chªÃls
, 
height
, 
width
,

6 
ksize
, 
¡ride
, 
·d
, * 
d©a_im
);

	@ta/include/connected_layer_TA.h

1 #iâdeà
CONNECTED_LAYER_TA_H


2 
	#CONNECTED_LAYER_TA_H


	)

3 
	~"d¬kÃt_TA.h
"

5 
fÜw¬d_cÚÃùed_Ïy”_TA_Ãw
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

7 
backw¬d_cÚÃùed_Ïy”_TA_Ãw
(
Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

9 
upd©e_cÚÃùed_Ïy”_TA_Ãw
(
Ïy”_TA
 
l
, 
upd©e_¬gs_TA
 
a
);

11 
Ïy”_TA
 
make_cÚÃùed_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
ouuts
, 
ACTIVATION_TA
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
adam
);

	@ta/include/convolutional_layer_TA.h

1 #iâdeà
CONVOLUTIONAL_LAYER_TA_H


2 
	#CONVOLUTIONAL_LAYER_TA_H


	)

4 
	~"d¬kÃt_TA.h
"

6 
Ïy”_TA
 
	tcÚvŞutiÚ®_Ïy”_TA
;

8 
add_bŸs_TA
(*
ouut
, *
bŸ£s
, 
b©ch
, 
n
, 
size
);

10 
sÿË_bŸs_TA
(*
ouut
, *
sÿËs
, 
b©ch
, 
n
, 
size
);

12 
backw¬d_bŸs_TA
(*
bŸs_upd©es
, *
d–
, 
b©ch
, 
n
, 
size
);

14 
cÚvŞutiÚ®_Ïy”_TA
 
make_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
b©ch
, 
h
, 
w
, 
c
, 
n
, 
groups
, 
size
, 
¡ride
, 
·ddšg
, 
ACTIVATION_TA
 
aùiv©iÚ
, 
b©ch_nÜm®ize
, 
bš¬y
, 
xnÜ
, 
adam
, 
æ³d
, 
dÙ
);

16 
fÜw¬d_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
cÚvŞutiÚ®_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

18 
backw¬d_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
cÚvŞutiÚ®_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

20 
upd©e_cÚvŞutiÚ®_Ïy”_TA_Ãw
(
cÚvŞutiÚ®_Ïy”_TA
 
l
, 
upd©e_¬gs_TA
 
a
);

	@ta/include/cost_layer_TA.h

1 #iâdeà
COST_LAYER_TA_H


2 
	#COST_LAYER_TA_H


	)

4 
	~"d¬kÃt_TA.h
"

6 
Ïy”_TA
 
	tco¡_Ïy”_TA
;

8 
COST_TYPE_TA
 
g‘_co¡_ty³_TA
(*
s
);

10 *
g‘_co¡_¡ršg_TA
(
COST_TYPE_TA
 
a
);

12 
co¡_Ïy”_TA
 
make_co¡_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
COST_TYPE_TA
 
co¡_ty³
, 
sÿË
, 
¿tio
, 
noobjeù_sÿË
, 
th»sh
);

14 
fÜw¬d_co¡_Ïy”_TA
(
co¡_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

16 
backw¬d_co¡_Ïy”_TA
(cÚ¡ 
co¡_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

	@ta/include/darknet_TA.h

1 #iâdeà
DARKNET_API_TA


2 
	#DARKNET_API_TA


	)

3 
	~<¡dlib.h
>

4 
	~<¡dio.h
>

5 
	~<¡ršg.h
>

8 
	#SECRET_NUM_TA
 -1234

	)

10 
	#TA_THRESHOLD_LIMIT
 (60*1024*1024)

	)

12 
gpu_šdex
;

14 
ušt32_t
 
gGlob®BufãrT¿ck”
;

18 *
	mËaf
;

19 
	mn
;

20 *
	m·»Á
;

21 *
	mchd
;

22 *
	mgroup
;

23 **
	mÇme
;

25 
	mgroups
;

26 *
	mgroup_size
;

27 *
	mgroup_off£t
;

28 } 
	tŒ“_TA
;

31 
	mLOGISTIC_TA
, 
	mRELU_TA
, 
	mRELIE_TA
, 
	mLINEAR_TA
, 
	mRAMP_TA
, 
	mTANH_TA
, 
	mPLSE_TA
, 
	mLEAKY_TA
, 
	mELU_TA
, 
	mLOGGY_TA
, 
	mSTAIR_TA
, 
	mHARDTAN_TA
, 
	mLHTAN_TA
, 
	mSELU_TA


32 } 
	tACTIVATION_TA
;

35 
	mCONVOLUTIONAL_TA
,

36 
	mDECONVOLUTIONAL_TA
,

37 
	mCONNECTED_TA
,

38 
	mMAXPOOL_TA
,

39 
	mSOFTMAX_TA
,

40 
	mDETECTION_TA
,

41 
	mDROPOUT_TA
,

42 
	mCROP_TA
,

43 
	mROUTE_TA
,

44 
	mCOST_TA
,

45 
	mNORMALIZATION_TA
,

46 
	mAVGPOOL_TA
,

47 
	mLOCAL_TA
,

48 
	mSHORTCUT_TA
,

49 
	mACTIVE_TA
,

50 
	mRNN_TA
,

51 
	mGRU_TA
,

52 
	mLSTM_TA
,

53 
	mCRNN_TA
,

54 
	mBATCHNORM_TA
,

55 
	mNETWORK_TA
,

56 
	mXNOR_TA
,

57 
	mREGION_TA
,

58 
	mYOLO_TA
,

59 
	mISEG_TA
,

60 
	mREORG_TA
,

61 
	mUPSAMPLE_TA
,

62 
	mLOGXENT_TA
,

63 
	mL2NORM_TA
,

64 
	mBLANK_TA


65 } 
	tLAYER_TYPE_TA
;

68 
	mSSE_TA
, 
	mMASKED_TA
, 
	mL1_TA
, 
	mSEG_TA
, 
	mSMOOTH_TA
, 
	mWGAN_TA


69 } 
	tCOST_TYPE_TA
;

72 
	mb©ch
;

73 
	mË¬nšg_¿‹
;

74 
	mmom’tum
;

75 
	mdeÿy
;

76 
	madam
;

77 
	mB1
;

78 
	mB2
;

79 
	m•s
;

80 
	mt
;

81 } 
	tupd©e_¬gs_TA
;

83 
	gÃtwÜk_TA
;

84 
ÃtwÜk_TA
 
	tÃtwÜk_TA
;

86 
	gÏy”_TA
;

87 
Ïy”_TA
 
	tÏy”_TA
;

89 
	sÏy”_TA
{

90 
LAYER_TYPE_TA
 
	mty³
;

91 
ACTIVATION_TA
 
	maùiv©iÚ
;

92 
COST_TYPE_TA
 
	mco¡_ty³
;

93 (*
	mfÜw¬d_TA
è(
	mÏy”_TA
, 
	mÃtwÜk_TA
);

94 (*
	mbackw¬d_TA
è(
	mÏy”_TA
, 
	mÃtwÜk_TA
);

95 (*
	mupd©e_TA
è(
	mÏy”_TA
, 
	mupd©e_¬gs_TA
);

97 
	mÃŠum
;

99 
	mb©ch_nÜm®ize
;

100 
	mshÜtcut
;

101 
	mb©ch
;

102 
	mfÜûd
;

103 
	mæ³d
;

104 
	mšputs
;

105 
	mouuts
;

106 
	mnweights
;

107 
	mnbŸ£s
;

108 
	mexŒa
;

109 
	mŒuths
;

110 
	mh
,
	mw
,
	mc
;

111 
	mout_h
, 
	mout_w
, 
	mout_c
;

112 
	mn
;

113 
	mmax_boxes
;

114 
	mgroups
;

115 
	msize
;

116 
	mside
;

117 
	m¡ride
;

118 
	m»v”£
;

119 
	mæ©‹n
;

120 
	m¥©Ÿl
;

121 
	m·d
;

122 
	msq¹
;

123 
	mæ
;

124 
	mšdex
;

125 
	mbš¬y
;

126 
	mxnÜ
;

127 
	m¡•s
;

128 
	mhidd’
;

129 
	mŒuth
;

130 
	msmoÙh
;

131 
	mdÙ
;

132 
	mªgË
;

133 
	mj™‹r
;

134 
	m§tu¿tiÚ
;

135 
	mexposu»
;

136 
	mshiá
;

137 
	m¿tio
;

138 
	mË¬nšg_¿‹_sÿË
;

139 
	mş
;

140 
	mnŞoss
;

141 
	msoámax
;

142 
	mşas£s
;

143 
	mcoÜds
;

144 
	mbackground
;

145 
	m»scÜe
;

146 
	mobjeùÃss
;

147 
	mjošt
;

148 
	mnßdju¡
;

149 
	m»Üg
;

150 
	mlog
;

151 
	mnh
;

152 *
	mmask
;

153 
	mtÙ®
;

155 
	m®pha
;

156 
	mb‘a
;

157 
	mk­·
;

159 
	mcoÜd_sÿË
;

160 
	mobjeù_sÿË
;

161 
	mnoobjeù_sÿË
;

162 
	mmask_sÿË
;

163 
	mşass_sÿË
;

164 
	mbŸs_m©ch
;

165 
	m¿ndom
;

166 
	mignÜe_th»sh
;

167 
	mŒuth_th»sh
;

168 
	mth»sh
;

169 
	mfocus
;

170 
	mşassfix
;

171 
	mabsŞu‹
;

173 
	mÚlyfÜw¬d
;

174 
	m¡İbackw¬d
;

175 
	mdÚßd
;

176 
	mdÚt§ve
;

177 
	mdÚßdsÿËs
;

178 
	mnumlßd
;

180 
	m‹m³¿tu»
;

181 
	m´obab™y
;

182 
	msÿË
;

184 * 
	mcweights
;

185 * 
	mšdexes
;

186 * 
	mšput_Ïy”s
;

187 * 
	mšput_sizes
;

188 * 
	mm­
;

189 * 
	mcouÁs
;

190 ** 
	msums
;

191 * 
	m¿nd
;

192 * 
	mco¡
;

193 * 
	m¡©e
;

194 * 
	m´ev_¡©e
;

195 * 
	mfÜgÙ_¡©e
;

196 * 
	mfÜgÙ_d–
;

197 * 
	m¡©e_d–
;

198 * 
	mcombše_ıu
;

199 * 
	mcombše_d–_ıu
;

201 * 
	mcÚÿt
;

202 * 
	mcÚÿt_d–
;

204 * 
	mbš¬y_weights
;

206 * 
	mbŸ£s
;

207 * 
	mbŸs_upd©es
;

209 * 
	msÿËs
;

210 * 
	msÿË_upd©es
;

212 * 
	mweights
;

213 * 
	mweight_upd©es
;

215 * 
	md–
;

216 * 
	mouut
;

217 * 
	mloss
;

218 * 
	msqu¬ed
;

219 * 
	mnÜms
;

221 * 
	m¥©Ÿl_m—n
;

222 * 
	mm—n
;

223 * 
	mv¬Ÿnû
;

225 * 
	mm—n_d–
;

226 * 
	mv¬Ÿnû_d–
;

228 * 
	mrŞlšg_m—n
;

229 * 
	mrŞlšg_v¬Ÿnû
;

231 * 
	mx
;

232 * 
	mx_nÜm
;

234 * 
	mm
;

235 * 
	mv
;

237 * 
	mbŸs_m
;

238 * 
	mbŸs_v
;

239 * 
	msÿË_m
;

240 * 
	msÿË_v
;

243 *
	mz_ıu
;

244 *
	mr_ıu
;

245 *
	mh_ıu
;

246 * 
	m´ev_¡©e_ıu
;

248 *
	m‹mp_ıu
;

249 *
	m‹mp2_ıu
;

250 *
	m‹mp3_ıu
;

252 *
	mdh_ıu
;

253 *
	mhh_ıu
;

254 *
	m´ev_ûÎ_ıu
;

255 *
	mûÎ_ıu
;

256 *
	mf_ıu
;

257 *
	mi_ıu
;

258 *
	mg_ıu
;

259 *
	mo_ıu
;

260 *
	mc_ıu
;

261 *
	mdc_ıu
;

263 * 
	mbš¬y_šput
;

265 
Ïy”_TA
 *
	mšput_Ïy”
;

266 
Ïy”_TA
 *
	m£lf_Ïy”
;

267 
Ïy”_TA
 *
	mouut_Ïy”
;

269 
Ïy”_TA
 *
	m»£t_Ïy”
;

270 
Ïy”_TA
 *
	mupd©e_Ïy”
;

271 
Ïy”_TA
 *
	m¡©e_Ïy”
;

273 
Ïy”_TA
 *
	mšput_g©e_Ïy”
;

274 
Ïy”_TA
 *
	m¡©e_g©e_Ïy”
;

275 
Ïy”_TA
 *
	mšput_§ve_Ïy”
;

276 
Ïy”_TA
 *
	m¡©e_§ve_Ïy”
;

277 
Ïy”_TA
 *
	mšput_¡©e_Ïy”
;

278 
Ïy”_TA
 *
	m¡©e_¡©e_Ïy”
;

280 
Ïy”_TA
 *
	mšput_z_Ïy”
;

281 
Ïy”_TA
 *
	m¡©e_z_Ïy”
;

283 
Ïy”_TA
 *
	mšput_r_Ïy”
;

284 
Ïy”_TA
 *
	m¡©e_r_Ïy”
;

286 
Ïy”_TA
 *
	mšput_h_Ïy”
;

287 
Ïy”_TA
 *
	m¡©e_h_Ïy”
;

289 
Ïy”_TA
 *
	mwz
;

290 
Ïy”_TA
 *
	muz
;

291 
Ïy”_TA
 *
	mwr
;

292 
Ïy”_TA
 *
	mur
;

293 
Ïy”_TA
 *
	mwh
;

294 
Ïy”_TA
 *
	muh
;

295 
Ïy”_TA
 *
	muo
;

296 
Ïy”_TA
 *
	mwo
;

297 
Ïy”_TA
 *
	muf
;

298 
Ïy”_TA
 *
	mwf
;

299 
Ïy”_TA
 *
	mui
;

300 
Ïy”_TA
 *
	mwi
;

301 
Ïy”_TA
 *
	mug
;

302 
Ïy”_TA
 *
	mwg
;

304 
Œ“_TA
 *
	msoámax_Œ“
;

306 
size_t
 
	mwÜk¥aû_size
;

309 
ä“_Ïy”_TA
(
Ïy”_TA
);

312 
	mCONSTANT_TA
, 
	mSTEP_TA
, 
	mEXP_TA
, 
	mPOLY_TA
, 
	mSTEPS_TA
, 
	mSIG_TA
, 
	mRANDOM_TA


313 } 
	tË¬nšg_¿‹_pŞicy_TA
;

315 
	sÃtwÜk_TA
{

316 
	mn
;

317 
	mb©ch
;

318 
size_t
 *
	m£’
;

319 *
	mt
;

320 
	m•och
;

321 
	msubdivisiÚs
;

322 
Ïy”_TA
 *
	mÏy”s
;

323 *
	mouut
;

324 
Ë¬nšg_¿‹_pŞicy_TA
 
	mpŞicy
;

326 
	mË¬nšg_¿‹
;

327 
	mmom’tum
;

328 
	mdeÿy
;

329 
	mgamma
;

330 
	msÿË
;

331 
	mpow”
;

332 
	mtime_¡•s
;

333 
	m¡•
;

334 
	mmax_b©ches
;

335 *
	msÿËs
;

336 *
	m¡•s
;

337 
	mnum_¡•s
;

338 
	mbuº_š
;

340 
	madam
;

341 
	mB1
;

342 
	mB2
;

343 
	m•s
;

345 
	mšputs
;

346 
	mouuts
;

347 
	mŒuths
;

348 
	mnÙruth
;

349 
	mh
, 
	mw
, 
	mc
;

350 
	mmax_üİ
;

351 
	mmš_üİ
;

352 
	mmax_¿tio
;

353 
	mmš_¿tio
;

354 
	mûÁ”
;

355 
	mªgË
;

356 
	ma¥eù
;

357 
	mexposu»
;

358 
	m§tu¿tiÚ
;

359 
	mhue
;

360 
	m¿ndom
;

362 
	mgpu_šdex
;

363 
Œ“_TA
 *
	mh›¿rchy
;

365 *
	mšput
;

366 *
	mŒuth
;

367 *
	md–
;

368 *
	mwÜk¥aû
;

369 
	mŒaš
;

370 
	mšdex
;

371 *
	mco¡
;

372 
	mş
;

374 } 
	tÃtwÜk_TA
;

	@ta/include/darknetp_ta.h

1 #iâdeà
TA_DARKNETP_H


2 
	#TA_DARKNETP_H


	)

4 
	~"d¬kÃt_TA.h
"

5 
	~"ÃtwÜk_TA.h
"

6 
	~<‹e_š‹º®_­i.h
>

7 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

9 *
Ã‰a_Œuth
;

15 
	#TA_DARKNETP_UUID
 \

17 { 0x80, 0xaf, 0xb4, 0x—, 0xb2, 0xf1, 0x99, 0x8d} }

	)

20 
	#MAKE_NETWORK_CMD
 1

	)

21 
	#WORKSPACE_NETWORK_CMD
 2

	)

22 
	#MAKE_CONV_CMD
 3

	)

23 
	#MAKE_MAX_CMD
 4

	)

24 
	#MAKE_DROP_CMD
 5

	)

25 
	#MAKE_CONNECTED_CMD
 6

	)

26 
	#MAKE_SOFTMAX_CMD
 7

	)

27 
	#MAKE_COST_CMD
 8

	)

28 
	#FORWARD_CMD
 9

	)

29 
	#BACKWARD_CMD
 10

	)

30 
	#BACKWARD_ADD_CMD
 11

	)

31 
	#UPDATE_CMD
 12

	)

32 
	#NET_TRUTH_CMD
 13

	)

33 
	#CALC_LOSS_CMD
 14

	)

34 
	#TRANS_WEI_CMD
 15

	)

35 
	#OUTPUT_RETURN_CMD
 16

	)

36 
	#SAVE_WEI_CMD
 17

	)

37 
	#ALLOCATE_WORKSPACE_CMD
 18

	)

38 
	#FORWARD_SOFTMAX_CMD
 19

	)

39 
	#RAND_NUMBER_GENERATOR
 20

	)

40 
	#VERIFY_ATTESTATION_TOKEN
 21

	)

	@ta/include/diffprivate_TA.h

1 #iâdeà
DIFF_TA_H


2 
	#DIFF_TA_H


	)

4 *
diff_´iv©e_SGD
(*
šput
, 
Ën_šput
);

	@ta/include/dropout_layer_TA.h

1 #iâdeà
DROPOUT_LAYER_TA_H


2 
	#DROPOUT_LAYER_TA_H


	)

4 
	~"d¬kÃt_TA.h
"

6 
Ïy”_TA
 
	tdrİout_Ïy”_TA
;

8 
drİout_Ïy”_TA
 
make_drİout_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
´obab™y
, 
w
, 
h
, 
c
, 
ÃŠum
);

10 
fÜw¬d_drİout_Ïy”_TA_Ãw
(
drİout_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

11 
backw¬d_drİout_Ïy”_TA_Ãw
(
drİout_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

12 
»size_drİout_Ïy”_TA
(
drİout_Ïy”_TA
 *
l
, 
šputs
);

	@ta/include/gemm_TA.h

1 #iâdeà
GEMM_TA_H


2 
	#GEMM_TA_H


	)

4 
gemm_TA
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

5 *
A
, 
lda
,

6 *
B
, 
ldb
,

7 
BETA
,

8 *
C
, 
ldc
);

10 
gemm_ıu_TA
(
TA
, 
TB
, 
M
, 
N
, 
K
, 
ALPHA
,

11 *
A
, 
lda
,

12 *
B
, 
ldb
,

13 
BETA
,

14 *
C
, 
ldc
);

	@ta/include/im2col_TA.h

1 #iâdeà
IM2COL_TA_H


2 
	#IM2COL_TA_H


	)

4 
	~"d¬kÃt_TA.h
"

6 
im2cŞ_ıu_TA
(* 
d©a_im
,

7 
chªÃls
, 
height
, 
width
,

8 
ksize
, 
¡ride
, 
·d
, * 
d©a_cŞ
);

	@ta/include/math_TA.h

1 #iâdeà
TA_MY_TEST_H_MATH


2 
	#TA_MY_TEST_H_MATH


	)

5 
	#PI
 3.14159265358979323846

	)

6 
	#e
 2.7182818284590452354

	)

7 
	#Ê_2
 0.69314718055994530942

	)

8 
	#Ê_10
 2.30258509299404568402

	)

9 
	#fœ¡_aim_mÚey
 1000000000.0f

	)

11 
	#çbs
(
a
è(×)>0?×):(-×)))

	)

13 
_max
(
a
, 
b
);

14 
_pow
(
a
,
n
);

15 
_“e
(
x
);

16 
_exp
(
x
);

17 
_¿nd
();

18 
_æoÜ
(
x
);

19 
_sq¹
(
x
);

20 
_Ê
(
x
);

21 
_log
(
a
,
N
);

22 
_sš
(
x
);

23 
_cos
(
x
);

24 
_n
(
x
);

26 
»v”£
(*
¡r
, 
Ën
);

27 
štToSŒ
(
x
, 
¡r
[], 
d
);

28 
áß
(
n
, *
»s
, 
aá”pošt
);

29 
bubbË_sÜt_tİ
(*
¬r
, 
Ën
);

	@ta/include/maxpool_layer_TA.h

1 #iâdeà
MAXPOOL_LAYER_H


2 
	#MAXPOOL_LAYER_H


	)

4 
	~"d¬kÃt_TA.h
"

6 
Ïy”_TA
 
	tmaxpoŞ_Ïy”_TA
;

8 
maxpoŞ_Ïy”_TA
 
make_maxpoŞ_Ïy”_TA
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
);

9 
»size_maxpoŞ_Ïy”_TA
(
maxpoŞ_Ïy”_TA
 *
l
, 
w
, 
h
);

10 
fÜw¬d_maxpoŞ_Ïy”_TA_Ãw
(cÚ¡ 
maxpoŞ_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

11 
backw¬d_maxpoŞ_Ïy”_TA_Ãw
(cÚ¡ 
maxpoŞ_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

	@ta/include/network_TA.h

1 #iâdeà
NETWORK_TA_H


2 
	#NETWORK_TA_H


	)

4 
	#ADD_NOISE_AT_TCB_CUTOFF
 1

	)

6 
ÃtwÜk_TA
 
Ã‰a
;

7 *
_Ãt_šput
;

8 *
_Ãt_d–
;

9 *
_Ãt_ouut
;

10 
ušt8_t
 *
_g_bufãr
;

11 
ušt32_t
 
_¿ndom_numb”
;

13 
make_ÃtwÜk_TA
(
n
, 
Ë¬nšg_¿‹
, 
mom’tum
, 
deÿy
, 
time_¡•s
, 
nÙruth
, 
b©ch
, 
subdivisiÚs
, 
¿ndom
, 
adam
, 
B1
, 
B2
, 
•s
, 
h
, 
w
, 
c
, 
šputs
, 
max_üİ
, 
mš_üİ
, 
max_¿tio
, 
mš_¿tio
, 
ûÁ”
, 
ş
, 
ªgË
, 
a¥eù
, 
§tu¿tiÚ
, 
exposu»
, 
hue
, 
buº_š
, 
pow”
, 
max_b©ches
);

15 
ÿlc_ÃtwÜk_co¡_TA
();

17 
ÿlc_ÃtwÜk_loss_TA
(
n
, 
b©ch
);

19 
fÜw¬d_ÃtwÜk_TA
();

21 
backw¬d_ÃtwÜk_TA
(*
ÿ_Ãt_šput
, *
ÿ_Ãt_d–
);

23 
upd©e_ÃtwÜk_TA
(
upd©e_¬gs_TA
 
a
);

	@ta/include/parser_TA.h

1 #iâdeà
PAR_TA_H


2 
	#PAR_TA_H


	)

3 
	~"d¬kÃt_TA.h
"

5 
lßd_weights_TA
(*
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
, 
Œª¥o£
);

7 
§ve_weights_TA
(*
weights_’üy±ed
, 
Ëngth
, 
Ïy”_i
, 
ty³
);

	@ta/include/softmax_layer_TA.h

1 #iâdeà
SOFTMAX_LAYER_TA_H


2 
	#SOFTMAX_LAYER_TA_H


	)

3 
	~"d¬kÃt_TA.h
"

5 
Ïy”_TA
 
	tsoámax_Ïy”_TA
;

7 
Ïy”_TA
 
soámax_Éa
;

9 
soámax_¬¿y_TA
(*
šput
, 
n
, 
‹mp
, *
ouut
);

10 
soámax_Ïy”_TA
 
make_soámax_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
groups
, 
‹m³¿tu»
, 
w
, 
h
, 
c
, 
¥©Ÿl
, 
nŞoss
);

11 
fÜw¬d_soámax_Ïy”_TA
(*
šput
);

12 
backw¬d_soámax_Ïy”_TA
(cÚ¡ 
soámax_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
);

	@ta/include/user_ta_header_defines.h

2 #iâdeà
USER_TA_HEADER_DEFINES_H


3 
	#USER_TA_HEADER_DEFINES_H


	)

6 
	~<d¬kÃ_.h
>

8 
	#TA_UUID
 
TA_DARKNETP_UUID


	)

14 
	#TA_FLAGS
 
TA_FLAG_EXEC_DDR


	)

17 
	#TA_STACK_SIZE
 (1 * 1024 * 1024)

	)

20 
	#TA_DATA_SIZE
 (60 * 1024 * 1024)

	)

23 
	#TA_CURRENT_TA_EXT_PROPERTIES
 \

24 { "gp..desütiÚ", 
USER_TA_PROP_TYPE_STRING
, \

26 { "gp..v”siÚ", 
USER_TA_PROP_TYPE_U32
, &(cÚ¡ 
ušt32_t
){ 0x0010 } }

	)

	@ta/include/utils_TA.h

1 #iâdeà
UTILS_H_TA


2 
	#UTILS_H_TA


	)

3 
	~<¡dio.h
>

4 
	~"d¬kÃt_TA.h
"

6 
sum_¬¿y_TA
(*
a
, 
n
);

7 
¿nd_unifÜm_TA
(
mš
, 
max
);

8 
¿nd_nÜm®_TA
(
mu
, 
sigma
);

	@ta/math_TA.c

1 
	~"m©h_TA.h
"

3 
	~<¡d¬g.h
>

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

7 
	~<‹e_š‹º®_­i.h
>

8 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

11 
	$_max
(
a
, 
b
)

13 
m
;

14 
m
 = 0;

15 if(
a
 > 
b
){

16 
m
 = 
a
;

19 
m
 = 
b
;

21  
m
;

22 
	}
}

25 
	$_pow
(
a
, 
n
)

27 if(
n
<0è 1/
	`_pow
(
a
,-n);

28 
»s
 = 1.0;

29 
n
)

31 if(
n
&1è
»s
 *ğ
a
;

32 
a
 *=‡;

33 
n
 >>= 1;

35  
»s
;

36 
	}
}

39 
	$_“e
(
x
)

41 if(
x
>1e-3)

43 
“
 = 
	`_“e
(
x
/2);

44  
“
*ee;

47  1 + 
x
 + x*x/2 + 
	`_pow
(x,3)/6 +a_pow(x,4)/24 +a_pow(x,5)/120 +a_pow(x,6)/720 +a_pow(x,7)/5040 +a_pow(x,8)/40320.0 +a_pow(x,9)/362880.0 +a_pow(x,10)/3628800.0;

48 
	}
}

51 
	$_exp
(
x
)

53 if(
x
<0è 1/
	`_exp
(-x);

54 
n
 = ()
x
;

55 
x
 -ğ
n
;

56 
e1
 = 
	`_pow
(
e
,
n
);

57 
e2
 = 
	`_“e
(
x
);

58  
e1
*
e2
;

59 
	}
}

62 
	$_¿nd
()

64 
ušt16_t
 
dige¡
[20];

65 
sum¿nd
 = 0;

66 
	`TEE_G’”©eRªdom
(
dige¡
,(digest));

68 
i
=0; i<20; i++){

69 
dige¡_št
 = 
dige¡
[
i
];

70 
sum¿nd
 +ğ
dige¡_št
;

72 
¿nd_num
 = (è(
sum¿nd
 % 10000) / 10000;

78  
¿nd_num
;

79 
	}
}

94 
	$_æoÜ
(
x
)

96  (è
x
 - (x< 0);

97 
	}
}

99 
	$_sq¹
(
x
)

101 if(
x
>100è 10.0*
	`_sq¹
(x/100);

102 
t
 = 
x
/8 + 0.5 + 2*x/(4+x);

103 
c
 = 10;

104 
c
--)

106 
t
 = (t+
x
/t)/2;

108  
t
;

109 
	}
}

112 
	$F1
(
x
)

114  1/
x
;

115 
	}
}

117 
	$F2
(
x
)

119  1/
	`_sq¹
(1-
x
*x);

120 
	}
}

122 
	$simpsÚ
(
a
, 
b
,
æag
)

124 
c
 = 
a
 + (
b
-a)/2;

125 if(
æag
==1)

126  (
	`F1
(
a
)+4*F1(
c
)+F1(
b
))*(b-a)/6;

127 if(
æag
==2)

128  (
	`F2
(
a
)+4*F2(
c
)+F2(
b
))*(b-a)/6;

129 
	}
}

131 
	$a¤
(
a
, 
b
, 
•s
, 
A
,
æag
)

133 
c
 = 
a
 + (
b
-a)/2;

134 
L
 = 
	`simpsÚ
(
a
, 
c
,
æag
), 
R
 = simpsÚ(c, 
b
,flag);

135 if(
	`çbs
(
L
+
R
-
A
è<ğ15*
•s
)  L+R+(L+R-A)/15.0;

136  
	`a¤
(
a
, 
c
, 
•s
/2, 
L
,
æag
è+‡¤(c, 
b
,ƒps/2, 
R
,flag);

137 
	}
}

139 
	$a¤0
(
a
, 
b
, 
•s
,
æag
)

141  
	`a¤
(
a
, 
b
, 
•s
, 
	`simpsÚ
×, b,
æag
),flag);

142 
	}
}

144 
	$_Ê
(
x
)

146  
	`a¤0
(1,
x
,1e-8,1);

147 
	}
}

149 
	$_log
(
a
,
N
)

151  
	`_Ê
(
N
)/_Ê(
a
);

152 
	}
}

154 
	$_sš
(
x
)

156 
æ
 = 1;

157 if(
x
>2*
PI
 || x<-2*PI) x -= ()(x/(2*PI))*2*PI;

158 if(
x
>
PI
) x -= 2*PI;

159 if(
x
<-
PI
) x += 2*PI;

160 if(
x
>
PI
/2)

162 
x
 -ğ
PI
;

163 
æ
 *= -1;

165 if(
x
<-
PI
/2)

167 
x
 +ğ
PI
;

168 
æ
 *= -1;

170 if(
x
>
PI
/4è 
	`_cos
(PI/2-x);

171  
æ
*(
x
 - 
	`_pow
(x,3)/6 +a_pow(x,5)/120 -a_pow(x,7)/5040 +a_pow(x,9)/362880);

172 
	}
}

174 
	$_cos
(
x
)

176 
æ
 = 1;

177 if(
x
>2*
PI
 || x<-2*PI) x -= ()(x/(2*PI))*2*PI;

178 if(
x
>
PI
) x -= 2*PI;

179 if(
x
<-
PI
) x += 2*PI;

180 if(
x
>
PI
/2)

182 
x
 -ğ
PI
;

183 
æ
 *= -1;

185 if(
x
<-
PI
/2)

187 
x
 +ğ
PI
;

188 
æ
 *= -1;

190 if(
x
>
PI
/4è 
	`_sš
(PI/2-x);

191  
æ
*(1 - 
	`_pow
(
x
,2)/2 +a_pow(x,4)/24 -a_pow(x,6)/720 +a_pow(x,8)/40320);

192 
	}
}

194 
	$_n
(
x
)

196  
	`_sš
(
x
)/
	`_cos
(x);

197 
	}
}

200 
	$»v”£
(*
¡r
, 
Ën
)

202 
i
=0, 
j
=
Ën
-1, 
‹mp
;

203 
i
<
j
)

205 
‹mp
 = 
¡r
[
i
];

206 
¡r
[
i
] = sŒ[
j
];

207 
¡r
[
j
] = 
‹mp
;

208 
i
++; 
j
--;

210 
	}
}

215 
	$štToSŒ
(
x
, 
¡r
[], 
d
)

217 
i
 = 0;

218 
x
)

220 
¡r
[
i
++] = (
x
%10) + '0';

221 
x
 = x/10;

226 
i
 < 
d
)

227 
¡r
[
i
++] = '0';

229 
	`»v”£
(
¡r
, 
i
);

230 
¡r
[
i
] = '\0';

231  
i
;

232 
	}
}

235 
	$áß
(
n
, *
»s
, 
aá”pošt
)

238 
¬t
 = ()
n
;

241 
å¬t
 = 
n
 - ()
¬t
;

244 
i
 = 
	`štToSŒ
(
¬t
, 
»s
, 0);

247 ià(
aá”pošt
 != 0)

249 
»s
[
i
] = '.';

254 
å¬t
 = f·¹ * 
	`_pow
(10, 
aá”pošt
);

256 
	`štToSŒ
(()
å¬t
, 
»s
 + 
i
 + 1, 
aá”pošt
);

258 
	}
}

261 
	$bubbË_sÜt_tİ
(*
¬r
, 
Ën
) {

262 
i
, 
j
;

263 
‹mp
;

266 
i
 = 0; i < 
Ën
 - 1; i++){

267 
j
 = 0; j < 
Ën
 - 1 - 
i
; j++){

268 ià(
¬r
[
j
] <‡rr[j + 1]) {

269 
‹mp
 = 
¬r
[
j
];

270 
¬r
[
j
] =‡rr[j + 1];

271 
¬r
[
j
 + 1] = 
‹mp
;

275 
	}
}

	@ta/maxpool_layer_TA.c

1 
	~"maxpoŞ_Ïy”_TA.h
"

2 
	~"m©h_TA.h
"

4 
	~<¡dio.h
>

6 
	~<‹e_š‹º®_­i.h
>

7 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

28 
maxpoŞ_Ïy”_TA
 
	$make_maxpoŞ_Ïy”_TA
(
b©ch
, 
h
, 
w
, 
c
, 
size
, 
¡ride
, 
·ddšg
)

30 
maxpoŞ_Ïy”_TA
 
l
 = {0};

33 
gGlob®BufãrT¿ck”
 +ğ(
maxpoŞ_Ïy”_TA
);

35 
l
.
ty³
 = 
MAXPOOL_TA
;

36 
l
.
b©ch
 = batch;

37 
l
.
h
 = h;

38 
l
.
w
 = w;

39 
l
.
c
 = c;

40 
l
.
·d
 = 
·ddšg
;

41 
l
.
out_w
 = (
w
 + 
·ddšg
 - 
size
)/
¡ride
 + 1;

42 
l
.
out_h
 = (
h
 + 
·ddšg
 - 
size
)/
¡ride
 + 1;

43 
l
.
out_c
 = 
c
;

44 
l
.
ouuts
 =†.
out_h
 *†.
out_w
 *†.
out_c
;

45 
l
.
šputs
 = 
h
*
w
*
c
;

46 
l
.
size
 = size;

47 
l
.
¡ride
 = stride;

48 
ouut_size
 = 
l
.
out_h
 *†.
out_w
 *†.
out_c
 * 
b©ch
;

49 
l
.
šdexes
 = 
	`ÿÎoc
(
ouut_size
, ());

50 
l
.
ouut
 = 
	`ÿÎoc
(
ouut_size
, ());

51 
l
.
d–
 = 
	`ÿÎoc
(
ouut_size
, ());

52 
l
.
fÜw¬d_TA
 = 
fÜw¬d_maxpoŞ_Ïy”_TA_Ãw
;

53 
l
.
backw¬d_TA
 = 
backw¬d_maxpoŞ_Ïy”_TA_Ãw
;

58 
gGlob®BufãrT¿ck”
 +ğ((
ouut_size
 * ()) + (2 * output_size * ()));

60  
l
;

61 
	}
}

63 
	$»size_maxpoŞ_Ïy”_TA
(
maxpoŞ_Ïy”_TA
 *
l
, 
w
, 
h
)

65 
l
->
h
 = h;

66 
l
->
w
 = w;

67 
l
->
šputs
 = 
h
*
w
*l->
c
;

69 
l
->
out_w
 = (
w
 +†->
·d
 -†->
size
)/l->
¡ride
 + 1;

70 
l
->
out_h
 = (
h
 +†->
·d
 -†->
size
)/l->
¡ride
 + 1;

71 
l
->
ouuts
 =†->
out_w
 *†->
out_h
 *†->
c
;

72 
ouut_size
 = 
l
->
ouuts
 *†->
b©ch
;

74 
l
->
šdexes
 = 
	`»®loc
Ö->šdexes, 
ouut_size
 * ());

75 
l
->
ouut
 = 
	`»®loc
Ö->ouut, 
ouut_size
 * ());

76 
l
->
d–
 = 
	`»®loc
Ö->d–, 
ouut_size
 * ());

77 
	}
}

79 
	$fÜw¬d_maxpoŞ_Ïy”_TA_Ãw
(cÚ¡ 
maxpoŞ_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

81 
b
,
i
,
j
,
k
,
m
,
n
;

82 
w_off£t
 = -
l
.
·d
/2;

83 
h_off£t
 = -
l
.
·d
/2;

85 
h
 = 
l
.
out_h
;

86 
w
 = 
l
.
out_w
;

87 
c
 = 
l
.c;

90 
gGlob®BufãrT¿ck”
 += (11*());

92 
b
 = 0; b < 
l
.
b©ch
; ++b){

93 
k
 = 0; k < 
c
; ++k){

94 
i
 = 0; i < 
h
; ++i){

95 
j
 = 0; j < 
w
; ++j){

96 
out_šdex
 = 
j
 + 
w
*(
i
 + 
h
*(
k
 + 
c
*
b
));

97 
max
 = -
fœ¡_aim_mÚey
;

98 
max_i
 = -1;

99 
n
 = 0;‚ < 
l
.
size
; ++n){

100 
m
 = 0; m < 
l
.
size
; ++m){

101 
cur_h
 = 
h_off£t
 + 
i
*
l
.
¡ride
 + 
n
;

102 
cur_w
 = 
w_off£t
 + 
j
*
l
.
¡ride
 + 
m
;

103 
šdex
 = 
cur_w
 + 
l
.
w
*(
cur_h
 +†.
h
*(
k
 + 
b
*l.
c
));

104 
v®id
 = (
cur_h
 >ğ0 && cur_h < 
l
.
h
 &&

105 
cur_w
 >ğ0 && cur_w < 
l
.
w
);

106 
v®
 = (
v®id
 !ğ0è? 
Ãt
.
šput
[
šdex
] : -
fœ¡_aim_mÚey
;

107 
max_i
 = (
v®
 > 
max
è? 
šdex
 : max_i;

108 
max
 = (
v®
 > max) ? val : max;

111 
l
.
ouut
[
out_šdex
] = 
max
;

112 
l
.
šdexes
[
out_šdex
] = 
max_i
;

119 
gGlob®BufãrT¿ck”
 +ğ((
ušt32_t
)((2*()+())*
w
*
h
*
c
*
l
.
b©ch
è+ (ušt32_t)((4*()+())*l.
size
*l.size*w*h*c*l.batch));

120 
	}
}

122 
	$backw¬d_maxpoŞ_Ïy”_TA_Ãw
(cÚ¡ 
maxpoŞ_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

124 
i
;

125 
h
 = 
l
.
out_h
;

126 
w
 = 
l
.
out_w
;

127 
c
 = 
l
.c;

128 
i
 = 0; i < 
h
*
w
*
c
*
l
.
b©ch
; ++i){

129 
šdex
 = 
l
.
šdexes
[
i
];

130 
Ãt
.
d–
[
šdex
] +ğ
l
.d–[
i
];

132 
	}
}

	@ta/network_TA.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<¡ršg.h
>

5 
	~"d¬kÃt_TA.h
"

6 
	~"bÏs_TA.h
"

7 
	~"ÃtwÜk_TA.h
"

8 
	~"m©h_TA.h
"

10 
	~"d¬kÃ_.h
"

11 
	~<‹e_š‹º®_­i.h
>

12 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

14 
ÃtwÜk_TA
 
	gÃ‰a
;

15 
	groundnum
 = 0;

16 
	g”r_sum
 = 0;

17 
	gavg_loss
 = -1;

19 *
	g_Ãt_šput
;

20 *
	g_Ãt_d–
;

21 *
	g_Ãt_ouut
;

22 
ušt8_t
 *
	g_g_bufãr
;

23 
ušt32_t
 
	g_¿ndom_numb”
;

25 
	$make_ÃtwÜk_TA
(
n
, 
Ë¬nšg_¿‹
, 
mom’tum
, 
deÿy
, 
time_¡•s
, 
nÙruth
, 
b©ch
, 
subdivisiÚs
, 
¿ndom
, 
adam
, 
B1
, 
B2
, 
•s
, 
h
, 
w
, 
c
, 
šputs
, 
max_üİ
, 
mš_üİ
, 
max_¿tio
, 
mš_¿tio
, 
ûÁ”
, 
ş
, 
ªgË
, 
a¥eù
, 
§tu¿tiÚ
, 
exposu»
, 
hue
, 
buº_š
, 
pow”
, 
max_b©ches
)

27 
Ã‰a
.
n
 =‚;

30 
gGlob®BufãrT¿ck”
 += (2*() + () + 12);

31 
gGlob®BufãrT¿ck”
 +ğ(
Ã‰a
);

33 
	`EMSG
("NØoàÏy” š TA = %d\n",
Ã‰a
.
n
);

34 
Ã‰a
.
£’
 = 
	`ÿÎoc
(1, (
size_t
));

35 
Ã‰a
.
Ïy”s
 = 
	`ÿÎoc
Ò‘.
n
, (
Ïy”_TA
));

36 
Ã‰a
.
t
 = 
	`ÿÎoc
(1, ());

37 
Ã‰a
.
co¡
 = 
	`ÿÎoc
(1, ());

39 
gGlob®BufãrT¿ck”
 +ğ((
size_t
è+ (è+ (è+ (
Ã‰a
.
n
 * (
Ïy”_TA
)));

41 
Ã‰a
.
Ë¬nšg_¿‹
 =†earning_rate;

42 
Ã‰a
.
mom’tum
 = momentum;

43 
Ã‰a
.
deÿy
 = decay;

44 
Ã‰a
.
time_¡•s
 =ime_steps;

45 
Ã‰a
.
nÙruth
 =‚otruth;

46 
Ã‰a
.
b©ch
 = batch;

47 
Ã‰a
.
subdivisiÚs
 = subdivisions;

48 
Ã‰a
.
¿ndom
 =„andom;

49 
Ã‰a
.
adam
 =‡dam;

50 
Ã‰a
.
B1
 = B1;

51 
Ã‰a
.
B2
 = B2;

52 
Ã‰a
.
•s
 =ƒps;

53 
Ã‰a
.
h
 = h;

54 
Ã‰a
.
w
 = w;

55 
Ã‰a
.
c
 = c;

56 
Ã‰a
.
šputs
 = inputs;

57 
Ã‰a
.
max_üİ
 = max_crop;

58 
Ã‰a
.
mš_üİ
 = min_crop;

59 
Ã‰a
.
max_¿tio
 = max_ratio;

60 
Ã‰a
.
mš_¿tio
 = min_ratio;

61 
Ã‰a
.
ûÁ”
 = center;

62 
Ã‰a
.
ş
 = clip;

63 
Ã‰a
.
ªgË
 =‡ngle;

64 
Ã‰a
.
a¥eù
 =‡spect;

65 
Ã‰a
.
§tu¿tiÚ
 = saturation;

66 
Ã‰a
.
exposu»
 =ƒxposure;

67 
Ã‰a
.
hue
 = hue;

68 
Ã‰a
.
buº_š
 = burn_in;

69 
Ã‰a
.
pow”
 =…ower;

70 
Ã‰a
.
max_b©ches
 = max_batches;

73 
	}
}

75 
	$add_noi£_TA
(
Ïy”
 *
l
)

77 
row
 = 
l
->
out_h
;

78 
cŞumn
 = 
l
->
out_w
;

79 
chªÃls
 = 
l
->
out_c
;

80 
i
,
j
,
k
;

81 
noi£_³rc
 = 10;

82 
noi£_check
;

87 
	`¤ªd
(()
	`time
(
NULL
));

89 
i
 = 0; i < 
chªÃls
; i++)

91 
j
 = 0; j < 
row
; j++)

93 
k
 = 0; k < 
cŞumn
; k++)

95 
cŞ_šdex
 = (
i
 * 
row
 + 
j
è* 
cŞumn
 + 
k
;

97 
noi£_check
 = 
	`¿nd
(è% ((
noi£_³rc
+1)-1) + 1;

98 ifĞ
noi£_check
 =ğ
noi£_³rc
 )

100 
v®
 = 
	`¿nd
() % 255;

101 if(
v®
 >= 127)

102 
l
->
ouut
[
cŞ_šdex
] = 1;

104 
l
->
ouut
[
cŞ_šdex
] = 0;

109 
	}
}

111 
	$fÜw¬d_ÃtwÜk_TA
()

113 
roundnum
++;

114 
i
;

115 
i
 = 0; i < 
Ã‰a
.
n
; ++i){

116 
Ã‰a
.
šdex
 = 
i
;

117 
Ïy”_TA
 
l
 = 
Ã‰a
.
Ïy”s
[
i
];

119 if(
l
.
ty³
 =ğ
SOFTMAX_TA
)

125 if(
l
.
d–
){

126 
	`fl_ıu_TA
(
l
.
ouuts
 *†.
b©ch
, 0,†.
d–
, 1);

129 
l
.
	`fÜw¬d_TA
Ö, 
Ã‰a
);

131 #ià
ADD_NOISE_AT_TCB_CUTOFF


133 if(
i
 == 2)

135 
	`add_noi£_TA
(&
l
);

139 
Ã‰a
.
šput
 = 
l
.
ouut
;

141 if(
l
.
Œuth
) {

142 
Ã‰a
.
Œuth
 = 
l
.
ouut
;

146 if(
i
 =ğ
Ã‰a
.
n
 - 1){

147 
_Ãt_ouut
 = 
	`ÿÎoc
(
l
.
ouuts
*l.
b©ch
,());

148 
_g_bufãr
 = (
ušt8_t
 *)
	`ÿÎoc
(1, 16);

151 
gGlob®BufãrT¿ck”
 +ğ(()*
l
.
ouuts
*l.
b©ch
);

153 
z
=0; z<
l
.
ouuts
*l.
b©ch
; z++){

154 
_Ãt_ouut
[
z
] = 
l
.
ouut
[z];

158 
	`EMSG
("TCB u§gğ%d By‹s\n", 
gGlob®BufãrT¿ck”
);

168 
	`ÿlc_ÃtwÜk_co¡_TA
();

170 
	}
}

173 
	$upd©e_ÃtwÜk_TA
(
upd©e_¬gs_TA
 
a
)

175 
i
;

176 
i
 = 0; i < 
Ã‰a
.
n
; ++i){

177 
Ïy”_TA
 
l
 = 
Ã‰a
.
Ïy”s
[
i
];

178 if(
l
.
upd©e_TA
){

179 
l
.
	`upd©e_TA
Ö, 
a
);

182 
	}
}

185 
	$ÿlc_ÃtwÜk_co¡_TA
()

187 
i
;

188 
sum
 = 0;

189 
couÁ
 = 0;

190 
i
 = 0; i < 
Ã‰a
.
n
; ++i){

191 if(
Ã‰a
.
Ïy”s
[
i
].
co¡
){

192 
sum
 +ğ
Ã‰a
.
Ïy”s
[
i
].
co¡
[0];

193 ++
couÁ
;

196 *
Ã‰a
.
co¡
 = 
sum
/
couÁ
;

197 
”r_sum
 +ğ*
Ã‰a
.
co¡
;

198 
	}
}

201 
	$ÿlc_ÃtwÜk_loss_TA
(
n
, 
b©ch
)

203 
loss
 = ()
”r_sum
/(
n
*
b©ch
);

205 if(
avg_loss
 =ğ-1èavg_los ğ
loss
;

206 
avg_loss
 =‡vg_loss*.9 + 
loss
*.1;

208 
loss_ch¬
[20];

209 
avg_loss_ch¬
[20];

210 
	`áß
(
loss
, 
loss_ch¬
, 5);

211 
	`áß
(
avg_loss
, 
avg_loss_ch¬
, 5);

212 
	`IMSG
("los ğ%s,‡vg†os ğ% äomhTA\n",
loss_ch¬
, 
avg_loss_ch¬
);

213 
”r_sum
 = 0;

214 
	}
}

218 
	$backw¬d_ÃtwÜk_TA
(*
ÿ_Ãt_šput
, *
ÿ_Ãt_d–
)

220 
i
;

222 
i
 = 
Ã‰a
.
n
-1; i >= 0; --i){

223 
Ïy”_TA
 
l
 = 
Ã‰a
.
Ïy”s
[
i
];

225 if(
l
.
¡İbackw¬d
) ;

226 if(
i
 == 0){

228 
_Ãt_šput
 = 
	`m®loc
(()*
l
.
šputs
*l.
b©ch
);

229 
_Ãt_d–
 = 
	`m®loc
(()*
l
.
šputs
*l.
b©ch
);

231 
z
=0; z<
l
.
šputs
*l.
b©ch
; z++){

232 
_Ãt_šput
[
z
] = 
ÿ_Ãt_šput
[z];

233 
_Ãt_d–
[
z
] = 
ÿ_Ãt_d–
[z];

236 
Ã‰a
.
šput
 = 
_Ãt_šput
;

237 
Ã‰a
.
d–
 = 
_Ãt_d–
;

239 
Ïy”_TA
 
´ev
 = 
Ã‰a
.
Ïy”s
[
i
-1];

240 
Ã‰a
.
šput
 = 
´ev
.
ouut
;

241 
Ã‰a
.
d–
 = 
´ev
.delta;

244 
Ã‰a
.
šdex
 = 
i
;

245 
l
.
	`backw¬d_TA
Ö, 
Ã‰a
);

247 if((
l
.
ty³
 =ğ
DROPOUT_TA
è&& (
i
 == 0)){

248 
z
=0; z<
l
.
šputs
*l.
b©ch
; z++){

249 
_Ãt_šput
[
z
] = 
l
.
ouut
[z];

250 
_Ãt_d–
[
z
] = 
l
.
d–
[z];

257 
	}
}

	@ta/parser_TA.c

1 
	~<as£¹.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<¡ršg.h
>

6 
	~"d¬kÃ_.h
"

7 
	~"ÃtwÜk_TA.h
"

8 
	~<·r£r_TA.h
>

9 
	~<bÏs_TA.h
>

10 
	~"m©h_TA.h
"

11 
	~"«s_TA.h
"

12 
	~"«s.h
"

14 
	$«s_cbc_TA
(* 
xüy±
, * 
g¿d›Á
, 
Üg_Ën
, 
mode
)

16 
»suÉ
 = 0;

18 
ušt8_t
 *
by‹
;

20 
ušt8_t
 *
¬¿y
 = (ušt8_ˆ*)
	`ÿÎoc
(
Üg_Ën
*4, (uint8_t));

21 
z
 = 0; z < 
Üg_Ën
; z++){

22 
by‹
 = (
ušt8_t
*)(&
g¿d›Á
[
z
]);

23 
y
 = 0; y < 4; y++){

24 
¬¿y
[
z
*4 + 
y
] = 
by‹
[y];

28 if(
mode
 == 0)

31 
’c_Ën
 = ()(
Üg_Ën
/4);

32 
AES_ùx
 
ùx
;

33 
ušt8_t
 
iv
[] = { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f };

34 
ušt8_t
 
key
[16] = { (uint8_t)0x2b, (uint8_t)0x7e, (uint8_t)0x15, (uint8_t)0x16, (uint8_t)0x28, (uint8_t)0xae, (uint8_t)0xd2, (uint8_t)0xa6, (uint8_t)0xab, (uint8_t)0xf7, (uint8_t)0x15, (uint8_t)0x88, (uint8_t)0x09, (uint8_t)0xcf, (uint8_t)0x4f, (uint8_t)0x3c };

37 
	`AES_š™_ùx_iv
(&
ùx
, 
key
, 
iv
);

38 
i
 = 0; i < 
’c_Ën
; ++i)

40 if(
	`¡ºcmp
(
xüy±
, "encrypt", 2) == 0){

41 
	`AES_CBC_’üy±_bufãr
(&
ùx
, 
¬¿y
 + (
i
 * 16), 16);

42 }if(
	`¡ºcmp
(
xüy±
, "decrypt", 2) == 0){

43 
	`AES_CBC_deüy±_bufãr
(&
ùx
, 
¬¿y
 + (
i
 * 16), 16);

49 
»suÉ
 = 
	`«s_gcm_’Œy
(
xüy±
, 
¬¿y
, 
_g_bufãr
, 
Üg_Ën
*4);

50 if(
»suÉ
 != 0)

52 if(
	`¡ºcmp
(
xüy±
, "encrypt", 2) == 0){

53 
	`EMSG
("Enüy±iÚ faed: %d\n",
»suÉ
);

56 
	`EMSG
("Deüy±iÚ faed: %d\n",
»suÉ
);

62 
z
 = 0; z < 
Üg_Ën
; z++){

63 
g¿d›Á
[
z
] = *(*)(&
¬¿y
[z*4]);

66 
	`ä“
(
¬¿y
);

67  
»suÉ
;

68 
	}
}

70 
	$«s_cbc_TA_tok’
(* 
xüy±
, * 
©‹¡©iÚ_bufãr
, 
Ën
)

72 
»suÉ
 = 
	`«s_gcm_’Œy
(
xüy±
, (
ušt8_t
 *)
©‹¡©iÚ_bufãr
, 
_g_bufãr
, 
Ën
);

73 if(
»suÉ
 != 0)

75 if(
	`¡ºcmp
(
xüy±
, "encrypt", 2) == 0){

76 
	`EMSG
("Enüy±iÚ faed: %d\n", 
»suÉ
);

79 
	`EMSG
("Deüy±iÚ faed: %d\n", 
»suÉ
);

83  
»suÉ
;

84 
	}
}

86 
	$Œª¥o£_m©rix_TA
(*
a
, 
rows
, 
cŞs
)

88 *
Œª¥o£
 = 
	`ÿÎoc
(
rows
*
cŞs
, ());

89 
x
, 
y
;

90 
x
 = 0; x < 
rows
; ++x){

91 
y
 = 0; y < 
cŞs
; ++y){

92 
Œª¥o£
[
y
*
rows
 + 
x
] = 
a
[x*
cŞs
 + y];

95 
	`memıy
(
a
, 
Œª¥o£
, 
rows
*
cŞs
*());

96 
	`ä“
(
Œª¥o£
);

97 
	}
}

100 
	$lßd_weights_TA
(*
vec
, 
Ëngth
, 
Ïy”_i
, 
ty³
, 
Œª¥o£
)

103 *
‹mpvec
 = 
	`m®loc
(
Ëngth
*());

104 
	`cİy_ıu_TA
(
Ëngth
, 
vec
, 1, 
‹mpvec
, 1);

108 
Ïy”_TA
 
l
 = 
Ã‰a
.
Ïy”s
[
Ïy”_i
];

110 if(
ty³
 == 'b'){

111 
	`cİy_ıu_TA
(
Ëngth
, 
‹mpvec
, 1, 
l
.
bŸ£s
, 1);

113 if(
ty³
 == 'w'){

114 
	`cİy_ıu_TA
(
Ëngth
, 
‹mpvec
, 1, 
l
.
weights
, 1);

116 if(
ty³
 == 's'){

117 
	`cİy_ıu_TA
(
Ëngth
, 
‹mpvec
, 1, 
l
.
sÿËs
, 1);

119 if(
ty³
 == 'm'){

120 
	`cİy_ıu_TA
(
Ëngth
, 
‹mpvec
, 1, 
l
.
rŞlšg_m—n
, 1);

122 if(
ty³
 == 'v'){

123 
	`cİy_ıu_TA
(
Ëngth
, 
‹mpvec
, 1, 
l
.
rŞlšg_v¬Ÿnû
, 1);

127 if(
l
.
ty³
 =ğ
CONVOLUTIONAL_TA
 ||†.ty³ =ğ
DECONVOLUTIONAL_TA
){

128 if(
l
.
æ³d
 && 
ty³
 == 'w'){

129 
	`Œª¥o£_m©rix_TA
(
l
.
weights
,†.
c
*l.
size
*l.size,†.
n
);

132 if(
l
.
ty³
 =ğ
CONNECTED_TA
){

133 if(
Œª¥o£
 && 
ty³
 == 'w'){

134 
	`Œª¥o£_m©rix_TA
(
l
.
weights
,†.
šputs
,†.
ouuts
);

138 
	`ä“
(
‹mpvec
);

139 
	}
}

141 
	$§ve_weights_TA
(*
weights_’üy±ed
, 
Ëngth
, 
Ïy”_i
, 
ty³
)

143 
Ïy”_TA
 
l
 = 
Ã‰a
.
Ïy”s
[
Ïy”_i
];

145 if(
ty³
 == 'b'){

146 
	`cİy_ıu_TA
(
Ëngth
, 
l
.
bŸ£s
, 1, 
weights_’üy±ed
, 1);

148 if(
ty³
 == 'w'){

149 
	`cİy_ıu_TA
(
Ëngth
, 
l
.
weights
, 1, 
weights_’üy±ed
, 1);

151 if(
ty³
 == 's'){

152 
	`cİy_ıu_TA
(
Ëngth
, 
l
.
sÿËs
, 1, 
weights_’üy±ed
, 1);

154 if(
ty³
 == 'm'){

155 
	`cİy_ıu_TA
(
Ëngth
, 
l
.
rŞlšg_m—n
, 1, 
weights_’üy±ed
, 1);

157 if(
ty³
 == 'v'){

158 
	`cİy_ıu_TA
(
Ëngth
, 
l
.
rŞlšg_v¬Ÿnû
, 1, 
weights_’üy±ed
, 1);

162 
	`«s_cbc_TA
((*)"’üy±", 
weights_’üy±ed
, 
Ëngth
, 1);

163 
	}
}

	@ta/softmax_layer_TA.c

1 
	~"soámax_Ïy”_TA.h
"

2 
	~"bÏs_TA.h
"

3 
	~"m©h_TA.h
"

4 
	~"uts_TA.h
"

7 
	~<¡dlib.h
>

8 
	~<¡dio.h
>

9 
	~<as£¹.h
>

11 
	~<‹e_š‹º®_­i.h
>

12 
	~<‹e_š‹º®_­i_ex‹nsiÚs.h
>

15 
soámax_Ïy”_TA
 
	$make_soámax_Ïy”_TA_Ãw
(
b©ch
, 
šputs
, 
groups
, 
‹m³¿tu»
, 
w
, 
h
, 
c
, 
¥©Ÿl
, 
nŞoss
)

17 
	`as£¹
(
šputs
%
groups
 == 0);

20 
Ïy”_TA
 
l
;

21 
	`mem£t
((*)&
l
, 0, (
Ïy”_TA
));

23 
l
.
ty³
 = 
SOFTMAX_TA
;

24 
l
.
b©ch
 = batch;

25 
l
.
groups
 = groups;

28 
l
.
šputs
 = inputs;

29 
l
.
ouuts
 = 
šputs
;

30 
l
.
loss
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

31 
l
.
ouut
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

32 
l
.
d–
 = 
	`ÿÎoc
(
šputs
*
b©ch
, ());

33 
l
.
co¡
 = 
	`ÿÎoc
(1, ());

35 
l
.
‹m³¿tu»
 =emperature;

36 
l
.
w
 = w;

37 
l
.
h
 = h;

38 
l
.
c
 = c;

39 
l
.
¥©Ÿl
 = spatial;

40 
l
.
nŞoss
 =‚oloss;

42 
l
.
fÜw¬d_TA
 = 
NULL
;

43 
l
.
backw¬d_TA
 = 
NULL
;

45  
l
;

46 
	}
}

49 
	$fÜw¬d_soámax_Ïy”_TA
(*
šput
)

62 
	`soámax_ıu_TA
(
šput
, 
soámax_Éa
.
šputs
/soámax_Éa.
groups
, soámax_Éa.
b©ch
, soámax_Éa.šputs, soámax_Éa.groups, soámax_Éa.šputs/soámax_Éa.groups, 1, soámax_Éa.
‹m³¿tu»
, soámax_Éa.
ouut
);

71 
	}
}

74 
	$backw¬d_soámax_Ïy”_TA
(cÚ¡ 
soámax_Ïy”_TA
 
l
, 
ÃtwÜk_TA
 
Ãt
)

76 
	`axpy_ıu_TA
(
l
.
šputs
*l.
b©ch
, 1,†.
d–
, 1, 
Ãt
.delta, 1);

77 
	}
}

	@ta/utils_TA.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<¡ršg.h
>

5 
	~"uts_TA.h
"

6 
	~"m©h_TA.h
"

8 
	$sum_¬¿y_TA
(*
a
, 
n
)

10 
i
;

11 
sum
 = 0;

12 
i
 = 0; i < 
n
; ++iè
sum
 +ğ
a
[i];

14  
sum
;

15 
	}
}

17 
	$¿nd_unifÜm_TA
(
mš
, 
max
)

19 if(
max
 < 
mš
){

20 
sw­
 = 
mš
;

21 
mš
 = 
max
;

22 
max
 = 
sw­
;

24  (()
	`_¿nd
(è* (
max
 - 
mš
)) + min;

25 
	}
}

28 
	$¿nd_nÜm®_TA
(
mu
, 
sigma
){

29 
U1
, 
U2
, 
W
, 
muÉ
;

30 
X1
, 
X2
;

31 
ÿÎ
 = 0;

33 ià(
ÿÎ
 == 1)

35 
ÿÎ
 = !call;

36  (
mu
 + 
sigma
 * (è
X2
);

41 
U1
 = -1 + (è
	`_¿nd
 () * 2;

42 
U2
 = -1 + (è
	`_¿nd
 () * 2;

43 
W
 = 
	`_pow
 (
U1
, 2è+a_pow (
U2
, 2);

45 
W
 >= 1 || W == 0);

47 
muÉ
 = 
	`_sq¹
 ((-2 * 
	`_Ê
 (
W
)) / W);

48 
X1
 = 
U1
 * 
muÉ
;

49 
X2
 = 
U2
 * 
muÉ
;

51 
ÿÎ
 = !call;

53  (
mu
 + 
sigma
 * (è
X1
);

54 
	}
}

	@/usr/include/arpa/inet.h

18 #iâdeà
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<Ãtš‘/š.h
>

25 #iâdeà
__sockËn_t_defšed


26 
__sockËn_t
 
	tsockËn_t
;

27 
	#__sockËn_t_defšed


	)

30 
__BEGIN_DECLS


34 
š_addr_t
 
	$š‘_addr
 (cÚ¡ *
__ı
è
__THROW
;

37 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

41 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

42 
__THROW
;

45 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

49 
š_addr_t
 
	$š‘_ÃtwÜk
 (cÚ¡ *
__ı
è
__THROW
;

53 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

58 
	$š‘_±Ú
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

59 *
__»¡riù
 
__buf
è
__THROW
;

64 cÚ¡ *
	$š‘_Áİ
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

65 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

66 
__THROW
;

70 #ifdeà
__USE_MISC


73 
	$š‘_©Ú
 (cÚ¡ *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

77 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

82 *
	$š‘_Ãt_Áİ
 (
__af
, cÚ¡ *
__ı
, 
__b™s
,

83 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

88 
	$š‘_Ãt_±Ú
 (
__af
, cÚ¡ *
__ı
,

89 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

94 
	$š‘_n§p_addr
 (cÚ¡ *
__ı
,

95 *
__buf
, 
__Ën
è
__THROW
;

99 *
	$š‘_n§p_Áß
 (
__Ën
, cÚ¡ *
__ı
,

100 *
__buf
è
__THROW
;

103 
__END_DECLS


	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #iâdeà
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£¹_ç
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
,

70 
__lše
, cÚ¡ *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, cÚ¡ *
__fe
,

75 
__lše
, cÚ¡ *
__funùiÚ
)

76 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

81 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

82 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

85 
__END_DECLS


91 #ià
defšed
 
__ılu¥lus


92 
	#as£¹
(
ex´
) \

93 (
¡©ic_ÿ¡
 <
boŞ
> (
ex´
) \

95 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

96 #–ià!
defšed
 
__GNUC__
 || defšed 
__STRICT_ANSI__


97 
	#as£¹
(
ex´
) \

98 ((
ex´
) \

99 ? 
	`__ASSERT_VOID_CAST
 (0) \

100 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

107 
	#as£¹
(
ex´
) \

108 ((è ((
ex´
è? 1 : 0), 
	`__ex‹nsiÚ__
 ({ \

109 ià(
ex´
) \

112 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
); \

113 
	}
}))

	)

116 #ifdef 
__USE_GNU


117 
	#as£¹_³¼Ü
(
”ºum
) \

118 (!(
”ºum
) \

119 ? 
	`__ASSERT_VOID_CAST
 (0) \

120 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

128 #ià
defšed
 
__ılu¥lus
 ? 
__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

129 
	#__ASSERT_FUNCTION
 
__ex‹nsiÚ__
 
__PRETTY_FUNCTION__


	)

131 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

132 
	#__ASSERT_FUNCTION
 
__func__


	)

134 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

141 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ılu¥lus


142 #undeà
¡©ic_as£¹


143 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

108 
__exùy³
 (
i§Êum
);

109 
__exùy³
 (
i§Íha
);

110 
__exùy³
 (
isúŒl
);

111 
__exùy³
 (
isdig™
);

112 
__exùy³
 (
i¦ow”
);

113 
__exùy³
 (
isg¿ph
);

114 
__exùy³
 (
i¥ršt
);

115 
__exùy³
 (
i¥unù
);

116 
__exùy³
 (
is¥aû
);

117 
__exùy³
 (
isuµ”
);

118 
__exùy³
 (
isxdig™
);

122 
	$tŞow”
 (
__c
è
__THROW
;

125 
	$touµ”
 (
__c
è
__THROW
;

129 #ifdef 
__USE_ISOC99


130 
	`__exùy³
 (
isbÏnk
);

133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE


173 #ifdeà
__isùy³_f


174 
	$__isùy³_f
 (
®num
)

175 
	$__isùy³_f
 (
®pha
)

176 
	$__isùy³_f
 (
úŒl
)

177 
	$__isùy³_f
 (
dig™
)

178 
	$__isùy³_f
 (
low”
)

179 
	$__isùy³_f
 (
g¿ph
)

180 
	$__isùy³_f
 (
´št
)

181 
	$__isùy³_f
 (
punù
)

182 
	$__isùy³_f
 (
¥aû
)

183 
	$__isùy³_f
 (
uµ”
)

184 
	$__isùy³_f
 (
xdig™
)

185 #ifdeà
__USE_ISOC99


186 
	$__isùy³_f
 (
bÏnk
)

188 #–ià
defšed
 
__isùy³


189 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

190 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

191 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

192 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

193 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

194 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

195 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

196 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

197 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

198 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

199 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

200 #ifdeà
__USE_ISOC99


201 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

205 #ifdeà
__USE_EXTERN_INLINES


206 
__ex‹º_šlše
 

207 
	`__NTH
 (
	$tŞow”
 (
__c
))

209  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

210 
	}
}

212 
__ex‹º_šlše
 

213 
__NTH
 (
	$touµ”
 (
__c
))

215  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

216 
	}
}

219 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


220 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

221 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

224 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


225 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

226 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

228 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

229 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

235 #ifdeà
__USE_XOPEN2K8


237 
	~<b™s/ty³s/loÿË_t.h
>

241 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

242 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

244 
	#__exùy³_l
(
Çme
) \

245 
	`Çme
 (, 
loÿË_t
è
__THROW


	)

251 
__exùy³_l
 (
i§Êum_l
);

252 
__exùy³_l
 (
i§Íha_l
);

253 
__exùy³_l
 (
isúŒl_l
);

254 
__exùy³_l
 (
isdig™_l
);

255 
__exùy³_l
 (
i¦ow”_l
);

256 
__exùy³_l
 (
isg¿ph_l
);

257 
__exùy³_l
 (
i¥ršt_l
);

258 
__exùy³_l
 (
i¥unù_l
);

259 
__exùy³_l
 (
is¥aû_l
);

260 
__exùy³_l
 (
isuµ”_l
);

261 
__exùy³_l
 (
isxdig™_l
);

263 
__exùy³_l
 (
isbÏnk_l
);

267 
	$__tŞow”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

268 
	$tŞow”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

271 
	$__touµ”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

272 
	$touµ”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

274 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


275 
	#__tŞow”_l
(
c
, 
loÿË
) \

276 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

277 
	#__touµ”_l
(
c
, 
loÿË
) \

278 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

279 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

280 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

284 #iâdeà
__NO_CTYPE


285 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

286 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

287 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

288 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

289 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

290 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

291 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

292 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

293 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

294 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

295 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

297 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

299 #ifdeà
__USE_MISC


300 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

301 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

304 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

305 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

306 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

307 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

308 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

309 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

310 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

311 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

312 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

313 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

314 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

316 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

318 #ifdeà
__USE_MISC


319 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

320 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

327 
__END_DECLS


	@/usr/include/cublas_v2.h

55 #ià!
defšed
(
CUBLAS_V2_H_
)

56 
	#CUBLAS_V2_H_


	)

58 #undeà
CUBLASAPI


59 #ifdeà
__CUDACC__


60 
	#CUBLASAPI
 
__ho¡__
 
__deviû__


	)

62 
	#CUBLASAPI


	)

65 
	~"cubÏs_­i.h
"

67 
	#cubÏsC»©e
 
cubÏsC»©e_v2


	)

68 
	#cubÏsDe¡roy
 
cubÏsDe¡roy_v2


	)

69 
	#cubÏsG‘V”siÚ
 
cubÏsG‘V”siÚ_v2


	)

70 
	#cubÏsS‘SŒ—m
 
cubÏsS‘SŒ—m_v2


	)

71 
	#cubÏsG‘SŒ—m
 
cubÏsG‘SŒ—m_v2


	)

72 
	#cubÏsG‘Poš‹rMode
 
cubÏsG‘Poš‹rMode_v2


	)

73 
	#cubÏsS‘Poš‹rMode
 
cubÏsS‘Poš‹rMode_v2


	)

77 
	#cubÏsSÄm2
 
cubÏsSÄm2_v2


	)

78 
	#cubÏsDÄm2
 
cubÏsDÄm2_v2


	)

79 
	#cubÏsSúrm2
 
cubÏsSúrm2_v2


	)

80 
	#cubÏsDzÄm2
 
cubÏsDzÄm2_v2


	)

82 
	#cubÏsSdÙ
 
cubÏsSdÙ_v2


	)

83 
	#cubÏsDdÙ
 
cubÏsDdÙ_v2


	)

84 
	#cubÏsCdÙu
 
cubÏsCdÙu_v2


	)

85 
	#cubÏsCdÙc
 
cubÏsCdÙc_v2


	)

86 
	#cubÏsZdÙu
 
cubÏsZdÙu_v2


	)

87 
	#cubÏsZdÙc
 
cubÏsZdÙc_v2


	)

89 
	#cubÏsSsÿl
 
cubÏsSsÿl_v2


	)

90 
	#cubÏsDsÿl
 
cubÏsDsÿl_v2


	)

91 
	#cubÏsCsÿl
 
cubÏsCsÿl_v2


	)

92 
	#cubÏsCssÿl
 
cubÏsCssÿl_v2


	)

93 
	#cubÏsZsÿl
 
cubÏsZsÿl_v2


	)

94 
	#cubÏsZdsÿl
 
cubÏsZdsÿl_v2


	)

96 
	#cubÏsSaxpy
 
cubÏsSaxpy_v2


	)

97 
	#cubÏsDaxpy
 
cubÏsDaxpy_v2


	)

98 
	#cubÏsCaxpy
 
cubÏsCaxpy_v2


	)

99 
	#cubÏsZaxpy
 
cubÏsZaxpy_v2


	)

101 
	#cubÏsScİy
 
cubÏsScİy_v2


	)

102 
	#cubÏsDcİy
 
cubÏsDcİy_v2


	)

103 
	#cubÏsCcİy
 
cubÏsCcİy_v2


	)

104 
	#cubÏsZcİy
 
cubÏsZcİy_v2


	)

106 
	#cubÏsSsw­
 
cubÏsSsw­_v2


	)

107 
	#cubÏsDsw­
 
cubÏsDsw­_v2


	)

108 
	#cubÏsCsw­
 
cubÏsCsw­_v2


	)

109 
	#cubÏsZsw­
 
cubÏsZsw­_v2


	)

111 
	#cubÏsI§max
 
cubÏsI§max_v2


	)

112 
	#cubÏsIdamax
 
cubÏsIdamax_v2


	)

113 
	#cubÏsIÿmax
 
cubÏsIÿmax_v2


	)

114 
	#cubÏsIzamax
 
cubÏsIzamax_v2


	)

116 
	#cubÏsI§mš
 
cubÏsI§mš_v2


	)

117 
	#cubÏsIdamš
 
cubÏsIdamš_v2


	)

118 
	#cubÏsIÿmš
 
cubÏsIÿmš_v2


	)

119 
	#cubÏsIzamš
 
cubÏsIzamš_v2


	)

121 
	#cubÏsSasum
 
cubÏsSasum_v2


	)

122 
	#cubÏsDasum
 
cubÏsDasum_v2


	)

123 
	#cubÏsSÿsum
 
cubÏsSÿsum_v2


	)

124 
	#cubÏsDzasum
 
cubÏsDzasum_v2


	)

126 
	#cubÏsSrÙ
 
cubÏsSrÙ_v2


	)

127 
	#cubÏsDrÙ
 
cubÏsDrÙ_v2


	)

128 
	#cubÏsCrÙ
 
cubÏsCrÙ_v2


	)

129 
	#cubÏsC¤Ù
 
cubÏsC¤Ù_v2


	)

130 
	#cubÏsZrÙ
 
cubÏsZrÙ_v2


	)

131 
	#cubÏsZdrÙ
 
cubÏsZdrÙ_v2


	)

133 
	#cubÏsSrÙg
 
cubÏsSrÙg_v2


	)

134 
	#cubÏsDrÙg
 
cubÏsDrÙg_v2


	)

135 
	#cubÏsCrÙg
 
cubÏsCrÙg_v2


	)

136 
	#cubÏsZrÙg
 
cubÏsZrÙg_v2


	)

138 
	#cubÏsSrÙm
 
cubÏsSrÙm_v2


	)

139 
	#cubÏsDrÙm
 
cubÏsDrÙm_v2


	)

141 
	#cubÏsSrÙmg
 
cubÏsSrÙmg_v2


	)

142 
	#cubÏsDrÙmg
 
cubÏsDrÙmg_v2


	)

147 
	#cubÏsSgemv
 
cubÏsSgemv_v2


	)

148 
	#cubÏsDgemv
 
cubÏsDgemv_v2


	)

149 
	#cubÏsCgemv
 
cubÏsCgemv_v2


	)

150 
	#cubÏsZgemv
 
cubÏsZgemv_v2


	)

152 
	#cubÏsSgbmv
 
cubÏsSgbmv_v2


	)

153 
	#cubÏsDgbmv
 
cubÏsDgbmv_v2


	)

154 
	#cubÏsCgbmv
 
cubÏsCgbmv_v2


	)

155 
	#cubÏsZgbmv
 
cubÏsZgbmv_v2


	)

157 
	#cubÏsSŒmv
 
cubÏsSŒmv_v2


	)

158 
	#cubÏsDŒmv
 
cubÏsDŒmv_v2


	)

159 
	#cubÏsCŒmv
 
cubÏsCŒmv_v2


	)

160 
	#cubÏsZŒmv
 
cubÏsZŒmv_v2


	)

162 
	#cubÏsStbmv
 
cubÏsStbmv_v2


	)

163 
	#cubÏsDtbmv
 
cubÏsDtbmv_v2


	)

164 
	#cubÏsCtbmv
 
cubÏsCtbmv_v2


	)

165 
	#cubÏsZtbmv
 
cubÏsZtbmv_v2


	)

167 
	#cubÏsSmv
 
cubÏsSmv_v2


	)

168 
	#cubÏsDmv
 
cubÏsDmv_v2


	)

169 
	#cubÏsCmv
 
cubÏsCmv_v2


	)

170 
	#cubÏsZmv
 
cubÏsZmv_v2


	)

172 
	#cubÏsSŒsv
 
cubÏsSŒsv_v2


	)

173 
	#cubÏsDŒsv
 
cubÏsDŒsv_v2


	)

174 
	#cubÏsCŒsv
 
cubÏsCŒsv_v2


	)

175 
	#cubÏsZŒsv
 
cubÏsZŒsv_v2


	)

177 
	#cubÏsSsv
 
cubÏsSsv_v2


	)

178 
	#cubÏsDsv
 
cubÏsDsv_v2


	)

179 
	#cubÏsCsv
 
cubÏsCsv_v2


	)

180 
	#cubÏsZsv
 
cubÏsZsv_v2


	)

182 
	#cubÏsStbsv
 
cubÏsStbsv_v2


	)

183 
	#cubÏsDtbsv
 
cubÏsDtbsv_v2


	)

184 
	#cubÏsCtbsv
 
cubÏsCtbsv_v2


	)

185 
	#cubÏsZtbsv
 
cubÏsZtbsv_v2


	)

187 
	#cubÏsSsymv
 
cubÏsSsymv_v2


	)

188 
	#cubÏsDsymv
 
cubÏsDsymv_v2


	)

189 
	#cubÏsCsymv
 
cubÏsCsymv_v2


	)

190 
	#cubÏsZsymv
 
cubÏsZsymv_v2


	)

191 
	#cubÏsChemv
 
cubÏsChemv_v2


	)

192 
	#cubÏsZhemv
 
cubÏsZhemv_v2


	)

194 
	#cubÏsSsbmv
 
cubÏsSsbmv_v2


	)

195 
	#cubÏsDsbmv
 
cubÏsDsbmv_v2


	)

196 
	#cubÏsChbmv
 
cubÏsChbmv_v2


	)

197 
	#cubÏsZhbmv
 
cubÏsZhbmv_v2


	)

199 
	#cubÏsS¥mv
 
cubÏsS¥mv_v2


	)

200 
	#cubÏsD¥mv
 
cubÏsD¥mv_v2


	)

201 
	#cubÏsChpmv
 
cubÏsChpmv_v2


	)

202 
	#cubÏsZhpmv
 
cubÏsZhpmv_v2


	)

205 
	#cubÏsSg”
 
cubÏsSg”_v2


	)

206 
	#cubÏsDg”
 
cubÏsDg”_v2


	)

207 
	#cubÏsCg”u
 
cubÏsCg”u_v2


	)

208 
	#cubÏsCg”c
 
cubÏsCg”c_v2


	)

209 
	#cubÏsZg”u
 
cubÏsZg”u_v2


	)

210 
	#cubÏsZg”c
 
cubÏsZg”c_v2


	)

212 
	#cubÏsSsyr
 
cubÏsSsyr_v2


	)

213 
	#cubÏsDsyr
 
cubÏsDsyr_v2


	)

214 
	#cubÏsCsyr
 
cubÏsCsyr_v2


	)

215 
	#cubÏsZsyr
 
cubÏsZsyr_v2


	)

216 
	#cubÏsCh”
 
cubÏsCh”_v2


	)

217 
	#cubÏsZh”
 
cubÏsZh”_v2


	)

219 
	#cubÏsS¥r
 
cubÏsS¥r_v2


	)

220 
	#cubÏsD¥r
 
cubÏsD¥r_v2


	)

221 
	#cubÏsCh´
 
cubÏsCh´_v2


	)

222 
	#cubÏsZh´
 
cubÏsZh´_v2


	)

224 
	#cubÏsSsyr2
 
cubÏsSsyr2_v2


	)

225 
	#cubÏsDsyr2
 
cubÏsDsyr2_v2


	)

226 
	#cubÏsCsyr2
 
cubÏsCsyr2_v2


	)

227 
	#cubÏsZsyr2
 
cubÏsZsyr2_v2


	)

228 
	#cubÏsCh”2
 
cubÏsCh”2_v2


	)

229 
	#cubÏsZh”2
 
cubÏsZh”2_v2


	)

231 
	#cubÏsS¥r2
 
cubÏsS¥r2_v2


	)

232 
	#cubÏsD¥r2
 
cubÏsD¥r2_v2


	)

233 
	#cubÏsCh´2
 
cubÏsCh´2_v2


	)

234 
	#cubÏsZh´2
 
cubÏsZh´2_v2


	)

238 
	#cubÏsSgemm
 
cubÏsSgemm_v2


	)

239 
	#cubÏsDgemm
 
cubÏsDgemm_v2


	)

240 
	#cubÏsCgemm
 
cubÏsCgemm_v2


	)

241 
	#cubÏsZgemm
 
cubÏsZgemm_v2


	)

243 
	#cubÏsSsyrk
 
cubÏsSsyrk_v2


	)

244 
	#cubÏsDsyrk
 
cubÏsDsyrk_v2


	)

245 
	#cubÏsCsyrk
 
cubÏsCsyrk_v2


	)

246 
	#cubÏsZsyrk
 
cubÏsZsyrk_v2


	)

247 
	#cubÏsCh”k
 
cubÏsCh”k_v2


	)

248 
	#cubÏsZh”k
 
cubÏsZh”k_v2


	)

250 
	#cubÏsSsyr2k
 
cubÏsSsyr2k_v2


	)

251 
	#cubÏsDsyr2k
 
cubÏsDsyr2k_v2


	)

252 
	#cubÏsCsyr2k
 
cubÏsCsyr2k_v2


	)

253 
	#cubÏsZsyr2k
 
cubÏsZsyr2k_v2


	)

254 
	#cubÏsCh”2k
 
cubÏsCh”2k_v2


	)

255 
	#cubÏsZh”2k
 
cubÏsZh”2k_v2


	)

257 
	#cubÏsSsymm
 
cubÏsSsymm_v2


	)

258 
	#cubÏsDsymm
 
cubÏsDsymm_v2


	)

259 
	#cubÏsCsymm
 
cubÏsCsymm_v2


	)

260 
	#cubÏsZsymm
 
cubÏsZsymm_v2


	)

261 
	#cubÏsChemm
 
cubÏsChemm_v2


	)

262 
	#cubÏsZhemm
 
cubÏsZhemm_v2


	)

264 
	#cubÏsSŒsm
 
cubÏsSŒsm_v2


	)

265 
	#cubÏsDŒsm
 
cubÏsDŒsm_v2


	)

266 
	#cubÏsCŒsm
 
cubÏsCŒsm_v2


	)

267 
	#cubÏsZŒsm
 
cubÏsZŒsm_v2


	)

269 
	#cubÏsSŒmm
 
cubÏsSŒmm_v2


	)

270 
	#cubÏsDŒmm
 
cubÏsDŒmm_v2


	)

271 
	#cubÏsCŒmm
 
cubÏsCŒmm_v2


	)

272 
	#cubÏsZŒmm
 
cubÏsZŒmm_v2


	)

	@/usr/include/err.h

19 #iâdef 
_ERR_H


20 
	#_ERR_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	#__Ãed___va_li¡


	)

25 
	~<¡d¬g.h
>

26 #iâdef 
__GNUC_VA_LIST


27 
	#__gnuc_va_li¡
 *

	)

30 
__BEGIN_DECLS


34 
	$w¬n
 (cÚ¡ *
__fÜm©
, ...)

35 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 1, 2)));

36 
	$vw¬n
 (cÚ¡ *
__fÜm©
, 
__gnuc_va_li¡
)

37 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 1, 0)));

40 
	$w¬nx
 (cÚ¡ *
__fÜm©
, ...)

41 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 1, 2)));

42 
	$vw¬nx
 (cÚ¡ *
__fÜm©
, 
__gnuc_va_li¡
)

43 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 1, 0)));

46 
	$”r
 (
__¡©us
, cÚ¡ *
__fÜm©
, ...)

47 
	`__©Œibu‹__
 ((
__nÜ‘uº__
, 
	`__fÜm©__
 (
__´štf__
, 2, 3)));

48 
	$v”r
 (
__¡©us
, cÚ¡ *
__fÜm©
, 
__gnuc_va_li¡
)

49 
	`__©Œibu‹__
 ((
__nÜ‘uº__
, 
	`__fÜm©__
 (
__´štf__
, 2, 0)));

50 
	$”rx
 (
__¡©us
, cÚ¡ *
__fÜm©
, ...)

51 
	`__©Œibu‹__
 ((
__nÜ‘uº__
, 
	`__fÜm©__
 (
__´štf__
, 2, 3)));

52 
	$v”rx
 (
__¡©us
, cÚ¡ *, 
__gnuc_va_li¡
)

53 
	`__©Œibu‹__
 ((
__nÜ‘uº__
, 
	`__fÜm©__
 (
__´štf__
, 2, 0)));

55 
__END_DECLS


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

32 
	#MB_LEN_MAX
 16

	)

37 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

42 #iâdeà
_LIMITS_H


43 
	#_LIMITS_H
 1

	)

45 
	~<b™s/wÜdsize.h
>

54 
	#CHAR_BIT
 8

	)

57 
	#SCHAR_MIN
 (-128)

	)

58 
	#SCHAR_MAX
 127

	)

61 
	#UCHAR_MAX
 255

	)

64 #ifdeà
__CHAR_UNSIGNED__


65 
	#CHAR_MIN
 0

	)

66 
	#CHAR_MAX
 
UCHAR_MAX


	)

68 
	#CHAR_MIN
 
SCHAR_MIN


	)

69 
	#CHAR_MAX
 
SCHAR_MAX


	)

73 
	#SHRT_MIN
 (-32768)

	)

74 
	#SHRT_MAX
 32767

	)

77 
	#USHRT_MAX
 65535

	)

80 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

81 
	#INT_MAX
 2147483647

	)

84 
	#UINT_MAX
 4294967295U

	)

87 #ià
__WORDSIZE
 == 64

88 
	#LONG_MAX
 9223372036854775807L

	)

90 
	#LONG_MAX
 2147483647L

	)

92 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

95 #ià
__WORDSIZE
 == 64

96 
	#ULONG_MAX
 18446744073709551615UL

	)

98 
	#ULONG_MAX
 4294967295UL

	)

101 #ifdeà
__USE_ISOC99


104 
	#LLONG_MAX
 9223372036854775807LL

	)

105 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

108 
	#ULLONG_MAX
 18446744073709551615ULL

	)

122 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


124 #šşude_Ãxˆ<
lim™s
.
h
>

130 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


131 #iâdeà
LLONG_MIN


132 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

134 #iâdeà
LLONG_MAX


135 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

137 #iâdeà
ULLONG_MAX


138 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

145 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

146 #iâdeà
CHAR_WIDTH


147 
	#CHAR_WIDTH
 8

	)

149 #iâdeà
SCHAR_WIDTH


150 
	#SCHAR_WIDTH
 8

	)

152 #iâdeà
UCHAR_WIDTH


153 
	#UCHAR_WIDTH
 8

	)

155 #iâdeà
SHRT_WIDTH


156 
	#SHRT_WIDTH
 16

	)

158 #iâdeà
USHRT_WIDTH


159 
	#USHRT_WIDTH
 16

	)

161 #iâdeà
INT_WIDTH


162 
	#INT_WIDTH
 32

	)

164 #iâdeà
UINT_WIDTH


165 
	#UINT_WIDTH
 32

	)

167 #iâdeà
LONG_WIDTH


168 
	#LONG_WIDTH
 
__WORDSIZE


	)

170 #iâdeà
ULONG_WIDTH


171 
	#ULONG_WIDTH
 
__WORDSIZE


	)

173 #iâdeà
LLONG_WIDTH


174 
	#LLONG_WIDTH
 64

	)

176 #iâdeà
ULLONG_WIDTH


177 
	#ULLONG_WIDTH
 64

	)

181 #ifdef 
__USE_POSIX


183 
	~<b™s/posix1_lim.h
>

186 #ifdef 
__USE_POSIX2


187 
	~<b™s/posix2_lim.h
>

190 #ifdef 
__USE_XOPEN


191 
	~<b™s/xİ’_lim.h
>

	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<b™s/libc-h—d”-¡¬t.h
>

29 #ià
defšed
 
log
 && defšed 
__GNUC__


30 #w¬nšg 
A
 
maüo
 
ÿÎed
 
log
 
was
 
®»ady
 
defšed
 
wh’
 <
m©h
.
h
> wa 
šşuded
.

31 #w¬nšg 
This
 
wl
 
ÿu£
 
comp©iÚ
 
´obËms
.

34 
	g__BEGIN_DECLS


37 
	~<b™s/ty³s.h
>

40 
	~<b™s/m©h-veùÜ.h
>

43 
	~<b™s/æßŠ.h
>

47 #ià
__GNUC_PREREQ
 (3, 3)

48 
	#HUGE_VAL
 (
	`__butš_huge_v®
 ())

	)

55 
	#HUGE_VAL
 1e10000

	)

57 #ifdeà
__USE_ISOC99


58 #ià
__GNUC_PREREQ
 (3, 3)

59 
	#HUGE_VALF
 (
	`__butš_huge_v®f
 ())

	)

60 
	#HUGE_VALL
 (
	`__butš_huge_v®l
 ())

	)

62 
	#HUGE_VALF
 1e10000f

	)

63 
	#HUGE_VALL
 1e10000L

	)

66 #ià
__HAVE_FLOAT16
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

67 
	#HUGE_VAL_F16
 (
	`__butš_huge_v®f16
 ())

	)

69 #ià
__HAVE_FLOAT32
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

70 
	#HUGE_VAL_F32
 (
	`__butš_huge_v®f32
 ())

	)

72 #ià
__HAVE_FLOAT64
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

73 
	#HUGE_VAL_F64
 (
	`__butš_huge_v®f64
 ())

	)

75 #ià
__HAVE_FLOAT128
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

76 
	#HUGE_VAL_F128
 (
	`__butš_huge_v®f128
 ())

	)

78 #ià
__HAVE_FLOAT32X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

79 
	#HUGE_VAL_F32X
 (
	`__butš_huge_v®f32x
 ())

	)

81 #ià
__HAVE_FLOAT64X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

82 
	#HUGE_VAL_F64X
 (
	`__butš_huge_v®f64x
 ())

	)

84 #ià
__HAVE_FLOAT128X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

85 
	#HUGE_VAL_F128X
 (
	`__butš_huge_v®f128x
 ())

	)

88 #ifdeà
__USE_ISOC99


90 #ià
__GNUC_PREREQ
 (3, 3)

91 
	#INFINITY
 (
	`__butš_šff
 ())

	)

93 
	#INFINITY
 
HUGE_VALF


	)

97 #ià
__GNUC_PREREQ
 (3, 3)

98 
	#NAN
 (
	`__butš_Çnf
 (""))

	)

103 
	#NAN
 (0.0à/ 0.0f)

	)

107 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

109 #ià
__GNUC_PREREQ
 (3, 3)

110 
	#SNANF
 (
	`__butš_Çnsf
 (""))

	)

111 
	#SNAN
 (
	`__butš_Çns
 (""))

	)

112 
	#SNANL
 (
	`__butš_Çn¦
 (""))

	)

115 #ià
__HAVE_FLOAT16
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

116 
	#SNANF16
 (
	`__butš_Çnsf16
 (""))

	)

118 #ià
__HAVE_FLOAT32
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

119 
	#SNANF32
 (
	`__butš_Çnsf32
 (""))

	)

121 #ià
__HAVE_FLOAT64
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

122 
	#SNANF64
 (
	`__butš_Çnsf64
 (""))

	)

124 #ià
__HAVE_FLOAT128
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

125 
	#SNANF128
 (
	`__butš_Çnsf128
 (""))

	)

127 #ià
__HAVE_FLOAT32X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

128 
	#SNANF32X
 (
	`__butš_Çnsf32x
 (""))

	)

130 #ià
__HAVE_FLOAT64X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

131 
	#SNANF64X
 (
	`__butš_Çnsf64x
 (""))

	)

133 #ià
__HAVE_FLOAT128X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

134 
	#SNANF128X
 (
	`__butš_Çnsf128x
 (""))

	)

138 
	~<b™s/æt-ev®-m‘hod.h
>

140 #ifdeà
__USE_ISOC99


148 #ià
__GLIBC_FLT_EVAL_METHOD
 == 0 || __GLIBC_FLT_EVAL_METHOD == 16

149 
	tæßt_t
;

150 
	tdoubË_t
;

151 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 1

152 
	tæßt_t
;

153 
	tdoubË_t
;

154 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 2

155 
	tæßt_t
;

156 
	tdoubË_t
;

157 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 32

158 
_Flßt32
 
	tæßt_t
;

159 
	tdoubË_t
;

160 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 33

161 
_Flßt32x
 
	tæßt_t
;

162 
_Flßt32x
 
	tdoubË_t
;

163 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 64

164 
_Flßt64
 
	tæßt_t
;

165 
_Flßt64
 
	tdoubË_t
;

166 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 65

167 
_Flßt64x
 
	tæßt_t
;

168 
_Flßt64x
 
	tdoubË_t
;

169 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 128

170 
_Flßt128
 
	tæßt_t
;

171 
_Flßt128
 
	tdoubË_t
;

172 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 129

173 
_Flßt128x
 
	tæßt_t
;

174 
_Flßt128x
 
	tdoubË_t
;

190 
	~<b™s/å-logb.h
>

191 #ifdeà
__USE_ISOC99


192 #ià
__FP_LOGB0_IS_MIN


193 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

195 
	#FP_ILOGB0
 (-2147483647)

	)

197 #ià
__FP_LOGBNAN_IS_MIN


198 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

200 
	#FP_ILOGBNAN
 2147483647

	)

203 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

204 #ià
__WORDSIZE
 == 32

205 
	#__FP_LONG_MAX
 0x7fffffffL

	)

207 
	#__FP_LONG_MAX
 0x7fffffffffffffffL

	)

209 #ià
__FP_LOGB0_IS_MIN


210 
	#FP_LLOGB0
 (-
__FP_LONG_MAX
 - 1)

	)

212 
	#FP_LLOGB0
 (-
__FP_LONG_MAX
)

	)

214 #ià
__FP_LOGBNAN_IS_MIN


215 
	#FP_LLOGBNAN
 (-
__FP_LONG_MAX
 - 1)

	)

217 
	#FP_LLOGBNAN
 
__FP_LONG_MAX


	)

233 
	~<b™s/å-ç¡.h
>

235 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

239 
	mFP_INT_UPWARD
 =

240 
	#FP_INT_UPWARD
 0

	)

241 
FP_INT_UPWARD
,

242 
	mFP_INT_DOWNWARD
 =

243 
	#FP_INT_DOWNWARD
 1

	)

244 
FP_INT_DOWNWARD
,

245 
	mFP_INT_TOWARDZERO
 =

246 
	#FP_INT_TOWARDZERO
 2

	)

247 
FP_INT_TOWARDZERO
,

248 
	mFP_INT_TONEARESTFROMZERO
 =

249 
	#FP_INT_TONEARESTFROMZERO
 3

	)

250 
FP_INT_TONEARESTFROMZERO
,

251 
	mFP_INT_TONEAREST
 =

252 
	#FP_INT_TONEAREST
 4

	)

253 
FP_INT_TONEAREST
,

262 
	#__SIMD_DECL
(
funùiÚ
è
	`__CONCAT
 (
__DECL_SIMD_
, funùiÚ)

	)

264 
	#__MATHCALL_VEC
(
funùiÚ
, 
suffix
, 
¬gs
) \

265 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

266 
	`__MATHCALL
 (
funùiÚ
, 
suffix
, 
¬gs
)

	)

268 
	#__MATHDECL_VEC
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

269 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

270 
	`__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
)

	)

272 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

273 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

274 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

275 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

276 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

277 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

278 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

279 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

280 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

281 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

282 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

283 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

285 
	#_MdoubË_
 

	)

286 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

287 
	#__MATH_DECLARING_DOUBLE
 1

	)

288 
	#__MATH_DECLARING_FLOATN
 0

	)

289 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

290 
	~<b™s/m©hÿÎs.h
>

291 #undeà
_MdoubË_


292 #undeà
__MATH_PRECNAME


293 #undeà
__MATH_DECLARING_DOUBLE


294 #undeà
__MATH_DECLARING_FLOATN


296 #ifdeà
__USE_ISOC99


302 
	#_MdoubË_
 

	)

303 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

304 
	#__MATH_DECLARING_DOUBLE
 0

	)

305 
	#__MATH_DECLARING_FLOATN
 0

	)

306 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

307 
	~<b™s/m©hÿÎs.h
>

308 #undeà
_MdoubË_


309 #undeà
__MATH_PRECNAME


310 #undeà
__MATH_DECLARING_DOUBLE


311 #undeà
__MATH_DECLARING_FLOATN


313 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

314 || 
defšed
 
__LDBL_COMPAT
 \

315 || 
defšed
 
_LIBC_TEST


316 #ifdeà
__LDBL_COMPAT


318 #ifdeà
__USE_ISOC99


319 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

320 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

321 #ifdeà
__REDIRECT_NTH


322 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

323 
__Ædbl_Ãx‰ow¬df
)

324 
	`__©Œibu‹__
 ((
__cÚ¡__
));

325 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

326 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

327 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

328 (
__x
, 
__y
),

329 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

333 #undeà
__MATHDECL_1


334 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

335 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

336 
¬gs
, 
®Ÿs
)

	)

337 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

338 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

344 
	#_MdoubË_
 

	)

345 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

346 
	#__MATH_DECLARING_DOUBLE
 0

	)

347 
	#__MATH_DECLARING_FLOATN
 0

	)

348 
	#__MATH_DECLARE_LDOUBLE
 1

	)

349 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

350 
	~<b™s/m©hÿÎs.h
>

351 #undeà
_MdoubË_


352 #undeà
__MATH_PRECNAME


353 #undeà
__MATH_DECLARING_DOUBLE


354 #undeà
__MATH_DECLARING_FLOATN


363 #ià
__HAVE_DISTINCT_FLOAT16
 || (
__HAVE_FLOAT16
 && !
defšed
 
_LIBC
)

364 
	#_MdoubË_
 
_Flßt16


	)

365 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f16
##
	)
r

366 
	#__MATH_DECLARING_DOUBLE
 0

	)

367 
	#__MATH_DECLARING_FLOATN
 1

	)

368 #ià
__HAVE_DISTINCT_FLOAT16


369 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

371 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

372 
	~<b™s/m©hÿÎs.h
>

374 #undeà
_MdoubË_


375 #undeà
__MATH_PRECNAME


376 #undeà
__MATH_DECLARING_DOUBLE


377 #undeà
__MATH_DECLARING_FLOATN


380 #ià
__HAVE_DISTINCT_FLOAT32
 || (
__HAVE_FLOAT32
 && !
defšed
 
_LIBC
)

381 
	#_MdoubË_
 
_Flßt32


	)

382 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f32
##
	)
r

383 
	#__MATH_DECLARING_DOUBLE
 0

	)

384 
	#__MATH_DECLARING_FLOATN
 1

	)

385 #ià
__HAVE_DISTINCT_FLOAT32


386 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

388 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

389 
	~<b™s/m©hÿÎs.h
>

391 #undeà
_MdoubË_


392 #undeà
__MATH_PRECNAME


393 #undeà
__MATH_DECLARING_DOUBLE


394 #undeà
__MATH_DECLARING_FLOATN


397 #ià
__HAVE_DISTINCT_FLOAT64
 || (
__HAVE_FLOAT64
 && !
defšed
 
_LIBC
)

398 
	#_MdoubË_
 
_Flßt64


	)

399 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f64
##
	)
r

400 
	#__MATH_DECLARING_DOUBLE
 0

	)

401 
	#__MATH_DECLARING_FLOATN
 1

	)

402 #ià
__HAVE_DISTINCT_FLOAT64


403 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

405 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

406 
	~<b™s/m©hÿÎs.h
>

408 #undeà
_MdoubË_


409 #undeà
__MATH_PRECNAME


410 #undeà
__MATH_DECLARING_DOUBLE


411 #undeà
__MATH_DECLARING_FLOATN


414 #ià
__HAVE_DISTINCT_FLOAT128
 || (
__HAVE_FLOAT128
 && !
defšed
 
_LIBC
)

415 
	#_MdoubË_
 
_Flßt128


	)

416 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f128
##
	)
r

417 
	#__MATH_DECLARING_DOUBLE
 0

	)

418 
	#__MATH_DECLARING_FLOATN
 1

	)

419 #ià
__HAVE_DISTINCT_FLOAT128


420 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

422 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

423 
	~<b™s/m©hÿÎs.h
>

425 #undeà
_MdoubË_


426 #undeà
__MATH_PRECNAME


427 #undeà
__MATH_DECLARING_DOUBLE


428 #undeà
__MATH_DECLARING_FLOATN


431 #ià
__HAVE_DISTINCT_FLOAT32X
 || (
__HAVE_FLOAT32X
 && !
defšed
 
_LIBC
)

432 
	#_MdoubË_
 
_Flßt32x


	)

433 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f32x
##
	)
r

434 
	#__MATH_DECLARING_DOUBLE
 0

	)

435 
	#__MATH_DECLARING_FLOATN
 1

	)

436 #ià
__HAVE_DISTINCT_FLOAT32X


437 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

439 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

440 
	~<b™s/m©hÿÎs.h
>

442 #undeà
_MdoubË_


443 #undeà
__MATH_PRECNAME


444 #undeà
__MATH_DECLARING_DOUBLE


445 #undeà
__MATH_DECLARING_FLOATN


448 #ià
__HAVE_DISTINCT_FLOAT64X
 || (
__HAVE_FLOAT64X
 && !
defšed
 
_LIBC
)

449 
	#_MdoubË_
 
_Flßt64x


	)

450 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f64x
##
	)
r

451 
	#__MATH_DECLARING_DOUBLE
 0

	)

452 
	#__MATH_DECLARING_FLOATN
 1

	)

453 #ià
__HAVE_DISTINCT_FLOAT64X


454 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

456 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

457 
	~<b™s/m©hÿÎs.h
>

459 #undeà
_MdoubË_


460 #undeà
__MATH_PRECNAME


461 #undeà
__MATH_DECLARING_DOUBLE


462 #undeà
__MATH_DECLARING_FLOATN


465 #ià
__HAVE_DISTINCT_FLOAT128X
 || (
__HAVE_FLOAT128X
 && !
defšed
 
_LIBC
)

466 
	#_MdoubË_
 
_Flßt128x


	)

467 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f128x
##
	)
r

468 
	#__MATH_DECLARING_DOUBLE
 0

	)

469 
	#__MATH_DECLARING_FLOATN
 1

	)

470 #ià
__HAVE_DISTINCT_FLOAT128X


471 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

473 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

474 
	~<b™s/m©hÿÎs.h
>

476 #undeà
_MdoubË_


477 #undeà
__MATH_PRECNAME


478 #undeà
__MATH_DECLARING_DOUBLE


479 #undeà
__MATH_DECLARING_FLOATN


482 #undeà
__MATHDECL_1


483 #undeà
__MATHDECL


484 #undeà
__MATHCALL


487 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


489 
signgam
;

492 #ià(
__HAVE_DISTINCT_FLOAT16
 \

493 || 
__HAVE_DISTINCT_FLOAT32
 \

494 || 
__HAVE_DISTINCT_FLOAT64
 \

495 || 
__HAVE_DISTINCT_FLOAT32X
 \

496 || 
__HAVE_DISTINCT_FLOAT64X
 \

497 || 
__HAVE_DISTINCT_FLOAT128X
)

510 #ifdeà
__NO_LONG_DOUBLE_MATH


511 #ià
__HAVE_DISTINCT_FLOAT128


514 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

515 ( (
TG_ARG
è=ğ (è? 
FUNC
 ## 
f
 
ARGS
 : FUNC ARGS)

	)

516 #–ià
__HAVE_DISTINCT_FLOAT128


517 #ià
__HAVE_GENERIC_SELECTION


518 #ià
__HAVE_FLOATN_NOT_TYPEDEF
 && 
__HAVE_FLOAT32


519 
	#__MATH_TG_F32
(
FUNC
, 
ARGS
è
_Flßt32
: FUNC ## 
f
 ARGS,

	)

521 
	#__MATH_TG_F32
(
FUNC
, 
ARGS
)

	)

523 #ià
__HAVE_FLOATN_NOT_TYPEDEF
 && 
__HAVE_FLOAT64X


524 #ià
__HAVE_FLOAT64X_LONG_DOUBLE


525 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
è
_Flßt64x
: FUNC ## 
l
 ARGS,

	)

527 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
è
_Flßt64x
: FUNC ## 
f128
 ARGS,

	)

530 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
)

	)

532 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

533 
	`_G’”ic
 ((
TG_ARG
), \

534 : 
FUNC
 ## 
f
 
ARGS
, \

535 
	`__MATH_TG_F32
 (
FUNC
, 
ARGS
) \

536 : 
FUNC
 
ARGS
, \

537 : 
FUNC
 ## 
l
 
ARGS
, \

538 
	`__MATH_TG_F64X
 (
FUNC
, 
ARGS
) \

539 
_Flßt128
: 
FUNC
 ## 
f128
 
ARGS
)

	)

541 #ià
__HAVE_FLOATN_NOT_TYPEDEF


544 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

545 
__butš_choo£_ex´
 \

546 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
TG_ARG
), ), \

547 
FUNC
 ## 
f
 
ARGS
, \

548 
__butš_choo£_ex´
 \

549 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
TG_ARG
), ), \

550 
FUNC
 
ARGS
, \

551 
__butš_choo£_ex´
 \

552 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
TG_ARG
), ), \

553 
FUNC
 ## 
l
 
ARGS
, \

554 
FUNC
 ## 
f128
 
ARGS
)))

	)

557 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

558 ( (
TG_ARG
) ==  () \

559 ? 
FUNC
 ## 
f
 
ARGS
 \

560 :  (
TG_ARG
) ==  () \

561 ? 
FUNC
 
ARGS
 \

562 : 
FUNC
 ## 
l
 
ARGS
)

	)

566 #ifdeà
__USE_ISOC99


571 
FP_NAN
 =

572 
	#FP_NAN
 0

	)

573 
FP_NAN
,

574 
FP_INFINITE
 =

575 
	#FP_INFINITE
 1

	)

576 
FP_INFINITE
,

577 
FP_ZERO
 =

578 
	#FP_ZERO
 2

	)

579 
FP_ZERO
,

580 
FP_SUBNORMAL
 =

581 
	#FP_SUBNORMAL
 3

	)

582 
FP_SUBNORMAL
,

583 
FP_NORMAL
 =

584 
	#FP_NORMAL
 4

	)

585 
FP_NORMAL


593 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__
 \

594 && (!
defšed
 
__OPTIMIZE_SIZE__
 || defšed 
__ılu¥lus
)

601 
	#åşassify
(
x
è
	`__butš_åşassify
 (
FP_NAN
, 
FP_INFINITE
, \

602 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

604 
	#åşassify
(
x
è
	`__MATH_TG
 ((x), 
__åşassify
, (x))

	)

608 #ià
	`__GNUC_PREREQ
 (6,0)

609 
	#signb™
(
x
è
	`__butš_signb™
 (x)

	)

610 #–ià
defšed
 
__ılu¥lus


618 
	#signb™
(
x
è
	`__butš_signb™l
 (x)

	)

619 #–ià
	`__GNUC_PREREQ
 (4,0)

620 
	#signb™
(
x
è
	`__MATH_TG
 ((x), 
__butš_signb™
, (x))

	)

622 
	#signb™
(
x
è
	`__MATH_TG
 ((x), 
__signb™
, (x))

	)

626 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


627 
	#isfš™e
(
x
è
	`__butš_isfš™e
 (x)

	)

629 
	#isfš™e
(
x
è
	`__MATH_TG
 ((x), 
__fš™e
, (x))

	)

633 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


634 
	#i¢Üm®
(
x
è
	`__butš_i¢Üm®
 (x)

	)

636 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

641 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


642 
	#i¢ª
(
x
è
	`__butš_i¢ª
 (x)

	)

644 
	#i¢ª
(
x
è
	`__MATH_TG
 ((x), 
__i¢ª
, (x))

	)

648 #ià
__HAVE_DISTINCT_FLOAT128
 && !
	`__GNUC_PREREQ
 (7,0) \

649 && !
defšed
 
__SUPPORT_SNAN__
 && !defšed 
__ılu¥lus


655 
	#isšf
(
x
) \

656 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
x
), 
_Flßt128
) \

657 ? 
	`__isšff128
 (
x
è: 
	`__butš_isšf_sign
 (x))

	)

658 #–ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


659 
	#isšf
(
x
è
	`__butš_isšf_sign
 (x)

	)

661 
	#isšf
(
x
è
	`__MATH_TG
 ((x), 
__isšf
, (x))

	)

665 
	#MATH_ERRNO
 1

	)

666 
	#MATH_ERREXCEPT
 2

	)

673 #ifdeà
__FAST_MATH__


674 
	#m©h_”rhªdlšg
 0

	)

675 #–ià
defšed
 
__NO_MATH_ERRNO__


676 
	#m©h_”rhªdlšg
 (
MATH_ERREXCEPT
)

	)

678 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

683 #ià
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

684 
	~<b™s/isÿnÚiÿl.h
>

687 #iâdeà
__ılu¥lus


688 
	#issigÇlšg
(
x
è
	`__MATH_TG
 ((x), 
__issigÇlšg
, (x))

	)

697 
šlše
 
	`issigÇlšg
 (
__v®
è{  
	`__issigÇlšgf
 (__val); }

698 
šlše
 
	`issigÇlšg
 (
__v®
è{  
	`__issigÇlšg
 (__val); }

699 
šlše
 

700 
	`issigÇlšg
 (
__v®
)

702 #ifdeà
__NO_LONG_DOUBLE_MATH


703  
	`__issigÇlšg
 (
__v®
);

705  
	`__issigÇlšgl
 (
__v®
);

708 #ià
__HAVE_DISTINCT_FLOAT128


709 
šlše
 
	`issigÇlšg
 (
_Flßt128
 
__v®
è{  
	`__issigÇlšgf128
 (__val); }

711 
	}
}

715 
	#issubnÜm®
(
x
è(
	`åşassify
 (xè=ğ
FP_SUBNORMAL
)

	)

718 #iâdeà
__ılu¥lus


719 #ifdeà
__SUPPORT_SNAN__


720 
	#isz”o
(
x
è(
	`åşassify
 (xè=ğ
FP_ZERO
)

	)

722 
	#isz”o
(
x
è(((
	`__ty³of
 (x)è(x)è=ğ0)

	)

726 #ifdeà
__SUPPORT_SNAN__


727 
šlše
 

728 
isz”o
 (
__v®
)

730  
__åşassifyf
 (
__v®
è=ğ
FP_ZERO
;

732 
šlše
 

733 
isz”o
 (
__v®
)

735  
__åşassify
 (
__v®
è=ğ
FP_ZERO
;

737 
šlše
 

738 
isz”o
 (
__v®
)

740 #ifdeà
__NO_LONG_DOUBLE_MATH


741  
__åşassify
 (
__v®
è=ğ
FP_ZERO
;

743  
__åşassifyl
 (
__v®
è=ğ
FP_ZERO
;

746 #ià
__HAVE_DISTINCT_FLOAT128


747 
šlše
 

748 
isz”o
 (
_Flßt128
 
__v®
)

750  
__åşassifyf128
 (
__v®
è=ğ
FP_ZERO
;

754 
‹m¶©e
 <
şass
 
__T
> 
šlše
 
boŞ


755 
isz”o
 (
__T
 
__v®
)

757  
__v®
 == 0;

764 #ifdeà
__USE_XOPEN


766 
	#MAXFLOAT
 3.40282347e+38F

	)

771 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


772 
	#M_E
 2.7182818284590452354

	)

773 
	#M_LOG2E
 1.4426950408889634074

	)

774 
	#M_LOG10E
 0.43429448190325182765

	)

775 
	#M_LN2
 0.69314718055994530942

	)

776 
	#M_LN10
 2.30258509299404568402

	)

777 
	#M_PI
 3.14159265358979323846

	)

778 
	#M_PI_2
 1.57079632679489661923

	)

779 
	#M_PI_4
 0.78539816339744830962

	)

780 
	#M_1_PI
 0.31830988618379067154

	)

781 
	#M_2_PI
 0.63661977236758134308

	)

782 
	#M_2_SQRTPI
 1.12837916709551257390

	)

783 
	#M_SQRT2
 1.41421356237309504880

	)

784 
	#M_SQRT1_2
 0.70710678118654752440

	)

790 #ifdeà
__USE_GNU


791 
	#M_El
 2.718281828459045235360287471352662498L

	)

792 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

793 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

794 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

795 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

796 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

797 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

798 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

799 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

800 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

801 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

802 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

803 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

806 #ià
__HAVE_FLOAT16
 && 
defšed
 
__USE_GNU


807 
	#M_Ef16
 
	`__f16
 (2.718281828459045235360287471352662498è

	)

808 
	#M_LOG2Ef16
 
	`__f16
 (1.442695040888963407359924681001892137è

	)

809 
	#M_LOG10Ef16
 
	`__f16
 (0.434294481903251827651128918916605082è

	)

810 
	#M_LN2f16
 
	`__f16
 (0.693147180559945309417232121458176568è

	)

811 
	#M_LN10f16
 
	`__f16
 (2.302585092994045684017991454684364208è

	)

812 
	#M_PIf16
 
	`__f16
 (3.141592653589793238462643383279502884è

	)

813 
	#M_PI_2f16
 
	`__f16
 (1.570796326794896619231321691639751442è

	)

814 
	#M_PI_4f16
 
	`__f16
 (0.785398163397448309615660845819875721è

	)

815 
	#M_1_PIf16
 
	`__f16
 (0.318309886183790671537767526745028724è

	)

816 
	#M_2_PIf16
 
	`__f16
 (0.636619772367581343075535053490057448è

	)

817 
	#M_2_SQRTPIf16
 
	`__f16
 (1.128379167095512573896158903121545172è

	)

818 
	#M_SQRT2f16
 
	`__f16
 (1.414213562373095048801688724209698079è

	)

819 
	#M_SQRT1_2f16
 
	`__f16
 (0.707106781186547524400844362104849039è

	)

822 #ià
__HAVE_FLOAT32
 && 
defšed
 
__USE_GNU


823 
	#M_Ef32
 
	`__f32
 (2.718281828459045235360287471352662498è

	)

824 
	#M_LOG2Ef32
 
	`__f32
 (1.442695040888963407359924681001892137è

	)

825 
	#M_LOG10Ef32
 
	`__f32
 (0.434294481903251827651128918916605082è

	)

826 
	#M_LN2f32
 
	`__f32
 (0.693147180559945309417232121458176568è

	)

827 
	#M_LN10f32
 
	`__f32
 (2.302585092994045684017991454684364208è

	)

828 
	#M_PIf32
 
	`__f32
 (3.141592653589793238462643383279502884è

	)

829 
	#M_PI_2f32
 
	`__f32
 (1.570796326794896619231321691639751442è

	)

830 
	#M_PI_4f32
 
	`__f32
 (0.785398163397448309615660845819875721è

	)

831 
	#M_1_PIf32
 
	`__f32
 (0.318309886183790671537767526745028724è

	)

832 
	#M_2_PIf32
 
	`__f32
 (0.636619772367581343075535053490057448è

	)

833 
	#M_2_SQRTPIf32
 
	`__f32
 (1.128379167095512573896158903121545172è

	)

834 
	#M_SQRT2f32
 
	`__f32
 (1.414213562373095048801688724209698079è

	)

835 
	#M_SQRT1_2f32
 
	`__f32
 (0.707106781186547524400844362104849039è

	)

838 #ià
__HAVE_FLOAT64
 && 
defšed
 
__USE_GNU


839 
	#M_Ef64
 
	`__f64
 (2.718281828459045235360287471352662498è

	)

840 
	#M_LOG2Ef64
 
	`__f64
 (1.442695040888963407359924681001892137è

	)

841 
	#M_LOG10Ef64
 
	`__f64
 (0.434294481903251827651128918916605082è

	)

842 
	#M_LN2f64
 
	`__f64
 (0.693147180559945309417232121458176568è

	)

843 
	#M_LN10f64
 
	`__f64
 (2.302585092994045684017991454684364208è

	)

844 
	#M_PIf64
 
	`__f64
 (3.141592653589793238462643383279502884è

	)

845 
	#M_PI_2f64
 
	`__f64
 (1.570796326794896619231321691639751442è

	)

846 
	#M_PI_4f64
 
	`__f64
 (0.785398163397448309615660845819875721è

	)

847 
	#M_1_PIf64
 
	`__f64
 (0.318309886183790671537767526745028724è

	)

848 
	#M_2_PIf64
 
	`__f64
 (0.636619772367581343075535053490057448è

	)

849 
	#M_2_SQRTPIf64
 
	`__f64
 (1.128379167095512573896158903121545172è

	)

850 
	#M_SQRT2f64
 
	`__f64
 (1.414213562373095048801688724209698079è

	)

851 
	#M_SQRT1_2f64
 
	`__f64
 (0.707106781186547524400844362104849039è

	)

854 #ià
__HAVE_FLOAT128
 && 
defšed
 
__USE_GNU


855 
	#M_Ef128
 
	`__f128
 (2.718281828459045235360287471352662498è

	)

856 
	#M_LOG2Ef128
 
	`__f128
 (1.442695040888963407359924681001892137è

	)

857 
	#M_LOG10Ef128
 
	`__f128
 (0.434294481903251827651128918916605082è

	)

858 
	#M_LN2f128
 
	`__f128
 (0.693147180559945309417232121458176568è

	)

859 
	#M_LN10f128
 
	`__f128
 (2.302585092994045684017991454684364208è

	)

860 
	#M_PIf128
 
	`__f128
 (3.141592653589793238462643383279502884è

	)

861 
	#M_PI_2f128
 
	`__f128
 (1.570796326794896619231321691639751442è

	)

862 
	#M_PI_4f128
 
	`__f128
 (0.785398163397448309615660845819875721è

	)

863 
	#M_1_PIf128
 
	`__f128
 (0.318309886183790671537767526745028724è

	)

864 
	#M_2_PIf128
 
	`__f128
 (0.636619772367581343075535053490057448è

	)

865 
	#M_2_SQRTPIf128
 
	`__f128
 (1.128379167095512573896158903121545172è

	)

866 
	#M_SQRT2f128
 
	`__f128
 (1.414213562373095048801688724209698079è

	)

867 
	#M_SQRT1_2f128
 
	`__f128
 (0.707106781186547524400844362104849039è

	)

870 #ià
__HAVE_FLOAT32X
 && 
defšed
 
__USE_GNU


871 
	#M_Ef32x
 
	`__f32x
 (2.718281828459045235360287471352662498è

	)

872 
	#M_LOG2Ef32x
 
	`__f32x
 (1.442695040888963407359924681001892137è

	)

873 
	#M_LOG10Ef32x
 
	`__f32x
 (0.434294481903251827651128918916605082è

	)

874 
	#M_LN2f32x
 
	`__f32x
 (0.693147180559945309417232121458176568è

	)

875 
	#M_LN10f32x
 
	`__f32x
 (2.302585092994045684017991454684364208è

	)

876 
	#M_PIf32x
 
	`__f32x
 (3.141592653589793238462643383279502884è

	)

877 
	#M_PI_2f32x
 
	`__f32x
 (1.570796326794896619231321691639751442è

	)

878 
	#M_PI_4f32x
 
	`__f32x
 (0.785398163397448309615660845819875721è

	)

879 
	#M_1_PIf32x
 
	`__f32x
 (0.318309886183790671537767526745028724è

	)

880 
	#M_2_PIf32x
 
	`__f32x
 (0.636619772367581343075535053490057448è

	)

881 
	#M_2_SQRTPIf32x
 
	`__f32x
 (1.128379167095512573896158903121545172è

	)

882 
	#M_SQRT2f32x
 
	`__f32x
 (1.414213562373095048801688724209698079è

	)

883 
	#M_SQRT1_2f32x
 
	`__f32x
 (0.707106781186547524400844362104849039è

	)

886 #ià
__HAVE_FLOAT64X
 && 
defšed
 
__USE_GNU


887 
	#M_Ef64x
 
	`__f64x
 (2.718281828459045235360287471352662498è

	)

888 
	#M_LOG2Ef64x
 
	`__f64x
 (1.442695040888963407359924681001892137è

	)

889 
	#M_LOG10Ef64x
 
	`__f64x
 (0.434294481903251827651128918916605082è

	)

890 
	#M_LN2f64x
 
	`__f64x
 (0.693147180559945309417232121458176568è

	)

891 
	#M_LN10f64x
 
	`__f64x
 (2.302585092994045684017991454684364208è

	)

892 
	#M_PIf64x
 
	`__f64x
 (3.141592653589793238462643383279502884è

	)

893 
	#M_PI_2f64x
 
	`__f64x
 (1.570796326794896619231321691639751442è

	)

894 
	#M_PI_4f64x
 
	`__f64x
 (0.785398163397448309615660845819875721è

	)

895 
	#M_1_PIf64x
 
	`__f64x
 (0.318309886183790671537767526745028724è

	)

896 
	#M_2_PIf64x
 
	`__f64x
 (0.636619772367581343075535053490057448è

	)

897 
	#M_2_SQRTPIf64x
 
	`__f64x
 (1.128379167095512573896158903121545172è

	)

898 
	#M_SQRT2f64x
 
	`__f64x
 (1.414213562373095048801688724209698079è

	)

899 
	#M_SQRT1_2f64x
 
	`__f64x
 (0.707106781186547524400844362104849039è

	)

902 #ià
__HAVE_FLOAT128X
 && 
defšed
 
__USE_GNU


909 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


910 
	#__NO_MATH_INLINES
 1

	)

913 #ifdeà
__USE_ISOC99


914 #ià
__GNUC_PREREQ
 (3, 1)

921 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

922 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

923 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

924 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

925 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

926 
	#isunÜd”ed
(
x
, 
y
è
	`__butš_isunÜd”ed
(x, y)

	)

928 
	#isg»©”
(
x
, 
y
) \

929 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

930 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; }))

	)

931 
	#isg»©”equ®
(
x
, 
y
) \

932 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

933 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

934 
	#i¦ess
(
x
, 
y
) \

935 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

936 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

937 
	#i¦es£qu®
(
x
, 
y
) \

938 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

939 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

940 
	#i¦essg»©”
(
x
, 
y
) \

941 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

942 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x !ğ__y; }))

	)

944 
	#isunÜd”ed
(
x
, 
y
) \

945 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__u
 = (x); __ty³of__ (
y
è
__v
 = (y); \

946 
__u
 !ğ
__v
 && (__u !ğ__u || __v !ğ__v); }))

	)

951 #ifdeà
__USE_EXTERN_INLINES


952 
	~<b™s/m©hšlše.h
>

957 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

960 
	#_MdoubË_
 

	)

961 
	#__MATH_DECLARING_DOUBLE
 1

	)

962 
	#__MATH_DECLARING_FLOATN
 0

	)

963 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

964 
funùiÚ
 ## 
»’Œªt


	)

965 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

966 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

967 
	~<b™s/m©h-fš™e.h
>

968 #undeà
_MdoubË_


969 #undeà
__MATH_DECLARING_DOUBLE


970 #undeà
__MATH_DECLARING_FLOATN


971 #undeà
__REDIRFROM_X


972 #undeà
__REDIRTO_X


976 #ifdeà
__USE_ISOC99


979 
	#_MdoubË_
 

	)

980 
	#__MATH_DECLARING_DOUBLE
 0

	)

981 
	#__MATH_DECLARING_FLOATN
 0

	)

982 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

983 
funùiÚ
 ## 
f
 ## 
»’Œªt


	)

984 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

985 
__
 ## 
funùiÚ
 ## 
f
 ## 
»’Œªt
 ## 
_fš™e


	)

986 
	~<b™s/m©h-fš™e.h
>

987 #undeà
_MdoubË_


988 #undeà
__MATH_DECLARING_DOUBLE


989 #undeà
__MATH_DECLARING_FLOATN


990 #undeà
__REDIRFROM_X


991 #undeà
__REDIRTO_X


994 #ifdeà
__MATH_DECLARE_LDOUBLE


995 
	#_MdoubË_
 

	)

996 
	#__MATH_DECLARING_DOUBLE
 0

	)

997 
	#__MATH_DECLARING_FLOATN
 0

	)

998 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

999 
funùiÚ
 ## 
l
 ## 
»’Œªt


	)

1000 #ifdeà
__NO_LONG_DOUBLE_MATH


1001 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1002 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

1004 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1005 
__
 ## 
funùiÚ
 ## 
l
 ## 
»’Œªt
 ## 
_fš™e


	)

1007 
	~<b™s/m©h-fš™e.h
>

1008 #undeà
_MdoubË_


1009 #undeà
__MATH_DECLARING_DOUBLE


1010 #undeà
__MATH_DECLARING_FLOATN


1011 #undeà
__REDIRFROM_X


1012 #undeà
__REDIRTO_X


1019 #ià(
__HAVE_DISTINCT_FLOAT16
 || (
__HAVE_FLOAT16
 && !
defšed
 
_LIBC
)) \

1020 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1021 
	#_MdoubË_
 
_Flßt16


	)

1022 
	#__MATH_DECLARING_DOUBLE
 0

	)

1023 
	#__MATH_DECLARING_FLOATN
 1

	)

1024 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1025 
funùiÚ
 ## 
f16
 ## 
»’Œªt


	)

1026 #ià
__HAVE_DISTINCT_FLOAT16


1027 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1028 
__
 ## 
funùiÚ
 ## 
f16
 ## 
»’Œªt
 ## 
_fš™e


	)

1032 
	~<b™s/m©h-fš™e.h
>

1033 #undeà
_MdoubË_


1034 #undeà
__MATH_DECLARING_DOUBLE


1035 #undeà
__MATH_DECLARING_FLOATN


1036 #undeà
__REDIRFROM_X


1037 #undeà
__REDIRTO_X


1040 #ià(
__HAVE_DISTINCT_FLOAT32
 || (
__HAVE_FLOAT32
 && !
defšed
 
_LIBC
)) \

1041 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1042 
	#_MdoubË_
 
_Flßt32


	)

1043 
	#__MATH_DECLARING_DOUBLE
 0

	)

1044 
	#__MATH_DECLARING_FLOATN
 1

	)

1045 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1046 
funùiÚ
 ## 
f32
 ## 
»’Œªt


	)

1047 #ià
__HAVE_DISTINCT_FLOAT32


1048 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1049 
__
 ## 
funùiÚ
 ## 
f32
 ## 
»’Œªt
 ## 
_fš™e


	)

1051 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1052 
__
 ## 
funùiÚ
 ## 
f
 ## 
»’Œªt
 ## 
_fš™e


	)

1054 
	~<b™s/m©h-fš™e.h
>

1055 #undeà
_MdoubË_


1056 #undeà
__MATH_DECLARING_DOUBLE


1057 #undeà
__MATH_DECLARING_FLOATN


1058 #undeà
__REDIRFROM_X


1059 #undeà
__REDIRTO_X


1062 #ià(
__HAVE_DISTINCT_FLOAT64
 || (
__HAVE_FLOAT64
 && !
defšed
 
_LIBC
)) \

1063 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1064 
	#_MdoubË_
 
_Flßt64


	)

1065 
	#__MATH_DECLARING_DOUBLE
 0

	)

1066 
	#__MATH_DECLARING_FLOATN
 1

	)

1067 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1068 
funùiÚ
 ## 
f64
 ## 
»’Œªt


	)

1069 #ià
__HAVE_DISTINCT_FLOAT64


1070 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1071 
__
 ## 
funùiÚ
 ## 
f64
 ## 
»’Œªt
 ## 
_fš™e


	)

1073 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1074 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

1076 
	~<b™s/m©h-fš™e.h
>

1077 #undeà
_MdoubË_


1078 #undeà
__MATH_DECLARING_DOUBLE


1079 #undeà
__MATH_DECLARING_FLOATN


1080 #undeà
__REDIRFROM_X


1081 #undeà
__REDIRTO_X


1084 #ià(
__HAVE_DISTINCT_FLOAT128
 || (
__HAVE_FLOAT128
 && !
defšed
 
_LIBC
)) \

1085 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1086 
	#_MdoubË_
 
_Flßt128


	)

1087 
	#__MATH_DECLARING_DOUBLE
 0

	)

1088 
	#__MATH_DECLARING_FLOATN
 1

	)

1089 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1090 
funùiÚ
 ## 
f128
 ## 
»’Œªt


	)

1091 #ià
__HAVE_DISTINCT_FLOAT128


1092 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1093 
__
 ## 
funùiÚ
 ## 
f128
 ## 
»’Œªt
 ## 
_fš™e


	)

1095 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1096 
__
 ## 
funùiÚ
 ## 
l
 ## 
»’Œªt
 ## 
_fš™e


	)

1098 
	~<b™s/m©h-fš™e.h
>

1099 #undeà
_MdoubË_


1100 #undeà
__MATH_DECLARING_DOUBLE


1101 #undeà
__MATH_DECLARING_FLOATN


1102 #undeà
__REDIRFROM_X


1103 #undeà
__REDIRTO_X


1106 #ià(
__HAVE_DISTINCT_FLOAT32X
 || (
__HAVE_FLOAT32X
 && !
defšed
 
_LIBC
)) \

1107 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1108 
	#_MdoubË_
 
_Flßt32x


	)

1109 
	#__MATH_DECLARING_DOUBLE
 0

	)

1110 
	#__MATH_DECLARING_FLOATN
 1

	)

1111 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1112 
funùiÚ
 ## 
f32x
 ## 
»’Œªt


	)

1113 #ià
__HAVE_DISTINCT_FLOAT32X


1114 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1115 
__
 ## 
funùiÚ
 ## 
f32x
 ## 
»’Œªt
 ## 
_fš™e


	)

1117 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1118 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

1120 
	~<b™s/m©h-fš™e.h
>

1121 #undeà
_MdoubË_


1122 #undeà
__MATH_DECLARING_DOUBLE


1123 #undeà
__MATH_DECLARING_FLOATN


1124 #undeà
__REDIRFROM_X


1125 #undeà
__REDIRTO_X


1128 #ià(
__HAVE_DISTINCT_FLOAT64X
 || (
__HAVE_FLOAT64X
 && !
defšed
 
_LIBC
)) \

1129 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1130 
	#_MdoubË_
 
_Flßt64x


	)

1131 
	#__MATH_DECLARING_DOUBLE
 0

	)

1132 
	#__MATH_DECLARING_FLOATN
 1

	)

1133 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1134 
funùiÚ
 ## 
f64x
 ## 
»’Œªt


	)

1135 #ià
__HAVE_DISTINCT_FLOAT64X


1136 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1137 
__
 ## 
funùiÚ
 ## 
f64x
 ## 
»’Œªt
 ## 
_fš™e


	)

1138 #–ià
__HAVE_FLOAT64X_LONG_DOUBLE


1139 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1140 
__
 ## 
funùiÚ
 ## 
l
 ## 
»’Œªt
 ## 
_fš™e


	)

1142 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1143 
__
 ## 
funùiÚ
 ## 
f128
 ## 
»’Œªt
 ## 
_fš™e


	)

1145 
	~<b™s/m©h-fš™e.h
>

1146 #undeà
_MdoubË_


1147 #undeà
__MATH_DECLARING_DOUBLE


1148 #undeà
__MATH_DECLARING_FLOATN


1149 #undeà
__REDIRFROM_X


1150 #undeà
__REDIRTO_X


1153 #ià(
__HAVE_DISTINCT_FLOAT128X
 || (
__HAVE_FLOAT128X
 && !
defšed
 
_LIBC
)) \

1154 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1155 
	#_MdoubË_
 
_Flßt128x


	)

1156 
	#__MATH_DECLARING_DOUBLE
 0

	)

1157 
	#__MATH_DECLARING_FLOATN
 1

	)

1158 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1159 
funùiÚ
 ## 
f128x
 ## 
»’Œªt


	)

1160 #ià
__HAVE_DISTINCT_FLOAT128X


1161 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1162 
__
 ## 
funùiÚ
 ## 
f128x
 ## 
»’Œªt
 ## 
_fš™e


	)

1166 
	~<b™s/m©h-fš™e.h
>

1167 #undeà
_MdoubË_


1168 #undeà
__MATH_DECLARING_DOUBLE


1169 #undeà
__MATH_DECLARING_FLOATN


1170 #undeà
__REDIRFROM_X


1171 #undeà
__REDIRTO_X


1176 #ià
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

1179 #ià
__FLT_EVAL_METHOD__
 == 2 || __FLT_EVAL_METHOD__ > 64

1180 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (yè+ 0.0L)

	)

1181 #–ià
__FLT_EVAL_METHOD__
 == 1 || __FLT_EVAL_METHOD__ > 32

1182 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (yè+ 0.0)

	)

1183 #–ià
__FLT_EVAL_METHOD__
 == 0 || __FLT_EVAL_METHOD__ == 32

1184 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (yè+ 0.0f)

	)

1186 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (y))

	)

1191 #ià!
defšed
 
__ılu¥lus
 || (__ılu¥lu < 201103L && !defšed 
__GNUC__
)

1192 
	#i£qsig
(
x
, 
y
) \

1193 
	`__MATH_TG
 (
	`__MATH_EVAL_FMT2
 (
x
, 
y
), 
__i£qsig
, ((x), (y)))

	)

1206 
‹m¶©e
<
ty³Çme
> 
__i£qsig_ty³
;

1208 
‹m¶©e
<> 
__i£qsig_ty³
<>

1210 
	`__ÿÎ
 (
__x
, 
__y
è
	`throw
 ()

1212  
	`__i£qsigf
 (
__x
, 
__y
);

1216 
‹m¶©e
<> 
__i£qsig_ty³
<>

1218 
	`__ÿÎ
 (
__x
, 
__y
è
	`throw
 ()

1220  
	`__i£qsig
 (
__x
, 
__y
);

1224 
‹m¶©e
<> 
__i£qsig_ty³
<>

1226 
	`__ÿÎ
 (
__x
, 
__y
è
	`throw
 ()

1228 #iâdeà
__NO_LONG_DOUBLE_MATH


1229  
	`__i£qsigl
 (
__x
, 
__y
);

1231  
	`__i£qsig
 (
__x
, 
__y
);

1236 #ià
__HAVE_DISTINCT_FLOAT128


1237 
‹m¶©e
<> 
__i£qsig_ty³
<
_Flßt128
>

1239 
	`__ÿÎ
 (
_Flßt128
 
__x
, _Flßt128 
__y
è
	`throw
 ()

1241  
	`__i£qsigf128
 (
__x
, 
__y
);

1246 
‹m¶©e
<
ty³Çme
 
_T1
,y³Çm
_T2
>

1247 
šlše
 

1248 
	`i£qsig
 (
_T1
 
__x
, 
_T2
 
__y
è
	`throw
 ()

1250 #ià
__ılu¥lus
 >= 201103L

1251 
	`deşty³
 (
	t__MATH_EVAL_FMT2
 (
	t__x
, 
	t__y
)è
	t_T3
;

1253 
	`__ty³of
 (
	t__MATH_EVAL_FMT2
 (
	t__x
, 
	t__y
)è
	t_T3
;

1255  
__i£qsig_ty³
<
_T3
>::
	`__ÿÎ
 (
__x
, 
__y
);

1258 
	}
}

1263 
__END_DECLS


	@/usr/include/netinet/in.h

18 #iâdef 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<b™s/¡dšt-ušŠ.h
>

23 
	~<sys/sock‘.h
>

24 
	~<b™s/ty³s.h
>

27 
__BEGIN_DECLS


30 
ušt32_t
 
	tš_addr_t
;

31 
	sš_addr


33 
š_addr_t
 
	ms_addr
;

37 
	~<b™s/š.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #ià!
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
ušt16_t
 
	tš_pÜt_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

186 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

190 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

194 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #iâdeà
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

207 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

209 #ià!
__USE_KERNEL_IPV6_DEFS


211 
	sš6_addr


215 
ušt8_t
 
	m__u6_addr8
[16];

216 
ušt16_t
 
	m__u6_addr16
[8];

217 
ušt32_t
 
	m__u6_addr32
[4];

218 } 
	m__š6_u
;

219 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

220 #ifdeà
__USE_MISC


221 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

222 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

227 cÚ¡ 
š6_addr
 
š6addr_ªy
;

228 cÚ¡ 
š6_addr
 
š6addr_loİback
;

229 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

230 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

232 
	#INET_ADDRSTRLEN
 16

	)

233 
	#INET6_ADDRSTRLEN
 46

	)

237 
	ssockaddr_š


239 
__SOCKADDR_COMMON
 (
sš_
);

240 
š_pÜt_t
 
	msš_pÜt
;

241 
š_addr
 
	msš_addr
;

244 
	msš_z”o
[ (
sockaddr
) -

245 
__SOCKADDR_COMMON_SIZE
 -

246  (
š_pÜt_t
) -

247  (
š_addr
)];

250 #ià!
__USE_KERNEL_IPV6_DEFS


252 
	ssockaddr_š6


254 
__SOCKADDR_COMMON
 (
sš6_
);

255 
š_pÜt_t
 
	msš6_pÜt
;

256 
ušt32_t
 
	msš6_æowšfo
;

257 
š6_addr
 
	msš6_addr
;

258 
ušt32_t
 
	msš6_scİe_id
;

262 #ifdeà
__USE_MISC


264 
	s_m»q


267 
š_addr
 
	mimr_muÉŸddr
;

270 
š_addr
 
	mimr_š‹rçû
;

273 
	s_m»q_sourû


276 
š_addr
 
	mimr_muÉŸddr
;

279 
š_addr
 
	mimr_š‹rçû
;

282 
š_addr
 
	mimr_sourûaddr
;

286 #ià!
__USE_KERNEL_IPV6_DEFS


288 
	sv6_m»q


291 
š6_addr
 
	mv6mr_muÉŸddr
;

294 
	mv6mr_š‹rçû
;

298 #ifdeà
__USE_MISC


300 
	sgroup_»q


303 
ušt32_t
 
	mgr_š‹rçû
;

306 
sockaddr_¡Üage
 
	mgr_group
;

309 
	sgroup_sourû_»q


312 
ušt32_t
 
	mg¤_š‹rçû
;

315 
sockaddr_¡Üage
 
	mg¤_group
;

318 
sockaddr_¡Üage
 
	mg¤_sourû
;

323 
	s_msf‹r


326 
š_addr
 
	mimsf_muÉŸddr
;

329 
š_addr
 
	mimsf_š‹rçû
;

332 
ušt32_t
 
	mimsf_fmode
;

335 
ušt32_t
 
	mimsf_num¤c
;

337 
š_addr
 
	mimsf_¦i¡
[1];

340 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

341 -  (
š_addr
) \

342 + (
num¤c
è*  (
š_addr
))

	)

344 
	sgroup_f‹r


347 
ušt32_t
 
	mgf_š‹rçû
;

350 
sockaddr_¡Üage
 
	mgf_group
;

353 
ušt32_t
 
	mgf_fmode
;

356 
ušt32_t
 
	mgf_num¤c
;

358 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

361 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

362 -  (
sockaddr_¡Üage
) \

363 + ((
num¤c
) \

364 *  (
sockaddr_¡Üage
)))

	)

374 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

375 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

376 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

377 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

378 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

379 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

380 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

382 
	~<’dŸn.h
>

385 
	~<b™s/by‹sw­.h
>

386 
	~<b™s/ušŠ-id’t™y.h
>

388 #ifdeà
__OPTIMIZE__


392 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


395 
	#Áohl
(
x
è
	`__ušt32_id’t™y
 (x)

	)

396 
	#Áohs
(
x
è
	`__ušt16_id’t™y
 (x)

	)

397 
	#htÚl
(
x
è
	`__ušt32_id’t™y
 (x)

	)

398 
	#htÚs
(
x
è
	`__ušt16_id’t™y
 (x)

	)

400 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


401 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

402 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

403 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

404 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

409 #ifdeà
__GNUC__


410 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

411 (
__ex‹nsiÚ__
 \

412 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

413 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

414 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

415 && 
__a
->
__š6_u
.
__u6_addr32
[2] == 0 \

416 && 
__a
->
__š6_u
.
__u6_addr32
[3] =ğ0; 
	}
}))

	)

418 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

419 (
__ex‹nsiÚ__
 \

420 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

421 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

422 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

423 && 
__a
->
__š6_u
.
__u6_addr32
[2] == 0 \

424 && 
__a
->
__š6_u
.
__u6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

426 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

427 (
__ex‹nsiÚ__
 \

428 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

429 (
__a
->
__š6_u
.
__u6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

431 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

432 (
__ex‹nsiÚ__
 \

433 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

434 (
__a
->
__š6_u
.
__u6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

436 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

437 (
__ex‹nsiÚ__
 \

438 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

439 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

440 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

441 && 
__a
->
__š6_u
.
__u6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

443 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

444 (
__ex‹nsiÚ__
 \

445 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

446 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

447 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

448 && 
__a
->
__š6_u
.
__u6_addr32
[2] == 0 \

449 && 
	`Áohl
 (
__a
->
__š6_u
.
__u6_addr32
[3]è> 1; }))

	)

451 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

452 (
__ex‹nsiÚ__
 \

453 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

454 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

455 
__a
->
__š6_u
.
__u6_addr32
[0] =ğ
__b
->__in6_u.__u6_addr32[0] \

456 && 
__a
->
__š6_u
.
__u6_addr32
[1] =ğ
__b
->__in6_u.__u6_addr32[1] \

457 && 
__a
->
__š6_u
.
__u6_addr32
[2] =ğ
__b
->__in6_u.__u6_addr32[2] \

458 && 
__a
->
__š6_u
.
__u6_addr32
[3] =ğ
__b
->__š6_u.__u6_addr32[3]; }))

	)

460 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

461 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

462 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

464 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

466 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

467 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

468 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

470 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

472 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

473 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

474 =ğ
	`htÚl
 (0xã800000))

	)

476 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

477 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

478 =ğ
	`htÚl
 (0xãc00000))

	)

480 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

481 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

482 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

483 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

485 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

486 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

487 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

488 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

489 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

491 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

492 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

493 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

495 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

498 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ğ0xff)

	)

500 #ifdeà
__USE_MISC


502 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

505 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

506 
__THROW
;

510 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

511 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

512 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

514 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

515 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

516 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

518 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

519 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

520 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

522 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

523 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

524 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

526 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

527 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

528 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

531 #ifdeà
__USE_GNU


532 
cmsghdr
;

534 #ià!
__USE_KERNEL_IPV6_DEFS


536 
	sš6_pktšfo


538 
š6_addr
 
i6_addr
;

539 
i6_ifšdex
;

543 
	s6_mtušfo


545 
sockaddr_š6
 
6m_addr
;

546 
ušt32_t
 
6m_mtu
;

551 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

552 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

553 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

554 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

555 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

556 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

557 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

558 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

559 
__muÉx
, 
__¶usy
)

560 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

561 
	$š‘6_İtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

562 
ušt8_t
 **
__Œp
)

563 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

564 
	$š‘6_İtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

565 
ušt8_t
 **
__Œp
, 
__ty³
)

566 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

570 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

571 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

572 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

573 **
__d©abuå
è
__THROW
;

574 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

575 
__THROW
;

576 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

577 
sockËn_t
 
__v®Ën
è
__THROW
;

578 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

579 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

580 **
__d©abuå
è
__THROW
;

581 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

582 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

583 **
__d©abuå
è
__THROW
;

584 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

585 
sockËn_t
 
__v®Ën
è
__THROW
;

589 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

590 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

591 
__£gm’ts
è
__THROW
;

592 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

593 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

594 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

595 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

596 
__THROW
;

602 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

603 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

604 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

605 
__THROW
;

608 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

609 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

610 
ušt32_t
 
__num¤c
,

611 cÚ¡ 
š_addr
 *
__¦i¡
)

612 
__THROW
;

616 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

617 cÚ¡ 
sockaddr
 *
__group
,

618 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

619 
ušt32_t
 *
__num¤c
,

620 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

623 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

624 cÚ¡ 
sockaddr
 *
__group
,

625 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

626 
ušt32_t
 
__num¤c
,

627 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

630 
__END_DECLS


	@/usr/include/pthread.h

18 #iâdeà
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<’dŸn.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<b™s/±h»adty³s.h
>

27 
	~<b™s/£tjmp.h
>

28 
	~<b™s/wÜdsize.h
>

29 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

35 
	mPTHREAD_CREATE_JOINABLE
,

36 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

37 
	mPTHREAD_CREATE_DETACHED


38 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

45 
	mPTHREAD_MUTEX_TIMED_NP
,

46 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

47 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

48 
	mPTHREAD_MUTEX_ADAPTIVE_NP


49 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


51 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

52 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

53 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

54 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


56 #ifdeà
__USE_GNU


58 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


63 #ifdeà
__USE_XOPEN2K


67 
	mPTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_ROBUST
,

70 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


75 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


79 
	mPTHREAD_PRIO_NONE
,

80 
	mPTHREAD_PRIO_INHERIT
,

81 
	mPTHREAD_PRIO_PROTECT


86 #ià
__PTHREAD_MUTEX_HAVE_PREV


87 
	#PTHREAD_MUTEX_INITIALIZER
 \

88 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

89 #ifdeà
__USE_GNU


90 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

91 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

92 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

94 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

99 
	#PTHREAD_MUTEX_INITIALIZER
 \

100 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

101 #ifdeà
__USE_GNU


102 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

103 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

104 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

105 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

106 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

107 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

114 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


126 #iâdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


127 #ià
__WORDSIZE
 == 64

128 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

133 
	#PTHREAD_RWLOCK_INITIALIZER
 \

134 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

135 #ifdeà
__USE_GNU


136 #ifdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, \

139 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

141 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


142 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

143 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

144 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

146 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

147 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

148 0 } }

	)

158 
	mPTHREAD_INHERIT_SCHED
,

159 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

160 
	mPTHREAD_EXPLICIT_SCHED


161 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

168 
	mPTHREAD_SCOPE_SYSTEM
,

169 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

170 
	mPTHREAD_SCOPE_PROCESS


171 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

178 
	mPTHREAD_PROCESS_PRIVATE
,

179 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

180 
	mPTHREAD_PROCESS_SHARED


181 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

187 
	#PTHREAD_COND_INITIALIZER
 { { {0}, {0}, {0, 0}, {0, 0}, 0, 0, {0, 0} } }

	)

191 
	s_±h»ad_ş—nup_bufãr


193 (*
	m__routše
) (*);

194 *
	m__¬g
;

195 
	m__ÿnûÉy³
;

196 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

202 
	mPTHREAD_CANCEL_ENABLE
,

203 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

204 
	mPTHREAD_CANCEL_DISABLE


205 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

209 
	mPTHREAD_CANCEL_DEFERRED
,

210 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

211 
	mPTHREAD_CANCEL_ASYNCHRONOUS


212 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

214 
	#PTHREAD_CANCELED
 ((*è-1)

	)

218 
	#PTHREAD_ONCE_INIT
 0

	)

221 #ifdeà
__USE_XOPEN2K


225 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

229 
__BEGIN_DECLS


234 
	$±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

235 cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

236 *(*
__¡¬t_routše
) (*),

237 *
__»¡riù
 
__¬g
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 3));

243 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

251 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

253 #ifdeà
__USE_GNU


256 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

264 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

265 cÚ¡ 
time¥ec
 *
__ab¡ime
);

272 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

276 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

279 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
)

280 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

288 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

291 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

292 
__THROW
 
	`__nÚnuÎ
 ((1));

295 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

296 *
__d‘ach¡©e
)

297 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

300 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

301 
__d‘ach¡©e
)

302 
__THROW
 
	`__nÚnuÎ
 ((1));

306 
	$±h»ad_©Œ_g‘gu¬dsize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

307 
size_t
 *
__gu¬dsize
)

308 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

311 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

312 
size_t
 
__gu¬dsize
)

313 
__THROW
 
	`__nÚnuÎ
 ((1));

317 
	$±h»ad_©Œ_g‘sched·¿m
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

318 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

319 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

322 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

323 cÚ¡ 
sched_·¿m
 *
__»¡riù


324 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

327 
	$±h»ad_©Œ_g‘schedpŞicy
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


328 
__©Œ
, *
__»¡riù
 
__pŞicy
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

333 
__THROW
 
	`__nÚnuÎ
 ((1));

336 
	$±h»ad_©Œ_g‘šh”™sched
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


337 
__©Œ
, *
__»¡riù
 
__šh”™
)

338 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

341 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

342 
__šh”™
)

343 
__THROW
 
	`__nÚnuÎ
 ((1));

347 
	$±h»ad_©Œ_g‘scİe
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

348 *
__»¡riù
 
__scİe
)

349 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

352 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

353 
__THROW
 
	`__nÚnuÎ
 ((1));

356 
	$±h»ad_©Œ_g‘¡ackaddr
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


357 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

358 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

364 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

365 *
__¡ackaddr
)

366 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

369 
	$±h»ad_©Œ_g‘¡acksize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


370 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

371 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

376 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

377 
size_t
 
__¡acksize
)

378 
__THROW
 
	`__nÚnuÎ
 ((1));

380 #ifdeà
__USE_XOPEN2K


382 
	$±h»ad_©Œ_g‘¡ack
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

383 **
__»¡riù
 
__¡ackaddr
,

384 
size_t
 *
__»¡riù
 
__¡acksize
)

385 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

390 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

391 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

394 #ifdeà
__USE_GNU


397 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

398 
size_t
 
__ıu£tsize
,

399 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

400 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

404 
	$±h»ad_©Œ_g‘affš™y_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

405 
size_t
 
__ıu£tsize
,

406 
ıu_£t_t
 *
__ıu£t
)

407 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

410 
	$±h»ad_g‘©Œ_deçuÉ_Å
 (
±h»ad_©Œ_t
 *
__©Œ
)

411 
__THROW
 
	`__nÚnuÎ
 ((1));

415 
	$±h»ad_£‰r_deçuÉ_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
)

416 
__THROW
 
	`__nÚnuÎ
 ((1));

421 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

422 
__THROW
 
	`__nÚnuÎ
 ((2));

430 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

431 cÚ¡ 
sched_·¿m
 *
__·¿m
)

432 
__THROW
 
	`__nÚnuÎ
 ((3));

435 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

436 *
__»¡riù
 
__pŞicy
,

437 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

438 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

441 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

442 
__THROW
;

445 #ifdeà
__USE_GNU


447 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

448 
size_t
 
__buæ’
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

452 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, cÚ¡ *
__Çme
)

453 
__THROW
 
	`__nÚnuÎ
 ((2));

457 #ifdeà
__USE_UNIX98


459 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

462 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

465 #ifdeà
__USE_GNU


470 
	$±h»ad_y›ld
 (è
__THROW
;

475 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

476 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

477 
__THROW
 
	`__nÚnuÎ
 ((3));

480 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

481 
ıu_£t_t
 *
__ıu£t
)

482 
__THROW
 
	`__nÚnuÎ
 ((3));

495 
	$±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

496 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

507 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

511 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

514 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

519 
	`±h»ad_‹¡ÿnûl
 ();

528 
__jmp_buf
 
__ÿnûl_jmp_buf
;

529 
__mask_was_§ved
;

530 } 
__ÿnûl_jmp_buf
[1];

531 *
__·d
[4];

532 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

535 #iâdeà
__ş—nup_fù_©Œibu‹


536 
	#__ş—nup_fù_©Œibu‹


	)

541 
	s__±h»ad_ş—nup_äame


543 (*
__ÿnûl_routše
) (*);

544 *
__ÿnûl_¬g
;

545 
__do_™
;

546 
__ÿnûl_ty³
;

549 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


550 #ifdeà
__ılu¥lus


552 şas 
	c__±h»ad_ş—nup_şass


554 (*
__ÿnûl_routše
) (*);

555 *
__ÿnûl_¬g
;

556 
__do_™
;

557 
__ÿnûl_ty³
;

559 
public
:

560 
	$__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

561 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

562 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

563 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

564 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

565 &
__ÿnûl_ty³
); 
	}
}

566 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

576 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

578 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

582 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

583 
__şäame
.
	`__£tdo™
 (
execu‹
); \

584 } 0)

	)

586 #ifdeà
__USE_GNU


590 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

592 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

593 
__şäame
.
	`__deãr
 ()

	)

598 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

599 
__şäame
.
	`__»¡Üe
 (); \

600 
__şäame
.
	`__£tdo™
 (
execu‹
); \

601 } 0)

	)

608 
__ex‹º_šlše
 

609 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

611 ià(
__äame
->
__do_™
)

612 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

613 
	}
}

622 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

624 
__±h»ad_ş—nup_äame
 
__şäame
 \

625 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

626 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

627 .
__do_™
 = 1 };

	)

631 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

632 
__şäame
.
__do_™
 = (
execu‹
); \

633 } 0)

	)

635 #ifdeà
__USE_GNU


639 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

641 
__±h»ad_ş—nup_äame
 
__şäame
 \

642 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

643 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

644 .
__do_™
 = 1 }; \

645 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

646 &
__şäame
.
__ÿnûl_ty³
)

	)

651 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

652 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

653 
__şäame
.
__do_™
 = (
execu‹
); \

654 } 0)

	)

665 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

667 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

668 (*
__ÿnûl_routše
è(*èğ(
routše
); \

669 *
__ÿnûl_¬g
 = (
¬g
); \

670 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

671 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

672 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

674 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

675 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

679 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

680 dØ{

	)

681 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

682 
__ş—nup_fù_©Œibu‹
;

686 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

689 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

690 ià(
execu‹
) \

691 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

692 } 0)

	)

693 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

694 
__ş—nup_fù_©Œibu‹
;

696 #ifdeà
__USE_GNU


700 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

702 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

703 (*
__ÿnûl_routše
è(*èğ(
routše
); \

704 *
__ÿnûl_¬g
 = (
¬g
); \

705 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

706 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

707 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

709 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

710 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

714 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

715 dØ{

	)

716 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

717 
__ş—nup_fù_©Œibu‹
;

722 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

725 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

726 ià(
execu‹
) \

727 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

728 
	}
} 0)

	)

729 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

730 
__ş—nup_fù_©Œibu‹
;

734 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

735 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

736 #iâdeà
SHARED


737 
	`__©Œibu‹__
 ((
__w—k__
))

743 
__jmp_buf_g
;

744 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROWNL
;

750 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

751 cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

752 
__THROW
 
	`__nÚnuÎ
 ((1));

755 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

756 
__THROW
 
	`__nÚnuÎ
 ((1));

759 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

760 
__THROWNL
 
	`__nÚnuÎ
 ((1));

763 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

764 
__THROWNL
 
	`__nÚnuÎ
 ((1));

766 #ifdeà
__USE_XOPEN2K


768 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

769 cÚ¡ 
time¥ec
 *
__»¡riù


770 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

774 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

775 
__THROWNL
 
	`__nÚnuÎ
 ((1));

779 
	$±h»ad_mu‹x_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x_t
 *

780 
__»¡riù
 
__mu‹x
,

781 *
__»¡riù
 
__´ioûšg
)

782 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

786 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

787 
__´ioûšg
,

788 *
__»¡riù
 
__Şd_ûšg
)

789 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

792 #ifdeà
__USE_XOPEN2K8


794 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

795 
__THROW
 
	`__nÚnuÎ
 ((1));

796 #ifdeà
__USE_GNU


797 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

798 
__THROW
 
	`__nÚnuÎ
 ((1));

807 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

808 
__THROW
 
	`__nÚnuÎ
 ((1));

811 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

812 
__THROW
 
	`__nÚnuÎ
 ((1));

815 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

816 
__»¡riù
 
__©Œ
,

817 *
__»¡riù
 
__psh¬ed
)

818 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

821 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

822 
__psh¬ed
)

823 
__THROW
 
	`__nÚnuÎ
 ((1));

825 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


827 
	$±h»ad_mu‹x©Œ_g‘ty³
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


828 
__©Œ
, *
__»¡riù
 
__kšd
)

829 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

834 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

835 
__THROW
 
	`__nÚnuÎ
 ((1));

839 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

840 
__»¡riù
 
__©Œ
,

841 *
__»¡riù
 
__´ÙocŞ
)

842 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

846 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

847 
__´ÙocŞ
)

848 
__THROW
 
	`__nÚnuÎ
 ((1));

851 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

852 
__»¡riù
 
__©Œ
,

853 *
__»¡riù
 
__´ioûšg
)

854 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

857 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

858 
__´ioûšg
)

859 
__THROW
 
	`__nÚnuÎ
 ((1));

861 #ifdeà
__USE_XOPEN2K


863 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

864 *
__robu¡Ãss
)

865 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

866 #ifdeà
__USE_GNU


867 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

868 *
__robu¡Ãss
)

869 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

873 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

874 
__robu¡Ãss
)

875 
__THROW
 
	`__nÚnuÎ
 ((1));

876 #ifdeà
__USE_GNU


877 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

878 
__robu¡Ãss
)

879 
__THROW
 
	`__nÚnuÎ
 ((1));

884 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


889 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

890 cÚ¡ 
±h»ad_rwlock©Œ_t
 *
__»¡riù


891 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

894 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

895 
__THROW
 
	`__nÚnuÎ
 ((1));

898 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

899 
__THROWNL
 
	`__nÚnuÎ
 ((1));

902 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

903 
__THROWNL
 
	`__nÚnuÎ
 ((1));

905 #ifdeà
__USE_XOPEN2K


907 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

908 cÚ¡ 
time¥ec
 *
__»¡riù


909 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

913 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

914 
__THROWNL
 
	`__nÚnuÎ
 ((1));

917 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

918 
__THROWNL
 
	`__nÚnuÎ
 ((1));

920 #ifdeà
__USE_XOPEN2K


922 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

923 cÚ¡ 
time¥ec
 *
__»¡riù


924 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

928 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

929 
__THROWNL
 
	`__nÚnuÎ
 ((1));

935 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

936 
__THROW
 
	`__nÚnuÎ
 ((1));

939 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

940 
__THROW
 
	`__nÚnuÎ
 ((1));

943 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

944 
__»¡riù
 
__©Œ
,

945 *
__»¡riù
 
__psh¬ed
)

946 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

949 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

950 
__psh¬ed
)

951 
__THROW
 
	`__nÚnuÎ
 ((1));

954 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

955 
__»¡riù
 
__©Œ
,

956 *
__»¡riù
 
__´ef
)

957 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

960 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

961 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

969 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

970 cÚ¡ 
±h»ad_cÚd©Œ_t
 *
__»¡riù
 
__cÚd_©Œ
)

971 
__THROW
 
	`__nÚnuÎ
 ((1));

974 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

975 
__THROW
 
	`__nÚnuÎ
 ((1));

978 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

979 
__THROWNL
 
	`__nÚnuÎ
 ((1));

982 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

983 
__THROWNL
 
	`__nÚnuÎ
 ((1));

990 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

991 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

992 
	`__nÚnuÎ
 ((1, 2));

1001 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1002 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

1003 cÚ¡ 
time¥ec
 *
__»¡riù
 
__ab¡ime
)

1004 
	`__nÚnuÎ
 ((1, 2, 3));

1009 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1010 
__THROW
 
	`__nÚnuÎ
 ((1));

1013 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1014 
__THROW
 
	`__nÚnuÎ
 ((1));

1017 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1018 
__»¡riù
 
__©Œ
,

1019 *
__»¡riù
 
__psh¬ed
)

1020 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1023 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1024 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1026 #ifdeà
__USE_XOPEN2K


1028 
	$±h»ad_cÚd©Œ_g‘şock
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1029 
__»¡riù
 
__©Œ
,

1030 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1031 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1034 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1035 
__şockid_t
 
__şock_id
)

1036 
__THROW
 
	`__nÚnuÎ
 ((1));

1040 #ifdeà
__USE_XOPEN2K


1045 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1046 
__THROW
 
	`__nÚnuÎ
 ((1));

1049 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1050 
__THROW
 
	`__nÚnuÎ
 ((1));

1053 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1054 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1057 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1058 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1061 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1062 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1069 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1070 cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1071 
__©Œ
, 
__couÁ
)

1072 
__THROW
 
	`__nÚnuÎ
 ((1));

1075 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1076 
__THROW
 
	`__nÚnuÎ
 ((1));

1079 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1080 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1084 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1085 
__THROW
 
	`__nÚnuÎ
 ((1));

1088 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1089 
__THROW
 
	`__nÚnuÎ
 ((1));

1092 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *

1093 
__»¡riù
 
__©Œ
,

1094 *
__»¡riù
 
__psh¬ed
)

1095 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1098 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1099 
__psh¬ed
)

1100 
__THROW
 
	`__nÚnuÎ
 ((1));

1112 
	$±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1113 (*
__de¡r_funùiÚ
) (*))

1114 
__THROW
 
	`__nÚnuÎ
 ((1));

1117 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1120 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1123 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1124 cÚ¡ *
__poš‹r
è
__THROW
 ;

1127 #ifdeà
__USE_XOPEN2K


1129 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1130 
__şockid_t
 *
__şock_id
)

1131 
__THROW
 
	`__nÚnuÎ
 ((2));

1146 
	$±h»ad_©fÜk
 ((*
__´•¬e
) (),

1147 (*
__·»Á
) (),

1148 (*
__chd
è()è
__THROW
;

1151 #ifdeà
__USE_EXTERN_INLINES


1153 
__ex‹º_šlše
 

1154 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1156  
__th»ad1
 =ğ
__th»ad2
;

1157 
	}
}

1160 
	g__END_DECLS


	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


23 
	#_SIGNAL_H


	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

30 
	~<b™s/signum.h
>

32 
	~<b™s/ty³s/sig_©omic_t.h
>

34 #ià
defšed
 
__USE_POSIX


35 
	~<b™s/ty³s/sig£t_t.h
>

38 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


39 #iâdeà
__pid_t_defšed


40 
__pid_t
 
	tpid_t
;

41 
	#__pid_t_defšed


	)

43 #ifdeà
__USE_XOPEN


45 #iâdeà
__uid_t_defšed


46 
__uid_t
 
	tuid_t
;

47 
	#__uid_t_defšed


	)

51 #ifdeà
__USE_POSIX199309


53 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

56 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


57 
	~<b™s/ty³s/sigšfo_t.h
>

58 
	~<b™s/sigšfo-cÚ¡s.h
>

61 #ifdeà
__USE_MISC


62 
	~<b™s/ty³s/sigv®_t.h
>

65 #ifdeà
__USE_POSIX199309


66 
	~<b™s/ty³s/sigev’t_t.h
>

67 
	~<b™s/sigev’t-cÚ¡s.h
>

72 (*
	t__sighªdËr_t
) ();

77 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

78 
__THROW
;

79 #ifdeà
__USE_GNU


80 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

81 
__THROW
;

87 #ifdeà
__USE_MISC


88 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

89 
__THROW
;

92 #ifdeà
__REDIRECT_NTH


93 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

94 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

95 
__sysv_sigÇl
);

97 
	#sigÇl
 
__sysv_sigÇl


	)

101 #ià
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8


104 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

105 
__THROW
;

111 #ifdeà
__USE_POSIX


112 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

115 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


119 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

123 
	$¿i£
 (
__sig
è
__THROW
;

125 #ifdeà
__USE_MISC


127 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

128 
__THROW
;

129 
	$gsigÇl
 (
__sig
è
__THROW
;

132 #ifdeà
__USE_XOPEN2K8


134 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

137 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

149 #ifdeà
__USE_XOPEN_EXTENDED


150 #ifdeà
__GNUC__


151 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

153 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

155 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

160 #ifdeà
__USE_MISC


167 
	#sigmask
(
sig
è(()(1u << ((sigè- 1)))

	)

170 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

173 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

176 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

180 #ifdeà
__USE_MISC


181 
	#NSIG
 
_NSIG


	)

184 #ifdeà
__USE_GNU


185 
__sighªdËr_t
 
	tsighªdËr_t
;

189 #ifdeà
__USE_MISC


190 
__sighªdËr_t
 
	tsig_t
;

193 #ifdeà
__USE_POSIX


196 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

199 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

202 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

205 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

208 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

209 
__THROW
 
	`__nÚnuÎ
 ((1));

211 #ifdeà
__USE_GNU


213 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

216 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

217 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

220 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

221 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

226 
	~<b™s/sigaùiÚ.h
>

229 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

230 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

237 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

240 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

241 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

244 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__USE_POSIX199506


252 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

253 
	`__nÚnuÎ
 ((1, 2));

256 #ifdeà
__USE_POSIX199309


261 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

262 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

269 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

270 
sigšfo_t
 *
__»¡riù
 
__šfo
,

271 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

272 
	`__nÚnuÎ
 ((1));

276 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

277 
__THROW
;

282 #ifdeà
__USE_MISC


286 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

287 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

291 
	~<b™s/sigcÚ‹xt.h
>

294 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

299 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


300 
	#__Ãed_size_t


	)

301 
	~<¡ddef.h
>

303 
	~<b™s/ty³s/¡ack_t.h
>

304 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


306 
	~<sys/ucÚ‹xt.h
>

310 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_MISC


314 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

316 
	~<b™s/sig¡ack.h
>

317 
	~<b™s/ss_æags.h
>

321 
	$sig®t¡ack
 (cÚ¡ 
¡ack_t
 *
__»¡riù
 
__ss
,

322 
¡ack_t
 *
__»¡riù
 
__oss
è
__THROW
;

325 #ià((
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

326 || 
defšed
 
__USE_MISC
)

327 
	~<b™s/ty³s/¡ruù_sig¡ack.h
>

330 #ià((
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

331 || 
defšed
 
__USE_MISC
)

335 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

336 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

339 #ifdeà
__USE_XOPEN_EXTENDED


343 
	$sighŞd
 (
__sig
è
__THROW
;

346 
	$sig»l£
 (
__sig
è
__THROW
;

349 
	$sigignÜe
 (
__sig
è
__THROW
;

352 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

355 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


358 
	~<b™s/±h»adty³s.h
>

359 
	~<b™s/sigth»ad.h
>

366 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

368 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

370 
	#SIGRTMIN
 (
	`__libc_cu¼’t_sig¹mš
 ())

	)

371 
	#SIGRTMAX
 (
	`__libc_cu¼’t_sig¹max
 ())

	)

373 
__END_DECLS


	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wch¬.h
>

29 
	~<b™s/wÜdsize.h
>

34 
	~<b™s/¡dšt-šŠ.h
>

37 
	~<b™s/¡dšt-ušŠ.h
>

43 sigÃd 
	tšt_Ëa¡8_t
;

44 
	tšt_Ëa¡16_t
;

45 
	tšt_Ëa¡32_t
;

46 #ià
__WORDSIZE
 == 64

47 
	tšt_Ëa¡64_t
;

49 
__ex‹nsiÚ__


50 
	tšt_Ëa¡64_t
;

54 
	tušt_Ëa¡8_t
;

55 
	tušt_Ëa¡16_t
;

56 
	tušt_Ëa¡32_t
;

57 #ià
__WORDSIZE
 == 64

58 
	tušt_Ëa¡64_t
;

60 
__ex‹nsiÚ__


61 
	tušt_Ëa¡64_t
;

68 sigÃd 
	tšt_ç¡8_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_ç¡16_t
;

71 
	tšt_ç¡32_t
;

72 
	tšt_ç¡64_t
;

74 
	tšt_ç¡16_t
;

75 
	tšt_ç¡32_t
;

76 
__ex‹nsiÚ__


77 
	tšt_ç¡64_t
;

81 
	tušt_ç¡8_t
;

82 #ià
__WORDSIZE
 == 64

83 
	tušt_ç¡16_t
;

84 
	tušt_ç¡32_t
;

85 
	tušt_ç¡64_t
;

87 
	tušt_ç¡16_t
;

88 
	tušt_ç¡32_t
;

89 
__ex‹nsiÚ__


90 
	tušt_ç¡64_t
;

95 #ià
__WORDSIZE
 == 64

96 #iâdeà
__šŒ_t_defšed


97 
	tšŒ_t
;

98 
	#__šŒ_t_defšed


	)

100 
	tušŒ_t
;

102 #iâdeà
__šŒ_t_defšed


103 
	tšŒ_t
;

104 
	#__šŒ_t_defšed


	)

106 
	tušŒ_t
;

111 
__štmax_t
 
	tštmax_t
;

112 
__uštmax_t
 
	tuštmax_t
;

115 #ià
__WORDSIZE
 == 64

116 
	#__INT64_C
(
c
èø## 
L


	)

117 
	#__UINT64_C
(
c
èø## 
UL


	)

119 
	#__INT64_C
(
c
èø## 
LL


	)

120 
	#__UINT64_C
(
c
èø## 
ULL


	)

126 
	#INT8_MIN
 (-128)

	)

127 
	#INT16_MIN
 (-32767-1)

	)

128 
	#INT32_MIN
 (-2147483647-1)

	)

129 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

131 
	#INT8_MAX
 (127)

	)

132 
	#INT16_MAX
 (32767)

	)

133 
	#INT32_MAX
 (2147483647)

	)

134 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

137 
	#UINT8_MAX
 (255)

	)

138 
	#UINT16_MAX
 (65535)

	)

139 
	#UINT32_MAX
 (4294967295U)

	)

140 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

144 
	#INT_LEAST8_MIN
 (-128)

	)

145 
	#INT_LEAST16_MIN
 (-32767-1)

	)

146 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

147 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

149 
	#INT_LEAST8_MAX
 (127)

	)

150 
	#INT_LEAST16_MAX
 (32767)

	)

151 
	#INT_LEAST32_MAX
 (2147483647)

	)

152 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

155 
	#UINT_LEAST8_MAX
 (255)

	)

156 
	#UINT_LEAST16_MAX
 (65535)

	)

157 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

158 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

162 
	#INT_FAST8_MIN
 (-128)

	)

163 #ià
__WORDSIZE
 == 64

164 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

165 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

167 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

168 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

170 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

172 
	#INT_FAST8_MAX
 (127)

	)

173 #ià
__WORDSIZE
 == 64

174 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

175 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

177 
	#INT_FAST16_MAX
 (2147483647)

	)

178 
	#INT_FAST32_MAX
 (2147483647)

	)

180 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

183 
	#UINT_FAST8_MAX
 (255)

	)

184 #ià
__WORDSIZE
 == 64

185 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

186 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

188 
	#UINT_FAST16_MAX
 (4294967295U)

	)

189 
	#UINT_FAST32_MAX
 (4294967295U)

	)

191 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

195 #ià
__WORDSIZE
 == 64

196 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

197 
	#INTPTR_MAX
 (9223372036854775807L)

	)

198 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

200 
	#INTPTR_MIN
 (-2147483647-1)

	)

201 
	#INTPTR_MAX
 (2147483647)

	)

202 
	#UINTPTR_MAX
 (4294967295U)

	)

207 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

209 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

218 #ià
__WORDSIZE
 == 64

219 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

220 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

222 #ià
__WORDSIZE32_PTRDIFF_LONG


223 
	#PTRDIFF_MIN
 (-2147483647L-1)

	)

224 
	#PTRDIFF_MAX
 (2147483647L)

	)

226 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

227 
	#PTRDIFF_MAX
 (2147483647)

	)

232 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

233 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

236 #ià
__WORDSIZE
 == 64

237 
	#SIZE_MAX
 (18446744073709551615UL)

	)

239 #ià
__WORDSIZE32_SIZE_ULONG


240 
	#SIZE_MAX
 (4294967295UL)

	)

242 
	#SIZE_MAX
 (4294967295U)

	)

247 #iâdeà
WCHAR_MIN


249 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

250 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

254 
	#WINT_MIN
 (0u)

	)

255 
	#WINT_MAX
 (4294967295u)

	)

258 
	#INT8_C
(
c
è
	)
c

259 
	#INT16_C
(
c
è
	)
c

260 
	#INT32_C
(
c
è
	)
c

261 #ià
__WORDSIZE
 == 64

262 
	#INT64_C
(
c
èø## 
L


	)

264 
	#INT64_C
(
c
èø## 
LL


	)

268 
	#UINT8_C
(
c
è
	)
c

269 
	#UINT16_C
(
c
è
	)
c

270 
	#UINT32_C
(
c
èø## 
U


	)

271 #ià
__WORDSIZE
 == 64

272 
	#UINT64_C
(
c
èø## 
UL


	)

274 
	#UINT64_C
(
c
èø## 
ULL


	)

278 #ià
__WORDSIZE
 == 64

279 
	#INTMAX_C
(
c
èø## 
L


	)

280 
	#UINTMAX_C
(
c
èø## 
UL


	)

282 
	#INTMAX_C
(
c
èø## 
LL


	)

283 
	#UINTMAX_C
(
c
èø## 
ULL


	)

286 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

288 
	#INT8_WIDTH
 8

	)

289 
	#UINT8_WIDTH
 8

	)

290 
	#INT16_WIDTH
 16

	)

291 
	#UINT16_WIDTH
 16

	)

292 
	#INT32_WIDTH
 32

	)

293 
	#UINT32_WIDTH
 32

	)

294 
	#INT64_WIDTH
 64

	)

295 
	#UINT64_WIDTH
 64

	)

297 
	#INT_LEAST8_WIDTH
 8

	)

298 
	#UINT_LEAST8_WIDTH
 8

	)

299 
	#INT_LEAST16_WIDTH
 16

	)

300 
	#UINT_LEAST16_WIDTH
 16

	)

301 
	#INT_LEAST32_WIDTH
 32

	)

302 
	#UINT_LEAST32_WIDTH
 32

	)

303 
	#INT_LEAST64_WIDTH
 64

	)

304 
	#UINT_LEAST64_WIDTH
 64

	)

306 
	#INT_FAST8_WIDTH
 8

	)

307 
	#UINT_FAST8_WIDTH
 8

	)

308 
	#INT_FAST16_WIDTH
 
__WORDSIZE


	)

309 
	#UINT_FAST16_WIDTH
 
__WORDSIZE


	)

310 
	#INT_FAST32_WIDTH
 
__WORDSIZE


	)

311 
	#UINT_FAST32_WIDTH
 
__WORDSIZE


	)

312 
	#INT_FAST64_WIDTH
 64

	)

313 
	#UINT_FAST64_WIDTH
 64

	)

315 
	#INTPTR_WIDTH
 
__WORDSIZE


	)

316 
	#UINTPTR_WIDTH
 
__WORDSIZE


	)

318 
	#INTMAX_WIDTH
 64

	)

319 
	#UINTMAX_WIDTH
 64

	)

321 
	#PTRDIFF_WIDTH
 
__WORDSIZE


	)

322 
	#SIG_ATOMIC_WIDTH
 32

	)

323 
	#SIZE_WIDTH
 
__WORDSIZE


	)

324 
	#WCHAR_WIDTH
 32

	)

325 
	#WINT_WIDTH
 32

	)

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


24 
	#_STDIO_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<b™s/libc-h—d”-¡¬t.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	~<b™s/ty³s/__FILE.h
>

37 
	~<b™s/ty³s/FILE.h
>

39 
	#_STDIO_USES_IOSTREAM


	)

41 
	~<b™s/libio.h
>

43 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


44 #ifdeà
__GNUC__


45 #iâdeà
_VA_LIST_DEFINED


46 
_G_va_li¡
 
	tva_li¡
;

47 
	#_VA_LIST_DEFINED


	)

50 
	~<¡d¬g.h
>

54 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


55 #iâdeà
__off_t_defšed


56 #iâdeà
__USE_FILE_OFFSET64


57 
__off_t
 
	toff_t
;

59 
__off64_t
 
	toff_t
;

61 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

69 #ifdeà
__USE_XOPEN2K8


70 #iâdeà
__ssize_t_defšed


71 
__ssize_t
 
	tssize_t
;

72 
	#__ssize_t_defšed


	)

77 #iâdeà
__USE_FILE_OFFSET64


78 
_G_åos_t
 
	tåos_t
;

80 
_G_åos64_t
 
	tåos_t
;

82 #ifdeà
__USE_LARGEFILE64


83 
_G_åos64_t
 
	tåos64_t
;

87 
	#_IOFBF
 0

	)

88 
	#_IOLBF
 1

	)

89 
	#_IONBF
 2

	)

93 #iâdeà
BUFSIZ


94 
	#BUFSIZ
 
_IO_BUFSIZ


	)

100 #iâdeà
EOF


101 
	#EOF
 (-1)

	)

107 
	#SEEK_SET
 0

	)

108 
	#SEEK_CUR
 1

	)

109 
	#SEEK_END
 2

	)

110 #ifdeà
__USE_GNU


111 
	#SEEK_DATA
 3

	)

112 
	#SEEK_HOLE
 4

	)

116 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


118 
	#P_tmpdœ
 "/tmp"

	)

131 
	~<b™s/¡dio_lim.h
>

135 
_IO_FILE
 *
¡dš
;

136 
_IO_FILE
 *
¡dout
;

137 
_IO_FILE
 *
¡d”r
;

139 
	#¡dš
 
¡dš


	)

140 
	#¡dout
 
¡dout


	)

141 
	#¡d”r
 
¡d”r


	)

144 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

146 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

148 #ifdeà
__USE_ATFILE


150 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

151 cÚ¡ *
__Ãw
è
__THROW
;

158 #iâdeà
__USE_FILE_OFFSET64


159 
FILE
 *
	$tmpfe
 (è
__wur
;

161 #ifdeà
__REDIRECT


162 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

164 
	#tmpfe
 
tmpfe64


	)

168 #ifdeà
__USE_LARGEFILE64


169 
FILE
 *
	$tmpfe64
 (è
__wur
;

173 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

175 #ifdeà
__USE_MISC


178 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

182 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


190 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

191 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

199 
	`fşo£
 (
FILE
 *
__¡»am
);

204 
	`fæush
 (
FILE
 *
__¡»am
);

206 #ifdeà
__USE_MISC


213 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

216 #ifdeà
__USE_GNU


223 
	`fşo£®l
 ();

227 #iâdeà
__USE_FILE_OFFSET64


232 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

233 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

238 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

239 cÚ¡ *
__»¡riù
 
__modes
,

240 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

242 #ifdeà
__REDIRECT


243 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

244 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

245 
__wur
;

246 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

247 cÚ¡ *
__»¡riù
 
__modes
,

248 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

249 
__wur
;

251 
	#fİ’
 
fİ’64


	)

252 
	#äeİ’
 
äeİ’64


	)

255 #ifdeà
__USE_LARGEFILE64


256 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

257 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

258 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

259 cÚ¡ *
__»¡riù
 
__modes
,

260 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

263 #ifdef 
__USE_POSIX


265 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

268 #ifdef 
__USE_GNU


271 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

272 cÚ¡ *
__»¡riù
 
__modes
,

273 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

276 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

278 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

279 
__THROW
 
__wur
;

284 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

290 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

294 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

295 
__modes
, 
size_t
 
__n
è
__THROW
;

297 #ifdef 
__USE_MISC


300 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

301 
size_t
 
__size
è
__THROW
;

304 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

312 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

313 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

318 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

320 
	$¥rštf
 (*
__»¡riù
 
__s
,

321 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

327 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

328 
_G_va_li¡
 
__¬g
);

333 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

335 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

336 
_G_va_li¡
 
__¬g
è
__THROWNL
;

338 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


340 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

341 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

342 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

344 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

345 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

346 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

349 #ià
	`__GLIBC_USE
 (
LIB_EXT2
)

352 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

353 
_G_va_li¡
 
__¬g
)

354 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

355 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

356 cÚ¡ *
__»¡riù
 
__fmt
, ...)

357 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

358 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

359 cÚ¡ *
__»¡riù
 
__fmt
, ...)

360 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

363 #ifdeà
__USE_XOPEN2K8


365 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

366 
_G_va_li¡
 
__¬g
)

367 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

368 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

369 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

377 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

378 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

383 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

385 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

386 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

388 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

389 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

390 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

391 #ifdeà
__REDIRECT


395 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

396 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

397 
__isoc99_fsÿnf
è
__wur
;

398 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

399 
__isoc99_sÿnf
è
__wur
;

400 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

401 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

402 
__isoc99_ssÿnf
);

404 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

405 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

406 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

407 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

408 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

409 
	#fsÿnf
 
__isoc99_fsÿnf


	)

410 
	#sÿnf
 
__isoc99_sÿnf


	)

411 
	#ssÿnf
 
__isoc99_ssÿnf


	)

415 #ifdef 
__USE_ISOC99


420 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

421 
_G_va_li¡
 
__¬g
)

422 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

428 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

429 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

432 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

433 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

434 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

436 #ià!
defšed
 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
vfsÿnf
,

444 (
FILE
 *
__»¡riù
 
__s
,

445 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

446 
__isoc99_vfsÿnf
)

447 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

448 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

449 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

450 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

451 
	`__REDIRECT_NTH
 (
vssÿnf
,

452 (cÚ¡ *
__»¡riù
 
__s
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
,

454 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

455 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

457 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

458 cÚ¡ *
__»¡riù
 
__fÜm©
,

459 
_G_va_li¡
 
__¬g
è
__wur
;

460 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

461 
_G_va_li¡
 
__¬g
è
__wur
;

462 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

463 cÚ¡ *
__»¡riù
 
__fÜm©
,

464 
_G_va_li¡
 
__¬g
è
__THROW
;

465 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

466 
	#vsÿnf
 
__isoc99_vsÿnf


	)

467 
	#vssÿnf
 
__isoc99_vssÿnf


	)

477 
	`fg‘c
 (
FILE
 *
__¡»am
);

478 
	`g‘c
 (
FILE
 *
__¡»am
);

484 
	`g‘ch¬
 ();

488 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

490 #ifdeà
__USE_POSIX199506


495 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

496 
	`g‘ch¬_uÆocked
 ();

499 #ifdeà
__USE_MISC


506 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

517 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

518 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

524 
	`putch¬
 (
__c
);

528 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

530 #ifdeà
__USE_MISC


537 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

540 #ifdeà
__USE_POSIX199506


545 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

546 
	`putch¬_uÆocked
 (
__c
);

550 #ià
defšed
 
__USE_MISC
 \

551 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

553 
	`g‘w
 (
FILE
 *
__¡»am
);

556 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

564 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

565 
__wur
;

567 #ià
	`__GLIBC_USE
 (
DEPRECATED_GETS
)

577 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

580 #ifdeà
__USE_GNU


587 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

588 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

592 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

603 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

604 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

605 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

606 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

607 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

608 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

616 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

617 
size_t
 *
__»¡riù
 
__n
,

618 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

626 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

632 
	`puts
 (cÚ¡ *
__s
);

639 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

646 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

647 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

652 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

653 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

655 #ifdeà
__USE_GNU


662 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

663 
FILE
 *
__»¡riù
 
__¡»am
);

666 #ifdeà
__USE_MISC


673 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

674 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

675 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

676 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

684 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

689 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

694 
	`»wšd
 (
FILE
 *
__¡»am
);

701 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


702 #iâdeà
__USE_FILE_OFFSET64


707 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

712 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

714 #ifdeà
__REDIRECT


715 
	`__REDIRECT
 (
f£eko
,

716 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

717 
f£eko64
);

718 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

720 
	#f£eko
 
f£eko64


	)

721 
	#á–lo
 
á–lo64


	)

726 #iâdeà
__USE_FILE_OFFSET64


731 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

736 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

738 #ifdeà
__REDIRECT


739 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

740 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

741 
	`__REDIRECT
 (
f£os
,

742 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

744 
	#fg‘pos
 
fg‘pos64


	)

745 
	#f£os
 
f£os64


	)

749 #ifdeà
__USE_LARGEFILE64


750 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

751 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

752 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

753 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

757 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

759 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

761 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

763 #ifdeà
__USE_MISC


765 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

766 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

767 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

775 
	`³¼Ü
 (cÚ¡ *
__s
);

781 
	~<b™s/sys_”¾i¡.h
>

784 #ifdef 
__USE_POSIX


786 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

789 #ifdeà
__USE_MISC


791 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

795 #ifdeà
__USE_POSIX2


800 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

806 
	`pşo£
 (
FILE
 *
__¡»am
);

810 #ifdef 
__USE_POSIX


812 *
	$ù”mid
 (*
__s
è
__THROW
;

816 #ià(
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
è|| defšed 
__USE_GNU


818 *
	`cu£rid
 (*
__s
);

822 #ifdef 
__USE_GNU


823 
ob¡ack
;

826 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

827 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

828 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

829 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

830 cÚ¡ *
__»¡riù
 
__fÜm©
,

831 
_G_va_li¡
 
__¬gs
)

832 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

836 #ifdeà
__USE_POSIX199506


840 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

844 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

847 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

850 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


853 
	~<b™s/g‘İt_posix.h
>

858 #ifdeà
__USE_EXTERN_INLINES


859 
	~<b™s/¡dio.h
>

861 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


862 
	~<b™s/¡dio2.h
>

864 #ifdeà
__LDBL_COMPAT


865 
	~<b™s/¡dio-ldbl.h
>

868 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

25 
	~<b™s/libc-h—d”-¡¬t.h
>

28 
	#__Ãed_size_t


	)

29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

31 
	~<¡ddef.h
>

33 
	g__BEGIN_DECLS


35 
	#_STDLIB_H
 1

	)

37 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


39 
	~<b™s/wa™æags.h
>

40 
	~<b™s/wa™¡©us.h
>

43 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (¡©us)

	)

44 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (¡©us)

	)

45 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (¡©us)

	)

46 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (¡©us)

	)

47 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (¡©us)

	)

48 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (¡©us)

	)

49 #ifdeà
__WIFCONTINUED


50 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (¡©us)

	)

55 
	~<b™s/æßŠ.h
>

60 
	mquÙ
;

61 
	m»m
;

62 } 
	tdiv_t
;

65 #iâdeà
__ldiv_t_defšed


68 
	mquÙ
;

69 
	m»m
;

70 } 
	tldiv_t
;

71 
	#__ldiv_t_defšed
 1

	)

74 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


76 
__ex‹nsiÚ__
 struct

78 
	mquÙ
;

79 
	m»m
;

80 } 
	tÎdiv_t
;

81 
	#__Îdiv_t_defšed
 1

	)

86 
	#RAND_MAX
 2147483647

	)

91 
	#EXIT_FAILURE
 1

	)

92 
	#EXIT_SUCCESS
 0

	)

96 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

97 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

101 
	$©of
 (cÚ¡ *
__ÅŒ
)

102 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

104 
	$©oi
 (cÚ¡ *
__ÅŒ
)

105 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

107 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

108 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

110 #ifdeà
__USE_ISOC99


112 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

113 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

117 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

118 **
__»¡riù
 
__’d±r
)

119 
__THROW
 
	`__nÚnuÎ
 ((1));

121 #ifdef 
__USE_ISOC99


123 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

124 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

126 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

127 **
__»¡riù
 
__’d±r
)

128 
__THROW
 
	`__nÚnuÎ
 ((1));

133 #ià
__HAVE_FLOAT16
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

134 
_Flßt16
 
	$¡¹of16
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

135 **
__»¡riù
 
__’d±r
)

136 
__THROW
 
	`__nÚnuÎ
 ((1));

139 #ià
__HAVE_FLOAT32
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

140 
_Flßt32
 
	$¡¹of32
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

141 **
__»¡riù
 
__’d±r
)

142 
__THROW
 
	`__nÚnuÎ
 ((1));

145 #ià
__HAVE_FLOAT64
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

146 
_Flßt64
 
	$¡¹of64
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

147 **
__»¡riù
 
__’d±r
)

148 
__THROW
 
	`__nÚnuÎ
 ((1));

151 #ià
__HAVE_FLOAT128
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

152 
_Flßt128
 
	$¡¹of128
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

153 **
__»¡riù
 
__’d±r
)

154 
__THROW
 
	`__nÚnuÎ
 ((1));

157 #ià
__HAVE_FLOAT32X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

158 
_Flßt32x
 
	$¡¹of32x
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

159 **
__»¡riù
 
__’d±r
)

160 
__THROW
 
	`__nÚnuÎ
 ((1));

163 #ià
__HAVE_FLOAT64X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

164 
_Flßt64x
 
	$¡¹of64x
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

169 #ià
__HAVE_FLOAT128X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

170 
_Flßt128x
 
	$¡¹of128x
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

171 **
__»¡riù
 
__’d±r
)

172 
__THROW
 
	`__nÚnuÎ
 ((1));

176 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
, 
__ba£
)

178 
__THROW
 
	`__nÚnuÎ
 ((1));

180 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

181 **
__»¡riù
 
__’d±r
, 
__ba£
)

182 
__THROW
 
	`__nÚnuÎ
 ((1));

184 #ifdeà
__USE_MISC


186 
__ex‹nsiÚ__


187 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

191 
__ex‹nsiÚ__


192 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

193 **
__»¡riù
 
__’d±r
, 
__ba£
)

194 
__THROW
 
	`__nÚnuÎ
 ((1));

197 #ifdeà
__USE_ISOC99


199 
__ex‹nsiÚ__


200 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

204 
__ex‹nsiÚ__


205 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

206 **
__»¡riù
 
__’d±r
, 
__ba£
)

207 
__THROW
 
	`__nÚnuÎ
 ((1));

211 #ià
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

212 
	$¡räomd
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ *
__fÜm©
,

213 
__f
)

214 
__THROW
 
	`__nÚnuÎ
 ((3));

216 
	$¡räomf
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ *
__fÜm©
,

217 
__f
)

218 
__THROW
 
	`__nÚnuÎ
 ((3));

220 
	$¡räoml
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ *
__fÜm©
,

221 
__f
)

222 
__THROW
 
	`__nÚnuÎ
 ((3));

225 #ià
__HAVE_FLOAT16
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

226 
	$¡räomf16
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

227 
_Flßt16
 
__f
)

228 
__THROW
 
	`__nÚnuÎ
 ((3));

231 #ià
__HAVE_FLOAT32
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

232 
	$¡räomf32
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

233 
_Flßt32
 
__f
)

234 
__THROW
 
	`__nÚnuÎ
 ((3));

237 #ià
__HAVE_FLOAT64
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

238 
	$¡räomf64
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

239 
_Flßt64
 
__f
)

240 
__THROW
 
	`__nÚnuÎ
 ((3));

243 #ià
__HAVE_FLOAT128
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

244 
	$¡räomf128
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

245 
_Flßt128
 
__f
)

246 
__THROW
 
	`__nÚnuÎ
 ((3));

249 #ià
__HAVE_FLOAT32X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

250 
	$¡räomf32x
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

251 
_Flßt32x
 
__f
)

252 
__THROW
 
	`__nÚnuÎ
 ((3));

255 #ià
__HAVE_FLOAT64X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

256 
	$¡räomf64x
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

257 
_Flßt64x
 
__f
)

258 
__THROW
 
	`__nÚnuÎ
 ((3));

261 #ià
__HAVE_FLOAT128X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

262 
	$¡räomf128x
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

263 
_Flßt128x
 
__f
)

264 
__THROW
 
	`__nÚnuÎ
 ((3));

268 #ifdeà
__USE_GNU


272 
	~<b™s/ty³s/loÿË_t.h
>

274 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

275 **
__»¡riù
 
__’d±r
, 
__ba£
,

276 
loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

278 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

279 **
__»¡riù
 
__’d±r
,

280 
__ba£
, 
loÿË_t
 
__loc
)

281 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

283 
__ex‹nsiÚ__


284 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

285 **
__»¡riù
 
__’d±r
, 
__ba£
,

286 
loÿË_t
 
__loc
)

287 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

289 
__ex‹nsiÚ__


290 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

291 **
__»¡riù
 
__’d±r
,

292 
__ba£
, 
loÿË_t
 
__loc
)

293 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

295 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

296 **
__»¡riù
 
__’d±r
, 
loÿË_t
 
__loc
)

297 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

299 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

300 **
__»¡riù
 
__’d±r
, 
loÿË_t
 
__loc
)

301 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

303 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

304 **
__»¡riù
 
__’d±r
,

305 
loÿË_t
 
__loc
)

306 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

308 #ià
__HAVE_FLOAT16


309 
_Flßt16
 
	$¡¹of16_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

310 **
__»¡riù
 
__’d±r
,

311 
loÿË_t
 
__loc
)

312 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

315 #ià
__HAVE_FLOAT32


316 
_Flßt32
 
	$¡¹of32_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

317 **
__»¡riù
 
__’d±r
,

318 
loÿË_t
 
__loc
)

319 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

322 #ià
__HAVE_FLOAT64


323 
_Flßt64
 
	$¡¹of64_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

324 **
__»¡riù
 
__’d±r
,

325 
loÿË_t
 
__loc
)

326 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

329 #ià
__HAVE_FLOAT128


330 
_Flßt128
 
	$¡¹of128_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

331 **
__»¡riù
 
__’d±r
,

332 
loÿË_t
 
__loc
)

333 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

336 #ià
__HAVE_FLOAT32X


337 
_Flßt32x
 
	$¡¹of32x_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

338 **
__»¡riù
 
__’d±r
,

339 
loÿË_t
 
__loc
)

340 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

343 #ià
__HAVE_FLOAT64X


344 
_Flßt64x
 
	$¡¹of64x_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

345 **
__»¡riù
 
__’d±r
,

346 
loÿË_t
 
__loc
)

347 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

350 #ià
__HAVE_FLOAT128X


351 
_Flßt128x
 
	$¡¹of128x_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

352 **
__»¡riù
 
__’d±r
,

353 
loÿË_t
 
__loc
)

354 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

359 #ifdeà
__USE_EXTERN_INLINES


360 
__ex‹º_šlše
 

361 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

363  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

364 
	}
}

365 
__ex‹º_šlše
 

366 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

368  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

369 
	}
}

371 #ifdeà
__USE_ISOC99


372 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

373 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

375  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

376 
	}
}

381 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


385 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

388 
	$a64l
 (cÚ¡ *
__s
)

389 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

393 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


394 
	~<sys/ty³s.h
>

401 
	$¿ndom
 (è
__THROW
;

404 
	$¤ªdom
 (
__£ed
è
__THROW
;

410 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

411 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

415 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

418 #ifdeà
__USE_MISC


423 
	s¿ndom_d©a


425 
št32_t
 *
åŒ
;

426 
št32_t
 *
½Œ
;

427 
št32_t
 *
¡©e
;

428 
¿nd_ty³
;

429 
¿nd_deg
;

430 
¿nd_£p
;

431 
št32_t
 *
’d_±r
;

434 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

435 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

437 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

438 
__THROW
 
	`__nÚnuÎ
 ((2));

440 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

441 
size_t
 
__¡©–’
,

442 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

443 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

445 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

446 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

447 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¿nd
 (è
__THROW
;

455 
	$¤ªd
 (
__£ed
è
__THROW
;

457 #ifdeà
__USE_POSIX199506


459 
	$¿nd_r
 (*
__£ed
è
__THROW
;

463 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


467 
	$d¿nd48
 (è
__THROW
;

468 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

471 
	$Ìªd48
 (è
__THROW
;

472 
	$Äªd48
 (
__xsubi
[3])

473 
__THROW
 
	`__nÚnuÎ
 ((1));

476 
	$m¿nd48
 (è
__THROW
;

477 
	$j¿nd48
 (
__xsubi
[3])

478 
__THROW
 
	`__nÚnuÎ
 ((1));

481 
	$¤ªd48
 (
__£edv®
è
__THROW
;

482 *
	$£ed48
 (
__£ed16v
[3])

483 
__THROW
 
	`__nÚnuÎ
 ((1));

484 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

486 #ifdeà
__USE_MISC


490 
	sd¿nd48_d©a


492 
__x
[3];

493 
__Şd_x
[3];

494 
__c
;

495 
__š™
;

496 
__ex‹nsiÚ__
 
__a
;

501 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

502 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

503 
	$”ªd48_r
 (
__xsubi
[3],

504 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

505 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

508 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

509 *
__»¡riù
 
__»suÉ
)

510 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

511 
	$Äªd48_r
 (
__xsubi
[3],

512 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

513 *
__»¡riù
 
__»suÉ
)

514 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

517 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

518 *
__»¡riù
 
__»suÉ
)

519 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

520 
	$j¿nd48_r
 (
__xsubi
[3],

521 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

522 *
__»¡riù
 
__»suÉ
)

523 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

526 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

527 
__THROW
 
	`__nÚnuÎ
 ((2));

529 
	$£ed48_r
 (
__£ed16v
[3],

530 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

532 
	$lcÚg48_r
 (
__·¿m
[7],

533 
d¿nd48_d©a
 *
__bufãr
)

534 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

539 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

541 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

542 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

549 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

550 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

552 #ifdeà
__USE_GNU


558 *
	$»®loÿ¼ay
 (*
__±r
, 
size_t
 
__nmemb
, size_ˆ
__size
)

559 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

563 
	$ä“
 (*
__±r
è
__THROW
;

565 #ifdeà
__USE_MISC


566 
	~<®loÿ.h
>

569 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

570 || 
defšed
 
__USE_MISC


572 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

575 #ifdeà
__USE_XOPEN2K


577 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

578 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

581 #ifdeà
__USE_ISOC11


583 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

584 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

588 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

592 
	$©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

594 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


596 #ifdeà
__ılu¥lus


597 "C++" 
	$©_quick_ex™
 ((*
__func
) ())

598 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

600 
	$©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

604 #ifdef 
__USE_MISC


607 
	$Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

608 
__THROW
 
	`__nÚnuÎ
 ((1));

614 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

616 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


620 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

623 #ifdeà
__USE_ISOC99


626 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

631 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

633 #ifdeà
__USE_GNU


636 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

637 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

640 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


644 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

647 #ifdeà
__USE_XOPEN2K


650 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

651 
__THROW
 
	`__nÚnuÎ
 ((2));

654 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

657 #ifdef 
__USE_MISC


661 
	$ş—»nv
 (è
__THROW
;

665 #ià
defšed
 
__USE_MISC
 \

666 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

672 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

675 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


684 #iâdeà
__USE_FILE_OFFSET64


685 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

687 #ifdeà
__REDIRECT


688 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

689 
	`__nÚnuÎ
 ((1)è
__wur
;

691 
	#mk¡emp
 
mk¡emp64


	)

694 #ifdeà
__USE_LARGEFILE64


695 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

699 #ifdeà
__USE_MISC


706 #iâdeà
__USE_FILE_OFFSET64


707 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

709 #ifdeà
__REDIRECT


710 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

711 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

713 
	#mk¡emps
 
mk¡emps64


	)

716 #ifdeà
__USE_LARGEFILE64


717 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

718 
	`__nÚnuÎ
 ((1)è
__wur
;

722 #ifdeà
__USE_XOPEN2K8


728 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

731 #ifdeà
__USE_GNU


738 #iâdeà
__USE_FILE_OFFSET64


739 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

741 #ifdeà
__REDIRECT


742 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

743 
	`__nÚnuÎ
 ((1)è
__wur
;

745 
	#mko¡emp
 
mko¡emp64


	)

748 #ifdeà
__USE_LARGEFILE64


749 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

758 #iâdeà
__USE_FILE_OFFSET64


759 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

760 
	`__nÚnuÎ
 ((1)è
__wur
;

762 #ifdeà
__REDIRECT


763 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

764 
__æags
), 
mko¡emps64
)

765 
	`__nÚnuÎ
 ((1)è
__wur
;

767 
	#mko¡emps
 
mko¡emps64


	)

770 #ifdeà
__USE_LARGEFILE64


771 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

772 
	`__nÚnuÎ
 ((1)è
__wur
;

781 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

784 #ifdef 
__USE_GNU


787 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

788 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

791 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


797 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

798 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

803 #iâdeà
__COMPAR_FN_T


804 
	#__COMPAR_FN_T


	)

805 (*
	t__com·r_â_t
) (const *, const *);

807 #ifdef 
__USE_GNU


808 
__com·r_â_t
 
	tcom·risÚ_â_t
;

811 #ifdeà
__USE_GNU


812 (*
	t__com·r_d_â_t
) (const *, const *, *);

817 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

818 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

819 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

821 #ifdeà
__USE_EXTERN_INLINES


822 
	~<b™s/¡dlib-b£¬ch.h
>

827 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

828 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

829 #ifdeà
__USE_GNU


830 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

831 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

832 
	`__nÚnuÎ
 ((1, 4));

837 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

838 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

840 #ifdeà
__USE_ISOC99


841 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

842 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

849 
div_t
 
	$div
 (
__num”
, 
__d’om
)

850 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

851 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

852 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

854 #ifdeà
__USE_ISOC99


855 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

856 
__d’om
)

857 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

861 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

862 || 
defšed
 
__USE_MISC


869 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

870 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

875 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

876 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

881 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

882 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

885 #ifdeà
__USE_MISC


887 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

888 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

889 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

890 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

891 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

892 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

893 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

894 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

899 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

900 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

901 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

902 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

903 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

904 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

906 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

907 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

908 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

909 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

910 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

911 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

912 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

913 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

919 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

922 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

923 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

926 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

930 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

931 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

933 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

934 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

935 
__THROW
;

938 #ifdeà
__USE_MISC


943 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

947 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


954 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

955 *cÚ¡ *
__»¡riù
 
__tok’s
,

956 **
__»¡riù
 
__v®u•
)

957 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

961 #ifdeà
__USE_XOPEN


963 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

969 #ifdeà
__USE_XOPEN2KXSI


971 
	$posix_İ’±
 (
__oæag
è
__wur
;

974 #ifdeà
__USE_XOPEN_EXTENDED


979 
	$g¿Á±
 (
__fd
è
__THROW
;

983 
	$uÆock±
 (
__fd
è
__THROW
;

988 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

991 #ifdeà
__USE_GNU


995 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

996 
__THROW
 
	`__nÚnuÎ
 ((2));

999 
	`g‘±
 ();

1002 #ifdeà
__USE_MISC


1006 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

1007 
__THROW
 
	`__nÚnuÎ
 ((1));

1010 #ià
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K


1013 
	$‰y¦Ù
 (è
__THROW
;

1016 
	~<b™s/¡dlib-æßt.h
>

1019 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1020 
	~<b™s/¡dlib.h
>

1022 #ifdeà
__LDBL_COMPAT


1023 
	~<b™s/¡dlib-ldbl.h
>

1026 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

28 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

36 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

37 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

43 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

46 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


53 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

54 
__c
, 
size_t
 
__n
)

55 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

60 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

63 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

64 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

67 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


70 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

71 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

72 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

75 #ifdeà
__OPTIMIZE__


76 
__ex‹º_®ways_šlše
 *

77 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


79  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

82 
__ex‹º_®ways_šlše
 const *

83 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

88 
	}
}

90 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

91 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

94 #ifdeà
__USE_GNU


97 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


98 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

99 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

100 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

101 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

103 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

104 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

108 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


109 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

110 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

112 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

122 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

124 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

125 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

129 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

133 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

137 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

139 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

140 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

147 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

148 
__THROW
 
	`__nÚnuÎ
 ((2));

150 #ifdeà
__USE_XOPEN2K8


152 
	~<b™s/ty³s/loÿË_t.h
>

155 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__l
)

156 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

159 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

160 
loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

163 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8
 \

164 || 
	$__GLIBC_USE
 (
LIB_EXT2
))

166 *
	$¡rdup
 (cÚ¡ *
__s
)

167 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

173 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

174 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

175 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

178 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


180 
	#¡rdu·
(
s
) \

181 (
__ex‹nsiÚ__
 \

183 cÚ¡ *
__Şd
 = (
s
); \

184 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

185 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

186 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

187 
	}
}))

	)

190 
	#¡ºdu·
(
s
, 
n
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Şd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

195 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

196 
__Ãw
[
__Ën
] = '\0'; \

197 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

198 }))

	)

202 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


205 *
¡rchr
 (*
__s
, 
__c
)

206 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

207 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

208 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

210 #ifdeà
__OPTIMIZE__


211 
__ex‹º_®ways_šlše
 *

212 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


214  
__butš_¡rchr
 (
__s
, 
__c
);

217 
__ex‹º_®ways_šlše
 const *

218 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


220  
__butš_¡rchr
 (
__s
, 
__c
);

225 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

226 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

229 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


232 *
	`¡¼chr
 (*
__s
, 
__c
)

233 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

234 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

235 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

237 #ifdeà
__OPTIMIZE__


238 
__ex‹º_®ways_šlše
 *

239 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


241  
	`__butš_¡¼chr
 (
__s
, 
__c
);

244 
__ex‹º_®ways_šlše
 const *

245 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


247  
	`__butš_¡¼chr
 (
__s
, 
__c
);

250 
	}
}

252 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

253 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

256 #ifdeà
__USE_GNU


259 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


260 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

261 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

262 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

263 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

266 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

272 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

273 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

276 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

279 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


282 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

283 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

284 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

285 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

287 #ifdeà
__OPTIMIZE__


288 
__ex‹º_®ways_šlše
 *

289 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


291  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

294 
__ex‹º_®ways_šlše
 const *

295 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


297  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

300 
	}
}

302 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

303 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

306 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


309 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

310 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

311 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

312 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

314 #ifdeà
__OPTIMIZE__


315 
__ex‹º_®ways_šlše
 *

316 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


318  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

321 
__ex‹º_®ways_šlše
 const *

322 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


324  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

327 
	}
}

329 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

330 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

335 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

336 
__THROW
 
	`__nÚnuÎ
 ((2));

340 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

341 cÚ¡ *
__»¡riù
 
__d–im
,

342 **
__»¡riù
 
__§ve_±r
)

343 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

344 #ifdeà
__USE_POSIX


345 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

346 **
__»¡riù
 
__§ve_±r
)

347 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

350 #ifdeà
__USE_GNU


352 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


353 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

354 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

355 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

356 cÚ¡ *
__ÃedË
)

357 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

359 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

360 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

364 #ifdeà
__USE_GNU


368 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

369 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

370 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

374 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

375 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

376 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

377 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

378 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

379 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

384 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

385 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

387 #ifdef 
__USE_XOPEN2K8


390 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

391 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

396 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

397 #ifdeà
__USE_XOPEN2K


405 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


408 #ifdeà
__REDIRECT_NTH


409 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

410 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

411 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

413 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

414 
__THROW
 
	`__nÚnuÎ
 ((2));

415 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

420 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

421 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

425 #ifdeà
__USE_XOPEN2K8


427 *
	$¡»¼Ü_l
 (
__”ºum
, 
loÿË_t
 
__l
è
__THROW
;

430 #ifdeà
__USE_MISC


431 
	~<¡ršgs.h
>

435 
	$ex¶ic™_bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

439 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

440 cÚ¡ *
__»¡riù
 
__d–im
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 #ifdef 
__USE_XOPEN2K8


446 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

449 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

451 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

452 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

456 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

457 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

458 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

460 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

464 #ifdef 
__USE_GNU


466 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

467 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

470 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

473 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

475 #iâdeà
ba£Çme


480 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


481 "C++" *
	$ba£Çme
 (*
__f’ame
)

482 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

483 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

484 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

486 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

491 #ià
	`__GNUC_PREREQ
 (3,4)

492 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


494 
	~<b™s/¡ršg_fÜtif›d.h
>

498 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


23 
	#_TIME_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 
	#__Ãed_NULL


	)

29 
	~<¡ddef.h
>

33 
	~<b™s/time.h
>

37 
	~<b™s/ty³s/şock_t.h
>

38 
	~<b™s/ty³s/time_t.h
>

39 
	~<b™s/ty³s/¡ruù_tm.h
>

41 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_ISOC11


42 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

45 #ifdeà
__USE_POSIX199309


46 
	~<b™s/ty³s/şockid_t.h
>

47 
	~<b™s/ty³s/tim”_t.h
>

48 
	~<b™s/ty³s/¡ruù_™im”¥ec.h
>

49 
	gsigev’t
;

52 #ifdeà
__USE_XOPEN2K


53 #iâdeà
__pid_t_defšed


54 
__pid_t
 
	tpid_t
;

55 
	#__pid_t_defšed


	)

59 #ifdeà
__USE_XOPEN2K8


60 
	~<b™s/ty³s/loÿË_t.h
>

63 #ifdeà
__USE_ISOC11


65 
	#TIME_UTC
 1

	)

68 
__BEGIN_DECLS


72 
şock_t
 
	$şock
 (è
__THROW
;

75 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

78 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

79 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

82 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

88 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

89 cÚ¡ *
__»¡riù
 
__fÜm©
,

90 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

92 #ifdeà
__USE_XOPEN


95 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

96 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

97 
__THROW
;

100 #ifdeà
__USE_XOPEN2K8


104 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

105 cÚ¡ *
__»¡riù
 
__fÜm©
,

106 cÚ¡ 
tm
 *
__»¡riù
 
__
,

107 
loÿË_t
 
__loc
è
__THROW
;

110 #ifdeà
__USE_GNU


111 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

112 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

113 
loÿË_t
 
__loc
è
__THROW
;

119 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

123 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

125 #ifdeà
__USE_POSIX


128 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

129 
tm
 *
__»¡riù
 
__
è
__THROW
;

133 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

134 
tm
 *
__»¡riù
 
__
è
__THROW
;

139 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

142 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

144 #ifdeà
__USE_POSIX


149 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

150 *
__»¡riù
 
__buf
è
__THROW
;

153 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

154 *
__»¡riù
 
__buf
è
__THROW
;

159 *
__tzÇme
[2];

160 
__daylight
;

161 
__timezÚe
;

164 #ifdef 
__USE_POSIX


166 *
tzÇme
[2];

170 
	$tz£t
 (è
__THROW
;

173 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


174 
daylight
;

175 
timezÚe
;

178 #ifdeà
__USE_MISC


181 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

187 
	#__i¦—p
(
y—r
) \

188 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

191 #ifdeà
__USE_MISC


196 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

199 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

202 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

206 #ifdeà
__USE_POSIX199309


211 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

212 
time¥ec
 *
__»maššg
);

216 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

219 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

222 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

223 
__THROW
;

225 #ifdeà
__USE_XOPEN2K


230 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

231 cÚ¡ 
time¥ec
 *
__»q
,

232 
time¥ec
 *
__»m
);

235 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

240 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

241 
sigev’t
 *
__»¡riù
 
__evp
,

242 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

245 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

248 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

249 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

250 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

253 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

254 
__THROW
;

257 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

261 #ifdeà
__USE_ISOC11


263 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

264 
__THROW
 
	`__nÚnuÎ
 ((1));

268 #ifdeà
__USE_XOPEN_EXTENDED


280 
g‘d©e_”r
;

289 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

292 #ifdeà
__USE_GNU


303 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

304 
tm
 *
__»¡riù
 
__»sbuå
);

307 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifdeà
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #–ià
defšed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #–ià
defšed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<b™s/posix_İt.h
>

208 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


209 
	~<b™s/’vœÚm’ts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<b™s/ty³s.h
>

222 #iâdef 
__ssize_t_defšed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_defšed


	)

227 
	#__Ãed_size_t


	)

228 
	#__Ãed_NULL


	)

229 
	~<¡ddef.h
>

231 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


234 #iâdeà
__gid_t_defšed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_defšed


	)

239 #iâdeà
__uid_t_defšed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_defšed


	)

244 #iâdeà
__off_t_defšed


245 #iâdeà
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_defšed


	)

252 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_defšed


	)

257 #iâdeà
__u£cÚds_t_defšed


258 
__u£cÚds_t
 
	tu£cÚds_t
;

259 
	#__u£cÚds_t_defšed


	)

262 #iâdeà
__pid_t_defšed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_defšed


	)

268 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


269 #iâdeà
__šŒ_t_defšed


270 
__šŒ_t
 
	tšŒ_t
;

271 
	#__šŒ_t_defšed


	)

275 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


276 #iâdeà
__sockËn_t_defšed


277 
__sockËn_t
 
	tsockËn_t
;

278 
	#__sockËn_t_defšed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

292 #ifdeà
__USE_GNU


295 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

296 
__THROW
 
	`__nÚnuÎ
 ((1));

299 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

300 
__THROW
 
	`__nÚnuÎ
 ((1));

303 #ifdeà
__USE_ATFILE


307 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fe
, 
__ty³
, 
__æag
)

308 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

313 #iâdef 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifdeà
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #ià
defšed
 
__USE_MISC
 && !defšed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #iâdeà
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

339 #ifdeà
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifdeà
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

349 
__THROW
;

356 
	`şo£
 (
__fd
);

363 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

369 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

371 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


372 #iâdeà
__USE_FILE_OFFSET64


379 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

380 
__off_t
 
__off£t
è
__wur
;

387 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
è
__wur
;

390 #ifdeà
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

392 
__off64_t
 
__off£t
),

393 
´—d64
è
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

395 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

396 
pwr™e64
è
__wur
;

398 
	#´—d
 
´—d64


	)

399 
	#pwr™e
 
pwr™e64


	)

403 #ifdeà
__USE_LARGEFILE64


407 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

408 
__off64_t
 
__off£t
è
__wur
;

411 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
è
__wur
;

420 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

422 #ifdeà
__USE_GNU


425 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

435 
	$®¬m
 (
__£cÚds
è
__THROW
;

447 
	`¦“p
 (
__£cÚds
);

449 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

450 || 
defšed
 
__USE_MISC


455 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

456 
__THROW
;

463 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

472 
	`·u£
 ();

476 
	$chown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

479 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

486 
	$lchown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

491 #ifdeà
__USE_ATFILE


494 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
,

495 
__gid_t
 
__group
, 
__æag
)

496 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

500 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

502 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


504 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

514 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

523 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

524 || 
defšed
 
__USE_MISC


528 *
	$g‘wd
 (*
__buf
)

529 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

534 
	$dup
 (
__fd
è
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

539 #ifdeà
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

546 **
__’vœÚ
;

547 #ifdeà
__USE_GNU


548 **
’vœÚ
;

554 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

555 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

557 #ifdeà
__USE_XOPEN2K8


560 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

561 
__THROW
 
	`__nÚnuÎ
 ((2));

566 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

567 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 
	$exeşe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 
	$exeş
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

577 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

581 
	$execvp
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[])

582 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 
	$exeşp
 (cÚ¡ *
__fe
, cÚ¡ *
__¬g
, ...)

588 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

590 #ifdeà
__USE_GNU


593 
	$execv³
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[],

594 *cÚ¡ 
__’vp
[])

595 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

599 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


601 
	$niû
 (
__šc
è
__THROW
 
__wur
;

606 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

612 
	~<b™s/cÚâame.h
>

615 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

616 
__THROW
 
	`__nÚnuÎ
 ((1));

619 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

622 
	$syscÚf
 (
__Çme
è
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

631 
__pid_t
 
	$g‘pid
 (è
__THROW
;

634 
__pid_t
 
	$g‘µid
 (è
__THROW
;

637 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

640 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

641 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


642 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

649 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

651 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


663 
	$£g½
 (è
__THROW
;

670 
__pid_t
 
	$£tsid
 (è
__THROW
;

672 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


674 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

678 
__uid_t
 
	$g‘uid
 (è
__THROW
;

681 
__uid_t
 
	$g‘euid
 (è
__THROW
;

684 
__gid_t
 
	$g‘gid
 (è
__THROW
;

687 
__gid_t
 
	$g‘egid
 (è
__THROW
;

692 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

705 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


708 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

711 #ifdeà
__USE_XOPEN2K


713 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

722 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


725 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

728 #ifdeà
__USE_XOPEN2K


730 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

733 #ifdeà
__USE_GNU


736 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

737 
__THROW
;

741 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

742 
__THROW
;

746 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

747 
__THROW
 
__wur
;

751 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

761 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

762 || 
defšed
 
__USE_MISC


767 
__pid_t
 
	$vfÜk
 (è
__THROW
;

773 *
	$‰yÇme
 (
__fd
è
__THROW
;

777 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

778 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

782 
	$i§‰y
 (
__fd
è
__THROW
;

784 #ifdeà
__USE_MISC


787 
	$‰y¦Ù
 (è
__THROW
;

792 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

793 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

795 #ifdeà
__USE_ATFILE


798 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

799 cÚ¡ *
__to
, 
__æags
)

800 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

803 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


805 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

806 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

811 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

812 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

813 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

816 #ifdeà
__USE_ATFILE


818 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

819 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

822 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

823 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

824 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

828 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

830 #ifdeà
__USE_ATFILE


832 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

833 
__THROW
 
	`__nÚnuÎ
 ((2));

837 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

841 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

844 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

851 *
	`g‘logš
 ();

852 #ifdeà
__USE_POSIX199506


859 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

862 #ifdef 
__USE_MISC


864 
	$£ogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

868 #ifdef 
__USE_POSIX2


872 
	~<b™s/g‘İt_posix.h
>

876 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


880 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

884 #ià
defšed
 
__USE_MISC


887 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

888 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

892 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

898 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

899 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

900 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

901 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

907 
	$vhªgup
 (è
__THROW
;

910 
	$»voke
 (cÚ¡ *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

918 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

919 
size_t
 
__off£t
, 
__sÿË
)

920 
__THROW
 
	`__nÚnuÎ
 ((1));

926 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

930 *
	$g‘u£rsh–l
 (è
__THROW
;

931 
	$’du£rsh–l
 (è
__THROW
;

932 
	$£tu£rsh–l
 (è
__THROW
;

938 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

942 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

945 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

949 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

957 
	`fsync
 (
__fd
);

960 #ifdeà
__USE_GNU


963 
	$syncfs
 (
__fd
è
__THROW
;

967 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


970 
	`g‘ho¡id
 ();

973 
	$sync
 (è
__THROW
;

976 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K


979 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

984 
	$g‘dbËsize
 (è
__THROW
;

990 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


993 #iâdeà
__USE_FILE_OFFSET64


994 
	$Œunÿ‹
 (cÚ¡ *
__fe
, 
__off_t
 
__Ëngth
)

995 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

997 #ifdeà
__REDIRECT_NTH


998 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

999 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
),

1000 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1002 
	#Œunÿ‹
 
Œunÿ‹64


	)

1005 #ifdeà
__USE_LARGEFILE64


1006 
	$Œunÿ‹64
 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
)

1007 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1012 #ià
defšed
 
__USE_POSIX199309
 \

1013 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1016 #iâdeà
__USE_FILE_OFFSET64


1017 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1019 #ifdeà
__REDIRECT_NTH


1020 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1021 
árunÿ‹64
è
__wur
;

1023 
	#árunÿ‹
 
árunÿ‹64


	)

1026 #ifdeà
__USE_LARGEFILE64


1027 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1033 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1034 || 
defšed
 
__USE_MISC


1038 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1044 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1048 #ifdeà
__USE_MISC


1059 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1064 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1076 
	#F_ULOCK
 0

	)

1077 
	#F_LOCK
 1

	)

1078 
	#F_TLOCK
 2

	)

1079 
	#F_TEST
 3

	)

1081 #iâdeà
__USE_FILE_OFFSET64


1082 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1084 #ifdeà
__REDIRECT


1085 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1086 
lockf64
è
__wur
;

1088 
	#lockf
 
lockf64


	)

1091 #ifdeà
__USE_LARGEFILE64


1092 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1097 #ifdeà
__USE_GNU


1102 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1103 (
__ex‹nsiÚ__
 \

1104 ({ 
__»suÉ
; \

1105 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1106 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1107 
__»suÉ
; 
	}
}))

	)

1110 
ssize_t
 
cİy_fe_¿nge
 (
__šfd
, 
__off64_t
 *
__pšoff
,

1111 
__outfd
, 
__off64_t
 *
__poutoff
,

1112 
size_t
 
__Ëngth
, 
__æags
);

1115 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1118 
fd©async
 (
__fdes
);

1124 #ifdef 
__USE_XOPEN


1126 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1127 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1131 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1132 
__THROW
 
	`__nÚnuÎ
 ((1));

1139 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1140 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1147 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1149 *
	$ù”mid
 (*
__s
è
__THROW
;

1152 *
	`cu£rid
 (*
__s
);

1158 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_XOPEN2K


1159 
	$±h»ad_©fÜk
 ((*
__´•¬e
) (),

1160 (*
__·»Á
) (),

1161 (*
__chd
è()è
__THROW
;

1164 #ifdeà
__USE_MISC


1167 
	$g‘’Œİy
 (*
__bufãr
, 
size_t
 
__Ëngth
è
__wur
;

1171 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1172 
	~<b™s/uni¡d.h
>

1175 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/cublas_api.h

57 #ià!
defšed
(
CUBLAS_API_H_
)

58 
	#CUBLAS_API_H_


	)

60 #iâdeà
CUBLASWINAPI


61 #ifdeà
_WIN32


62 
	#CUBLASWINAPI
 
__¡dÿÎ


	)

64 
	#CUBLASWINAPI


	)

68 #iâdeà
CUBLASAPI


72 
	~"driv”_ty³s.h
"

73 
	~"cuCom¶ex.h
"

75 
	~<cuda_å16.h
>

77 
	~"lib¿ry_ty³s.h
"

80 #ià
defšed
(
__ılu¥lus
)

84 
	#CUBLAS_VER_MAJOR
 10

	)

85 
	#CUBLAS_VER_MINOR
 2

	)

86 
	#CUBLAS_VER_PATCH
 1

	)

87 
	#CUBLAS_VER_BUILD
 243

	)

88 
	#CUBLAS_VERSION
 (
CUBLAS_VER_MAJOR
 * 1000 + \

89 
CUBLAS_VER_MINOR
 * 100 + \

90 
CUBLAS_VER_PATCH
)

	)

94 
CUBLAS_STATUS_SUCCESS
 =0,

95 
CUBLAS_STATUS_NOT_INITIALIZED
 =1,

96 
CUBLAS_STATUS_ALLOC_FAILED
 =3,

97 
CUBLAS_STATUS_INVALID_VALUE
 =7,

98 
CUBLAS_STATUS_ARCH_MISMATCH
 =8,

99 
CUBLAS_STATUS_MAPPING_ERROR
 =11,

100 
CUBLAS_STATUS_EXECUTION_FAILED
=13,

101 
CUBLAS_STATUS_INTERNAL_ERROR
 =14,

102 
CUBLAS_STATUS_NOT_SUPPORTED
 =15,

103 
CUBLAS_STATUS_LICENSE_ERROR
 =16

104 } 
	tcubÏsStus_t
;

108 
CUBLAS_FILL_MODE_LOWER
=0,

109 
CUBLAS_FILL_MODE_UPPER
=1,

110 
CUBLAS_FILL_MODE_FULL
=2

111 } 
	tcubÏsFlMode_t
;

114 
CUBLAS_DIAG_NON_UNIT
=0,

115 
CUBLAS_DIAG_UNIT
=1

116 } 
	tcubÏsDŸgTy³_t
;

119 
CUBLAS_SIDE_LEFT
 =0,

120 
CUBLAS_SIDE_RIGHT
=1

121 } 
	tcubÏsSideMode_t
;

125 
CUBLAS_OP_N
=0,

126 
CUBLAS_OP_T
=1,

127 
CUBLAS_OP_C
=2,

128 
CUBLAS_OP_HERMITAN
=2,

129 
CUBLAS_OP_CONJG
=3

130 } 
	tcubÏsO³¿tiÚ_t
;

134 
CUBLAS_POINTER_MODE_HOST
 = 0,

135 
CUBLAS_POINTER_MODE_DEVICE
 = 1

136 } 
	tcubÏsPoš‹rMode_t
;

139 
CUBLAS_ATOMICS_NOT_ALLOWED
 = 0,

140 
CUBLAS_ATOMICS_ALLOWED
 = 1

141 } 
	tcubÏsAtomicsMode_t
;

145 
CUBLAS_GEMM_DFALT
 = -1,

146 
CUBLAS_GEMM_DEFAULT
 = -1,

147 
CUBLAS_GEMM_ALGO0
 = 0,

148 
CUBLAS_GEMM_ALGO1
 = 1,

149 
CUBLAS_GEMM_ALGO2
 = 2,

150 
CUBLAS_GEMM_ALGO3
 = 3,

151 
CUBLAS_GEMM_ALGO4
 = 4,

152 
CUBLAS_GEMM_ALGO5
 = 5,

153 
CUBLAS_GEMM_ALGO6
 = 6,

154 
CUBLAS_GEMM_ALGO7
 = 7,

155 
CUBLAS_GEMM_ALGO8
 = 8,

156 
CUBLAS_GEMM_ALGO9
 = 9,

157 
CUBLAS_GEMM_ALGO10
 = 10,

158 
CUBLAS_GEMM_ALGO11
 = 11,

159 
CUBLAS_GEMM_ALGO12
 = 12,

160 
CUBLAS_GEMM_ALGO13
 = 13,

161 
CUBLAS_GEMM_ALGO14
 = 14,

162 
CUBLAS_GEMM_ALGO15
 = 15,

163 
CUBLAS_GEMM_ALGO16
 = 16,

164 
CUBLAS_GEMM_ALGO17
 = 17,

165 
CUBLAS_GEMM_ALGO18
 = 18,

166 
CUBLAS_GEMM_ALGO19
 = 19,

167 
CUBLAS_GEMM_ALGO20
 = 20,

168 
CUBLAS_GEMM_ALGO21
 = 21,

169 
CUBLAS_GEMM_ALGO22
 = 22,

170 
CUBLAS_GEMM_ALGO23
 = 23,

171 
CUBLAS_GEMM_DEFAULT_TENSOR_OP
 = 99,

172 
CUBLAS_GEMM_DFALT_TENSOR_OP
 = 99,

173 
CUBLAS_GEMM_ALGO0_TENSOR_OP
 = 100,

174 
CUBLAS_GEMM_ALGO1_TENSOR_OP
 = 101,

175 
CUBLAS_GEMM_ALGO2_TENSOR_OP
 = 102,

176 
CUBLAS_GEMM_ALGO3_TENSOR_OP
 = 103,

177 
CUBLAS_GEMM_ALGO4_TENSOR_OP
 = 104,

178 
CUBLAS_GEMM_ALGO5_TENSOR_OP
 = 105,

179 
CUBLAS_GEMM_ALGO6_TENSOR_OP
 = 106,

180 
CUBLAS_GEMM_ALGO7_TENSOR_OP
 = 107,

181 
CUBLAS_GEMM_ALGO8_TENSOR_OP
 = 108,

182 
CUBLAS_GEMM_ALGO9_TENSOR_OP
 = 109,

183 
CUBLAS_GEMM_ALGO10_TENSOR_OP
 = 110,

184 
CUBLAS_GEMM_ALGO11_TENSOR_OP
 = 111,

185 
CUBLAS_GEMM_ALGO12_TENSOR_OP
 = 112,

186 
CUBLAS_GEMM_ALGO13_TENSOR_OP
 = 113,

187 
CUBLAS_GEMM_ALGO14_TENSOR_OP
 = 114,

188 
CUBLAS_GEMM_ALGO15_TENSOR_OP
 = 115

189 } 
	tcubÏsGemmAlgo_t
;

193 
CUBLAS_DEFAULT_MATH
 = 0,

194 
CUBLAS_TENSOR_OP_MATH
 = 1

195 } 
	tcubÏsM©h_t
;

198 
cudaD©aTy³
 
	tcubÏsD©aTy³_t
;

201 
cubÏsCÚ‹xt
;

202 
cubÏsCÚ‹xt
 *
	tcubÏsHªdË_t
;

204 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsC»©e_v2
 (
cubÏsHªdË_t
 *
hªdË
);

205 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDe¡roy_v2
 (
cubÏsHªdË_t
 
hªdË
);

207 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘V”siÚ_v2
(
cubÏsHªdË_t
 
hªdË
, *
v”siÚ
);

208 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘Prİ”ty
(
lib¿ryPrİ”tyTy³
 
ty³
, *
v®ue
);

209 
CUBLASAPI
 
size_t
 
CUBLASWINAPI
 
cubÏsG‘Cud¬tV”siÚ
();

211 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘SŒ—m_v2
 (
cubÏsHªdË_t
 
hªdË
, 
cudaSŒ—m_t
 
¡»amId
);

212 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘SŒ—m_v2
 (
cubÏsHªdË_t
 
hªdË
, 
cudaSŒ—m_t
 *
¡»amId
);

214 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘Poš‹rMode_v2
 (
cubÏsHªdË_t
 
hªdË
, 
cubÏsPoš‹rMode_t
 *
mode
);

215 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘Poš‹rMode_v2
 (
cubÏsHªdË_t
 
hªdË
, 
cubÏsPoš‹rMode_t
 
mode
);

217 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘AtomicsMode
(
cubÏsHªdË_t
 
hªdË
, 
cubÏsAtomicsMode_t
 *
mode
);

218 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘AtomicsMode
(
cubÏsHªdË_t
 
hªdË
, 
cubÏsAtomicsMode_t
 
mode
);

220 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘M©hMode
(
cubÏsHªdË_t
 
hªdË
, 
cubÏsM©h_t
 *
mode
);

221 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘M©hMode
(
cubÏsHªdË_t
 
hªdË
, 
cubÏsM©h_t
 
mode
);

225 (*
cubÏsLogC®lback
)(cÚ¡ *
	tmsg
);

227 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsLogg”CÚfigu»
(
logIsOn
, 
logToStdOut
, 
logToStdE¼
, cÚ¡ * 
logFeName
);

228 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘Logg”C®lback
(
cubÏsLogC®lback
 
u£rC®lback
);

229 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘Logg”C®lback
(
cubÏsLogC®lback
* 
u£rC®lback
);

254 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘VeùÜ
 (
n
, 
–emSize
, cÚ¡ *
x
,

255 
šcx
, *
deviûPŒ
, 
šcy
);

280 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘VeùÜ
 (
n
, 
–emSize
, cÚ¡ *
x
,

281 
šcx
, *
y
, 
šcy
);

304 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘M©rix
 (
rows
, 
cŞs
, 
–emSize
,

305 cÚ¡ *
A
, 
lda
, *
B
,

306 
ldb
);

328 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘M©rix
 (
rows
, 
cŞs
, 
–emSize
,

329 cÚ¡ *
A
, 
lda
, *
B
,

330 
ldb
);

348 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘VeùÜAsync
 (
n
, 
–emSize
,

349 cÚ¡ *
ho¡PŒ
, 
šcx
,

350 *
deviûPŒ
, 
šcy
,

351 
cudaSŒ—m_t
 
¡»am
);

368 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘VeùÜAsync
 (
n
, 
–emSize
,

369 cÚ¡ *
deviûPŒ
, 
šcx
,

370 *
ho¡PŒ
, 
šcy
,

371 
cudaSŒ—m_t
 
¡»am
);

390 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‘M©rixAsync
 (
rows
, 
cŞs
, 
–emSize
,

391 cÚ¡ *
A
, 
lda
, *
B
,

392 
ldb
, 
cudaSŒ—m_t
 
¡»am
);

410 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsG‘M©rixAsync
 (
rows
, 
cŞs
, 
–emSize
,

411 cÚ¡ *
A
, 
lda
, *
B
,

412 
ldb
, 
cudaSŒ—m_t
 
¡»am
);

415 
CUBLASAPI
 
CUBLASWINAPI
 
cubÏsX”bÏ
 (cÚ¡ *
¤Name
, 
šfo
);

417 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsNrm2Ex
(
cubÏsHªdË_t
 
hªdË
,

418 
n
,

419 cÚ¡ *
x
,

420 
cudaD©aTy³
 
xTy³
,

421 
šcx
,

422 *
»suÉ
,

423 
cudaD©aTy³
 
»suÉTy³
,

424 
cudaD©aTy³
 
executiÚTy³
);

426 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSÄm2_v2
(
cubÏsHªdË_t
 
hªdË
,

427 
n
,

428 cÚ¡ *
x
,

429 
šcx
,

430 *
»suÉ
);

432 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDÄm2_v2
(
cubÏsHªdË_t
 
hªdË
,

433 
n
,

434 cÚ¡ *
x
,

435 
šcx
,

436 *
»suÉ
);

438 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSúrm2_v2
(
cubÏsHªdË_t
 
hªdË
,

439 
n
,

440 cÚ¡ 
cuCom¶ex
 *
x
,

441 
šcx
,

442 *
»suÉ
);

444 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDzÄm2_v2
(
cubÏsHªdË_t
 
hªdË
,

445 
n
,

446 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

447 
šcx
,

448 *
»suÉ
);

450 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDÙEx
 (
cubÏsHªdË_t
 
hªdË
,

451 
n
,

452 cÚ¡ *
x
,

453 
cudaD©aTy³
 
xTy³
,

454 
šcx
,

455 cÚ¡ *
y
,

456 
cudaD©aTy³
 
yTy³
,

457 
šcy
,

458 *
»suÉ
,

459 
cudaD©aTy³
 
»suÉTy³
,

460 
cudaD©aTy³
 
executiÚTy³
);

462 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDÙcEx
 (
cubÏsHªdË_t
 
hªdË
,

463 
n
,

464 cÚ¡ *
x
,

465 
cudaD©aTy³
 
xTy³
,

466 
šcx
,

467 cÚ¡ *
y
,

468 
cudaD©aTy³
 
yTy³
,

469 
šcy
,

470 *
»suÉ
,

471 
cudaD©aTy³
 
»suÉTy³
,

472 
cudaD©aTy³
 
executiÚTy³
);

474 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSdÙ_v2
 (
cubÏsHªdË_t
 
hªdË
,

475 
n
,

476 cÚ¡ *
x
,

477 
šcx
,

478 cÚ¡ *
y
,

479 
šcy
,

480 *
»suÉ
);

482 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDdÙ_v2
 (
cubÏsHªdË_t
 
hªdË
,

483 
n
,

484 cÚ¡ *
x
,

485 
šcx
,

486 cÚ¡ *
y
,

487 
šcy
,

488 *
»suÉ
);

490 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCdÙu_v2
 (
cubÏsHªdË_t
 
hªdË
,

491 
n
,

492 cÚ¡ 
cuCom¶ex
 *
x
,

493 
šcx
,

494 cÚ¡ 
cuCom¶ex
 *
y
,

495 
šcy
,

496 
cuCom¶ex
 *
»suÉ
);

498 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCdÙc_v2
 (
cubÏsHªdË_t
 
hªdË
,

499 
n
,

500 cÚ¡ 
cuCom¶ex
 *
x
,

501 
šcx
,

502 cÚ¡ 
cuCom¶ex
 *
y
,

503 
šcy
,

504 
cuCom¶ex
 *
»suÉ
);

506 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZdÙu_v2
 (
cubÏsHªdË_t
 
hªdË
,

507 
n
,

508 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

509 
šcx
,

510 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

511 
šcy
,

512 
cuDoubËCom¶ex
 *
»suÉ
);

514 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZdÙc_v2
 (
cubÏsHªdË_t
 
hªdË
,

515 
n
,

516 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

517 
šcx
,

518 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

519 
šcy
,

520 
cuDoubËCom¶ex
 *
»suÉ
);

522 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSÿlEx
(
cubÏsHªdË_t
 
hªdË
,

523 
n
,

524 cÚ¡ *
®pha
,

525 
cudaD©aTy³
 
®phaTy³
,

526 *
x
,

527 
cudaD©aTy³
 
xTy³
,

528 
šcx
,

529 
cudaD©aTy³
 
executiÚTy³
);

531 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsÿl_v2
(
cubÏsHªdË_t
 
hªdË
,

532 
n
,

533 cÚ¡ *
®pha
,

534 *
x
,

535 
šcx
);

537 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsÿl_v2
(
cubÏsHªdË_t
 
hªdË
,

538 
n
,

539 cÚ¡ *
®pha
,

540 *
x
,

541 
šcx
);

543 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsÿl_v2
(
cubÏsHªdË_t
 
hªdË
,

544 
n
,

545 cÚ¡ 
cuCom¶ex
 *
®pha
,

546 
cuCom¶ex
 *
x
,

547 
šcx
);

549 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCssÿl_v2
(
cubÏsHªdË_t
 
hªdË
,

550 
n
,

551 cÚ¡ *
®pha
,

552 
cuCom¶ex
 *
x
,

553 
šcx
);

555 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsÿl_v2
(
cubÏsHªdË_t
 
hªdË
,

556 
n
,

557 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

558 
cuDoubËCom¶ex
 *
x
,

559 
šcx
);

561 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZdsÿl_v2
(
cubÏsHªdË_t
 
hªdË
,

562 
n
,

563 cÚ¡ *
®pha
,

564 
cuDoubËCom¶ex
 *
x
,

565 
šcx
);

567 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsAxpyEx
 (
cubÏsHªdË_t
 
hªdË
,

568 
n
,

569 cÚ¡ *
®pha
,

570 
cudaD©aTy³
 
®phaTy³
,

571 cÚ¡ *
x
,

572 
cudaD©aTy³
 
xTy³
,

573 
šcx
,

574 *
y
,

575 
cudaD©aTy³
 
yTy³
,

576 
šcy
,

577 
cudaD©aTy³
 
executiÚty³
);

579 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSaxpy_v2
 (
cubÏsHªdË_t
 
hªdË
,

580 
n
,

581 cÚ¡ *
®pha
,

582 cÚ¡ *
x
,

583 
šcx
,

584 *
y
,

585 
šcy
);

587 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDaxpy_v2
 (
cubÏsHªdË_t
 
hªdË
,

588 
n
,

589 cÚ¡ *
®pha
,

590 cÚ¡ *
x
,

591 
šcx
,

592 *
y
,

593 
šcy
);

595 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCaxpy_v2
 (
cubÏsHªdË_t
 
hªdË
,

596 
n
,

597 cÚ¡ 
cuCom¶ex
 *
®pha
,

598 cÚ¡ 
cuCom¶ex
 *
x
,

599 
šcx
,

600 
cuCom¶ex
 *
y
,

601 
šcy
);

603 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZaxpy_v2
 (
cubÏsHªdË_t
 
hªdË
,

604 
n
,

605 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

606 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

607 
šcx
,

608 
cuDoubËCom¶ex
 *
y
,

609 
šcy
);

611 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCİyEx
 (
cubÏsHªdË_t
 
hªdË
,

612 
n
,

613 cÚ¡ *
x
,

614 
cudaD©aTy³
 
xTy³
,

615 
šcx
,

616 *
y
,

617 
cudaD©aTy³
 
yTy³
,

618 
šcy
);

620 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsScİy_v2
 (
cubÏsHªdË_t
 
hªdË
,

621 
n
,

622 cÚ¡ *
x
,

623 
šcx
,

624 *
y
,

625 
šcy
);

627 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDcİy_v2
 (
cubÏsHªdË_t
 
hªdË
,

628 
n
,

629 cÚ¡ *
x
,

630 
šcx
,

631 *
y
,

632 
šcy
);

634 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCcİy_v2
 (
cubÏsHªdË_t
 
hªdË
,

635 
n
,

636 cÚ¡ 
cuCom¶ex
 *
x
,

637 
šcx
,

638 
cuCom¶ex
 *
y
,

639 
šcy
);

641 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZcİy_v2
 (
cubÏsHªdË_t
 
hªdË
,

642 
n
,

643 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

644 
šcx
,

645 
cuDoubËCom¶ex
 *
y
,

646 
šcy
);

648 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsw­_v2
 (
cubÏsHªdË_t
 
hªdË
,

649 
n
,

650 *
x
,

651 
šcx
,

652 *
y
,

653 
šcy
);

655 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsw­_v2
 (
cubÏsHªdË_t
 
hªdË
,

656 
n
,

657 *
x
,

658 
šcx
,

659 *
y
,

660 
šcy
);

662 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsw­_v2
 (
cubÏsHªdË_t
 
hªdË
,

663 
n
,

664 
cuCom¶ex
 *
x
,

665 
šcx
,

666 
cuCom¶ex
 *
y
,

667 
šcy
);

669 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsw­_v2
 (
cubÏsHªdË_t
 
hªdË
,

670 
n
,

671 
cuDoubËCom¶ex
 *
x
,

672 
šcx
,

673 
cuDoubËCom¶ex
 *
y
,

674 
šcy
);

676 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSw­Ex
 (
cubÏsHªdË_t
 
hªdË
,

677 
n
,

678 *
x
,

679 
cudaD©aTy³
 
xTy³
,

680 
šcx
,

681 *
y
,

682 
cudaD©aTy³
 
yTy³
,

683 
šcy
);

685 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsI§max_v2
(
cubÏsHªdË_t
 
hªdË
,

686 
n
,

687 cÚ¡ *
x
,

688 
šcx
,

689 *
»suÉ
);

691 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIdamax_v2
(
cubÏsHªdË_t
 
hªdË
,

692 
n
,

693 cÚ¡ *
x
,

694 
šcx
,

695 *
»suÉ
);

697 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIÿmax_v2
(
cubÏsHªdË_t
 
hªdË
,

698 
n
,

699 cÚ¡ 
cuCom¶ex
 *
x
,

700 
šcx
,

701 *
»suÉ
);

703 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIzamax_v2
(
cubÏsHªdË_t
 
hªdË
,

704 
n
,

705 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

706 
šcx
,

707 *
»suÉ
);

709 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIamaxEx
(
cubÏsHªdË_t
 
hªdË
,

710 
n
,

711 cÚ¡ *
x
, 
cudaD©aTy³
 
xTy³
,

712 
šcx
,

713 *
»suÉ


717 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsI§mš_v2
(
cubÏsHªdË_t
 
hªdË
,

718 
n
,

719 cÚ¡ *
x
,

720 
šcx
,

721 *
»suÉ
);

723 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIdamš_v2
(
cubÏsHªdË_t
 
hªdË
,

724 
n
,

725 cÚ¡ *
x
,

726 
šcx
,

727 *
»suÉ
);

729 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIÿmš_v2
(
cubÏsHªdË_t
 
hªdË
,

730 
n
,

731 cÚ¡ 
cuCom¶ex
 *
x
,

732 
šcx
,

733 *
»suÉ
);

735 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIzamš_v2
(
cubÏsHªdË_t
 
hªdË
,

736 
n
,

737 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

738 
šcx
,

739 *
»suÉ
);

741 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsIamšEx
(
cubÏsHªdË_t
 
hªdË
,

742 
n
,

743 cÚ¡ *
x
, 
cudaD©aTy³
 
xTy³
,

744 
šcx
,

745 *
»suÉ


748 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsAsumEx
(
cubÏsHªdË_t
 
hªdË
,

749 
n
,

750 cÚ¡ *
x
,

751 
cudaD©aTy³
 
xTy³
,

752 
šcx
,

753 *
»suÉ
,

754 
cudaD©aTy³
 
»suÉTy³
,

755 
cudaD©aTy³
 
executiÚty³


758 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSasum_v2
(
cubÏsHªdË_t
 
hªdË
,

759 
n
,

760 cÚ¡ *
x
,

761 
šcx
,

762 *
»suÉ
);

764 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDasum_v2
(
cubÏsHªdË_t
 
hªdË
,

765 
n
,

766 cÚ¡ *
x
,

767 
šcx
,

768 *
»suÉ
);

770 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSÿsum_v2
(
cubÏsHªdË_t
 
hªdË
,

771 
n
,

772 cÚ¡ 
cuCom¶ex
 *
x
,

773 
šcx
,

774 *
»suÉ
);

776 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDzasum_v2
(
cubÏsHªdË_t
 
hªdË
,

777 
n
,

778 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

779 
šcx
,

780 *
»suÉ
);

782 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSrÙ_v2
 (
cubÏsHªdË_t
 
hªdË
,

783 
n
,

784 *
x
,

785 
šcx
,

786 *
y
,

787 
šcy
,

788 cÚ¡ *
c
,

789 cÚ¡ *
s
);

791 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDrÙ_v2
 (
cubÏsHªdË_t
 
hªdË
,

792 
n
,

793 *
x
,

794 
šcx
,

795 *
y
,

796 
šcy
,

797 cÚ¡ *
c
,

798 cÚ¡ *
s
);

800 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCrÙ_v2
 (
cubÏsHªdË_t
 
hªdË
,

801 
n
,

802 
cuCom¶ex
 *
x
,

803 
šcx
,

804 
cuCom¶ex
 *
y
,

805 
šcy
,

806 cÚ¡ *
c
,

807 cÚ¡ 
cuCom¶ex
 *
s
);

809 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsC¤Ù_v2
(
cubÏsHªdË_t
 
hªdË
,

810 
n
,

811 
cuCom¶ex
 *
x
,

812 
šcx
,

813 
cuCom¶ex
 *
y
,

814 
šcy
,

815 cÚ¡ *
c
,

816 cÚ¡ *
s
);

818 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZrÙ_v2
 (
cubÏsHªdË_t
 
hªdË
,

819 
n
,

820 
cuDoubËCom¶ex
 *
x
,

821 
šcx
,

822 
cuDoubËCom¶ex
 *
y
,

823 
šcy
,

824 cÚ¡ *
c
,

825 cÚ¡ 
cuDoubËCom¶ex
 *
s
);

827 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZdrÙ_v2
(
cubÏsHªdË_t
 
hªdË
,

828 
n
,

829 
cuDoubËCom¶ex
 *
x
,

830 
šcx
,

831 
cuDoubËCom¶ex
 *
y
,

832 
šcy
,

833 cÚ¡ *
c
,

834 cÚ¡ *
s
);

836 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsRÙEx
 (
cubÏsHªdË_t
 
hªdË
,

837 
n
,

838 *
x
,

839 
cudaD©aTy³
 
xTy³
,

840 
šcx
,

841 *
y
,

842 
cudaD©aTy³
 
yTy³
,

843 
šcy
,

844 cÚ¡ *
c
,

845 cÚ¡ *
s
,

846 
cudaD©aTy³
 
csTy³
,

847 
cudaD©aTy³
 
executiÚty³
);

850 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSrÙg_v2
(
cubÏsHªdË_t
 
hªdË
,

851 *
a
,

852 *
b
,

853 *
c
,

854 *
s
);

856 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDrÙg_v2
(
cubÏsHªdË_t
 
hªdË
,

857 *
a
,

858 *
b
,

859 *
c
,

860 *
s
);

862 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCrÙg_v2
(
cubÏsHªdË_t
 
hªdË
,

863 
cuCom¶ex
 *
a
,

864 
cuCom¶ex
 *
b
,

865 *
c
,

866 
cuCom¶ex
 *
s
);

868 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZrÙg_v2
(
cubÏsHªdË_t
 
hªdË
,

869 
cuDoubËCom¶ex
 *
a
,

870 
cuDoubËCom¶ex
 *
b
,

871 *
c
,

872 
cuDoubËCom¶ex
 *
s
);

874 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsRÙgEx
(
cubÏsHªdË_t
 
hªdË
,

875 *
a
,

876 *
b
,

877 
cudaD©aTy³
 
abTy³
,

878 *
c
,

879 *
s
,

880 
cudaD©aTy³
 
csTy³
,

881 
cudaD©aTy³
 
executiÚty³
);

883 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSrÙm_v2
(
cubÏsHªdË_t
 
hªdË
,

884 
n
,

885 *
x
,

886 
šcx
,

887 *
y
,

888 
šcy
,

889 cÚ¡ * 
·¿m
);

891 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDrÙm_v2
(
cubÏsHªdË_t
 
hªdË
,

892 
n
,

893 *
x
,

894 
šcx
,

895 *
y
,

896 
šcy
,

897 cÚ¡ * 
·¿m
);

899 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsRÙmEx
(
cubÏsHªdË_t
 
hªdË
,

900 
n
,

901 *
x
,

902 
cudaD©aTy³
 
xTy³
,

903 
šcx
,

904 *
y
,

905 
cudaD©aTy³
 
yTy³
,

906 
šcy
,

907 cÚ¡ * 
·¿m
,

908 
cudaD©aTy³
 
·¿mTy³
,

909 
cudaD©aTy³
 
executiÚty³
);

911 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSrÙmg_v2
(
cubÏsHªdË_t
 
hªdË
,

912 *
d1
,

913 *
d2
,

914 *
x1
,

915 cÚ¡ *
y1
,

916 *
·¿m
);

918 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDrÙmg_v2
(
cubÏsHªdË_t
 
hªdË
,

919 *
d1
,

920 *
d2
,

921 *
x1
,

922 cÚ¡ *
y1
,

923 *
·¿m
);

925 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsRÙmgEx
(
cubÏsHªdË_t
 
hªdË
,

926 *
d1
,

927 
cudaD©aTy³
 
d1Ty³
,

928 *
d2
,

929 
cudaD©aTy³
 
d2Ty³
,

930 *
x1
,

931 
cudaD©aTy³
 
x1Ty³
,

932 cÚ¡ *
y1
,

933 
cudaD©aTy³
 
y1Ty³
,

934 *
·¿m
,

935 
cudaD©aTy³
 
·¿mTy³
,

936 
cudaD©aTy³
 
executiÚty³


941 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgemv_v2
 (
cubÏsHªdË_t
 
hªdË
,

942 
cubÏsO³¿tiÚ_t
 
Œªs
,

943 
m
,

944 
n
,

945 cÚ¡ *
®pha
,

946 cÚ¡ *
A
,

947 
lda
,

948 cÚ¡ *
x
,

949 
šcx
,

950 cÚ¡ *
b‘a
,

951 *
y
,

952 
šcy
);

954 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDgemv_v2
 (
cubÏsHªdË_t
 
hªdË
,

955 
cubÏsO³¿tiÚ_t
 
Œªs
,

956 
m
,

957 
n
,

958 cÚ¡ *
®pha
,

959 cÚ¡ *
A
,

960 
lda
,

961 cÚ¡ *
x
,

962 
šcx
,

963 cÚ¡ *
b‘a
,

964 *
y
,

965 
šcy
);

967 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemv_v2
 (
cubÏsHªdË_t
 
hªdË
,

968 
cubÏsO³¿tiÚ_t
 
Œªs
,

969 
m
,

970 
n
,

971 cÚ¡ 
cuCom¶ex
 *
®pha
,

972 cÚ¡ 
cuCom¶ex
 *
A
,

973 
lda
,

974 cÚ¡ 
cuCom¶ex
 *
x
,

975 
šcx
,

976 cÚ¡ 
cuCom¶ex
 *
b‘a
,

977 
cuCom¶ex
 *
y
,

978 
šcy
);

980 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgemv_v2
 (
cubÏsHªdË_t
 
hªdË
,

981 
cubÏsO³¿tiÚ_t
 
Œªs
,

982 
m
,

983 
n
,

984 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

985 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

986 
lda
,

987 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

988 
šcx
,

989 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

990 
cuDoubËCom¶ex
 *
y
,

991 
šcy
);

993 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

994 
cubÏsO³¿tiÚ_t
 
Œªs
,

995 
m
,

996 
n
,

997 
kl
,

998 
ku
,

999 cÚ¡ *
®pha
,

1000 cÚ¡ *
A
,

1001 
lda
,

1002 cÚ¡ *
x
,

1003 
šcx
,

1004 cÚ¡ *
b‘a
,

1005 *
y
,

1006 
šcy
);

1008 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDgbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1009 
cubÏsO³¿tiÚ_t
 
Œªs
,

1010 
m
,

1011 
n
,

1012 
kl
,

1013 
ku
,

1014 cÚ¡ *
®pha
,

1015 cÚ¡ *
A
,

1016 
lda
,

1017 cÚ¡ *
x
,

1018 
šcx
,

1019 cÚ¡ *
b‘a
,

1020 *
y
,

1021 
šcy
);

1023 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1024 
cubÏsO³¿tiÚ_t
 
Œªs
,

1025 
m
,

1026 
n
,

1027 
kl
,

1028 
ku
,

1029 cÚ¡ 
cuCom¶ex
 *
®pha
,

1030 cÚ¡ 
cuCom¶ex
 *
A
,

1031 
lda
,

1032 cÚ¡ 
cuCom¶ex
 *
x
,

1033 
šcx
,

1034 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1035 
cuCom¶ex
 *
y
,

1036 
šcy
);

1038 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1039 
cubÏsO³¿tiÚ_t
 
Œªs
,

1040 
m
,

1041 
n
,

1042 
kl
,

1043 
ku
,

1044 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1045 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1046 
lda
,

1047 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1048 
šcx
,

1049 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1050 
cuDoubËCom¶ex
 *
y
,

1051 
šcy
);

1054 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSŒmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1055 
cubÏsFlMode_t
 
u¶o
,

1056 
cubÏsO³¿tiÚ_t
 
Œªs
,

1057 
cubÏsDŸgTy³_t
 
dŸg
,

1058 
n
,

1059 cÚ¡ *
A
,

1060 
lda
,

1061 *
x
,

1062 
šcx
);

1064 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDŒmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1065 
cubÏsFlMode_t
 
u¶o
,

1066 
cubÏsO³¿tiÚ_t
 
Œªs
,

1067 
cubÏsDŸgTy³_t
 
dŸg
,

1068 
n
,

1069 cÚ¡ *
A
,

1070 
lda
,

1071 *
x
,

1072 
šcx
);

1074 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCŒmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1075 
cubÏsFlMode_t
 
u¶o
,

1076 
cubÏsO³¿tiÚ_t
 
Œªs
,

1077 
cubÏsDŸgTy³_t
 
dŸg
,

1078 
n
,

1079 cÚ¡ 
cuCom¶ex
 *
A
,

1080 
lda
,

1081 
cuCom¶ex
 *
x
,

1082 
šcx
);

1084 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZŒmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1085 
cubÏsFlMode_t
 
u¶o
,

1086 
cubÏsO³¿tiÚ_t
 
Œªs
,

1087 
cubÏsDŸgTy³_t
 
dŸg
,

1088 
n
,

1089 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1090 
lda
,

1091 
cuDoubËCom¶ex
 *
x
,

1092 
šcx
);

1095 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsStbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1096 
cubÏsFlMode_t
 
u¶o
,

1097 
cubÏsO³¿tiÚ_t
 
Œªs
,

1098 
cubÏsDŸgTy³_t
 
dŸg
,

1099 
n
,

1100 
k
,

1101 cÚ¡ *
A
,

1102 
lda
,

1103 *
x
,

1104 
šcx
);

1106 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDtbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1107 
cubÏsFlMode_t
 
u¶o
,

1108 
cubÏsO³¿tiÚ_t
 
Œªs
,

1109 
cubÏsDŸgTy³_t
 
dŸg
,

1110 
n
,

1111 
k
,

1112 cÚ¡ *
A
,

1113 
lda
,

1114 *
x
,

1115 
šcx
);

1117 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCtbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1118 
cubÏsFlMode_t
 
u¶o
,

1119 
cubÏsO³¿tiÚ_t
 
Œªs
,

1120 
cubÏsDŸgTy³_t
 
dŸg
,

1121 
n
,

1122 
k
,

1123 cÚ¡ 
cuCom¶ex
 *
A
,

1124 
lda
,

1125 
cuCom¶ex
 *
x
,

1126 
šcx
);

1128 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZtbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1129 
cubÏsFlMode_t
 
u¶o
,

1130 
cubÏsO³¿tiÚ_t
 
Œªs
,

1131 
cubÏsDŸgTy³_t
 
dŸg
,

1132 
n
,

1133 
k
,

1134 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1135 
lda
,

1136 
cuDoubËCom¶ex
 *
x
,

1137 
šcx
);

1140 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1141 
cubÏsFlMode_t
 
u¶o
,

1142 
cubÏsO³¿tiÚ_t
 
Œªs
,

1143 
cubÏsDŸgTy³_t
 
dŸg
,

1144 
n
,

1145 cÚ¡ *
AP
,

1146 *
x
,

1147 
šcx
);

1149 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1150 
cubÏsFlMode_t
 
u¶o
,

1151 
cubÏsO³¿tiÚ_t
 
Œªs
,

1152 
cubÏsDŸgTy³_t
 
dŸg
,

1153 
n
,

1154 cÚ¡ *
AP
,

1155 *
x
,

1156 
šcx
);

1158 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1159 
cubÏsFlMode_t
 
u¶o
,

1160 
cubÏsO³¿tiÚ_t
 
Œªs
,

1161 
cubÏsDŸgTy³_t
 
dŸg
,

1162 
n
,

1163 cÚ¡ 
cuCom¶ex
 *
AP
,

1164 
cuCom¶ex
 *
x
,

1165 
šcx
);

1167 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1168 
cubÏsFlMode_t
 
u¶o
,

1169 
cubÏsO³¿tiÚ_t
 
Œªs
,

1170 
cubÏsDŸgTy³_t
 
dŸg
,

1171 
n
,

1172 cÚ¡ 
cuDoubËCom¶ex
 *
AP
,

1173 
cuDoubËCom¶ex
 *
x
,

1174 
šcx
);

1177 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSŒsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1178 
cubÏsFlMode_t
 
u¶o
,

1179 
cubÏsO³¿tiÚ_t
 
Œªs
,

1180 
cubÏsDŸgTy³_t
 
dŸg
,

1181 
n
,

1182 cÚ¡ *
A
,

1183 
lda
,

1184 *
x
,

1185 
šcx
);

1187 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDŒsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1188 
cubÏsFlMode_t
 
u¶o
,

1189 
cubÏsO³¿tiÚ_t
 
Œªs
,

1190 
cubÏsDŸgTy³_t
 
dŸg
,

1191 
n
,

1192 cÚ¡ *
A
,

1193 
lda
,

1194 *
x
,

1195 
šcx
);

1197 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCŒsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1198 
cubÏsFlMode_t
 
u¶o
,

1199 
cubÏsO³¿tiÚ_t
 
Œªs
,

1200 
cubÏsDŸgTy³_t
 
dŸg
,

1201 
n
,

1202 cÚ¡ 
cuCom¶ex
 *
A
,

1203 
lda
,

1204 
cuCom¶ex
 *
x
,

1205 
šcx
);

1207 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZŒsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1208 
cubÏsFlMode_t
 
u¶o
,

1209 
cubÏsO³¿tiÚ_t
 
Œªs
,

1210 
cubÏsDŸgTy³_t
 
dŸg
,

1211 
n
,

1212 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1213 
lda
,

1214 
cuDoubËCom¶ex
 *
x
,

1215 
šcx
);

1218 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1219 
cubÏsFlMode_t
 
u¶o
,

1220 
cubÏsO³¿tiÚ_t
 
Œªs
,

1221 
cubÏsDŸgTy³_t
 
dŸg
,

1222 
n
,

1223 cÚ¡ *
AP
,

1224 *
x
,

1225 
šcx
);

1227 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1228 
cubÏsFlMode_t
 
u¶o
,

1229 
cubÏsO³¿tiÚ_t
 
Œªs
,

1230 
cubÏsDŸgTy³_t
 
dŸg
,

1231 
n
,

1232 cÚ¡ *
AP
,

1233 *
x
,

1234 
šcx
);

1236 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1237 
cubÏsFlMode_t
 
u¶o
,

1238 
cubÏsO³¿tiÚ_t
 
Œªs
,

1239 
cubÏsDŸgTy³_t
 
dŸg
,

1240 
n
,

1241 cÚ¡ 
cuCom¶ex
 *
AP
,

1242 
cuCom¶ex
 *
x
,

1243 
šcx
);

1245 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1246 
cubÏsFlMode_t
 
u¶o
,

1247 
cubÏsO³¿tiÚ_t
 
Œªs
,

1248 
cubÏsDŸgTy³_t
 
dŸg
,

1249 
n
,

1250 cÚ¡ 
cuDoubËCom¶ex
 *
AP
,

1251 
cuDoubËCom¶ex
 *
x
,

1252 
šcx
);

1254 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsStbsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1255 
cubÏsFlMode_t
 
u¶o
,

1256 
cubÏsO³¿tiÚ_t
 
Œªs
,

1257 
cubÏsDŸgTy³_t
 
dŸg
,

1258 
n
,

1259 
k
,

1260 cÚ¡ *
A
,

1261 
lda
,

1262 *
x
,

1263 
šcx
);

1265 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDtbsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1266 
cubÏsFlMode_t
 
u¶o
,

1267 
cubÏsO³¿tiÚ_t
 
Œªs
,

1268 
cubÏsDŸgTy³_t
 
dŸg
,

1269 
n
,

1270 
k
,

1271 cÚ¡ *
A
,

1272 
lda
,

1273 *
x
,

1274 
šcx
);

1276 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCtbsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1277 
cubÏsFlMode_t
 
u¶o
,

1278 
cubÏsO³¿tiÚ_t
 
Œªs
,

1279 
cubÏsDŸgTy³_t
 
dŸg
,

1280 
n
,

1281 
k
,

1282 cÚ¡ 
cuCom¶ex
 *
A
,

1283 
lda
,

1284 
cuCom¶ex
 *
x
,

1285 
šcx
);

1287 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZtbsv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1288 
cubÏsFlMode_t
 
u¶o
,

1289 
cubÏsO³¿tiÚ_t
 
Œªs
,

1290 
cubÏsDŸgTy³_t
 
dŸg
,

1291 
n
,

1292 
k
,

1293 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1294 
lda
,

1295 
cuDoubËCom¶ex
 *
x
,

1296 
šcx
);

1299 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsymv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1300 
cubÏsFlMode_t
 
u¶o
,

1301 
n
,

1302 cÚ¡ *
®pha
,

1303 cÚ¡ *
A
,

1304 
lda
,

1305 cÚ¡ *
x
,

1306 
šcx
,

1307 cÚ¡ *
b‘a
,

1308 *
y
,

1309 
šcy
);

1311 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsymv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1312 
cubÏsFlMode_t
 
u¶o
,

1313 
n
,

1314 cÚ¡ *
®pha
,

1315 cÚ¡ *
A
,

1316 
lda
,

1317 cÚ¡ *
x
,

1318 
šcx
,

1319 cÚ¡ *
b‘a
,

1320 *
y
,

1321 
šcy
);

1323 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsymv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1324 
cubÏsFlMode_t
 
u¶o
,

1325 
n
,

1326 cÚ¡ 
cuCom¶ex
 *
®pha
,

1327 cÚ¡ 
cuCom¶ex
 *
A
,

1328 
lda
,

1329 cÚ¡ 
cuCom¶ex
 *
x
,

1330 
šcx
,

1331 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1332 
cuCom¶ex
 *
y
,

1333 
šcy
);

1335 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsymv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1336 
cubÏsFlMode_t
 
u¶o
,

1337 
n
,

1338 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1339 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1340 
lda
,

1341 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1342 
šcx
,

1343 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1344 
cuDoubËCom¶ex
 *
y
,

1345 
šcy
);

1347 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsChemv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1348 
cubÏsFlMode_t
 
u¶o
,

1349 
n
,

1350 cÚ¡ 
cuCom¶ex
 *
®pha
,

1351 cÚ¡ 
cuCom¶ex
 *
A
,

1352 
lda
,

1353 cÚ¡ 
cuCom¶ex
 *
x
,

1354 
šcx
,

1355 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1356 
cuCom¶ex
 *
y
,

1357 
šcy
);

1359 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZhemv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1360 
cubÏsFlMode_t
 
u¶o
,

1361 
n
,

1362 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1363 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1364 
lda
,

1365 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1366 
šcx
,

1367 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1368 
cuDoubËCom¶ex
 *
y
,

1369 
šcy
);

1372 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1373 
cubÏsFlMode_t
 
u¶o
,

1374 
n
,

1375 
k
,

1376 cÚ¡ *
®pha
,

1377 cÚ¡ *
A
,

1378 
lda
,

1379 cÚ¡ *
x
,

1380 
šcx
,

1381 cÚ¡ *
b‘a
,

1382 *
y
,

1383 
šcy
);

1385 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1386 
cubÏsFlMode_t
 
u¶o
,

1387 
n
,

1388 
k
,

1389 cÚ¡ *
®pha
,

1390 cÚ¡ *
A
,

1391 
lda
,

1392 cÚ¡ *
x
,

1393 
šcx
,

1394 cÚ¡ *
b‘a
,

1395 *
y
,

1396 
šcy
);

1398 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsChbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1399 
cubÏsFlMode_t
 
u¶o
,

1400 
n
,

1401 
k
,

1402 cÚ¡ 
cuCom¶ex
 *
®pha
,

1403 cÚ¡ 
cuCom¶ex
 *
A
,

1404 
lda
,

1405 cÚ¡ 
cuCom¶ex
 *
x
,

1406 
šcx
,

1407 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1408 
cuCom¶ex
 *
y
,

1409 
šcy
);

1411 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZhbmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1412 
cubÏsFlMode_t
 
u¶o
,

1413 
n
,

1414 
k
,

1415 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1416 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1417 
lda
,

1418 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1419 
šcx
,

1420 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1421 
cuDoubËCom¶ex
 *
y
,

1422 
šcy
);

1425 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS¥mv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1426 
cubÏsFlMode_t
 
u¶o
,

1427 
n
,

1428 cÚ¡ *
®pha
,

1429 cÚ¡ *
AP
,

1430 cÚ¡ *
x
,

1431 
šcx
,

1432 cÚ¡ *
b‘a
,

1433 *
y
,

1434 
šcy
);

1436 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsD¥mv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1437 
cubÏsFlMode_t
 
u¶o
,

1438 
n
,

1439 cÚ¡ *
®pha
,

1440 cÚ¡ *
AP
,

1441 cÚ¡ *
x
,

1442 
šcx
,

1443 cÚ¡ *
b‘a
,

1444 *
y
,

1445 
šcy
);

1447 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsChpmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1448 
cubÏsFlMode_t
 
u¶o
,

1449 
n
,

1450 cÚ¡ 
cuCom¶ex
 *
®pha
,

1451 cÚ¡ 
cuCom¶ex
 *
AP
,

1452 cÚ¡ 
cuCom¶ex
 *
x
,

1453 
šcx
,

1454 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1455 
cuCom¶ex
 *
y
,

1456 
šcy
);

1458 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZhpmv_v2
 (
cubÏsHªdË_t
 
hªdË
,

1459 
cubÏsFlMode_t
 
u¶o
,

1460 
n
,

1461 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1462 cÚ¡ 
cuDoubËCom¶ex
 *
AP
,

1463 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1464 
šcx
,

1465 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1466 
cuDoubËCom¶ex
 *
y
,

1467 
šcy
);

1470 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSg”_v2
 (
cubÏsHªdË_t
 
hªdË
,

1471 
m
,

1472 
n
,

1473 cÚ¡ *
®pha
,

1474 cÚ¡ *
x
,

1475 
šcx
,

1476 cÚ¡ *
y
,

1477 
šcy
,

1478 *
A
,

1479 
lda
);

1481 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDg”_v2
 (
cubÏsHªdË_t
 
hªdË
,

1482 
m
,

1483 
n
,

1484 cÚ¡ *
®pha
,

1485 cÚ¡ *
x
,

1486 
šcx
,

1487 cÚ¡ *
y
,

1488 
šcy
,

1489 *
A
,

1490 
lda
);

1492 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg”u_v2
 (
cubÏsHªdË_t
 
hªdË
,

1493 
m
,

1494 
n
,

1495 cÚ¡ 
cuCom¶ex
 *
®pha
,

1496 cÚ¡ 
cuCom¶ex
 *
x
,

1497 
šcx
,

1498 cÚ¡ 
cuCom¶ex
 *
y
,

1499 
šcy
,

1500 
cuCom¶ex
 *
A
,

1501 
lda
);

1503 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg”c_v2
 (
cubÏsHªdË_t
 
hªdË
,

1504 
m
,

1505 
n
,

1506 cÚ¡ 
cuCom¶ex
 *
®pha
,

1507 cÚ¡ 
cuCom¶ex
 *
x
,

1508 
šcx
,

1509 cÚ¡ 
cuCom¶ex
 *
y
,

1510 
šcy
,

1511 
cuCom¶ex
 *
A
,

1512 
lda
);

1514 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg”u_v2
 (
cubÏsHªdË_t
 
hªdË
,

1515 
m
,

1516 
n
,

1517 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1518 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1519 
šcx
,

1520 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

1521 
šcy
,

1522 
cuDoubËCom¶ex
 *
A
,

1523 
lda
);

1525 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg”c_v2
 (
cubÏsHªdË_t
 
hªdË
,

1526 
m
,

1527 
n
,

1528 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1529 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1530 
šcx
,

1531 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

1532 
šcy
,

1533 
cuDoubËCom¶ex
 *
A
,

1534 
lda
);

1537 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsyr_v2
 (
cubÏsHªdË_t
 
hªdË
,

1538 
cubÏsFlMode_t
 
u¶o
,

1539 
n
,

1540 cÚ¡ *
®pha
,

1541 cÚ¡ *
x
,

1542 
šcx
,

1543 *
A
,

1544 
lda
);

1546 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsyr_v2
 (
cubÏsHªdË_t
 
hªdË
,

1547 
cubÏsFlMode_t
 
u¶o
,

1548 
n
,

1549 cÚ¡ *
®pha
,

1550 cÚ¡ *
x
,

1551 
šcx
,

1552 *
A
,

1553 
lda
);

1555 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyr_v2
 (
cubÏsHªdË_t
 
hªdË
,

1556 
cubÏsFlMode_t
 
u¶o
,

1557 
n
,

1558 cÚ¡ 
cuCom¶ex
 *
®pha
,

1559 cÚ¡ 
cuCom¶ex
 *
x
,

1560 
šcx
,

1561 
cuCom¶ex
 *
A
,

1562 
lda
);

1564 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsyr_v2
 (
cubÏsHªdË_t
 
hªdË
,

1565 
cubÏsFlMode_t
 
u¶o
,

1566 
n
,

1567 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1568 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1569 
šcx
,

1570 
cuDoubËCom¶ex
 *
A
,

1571 
lda
);

1573 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”_v2
 (
cubÏsHªdË_t
 
hªdË
,

1574 
cubÏsFlMode_t
 
u¶o
,

1575 
n
,

1576 cÚ¡ *
®pha
,

1577 cÚ¡ 
cuCom¶ex
 *
x
,

1578 
šcx
,

1579 
cuCom¶ex
 *
A
,

1580 
lda
);

1582 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh”_v2
 (
cubÏsHªdË_t
 
hªdË
,

1583 
cubÏsFlMode_t
 
u¶o
,

1584 
n
,

1585 cÚ¡ *
®pha
,

1586 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1587 
šcx
,

1588 
cuDoubËCom¶ex
 *
A
,

1589 
lda
);

1592 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS¥r_v2
 (
cubÏsHªdË_t
 
hªdË
,

1593 
cubÏsFlMode_t
 
u¶o
,

1594 
n
,

1595 cÚ¡ *
®pha
,

1596 cÚ¡ *
x
,

1597 
šcx
,

1598 *
AP
);

1600 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsD¥r_v2
 (
cubÏsHªdË_t
 
hªdË
,

1601 
cubÏsFlMode_t
 
u¶o
,

1602 
n
,

1603 cÚ¡ *
®pha
,

1604 cÚ¡ *
x
,

1605 
šcx
,

1606 *
AP
);

1608 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh´_v2
 (
cubÏsHªdË_t
 
hªdË
,

1609 
cubÏsFlMode_t
 
u¶o
,

1610 
n
,

1611 cÚ¡ *
®pha
,

1612 cÚ¡ 
cuCom¶ex
 *
x
,

1613 
šcx
,

1614 
cuCom¶ex
 *
AP
);

1616 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh´_v2
 (
cubÏsHªdË_t
 
hªdË
,

1617 
cubÏsFlMode_t
 
u¶o
,

1618 
n
,

1619 cÚ¡ *
®pha
,

1620 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1621 
šcx
,

1622 
cuDoubËCom¶ex
 *
AP
);

1625 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsyr2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1626 
cubÏsFlMode_t
 
u¶o
,

1627 
n
,

1628 cÚ¡ *
®pha
,

1629 cÚ¡ *
x
,

1630 
šcx
,

1631 cÚ¡ *
y
,

1632 
šcy
,

1633 *
A
,

1634 
lda
);

1636 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsyr2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1637 
cubÏsFlMode_t
 
u¶o
,

1638 
n
,

1639 cÚ¡ *
®pha
,

1640 cÚ¡ *
x
,

1641 
šcx
,

1642 cÚ¡ *
y
,

1643 
šcy
,

1644 *
A
,

1645 
lda
);

1647 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyr2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1648 
cubÏsFlMode_t
 
u¶o
, 
n
,

1649 cÚ¡ 
cuCom¶ex
 *
®pha
,

1650 cÚ¡ 
cuCom¶ex
 *
x
,

1651 
šcx
,

1652 cÚ¡ 
cuCom¶ex
 *
y
,

1653 
šcy
,

1654 
cuCom¶ex
 *
A
,

1655 
lda
);

1657 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsyr2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1658 
cubÏsFlMode_t
 
u¶o
,

1659 
n
,

1660 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1661 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1662 
šcx
,

1663 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

1664 
šcy
,

1665 
cuDoubËCom¶ex
 *
A
,

1666 
lda
);

1669 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1670 
cubÏsFlMode_t
 
u¶o
, 
n
,

1671 cÚ¡ 
cuCom¶ex
 *
®pha
,

1672 cÚ¡ 
cuCom¶ex
 *
x
,

1673 
šcx
,

1674 cÚ¡ 
cuCom¶ex
 *
y
,

1675 
šcy
,

1676 
cuCom¶ex
 *
A
,

1677 
lda
);

1679 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh”2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1680 
cubÏsFlMode_t
 
u¶o
,

1681 
n
,

1682 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1683 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1684 
šcx
,

1685 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

1686 
šcy
,

1687 
cuDoubËCom¶ex
 *
A
,

1688 
lda
);

1691 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS¥r2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1692 
cubÏsFlMode_t
 
u¶o
,

1693 
n
,

1694 cÚ¡ *
®pha
,

1695 cÚ¡ *
x
,

1696 
šcx
,

1697 cÚ¡ *
y
,

1698 
šcy
,

1699 *
AP
);

1701 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsD¥r2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1702 
cubÏsFlMode_t
 
u¶o
,

1703 
n
,

1704 cÚ¡ *
®pha
,

1705 cÚ¡ *
x
,

1706 
šcx
,

1707 cÚ¡ *
y
,

1708 
šcy
,

1709 *
AP
);

1712 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh´2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1713 
cubÏsFlMode_t
 
u¶o
,

1714 
n
,

1715 cÚ¡ 
cuCom¶ex
 *
®pha
,

1716 cÚ¡ 
cuCom¶ex
 *
x
,

1717 
šcx
,

1718 cÚ¡ 
cuCom¶ex
 *
y
,

1719 
šcy
,

1720 
cuCom¶ex
 *
AP
);

1722 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh´2_v2
 (
cubÏsHªdË_t
 
hªdË
,

1723 
cubÏsFlMode_t
 
u¶o
,

1724 
n
,

1725 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1726 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

1727 
šcx
,

1728 cÚ¡ 
cuDoubËCom¶ex
 *
y
,

1729 
šcy
,

1730 
cuDoubËCom¶ex
 *
AP
);

1735 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgemm_v2
 (
cubÏsHªdË_t
 
hªdË
,

1736 
cubÏsO³¿tiÚ_t
 
Œª§
,

1737 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1738 
m
,

1739 
n
,

1740 
k
,

1741 cÚ¡ *
®pha
,

1742 cÚ¡ *
A
,

1743 
lda
,

1744 cÚ¡ *
B
,

1745 
ldb
,

1746 cÚ¡ *
b‘a
,

1747 *
C
,

1748 
ldc
);

1750 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDgemm_v2
 (
cubÏsHªdË_t
 
hªdË
,

1751 
cubÏsO³¿tiÚ_t
 
Œª§
,

1752 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1753 
m
,

1754 
n
,

1755 
k
,

1756 cÚ¡ *
®pha
,

1757 cÚ¡ *
A
,

1758 
lda
,

1759 cÚ¡ *
B
,

1760 
ldb
,

1761 cÚ¡ *
b‘a
,

1762 *
C
,

1763 
ldc
);

1765 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemm_v2
 (
cubÏsHªdË_t
 
hªdË
,

1766 
cubÏsO³¿tiÚ_t
 
Œª§
,

1767 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1768 
m
,

1769 
n
,

1770 
k
,

1771 cÚ¡ 
cuCom¶ex
 *
®pha
,

1772 cÚ¡ 
cuCom¶ex
 *
A
,

1773 
lda
,

1774 cÚ¡ 
cuCom¶ex
 *
B
,

1775 
ldb
,

1776 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1777 
cuCom¶ex
 *
C
,

1778 
ldc
);

1780 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemm3m
 (
cubÏsHªdË_t
 
hªdË
,

1781 
cubÏsO³¿tiÚ_t
 
Œª§
,

1782 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1783 
m
,

1784 
n
,

1785 
k
,

1786 cÚ¡ 
cuCom¶ex
 *
®pha
,

1787 cÚ¡ 
cuCom¶ex
 *
A
,

1788 
lda
,

1789 cÚ¡ 
cuCom¶ex
 *
B
,

1790 
ldb
,

1791 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1792 
cuCom¶ex
 *
C
,

1793 
ldc
);

1794 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemm3mEx
 (
cubÏsHªdË_t
 
hªdË
,

1795 
cubÏsO³¿tiÚ_t
 
Œª§
, cubÏsO³¿tiÚ_ˆ
Œªsb
,

1796 
m
, 
n
, 
k
,

1797 cÚ¡ 
cuCom¶ex
 *
®pha
,

1798 cÚ¡ *
A
,

1799 
cudaD©aTy³
 
Aty³
,

1800 
lda
,

1801 cÚ¡ *
B
,

1802 
cudaD©aTy³
 
Bty³
,

1803 
ldb
,

1804 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1805 *
C
,

1806 
cudaD©aTy³
 
Cty³
,

1807 
ldc
);

1810 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgemm_v2
 (
cubÏsHªdË_t
 
hªdË
,

1811 
cubÏsO³¿tiÚ_t
 
Œª§
,

1812 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1813 
m
,

1814 
n
,

1815 
k
,

1816 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1817 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1818 
lda
,

1819 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

1820 
ldb
,

1821 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1822 
cuDoubËCom¶ex
 *
C
,

1823 
ldc
);

1825 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgemm3m
 (
cubÏsHªdË_t
 
hªdË
,

1826 
cubÏsO³¿tiÚ_t
 
Œª§
,

1827 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1828 
m
,

1829 
n
,

1830 
k
,

1831 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1832 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1833 
lda
,

1834 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

1835 
ldb
,

1836 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1837 
cuDoubËCom¶ex
 *
C
,

1838 
ldc
);

1840 #ià
defšed
(
__ılu¥lus
)

1841 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsHgemm
 (
cubÏsHªdË_t
 
hªdË
,

1842 
cubÏsO³¿tiÚ_t
 
Œª§
,

1843 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1844 
m
,

1845 
n
,

1846 
k
,

1847 cÚ¡ 
__h®f
 *
®pha
,

1848 cÚ¡ 
__h®f
 *
A
,

1849 
lda
,

1850 cÚ¡ 
__h®f
 *
B
,

1851 
ldb
,

1852 cÚ¡ 
__h®f
 *
b‘a
,

1853 
__h®f
 *
C
,

1854 
ldc
);

1857 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgemmEx
 (
cubÏsHªdË_t
 
hªdË
,

1858 
cubÏsO³¿tiÚ_t
 
Œª§
,

1859 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1860 
m
,

1861 
n
,

1862 
k
,

1863 cÚ¡ *
®pha
,

1864 cÚ¡ *
A
,

1865 
cudaD©aTy³
 
Aty³
,

1866 
lda
,

1867 cÚ¡ *
B
,

1868 
cudaD©aTy³
 
Bty³
,

1869 
ldb
,

1870 cÚ¡ *
b‘a
,

1871 *
C
,

1872 
cudaD©aTy³
 
Cty³
,

1873 
ldc
);

1875 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsGemmEx
 (
cubÏsHªdË_t
 
hªdË
,

1876 
cubÏsO³¿tiÚ_t
 
Œª§
,

1877 
cubÏsO³¿tiÚ_t
 
Œªsb
,

1878 
m
,

1879 
n
,

1880 
k
,

1881 cÚ¡ *
®pha
,

1882 cÚ¡ *
A
,

1883 
cudaD©aTy³
 
Aty³
,

1884 
lda
,

1885 cÚ¡ *
B
,

1886 
cudaD©aTy³
 
Bty³
,

1887 
ldb
,

1888 cÚ¡ *
b‘a
,

1889 *
C
,

1890 
cudaD©aTy³
 
Cty³
,

1891 
ldc
,

1892 
cudaD©aTy³
 
compu‹Ty³
,

1893 
cubÏsGemmAlgo_t
 
®go
);

1896 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemmEx
 (
cubÏsHªdË_t
 
hªdË
,

1897 
cubÏsO³¿tiÚ_t
 
Œª§
, cubÏsO³¿tiÚ_ˆ
Œªsb
,

1898 
m
, 
n
, 
k
,

1899 cÚ¡ 
cuCom¶ex
 *
®pha
,

1900 cÚ¡ *
A
,

1901 
cudaD©aTy³
 
Aty³
,

1902 
lda
,

1903 cÚ¡ *
B
,

1904 
cudaD©aTy³
 
Bty³
,

1905 
ldb
,

1906 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1907 *
C
,

1908 
cudaD©aTy³
 
Cty³
,

1909 
ldc
);

1911 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsUšt8gemmBŸs
 (
cubÏsHªdË_t
 
hªdË
,

1912 
cubÏsO³¿tiÚ_t
 
Œª§
, cubÏsO³¿tiÚ_ˆ
Œªsb
, cubÏsO³¿tiÚ_ˆ
Œªsc
,

1913 
m
, 
n
, 
k
,

1914 cÚ¡ *
A
, 
A_bŸs
, 
lda
,

1915 cÚ¡ *
B
, 
B_bŸs
, 
ldb
,

1916 *
C
, 
C_bŸs
, 
ldc
,

1917 
C_muÉ
, 
C_shiá
);

1920 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsyrk_v2
 (
cubÏsHªdË_t
 
hªdË
,

1921 
cubÏsFlMode_t
 
u¶o
,

1922 
cubÏsO³¿tiÚ_t
 
Œªs
,

1923 
n
,

1924 
k
,

1925 cÚ¡ *
®pha
,

1926 cÚ¡ *
A
,

1927 
lda
,

1928 cÚ¡ *
b‘a
,

1929 *
C
,

1930 
ldc
);

1932 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsyrk_v2
 (
cubÏsHªdË_t
 
hªdË
,

1933 
cubÏsFlMode_t
 
u¶o
,

1934 
cubÏsO³¿tiÚ_t
 
Œªs
,

1935 
n
,

1936 
k
,

1937 cÚ¡ *
®pha
,

1938 cÚ¡ *
A
,

1939 
lda
,

1940 cÚ¡ *
b‘a
,

1941 *
C
,

1942 
ldc
);

1944 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyrk_v2
 (
cubÏsHªdË_t
 
hªdË
,

1945 
cubÏsFlMode_t
 
u¶o
,

1946 
cubÏsO³¿tiÚ_t
 
Œªs
,

1947 
n
,

1948 
k
,

1949 cÚ¡ 
cuCom¶ex
 *
®pha
,

1950 cÚ¡ 
cuCom¶ex
 *
A
,

1951 
lda
,

1952 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1953 
cuCom¶ex
 *
C
,

1954 
ldc
);

1956 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsyrk_v2
 (
cubÏsHªdË_t
 
hªdË
,

1957 
cubÏsFlMode_t
 
u¶o
,

1958 
cubÏsO³¿tiÚ_t
 
Œªs
,

1959 
n
,

1960 
k
,

1961 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

1962 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

1963 
lda
,

1964 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

1965 
cuDoubËCom¶ex
 *
C
,

1966 
ldc
);

1968 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyrkEx
 ( 
cubÏsHªdË_t
 
hªdË
,

1969 
cubÏsFlMode_t
 
u¶o
,

1970 
cubÏsO³¿tiÚ_t
 
Œªs
,

1971 
n
,

1972 
k
,

1973 cÚ¡ 
cuCom¶ex
 *
®pha
,

1974 cÚ¡ *
A
,

1975 
cudaD©aTy³
 
Aty³
,

1976 
lda
,

1977 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1978 *
C
,

1979 
cudaD©aTy³
 
Cty³
,

1980 
ldc
);

1983 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyrk3mEx
(
cubÏsHªdË_t
 
hªdË
,

1984 
cubÏsFlMode_t
 
u¶o
,

1985 
cubÏsO³¿tiÚ_t
 
Œªs
,

1986 
n
,

1987 
k
,

1988 cÚ¡ 
cuCom¶ex
 *
®pha
,

1989 cÚ¡ *
A
,

1990 
cudaD©aTy³
 
Aty³
,

1991 
lda
,

1992 cÚ¡ 
cuCom¶ex
 *
b‘a
,

1993 *
C
,

1994 
cudaD©aTy³
 
Cty³
,

1995 
ldc
);

1998 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”k_v2
 (
cubÏsHªdË_t
 
hªdË
,

1999 
cubÏsFlMode_t
 
u¶o
,

2000 
cubÏsO³¿tiÚ_t
 
Œªs
,

2001 
n
,

2002 
k
,

2003 cÚ¡ *
®pha
,

2004 cÚ¡ 
cuCom¶ex
 *
A
,

2005 
lda
,

2006 cÚ¡ *
b‘a
,

2007 
cuCom¶ex
 *
C
,

2008 
ldc
);

2010 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh”k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2011 
cubÏsFlMode_t
 
u¶o
,

2012 
cubÏsO³¿tiÚ_t
 
Œªs
,

2013 
n
,

2014 
k
,

2015 cÚ¡ *
®pha
,

2016 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2017 
lda
,

2018 cÚ¡ *
b‘a
,

2019 
cuDoubËCom¶ex
 *
C
,

2020 
ldc
);

2023 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”kEx
 (
cubÏsHªdË_t
 
hªdË
,

2024 
cubÏsFlMode_t
 
u¶o
,

2025 
cubÏsO³¿tiÚ_t
 
Œªs
,

2026 
n
,

2027 
k
,

2028 cÚ¡ *
®pha
,

2029 cÚ¡ *
A
,

2030 
cudaD©aTy³
 
Aty³
,

2031 
lda
,

2032 cÚ¡ *
b‘a
,

2033 *
C
,

2034 
cudaD©aTy³
 
Cty³
,

2035 
ldc
);

2038 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”k3mEx
 (
cubÏsHªdË_t
 
hªdË
,

2039 
cubÏsFlMode_t
 
u¶o
,

2040 
cubÏsO³¿tiÚ_t
 
Œªs
,

2041 
n
,

2042 
k
,

2043 cÚ¡ *
®pha
,

2044 cÚ¡ *
A
, 
cudaD©aTy³
 
Aty³
,

2045 
lda
,

2046 cÚ¡ *
b‘a
,

2047 *
C
,

2048 
cudaD©aTy³
 
Cty³
,

2049 
ldc
);

2054 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsyr2k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2055 
cubÏsFlMode_t
 
u¶o
,

2056 
cubÏsO³¿tiÚ_t
 
Œªs
,

2057 
n
,

2058 
k
,

2059 cÚ¡ *
®pha
,

2060 cÚ¡ *
A
,

2061 
lda
,

2062 cÚ¡ *
B
,

2063 
ldb
,

2064 cÚ¡ *
b‘a
,

2065 *
C
,

2066 
ldc
);

2068 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsyr2k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2069 
cubÏsFlMode_t
 
u¶o
,

2070 
cubÏsO³¿tiÚ_t
 
Œªs
,

2071 
n
,

2072 
k
,

2073 cÚ¡ *
®pha
,

2074 cÚ¡ *
A
,

2075 
lda
,

2076 cÚ¡ *
B
,

2077 
ldb
,

2078 cÚ¡ *
b‘a
,

2079 *
C
,

2080 
ldc
);

2082 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyr2k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2083 
cubÏsFlMode_t
 
u¶o
,

2084 
cubÏsO³¿tiÚ_t
 
Œªs
,

2085 
n
,

2086 
k
,

2087 cÚ¡ 
cuCom¶ex
 *
®pha
,

2088 cÚ¡ 
cuCom¶ex
 *
A
,

2089 
lda
,

2090 cÚ¡ 
cuCom¶ex
 *
B
,

2091 
ldb
,

2092 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2093 
cuCom¶ex
 *
C
,

2094 
ldc
);

2096 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsyr2k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2097 
cubÏsFlMode_t
 
u¶o
,

2098 
cubÏsO³¿tiÚ_t
 
Œªs
,

2099 
n
,

2100 
k
,

2101 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2102 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2103 
lda
,

2104 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2105 
ldb
,

2106 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2107 
cuDoubËCom¶ex
 *
C
,

2108 
ldc
);

2110 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”2k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2111 
cubÏsFlMode_t
 
u¶o
,

2112 
cubÏsO³¿tiÚ_t
 
Œªs
,

2113 
n
,

2114 
k
,

2115 cÚ¡ 
cuCom¶ex
 *
®pha
,

2116 cÚ¡ 
cuCom¶ex
 *
A
,

2117 
lda
,

2118 cÚ¡ 
cuCom¶ex
 *
B
,

2119 
ldb
,

2120 cÚ¡ *
b‘a
,

2121 
cuCom¶ex
 *
C
,

2122 
ldc
);

2124 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh”2k_v2
 (
cubÏsHªdË_t
 
hªdË
,

2125 
cubÏsFlMode_t
 
u¶o
,

2126 
cubÏsO³¿tiÚ_t
 
Œªs
,

2127 
n
,

2128 
k
,

2129 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2130 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2131 
lda
,

2132 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2133 
ldb
,

2134 cÚ¡ *
b‘a
,

2135 
cuDoubËCom¶ex
 *
C
,

2136 
ldc
);

2138 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsyrkx
 (
cubÏsHªdË_t
 
hªdË
,

2139 
cubÏsFlMode_t
 
u¶o
,

2140 
cubÏsO³¿tiÚ_t
 
Œªs
,

2141 
n
,

2142 
k
,

2143 cÚ¡ *
®pha
,

2144 cÚ¡ *
A
,

2145 
lda
,

2146 cÚ¡ *
B
,

2147 
ldb
,

2148 cÚ¡ *
b‘a
,

2149 *
C
,

2150 
ldc
);

2152 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsyrkx
 (
cubÏsHªdË_t
 
hªdË
,

2153 
cubÏsFlMode_t
 
u¶o
,

2154 
cubÏsO³¿tiÚ_t
 
Œªs
,

2155 
n
,

2156 
k
,

2157 cÚ¡ *
®pha
,

2158 cÚ¡ *
A
,

2159 
lda
,

2160 cÚ¡ *
B
,

2161 
ldb
,

2162 cÚ¡ *
b‘a
,

2163 *
C
,

2164 
ldc
);

2166 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsyrkx
 (
cubÏsHªdË_t
 
hªdË
,

2167 
cubÏsFlMode_t
 
u¶o
,

2168 
cubÏsO³¿tiÚ_t
 
Œªs
,

2169 
n
,

2170 
k
,

2171 cÚ¡ 
cuCom¶ex
 *
®pha
,

2172 cÚ¡ 
cuCom¶ex
 *
A
,

2173 
lda
,

2174 cÚ¡ 
cuCom¶ex
 *
B
,

2175 
ldb
,

2176 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2177 
cuCom¶ex
 *
C
,

2178 
ldc
);

2180 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsyrkx
 (
cubÏsHªdË_t
 
hªdË
,

2181 
cubÏsFlMode_t
 
u¶o
,

2182 
cubÏsO³¿tiÚ_t
 
Œªs
,

2183 
n
,

2184 
k
,

2185 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2186 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2187 
lda
,

2188 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2189 
ldb
,

2190 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2191 
cuDoubËCom¶ex
 *
C
,

2192 
ldc
);

2194 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCh”kx
 (
cubÏsHªdË_t
 
hªdË
,

2195 
cubÏsFlMode_t
 
u¶o
,

2196 
cubÏsO³¿tiÚ_t
 
Œªs
,

2197 
n
,

2198 
k
,

2199 cÚ¡ 
cuCom¶ex
 *
®pha
,

2200 cÚ¡ 
cuCom¶ex
 *
A
,

2201 
lda
,

2202 cÚ¡ 
cuCom¶ex
 *
B
,

2203 
ldb
,

2204 cÚ¡ *
b‘a
,

2205 
cuCom¶ex
 *
C
,

2206 
ldc
);

2208 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZh”kx
 (
cubÏsHªdË_t
 
hªdË
,

2209 
cubÏsFlMode_t
 
u¶o
,

2210 
cubÏsO³¿tiÚ_t
 
Œªs
,

2211 
n
,

2212 
k
,

2213 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2214 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2215 
lda
,

2216 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2217 
ldb
,

2218 cÚ¡ *
b‘a
,

2219 
cuDoubËCom¶ex
 *
C
,

2220 
ldc
);

2222 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSsymm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2223 
cubÏsSideMode_t
 
side
,

2224 
cubÏsFlMode_t
 
u¶o
,

2225 
m
,

2226 
n
,

2227 cÚ¡ *
®pha
,

2228 cÚ¡ *
A
,

2229 
lda
,

2230 cÚ¡ *
B
,

2231 
ldb
,

2232 cÚ¡ *
b‘a
,

2233 *
C
,

2234 
ldc
);

2236 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDsymm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2237 
cubÏsSideMode_t
 
side
,

2238 
cubÏsFlMode_t
 
u¶o
,

2239 
m
,

2240 
n
,

2241 cÚ¡ *
®pha
,

2242 cÚ¡ *
A
,

2243 
lda
,

2244 cÚ¡ *
B
,

2245 
ldb
,

2246 cÚ¡ *
b‘a
,

2247 *
C
,

2248 
ldc
);

2250 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCsymm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2251 
cubÏsSideMode_t
 
side
,

2252 
cubÏsFlMode_t
 
u¶o
,

2253 
m
,

2254 
n
,

2255 cÚ¡ 
cuCom¶ex
 *
®pha
,

2256 cÚ¡ 
cuCom¶ex
 *
A
,

2257 
lda
,

2258 cÚ¡ 
cuCom¶ex
 *
B
,

2259 
ldb
,

2260 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2261 
cuCom¶ex
 *
C
,

2262 
ldc
);

2264 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZsymm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2265 
cubÏsSideMode_t
 
side
,

2266 
cubÏsFlMode_t
 
u¶o
,

2267 
m
,

2268 
n
,

2269 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2270 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2271 
lda
,

2272 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2273 
ldb
,

2274 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2275 
cuDoubËCom¶ex
 *
C
,

2276 
ldc
);

2279 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsChemm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2280 
cubÏsSideMode_t
 
side
,

2281 
cubÏsFlMode_t
 
u¶o
,

2282 
m
,

2283 
n
,

2284 cÚ¡ 
cuCom¶ex
 *
®pha
,

2285 cÚ¡ 
cuCom¶ex
 *
A
,

2286 
lda
,

2287 cÚ¡ 
cuCom¶ex
 *
B
,

2288 
ldb
,

2289 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2290 
cuCom¶ex
 *
C
,

2291 
ldc
);

2293 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZhemm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2294 
cubÏsSideMode_t
 
side
,

2295 
cubÏsFlMode_t
 
u¶o
,

2296 
m
,

2297 
n
,

2298 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2299 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2300 
lda
,

2301 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2302 
ldb
,

2303 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2304 
cuDoubËCom¶ex
 *
C
,

2305 
ldc
);

2308 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSŒsm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2309 
cubÏsSideMode_t
 
side
,

2310 
cubÏsFlMode_t
 
u¶o
,

2311 
cubÏsO³¿tiÚ_t
 
Œªs
,

2312 
cubÏsDŸgTy³_t
 
dŸg
,

2313 
m
,

2314 
n
,

2315 cÚ¡ *
®pha
,

2316 cÚ¡ *
A
,

2317 
lda
,

2318 *
B
,

2319 
ldb
);

2322 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDŒsm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2323 
cubÏsSideMode_t
 
side
,

2324 
cubÏsFlMode_t
 
u¶o
,

2325 
cubÏsO³¿tiÚ_t
 
Œªs
,

2326 
cubÏsDŸgTy³_t
 
dŸg
,

2327 
m
,

2328 
n
,

2329 cÚ¡ *
®pha
,

2330 cÚ¡ *
A
,

2331 
lda
,

2332 *
B
,

2333 
ldb
);

2335 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCŒsm_v2
(
cubÏsHªdË_t
 
hªdË
,

2336 
cubÏsSideMode_t
 
side
,

2337 
cubÏsFlMode_t
 
u¶o
,

2338 
cubÏsO³¿tiÚ_t
 
Œªs
,

2339 
cubÏsDŸgTy³_t
 
dŸg
,

2340 
m
,

2341 
n
,

2342 cÚ¡ 
cuCom¶ex
 *
®pha
,

2343 cÚ¡ 
cuCom¶ex
 *
A
,

2344 
lda
,

2345 
cuCom¶ex
 *
B
,

2346 
ldb
);

2348 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZŒsm_v2
(
cubÏsHªdË_t
 
hªdË
,

2349 
cubÏsSideMode_t
 
side
,

2350 
cubÏsFlMode_t
 
u¶o
,

2351 
cubÏsO³¿tiÚ_t
 
Œªs
,

2352 
cubÏsDŸgTy³_t
 
dŸg
,

2353 
m
,

2354 
n
,

2355 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2356 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2357 
lda
,

2358 
cuDoubËCom¶ex
 *
B
,

2359 
ldb
);

2362 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSŒmm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2363 
cubÏsSideMode_t
 
side
,

2364 
cubÏsFlMode_t
 
u¶o
,

2365 
cubÏsO³¿tiÚ_t
 
Œªs
,

2366 
cubÏsDŸgTy³_t
 
dŸg
,

2367 
m
,

2368 
n
,

2369 cÚ¡ *
®pha
,

2370 cÚ¡ *
A
,

2371 
lda
,

2372 cÚ¡ *
B
,

2373 
ldb
,

2374 *
C
,

2375 
ldc
);

2377 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDŒmm_v2
 (
cubÏsHªdË_t
 
hªdË
,

2378 
cubÏsSideMode_t
 
side
,

2379 
cubÏsFlMode_t
 
u¶o
,

2380 
cubÏsO³¿tiÚ_t
 
Œªs
,

2381 
cubÏsDŸgTy³_t
 
dŸg
,

2382 
m
,

2383 
n
,

2384 cÚ¡ *
®pha
,

2385 cÚ¡ *
A
,

2386 
lda
,

2387 cÚ¡ *
B
,

2388 
ldb
,

2389 *
C
,

2390 
ldc
);

2392 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCŒmm_v2
(
cubÏsHªdË_t
 
hªdË
,

2393 
cubÏsSideMode_t
 
side
,

2394 
cubÏsFlMode_t
 
u¶o
,

2395 
cubÏsO³¿tiÚ_t
 
Œªs
,

2396 
cubÏsDŸgTy³_t
 
dŸg
,

2397 
m
,

2398 
n
,

2399 cÚ¡ 
cuCom¶ex
 *
®pha
,

2400 cÚ¡ 
cuCom¶ex
 *
A
,

2401 
lda
,

2402 cÚ¡ 
cuCom¶ex
 *
B
,

2403 
ldb
,

2404 
cuCom¶ex
 *
C
,

2405 
ldc
);

2407 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZŒmm_v2
(
cubÏsHªdË_t
 
hªdË
, 
cubÏsSideMode_t
 
side
,

2408 
cubÏsFlMode_t
 
u¶o
,

2409 
cubÏsO³¿tiÚ_t
 
Œªs
,

2410 
cubÏsDŸgTy³_t
 
dŸg
,

2411 
m
,

2412 
n
,

2413 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2414 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2415 
lda
,

2416 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2417 
ldb
,

2418 
cuDoubËCom¶ex
 *
C
,

2419 
ldc
);

2421 #ià
defšed
(
__ılu¥lus
)

2422 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsHgemmB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2423 
cubÏsO³¿tiÚ_t
 
Œª§
,

2424 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2425 
m
,

2426 
n
,

2427 
k
,

2428 cÚ¡ 
__h®f
 *
®pha
,

2429 cÚ¡ 
__h®f
 *cÚ¡ 
A¬¿y
[],

2430 
lda
,

2431 cÚ¡ 
__h®f
 *cÚ¡ 
B¬¿y
[],

2432 
ldb
,

2433 cÚ¡ 
__h®f
 *
b‘a
,

2434 
__h®f
 *cÚ¡ 
C¬¿y
[],

2435 
ldc
,

2436 
b©chCouÁ
);

2438 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgemmB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2439 
cubÏsO³¿tiÚ_t
 
Œª§
,

2440 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2441 
m
,

2442 
n
,

2443 
k
,

2444 cÚ¡ *
®pha
,

2445 cÚ¡ *cÚ¡ 
A¬¿y
[],

2446 
lda
,

2447 cÚ¡ *cÚ¡ 
B¬¿y
[],

2448 
ldb
,

2449 cÚ¡ *
b‘a
,

2450 *cÚ¡ 
C¬¿y
[],

2451 
ldc
,

2452 
b©chCouÁ
);

2454 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDgemmB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2455 
cubÏsO³¿tiÚ_t
 
Œª§
,

2456 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2457 
m
,

2458 
n
,

2459 
k
,

2460 cÚ¡ *
®pha
,

2461 cÚ¡ *cÚ¡ 
A¬¿y
[],

2462 
lda
,

2463 cÚ¡ *cÚ¡ 
B¬¿y
[],

2464 
ldb
,

2465 cÚ¡ *
b‘a
,

2466 *cÚ¡ 
C¬¿y
[],

2467 
ldc
,

2468 
b©chCouÁ
);

2470 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemmB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2471 
cubÏsO³¿tiÚ_t
 
Œª§
,

2472 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2473 
m
,

2474 
n
,

2475 
k
,

2476 cÚ¡ 
cuCom¶ex
 *
®pha
,

2477 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
A¬¿y
[],

2478 
lda
,

2479 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
B¬¿y
[],

2480 
ldb
,

2481 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2482 
cuCom¶ex
 *cÚ¡ 
C¬¿y
[],

2483 
ldc
,

2484 
b©chCouÁ
);

2486 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemm3mB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2487 
cubÏsO³¿tiÚ_t
 
Œª§
,

2488 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2489 
m
,

2490 
n
,

2491 
k
,

2492 cÚ¡ 
cuCom¶ex
 *
®pha
,

2493 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
A¬¿y
[],

2494 
lda
,

2495 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
B¬¿y
[],

2496 
ldb
,

2497 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2498 
cuCom¶ex
 *cÚ¡ 
C¬¿y
[],

2499 
ldc
,

2500 
b©chCouÁ
);

2502 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgemmB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2503 
cubÏsO³¿tiÚ_t
 
Œª§
,

2504 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2505 
m
,

2506 
n
,

2507 
k
,

2508 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2509 cÚ¡ 
cuDoubËCom¶ex
 *cÚ¡ 
A¬¿y
[],

2510 
lda
,

2511 cÚ¡ 
cuDoubËCom¶ex
 *cÚ¡ 
B¬¿y
[],

2512 
ldb
,

2513 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2514 
cuDoubËCom¶ex
 *cÚ¡ 
C¬¿y
[],

2515 
ldc
,

2516 
b©chCouÁ
);

2518 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsGemmB©chedEx
 (
cubÏsHªdË_t
 
hªdË
,

2519 
cubÏsO³¿tiÚ_t
 
Œª§
,

2520 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2521 
m
,

2522 
n
,

2523 
k
,

2524 cÚ¡ *
®pha
,

2525 cÚ¡ *cÚ¡ 
A¬¿y
[],

2526 
cudaD©aTy³
 
Aty³
,

2527 
lda
,

2528 cÚ¡ *cÚ¡ 
B¬¿y
[],

2529 
cudaD©aTy³
 
Bty³
,

2530 
ldb
,

2531 cÚ¡ *
b‘a
,

2532 *cÚ¡ 
C¬¿y
[],

2533 
cudaD©aTy³
 
Cty³
,

2534 
ldc
,

2535 
b©chCouÁ
,

2536 
cudaD©aTy³
 
compu‹Ty³
,

2537 
cubÏsGemmAlgo_t
 
®go
);

2539 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsGemmSŒidedB©chedEx
 (
cubÏsHªdË_t
 
hªdË
,

2540 
cubÏsO³¿tiÚ_t
 
Œª§
,

2541 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2542 
m
,

2543 
n
,

2544 
k
,

2545 cÚ¡ *
®pha
,

2546 cÚ¡ *
A
,

2547 
cudaD©aTy³
 
Aty³
,

2548 
lda
,

2549 
¡rideA
,

2550 cÚ¡ *
B
,

2551 
cudaD©aTy³
 
Bty³
,

2552 
ldb
,

2553 
¡rideB
,

2554 cÚ¡ *
b‘a
,

2555 *
C
,

2556 
cudaD©aTy³
 
Cty³
,

2557 
ldc
,

2558 
¡rideC
,

2559 
b©chCouÁ
,

2560 
cudaD©aTy³
 
compu‹Ty³
,

2561 
cubÏsGemmAlgo_t
 
®go
);

2563 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgemmSŒidedB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2564 
cubÏsO³¿tiÚ_t
 
Œª§
,

2565 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2566 
m
,

2567 
n
,

2568 
k
,

2569 cÚ¡ *
®pha
,

2570 cÚ¡ *
A
,

2571 
lda
,

2572 
¡rideA
,

2573 cÚ¡ *
B
,

2574 
ldb
,

2575 
¡rideB
,

2576 cÚ¡ *
b‘a
,

2577 *
C
,

2578 
ldc
,

2579 
¡rideC
,

2580 
b©chCouÁ
);

2582 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDgemmSŒidedB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2583 
cubÏsO³¿tiÚ_t
 
Œª§
,

2584 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2585 
m
,

2586 
n
,

2587 
k
,

2588 cÚ¡ *
®pha
,

2589 cÚ¡ *
A
,

2590 
lda
,

2591 
¡rideA
,

2592 cÚ¡ *
B
,

2593 
ldb
,

2594 
¡rideB
,

2595 cÚ¡ *
b‘a
,

2596 *
C
,

2597 
ldc
,

2598 
¡rideC
,

2599 
b©chCouÁ
);

2601 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemmSŒidedB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2602 
cubÏsO³¿tiÚ_t
 
Œª§
,

2603 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2604 
m
,

2605 
n
,

2606 
k
,

2607 cÚ¡ 
cuCom¶ex
 *
®pha
,

2608 cÚ¡ 
cuCom¶ex
 *
A
,

2609 
lda
,

2610 
¡rideA
,

2611 cÚ¡ 
cuCom¶ex
 *
B
,

2612 
ldb
,

2613 
¡rideB
,

2614 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2615 
cuCom¶ex
 *
C
,

2616 
ldc
,

2617 
¡rideC
,

2618 
b©chCouÁ
);

2620 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgemm3mSŒidedB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2621 
cubÏsO³¿tiÚ_t
 
Œª§
,

2622 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2623 
m
,

2624 
n
,

2625 
k
,

2626 cÚ¡ 
cuCom¶ex
 *
®pha
,

2627 cÚ¡ 
cuCom¶ex
 *
A
,

2628 
lda
,

2629 
¡rideA
,

2630 cÚ¡ 
cuCom¶ex
 *
B
,

2631 
ldb
,

2632 
¡rideB
,

2633 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2634 
cuCom¶ex
 *
C
,

2635 
ldc
,

2636 
¡rideC
,

2637 
b©chCouÁ
);

2640 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgemmSŒidedB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2641 
cubÏsO³¿tiÚ_t
 
Œª§
,

2642 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2643 
m
,

2644 
n
,

2645 
k
,

2646 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2647 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2648 
lda
,

2649 
¡rideA
,

2650 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2651 
ldb
,

2652 
¡rideB
,

2653 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2654 
cuDoubËCom¶ex
 *
C
,

2655 
ldc
,

2656 
¡rideC
,

2657 
b©chCouÁ
);

2659 #ià
defšed
(
__ılu¥lus
)

2660 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsHgemmSŒidedB©ched
 (
cubÏsHªdË_t
 
hªdË
,

2661 
cubÏsO³¿tiÚ_t
 
Œª§
,

2662 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2663 
m
,

2664 
n
,

2665 
k
,

2666 cÚ¡ 
__h®f
 *
®pha
,

2667 cÚ¡ 
__h®f
 *
A
,

2668 
lda
,

2669 
¡rideA
,

2670 cÚ¡ 
__h®f
 *
B
,

2671 
ldb
,

2672 
¡rideB
,

2673 cÚ¡ 
__h®f
 *
b‘a
,

2674 
__h®f
 *
C
,

2675 
ldc
,

2676 
¡rideC
,

2677 
b©chCouÁ
);

2681 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSg—m
(
cubÏsHªdË_t
 
hªdË
,

2682 
cubÏsO³¿tiÚ_t
 
Œª§
,

2683 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2684 
m
,

2685 
n
,

2686 cÚ¡ *
®pha
,

2687 cÚ¡ *
A
,

2688 
lda
,

2689 cÚ¡ *
b‘a
 ,

2690 cÚ¡ *
B
,

2691 
ldb
,

2692 *
C
,

2693 
ldc
);

2695 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDg—m
(
cubÏsHªdË_t
 
hªdË
,

2696 
cubÏsO³¿tiÚ_t
 
Œª§
,

2697 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2698 
m
,

2699 
n
,

2700 cÚ¡ *
®pha
,

2701 cÚ¡ *
A
,

2702 
lda
,

2703 cÚ¡ *
b‘a
,

2704 cÚ¡ *
B
,

2705 
ldb
,

2706 *
C
,

2707 
ldc
);

2709 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg—m
(
cubÏsHªdË_t
 
hªdË
,

2710 
cubÏsO³¿tiÚ_t
 
Œª§
,

2711 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2712 
m
,

2713 
n
,

2714 cÚ¡ 
cuCom¶ex
 *
®pha
,

2715 cÚ¡ 
cuCom¶ex
 *
A
,

2716 
lda
,

2717 cÚ¡ 
cuCom¶ex
 *
b‘a
,

2718 cÚ¡ 
cuCom¶ex
 *
B
,

2719 
ldb
,

2720 
cuCom¶ex
 *
C
,

2721 
ldc
);

2723 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg—m
(
cubÏsHªdË_t
 
hªdË
,

2724 
cubÏsO³¿tiÚ_t
 
Œª§
,

2725 
cubÏsO³¿tiÚ_t
 
Œªsb
,

2726 
m
,

2727 
n
,

2728 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2729 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

2730 
lda
,

2731 cÚ¡ 
cuDoubËCom¶ex
 *
b‘a
,

2732 cÚ¡ 
cuDoubËCom¶ex
 *
B
,

2733 
ldb
,

2734 
cuDoubËCom¶ex
 *
C
,

2735 
ldc
);

2738 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSg‘rfB©ched
(
cubÏsHªdË_t
 
hªdË
,

2739 
n
,

2740 *cÚ¡ 
A
[],

2741 
lda
,

2742 *
P
,

2743 *
šfo
,

2744 
b©chSize
);

2746 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDg‘rfB©ched
(
cubÏsHªdË_t
 
hªdË
,

2747 
n
,

2748 *cÚ¡ 
A
[],

2749 
lda
,

2750 *
P
,

2751 *
šfo
,

2752 
b©chSize
);

2754 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg‘rfB©ched
(
cubÏsHªdË_t
 
hªdË
,

2755 
n
,

2756 
cuCom¶ex
 *cÚ¡ 
A
[],

2757 
lda
,

2758 *
P
,

2759 *
šfo
,

2760 
b©chSize
);

2762 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg‘rfB©ched
(
cubÏsHªdË_t
 
hªdË
,

2763 
n
,

2764 
cuDoubËCom¶ex
 *cÚ¡ 
A
[],

2765 
lda
,

2766 *
P
,

2767 *
šfo
,

2768 
b©chSize
);

2771 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSg‘riB©ched
(
cubÏsHªdË_t
 
hªdË
,

2772 
n
,

2773 cÚ¡ *cÚ¡ 
A
[],

2774 
lda
,

2775 cÚ¡ *
P
,

2776 *cÚ¡ 
C
[],

2777 
ldc
,

2778 *
šfo
,

2779 
b©chSize
);

2781 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDg‘riB©ched
(
cubÏsHªdË_t
 
hªdË
,

2782 
n
,

2783 cÚ¡ *cÚ¡ 
A
[],

2784 
lda
,

2785 cÚ¡ *
P
,

2786 *cÚ¡ 
C
[],

2787 
ldc
,

2788 *
šfo
,

2789 
b©chSize
);

2791 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg‘riB©ched
(
cubÏsHªdË_t
 
hªdË
,

2792 
n
,

2793 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
A
[],

2794 
lda
,

2795 cÚ¡ *
P
,

2796 
cuCom¶ex
 *cÚ¡ 
C
[],

2797 
ldc
,

2798 *
šfo
,

2799 
b©chSize
);

2801 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg‘riB©ched
(
cubÏsHªdË_t
 
hªdË
,

2802 
n
,

2803 cÚ¡ 
cuDoubËCom¶ex
 *cÚ¡ 
A
[],

2804 
lda
,

2805 cÚ¡ *
P
,

2806 
cuDoubËCom¶ex
 *cÚ¡ 
C
[],

2807 
ldc
,

2808 *
šfo
,

2809 
b©chSize
);

2813 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSg‘rsB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2814 
cubÏsO³¿tiÚ_t
 
Œªs
,

2815 
n
,

2816 
Ähs
,

2817 cÚ¡ *cÚ¡ 
A¬¿y
[],

2818 
lda
,

2819 cÚ¡ *
devIpiv
,

2820 *cÚ¡ 
B¬¿y
[],

2821 
ldb
,

2822 *
šfo
,

2823 
b©chSize
);

2825 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDg‘rsB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2826 
cubÏsO³¿tiÚ_t
 
Œªs
,

2827 
n
,

2828 
Ähs
,

2829 cÚ¡ *cÚ¡ 
A¬¿y
[],

2830 
lda
,

2831 cÚ¡ *
devIpiv
,

2832 *cÚ¡ 
B¬¿y
[],

2833 
ldb
,

2834 *
šfo
,

2835 
b©chSize
);

2837 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg‘rsB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2838 
cubÏsO³¿tiÚ_t
 
Œªs
,

2839 
n
,

2840 
Ähs
,

2841 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
A¬¿y
[],

2842 
lda
,

2843 cÚ¡ *
devIpiv
,

2844 
cuCom¶ex
 *cÚ¡ 
B¬¿y
[],

2845 
ldb
,

2846 *
šfo
,

2847 
b©chSize
);

2850 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg‘rsB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2851 
cubÏsO³¿tiÚ_t
 
Œªs
,

2852 
n
,

2853 
Ähs
,

2854 cÚ¡ 
cuDoubËCom¶ex
 *cÚ¡ 
A¬¿y
[],

2855 
lda
,

2856 cÚ¡ *
devIpiv
,

2857 
cuDoubËCom¶ex
 *cÚ¡ 
B¬¿y
[],

2858 
ldb
,

2859 *
šfo
,

2860 
b©chSize
);

2865 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSŒsmB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2866 
cubÏsSideMode_t
 
side
,

2867 
cubÏsFlMode_t
 
u¶o
,

2868 
cubÏsO³¿tiÚ_t
 
Œªs
,

2869 
cubÏsDŸgTy³_t
 
dŸg
,

2870 
m
,

2871 
n
,

2872 cÚ¡ *
®pha
,

2873 cÚ¡ *cÚ¡ 
A
[],

2874 
lda
,

2875 *cÚ¡ 
B
[],

2876 
ldb
,

2877 
b©chCouÁ
);

2879 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDŒsmB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2880 
cubÏsSideMode_t
 
side
,

2881 
cubÏsFlMode_t
 
u¶o
,

2882 
cubÏsO³¿tiÚ_t
 
Œªs
,

2883 
cubÏsDŸgTy³_t
 
dŸg
,

2884 
m
,

2885 
n
,

2886 cÚ¡ *
®pha
,

2887 cÚ¡ *cÚ¡ 
A
[],

2888 
lda
,

2889 *cÚ¡ 
B
[],

2890 
ldb
,

2891 
b©chCouÁ
);

2893 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCŒsmB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2894 
cubÏsSideMode_t
 
side
,

2895 
cubÏsFlMode_t
 
u¶o
,

2896 
cubÏsO³¿tiÚ_t
 
Œªs
,

2897 
cubÏsDŸgTy³_t
 
dŸg
,

2898 
m
,

2899 
n
,

2900 cÚ¡ 
cuCom¶ex
 *
®pha
,

2901 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
A
[],

2902 
lda
,

2903 
cuCom¶ex
 *cÚ¡ 
B
[],

2904 
ldb
,

2905 
b©chCouÁ
);

2907 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZŒsmB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2908 
cubÏsSideMode_t
 
side
,

2909 
cubÏsFlMode_t
 
u¶o
,

2910 
cubÏsO³¿tiÚ_t
 
Œªs
,

2911 
cubÏsDŸgTy³_t
 
dŸg
,

2912 
m
,

2913 
n
,

2914 cÚ¡ 
cuDoubËCom¶ex
 *
®pha
,

2915 cÚ¡ 
cuDoubËCom¶ex
 *cÚ¡ 
A
[],

2916 
lda
,

2917 
cuDoubËCom¶ex
 *cÚ¡ 
B
[],

2918 
ldb
,

2919 
b©chCouÁ
);

2922 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSm©švB©ched
(
cubÏsHªdË_t
 
hªdË
,

2923 
n
,

2924 cÚ¡ *cÚ¡ 
A
[],

2925 
lda
,

2926 *cÚ¡ 
Ašv
[],

2927 
lda_šv
,

2928 *
šfo
,

2929 
b©chSize
);

2931 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDm©švB©ched
(
cubÏsHªdË_t
 
hªdË
,

2932 
n
,

2933 cÚ¡ *cÚ¡ 
A
[],

2934 
lda
,

2935 *cÚ¡ 
Ašv
[],

2936 
lda_šv
,

2937 *
šfo
,

2938 
b©chSize
);

2940 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCm©švB©ched
(
cubÏsHªdË_t
 
hªdË
,

2941 
n
,

2942 cÚ¡ 
cuCom¶ex
 *cÚ¡ 
A
[],

2943 
lda
,

2944 
cuCom¶ex
 *cÚ¡ 
Ašv
[],

2945 
lda_šv
,

2946 *
šfo
,

2947 
b©chSize
);

2949 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZm©švB©ched
(
cubÏsHªdË_t
 
hªdË
,

2950 
n
,

2951 cÚ¡ 
cuDoubËCom¶ex
 *cÚ¡ 
A
[],

2952 
lda
,

2953 
cuDoubËCom¶ex
 *cÚ¡ 
Ašv
[],

2954 
lda_šv
,

2955 *
šfo
,

2956 
b©chSize
);

2959 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSgeqrfB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2960 
m
,

2961 
n
,

2962 *cÚ¡ 
A¬¿y
[],

2963 
lda
,

2964 *cÚ¡ 
TauA¼ay
[],

2965 *
šfo
,

2966 
b©chSize
);

2968 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDgeqrfB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2969 
m
,

2970 
n
,

2971 *cÚ¡ 
A¬¿y
[],

2972 
lda
,

2973 *cÚ¡ 
TauA¼ay
[],

2974 *
šfo
,

2975 
b©chSize
);

2977 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCgeqrfB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2978 
m
,

2979 
n
,

2980 
cuCom¶ex
 *cÚ¡ 
A¬¿y
[],

2981 
lda
,

2982 
cuCom¶ex
 *cÚ¡ 
TauA¼ay
[],

2983 *
šfo
,

2984 
b©chSize
);

2986 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZgeqrfB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2987 
m
,

2988 
n
,

2989 
cuDoubËCom¶ex
 *cÚ¡ 
A¬¿y
[],

2990 
lda
,

2991 
cuDoubËCom¶ex
 *cÚ¡ 
TauA¼ay
[],

2992 *
šfo
,

2993 
b©chSize
);

2995 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSg–sB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

2996 
cubÏsO³¿tiÚ_t
 
Œªs
,

2997 
m
,

2998 
n
,

2999 
Ähs
,

3000 *cÚ¡ 
A¬¿y
[],

3001 
lda
,

3002 *cÚ¡ 
C¬¿y
[],

3003 
ldc
,

3004 *
šfo
,

3005 *
devInfoA¼ay
,

3006 
b©chSize
 );

3008 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDg–sB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

3009 
cubÏsO³¿tiÚ_t
 
Œªs
,

3010 
m
,

3011 
n
,

3012 
Ähs
,

3013 *cÚ¡ 
A¬¿y
[],

3014 
lda
,

3015 *cÚ¡ 
C¬¿y
[],

3016 
ldc
,

3017 *
šfo
,

3018 *
devInfoA¼ay
,

3019 
b©chSize
);

3021 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCg–sB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

3022 
cubÏsO³¿tiÚ_t
 
Œªs
,

3023 
m
,

3024 
n
,

3025 
Ähs
,

3026 
cuCom¶ex
 *cÚ¡ 
A¬¿y
[],

3027 
lda
,

3028 
cuCom¶ex
 *cÚ¡ 
C¬¿y
[],

3029 
ldc
,

3030 *
šfo
,

3031 *
devInfoA¼ay
,

3032 
b©chSize
);

3034 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZg–sB©ched
Ğ
cubÏsHªdË_t
 
hªdË
,

3035 
cubÏsO³¿tiÚ_t
 
Œªs
,

3036 
m
,

3037 
n
,

3038 
Ähs
,

3039 
cuDoubËCom¶ex
 *cÚ¡ 
A¬¿y
[],

3040 
lda
,

3041 
cuDoubËCom¶ex
 *cÚ¡ 
C¬¿y
[],

3042 
ldc
,

3043 *
šfo
,

3044 *
devInfoA¼ay
,

3045 
b©chSize
);

3047 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSdgmm
(
cubÏsHªdË_t
 
hªdË
,

3048 
cubÏsSideMode_t
 
mode
,

3049 
m
,

3050 
n
,

3051 cÚ¡ *
A
,

3052 
lda
,

3053 cÚ¡ *
x
,

3054 
šcx
,

3055 *
C
,

3056 
ldc
);

3058 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDdgmm
(
cubÏsHªdË_t
 
hªdË
,

3059 
cubÏsSideMode_t
 
mode
,

3060 
m
,

3061 
n
,

3062 cÚ¡ *
A
,

3063 
lda
,

3064 cÚ¡ *
x
,

3065 
šcx
,

3066 *
C
,

3067 
ldc
);

3069 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCdgmm
(
cubÏsHªdË_t
 
hªdË
,

3070 
cubÏsSideMode_t
 
mode
,

3071 
m
,

3072 
n
,

3073 cÚ¡ 
cuCom¶ex
 *
A
,

3074 
lda
,

3075 cÚ¡ 
cuCom¶ex
 *
x
,

3076 
šcx
,

3077 
cuCom¶ex
 *
C
,

3078 
ldc
);

3080 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZdgmm
(
cubÏsHªdË_t
 
hªdË
,

3081 
cubÏsSideMode_t
 
mode
,

3082 
m
,

3083 
n
,

3084 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

3085 
lda
,

3086 cÚ¡ 
cuDoubËCom¶ex
 *
x
,

3087 
šcx
,

3088 
cuDoubËCom¶ex
 *
C
,

3089 
ldc
);

3092 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsS‰r
 ( 
cubÏsHªdË_t
 
hªdË
,

3093 
cubÏsFlMode_t
 
u¶o
,

3094 
n
,

3095 cÚ¡ *
AP
,

3096 *
A
,

3097 
lda
 );

3099 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsD‰r
 ( 
cubÏsHªdË_t
 
hªdË
,

3100 
cubÏsFlMode_t
 
u¶o
,

3101 
n
,

3102 cÚ¡ *
AP
,

3103 *
A
,

3104 
lda
 );

3106 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsC‰r
 ( 
cubÏsHªdË_t
 
hªdË
,

3107 
cubÏsFlMode_t
 
u¶o
,

3108 
n
,

3109 cÚ¡ 
cuCom¶ex
 *
AP
,

3110 
cuCom¶ex
 *
A
,

3111 
lda
 );

3113 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZ‰r
 ( 
cubÏsHªdË_t
 
hªdË
,

3114 
cubÏsFlMode_t
 
u¶o
,

3115 
n
,

3116 cÚ¡ 
cuDoubËCom¶ex
 *
AP
,

3117 
cuDoubËCom¶ex
 *
A
,

3118 
lda
 );

3120 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsSŒ‰p
 ( 
cubÏsHªdË_t
 
hªdË
,

3121 
cubÏsFlMode_t
 
u¶o
,

3122 
n
,

3123 cÚ¡ *
A
,

3124 
lda
,

3125 *
AP
 );

3127 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsDŒ‰p
 ( 
cubÏsHªdË_t
 
hªdË
,

3128 
cubÏsFlMode_t
 
u¶o
,

3129 
n
,

3130 cÚ¡ *
A
,

3131 
lda
,

3132 *
AP
 );

3134 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsCŒ‰p
 ( 
cubÏsHªdË_t
 
hªdË
,

3135 
cubÏsFlMode_t
 
u¶o
,

3136 
n
,

3137 cÚ¡ 
cuCom¶ex
 *
A
,

3138 
lda
,

3139 
cuCom¶ex
 *
AP
 );

3141 
CUBLASAPI
 
cubÏsStus_t
 
CUBLASWINAPI
 
cubÏsZŒ‰p
 ( 
cubÏsHªdË_t
 
hªdË
,

3142 
cubÏsFlMode_t
 
u¶o
,

3143 
n
,

3144 cÚ¡ 
cuDoubËCom¶ex
 *
A
,

3145 
lda
,

3146 
cuDoubËCom¶ex
 *
AP
 );

3148 #ià
defšed
(
__ılu¥lus
)

	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_MISC
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

61 
	~<b™s/ušŠ-id’t™y.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

80 
	#htobe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

81 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

82 
	#be16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

83 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

85 
	#htobe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

86 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

87 
	#be32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

88 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

90 
	#htobe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

91 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

92 
	#be64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

93 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

119 #undeà
__USE_ISOC11


120 #undeà
__USE_ISOC99


121 #undeà
__USE_ISOC95


122 #undeà
__USE_ISOCXX11


123 #undeà
__USE_POSIX


124 #undeà
__USE_POSIX2


125 #undeà
__USE_POSIX199309


126 #undeà
__USE_POSIX199506


127 #undeà
__USE_XOPEN


128 #undeà
__USE_XOPEN_EXTENDED


129 #undeà
__USE_UNIX98


130 #undeà
__USE_XOPEN2K


131 #undeà
__USE_XOPEN2KXSI


132 #undeà
__USE_XOPEN2K8


133 #undeà
__USE_XOPEN2K8XSI


134 #undeà
__USE_LARGEFILE


135 #undeà
__USE_LARGEFILE64


136 #undeà
__USE_FILE_OFFSET64


137 #undeà
__USE_MISC


138 #undeà
__USE_ATFILE


139 #undeà
__USE_GNU


140 #undeà
__USE_FORTIFY_LEVEL


141 #undeà
__KERNEL_STRICT_NAMES


142 #undeà
__GLIBC_USE_DEPRECATED_GETS


146 #iâdeà
_LOOSE_KERNEL_NAMES


147 
	#__KERNEL_STRICT_NAMES


	)

157 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


158 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

159 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

161 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

168 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


169 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

170 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

172 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

176 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

182 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

183 && !
defšed
 
	g_DEFAULT_SOURCE


185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

190 #ifdeà
_GNU_SOURCE


191 #undeà
_ISOC95_SOURCE


192 
	#_ISOC95_SOURCE
 1

	)

193 #undeà
_ISOC99_SOURCE


194 
	#_ISOC99_SOURCE
 1

	)

195 #undeà
_ISOC11_SOURCE


196 
	#_ISOC11_SOURCE
 1

	)

197 #undeà
_POSIX_SOURCE


198 
	#_POSIX_SOURCE
 1

	)

199 #undeà
_POSIX_C_SOURCE


200 
	#_POSIX_C_SOURCE
 200809L

	)

201 #undeà
_XOPEN_SOURCE


202 
	#_XOPEN_SOURCE
 700

	)

203 #undeà
_XOPEN_SOURCE_EXTENDED


204 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

205 #undeà
_LARGEFILE64_SOURCE


206 
	#_LARGEFILE64_SOURCE
 1

	)

207 #undeà
_DEFAULT_SOURCE


208 
	#_DEFAULT_SOURCE
 1

	)

209 #undeà
_ATFILE_SOURCE


210 
	#_ATFILE_SOURCE
 1

	)

215 #ià(
defšed
 
_DEFAULT_SOURCE
 \

216 || (!
defšed
 
	g__STRICT_ANSI__
 \

217 && !
defšed
 
	g_ISOC99_SOURCE
 \

218 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

219 && !
defšed
 
	g_XOPEN_SOURCE
))

220 #undeà
_DEFAULT_SOURCE


221 
	#_DEFAULT_SOURCE
 1

	)

225 #ià(
defšed
 
_ISOC11_SOURCE
 \

226 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

227 
	#__USE_ISOC11
 1

	)

231 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

232 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

233 
	#__USE_ISOC99
 1

	)

237 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

238 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

239 
	#__USE_ISOC95
 1

	)

242 #ifdeà
__ılu¥lus


244 #ià
__ılu¥lus
 >= 201703L

245 
	#__USE_ISOC11
 1

	)

249 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


250 
	#__USE_ISOCXX11
 1

	)

251 
	#__USE_ISOC99
 1

	)

258 #ifdeà
_DEFAULT_SOURCE


259 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


260 
	#__USE_POSIX_IMPLICITLY
 1

	)

262 #undeà
_POSIX_SOURCE


263 
	#_POSIX_SOURCE
 1

	)

264 #undeà
_POSIX_C_SOURCE


265 
	#_POSIX_C_SOURCE
 200809L

	)

268 #ià((!
defšed
 
__STRICT_ANSI__
 \

269 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

270 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

271 
	#_POSIX_SOURCE
 1

	)

272 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

273 
	#_POSIX_C_SOURCE
 2

	)

274 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

275 
	#_POSIX_C_SOURCE
 199506L

	)

276 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

277 
	#_POSIX_C_SOURCE
 200112L

	)

279 
	#_POSIX_C_SOURCE
 200809L

	)

281 
	#__USE_POSIX_IMPLICITLY
 1

	)

290 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

291 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

292 
	#_POSIX_SOURCE
 1

	)

293 #undeà
_POSIX_C_SOURCE


294 
	#_POSIX_C_SOURCE
 199506L

	)

297 #ià(
defšed
 
_POSIX_SOURCE
 \

298 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

299 || 
defšed
 
_XOPEN_SOURCE
)

300 
	#__USE_POSIX
 1

	)

303 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


304 
	#__USE_POSIX2
 1

	)

307 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

308 
	#__USE_POSIX199309
 1

	)

311 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

312 
	#__USE_POSIX199506
 1

	)

315 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

316 
	#__USE_XOPEN2K
 1

	)

317 #undeà
__USE_ISOC95


318 
	#__USE_ISOC95
 1

	)

319 #undeà
__USE_ISOC99


320 
	#__USE_ISOC99
 1

	)

323 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

324 
	#__USE_XOPEN2K8
 1

	)

325 #undeà
_ATFILE_SOURCE


326 
	#_ATFILE_SOURCE
 1

	)

329 #ifdef 
_XOPEN_SOURCE


330 
	#__USE_XOPEN
 1

	)

331 #ià(
_XOPEN_SOURCE
 - 0) >= 500

332 
	#__USE_XOPEN_EXTENDED
 1

	)

333 
	#__USE_UNIX98
 1

	)

334 #undeà
_LARGEFILE_SOURCE


335 
	#_LARGEFILE_SOURCE
 1

	)

336 #ià(
_XOPEN_SOURCE
 - 0) >= 600

337 #ià(
_XOPEN_SOURCE
 - 0) >= 700

338 
	#__USE_XOPEN2K8
 1

	)

339 
	#__USE_XOPEN2K8XSI
 1

	)

341 
	#__USE_XOPEN2K
 1

	)

342 
	#__USE_XOPEN2KXSI
 1

	)

343 #undeà
__USE_ISOC95


344 
	#__USE_ISOC95
 1

	)

345 #undeà
__USE_ISOC99


346 
	#__USE_ISOC99
 1

	)

349 #ifdeà
_XOPEN_SOURCE_EXTENDED


350 
	#__USE_XOPEN_EXTENDED
 1

	)

355 #ifdeà
_LARGEFILE_SOURCE


356 
	#__USE_LARGEFILE
 1

	)

359 #ifdeà
_LARGEFILE64_SOURCE


360 
	#__USE_LARGEFILE64
 1

	)

363 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

364 
	#__USE_FILE_OFFSET64
 1

	)

367 #ià
defšed
 
_DEFAULT_SOURCE


368 
	#__USE_MISC
 1

	)

371 #ifdef 
_ATFILE_SOURCE


372 
	#__USE_ATFILE
 1

	)

375 #ifdef 
_GNU_SOURCE


376 
	#__USE_GNU
 1

	)

379 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

380 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

381 #ià
_FORTIFY_SOURCE
 > 1

382 
	#__USE_FORTIFY_LEVEL
 2

	)

384 
	#__USE_FORTIFY_LEVEL
 1

	)

387 
	#__USE_FORTIFY_LEVEL
 0

	)

394 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


395 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

397 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

402 
	~<¡dc-´edef.h
>

410 #undeà
__GNU_LIBRARY__


411 
	#__GNU_LIBRARY__
 6

	)

415 
	#__GLIBC__
 2

	)

416 
	#__GLIBC_MINOR__
 27

	)

418 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

419 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

422 #iâdeà
__ASSEMBLER__


423 #iâdeà
_SYS_CDEFS_H


424 
	~<sys/cdefs.h
>

429 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


430 
	#__USE_LARGEFILE
 1

	)

431 
	#__USE_LARGEFILE64
 1

	)

437 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

438 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

439 && 
defšed
 
	g__ex‹º_šlše


440 
	#__USE_EXTERN_INLINES
 1

	)

448 
	~<gnu/¡ubs.h
>

	@/usr/include/sched.h

19 #iâdef 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/ty³s.h
>

27 
	#__Ãed_size_t


	)

28 
	#__Ãed_NULL


	)

29 
	~<¡ddef.h
>

31 
	~<b™s/ty³s/time_t.h
>

32 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

33 #iâdeà
__USE_XOPEN2K


34 
	~<time.h
>

37 #iâdeà
__pid_t_defšed


38 
__pid_t
 
	tpid_t
;

39 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

44 
	~<b™s/ıu-£t.h
>

47 
	#sched_´iÜ™y
 
sched_´iÜ™y


	)

48 
	#__sched_´iÜ™y
 
sched_´iÜ™y


	)

51 
__BEGIN_DECLS


54 
	$sched_£¬am
 (
__pid_t
 
__pid
, cÚ¡ 
sched_·¿m
 *
__·¿m
)

55 
__THROW
;

58 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

61 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

62 cÚ¡ 
sched_·¿m
 *
__·¿m
è
__THROW
;

65 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

68 
	$sched_y›ld
 (è
__THROW
;

71 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

77 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

80 #ifdeà
__USE_GNU


82 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

83 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

84 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

86 
ıu£
)

	)

87 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

88 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

90 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

91 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

92 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

93 
ıu£
)

	)

94 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

95 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

97 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

98 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

100 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

102 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

103 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

104 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

105 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

106 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

107 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

108 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

109 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

110 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

111 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

112 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

113 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

115 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

116 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

117 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

121 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

122 cÚ¡ 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

125 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

126 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

129 
__END_DECLS


	@/usr/include/strings.h

18 #iâdef 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

26 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

27 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

30 
	g__BEGIN_DECLS


32 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


34 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

35 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

38 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

39 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

42 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

45 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


48 *
	`šdex
 (*
__s
, 
__c
)

49 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

50 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

51 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

53 #ià
defšed
 
__OPTIMIZE__


54 
__ex‹º_®ways_šlše
 *

55 
	`šdex
 (*
__s
, 
__c
è
__THROW


57  
	`__butš_šdex
 (
__s
, 
__c
);

60 
__ex‹º_®ways_šlše
 const *

61 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


63  
	`__butš_šdex
 (
__s
, 
__c
);

66 
	}
}

68 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

73 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


76 *
	`ršdex
 (*
__s
, 
__c
)

77 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

79 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ià
defšed
 
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`ršdex
 (*
__s
, 
__c
è
__THROW


85  
	`__butš_ršdex
 (
__s
, 
__c
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


91  
	`__butš_ršdex
 (
__s
, 
__c
);

94 
	}
}

96 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

101 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8
 || defšed 
__USE_XOPEN2K8XSI


104 
	$ffs
 (
__i
è
__THROW
 
__©Œibu‹_cÚ¡__
;

109 #ifdef 
__USE_MISC


110 
	$ff¦
 (
__l
è
__THROW
 
__©Œibu‹_cÚ¡__
;

111 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

112 
__THROW
 
__©Œibu‹_cÚ¡__
;

116 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

117 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

120 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

123 #ifdef 
__USE_XOPEN2K8


125 
	~<b™s/ty³s/loÿË_t.h
>

128 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__loc
)

129 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

133 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

134 
size_t
 
__n
, 
loÿË_t
 
__loc
)

135 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

138 
__END_DECLS


140 #ià
	`__GNUC_PREREQ
 (3,4è&& 
__USE_FORTIFY_LEVEL
 > 0 \

141 && 
defšed
 
__fÜtify_funùiÚ


143 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


144 
	~<b™s/¡ršgs_fÜtif›d.h
>

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

61 
	#__STDC_NO_THREADS__
 1

	)

	@
1
.
1
/usr/include
189
4205
host/examples/art.c
host/examples/captcha.c
host/examples/cifar.c
host/examples/classifier.c
host/examples/coco.c
host/examples/darknet.c
host/examples/detector.c
host/examples/go.c
host/examples/instance-segmenter.c
host/examples/lsd.c
host/examples/nightmare.c
host/examples/regressor.c
host/examples/rnn.c
host/examples/segmenter.c
host/examples/super.c
host/examples/tag.c
host/examples/yolo.c
host/include/darknet.h
host/include/main.h
host/include/socket_api.h
host/main.c
host/src/activation_layer.c
host/src/activation_layer.h
host/src/activations.c
host/src/activations.h
host/src/avgpool_layer.c
host/src/avgpool_layer.h
host/src/batchnorm_layer.c
host/src/batchnorm_layer.h
host/src/blas.c
host/src/blas.h
host/src/box.c
host/src/box.h
host/src/classifier.h
host/src/col2im.c
host/src/col2im.h
host/src/connected_layer.c
host/src/connected_layer.h
host/src/convolutional_layer.c
host/src/convolutional_layer.h
host/src/cost_layer.c
host/src/cost_layer.h
host/src/crnn_layer.c
host/src/crnn_layer.h
host/src/crop_layer.c
host/src/crop_layer.h
host/src/cuda.c
host/src/cuda.h
host/src/data.c
host/src/data.h
host/src/deconvolutional_layer.c
host/src/deconvolutional_layer.h
host/src/demo.c
host/src/demo.h
host/src/detection_layer.c
host/src/detection_layer.h
host/src/diffprivate.c
host/src/diffprivate.h
host/src/dropout_layer.c
host/src/dropout_layer.h
host/src/gemm.c
host/src/gemm.h
host/src/gru_layer.c
host/src/gru_layer.h
host/src/im2col.c
host/src/im2col.h
host/src/image.c
host/src/image.h
host/src/image_opencv.cpp
host/src/iseg_layer.c
host/src/iseg_layer.h
host/src/l2norm_layer.c
host/src/l2norm_layer.h
host/src/layer.c
host/src/layer.h
host/src/list.c
host/src/list.h
host/src/local_layer.c
host/src/local_layer.h
host/src/logistic_layer.c
host/src/logistic_layer.h
host/src/lstm_layer.c
host/src/lstm_layer.h
host/src/matrix.c
host/src/matrix.h
host/src/maxpool_layer.c
host/src/maxpool_layer.h
host/src/network.c
host/src/network.h
host/src/normalization_layer.c
host/src/normalization_layer.h
host/src/option_list.c
host/src/option_list.h
host/src/parser.c
host/src/parser.h
host/src/region_layer.c
host/src/region_layer.h
host/src/reorg_layer.c
host/src/reorg_layer.h
host/src/rnn_layer.c
host/src/rnn_layer.h
host/src/route_layer.c
host/src/route_layer.h
host/src/shortcut_layer.c
host/src/shortcut_layer.h
host/src/socket_client.c
host/src/socket_server.c
host/src/softmax_layer.c
host/src/softmax_layer.h
host/src/stb_image.h
host/src/stb_image_write.h
host/src/tree.c
host/src/tree.h
host/src/upsample_layer.c
host/src/upsample_layer.h
host/src/utils.c
host/src/utils.h
host/src/yolo_layer.c
host/src/yolo_layer.h
ta/activations_TA.c
ta/aes-gcm-entry.c
ta/aes-gcm.c
ta/aes-internal-enc.c
ta/aes-internal.c
ta/aes_TA.c
ta/batchnorm_layer_TA.c
ta/blas_TA.c
ta/col2im_TA.c
ta/connected_layer_TA.c
ta/convolutional_layer_TA.c
ta/cost_layer_TA.c
ta/darknetp_ta.c
ta/diffprivate_TA.c
ta/dropout_layer_TA.c
ta/gemm_TA.c
ta/im2col_TA.c
ta/include/activations_TA.h
ta/include/aes-common.h
ta/include/aes-internal.h
ta/include/aes.h
ta/include/aes_TA.h
ta/include/batchnorm_layer_TA.h
ta/include/blas_TA.h
ta/include/col2im_TA.h
ta/include/connected_layer_TA.h
ta/include/convolutional_layer_TA.h
ta/include/cost_layer_TA.h
ta/include/darknet_TA.h
ta/include/darknetp_ta.h
ta/include/diffprivate_TA.h
ta/include/dropout_layer_TA.h
ta/include/gemm_TA.h
ta/include/im2col_TA.h
ta/include/math_TA.h
ta/include/maxpool_layer_TA.h
ta/include/network_TA.h
ta/include/parser_TA.h
ta/include/softmax_layer_TA.h
ta/include/user_ta_header_defines.h
ta/include/utils_TA.h
ta/math_TA.c
ta/maxpool_layer_TA.c
ta/network_TA.c
ta/parser_TA.c
ta/softmax_layer_TA.c
ta/utils_TA.c
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/cublas_v2.h
/usr/include/err.h
/usr/include/limits.h
/usr/include/math.h
/usr/include/netinet/in.h
/usr/include/pthread.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/cublas_api.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/sched.h
/usr/include/strings.h
/usr/include/stdc-predef.h
